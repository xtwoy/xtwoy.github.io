

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/lbxx.png">
  <link rel="icon" href="/img/lbxx.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="XtwoY">
  <meta name="keywords" content="">
  
    <meta name="description" content="🌕最常用的设计模式 🌗次常用的设计模式   设计模式  设计模式（Designpattern）代表了最佳的实践，通常被有经验的面向对象的软件开发人员所采用。设计模式是软件开发人员在软件开发过程中面临的一般问题的解决方案。这些解决方案是众多软件开发人员经过相当长的一段时间的试验和错误总结出来的。    创建型 创建型 结构型 结构型 行为型 行为型     常用 不常用 常用 不常用 常用 不">
<meta property="og:type" content="article">
<meta property="og:title" content="设计模式">
<meta property="og:url" content="http://xtwoy.github.io/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/index.html">
<meta property="og:site_name" content="XtwoY">
<meta property="og:description" content="🌕最常用的设计模式 🌗次常用的设计模式   设计模式  设计模式（Designpattern）代表了最佳的实践，通常被有经验的面向对象的软件开发人员所采用。设计模式是软件开发人员在软件开发过程中面临的一般问题的解决方案。这些解决方案是众多软件开发人员经过相当长的一段时间的试验和错误总结出来的。    创建型 创建型 结构型 结构型 行为型 行为型     常用 不常用 常用 不常用 常用 不">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/dp.png">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/the-relationship-between-design-patterns.jpg">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230108204034839.png">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230108203845045.png">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230108202856132.png">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230108200601362.png">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230108201003713.png">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230108204621982.png">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230108204609508.png">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230108204802649.png">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/62576915-36E0-4B67-B078-704699CA980A.jpg">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221224163121334.png">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221224163539743.png">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221224163606286.png">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221224165136437.png">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221224171144291.png">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/20201202-prototype-pattern.png">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221224193125327.png">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221224213529759.png">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221224214505679.png">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221224220521554.png">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221224220732126.png">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221225155334445.png">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221225161720849.png">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221225161754203.png">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221225163021962.png">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221225172743411.png">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230102143047364.png">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230102144821435.png">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230102145034564.png">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230102151322485.png">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230102172346775.png">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230102173756821.png">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230102185734930.png">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230102190822334.png">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230102193340583.png">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230102193600188.png">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230103100919853.png">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230103110105715.png">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230103111534525.png">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230103111520047.png">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230103144345369.png">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230103144507077.png">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230103150422044.png">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230103151032471.png">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230103151439028.png">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/commanduml.jpg">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230103163835693.png">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230103191915903.png">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230103191809297.png">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230103201406957.png">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230104142333771.png">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230104143905498.png">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230104145432933.png">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230104145924536.png">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230104162405505.png">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230104163106314.png">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230104163634868.png">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230104170305404.png">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230104185525137.png">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230105110507630.png">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230105110700473.png">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230105140413812.png">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230105154135954.png">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230105165911040.png">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230105170757994.png">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230105165733894.png">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230105183130277.png">
<meta property="og:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230105184409277.png">
<meta property="article:published_time" content="2023-01-05T11:31:42.000Z">
<meta property="article:modified_time" content="2023-07-02T08:19:01.856Z">
<meta property="article:author" content="XtwoY">
<meta property="article:tag" content="设计模式">
<meta property="article:tag" content="进阶">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/dp.png">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>设计模式 - XtwoY</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"xtwoy.github.io","root":"/","version":"1.9.3","typing":{"enable":true,"typeSpeed":150,"cursorChar":"_","loop":true,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"left","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"XcZMRYxyoKLVblDJBK1NWiIm-gzGzoHsz","app_key":"0CQR4gbS0Oqa9nyaFPmaiXSw","server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  

  

  

  

  

  

  
    
  



  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>XtwoYのBlog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                <span>Home</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                <span>Archives</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                <span>Categories</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                <span>Tags</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                <span>Links</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                <span>About</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="设计模式"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2023-01-05 19:31" pubdate>
          January 5, 2023 pm
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          173k words
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          1445 mins
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="padding-left: 2rem; margin-right: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>Table of Contents</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">设计模式</h1>
            
              <p class="note note-info">
                
                  
                    Last updated on July 2, 2023 pm
                  
                
              </p>
            
            
              <div class="markdown-body">
                
                <blockquote>
<p>🌕最常用的设计模式</p>
<p>🌗次常用的设计模式</p>
</blockquote>
<h1 id="设计模式"><a class="markdownIt-Anchor" href="#设计模式"></a> 设计模式</h1>
<p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/dp.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<p>设计模式（Designpattern）代表了最佳的实践，通常被有经验的面向对象的软件开发人员所采用。设计模式是软件开发人员在软件开发过程中面临的一般问题的解决方案。这些解决方案是众多软件开发人员经过相当长的一段时间的试验和错误总结出来的。</p>
<table>
<thead>
<tr>
<th>创建型</th>
<th>创建型</th>
<th>结构型</th>
<th>结构型</th>
<th>行为型</th>
<th>行为型</th>
</tr>
</thead>
<tbody>
<tr>
<td>常用</td>
<td>不常用</td>
<td>常用</td>
<td>不常用</td>
<td>常用</td>
<td>不常用</td>
</tr>
<tr>
<td>单例（Singleton ）工厂（Factory）抽象工厂（Abstract Factory）建造者（Builder）</td>
<td>原型（Prototype ）</td>
<td>代理（Proxy ）桥接（Bridge）装饰者（Decorator ）适配器（Adapter）</td>
<td>外观（Facade ）组合（Composite ）享元（Flyweight）</td>
<td>观察者 （Observer ）模板（Template ）策略（Strategy ）职责链（Chain of Responsibility）迭代器（Iterator ）状态（State）</td>
<td>访问者（Visitor ）备忘录（Memento ）命令（Command ）解释器（Interpreter ）中介（Mediator ）</td>
</tr>
</tbody>
</table>
<h1 id="设计模式简介"><a class="markdownIt-Anchor" href="#设计模式简介"></a> 设计模式简介</h1>
<p>设计模式（Designpattern）代表了最佳的实践，通常被有经验的面向对象的软件开发人员所采用。设计模式是软件开发人员在软件开发过程中面临的一般问题的解决方案。这些解决方案是众多软件开发人员经过相当长的一段时间的试验和错误总结出来的。</p>
<p>设计模式是一套被反复使用的、多数人知晓的、经过分类编目的、代码设计经验的总结。使用设计模式是为了重用代码、让代码更容易被他人理解、保证代码可靠性。<br />
毫无疑问，设计模式于己于他人于系统都是多赢的，设计模式使代码编制真正工程化，设计模式是软件工程的基石，如同大厦的一块块砖石一样。项目中合理地运用设计模式可以完美地解决很多问题，每种模式在现实中都有相应的原理来与之对应，每种模式都描述了一个在我们周围不断重复发生的问题，以及该问题的核心解决方案，这也是设计模式能被广泛应用的原因。</p>
<h2 id="什么是-gof四人帮全拼-gang-of-four"><a class="markdownIt-Anchor" href="#什么是-gof四人帮全拼-gang-of-four"></a> 什么是 GOF（四人帮，全拼 Gang of Four）？</h2>
<p>在 1994 年，由 Erich Gamma、Richard Helm、Ralph Johnson 和 John Vlissides 四人合著出版了一本名为<strong>Design Patterns - Elements of Reusable Object-Oriented Software（中文译名：设计模式 -可复用的面向对象软件元素）</strong> 的书，该书首次提到了软件开发中设计模式的概念。</p>
<p>四位作者合称 <strong>GOF（四人帮，全拼 Gang of Four）</strong> 。他们所提出的设计模式主要是基于以下的面向对象设计原则。</p>
<ul>
<li>对接口编程而不是对实现编程。</li>
<li>优先使用对象组合而不是继承。</li>
</ul>
<h2 id="设计模式的使用"><a class="markdownIt-Anchor" href="#设计模式的使用"></a> 设计模式的使用</h2>
<p>设计模式在软件开发中的两个主要用途。</p>
<h3 id="开发人员的共同平台"><a class="markdownIt-Anchor" href="#开发人员的共同平台"></a> 开发人员的共同平台</h3>
<p>设计模式提供了一个标准的术语系统，且具体到特定的情景。例如，单例设计模式意味着使用单个对象，这样所有熟悉单例设计模式的开发人员都能使用单个对象，并且可以通过这种方式告诉对方，程序使用的是单例模式。</p>
<h3 id="最佳的实践"><a class="markdownIt-Anchor" href="#最佳的实践"></a> 最佳的实践</h3>
<p>设计模式已经经历了很长一段时间的发展，它们提供了软件开发过程中面临的一般问题的最佳解决方案。学习这些模式有助于经验不足的开发人员通过一种简单快捷的方式来学习软件设计。</p>
<h2 id="设计模式的类型"><a class="markdownIt-Anchor" href="#设计模式的类型"></a> 设计模式的类型</h2>
<p>根据设计模式的参考书 <strong>Design Patterns - Elements of Reusable Object-Oriented<br />
Software（中文译名：设计模式 - 可复用的面向对象软件元素）</strong> 中所提到的，总共有 23种设计模式。这些模式可以分为三大类：创建型模式（Creational Patterns）、结构型模式（StructuralPatterns）、行为型模式（Behavioral Patterns）。</p>
<p>1   <strong>创建型模式</strong></p>
<p>这些设计模式提供了一种在创建对象的同时隐藏创建逻辑的方式，而不是使用 new运算符直接实例化对象。这使得程序在判断针对某个给定实例需要创建哪些对象时更加灵活。</p>
<ul>
<li>工厂模式（Factory Pattern）</li>
<li>抽象工厂模式（Abstract Factory Pattern）</li>
<li>单例模式（Singleton Pattern）</li>
<li>建造者模式（Builder Pattern）</li>
<li>原型模式（Prototype Pattern）</li>
</ul>
<p>2 <strong>结构型模式</strong><br />
这些设计模式关注类和对象的组合。继承的概念被用来组合接口和定义组合对象获得新功能的方式。</p>
<ul>
<li>适配器模式（Adapter Pattern）</li>
<li>桥接模式（Bridge Pattern）</li>
<li>过滤器模式（Filter、Criteria Pattern）</li>
<li>组合模式（Composite Pattern）</li>
<li>装饰器模式（Decorator Pattern）</li>
<li>外观模式（Facade Pattern）</li>
<li>享元模式（Flyweight Pattern）</li>
<li>代理模式（Proxy Pattern）</li>
</ul>
<p>3 <strong>行为型模式</strong><br />
这些设计模式特别关注对象之间的通信。</p>
<ul>
<li>责任链模式（Chain of Responsibility Pattern）</li>
<li>命令模式（Command Pattern）</li>
<li>解释器模式（Interpreter Pattern）</li>
<li>迭代器模式（Iterator Pattern）</li>
<li>中介者模式（Mediator Pattern）</li>
<li>备忘录模式（Memento Pattern）</li>
<li>观察者模式（Observer Pattern）</li>
<li>状态模式（State Pattern）</li>
<li>空对象模式（Null Object Pattern）</li>
<li>策略模式（Strategy Pattern）</li>
<li>模板模式（Template Pattern）</li>
<li>访问者模式（Visitor Pattern）</li>
</ul>
<p>4  <strong>J2EE 模式</strong><br />
这些设计模式特别关注表示层。这些模式是由 Sun Java Center 鉴定的。</p>
<ul>
<li>MVC 模式（MVC Pattern）</li>
<li>业务代表模式（Business Delegate Pattern）</li>
<li>组合实体模式（Composite Entity Pattern）</li>
<li>数据访问对象模式（Data Access Object Pattern）</li>
<li>前端控制器模式（Front Controller Pattern）</li>
<li>拦截过滤器模式（Intercepting Filter Pattern）</li>
<li>服务定位器模式（Service Locator Pattern）</li>
<li>传输对象模式（Transfer Object Pattern）</li>
</ul>
<p>下面用一个图片来整体描述一下设计模式之间的关系：</p>
<p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/the-relationship-between-design-patterns.jpg" srcset="/img/loading.gif" lazyload alt="设计模式之间的关系" />(/</p>
<h1 id="设计模式的六大原则"><a class="markdownIt-Anchor" href="#设计模式的六大原则"></a> 设计模式的六大原则</h1>
<h2 id="1-开闭原则open-close-principle"><a class="markdownIt-Anchor" href="#1-开闭原则open-close-principle"></a> <strong>1、开闭原则（Open Close Principle）</strong></h2>
<p>开闭原则的意思是： <strong>对扩展开放，对修改关闭</strong>。在程序需要进行拓展的时候，不能去修改原有的代码，实现一个热插拔的效果。简言之，是为了使程序的扩展性好，易于维护和升级。想要达到这样的效果，我们需要使用接口和抽象类，后面的具体设计中我们会提到这点。</p>
<p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230108204034839.png" srcset="/img/loading.gif" lazyload alt="image-20230108204034839" /></p>
<p><code>Ocp.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.principle.ocp;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Ocp</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">//使用看看存在的问题</span><br>      <span class="hljs-type">GraphicEditor</span> <span class="hljs-variable">graphicEditor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GraphicEditor</span>();<br>      graphicEditor.drawShape(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Rectangle</span>());<br>      graphicEditor.drawShape(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Circle</span>());<br>      graphicEditor.drawShape(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Triangle</span>());<br>   &#125;<br><br>&#125;<br><br><span class="hljs-comment">//这是一个用于绘图的类 [使用方]</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">GraphicEditor</span> &#123;<br>   <span class="hljs-comment">//接收Shape对象，然后根据type，来绘制不同的图形</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">drawShape</span><span class="hljs-params">(Shape s)</span> &#123;<br>      <span class="hljs-keyword">if</span> (s.m_type == <span class="hljs-number">1</span>)<br>         drawRectangle(s);<br>      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (s.m_type == <span class="hljs-number">2</span>)<br>         drawCircle(s);<br>      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (s.m_type == <span class="hljs-number">3</span>)<br>         drawTriangle(s);<br>   &#125;<br><br>   <span class="hljs-comment">//绘制矩形</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">drawRectangle</span><span class="hljs-params">(Shape r)</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot; 绘制矩形 &quot;</span>);<br>   &#125;<br><br>   <span class="hljs-comment">//绘制圆形</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">drawCircle</span><span class="hljs-params">(Shape r)</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot; 绘制圆形 &quot;</span>);<br>   &#125;<br>   <br>   <span class="hljs-comment">//绘制三角形</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">drawTriangle</span><span class="hljs-params">(Shape r)</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot; 绘制三角形 &quot;</span>);<br>   &#125;<br>&#125;<br><br><span class="hljs-comment">//Shape类，基类</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Shape</span> &#123;<br>   <span class="hljs-type">int</span> m_type;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Rectangle</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Shape</span> &#123;<br>   Rectangle() &#123;<br>      <span class="hljs-built_in">super</span>.m_type = <span class="hljs-number">1</span>;<br>   &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Circle</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Shape</span> &#123;<br>   Circle() &#123;<br>      <span class="hljs-built_in">super</span>.m_type = <span class="hljs-number">2</span>;<br>   &#125;<br>&#125;<br><br><span class="hljs-comment">//新增画三角形</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Triangle</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Shape</span> &#123;<br>   Triangle() &#123;<br>      <span class="hljs-built_in">super</span>.m_type = <span class="hljs-number">3</span>;<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<blockquote>
<p>方式 1 的优缺点</p>
</blockquote>
<ol>
<li>
<p>优点是比较好理解，简单易操作。</p>
</li>
<li>
<p>缺点是违反了设计模式的 ocp 原则，即对扩展开放(ᨀ 供方)，对修改关闭(使用方)。即当我们给类增加新功能的时候，尽量不修改代码，或者尽可能少修改代码.</p>
</li>
<li>
<p>比如我们这时要新增加一个图形种类 三角形，我们需要做如下修改，修改的地方较多</p>
</li>
</ol>
<blockquote>
<p>改进的思路分析</p>
</blockquote>
<p><strong>思路</strong>：把创建 <strong>Shape 类做成抽象类</strong>，并ᨀ 供一个<strong>抽象的 draw</strong> 方法，让<strong>子类去实现即可</strong>，这样我们有新的图形种类时，只需要让新的图形类继承 Shape，并实现 draw 方法即可，<strong>使用方的代码就不需要修</strong> -&gt; 满足了开闭原则</p>
<p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230108203845045.png" srcset="/img/loading.gif" lazyload alt="image-20230108203845045" /></p>
<p><code>Ocp.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.principle.ocp.improve;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Ocp</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">//使用看看存在的问题</span><br>      <span class="hljs-type">GraphicEditor</span> <span class="hljs-variable">graphicEditor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GraphicEditor</span>();<br>      graphicEditor.drawShape(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Rectangle</span>());<br>      graphicEditor.drawShape(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Circle</span>());<br>      graphicEditor.drawShape(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Triangle</span>());<br>      graphicEditor.drawShape(<span class="hljs-keyword">new</span> <span class="hljs-title class_">OtherGraphic</span>());<br>   &#125;<br><br>&#125;<br><br><span class="hljs-comment">//这是一个用于绘图的类 [使用方]</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">GraphicEditor</span> &#123;<br>   <span class="hljs-comment">//接收Shape对象，调用draw方法</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">drawShape</span><span class="hljs-params">(Shape s)</span> &#123;<br>      s.draw();<br>   &#125;<br><br>   <br>&#125;<br><br><span class="hljs-comment">//Shape类，基类</span><br><span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Shape</span> &#123;<br>   <span class="hljs-type">int</span> m_type;<br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">draw</span><span class="hljs-params">()</span>;<span class="hljs-comment">//抽象方法</span><br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Rectangle</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Shape</span> &#123;<br>   Rectangle() &#123;<br>      <span class="hljs-built_in">super</span>.m_type = <span class="hljs-number">1</span>;<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">draw</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot; 绘制矩形 &quot;</span>);<br>   &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Circle</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Shape</span> &#123;<br>   Circle() &#123;<br>      <span class="hljs-built_in">super</span>.m_type = <span class="hljs-number">2</span>;<br>   &#125;<br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">draw</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot; 绘制圆形 &quot;</span>);<br>   &#125;<br>&#125;<br><br><span class="hljs-comment">//新增画三角形</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Triangle</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Shape</span> &#123;<br>   Triangle() &#123;<br>      <span class="hljs-built_in">super</span>.m_type = <span class="hljs-number">3</span>;<br>   &#125;<br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">draw</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot; 绘制三角形 &quot;</span>);<br>   &#125;<br>&#125;<br><br><span class="hljs-comment">//新增一个图形</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">OtherGraphic</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Shape</span> &#123;<br>   OtherGraphic() &#123;<br>      <span class="hljs-built_in">super</span>.m_type = <span class="hljs-number">4</span>;<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">draw</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot; 绘制其它图形 &quot;</span>);<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="2-里氏代换原则liskov-substitution-principle"><a class="markdownIt-Anchor" href="#2-里氏代换原则liskov-substitution-principle"></a> <strong>2、里氏代换原则（Liskov Substitution Principle）</strong></h2>
<p>里氏代换原则是面向对象设计的基本原则之一。 里氏代换原则中说，任何基类可以出现的地方，子类一定可以出现。LSP是继承复用的基石，只有当派生类可以替换掉基类，且软件单位的功能不受到影响时，基类才能真正被复用，而派生类也能够在基类的基础上增加新的行为。里氏代换原则是对开闭原则的补充。实现开闭原则的关键步骤就是抽象化，而基类与子类的继承关系就是抽象化的具体实现，所以里氏代换原则是对实现抽象化的具体步骤的规范。</p>
<ol>
<li>
<p>里氏替换原则(Liskov Substitution Principle)在 1988 年，由麻省理工学院的以为姓里的女士ᨀ 出的。</p>
</li>
<li>
<p>如果对每个类型为 T1 的对象 o1，都有类型为 T2 的对象 o2，使得以 T1 定义的所有程序 P 在所有的对象 o1 都代换成 o2 时，程序 P 的行为没有发生变化，那么类型 T2 是类型 T1 的子类型。<strong>换句话说，所有引用基类的地须能透明地使用其子类的对象</strong>。</p>
</li>
<li>
<p>在使用继承时，遵循里氏替换原则，在<strong>子类中尽量不要重写父类的方法</strong></p>
</li>
<li>
<p>里氏替换原则告诉我们，继承实际上让两个类耦合性增强了，在适当的情况下，可以通过<strong>聚合，组合，依赖 来解决问题</strong>。.</p>
</li>
</ol>
<blockquote>
<p>继承性的思考和说明</p>
</blockquote>
<ol>
<li>
<p>继承包含这样一层含义：父类中凡是已经实现好的方法，实际上是在设定规范和契约，虽然它不强制要求所有的子类必须遵循这些契约，但是如果子类对这些已经实现的方法任意修改，就会对整个继承体系造成破坏。</p>
</li>
<li>
<p><strong>继承在给程序设计带来便利的同时，也带来了弊端</strong>。比如使用继承会给程序带来<strong>侵入性</strong>，程序的可移植性降低，增加对象间的耦合性，如果一个类被其他的类所继承，则当这个类需要修改时，必须考虑到所有的子类，并且父类修改后，所有涉及到子类的功能都有可能产生故障</p>
</li>
<li>
<p>问题提 出：<strong>在编程中，如何正确的使用继承</strong>? =&gt; <strong>里氏替换</strong>原则</p>
</li>
</ol>
<h3 id="一个程序引出的问题和思考"><a class="markdownIt-Anchor" href="#一个程序引出的问题和思考"></a> 一个程序引出的问题和思考</h3>
<p><code>Liskov.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.principle.liskov;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Liskov</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-type">A</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">A</span>();<br>      System.out.println(<span class="hljs-string">&quot;11-3=&quot;</span> + a.func1(<span class="hljs-number">11</span>, <span class="hljs-number">3</span>));<br>      System.out.println(<span class="hljs-string">&quot;1-8=&quot;</span> + a.func1(<span class="hljs-number">1</span>, <span class="hljs-number">8</span>));<br><br>      System.out.println(<span class="hljs-string">&quot;-----------------------&quot;</span>);<br>      <span class="hljs-type">B</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">B</span>();<br>      System.out.println(<span class="hljs-string">&quot;11-3=&quot;</span> + b.func1(<span class="hljs-number">11</span>, <span class="hljs-number">3</span>));<span class="hljs-comment">//这里本意是求出11-3</span><br>      System.out.println(<span class="hljs-string">&quot;1-8=&quot;</span> + b.func1(<span class="hljs-number">1</span>, <span class="hljs-number">8</span>));<span class="hljs-comment">// 1-8</span><br>      System.out.println(<span class="hljs-string">&quot;11+3+9=&quot;</span> + b.func2(<span class="hljs-number">11</span>, <span class="hljs-number">3</span>));<br>      <br>      <br><br>   &#125;<br><br>&#125;<br><br><span class="hljs-comment">// A类</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span> &#123;<br>   <span class="hljs-comment">// 返回两个数的差</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">func1</span><span class="hljs-params">(<span class="hljs-type">int</span> num1, <span class="hljs-type">int</span> num2)</span> &#123;<br>      <span class="hljs-keyword">return</span> num1 - num2;<br>   &#125;<br>&#125;<br><br><span class="hljs-comment">// B类继承了A</span><br><span class="hljs-comment">// 增加了一个新功能：完成两个数相加,然后和9求和</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">B</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">A</span> &#123;<br>   <span class="hljs-comment">//这里，重写了A类的方法, 可能是无意识</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">func1</span><span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b)</span> &#123;<br>      <span class="hljs-keyword">return</span> a + b;<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">func2</span><span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b)</span> &#123;<br>      <span class="hljs-keyword">return</span> func1(a, b) + <span class="hljs-number">9</span>;<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="解决方法"><a class="markdownIt-Anchor" href="#解决方法"></a> 解决方法</h3>
<ol>
<li>
<p>我们发现原来运行正常的相减功能发生了错误。原因就是类 B 无意中重写了父类的方法，造成原有功能出现错误。在实际编程中，我们常常会通过重写父类的方法完成新的功能，这样写起来虽然简单，但整个继承体系的复用性会比较差。特别是运行多态比较频繁的时候</p>
</li>
<li>
<p>通用的做法是：<strong>原来的父类和子类都继承一个更通俗的基类</strong>，原有的继承关系去掉，采用<strong>依赖，聚合，组合</strong>等关系代替.</p>
</li>
<li>
<p>改进方案</p>
<p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230108202856132.png" srcset="/img/loading.gif" lazyload alt="image-20230108202856132" /></p>
<p><code>Liskov.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.principle.liskov.improve;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Liskov</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-type">A</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">A</span>();<br>      System.out.println(<span class="hljs-string">&quot;11-3=&quot;</span> + a.func1(<span class="hljs-number">11</span>, <span class="hljs-number">3</span>));<br>      System.out.println(<span class="hljs-string">&quot;1-8=&quot;</span> + a.func1(<span class="hljs-number">1</span>, <span class="hljs-number">8</span>));<br><br>      System.out.println(<span class="hljs-string">&quot;-----------------------&quot;</span>);<br>      <span class="hljs-type">B</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">B</span>();<br>      <span class="hljs-comment">//因为B类不再继承A类，因此调用者，不会再func1是求减法</span><br>      <span class="hljs-comment">//调用完成的功能就会很明确</span><br>      System.out.println(<span class="hljs-string">&quot;11+3=&quot;</span> + b.func1(<span class="hljs-number">11</span>, <span class="hljs-number">3</span>));<span class="hljs-comment">//这里本意是求出11+3</span><br>      System.out.println(<span class="hljs-string">&quot;1+8=&quot;</span> + b.func1(<span class="hljs-number">1</span>, <span class="hljs-number">8</span>));<span class="hljs-comment">// 1+8</span><br>      System.out.println(<span class="hljs-string">&quot;11+3+9=&quot;</span> + b.func2(<span class="hljs-number">11</span>, <span class="hljs-number">3</span>));<br>      <br>      <br>      <span class="hljs-comment">//使用组合仍然可以使用到A类相关方法</span><br>      System.out.println(<span class="hljs-string">&quot;11-3=&quot;</span> + b.func3(<span class="hljs-number">11</span>, <span class="hljs-number">3</span>));<span class="hljs-comment">// 这里本意是求出11-3</span><br>      <br><br>   &#125;<br><br>&#125;<br><br><span class="hljs-comment">//创建一个更加基础的基类</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Base</span> &#123;<br>   <span class="hljs-comment">//把更加基础的方法和成员写到Base类</span><br>&#125;<br><br><span class="hljs-comment">// A类</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Base</span> &#123;<br>   <span class="hljs-comment">// 返回两个数的差</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">func1</span><span class="hljs-params">(<span class="hljs-type">int</span> num1, <span class="hljs-type">int</span> num2)</span> &#123;<br>      <span class="hljs-keyword">return</span> num1 - num2;<br>   &#125;<br>&#125;<br><br><span class="hljs-comment">// B类继承了A</span><br><span class="hljs-comment">// 增加了一个新功能：完成两个数相加,然后和9求和</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">B</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Base</span> &#123;<br>   <span class="hljs-comment">//如果B需要使用A类的方法,使用组合关系</span><br>   <span class="hljs-keyword">private</span> <span class="hljs-type">A</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">A</span>();<br>   <br>   <span class="hljs-comment">//这里，重写了A类的方法, 可能是无意识</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">func1</span><span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b)</span> &#123;<br>      <span class="hljs-keyword">return</span> a + b;<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">func2</span><span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b)</span> &#123;<br>      <span class="hljs-keyword">return</span> func1(a, b) + <span class="hljs-number">9</span>;<br>   &#125;<br>   <br>   <span class="hljs-comment">//我们仍然想使用A的方法</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">func3</span><span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b)</span> &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.a.func1(a, b);<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="3-依赖倒转原则dependence-inversion-principle"><a class="markdownIt-Anchor" href="#3-依赖倒转原则dependence-inversion-principle"></a> <strong>3、依赖倒转原则（Dependence Inversion Principle）</strong></h2>
<ol>
<li>
<p>高层模块不应该依赖低层模块，二者都应该依赖其抽象</p>
</li>
<li>
<p><strong>抽象不应该依赖细节，细节应该依赖抽象</strong></p>
</li>
<li>
<p>依赖倒转(倒置)的中心思想是<strong>面向接口编程</strong></p>
</li>
<li>
<p>依赖倒转原则是基于这样的设计理念：相对于细节的多变性，抽象的东西要稳定的多。以抽象为基础搭建的架构比以细节为基础的架构要稳定的多。在 java 中，抽象指的是接口或抽象类，细节就是具体的实现类</p>
</li>
<li>
<p>使用<strong>接口或抽象类</strong>的目的是制定好<strong>规范</strong>，而不涉及任何具体的操作，把<strong>展现细节的任务交给他们的实现类</strong>去完成</p>
</li>
</ol>
<h3 id="实现方案-1-分析说明"><a class="markdownIt-Anchor" href="#实现方案-1-分析说明"></a> 实现方案 1 + 分析说明</h3>
<p><code>DependecyInversion.java</code></p>
   <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.principle.inversion;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DependecyInversion</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>();<br>      person.receive(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Email</span>());<br>   &#125;<br><br>&#125;<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Email</span> &#123;<br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getInfo</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;电子邮件信息: hello,world&quot;</span>;<br>   &#125;<br>&#125;<br><br><span class="hljs-comment">//完成Person接收消息的功能</span><br><span class="hljs-comment">//方式1分析</span><br><span class="hljs-comment">//1. 简单，比较容易想到</span><br><span class="hljs-comment">//2. 如果我们获取的对象是 微信，短信等等，则新增类，同时Perons也要增加相应的接收方法</span><br><span class="hljs-comment">//3. 解决思路：引入一个抽象的接口IReceiver, 表示接收者, 这样Person类与接口IReceiver发生依赖</span><br><span class="hljs-comment">//   因为Email, WeiXin 等等属于接收的范围，他们各自实现IReceiver 接口就ok, 这样我们就符号依赖倒转原则</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> &#123;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">receive</span><span class="hljs-params">(Email email )</span> &#123;<br>      System.out.println(email.getInfo());<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="实现方案-2依赖倒转-分析说明"><a class="markdownIt-Anchor" href="#实现方案-2依赖倒转-分析说明"></a> 实现方案 2(依赖倒转) + 分析说明</h3>
<p><code>DependecyInversion.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.principle.inversion.improve;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DependecyInversion</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">//客户端无需改变</span><br>      <span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>();<br>      person.receive(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Email</span>());<br>      <br>      person.receive(<span class="hljs-keyword">new</span> <span class="hljs-title class_">WeiXin</span>());<br>   &#125;<br><br>&#125;<br><br><span class="hljs-comment">//定义接口</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">IReceiver</span> &#123;<br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getInfo</span><span class="hljs-params">()</span>;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Email</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IReceiver</span> &#123;<br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getInfo</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;电子邮件信息: hello,world&quot;</span>;<br>   &#125;<br>&#125;<br><br><span class="hljs-comment">//增加微信</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">WeiXin</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IReceiver</span> &#123;<br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getInfo</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;微信信息: hello,ok&quot;</span>;<br>   &#125;<br>&#125;<br><br><span class="hljs-comment">//方式2</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> &#123;<br>   <span class="hljs-comment">//这里我们是对接口的依赖</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">receive</span><span class="hljs-params">(IReceiver receiver )</span> &#123;<br>      System.out.println(receiver.getInfo());<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="依赖关系传递的三种方式和应用案例"><a class="markdownIt-Anchor" href="#依赖关系传递的三种方式和应用案例"></a> 依赖关系传递的三种方式和应用案例</h3>
<ol>
<li>
<p>接口传递</p>
<p>应用案例代码</p>
</li>
<li>
<p>构造方法传递</p>
<p>应用案例代码</p>
</li>
<li>
<p>setter 方式传递</p>
</li>
</ol>
<p><code>DependencyPass.java</code></p>
   <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.principle.inversion.improve;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DependencyPass</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-type">ChangHong</span> <span class="hljs-variable">changHong</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChangHong</span>();<br><span class="hljs-comment">//    OpenAndClose openAndClose = new OpenAndClose();</span><br><span class="hljs-comment">//    openAndClose.open(changHong);</span><br>      <br>      <span class="hljs-comment">//通过构造器进行依赖传递</span><br><span class="hljs-comment">//    OpenAndClose openAndClose = new OpenAndClose(changHong);</span><br><span class="hljs-comment">//    openAndClose.open();</span><br>      <span class="hljs-comment">//通过setter方法进行依赖传递</span><br>      <span class="hljs-type">OpenAndClose</span> <span class="hljs-variable">openAndClose</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OpenAndClose</span>();<br>      openAndClose.setTv(changHong);<br>      openAndClose.open();<br><br>   &#125;<br><br>&#125;<br><br><span class="hljs-comment">// 方式1： 通过接口传递实现依赖</span><br><span class="hljs-comment">// 开关的接口</span><br><span class="hljs-comment">// interface IOpenAndClose &#123;</span><br><span class="hljs-comment">// public void open(ITV tv); //抽象方法,接收接口</span><br><span class="hljs-comment">// &#125;</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">// interface ITV &#123; //ITV接口</span><br><span class="hljs-comment">// public void play();</span><br><span class="hljs-comment">// &#125;</span><br><span class="hljs-comment">// </span><br><span class="hljs-comment">// class ChangHong implements ITV &#123;</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">// @Override</span><br><span class="hljs-comment">// public void play() &#123;</span><br><span class="hljs-comment">//    // TODO Auto-generated method stub</span><br><span class="hljs-comment">//    System.out.println(&quot;长虹电视机，打开&quot;);</span><br><span class="hljs-comment">// &#125;</span><br><span class="hljs-comment">//  </span><br><span class="hljs-comment">// &#125;</span><br><span class="hljs-comment">//// 实现接口</span><br><span class="hljs-comment">// class OpenAndClose implements IOpenAndClose&#123;</span><br><span class="hljs-comment">// public void open(ITV tv)&#123;</span><br><span class="hljs-comment">// tv.play();</span><br><span class="hljs-comment">// &#125;</span><br><span class="hljs-comment">// &#125;</span><br><br><span class="hljs-comment">// 方式2: 通过构造方法依赖传递</span><br><span class="hljs-comment">// interface IOpenAndClose &#123;</span><br><span class="hljs-comment">// public void open(); //抽象方法</span><br><span class="hljs-comment">// &#125;</span><br><span class="hljs-comment">// interface ITV &#123; //ITV接口</span><br><span class="hljs-comment">// public void play();</span><br><span class="hljs-comment">// &#125;</span><br><span class="hljs-comment">// class OpenAndClose implements IOpenAndClose&#123;</span><br><span class="hljs-comment">// public ITV tv; //成员</span><br><span class="hljs-comment">// public OpenAndClose(ITV tv)&#123; //构造器</span><br><span class="hljs-comment">// this.tv = tv;</span><br><span class="hljs-comment">// &#125;</span><br><span class="hljs-comment">// public void open()&#123;</span><br><span class="hljs-comment">// this.tv.play();</span><br><span class="hljs-comment">// &#125;</span><br><span class="hljs-comment">// &#125;</span><br><br><br><span class="hljs-comment">// 方式3 , 通过setter方法传递</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">IOpenAndClose</span> &#123;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">open</span><span class="hljs-params">()</span>; <span class="hljs-comment">// 抽象方法</span><br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setTv</span><span class="hljs-params">(ITV tv)</span>;<br>&#125;<br><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">ITV</span> &#123; <span class="hljs-comment">// ITV接口</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">play</span><span class="hljs-params">()</span>;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">OpenAndClose</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IOpenAndClose</span> &#123;<br>   <span class="hljs-keyword">private</span> ITV tv;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setTv</span><span class="hljs-params">(ITV tv)</span> &#123;<br>      <span class="hljs-built_in">this</span>.tv = tv;<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">open</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-built_in">this</span>.tv.play();<br>   &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ChangHong</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ITV</span> &#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">play</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot;长虹电视机，打开&quot;</span>);<br>   &#125;<br>    <br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="依赖倒转原则的注意事项和细节"><a class="markdownIt-Anchor" href="#依赖倒转原则的注意事项和细节"></a> 依赖倒转原则的注意事项和细节</h3>
<ol>
<li>
<p>低层模块尽量都要有抽象类或接口，或者两者都有，程序稳定性更好.</p>
</li>
<li>
<p>变量的<strong>声明类型尽量是抽象类或接口</strong>, 这样我们的变量引用和实际对象间，就存在<strong>一个缓冲层</strong>，利于程序扩展和优化</p>
</li>
<li>
<p>继承时遵循<strong>里氏替换</strong>原则</p>
</li>
</ol>
<h2 id="4-接口隔离原则interface-segregation-principle"><a class="markdownIt-Anchor" href="#4-接口隔离原则interface-segregation-principle"></a> <strong>4、接口隔离原则（Interface Segregation Principle）</strong></h2>
<p>这个原则的意思是：使用多个隔离的接口，比使用单个接口要好。它还有另外一个意思是：降低类之间的耦合度。由此可见，其实设计模式就是从大型软件架构出发、便于升级和维护的软件设计思想，它强调降低依赖，降低耦合。</p>
<p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230108200601362.png" srcset="/img/loading.gif" lazyload alt="image-20230108200601362" /></p>
<ol>
<li>
<p>类 A 通过接口 Interface1 依赖类 B，类 C 通过接口 Interface1 依赖类 D，如果接口 Interface1 对于类 A 和类 C来说不是最小接口，那么类 B 和类 D 必须去实现他们不需要的方法。</p>
</li>
<li>
<p>按隔离原则应当这样处理：</p>
</li>
</ol>
<p><strong>将接口 Interface1</strong> 拆分为<strong>独立的几个接口(这里我们拆分成 3 个接口)</strong>，类 A 和类 C 分别与他们需要的接口建立依赖关系。也就是采用接口隔离原则</p>
<p><code>Segregation1.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.principle.segregation;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Segregation1</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br><br>   &#125;<br><br>&#125;<br><br><span class="hljs-comment">//接口</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Interface1</span> &#123;<br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation1</span><span class="hljs-params">()</span>;<br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation2</span><span class="hljs-params">()</span>;<br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation3</span><span class="hljs-params">()</span>;<br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation4</span><span class="hljs-params">()</span>;<br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation5</span><span class="hljs-params">()</span>;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">B</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Interface1</span> &#123;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation1</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;B 实现了 operation1&quot;</span>);<br>   &#125;<br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation2</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;B 实现了 operation2&quot;</span>);<br>   &#125;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation3</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;B 实现了 operation3&quot;</span>);<br>   &#125;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation4</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;B 实现了 operation4&quot;</span>);<br>   &#125;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation5</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;B 实现了 operation5&quot;</span>);<br>   &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">D</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Interface1</span> &#123;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation1</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;D 实现了 operation1&quot;</span>);<br>   &#125;<br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation2</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;D 实现了 operation2&quot;</span>);<br>   &#125;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation3</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;D 实现了 operation3&quot;</span>);<br>   &#125;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation4</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;D 实现了 operation4&quot;</span>);<br>   &#125;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation5</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;D 实现了 operation5&quot;</span>);<br>   &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span> &#123; <span class="hljs-comment">//A 类通过接口Interface1 依赖(使用) B类，但是只会用到1,2,3方法</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">depend1</span><span class="hljs-params">(Interface1 i)</span> &#123;<br>      i.operation1();<br>   &#125;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">depend2</span><span class="hljs-params">(Interface1 i)</span> &#123;<br>      i.operation2();<br>   &#125;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">depend3</span><span class="hljs-params">(Interface1 i)</span> &#123;<br>      i.operation3();<br>   &#125;<br>&#125;<br>  <br><span class="hljs-keyword">class</span> <span class="hljs-title class_">C</span> &#123; <span class="hljs-comment">//C 类通过接口Interface1 依赖(使用) D类，但是只会用到1,4,5方法</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">depend1</span><span class="hljs-params">(Interface1 i)</span> &#123;<br>      i.operation1();<br>   &#125;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">depend4</span><span class="hljs-params">(Interface1 i)</span> &#123;<br>      i.operation4();<br>   &#125;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">depend5</span><span class="hljs-params">(Interface1 i)</span> &#123;<br>      i.operation5();<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>Segregation1.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.principle.segregation.improve;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Segregation1</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-comment">// 使用一把</span><br>      <span class="hljs-type">A</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">A</span>();<br>      a.depend1(<span class="hljs-keyword">new</span> <span class="hljs-title class_">B</span>()); <span class="hljs-comment">// A类通过接口去依赖B类</span><br>      a.depend2(<span class="hljs-keyword">new</span> <span class="hljs-title class_">B</span>());<br>      a.depend3(<span class="hljs-keyword">new</span> <span class="hljs-title class_">B</span>());<br><br>      <span class="hljs-type">C</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">C</span>();<br><br>      c.depend1(<span class="hljs-keyword">new</span> <span class="hljs-title class_">D</span>()); <span class="hljs-comment">// C类通过接口去依赖(使用)D类</span><br>      c.depend4(<span class="hljs-keyword">new</span> <span class="hljs-title class_">D</span>());<br>      c.depend5(<span class="hljs-keyword">new</span> <span class="hljs-title class_">D</span>());<br><br>   &#125;<br><br>&#125;<br><br><span class="hljs-comment">// 接口1</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Interface1</span> &#123;<br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation1</span><span class="hljs-params">()</span>;<br><br>&#125;<br><br><span class="hljs-comment">// 接口2</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Interface2</span> &#123;<br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation2</span><span class="hljs-params">()</span>;<br><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation3</span><span class="hljs-params">()</span>;<br>&#125;<br><br><span class="hljs-comment">// 接口3</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Interface3</span> &#123;<br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation4</span><span class="hljs-params">()</span>;<br><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation5</span><span class="hljs-params">()</span>;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">B</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Interface1</span>, Interface2 &#123;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation1</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;B 实现了 operation1&quot;</span>);<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation2</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;B 实现了 operation2&quot;</span>);<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation3</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;B 实现了 operation3&quot;</span>);<br>   &#125;<br><br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">D</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Interface1</span>, Interface3 &#123;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation1</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;D 实现了 operation1&quot;</span>);<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation4</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;D 实现了 operation4&quot;</span>);<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation5</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;D 实现了 operation5&quot;</span>);<br>   &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span> &#123; <span class="hljs-comment">// A 类通过接口Interface1,Interface2 依赖(使用) B类，但是只会用到1,2,3方法</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">depend1</span><span class="hljs-params">(Interface1 i)</span> &#123;<br>      i.operation1();<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">depend2</span><span class="hljs-params">(Interface2 i)</span> &#123;<br>      i.operation2();<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">depend3</span><span class="hljs-params">(Interface2 i)</span> &#123;<br>      i.operation3();<br>   &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">C</span> &#123; <span class="hljs-comment">// C 类通过接口Interface1,Interface3 依赖(使用) D类，但是只会用到1,4,5方法</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">depend1</span><span class="hljs-params">(Interface1 i)</span> &#123;<br>      i.operation1();<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">depend4</span><span class="hljs-params">(Interface3 i)</span> &#123;<br>      i.operation4();<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">depend5</span><span class="hljs-params">(Interface3 i)</span> &#123;<br>      i.operation5();<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="应传统方法的问题和使用接口隔离原则改进"><a class="markdownIt-Anchor" href="#应传统方法的问题和使用接口隔离原则改进"></a> 应传统方法的问题和使用接口隔离原则改进</h3>
<p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230108201003713.png" srcset="/img/loading.gif" lazyload alt="image-20230108201003713" /></p>
<ol>
<li>
<p>类 A 通过接口 Interface1 依赖类 B，类 C 通过接口 Interface1 依赖类 D，如果接口 Interface1 对于类 A 和类 C来说不是最小接口，那么类 B 和类 D 必须去实现他们不需要的方法</p>
</li>
<li>
<p>将接口 <strong>Interface1 拆分为独立的几个接口</strong>，类 A 和类 C 分别与他们需要的接口建立依赖关系。也就是采用接口隔离原则</p>
</li>
<li>
<p>接口 Interface1 中出现的方法，根据实际情况拆分为<strong>三个</strong>接口</p>
</li>
<li>
<p><code>Segregation1.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.principle.segregation.improve;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Segregation1</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-comment">// 使用一把</span><br>      <span class="hljs-type">A</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">A</span>();<br>      a.depend1(<span class="hljs-keyword">new</span> <span class="hljs-title class_">B</span>()); <span class="hljs-comment">// A类通过接口去依赖B类</span><br>      a.depend2(<span class="hljs-keyword">new</span> <span class="hljs-title class_">B</span>());<br>      a.depend3(<span class="hljs-keyword">new</span> <span class="hljs-title class_">B</span>());<br><br>      <span class="hljs-type">C</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">C</span>();<br><br>      c.depend1(<span class="hljs-keyword">new</span> <span class="hljs-title class_">D</span>()); <span class="hljs-comment">// C类通过接口去依赖(使用)D类</span><br>      c.depend4(<span class="hljs-keyword">new</span> <span class="hljs-title class_">D</span>());<br>      c.depend5(<span class="hljs-keyword">new</span> <span class="hljs-title class_">D</span>());<br><br>   &#125;<br><br>&#125;<br><br><span class="hljs-comment">// 接口1</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Interface1</span> &#123;<br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation1</span><span class="hljs-params">()</span>;<br><br>&#125;<br><br><span class="hljs-comment">// 接口2</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Interface2</span> &#123;<br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation2</span><span class="hljs-params">()</span>;<br><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation3</span><span class="hljs-params">()</span>;<br>&#125;<br><br><span class="hljs-comment">// 接口3</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Interface3</span> &#123;<br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation4</span><span class="hljs-params">()</span>;<br><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation5</span><span class="hljs-params">()</span>;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">B</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Interface1</span>, Interface2 &#123;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation1</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;B 实现了 operation1&quot;</span>);<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation2</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;B 实现了 operation2&quot;</span>);<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation3</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;B 实现了 operation3&quot;</span>);<br>   &#125;<br><br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">D</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Interface1</span>, Interface3 &#123;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation1</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;D 实现了 operation1&quot;</span>);<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation4</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;D 实现了 operation4&quot;</span>);<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation5</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;D 实现了 operation5&quot;</span>);<br>   &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span> &#123; <span class="hljs-comment">// A 类通过接口Interface1,Interface2 依赖(使用) B类，但是只会用到1,2,3方法</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">depend1</span><span class="hljs-params">(Interface1 i)</span> &#123;<br>      i.operation1();<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">depend2</span><span class="hljs-params">(Interface2 i)</span> &#123;<br>      i.operation2();<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">depend3</span><span class="hljs-params">(Interface2 i)</span> &#123;<br>      i.operation3();<br>   &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">C</span> &#123; <span class="hljs-comment">// C 类通过接口Interface1,Interface3 依赖(使用) D类，但是只会用到1,4,5方法</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">depend1</span><span class="hljs-params">(Interface1 i)</span> &#123;<br>      i.operation1();<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">depend4</span><span class="hljs-params">(Interface3 i)</span> &#123;<br>      i.operation4();<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">depend5</span><span class="hljs-params">(Interface3 i)</span> &#123;<br>      i.operation5();<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="5-迪米特法则又称最少知道原则demeter-principle"><a class="markdownIt-Anchor" href="#5-迪米特法则又称最少知道原则demeter-principle"></a> <strong>5、迪米特法则，又称最少知道原则（Demeter Principle）</strong></h2>
<p>最少知道原则是指：一个实体应当尽量少地与其他实体之间发生相互作用，使得系统功能模块相对独立。</p>
<ol>
<li>
<p>一个对象应该对其他对象保持最少的了解</p>
</li>
<li>
<p>类与类关系越密切，耦合度越大</p>
</li>
<li>
<p>迪米特法则(Demeter Principle)又叫<strong>最少知道原则</strong>，即一个类<strong>对自己依赖的类知道的越少越好</strong>。也就是说，对于被依赖的类不管多么复杂，都尽量将逻辑封装在类的内部。对外除了提供的 public 方法，不对外泄露任何信息</p>
</li>
<li>
<p>迪米特法则还有个更简单的定义：只与直接的朋友通信</p>
</li>
<li>
<p><strong>直接的朋友</strong>：每个对象都会与其他对象有<strong>耦合关系</strong>，只要两个对象之间有耦合关系，我们就说这两个对象之间是朋友关系。耦合的方式很多，依赖，关联，组合，聚合等。其中，我们称出现<strong>成员变量</strong>，<strong>方法参数</strong>，<strong>方法返</strong>回值中的类为直接的朋友，而出现在<strong>局部变量中的类不是直接的朋友</strong>。也就是说，陌生的类最好不要以局部变量的形式出现在类的内部。</p>
</li>
</ol>
<h3 id="应用实例"><a class="markdownIt-Anchor" href="#应用实例"></a> 应用实例</h3>
<ol>
<li>有一个学校，下属有各个学院和总部，现要求打印出学校总部员工 ID 和学院员工的 id</li>
</ol>
<p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230108204621982.png" srcset="/img/loading.gif" lazyload alt="image-20230108204621982" /></p>
<p><code>Demeter1.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.principle.demeter;<br><br><span class="hljs-keyword">import</span> java.util.ArrayList;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-comment">//客户端</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Demeter1</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">//创建了一个 SchoolManager 对象</span><br>      <span class="hljs-type">SchoolManager</span> <span class="hljs-variable">schoolManager</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SchoolManager</span>();<br>      <span class="hljs-comment">//输出学院的员工id 和  学校总部的员工信息</span><br>      schoolManager.printAllEmployee(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CollegeManager</span>());<br><br>   &#125;<br><br>&#125;<br><br><br><span class="hljs-comment">//学校总部员工类</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Employee</span> &#123;<br>   <span class="hljs-keyword">private</span> String id;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(String id)</span> &#123;<br>      <span class="hljs-built_in">this</span>.id = id;<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> id;<br>   &#125;<br>&#125;<br><br><br><span class="hljs-comment">//学院的员工类</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">CollegeEmployee</span> &#123;<br>   <span class="hljs-keyword">private</span> String id;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(String id)</span> &#123;<br>      <span class="hljs-built_in">this</span>.id = id;<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> id;<br>   &#125;<br>&#125;<br><br><br><span class="hljs-comment">//管理学院员工的管理类</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">CollegeManager</span> &#123;<br>   <span class="hljs-comment">//返回学院的所有员工</span><br>   <span class="hljs-keyword">public</span> List&lt;CollegeEmployee&gt; <span class="hljs-title function_">getAllEmployee</span><span class="hljs-params">()</span> &#123;<br>      List&lt;CollegeEmployee&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;CollegeEmployee&gt;();<br>      <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123; <span class="hljs-comment">//这里我们增加了10个员工到 list</span><br>         <span class="hljs-type">CollegeEmployee</span> <span class="hljs-variable">emp</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CollegeEmployee</span>();<br>         emp.setId(<span class="hljs-string">&quot;学院员工id= &quot;</span> + i);<br>         list.add(emp);<br>      &#125;<br>      <span class="hljs-keyword">return</span> list;<br>   &#125;<br>&#125;<br><br><span class="hljs-comment">//学校管理类</span><br><br><span class="hljs-comment">//分析 SchoolManager 类的直接朋友类有哪些 Employee、CollegeManager</span><br><span class="hljs-comment">//CollegeEmployee 不是 直接朋友 而是一个陌生类，这样违背了 迪米特法则 </span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SchoolManager</span> &#123;<br>   <span class="hljs-comment">//返回学校总部的员工</span><br>   <span class="hljs-keyword">public</span> List&lt;Employee&gt; <span class="hljs-title function_">getAllEmployee</span><span class="hljs-params">()</span> &#123;<br>      List&lt;Employee&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;Employee&gt;();<br>      <br>      <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) &#123; <span class="hljs-comment">//这里我们增加了5个员工到 list</span><br>         <span class="hljs-type">Employee</span> <span class="hljs-variable">emp</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Employee</span>();<br>         emp.setId(<span class="hljs-string">&quot;学校总部员工id= &quot;</span> + i);<br>         list.add(emp);<br>      &#125;<br>      <span class="hljs-keyword">return</span> list;<br>   &#125;<br><br>   <span class="hljs-comment">//该方法完成输出学校总部和学院员工信息(id)</span><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">printAllEmployee</span><span class="hljs-params">(CollegeManager sub)</span> &#123;<br>      <br>      <span class="hljs-comment">//分析问题</span><br>      <span class="hljs-comment">//1. 这里的 CollegeEmployee 不是  SchoolManager的直接朋友</span><br>      <span class="hljs-comment">//2. CollegeEmployee 是以局部变量方式出现在 SchoolManager</span><br>      <span class="hljs-comment">//3. 违反了 迪米特法则 </span><br>      <br>      <span class="hljs-comment">//获取到学院员工</span><br>      List&lt;CollegeEmployee&gt; list1 = sub.getAllEmployee();<br>      System.out.println(<span class="hljs-string">&quot;------------学院员工------------&quot;</span>);<br>      <span class="hljs-keyword">for</span> (CollegeEmployee e : list1) &#123;<br>         System.out.println(e.getId());<br>      &#125;<br>      <span class="hljs-comment">//获取到学校总部员工</span><br>      List&lt;Employee&gt; list2 = <span class="hljs-built_in">this</span>.getAllEmployee();<br>      System.out.println(<span class="hljs-string">&quot;------------学校总部员工------------&quot;</span>);<br>      <span class="hljs-keyword">for</span> (Employee e : list2) &#123;<br>         System.out.println(e.getId());<br>      &#125;<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="应用实例改进"><a class="markdownIt-Anchor" href="#应用实例改进"></a> 应用实例改进</h3>
<p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230108204609508.png" srcset="/img/loading.gif" lazyload alt="image-20230108204609508" /></p>
<ol>
<li>
<p>前面设计的问题在于 SchoolManager 中，<strong>CollegeEmployee 类并不是 SchoolManager</strong> 类的直接朋友 (分析)</p>
</li>
<li>
<p>按照迪米特法则，应该避免类中出现这样非直接朋友关系的耦合</p>
</li>
</ol>
<p><code>Demeter1.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.principle.demeter.improve;<br><br><span class="hljs-keyword">import</span> java.util.ArrayList;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-comment">//客户端</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Demeter1</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;~~~使用迪米特法则的改进~~~&quot;</span>);<br>      <span class="hljs-comment">//创建了一个 SchoolManager 对象</span><br>      <span class="hljs-type">SchoolManager</span> <span class="hljs-variable">schoolManager</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SchoolManager</span>();<br>      <span class="hljs-comment">//输出学院的员工id 和  学校总部的员工信息</span><br>      schoolManager.printAllEmployee(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CollegeManager</span>());<br><br>   &#125;<br><br>&#125;<br><br><br><span class="hljs-comment">//学校总部员工类</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Employee</span> &#123;<br>   <span class="hljs-keyword">private</span> String id;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(String id)</span> &#123;<br>      <span class="hljs-built_in">this</span>.id = id;<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> id;<br>   &#125;<br>&#125;<br><br><br><span class="hljs-comment">//学院的员工类</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">CollegeEmployee</span> &#123;<br>   <span class="hljs-keyword">private</span> String id;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(String id)</span> &#123;<br>      <span class="hljs-built_in">this</span>.id = id;<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> id;<br>   &#125;<br>&#125;<br><br><br><span class="hljs-comment">//管理学院员工的管理类</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">CollegeManager</span> &#123;<br>   <span class="hljs-comment">//返回学院的所有员工</span><br>   <span class="hljs-keyword">public</span> List&lt;CollegeEmployee&gt; <span class="hljs-title function_">getAllEmployee</span><span class="hljs-params">()</span> &#123;<br>      List&lt;CollegeEmployee&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;CollegeEmployee&gt;();<br>      <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123; <span class="hljs-comment">//这里我们增加了10个员工到 list</span><br>         <span class="hljs-type">CollegeEmployee</span> <span class="hljs-variable">emp</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CollegeEmployee</span>();<br>         emp.setId(<span class="hljs-string">&quot;学院员工id= &quot;</span> + i);<br>         list.add(emp);<br>      &#125;<br>      <span class="hljs-keyword">return</span> list;<br>   &#125;<br>   <br>   <span class="hljs-comment">//输出学院员工的信息</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">printEmployee</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">//获取到学院员工</span><br>      List&lt;CollegeEmployee&gt; list1 = getAllEmployee();<br>      System.out.println(<span class="hljs-string">&quot;------------学院员工------------&quot;</span>);<br>      <span class="hljs-keyword">for</span> (CollegeEmployee e : list1) &#123;<br>         System.out.println(e.getId());<br>      &#125;<br>   &#125;<br>&#125;<br><br><span class="hljs-comment">//学校管理类</span><br><br><span class="hljs-comment">//分析 SchoolManager 类的直接朋友类有哪些 Employee、CollegeManager</span><br><span class="hljs-comment">//CollegeEmployee 不是 直接朋友 而是一个陌生类，这样违背了 迪米特法则 </span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SchoolManager</span> &#123;<br>   <span class="hljs-comment">//返回学校总部的员工</span><br>   <span class="hljs-keyword">public</span> List&lt;Employee&gt; <span class="hljs-title function_">getAllEmployee</span><span class="hljs-params">()</span> &#123;<br>      List&lt;Employee&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;Employee&gt;();<br>      <br>      <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) &#123; <span class="hljs-comment">//这里我们增加了5个员工到 list</span><br>         <span class="hljs-type">Employee</span> <span class="hljs-variable">emp</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Employee</span>();<br>         emp.setId(<span class="hljs-string">&quot;学校总部员工id= &quot;</span> + i);<br>         list.add(emp);<br>      &#125;<br>      <span class="hljs-keyword">return</span> list;<br>   &#125;<br><br>   <span class="hljs-comment">//该方法完成输出学校总部和学院员工信息(id)</span><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">printAllEmployee</span><span class="hljs-params">(CollegeManager sub)</span> &#123;<br>      <br>      <span class="hljs-comment">//分析问题</span><br>      <span class="hljs-comment">//1. 将输出学院的员工方法，封装到CollegeManager</span><br>      sub.printEmployee();<br>   <br>      <span class="hljs-comment">//获取到学校总部员工</span><br>      List&lt;Employee&gt; list2 = <span class="hljs-built_in">this</span>.getAllEmployee();<br>      System.out.println(<span class="hljs-string">&quot;------------学校总部员工------------&quot;</span>);<br>      <span class="hljs-keyword">for</span> (Employee e : list2) &#123;<br>         System.out.println(e.getId());<br>      &#125;<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="迪米特法则注意事项和细节"><a class="markdownIt-Anchor" href="#迪米特法则注意事项和细节"></a> 迪米特法则注意事项和细节</h3>
<ol>
<li>
<p>迪米特法则的核心是降低类之间的耦合</p>
</li>
<li>
<p>但是注意：由于每个类都减少了不必要的依赖，因此迪米特法则只是要求降低类间(对象间)耦合关系， 并不是要求完全没有依赖关系</p>
</li>
</ol>
<h2 id="6-合成复用原则composite-reuse-principle"><a class="markdownIt-Anchor" href="#6-合成复用原则composite-reuse-principle"></a> <strong>6、合成复用原则（Composite Reuse Principle）</strong></h2>
<p>合成复用原则是指：尽量使用合成/聚合的方式，而不是使用继承。</p>
<ol>
<li>
<p>找出应用中可能需要变化之处，把它们独立出来，不要和那些不需要变化的代码混在一起。</p>
</li>
<li>
<p>针对接口编程，而不是针对实现编程。</p>
</li>
<li>
<p>为了交互对象之间的<strong>松耦合设计而努</strong>力</p>
</li>
</ol>
<p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230108204802649.png" srcset="/img/loading.gif" lazyload alt="image-20230108204802649" /></p>
<h2 id="7-单一职责原则single-principle"><a class="markdownIt-Anchor" href="#7-单一职责原则single-principle"></a> <strong>7、单一职责原则（Single Principle）</strong></h2>
<p>对类来说的，<strong>即一个类应该只负责一项职责</strong>。如类 A 负责两个不同职责：职责 1，职责 2。当职责 1 需求变更而改变 A 时，可能造成职责 2 执行错误，所以需要将类 A 的粒度分解为 A1，A2</p>
<p><code>SingleResponsibility1.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.principle.singleresponsibility;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SingleResponsibility1</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-type">Vehicle</span> <span class="hljs-variable">vehicle</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vehicle</span>();<br>      vehicle.run(<span class="hljs-string">&quot;摩托车&quot;</span>);<br>      vehicle.run(<span class="hljs-string">&quot;汽车&quot;</span>);<br>      vehicle.run(<span class="hljs-string">&quot;飞机&quot;</span>);<br>   &#125;<br><br>&#125;<br><br><span class="hljs-comment">// 交通工具类</span><br><span class="hljs-comment">// 方式1</span><br><span class="hljs-comment">// 1. 在方式1 的run方法中，违反了单一职责原则</span><br><span class="hljs-comment">// 2. 解决的方案非常的简单，根据交通工具运行方法不同，分解成不同类即可</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Vehicle</span> &#123;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">(String vehicle)</span> &#123;<br>      System.out.println(vehicle + <span class="hljs-string">&quot; 在公路上运行....&quot;</span>);<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>SingleResponsibility2.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.principle.singleresponsibility;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SingleResponsibility2</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-type">RoadVehicle</span> <span class="hljs-variable">roadVehicle</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RoadVehicle</span>();<br>      roadVehicle.run(<span class="hljs-string">&quot;摩托车&quot;</span>);<br>      roadVehicle.run(<span class="hljs-string">&quot;汽车&quot;</span>);<br>      <br>      <span class="hljs-type">AirVehicle</span> <span class="hljs-variable">airVehicle</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AirVehicle</span>();<br>      <br>      airVehicle.run(<span class="hljs-string">&quot;飞机&quot;</span>);<br>   &#125;<br><br>&#125;<br><br><span class="hljs-comment">//方案2的分析</span><br><span class="hljs-comment">//1. 遵守单一职责原则</span><br><span class="hljs-comment">//2. 但是这样做的改动很大，即将类分解，同时修改客户端</span><br><span class="hljs-comment">//3. 改进：直接修改Vehicle 类，改动的代码会比较少=&gt;方案3</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">RoadVehicle</span> &#123;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">(String vehicle)</span> &#123;<br>      System.out.println(vehicle + <span class="hljs-string">&quot;公路运行&quot;</span>);<br>   &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">AirVehicle</span> &#123;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">(String vehicle)</span> &#123;<br>      System.out.println(vehicle + <span class="hljs-string">&quot;天空运行&quot;</span>);<br>   &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">WaterVehicle</span> &#123;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">(String vehicle)</span> &#123;<br>      System.out.println(vehicle + <span class="hljs-string">&quot;水中运行&quot;</span>);<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>SingleResponsibility3.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.principle.singleresponsibility;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SingleResponsibility3</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-type">Vehicle2</span> <span class="hljs-variable">vehicle2</span>  <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vehicle2</span>();<br>      vehicle2.run(<span class="hljs-string">&quot;汽车&quot;</span>);<br>      vehicle2.runWater(<span class="hljs-string">&quot;轮船&quot;</span>);<br>      vehicle2.runAir(<span class="hljs-string">&quot;飞机&quot;</span>);<br>   &#125;<br><br>&#125;<br><br><br><span class="hljs-comment">//方式3的分析</span><br><span class="hljs-comment">//1. 这种修改方法没有对原来的类做大的修改，只是增加方法</span><br><span class="hljs-comment">//2. 这里虽然没有在类这个级别上遵守单一职责原则，但是在方法级别上，仍然是遵守单一职责</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Vehicle2</span> &#123;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">(String vehicle)</span> &#123;<br>      <span class="hljs-comment">//处理</span><br>      <br>      System.out.println(vehicle + <span class="hljs-string">&quot; 在公路上运行....&quot;</span>);<br>      <br>   &#125;<br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">runAir</span><span class="hljs-params">(String vehicle)</span> &#123;<br>      System.out.println(vehicle + <span class="hljs-string">&quot; 在天空上运行....&quot;</span>);<br>   &#125;<br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">runWater</span><span class="hljs-params">(String vehicle)</span> &#123;<br>      System.out.println(vehicle + <span class="hljs-string">&quot; 在水中行....&quot;</span>);<br>   &#125;<br>   <br>   <span class="hljs-comment">//方法2.</span><br>   <span class="hljs-comment">//..</span><br>   <span class="hljs-comment">//..</span><br>   <br>   <span class="hljs-comment">//...</span><br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="单一职责原则注意事项和细节"><a class="markdownIt-Anchor" href="#单一职责原则注意事项和细节"></a> 单一职责原则注意事项和细节</h3>
<ol>
<li>
<p>降低类的复杂度，一个类只负责一项职责。</p>
</li>
<li>
<p>高类的可读性，可维护性</p>
</li>
<li>
<p>降低变更引起的风险</p>
</li>
<li>
<p>通常情况下，我们应当遵守单一职责原则，只有逻辑足够简单，才可以在代码级违反单一职责原则；只有类中方法数量足够少，可以在方法级别保持单一职责原则</p>
</li>
</ol>
<h1 id="单例模式"><a class="markdownIt-Anchor" href="#单例模式"></a> 🌕单例模式</h1>
<p>最为重要</p>
<p>单例模式（Singleton Pattern）是 Java 中最简单的设计模式之一。这种类型的设计模式属于创建型模式，它提供了一种创建对象的最佳方式。</p>
<p>这种模式涉及到一个单一的类，该类负责创建自己的对象，同时确保只有单个对象被创建。这个类提供了一种访问其唯一的对象的方式，可以直接访问，不需要实例化该类的对象。</p>
<p><strong>注意：</strong></p>
<ul>
<li>1、单例类只能有一个实例。</li>
<li>2、单例类必须自己创建自己的唯一实例。</li>
<li>3、单例类必须给所有其他对象提供这一实例。</li>
</ul>
<h2 id="介绍"><a class="markdownIt-Anchor" href="#介绍"></a> 介绍</h2>
<p><strong>意图：</strong> 保证一个类仅有一个实例，并提供一个访问它的全局访问点。</p>
<p><strong>主要解决：</strong> 一个全局使用的类频繁地创建与销毁。</p>
<p><strong>何时使用：</strong> 当您想控制实例数目，节省系统资源的时候。</p>
<p><strong>如何解决：</strong> 判断系统是否已经有这个单例，如果有则返回，如果没有则创建。</p>
<p><strong>关键代码：</strong> 构造函数是私有的。</p>
<p><strong>应用实例：</strong></p>
<ul>
<li>1、一个班级只有一个班主任。</li>
<li>2、Windows 是多进程多线程的，在操作一个文件的时候，就不可避免地出现多个进程或线程同时操作一个文件的现象，所以所有文件的处理必须通过唯一的实例来进行。</li>
<li>3、一些设备管理器常常设计为单例模式，比如一个电脑有两台打印机，在输出的时候就要处理不能两台打印机打印同一个文件。</li>
</ul>
<p><strong>优点：</strong></p>
<ul>
<li>1、在内存里只有一个实例，减少了内存的开销，尤其是频繁的创建和销毁实例（比如管理学院首页页面缓存）。</li>
<li>2、避免对资源的多重占用（比如写文件操作）。</li>
</ul>
<p><strong>缺点：</strong> 没有接口，不能继承，与单一职责原则冲突，一个类应该只关心内部逻辑，而不关心外面怎么样来实例化。</p>
<p><strong>使用场景：</strong></p>
<ul>
<li>1、要求生产唯一序列号。</li>
<li>2、WEB 中的计数器，不用每次刷新都在数据库里加一次，用单例先缓存起来。</li>
<li>3、创建的一个对象需要消耗的资源过多，比如 I/O 与数据库的连接等。</li>
</ul>
<p><strong>注意事项：</strong> getInstance() 方法中需要使用同步锁 synchronized (Singleton.class) 防止多线程同时进入造成<br />
instance 被多次实例化。</p>
<h2 id="实现"><a class="markdownIt-Anchor" href="#实现"></a> 实现</h2>
<p>我们将创建一个 <em>SingleObject</em> 类。 <em>SingleObject</em> 类有它的私有构造函数和本身的一个静态实例。</p>
<p><em>SingleObject</em> 类提供了一个静态方法，供外界获取它的静态实例。 <em>SingletonPatternDemo</em> 类使用<br />
<em>SingleObject</em> 类来获取 <em>SingleObject</em> 对象。</p>
<p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/62576915-36E0-4B67-B078-704699CA980A.jpg" srcset="/img/loading.gif" lazyload alt="单例模式的 UML 图" /></p>
<h3 id="步骤-1"><a class="markdownIt-Anchor" href="#步骤-1"></a> 步骤 1</h3>
<p>创建一个 Singleton 类。</p>
<p>SingleObject.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SingleObject</span> &#123;<br> <br>   <span class="hljs-comment">//创建 SingleObject 的一个对象</span><br>   <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">SingleObject</span> <span class="hljs-variable">instance</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SingleObject</span>();<br> <br>   <span class="hljs-comment">//让构造函数为 private，这样该类就不会被实例化</span><br>   <span class="hljs-keyword">private</span> <span class="hljs-title function_">SingleObject</span><span class="hljs-params">()</span>&#123;&#125;<br> <br>   <span class="hljs-comment">//获取唯一可用的对象</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SingleObject <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span>&#123;<br>      <span class="hljs-keyword">return</span> instance;<br>   &#125;<br> <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">showMessage</span><span class="hljs-params">()</span>&#123;<br>      System.out.println(<span class="hljs-string">&quot;Hello World!&quot;</span>);<br>   &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>
<h3 id="步骤-2"><a class="markdownIt-Anchor" href="#步骤-2"></a> 步骤 2</h3>
<p>从 singleton 类获取唯一的对象。</p>
<p>SingletonPatternDemo.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SingletonPatternDemo</span> &#123;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br> <br>      <span class="hljs-comment">//不合法的构造函数</span><br>      <span class="hljs-comment">//编译时错误：构造函数 SingleObject() 是不可见的</span><br>      <span class="hljs-comment">//SingleObject object = new SingleObject();</span><br> <br>      <span class="hljs-comment">//获取唯一可用的对象</span><br>      <span class="hljs-type">SingleObject</span> <span class="hljs-variable">object</span> <span class="hljs-operator">=</span> SingleObject.getInstance();<br> <br>      <span class="hljs-comment">//显示消息</span><br>      object.showMessage();<br>   &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>
<h3 id="步骤-3"><a class="markdownIt-Anchor" href="#步骤-3"></a> 步骤 3</h3>
<p>执行程序，输出结果：</p>
<p>​</p>
<pre><code class="hljs">Hello World!
</code></pre>
<p>​</p>
<h2 id="单例模式的几种实现方式"><a class="markdownIt-Anchor" href="#单例模式的几种实现方式"></a> 单例模式的几种实现方式</h2>
<p>单例模式的实现有多种方式，如下所示：</p>
<h3 id="1-懒汉式线程不安全"><a class="markdownIt-Anchor" href="#1-懒汉式线程不安全"></a> 1、懒汉式，线程不安全</h3>
<p><strong>是否 Lazy 初始化：</strong> 是</p>
<p><strong>是否多线程安全：</strong> 否</p>
<p><strong>实现难度：</strong> 易</p>
<p><strong>描述：</strong> 这种方式是最基本的实现方式，这种实现最大的问题就是不支持多线程。因为没有加锁 synchronized，所以严格意义上它并不算单例模式。<br />
这种方式 lazy loading 很明显，不要求线程安全，在多线程不能正常工作。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Singleton</span> &#123;  <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Singleton instance;  <br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Singleton</span> <span class="hljs-params">()</span>&#123;&#125;  <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Singleton <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> &#123;  <br>        <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) &#123;  <br>            instance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Singleton</span>();  <br>        &#125;  <br>        <span class="hljs-keyword">return</span> instance;  <br>    &#125;  <br>&#125;<br><br></code></pre></td></tr></table></figure>
<p><strong>接下来介绍的几种实现方式都支持多线程，但是在性能上有所差异。</strong></p>
<h3 id="2-懒汉式线程安全"><a class="markdownIt-Anchor" href="#2-懒汉式线程安全"></a> 2、懒汉式，线程安全</h3>
<p><strong>是否 Lazy 初始化：</strong> 是</p>
<p><strong>是否多线程安全：</strong> 是</p>
<p><strong>实现难度：</strong> 易</p>
<p><strong>描述：</strong> 这种方式具备很好的 lazy loading，能够在多线程中很好的工作，但是，效率很低，99% 情况下不需要同步。<br />
优点：第一次调用才初始化，避免内存浪费。<br />
缺点：必须加锁 synchronized 才能保证单例，但加锁会影响效率。<br />
getInstance() 的性能对应用程序不是很关键（该方法使用不太频繁）。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Singleton</span> &#123;  <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Singleton instance;  <br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Singleton</span> <span class="hljs-params">()</span>&#123;&#125;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">synchronized</span> Singleton <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> &#123;  <br>        <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) &#123;  <br>            instance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Singleton</span>();  <br>        &#125;  <br>        <span class="hljs-keyword">return</span> instance;  <br>    &#125;  <br>&#125;<br><br></code></pre></td></tr></table></figure>
<h3 id="3-饿汉式"><a class="markdownIt-Anchor" href="#3-饿汉式"></a> 3、饿汉式</h3>
<p><strong>是否 Lazy 初始化：</strong> 否</p>
<p><strong>是否多线程安全：</strong> 是</p>
<p><strong>实现难度：</strong> 易</p>
<p><strong>描述：</strong> 这种方式比较常用，但容易产生垃圾对象。<br />
优点：没有加锁，执行效率会提高。<br />
缺点：类加载时就初始化，浪费内存。<br />
它基于 classloader 机制避免了多线程的同步问题，不过，instance<br />
在类装载时就实例化，虽然导致类装载的原因有很多种，在单例模式中大多数都是调用 getInstance 方法，但是也不能确定有其他的方式（或者其他的静态方法）导致类装载，这时候初始化 instance 显然没有达到 lazy loading 的效果。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Singleton</span> &#123;  <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">Singleton</span> <span class="hljs-variable">instance</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Singleton</span>();  <br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Singleton</span> <span class="hljs-params">()</span>&#123;&#125;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Singleton <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> &#123;  <br>    <span class="hljs-keyword">return</span> instance;  <br>    &#125;  <br>&#125;<br><br></code></pre></td></tr></table></figure>
<h3 id="4-双检锁双重校验锁dcl即-double-checked-locking"><a class="markdownIt-Anchor" href="#4-双检锁双重校验锁dcl即-double-checked-locking"></a> 4、双检锁/双重校验锁（DCL，即 double-checked locking）</h3>
<p><strong>JDK 版本：</strong> JDK1.5 起</p>
<p><strong>是否 Lazy 初始化：</strong> 是</p>
<p><strong>是否多线程安全：</strong> 是</p>
<p><strong>实现难度：</strong> 较复杂</p>
<p><strong>描述：</strong> 这种方式采用双锁机制，安全且在多线程情况下能保持高性能。<br />
getInstance() 的性能对应用程序很关键。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Singleton</span> &#123;  <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-keyword">static</span> Singleton singleton;  <br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Singleton</span> <span class="hljs-params">()</span>&#123;&#125;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Singleton <span class="hljs-title function_">getSingleton</span><span class="hljs-params">()</span> &#123;  <br>    <span class="hljs-keyword">if</span> (singleton == <span class="hljs-literal">null</span>) &#123;  <br>        <span class="hljs-keyword">synchronized</span> (Singleton.class) &#123;  <br>            <span class="hljs-keyword">if</span> (singleton == <span class="hljs-literal">null</span>) &#123;  <br>                singleton = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Singleton</span>();  <br>            &#125;  <br>        &#125;  <br>    &#125;  <br>    <span class="hljs-keyword">return</span> singleton;  <br>    &#125;  <br>&#125;<br><br></code></pre></td></tr></table></figure>
<h3 id="5-登记式静态内部类"><a class="markdownIt-Anchor" href="#5-登记式静态内部类"></a> 5、登记式/静态内部类</h3>
<p><strong>是否 Lazy 初始化：</strong> 是</p>
<p><strong>是否多线程安全：</strong> 是</p>
<p><strong>实现难度：</strong> 一般</p>
<p><strong>描述：</strong><br />
这种方式能达到双检锁方式一样的功效，但实现更简单。对静态域使用延迟初始化，应使用这种方式而不是双检锁方式。这种方式只适用于静态域的情况，双检锁方式可在实例域需要延迟初始化时使用。<br />
这种方式同样利用了 classloader 机制来保证初始化 instance 时只有一个线程，它跟第 3 种方式不同的是：第 3 种方式只要Singleton 类被装载了，那么 instance 就会被实例化（没有达到 lazy loading 效果），而这种方式是 Singleton类被装载了，instance 不一定被初始化。因为 SingletonHolder 类没有被主动使用，只有通过显式调用 getInstance方法时，才会显式装载 SingletonHolder 类，从而实例化 instance。想象一下，如果实例化 instance很消耗资源，所以想让它延迟加载，另外一方面，又不希望在 Singleton 类加载时就实例化，因为不能确保 Singleton类还可能在其他的地方被主动使用从而被加载，那么这个时候实例化 instance 显然是不合适的。这个时候，这种方式相比第 3 种方式就显得很合理。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Singleton</span> &#123;  <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SingletonHolder</span> &#123;  <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Singleton</span> <span class="hljs-variable">INSTANCE</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Singleton</span>();  <br>    &#125;  <br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Singleton</span> <span class="hljs-params">()</span>&#123;&#125;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Singleton <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> &#123;  <br>        <span class="hljs-keyword">return</span> SingletonHolder.INSTANCE;  <br>    &#125;  <br>&#125;<br><br></code></pre></td></tr></table></figure>
<h3 id="6-枚举"><a class="markdownIt-Anchor" href="#6-枚举"></a> 6、枚举</h3>
<p><strong>JDK 版本：</strong> JDK1.5 起</p>
<p><strong>是否 Lazy 初始化：</strong> 否</p>
<p><strong>是否多线程安全：</strong> 是</p>
<p><strong>实现难度：</strong> 易</p>
<p><strong>描述：</strong> 这种实现方式还没有被广泛采用，但这是实现单例模式的最佳方法。它更简洁，自动支持序列化机制，绝对防止多次实例化。<br />
这种方式是 Effective Java 作者 Josh Bloch提倡的方式，它不仅能避免多线程同步问题，而且还自动支持序列化机制，防止反序列化重新创建新的对象，绝对防止多次实例化。不过，由于 JDK1.5 之后才加入enum 特性，用这种方式写不免让人感觉生疏，在实际工作中，也很少用。<br />
不能通过 reflection attack 来调用私有构造方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">Singleton</span> &#123;  <br>    INSTANCE;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">whateverMethod</span><span class="hljs-params">()</span> &#123;  <br>    &#125;  <br>&#125;<br><br></code></pre></td></tr></table></figure>
<p><strong>经验之谈：</strong> 一般情况下，不建议使用第 1 种和第 2 种懒汉方式，建议使用第 3 种饿汉方式。只有在要明确实现 lazy loading效果时，才会使用第 5 种登记方式。如果涉及到反序列化创建对象时，可以尝试使用第 6 种枚举方式。如果有其他特殊的需求，可以考虑使用第 4 种双检锁方式。</p>
<h1 id="工厂模式"><a class="markdownIt-Anchor" href="#工厂模式"></a> 🌕工厂模式</h1>
<p>工厂模式（Factory Pattern）是 Java 中最常用的设计模式之一。这种类型的设计模式属于创建型模式，它提供了一种创建对象的最佳方式。</p>
<p>在工厂模式中，我们在创建对象时不会对客户端暴露创建逻辑，并且是通过使用一个共同的接口来指向新创建的对象。</p>
<h2 id="介绍-2"><a class="markdownIt-Anchor" href="#介绍-2"></a> 介绍</h2>
<p><strong>意图：</strong> 定义一个创建对象的接口，让其子类自己决定实例化哪一个工厂类，工厂模式使其创建过程延迟到子类进行。</p>
<p><strong>主要解决：</strong> 主要解决接口选择的问题。</p>
<p><strong>何时使用：</strong> 我们明确地计划不同条件下创建不同实例时。</p>
<p><strong>如何解决：</strong> 让其子类实现工厂接口，返回的也是一个抽象的产品。</p>
<p><strong>关键代码：</strong> 创建过程在其子类执行。</p>
<p><strong>应用实例：</strong> 1、您需要一辆汽车，可以直接从工厂里面提货，而不用去管这辆汽车是怎么做出来的，以及这个汽车里面的具体实现。 2、Hibernate换数据库只需换方言和驱动就可以。</p>
<p><strong>优点：</strong> 1、一个调用者想创建一个对象，只要知道其名称就可以了。 2、扩展性高，如果想增加一个产品，只要扩展一个工厂类就可以。<br />
3、屏蔽产品的具体实现，调用者只关心产品的接口。</p>
<p><strong>缺点：</strong><br />
每次增加一个产品时，都需要增加一个具体类和对象实现工厂，使得系统中类的个数成倍增加，在一定程度上增加了系统的复杂度，同时也增加了系统具体类的依赖。这并不是什么好事。</p>
<p><strong>使用场景：</strong></p>
<p>1、日志记录器：记录可能记录到本地硬盘、系统事件、远程服务器等，用户可以选择记录日志到什么地方。<br />
2、数据库访问，当用户不知道最后系统采用哪一类数据库，以及数据库可能有变化时。<br />
3、设计一个连接服务器的框架，需要三个协议，“POP3”、“IMAP”、“HTTP”，可以把这三个作为产品类，共同实现一个接口。</p>
<p><strong>注意事项：</strong><br />
作为一种创建类模式，在任何需要生成复杂对象的地方，都可以使用工厂方法模式。有一点需要注意的地方就是复杂对象适合使用工厂模式，而简单对象，特别是只需要通过new 就可以完成创建的对象，无需使用工厂模式。如果使用工厂模式，就需要引入一个工厂类，会增加系统的复杂度。</p>
<h2 id="实现四种方式"><a class="markdownIt-Anchor" href="#实现四种方式"></a> 实现四种方式</h2>
<p>​    看一个披萨的项目：要便于披萨种类的扩展，要便于维护</p>
<ol>
<li>披萨的种类很多(比如 GreekPizz、CheesePizz 等)</li>
<li>披萨的制作有 prepare，bake, cut, box</li>
<li>完成披萨店订购功能。</li>
</ol>
<h3 id="使用传统的方式来完成"><a class="markdownIt-Anchor" href="#使用传统的方式来完成"></a> 使用传统的方式来完成</h3>
<ol>
<li>思路分析(类图)</li>
</ol>
<p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221224163121334.png" srcset="/img/loading.gif" lazyload alt="image-20221224163121334" /></p>
<p>编写 OrderPizza.java 去订购需要的各种 Pizza</p>
<p>代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderPizza</span> &#123;<br>    <span class="hljs-comment">//	 构造器</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-title function_">OrderPizza</span><span class="hljs-params">()</span> &#123;<br>		<span class="hljs-type">Pizza</span> <span class="hljs-variable">pizza</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>		String orderType; <span class="hljs-comment">// 订购披萨的类型</span><br>		<span class="hljs-keyword">do</span> &#123;<br>			orderType = getType();<br>			<span class="hljs-keyword">if</span> (orderType.equals(<span class="hljs-string">&quot;greek&quot;</span>)) &#123;<br>				pizza = <span class="hljs-keyword">new</span> <span class="hljs-title class_">GreekPizza</span>();<br>				pizza.setName(<span class="hljs-string">&quot; 希腊披萨 &quot;</span>);<br>			&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (orderType.equals(<span class="hljs-string">&quot;cheese&quot;</span>)) &#123;<br>				pizza = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CheesePizza</span>();<br>				pizza.setName(<span class="hljs-string">&quot; 奶酪披萨 &quot;</span>);<br>			&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (orderType.equals(<span class="hljs-string">&quot;pepper&quot;</span>)) &#123;<br>				pizza = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PepperPizza</span>();<br>				pizza.setName(<span class="hljs-string">&quot;胡椒披萨&quot;</span>);<br>			&#125; <span class="hljs-keyword">else</span> &#123;<br>				<span class="hljs-keyword">break</span>;<br>			&#125;<br>			<span class="hljs-comment">//输出pizza 制作过程</span><br>			pizza.prepare();<br>			pizza.bake();<br>			pizza.cut();<br>			pizza.box();<br><br>		&#125; <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>);<br>	&#125;<br>    <span class="hljs-comment">// 写一个方法，可以获取客户希望订购的披萨种类</span><br>	<span class="hljs-keyword">private</span> String <span class="hljs-title function_">getType</span><span class="hljs-params">()</span> &#123;<br>		<span class="hljs-keyword">try</span> &#123;<br>			<span class="hljs-type">BufferedReader</span> <span class="hljs-variable">strin</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedReader</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InputStreamReader</span>(System.in));<br>			System.out.println(<span class="hljs-string">&quot;input pizza 种类:&quot;</span>);<br>			<span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> strin.readLine();<br>			<span class="hljs-keyword">return</span> str;<br>		&#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>			e.printStackTrace();<br>			<span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>;<br>		&#125;<br>	&#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure>
<ol>
<li>
<p>优点是比较好理解，简单易操作。</p>
</li>
<li>
<p>缺点是违反了设计模式的 <strong>ocp 原则</strong>，即对扩展开放，对修改关闭。即当我们给类增加新功能的时候，尽量不修改代码，或者尽可能少修改代码.</p>
</li>
<li>
<p>比如我们这时<strong>要新增加一个 Pizza 的种类(Pepper 披萨)</strong>，我们需要做如下修改.</p>
</li>
</ol>
<p>如果我们增加一个 Pizza 类，只要是订购 Pizza 的代码都需要修改.</p>
<p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221224163539743.png" srcset="/img/loading.gif" lazyload alt="image-20221224163539743" /></p>
<ol start="4">
<li>改进的思路分析</li>
</ol>
<p>分析：修改代码可以接受，但是如果我们在其它的地方也有创建 Pizza 的代码，就意味着，也需要修改，而创建 Pizza的代码，往往有多处。</p>
<p>思路：<strong>把创建 Pizza 对象封装到一个类中，这样我们有新的 Pizza 种类时，只需要修改该类就可</strong>，其它有创建到 Pizza对象的代码就不需要修改了.-&gt; <strong>简单工厂</strong>模式</p>
<h3 id="使用简单工厂模式"><a class="markdownIt-Anchor" href="#使用简单工厂模式"></a> 使用简单工厂模式</h3>
<p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221224163606286.png" srcset="/img/loading.gif" lazyload alt="image-20221224163606286" /></p>
<p><strong>代码</strong></p>
<p><code>SimpleFactory</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-keyword">package</span> io.xtwoy.factory.simplefactory.pizzastore.order;<br><br><span class="hljs-keyword">import</span> io.xtwoy.factory.simplefactory.pizzastore.pizza.CheesePizza;<br><span class="hljs-keyword">import</span> io.xtwoy.factory.simplefactory.pizzastore.pizza.GreekPizza;<br><span class="hljs-keyword">import</span> io.xtwoy.factory.simplefactory.pizzastore.pizza.PepperPizza;<br><span class="hljs-keyword">import</span> io.xtwoy.factory.simplefactory.pizzastore.pizza.Pizza;<br><br><span class="hljs-comment">//简单工厂类</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleFactory</span> &#123;<br><br>   <span class="hljs-comment">//更加orderType 返回对应的Pizza 对象</span><br>   <span class="hljs-keyword">public</span> Pizza <span class="hljs-title function_">createPizza</span><span class="hljs-params">(String orderType)</span> &#123;<br><br>      <span class="hljs-type">Pizza</span> <span class="hljs-variable">pizza</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br><br>      System.out.println(<span class="hljs-string">&quot;使用简单工厂模式&quot;</span>);<br>      <span class="hljs-keyword">if</span> (orderType.equals(<span class="hljs-string">&quot;greek&quot;</span>)) &#123;<br>         pizza = <span class="hljs-keyword">new</span> <span class="hljs-title class_">GreekPizza</span>();<br>         pizza.setName(<span class="hljs-string">&quot; 希腊披萨 &quot;</span>);<br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (orderType.equals(<span class="hljs-string">&quot;cheese&quot;</span>)) &#123;<br>         pizza = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CheesePizza</span>();<br>         pizza.setName(<span class="hljs-string">&quot; 奶酪披萨 &quot;</span>);<br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (orderType.equals(<span class="hljs-string">&quot;pepper&quot;</span>)) &#123;<br>         pizza = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PepperPizza</span>();<br>         pizza.setName(<span class="hljs-string">&quot;胡椒披萨&quot;</span>);<br>      &#125;<br>      <br>      <span class="hljs-keyword">return</span> pizza;<br>   &#125;<br>   <br>   <span class="hljs-comment">//简单工厂模式 也叫 静态工厂模式 </span><br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Pizza <span class="hljs-title function_">createPizza2</span><span class="hljs-params">(String orderType)</span> &#123;<br>      <span class="hljs-type">Pizza</span> <span class="hljs-variable">pizza</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br><br>      System.out.println(<span class="hljs-string">&quot;使用简单工厂模式2&quot;</span>);<br>      <span class="hljs-keyword">if</span> (orderType.equals(<span class="hljs-string">&quot;greek&quot;</span>)) &#123;<br>         pizza = <span class="hljs-keyword">new</span> <span class="hljs-title class_">GreekPizza</span>();<br>         pizza.setName(<span class="hljs-string">&quot; 希腊披萨 &quot;</span>);<br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (orderType.equals(<span class="hljs-string">&quot;cheese&quot;</span>)) &#123;<br>         pizza = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CheesePizza</span>();<br>         pizza.setName(<span class="hljs-string">&quot; 奶酪披萨 &quot;</span>);<br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (orderType.equals(<span class="hljs-string">&quot;pepper&quot;</span>)) &#123;<br>         pizza = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PepperPizza</span>();<br>         pizza.setName(<span class="hljs-string">&quot;胡椒披萨&quot;</span>);<br>      &#125;<br>      <span class="hljs-keyword">return</span> pizza;<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>OrderPizza</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.factory.simplefactory.pizzastore.order;<br><br><span class="hljs-keyword">import</span> java.io.BufferedReader;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.io.InputStreamReader;<br><br><br><span class="hljs-keyword">import</span> io.xtwoy.factory.simplefactory.pizzastore.pizza.CheesePizza;<br><span class="hljs-keyword">import</span> io.xtwoy.factory.simplefactory.pizzastore.pizza.GreekPizza;<br><span class="hljs-keyword">import</span> io.xtwoy.factory.simplefactory.pizzastore.pizza.PepperPizza;<br><span class="hljs-keyword">import</span> io.xtwoy.factory.simplefactory.pizzastore.pizza.Pizza;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderPizza</span> &#123;<br><br><span class="hljs-comment">////    构造器</span><br><span class="hljs-comment">// public OrderPizza() &#123;</span><br><span class="hljs-comment">//    Pizza pizza = null;</span><br><span class="hljs-comment">//    String orderType; // 订购披萨的类型</span><br><span class="hljs-comment">//    do &#123;</span><br><span class="hljs-comment">//       orderType = getType();</span><br><span class="hljs-comment">//       if (orderType.equals(&quot;greek&quot;)) &#123;</span><br><span class="hljs-comment">//          pizza = new GreekPizza();</span><br><span class="hljs-comment">//          pizza.setName(&quot; 希腊披萨 &quot;);</span><br><span class="hljs-comment">//       &#125; else if (orderType.equals(&quot;cheese&quot;)) &#123;</span><br><span class="hljs-comment">//          pizza = new CheesePizza();</span><br><span class="hljs-comment">//          pizza.setName(&quot; 奶酪披萨 &quot;);</span><br><span class="hljs-comment">//       &#125; else if (orderType.equals(&quot;pepper&quot;)) &#123;</span><br><span class="hljs-comment">//          pizza = new PepperPizza();</span><br><span class="hljs-comment">//          pizza.setName(&quot;胡椒披萨&quot;);</span><br><span class="hljs-comment">//       &#125; else &#123;</span><br><span class="hljs-comment">//          break;</span><br><span class="hljs-comment">//       &#125;</span><br><span class="hljs-comment">//       //输出pizza 制作过程</span><br><span class="hljs-comment">//       pizza.prepare();</span><br><span class="hljs-comment">//       pizza.bake();</span><br><span class="hljs-comment">//       pizza.cut();</span><br><span class="hljs-comment">//       pizza.box();</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">//    &#125; while (true);</span><br><span class="hljs-comment">// &#125;</span><br><br>   <span class="hljs-comment">//定义一个简单工厂对象</span><br>   SimpleFactory simpleFactory;<br>   <span class="hljs-type">Pizza</span> <span class="hljs-variable">pizza</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>   <br>   <span class="hljs-comment">//构造器</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">OrderPizza</span><span class="hljs-params">(SimpleFactory simpleFactory)</span> &#123;<br>      setFactory(simpleFactory);<br>   &#125;<br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setFactory</span><span class="hljs-params">(SimpleFactory simpleFactory)</span> &#123;<br>      <span class="hljs-type">String</span> <span class="hljs-variable">orderType</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&quot;</span>; <span class="hljs-comment">//用户输入的</span><br>      <br>      <span class="hljs-built_in">this</span>.simpleFactory = simpleFactory; <span class="hljs-comment">//设置简单工厂对象</span><br>      <br>      <span class="hljs-keyword">do</span> &#123;<br>         orderType = getType(); <br>         pizza = <span class="hljs-built_in">this</span>.simpleFactory.createPizza(orderType);<br>         <br>         <span class="hljs-comment">//输出pizza</span><br>         <span class="hljs-keyword">if</span>(pizza != <span class="hljs-literal">null</span>) &#123; <span class="hljs-comment">//订购成功</span><br>            pizza.prepare();<br>            pizza.bake();<br>            pizza.cut();<br>            pizza.box();<br>         &#125; <span class="hljs-keyword">else</span> &#123;<br>            System.out.println(<span class="hljs-string">&quot; 订购披萨失败 &quot;</span>);<br>            <span class="hljs-keyword">break</span>;<br>         &#125;<br>      &#125;<span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>);<br>   &#125;<br>   <br>   <span class="hljs-comment">// 写一个方法，可以获取客户希望订购的披萨种类</span><br>   <span class="hljs-keyword">private</span> String <span class="hljs-title function_">getType</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">try</span> &#123;<br>         <span class="hljs-type">BufferedReader</span> <span class="hljs-variable">strin</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedReader</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InputStreamReader</span>(System.in));<br>         System.out.println(<span class="hljs-string">&quot;input pizza 种类:&quot;</span>);<br>         <span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> strin.readLine();<br>         <span class="hljs-keyword">return</span> str;<br>      &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>         e.printStackTrace();<br>         <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>;<br>      &#125;<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>OrderPizza2</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.factory.simplefactory.pizzastore.order;<br><br><span class="hljs-keyword">import</span> java.io.BufferedReader;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.io.InputStreamReader;<br><br><span class="hljs-keyword">import</span> io.xtwoy.factory.simplefactory.pizzastore.pizza.Pizza;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderPizza2</span> &#123;<br><br>	<span class="hljs-type">Pizza</span> <span class="hljs-variable">pizza</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>	<span class="hljs-type">String</span> <span class="hljs-variable">orderType</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&quot;</span>;<br>	<span class="hljs-comment">// 构造器</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-title function_">OrderPizza2</span><span class="hljs-params">()</span> &#123;<br>		<br>		<span class="hljs-keyword">do</span> &#123;<br>			orderType = getType();<br>			pizza = SimpleFactory.createPizza2(orderType);<br><br>			<span class="hljs-comment">// 输出pizza</span><br>			<span class="hljs-keyword">if</span> (pizza != <span class="hljs-literal">null</span>) &#123; <span class="hljs-comment">// 订购成功</span><br>				pizza.prepare();<br>				pizza.bake();<br>				pizza.cut();<br>				pizza.box();<br>			&#125; <span class="hljs-keyword">else</span> &#123;<br>				System.out.println(<span class="hljs-string">&quot; 订购披萨失败 &quot;</span>);<br>				<span class="hljs-keyword">break</span>;<br>			&#125;<br>		&#125; <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>);<br>	&#125;<br><br>	<span class="hljs-comment">// 写一个方法，可以获取客户希望订购的披萨种类</span><br>	<span class="hljs-keyword">private</span> String <span class="hljs-title function_">getType</span><span class="hljs-params">()</span> &#123;<br>		<span class="hljs-keyword">try</span> &#123;<br>			<span class="hljs-type">BufferedReader</span> <span class="hljs-variable">strin</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedReader</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InputStreamReader</span>(System.in));<br>			System.out.println(<span class="hljs-string">&quot;input pizza 种类:&quot;</span>);<br>			<span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> strin.readLine();<br>			<span class="hljs-keyword">return</span> str;<br>		&#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>			e.printStackTrace();<br>			<span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>;<br>		&#125;<br>	&#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>
<p><code>PizzaStore</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.factory.simplefactory.pizzastore.order;<br><br><span class="hljs-comment">//相当于一个客户端，发出订购</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PizzaStore</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-comment">//new OrderPizza();</span><br>      <br>      <span class="hljs-comment">//使用简单工厂模式</span><br>      <span class="hljs-comment">//new OrderPizza(new SimpleFactory());</span><br>      <span class="hljs-comment">//System.out.println(&quot;~~退出程序~~&quot;);</span><br>      <br>      <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderPizza2</span>();<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p>执行效果</p>
<p>input pizza 种类:<br />
greek<br />
使用简单工厂模式2<br />
给希腊披萨 准备原材料<br />
希腊披萨  baking;<br />
希腊披萨  cutting;<br />
希腊披萨  boxing;<br />
input pizza 种类:</p>
<h3 id="工厂方法模式"><a class="markdownIt-Anchor" href="#工厂方法模式"></a> <mark>工厂方法模式</mark></h3>
<p>看一个新的需求</p>
<p>披萨项目新的需求：客户在点披萨时，可以点<strong>不同口味的披萨</strong>，比如 北京的奶酪 pizza、北京的胡椒 pizza 或者是伦敦的奶酪 pizza、伦敦的胡椒 pizza。</p>
<ol>
<li>
<p>思路 1</p>
<p>使用<strong>简单工厂模式</strong>，创建<strong>不同的简单工厂类</strong>，比如 BJPizzaSimpleFactory、LDPizzaSimpleFactory 等等.从当前这个案例来说，也是可以的，但是考虑到项目的规模，以及软件的可维护性、可扩展性并不是特别好</p>
</li>
<li>
<p>思路 2</p>
<p>使用工厂方法模式</p>
</li>
</ol>
<blockquote>
<p>工厂方法模式介绍</p>
</blockquote>
<ol>
<li>
<p>工厂方法模式设计方案：将披萨项目的实例化功能抽象成抽象方法，在不同的口味点餐子类中具体实现。</p>
</li>
<li>
<p>工厂方法模式：<strong>定义了一个创建对象的抽象方法</strong>，由子<strong>类决定要实例化的类</strong>。工厂方法模式将<strong>对象的实例化推迟到子类</strong>。</p>
</li>
</ol>
<p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221224165136437.png" srcset="/img/loading.gif" lazyload alt="image-20221224165136437" /></p>
<p><strong>代码</strong></p>
<p><code>OrderPizza</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.factory.factorymethod.pizzastore.order;<br><br><span class="hljs-keyword">import</span> java.io.BufferedReader;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.io.InputStreamReader;<br><br><span class="hljs-keyword">import</span> io.xtwoy.factory.factorymethod.pizzastore.pizza.Pizza;<br><br><br><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderPizza</span> &#123;<br><br>   <span class="hljs-comment">//定义一个抽象方法，createPizza , 让各个工厂子类自己实现</span><br>   <span class="hljs-keyword">abstract</span> Pizza <span class="hljs-title function_">createPizza</span><span class="hljs-params">(String orderType)</span>;<br>   <br>   <span class="hljs-comment">// 构造器</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">OrderPizza</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-type">Pizza</span> <span class="hljs-variable">pizza</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>      String orderType; <span class="hljs-comment">// 订购披萨的类型</span><br>      <span class="hljs-keyword">do</span> &#123;<br>         orderType = getType();<br>         pizza = createPizza(orderType); <span class="hljs-comment">//抽象方法，由工厂子类完成</span><br>         <span class="hljs-comment">//输出pizza 制作过程</span><br>         pizza.prepare();<br>         pizza.bake();<br>         pizza.cut();<br>         pizza.box();<br>         <br>      &#125; <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>);<br>   &#125;<br><br>   <br><br>   <span class="hljs-comment">// 写一个方法，可以获取客户希望订购的披萨种类</span><br>   <span class="hljs-keyword">private</span> String <span class="hljs-title function_">getType</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">try</span> &#123;<br>         <span class="hljs-type">BufferedReader</span> <span class="hljs-variable">strin</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedReader</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InputStreamReader</span>(System.in));<br>         System.out.println(<span class="hljs-string">&quot;input pizza 种类:&quot;</span>);<br>         <span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> strin.readLine();<br>         <span class="hljs-keyword">return</span> str;<br>      &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>         e.printStackTrace();<br>         <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>;<br>      &#125;<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>LDOrderPizza</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.factory.factorymethod.pizzastore.order;<br><br><span class="hljs-keyword">import</span> io.xtwoy.factory.factorymethod.pizzastore.pizza.LDCheesePizza;<br><span class="hljs-keyword">import</span> io.xtwoy.factory.factorymethod.pizzastore.pizza.LDPepperPizza;<br><span class="hljs-keyword">import</span> io.xtwoy.factory.factorymethod.pizzastore.pizza.Pizza;<br><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LDOrderPizza</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">OrderPizza</span> &#123;<br><br>   <br>   <span class="hljs-meta">@Override</span><br>   Pizza <span class="hljs-title function_">createPizza</span><span class="hljs-params">(String orderType)</span> &#123;<br>   <br>      <span class="hljs-type">Pizza</span> <span class="hljs-variable">pizza</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>      <span class="hljs-keyword">if</span>(orderType.equals(<span class="hljs-string">&quot;cheese&quot;</span>)) &#123;<br>         pizza = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LDCheesePizza</span>();<br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (orderType.equals(<span class="hljs-string">&quot;pepper&quot;</span>)) &#123;<br>         pizza = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LDPepperPizza</span>();<br>      &#125;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-keyword">return</span> pizza;<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>BJOrderPizza</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.factory.factorymethod.pizzastore.order;<br><br><span class="hljs-keyword">import</span> io.xtwoy.factory.factorymethod.pizzastore.pizza.BJCheesePizza;<br><span class="hljs-keyword">import</span> io.xtwoy.factory.factorymethod.pizzastore.pizza.BJPepperPizza;<br><span class="hljs-keyword">import</span> io.xtwoy.factory.factorymethod.pizzastore.pizza.Pizza;<br><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BJOrderPizza</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">OrderPizza</span> &#123;<br><br>   <br>   <span class="hljs-meta">@Override</span><br>    Pizza <span class="hljs-title function_">createPizza</span><span class="hljs-params">(String orderType)</span> &#123;<br>   <br>      <span class="hljs-type">Pizza</span> <span class="hljs-variable">pizza</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>      <span class="hljs-keyword">if</span>(orderType.equals(<span class="hljs-string">&quot;cheese&quot;</span>)) &#123;<br>         pizza = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BJCheesePizza</span>();<br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (orderType.equals(<span class="hljs-string">&quot;pepper&quot;</span>)) &#123;<br>         pizza = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BJPepperPizza</span>();<br>      &#125;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-keyword">return</span> pizza;<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>PizzaStore</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.factory.factorymethod.pizzastore.order;<br><br><span class="hljs-keyword">import</span> io.xtwoy.factory.factorymethod.pizzastore.pizza.BJCheesePizza;<br><span class="hljs-keyword">import</span> io.xtwoy.factory.factorymethod.pizzastore.pizza.BJPepperPizza;<br><span class="hljs-keyword">import</span> io.xtwoy.factory.factorymethod.pizzastore.pizza.Pizza;<br><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BJOrderPizza</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">OrderPizza</span> &#123;<br><br>   <br>   <span class="hljs-meta">@Override</span><br>    Pizza <span class="hljs-title function_">createPizza</span><span class="hljs-params">(String orderType)</span> &#123;<br>   <br>      <span class="hljs-type">Pizza</span> <span class="hljs-variable">pizza</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>      <span class="hljs-keyword">if</span>(orderType.equals(<span class="hljs-string">&quot;cheese&quot;</span>)) &#123;<br>         pizza = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BJCheesePizza</span>();<br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (orderType.equals(<span class="hljs-string">&quot;pepper&quot;</span>)) &#123;<br>         pizza = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BJPepperPizza</span>();<br>      &#125;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-keyword">return</span> pizza;<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p>执行效果</p>
<p>input pizza 种类:<br />
pepper<br />
北京的胡椒pizza 准备原材料<br />
北京的胡椒pizza baking;<br />
北京的胡椒pizza cutting;<br />
北京的胡椒pizza boxing;<br />
input pizza 种类:</p>
<h3 id="抽象工厂模式"><a class="markdownIt-Anchor" href="#抽象工厂模式"></a> <mark>抽象工厂模式</mark></h3>
<ol>
<li>
<p>抽象工厂模式：定义了一个 <strong>interface 用于创建相关或有依赖关系的对象簇</strong>，而无需指明具体的类</p>
</li>
<li>
<p>抽象工厂模式可以将简单工厂模式和工厂方法模式进行整合。</p>
</li>
<li>
<p>从设计层面看，抽象工厂模式就是对简单工厂模式的改进(或者称为进一步的抽象)。</p>
</li>
<li>
<p>将工厂抽象成<strong>两层</strong>，<strong>AbsFactory(抽象工厂)</strong> 和 <strong>具体实现的工厂子类</strong>。程序员可以根据创建对象类型使用对应的工厂子类。这样将单个的简单工厂类变成了工厂簇，更利于代码的维护和扩展。</p>
</li>
<li>
<p>类图</p>
</li>
</ol>
<p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221224171144291.png" srcset="/img/loading.gif" lazyload alt="image-20221224171144291" /></p>
<p><strong>代码</strong></p>
<p><code>AbsFactory</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.factory.factorymethod.pizzastore.order;<br><br><span class="hljs-keyword">import</span> io.xtwoy.factory.factorymethod.pizzastore.pizza.BJCheesePizza;<br><span class="hljs-keyword">import</span> io.xtwoy.factory.factorymethod.pizzastore.pizza.BJPepperPizza;<br><span class="hljs-keyword">import</span> io.xtwoy.factory.factorymethod.pizzastore.pizza.Pizza;<br><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BJOrderPizza</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">OrderPizza</span> &#123;<br><br>   <br>   <span class="hljs-meta">@Override</span><br>    Pizza <span class="hljs-title function_">createPizza</span><span class="hljs-params">(String orderType)</span> &#123;<br>   <br>      <span class="hljs-type">Pizza</span> <span class="hljs-variable">pizza</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>      <span class="hljs-keyword">if</span>(orderType.equals(<span class="hljs-string">&quot;cheese&quot;</span>)) &#123;<br>         pizza = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BJCheesePizza</span>();<br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (orderType.equals(<span class="hljs-string">&quot;pepper&quot;</span>)) &#123;<br>         pizza = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BJPepperPizza</span>();<br>      &#125;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-keyword">return</span> pizza;<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>BJFactory</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.factory.absfactory.pizzastore.order;<br><br><span class="hljs-keyword">import</span> io.xtwoy.factory.absfactory.pizzastore.pizza.BJCheesePizza;<br><span class="hljs-keyword">import</span> io.xtwoy.factory.absfactory.pizzastore.pizza.BJPepperPizza;<br><span class="hljs-keyword">import</span> io.xtwoy.factory.absfactory.pizzastore.pizza.Pizza;<br><br><span class="hljs-comment">//这是工厂子类</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BJFactory</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">AbsFactory</span> &#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> Pizza <span class="hljs-title function_">createPizza</span><span class="hljs-params">(String orderType)</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;~使用的是抽象工厂模式~&quot;</span>);<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-type">Pizza</span> <span class="hljs-variable">pizza</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>      <span class="hljs-keyword">if</span>(orderType.equals(<span class="hljs-string">&quot;cheese&quot;</span>)) &#123;<br>         pizza = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BJCheesePizza</span>();<br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (orderType.equals(<span class="hljs-string">&quot;pepper&quot;</span>))&#123;<br>         pizza = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BJPepperPizza</span>();<br>      &#125;<br>      <span class="hljs-keyword">return</span> pizza;<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>LDFactory</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.factory.absfactory.pizzastore.order;<br><br><span class="hljs-keyword">import</span> io.xtwoy.factory.absfactory.pizzastore.pizza.BJCheesePizza;<br><span class="hljs-keyword">import</span> io.xtwoy.factory.absfactory.pizzastore.pizza.BJPepperPizza;<br><span class="hljs-keyword">import</span> io.xtwoy.factory.absfactory.pizzastore.pizza.Pizza;<br><br><span class="hljs-comment">//这是工厂子类</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BJFactory</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">AbsFactory</span> &#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> Pizza <span class="hljs-title function_">createPizza</span><span class="hljs-params">(String orderType)</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;~使用的是抽象工厂模式~&quot;</span>);<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-type">Pizza</span> <span class="hljs-variable">pizza</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>      <span class="hljs-keyword">if</span>(orderType.equals(<span class="hljs-string">&quot;cheese&quot;</span>)) &#123;<br>         pizza = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BJCheesePizza</span>();<br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (orderType.equals(<span class="hljs-string">&quot;pepper&quot;</span>))&#123;<br>         pizza = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BJPepperPizza</span>();<br>      &#125;<br>      <span class="hljs-keyword">return</span> pizza;<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>OrderPizza</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.factory.absfactory.pizzastore.order;<br><br><span class="hljs-keyword">import</span> java.io.BufferedReader;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.io.InputStreamReader;<br><br><span class="hljs-keyword">import</span> io.xtwoy.factory.absfactory.pizzastore.pizza.Pizza;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderPizza</span> &#123;<br><br>   AbsFactory factory;<br><br>   <span class="hljs-comment">// 构造器</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">OrderPizza</span><span class="hljs-params">(AbsFactory factory)</span> &#123;<br>      setFactory(factory);<br>   &#125;<br><br>   <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setFactory</span><span class="hljs-params">(AbsFactory factory)</span> &#123;<br>      <span class="hljs-type">Pizza</span> <span class="hljs-variable">pizza</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>      <span class="hljs-type">String</span> <span class="hljs-variable">orderType</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&quot;</span>; <span class="hljs-comment">// 用户输入</span><br>      <span class="hljs-built_in">this</span>.factory = factory;<br>      <span class="hljs-keyword">do</span> &#123;<br>         orderType = getType();<br>         <span class="hljs-comment">// factory 可能是北京的工厂子类，也可能是伦敦的工厂子类</span><br>         pizza = factory.createPizza(orderType);<br>         <span class="hljs-keyword">if</span> (pizza != <span class="hljs-literal">null</span>) &#123; <span class="hljs-comment">// 订购ok</span><br>            pizza.prepare();<br>            pizza.bake();<br>            pizza.cut();<br>            pizza.box();<br>         &#125; <span class="hljs-keyword">else</span> &#123;<br>            System.out.println(<span class="hljs-string">&quot;订购失败&quot;</span>);<br>            <span class="hljs-keyword">break</span>;<br>         &#125;<br>      &#125; <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>);<br>   &#125;<br><br>   <span class="hljs-comment">// 写一个方法，可以获取客户希望订购的披萨种类</span><br>   <span class="hljs-keyword">private</span> String <span class="hljs-title function_">getType</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">try</span> &#123;<br>         <span class="hljs-type">BufferedReader</span> <span class="hljs-variable">strin</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedReader</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InputStreamReader</span>(System.in));<br>         System.out.println(<span class="hljs-string">&quot;input pizza 种类:&quot;</span>);<br>         <span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> strin.readLine();<br>         <span class="hljs-keyword">return</span> str;<br>      &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>         e.printStackTrace();<br>         <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>;<br>      &#125;<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>PizzaStore</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.factory.absfactory.pizzastore.order;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PizzaStore</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-comment">//new OrderPizza(new BJFactory());</span><br>      <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderPizza</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">LDFactory</span>());<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p>执行效果</p>
<p>input pizza 种类:<br />
cheese<br />
<sub>使用的是抽象工厂模式</sub><br />
伦敦的奶酪pizza 准备原材料<br />
伦敦的奶酪pizza baking;<br />
伦敦的奶酪pizza cutting;<br />
伦敦的奶酪pizza boxing;<br />
input pizza 种类:</p>
<h1 id="原型模式"><a class="markdownIt-Anchor" href="#原型模式"></a> 原型模式</h1>
<p>原型模式（Prototype Pattern）是用于创建重复的对象，同时又能保证性能。这种类型的设计模式属于创建型模式，它提供了一种创建对象的最佳方式。</p>
<p>这种模式是实现了一个原型接口，该接口用于创建当前对象的克隆。当直接创建对象的代价比较大时，则采用这种模式。例如，一个对象需要在一个高代价的数据库操作之后被创建。我们可以缓存该对象，在下一个请求时返回它的克隆，在需要的时候更新数据库，以此来减少数据库调用。</p>
<h2 id="介绍-3"><a class="markdownIt-Anchor" href="#介绍-3"></a> 介绍</h2>
<p><strong>意图：</strong> 用原型实例指定创建对象的种类，并且通过拷贝这些原型创建新的对象。</p>
<p><strong>主要解决：</strong> 在运行期建立和删除原型。</p>
<p><strong>何时使用：</strong> 1、当一个系统应该独立于它的产品创建，构成和表示时。 2、当要实例化的类是在运行时刻指定时，例如，通过动态装载。<br />
3、为了避免创建一个与产品类层次平行的工厂类层次时。<br />
4、当一个类的实例只能有几个不同状态组合中的一种时。建立相应数目的原型并克隆它们可能比每次用合适的状态手工实例化该类更方便一些。</p>
<p><strong>如何解决：</strong> 利用已有的一个原型对象，快速地生成和原型对象一样的实例。</p>
<p><strong>关键代码：</strong> 1、实现克隆操作，在 JAVA 实现 Cloneable 接口，重写 clone()，在 .NET 中可以使用 Object 类的MemberwiseClone() 方法来实现对象的浅拷贝或通过序列化的方式来实现深拷贝。<br />
2、原型模式同样用于隔离类对象的使用者和具体类型（易变类）之间的耦合关系，它同样要求这些&quot;易变类&quot;拥有稳定的接口。</p>
<p><strong>应用实例：</strong> 1、细胞分裂。 2、JAVA 中的 Object clone() 方法。</p>
<p><strong>优点：</strong> 1、性能提高。 2、逃避构造函数的约束。</p>
<p><strong>缺点：</strong><br />
1、配备克隆方法需要对类的功能进行通盘考虑，这对于全新的类不是很难，但对于已有的类不一定很容易，特别当一个类引用不支持串行化的间接对象，或者引用含有循环结构的时候。<br />
2、必须实现 Cloneable 接口。</p>
<p><strong>使用场景：</strong> 1、资源优化场景。 2、类初始化需要消化非常多的资源，这个资源包括数据、硬件资源等。 3、性能和安全要求的场景。 4、通过 new<br />
产生一个对象需要非常繁琐的数据准备或访问权限，则可以使用原型模式。 5、一个对象多个修改者的场景。<br />
6、一个对象需要提供给其他对象访问，而且各个调用者可能都需要修改其值时，可以考虑使用原型模式拷贝多个对象供调用者使用。<br />
7、在实际项目中，原型模式很少单独出现，一般是和工厂方法模式一起出现，通过 clone 的方法创建一个对象，然后由工厂方法提供给调用者。原型模式已经与<br />
Java 融为浑然一体，大家可以随手拿来使用。</p>
<p><strong>注意事项：</strong> 与通过对一个类进行实例化来构造新对象不同的是，原型模式是通过拷贝一个现有对象生成新对象的。浅拷贝实现<br />
Cloneable，重写，深拷贝是通过实现 Serializable 读取二进制流。</p>
<h2 id="实现-2"><a class="markdownIt-Anchor" href="#实现-2"></a> 实现</h2>
<p>我们将创建一个抽象类 <em>Shape</em> 和扩展了 <em>Shape</em> 类的实体类。下一步是定义类 <em>ShapeCache</em> ，该类把 shape 对象存储在一个_Hashtable_ 中，并在请求的时候返回它们的克隆。</p>
<p><em>PrototypePatternDemo</em> 类使用 <em>ShapeCache</em> 类来获取 <em>Shape</em> 对象。</p>
<p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/20201202-prototype-pattern.png" srcset="/img/loading.gif" lazyload alt="原型模式的 UML 图" /></p>
<p><code>Shape</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.prototype.cn;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 创建一个实现了 Cloneable 接口的抽象类。</span><br><span class="hljs-comment"> * [io.xtwoy.prototype.cn]</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> : [席子不会敲代码]</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> : [V1.0]</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@date</span> : [2022/12/24 17:26]</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Shape</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Cloneable</span> &#123;<br><br>    <span class="hljs-keyword">private</span> String id;<br>    <span class="hljs-keyword">protected</span> String type;<br><br>    <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">draw</span><span class="hljs-params">()</span>;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getType</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> type;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> id;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(String id)</span> &#123;<br>        <span class="hljs-built_in">this</span>.id = id;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">clone</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">clone</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            clone = <span class="hljs-built_in">super</span>.clone();<br>        &#125; <span class="hljs-keyword">catch</span> (CloneNotSupportedException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>        <span class="hljs-keyword">return</span> clone;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>Circle</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.prototype.cn;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * [io.xtwoy.prototype.cn]</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> : [席子不会敲代码]</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> : [V1.0]</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@date</span> : [2022/12/24 17:27]</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Circle</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Shape</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Circle</span><span class="hljs-params">()</span>&#123;<br>        type = <span class="hljs-string">&quot;Circle&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">draw</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;Inside Circle::draw() method.&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>Rectangle</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.prototype.cn;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * [io.xtwoy.prototype.cn]</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> : [席子不会敲代码]</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> : [V1.0]</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@date</span> : [2022/12/24 17:27]</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Rectangle</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Shape</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Rectangle</span><span class="hljs-params">()</span>&#123;<br>        type = <span class="hljs-string">&quot;Rectangle&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">draw</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;Inside Rectangle::draw() method.&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>Square</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.prototype.cn;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * [io.xtwoy.prototype.cn]</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> : [席子不会敲代码]</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> : [V1.0]</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@date</span> : [2022/12/24 17:27]</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Square</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Shape</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Square</span><span class="hljs-params">()</span>&#123;<br>        type = <span class="hljs-string">&quot;Square&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">draw</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;Inside Square::draw() method.&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>ShapeCache</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.prototype.cn;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 创建一个类，从数据库获取实体类，并把它们存储在一个 Hashtable 中。</span><br><span class="hljs-comment"> * [io.xtwoy.prototype.cn]</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> : [席子不会敲代码]</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> : [V1.0]</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@date</span> : [2022/12/24 17:28]</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">import</span> java.util.Hashtable;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ShapeCache</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Hashtable&lt;String, Shape&gt; shapeMap<br>            = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Hashtable</span>&lt;String, Shape&gt;();<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Shape <span class="hljs-title function_">getShape</span><span class="hljs-params">(String shapeId)</span> &#123;<br>        <span class="hljs-type">Shape</span> <span class="hljs-variable">cachedShape</span> <span class="hljs-operator">=</span> shapeMap.get(shapeId);<br>        <span class="hljs-keyword">return</span> (Shape) cachedShape.clone();<br>    &#125;<br><br>    <span class="hljs-comment">// 对每种形状都运行数据库查询，并创建该形状</span><br>    <span class="hljs-comment">// shapeMap.put(shapeKey, shape);</span><br>    <span class="hljs-comment">// 例如，我们要添加三种形状</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">loadCache</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">Circle</span> <span class="hljs-variable">circle</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Circle</span>();<br>        circle.setId(<span class="hljs-string">&quot;1&quot;</span>);<br>        shapeMap.put(circle.getId(),circle);<br><br>        <span class="hljs-type">Square</span> <span class="hljs-variable">square</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Square</span>();<br>        square.setId(<span class="hljs-string">&quot;2&quot;</span>);<br>        shapeMap.put(square.getId(),square);<br><br>        <span class="hljs-type">Rectangle</span> <span class="hljs-variable">rectangle</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Rectangle</span>();<br>        rectangle.setId(<span class="hljs-string">&quot;3&quot;</span>);<br>        shapeMap.put(rectangle.getId(),rectangle);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>PrototypePatternDemo</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.prototype.cn;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * PrototypePatternDemo 使用 ShapeCache 类来获取存储在 Hashtable 中的形状的克隆。</span><br><span class="hljs-comment"> * [io.xtwoy.prototype.cn]</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> : [席子不会敲代码]</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> : [V1.0]</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@date</span> : [2022/12/24 17:29]</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PrototypePatternDemo</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        ShapeCache.loadCache();<br><br>        <span class="hljs-type">Shape</span> <span class="hljs-variable">clonedShape</span> <span class="hljs-operator">=</span> (Shape) ShapeCache.getShape(<span class="hljs-string">&quot;1&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;Shape : &quot;</span> + clonedShape.getType());<br><br>        <span class="hljs-type">Shape</span> <span class="hljs-variable">clonedShape2</span> <span class="hljs-operator">=</span> (Shape) ShapeCache.getShape(<span class="hljs-string">&quot;2&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;Shape : &quot;</span> + clonedShape2.getType());<br><br>        <span class="hljs-type">Shape</span> <span class="hljs-variable">clonedShape3</span> <span class="hljs-operator">=</span> (Shape) ShapeCache.getShape(<span class="hljs-string">&quot;3&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;Shape : &quot;</span> + clonedShape3.getType());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<blockquote>
<p>执行程序，输出结果：</p>
</blockquote>
<p>Shape : Circle<br />
Shape : Square<br />
Shape : Rectangle</p>
<h2 id="深入讨论-浅拷贝和深拷贝"><a class="markdownIt-Anchor" href="#深入讨论-浅拷贝和深拷贝"></a> 深入讨论-浅拷贝和深拷贝</h2>
<h3 id="浅拷贝的介绍"><a class="markdownIt-Anchor" href="#浅拷贝的介绍"></a> 浅拷贝的介绍</h3>
<ol>
<li>
<p>对于数据类型是基本数据类型的成员变量，浅拷贝会直接进行值传递，也就是将该属性值复制一份给新的对象。</p>
</li>
<li>
<p>对于数据类型是引用数据类型的成员变量，比如说成员变量是某个数组、某个类的对象等，那么浅拷贝会进行引用传递，也就是只是将该成员变量的引用值（内存地址）复制一份给新的对象。因为实际上两个对象的该成员变量都指向同一个实例。在这种情况下，在一个对象中修改该成员变量会影响到另一个对象的该成员变量值</p>
</li>
<li>
<p>前面我们克隆Shape 就是浅拷贝</p>
</li>
<li>
<p>浅拷贝是使用默认的 clone()方法来实现</p>
</li>
</ol>
<p>sheep = (Sheep) super.clone();</p>
<h3 id="深拷贝基本介绍"><a class="markdownIt-Anchor" href="#深拷贝基本介绍"></a> 深拷贝基本介绍</h3>
<ol>
<li>
<p>复制对象的所有基本数据类型的成员变量值</p>
</li>
<li>
<p>为所有引用数据类型的成员变量申请存储空间，并复制每个引用数据类型成员变量所引用的对象，直到该对象可达的所有对象。也就是说，<strong>对象进行深拷贝要对整个对象(包括对象的引用类型)进行拷贝</strong></p>
</li>
<li>
<p>深拷贝实现方式 1：重写 <strong>clone</strong> 方法来实现深拷贝</p>
</li>
<li>
<p>深拷贝实现方式 2：通过<strong>对象序列化</strong>实现深拷贝(推荐)</p>
</li>
</ol>
<p><code>DeepCloneableTarget</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.prototype.deepclone;<br><br><span class="hljs-keyword">import</span> java.io.Serializable;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DeepCloneableTarget</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span>, Cloneable &#123;<br>   <br>   <span class="hljs-comment">/**</span><br><span class="hljs-comment">    * </span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">serialVersionUID</span> <span class="hljs-operator">=</span> <span class="hljs-number">1L</span>;<br><br>   <span class="hljs-keyword">private</span> String cloneName;<br><br>   <span class="hljs-keyword">private</span> String cloneClass;<br><br>   <span class="hljs-comment">//构造器</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">DeepCloneableTarget</span><span class="hljs-params">(String cloneName, String cloneClass)</span> &#123;<br>      <span class="hljs-built_in">this</span>.cloneName = cloneName;<br>      <span class="hljs-built_in">this</span>.cloneClass = cloneClass;<br>   &#125;<br><br>   <span class="hljs-comment">//因为该类的属性，都是String , 因此我们这里使用默认的clone完成即可</span><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">protected</span> Object <span class="hljs-title function_">clone</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> CloneNotSupportedException &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.clone();<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>DeepProtoType</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.prototype.deepclone;<br><br><span class="hljs-keyword">import</span> java.io.ByteArrayInputStream;<br><span class="hljs-keyword">import</span> java.io.ByteArrayOutputStream;<br><span class="hljs-keyword">import</span> java.io.ObjectInputStream;<br><span class="hljs-keyword">import</span> java.io.ObjectOutputStream;<br><span class="hljs-keyword">import</span> java.io.Serializable;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DeepProtoType</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span>, Cloneable&#123;<br>   <br>   <span class="hljs-keyword">public</span> String name; <span class="hljs-comment">//String 属性</span><br>   <span class="hljs-keyword">public</span> DeepCloneableTarget deepCloneableTarget;<span class="hljs-comment">// 引用类型</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">DeepProtoType</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-built_in">super</span>();<br>   &#125;<br><br><br><br>   <span class="hljs-comment">//深拷贝 - 方式 1 使用clone 方法</span><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">protected</span> Object <span class="hljs-title function_">clone</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> CloneNotSupportedException &#123;<br><br>      <span class="hljs-type">Object</span> <span class="hljs-variable">deep</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>      <span class="hljs-comment">//这里完成对基本数据类型(属性)和String的克隆</span><br>      deep = <span class="hljs-built_in">super</span>.clone();<br>      <span class="hljs-comment">//对引用类型的属性，进行单独处理</span><br>      <span class="hljs-type">DeepProtoType</span> <span class="hljs-variable">deepProtoType</span> <span class="hljs-operator">=</span> (DeepProtoType)deep;<br>      deepProtoType.deepCloneableTarget  = (DeepCloneableTarget)deepCloneableTarget.clone();<br><br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-keyword">return</span> deepProtoType;<br>   &#125;<br>   <br>   <span class="hljs-comment">//深拷贝 - 方式2 通过对象的序列化实现 (推荐)</span><br>   <br>   <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">deepClone</span><span class="hljs-params">()</span> &#123;<br>      <br>      <span class="hljs-comment">//创建流对象</span><br>      <span class="hljs-type">ByteArrayOutputStream</span> <span class="hljs-variable">bos</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>      <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oos</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>      <span class="hljs-type">ByteArrayInputStream</span> <span class="hljs-variable">bis</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>      <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>      <br>      <span class="hljs-keyword">try</span> &#123;<br>         <br>         <span class="hljs-comment">//序列化</span><br>         bos = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayOutputStream</span>();<br>         oos = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(bos);<br>         oos.writeObject(<span class="hljs-built_in">this</span>); <span class="hljs-comment">//当前这个对象以对象流的方式输出</span><br>         <br>         <span class="hljs-comment">//反序列化</span><br>         bis = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayInputStream</span>(bos.toByteArray());<br>         ois = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(bis);<br>         <span class="hljs-type">DeepProtoType</span> <span class="hljs-variable">copyObj</span> <span class="hljs-operator">=</span> (DeepProtoType)ois.readObject();<br>         <br>         <span class="hljs-keyword">return</span> copyObj;<br>         <br>      &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>         <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> handle exception</span><br>         e.printStackTrace();<br>         <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>      &#125; <span class="hljs-keyword">finally</span> &#123;<br>         <span class="hljs-comment">//关闭流</span><br>         <span class="hljs-keyword">try</span> &#123;<br>            bos.close();<br>            oos.close();<br>            bis.close();<br>            ois.close();<br>         &#125; <span class="hljs-keyword">catch</span> (Exception e2) &#123;<br>            <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> handle exception</span><br>            System.out.println(e2.getMessage());<br>         &#125;<br>      &#125;<br>      <br>   &#125;<br>   <br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>Client</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.prototype.deepclone;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-type">DeepProtoType</span> <span class="hljs-variable">p</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DeepProtoType</span>();<br>      p.name = <span class="hljs-string">&quot;宋江&quot;</span>;<br>      p.deepCloneableTarget = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DeepCloneableTarget</span>(<span class="hljs-string">&quot;大牛&quot;</span>, <span class="hljs-string">&quot;小牛&quot;</span>);<br>      <br><span class="hljs-comment">//    方式1 完成深拷贝</span><br>      <br>      <span class="hljs-type">DeepProtoType</span> <span class="hljs-variable">p1</span> <span class="hljs-operator">=</span> (DeepProtoType) p.clone();<br><br>      System.out.println(<span class="hljs-string">&quot;p.name=&quot;</span> + p.name + <span class="hljs-string">&quot;p.deepCloneableTarget=&quot;</span> + p.deepCloneableTarget.hashCode());<br>      System.out.println(<span class="hljs-string">&quot;p2.name=&quot;</span> + p.name + <span class="hljs-string">&quot;p2.deepCloneableTarget=&quot;</span> + p1.deepCloneableTarget.hashCode());<br>   <br>      <span class="hljs-comment">//方式2 完成深拷贝</span><br>      <span class="hljs-type">DeepProtoType</span> <span class="hljs-variable">p2</span> <span class="hljs-operator">=</span> (DeepProtoType) p.deepClone();<br>      <br>      System.out.println(<span class="hljs-string">&quot;p.name=&quot;</span> + p.name + <span class="hljs-string">&quot;p.deepCloneableTarget=&quot;</span> + p.deepCloneableTarget.hashCode());<br>      System.out.println(<span class="hljs-string">&quot;p2.name=&quot;</span> + p.name + <span class="hljs-string">&quot;p2.deepCloneableTarget=&quot;</span> + p2.deepCloneableTarget.hashCode());<br>   <br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<blockquote>
<p>执行程序，输出结果：</p>
</blockquote>
<p>p.name=宋江p.deepCloneableTarget=1360875712<br />
p2.name=宋江p2.deepCloneableTarget=1625635731<br />
p.name=宋江p.deepCloneableTarget=1360875712<br />
p2.name=宋江p2.deepCloneableTarget=824909230</p>
<p>注释<code>DeepProtoType</code>中的一下代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//对引用类型的属性，进行单独处理</span><br>     <span class="hljs-type">DeepProtoType</span> <span class="hljs-variable">deepProtoType</span> <span class="hljs-operator">=</span> (DeepProtoType)deep;<br>     deepProtoType.deepCloneableTarget  = (DeepCloneableTarget)deepCloneableTarget.clone();<br></code></pre></td></tr></table></figure>
<blockquote>
<p>执行程序，输出结果：</p>
</blockquote>
<p>p.name=宋江p.deepCloneableTarget=1360875712<br />
p2.name=宋江p2.deepCloneableTarget=1360875712<br />
p.name=宋江p.deepCloneableTarget=1360875712<br />
p2.name=宋江p2.deepCloneableTarget=664223387</p>
<h1 id="建造者模式"><a class="markdownIt-Anchor" href="#建造者模式"></a> 🌗建造者模式</h1>
<p>建造者模式（BuilderPattern）使用多个简单的对象一步一步构建成一个复杂的对象。这种类型的设计模式属于创建型模式，它提供了一种创建对象的最佳方式。</p>
<p>建造者模式（<strong>Builder Pattern</strong>） 又叫<strong>生成器模式</strong>，是一种对象<strong>构建模式</strong>。它可以将复杂对象的建造过程抽象出来（抽象类别），使这个抽象过程的不同实现方法可以构造出不同表现（属性）的对象。</p>
<p>建造者模式 是一步一步创建一个复杂的对象，它允许用户只通过指定复杂对象的类型和内容就可以构建它们，用户不需要知道内部的具体构建细节。</p>
<p>一个 Builder 类会一步一步构造最终的对象。该 Builder 类是独立于其他对象的。</p>
<h2 id="介绍-4"><a class="markdownIt-Anchor" href="#介绍-4"></a> 介绍</h2>
<p><strong>意图：</strong> 将一个复杂的构建与其表示相分离，使得同样的构建过程可以创建不同的表示。</p>
<p><strong>主要解决：</strong><br />
主要解决在软件系统中，有时候面临着&quot;一个复杂对象&quot;的创建工作，其通常由各个部分的子对象用一定的算法构成；由于需求的变化，这个复杂对象的各个部分经常面临着剧烈的变化，但是将它们组合在一起的算法却相对稳定。</p>
<p><strong>何时使用：</strong> 一些基本部件不会变，而其组合经常变化的时候。</p>
<p><strong>如何解决：</strong> 将变与不变分离开。</p>
<p><strong>关键代码：</strong> 建造者：创建和提供实例，导演：管理建造出来的实例的依赖关系。</p>
<p><strong>应用实例：</strong> 1、去肯德基，汉堡、可乐、薯条、炸鸡翅等是不变的，而其组合是经常变化的，生成出所谓的&quot;套餐&quot;。 2、JAVA 中的StringBuilder。</p>
<p><strong>优点：</strong> 1、建造者独立，易扩展。 2、便于控制细节风险。</p>
<p><strong>缺点：</strong> 1、产品必须有共同点，范围有限制。 2、如内部变化复杂，会有很多的建造类。</p>
<p><strong>使用场景：</strong> 1、需要生成的对象具有复杂的内部结构。 2、需要生成的对象内部属性本身相互依赖。</p>
<p><strong>注意事项：</strong> 与工厂模式的区别是：建造者模式更加关注与零件装配的顺序。</p>
<p><strong>建造者模式的四个角色：</strong></p>
<p>1、Product（产品角色）： 一个具体的产品对象。</p>
<p>2、 Builder（抽象建造者）： 创建一个 Product 对象的各个部件指定的 <strong>接口/抽象类</strong>。</p>
<p>3、ConcreteBuilder（具体建造者）： 实现接口，构建和装配各个部件。</p>
<p>4、Director（指挥者）： 构建一个使用 Builder 接口的对象。它主要是用于创建一个复杂的对象。它主要有两个作用，一是：隔离了客户与对象的生产过程，二是：负责控制产品对象的生产过程。</p>
<p><strong>建造者模式原理类图：</strong></p>
<p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221224193125327.png" srcset="/img/loading.gif" lazyload alt="image-20221224193125327" /></p>
<ol>
<li>需要建房子：这一过程为打桩、砌墙、封顶。不管是普通房子也好，别墅也好都需要经历这些过程，下面我们</li>
</ol>
<p>使用建造者模式(Builder Pattern)来完成</p>
<ol start="2">
<li>思路分析图解(类图)</li>
</ol>
<p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221224213529759.png" srcset="/img/loading.gif" lazyload alt="image-20221224213529759" /></p>
<h2 id="实现-3"><a class="markdownIt-Anchor" href="#实现-3"></a> 实现</h2>
<p><code>House</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.builder.improve;<br><br><span class="hljs-comment">//产品-&gt;Product</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">House</span> &#123;<br>   <span class="hljs-keyword">private</span> String baise;<br>   <span class="hljs-keyword">private</span> String wall;<br>   <span class="hljs-keyword">private</span> String roofed;<br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getBaise</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> baise;<br>   &#125;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setBaise</span><span class="hljs-params">(String baise)</span> &#123;<br>      <span class="hljs-built_in">this</span>.baise = baise;<br>   &#125;<br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getWall</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> wall;<br>   &#125;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setWall</span><span class="hljs-params">(String wall)</span> &#123;<br>      <span class="hljs-built_in">this</span>.wall = wall;<br>   &#125;<br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getRoofed</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> roofed;<br>   &#125;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setRoofed</span><span class="hljs-params">(String roofed)</span> &#123;<br>      <span class="hljs-built_in">this</span>.roofed = roofed;<br>   &#125;<br>   <br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>HouseBuilder</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.builder.improve;<br><br><br><span class="hljs-comment">// 抽象的建造者</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HouseBuilder</span> &#123;<br><br>   <span class="hljs-keyword">protected</span> <span class="hljs-type">House</span> <span class="hljs-variable">house</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">House</span>();<br>   <br>   <span class="hljs-comment">//将建造的流程写好, 抽象的方法</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">buildBasic</span><span class="hljs-params">()</span>;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">buildWalls</span><span class="hljs-params">()</span>;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">roofed</span><span class="hljs-params">()</span>;<br>   <br>   <span class="hljs-comment">//建造房子好， 将产品(房子) 返回</span><br>   <span class="hljs-keyword">public</span> House <span class="hljs-title function_">buildHouse</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> house;<br>   &#125;<br>   <br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>CommonHouse</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.builder.improve;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CommonHouse</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">HouseBuilder</span> &#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">buildBasic</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot; 普通房子打地基5米 &quot;</span>);<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">buildWalls</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot; 普通房子砌墙10cm &quot;</span>);<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">roofed</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot; 普通房子屋顶 &quot;</span>);<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>HighBuilding</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.builder.improve;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HighBuilding</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">HouseBuilder</span> &#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">buildBasic</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot; 高楼的打地基100米 &quot;</span>);<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">buildWalls</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot; 高楼的砌墙20cm &quot;</span>);<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">roofed</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot; 高楼的透明屋顶 &quot;</span>);<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>HouseDirector</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.builder.improve;<br><br><span class="hljs-comment">//指挥者，这里去指定制作流程，返回产品</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HouseDirector</span> &#123;<br>   <br>   <span class="hljs-type">HouseBuilder</span> <span class="hljs-variable">houseBuilder</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br><br>   <span class="hljs-comment">//构造器传入 houseBuilder</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">HouseDirector</span><span class="hljs-params">(HouseBuilder houseBuilder)</span> &#123;<br>      <span class="hljs-built_in">this</span>.houseBuilder = houseBuilder;<br>   &#125;<br><br>   <span class="hljs-comment">//通过setter 传入 houseBuilder</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setHouseBuilder</span><span class="hljs-params">(HouseBuilder houseBuilder)</span> &#123;<br>      <span class="hljs-built_in">this</span>.houseBuilder = houseBuilder;<br>   &#125;<br>   <br>   <span class="hljs-comment">//如何处理建造房子的流程，交给指挥者</span><br>   <span class="hljs-keyword">public</span> House <span class="hljs-title function_">constructHouse</span><span class="hljs-params">()</span> &#123;<br>      houseBuilder.buildBasic();<br>      houseBuilder.buildWalls();<br>      houseBuilder.roofed();<br>      <span class="hljs-keyword">return</span> houseBuilder.buildHouse();<br>   &#125;<br>   <br>   <br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>Client</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.builder.improve;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <br>      <span class="hljs-comment">//盖普通房子</span><br>      <span class="hljs-type">CommonHouse</span> <span class="hljs-variable">commonHouse</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CommonHouse</span>();<br>      <span class="hljs-comment">//准备创建房子的指挥者</span><br>      <span class="hljs-type">HouseDirector</span> <span class="hljs-variable">houseDirector</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HouseDirector</span>(commonHouse);<br>      <br>      <span class="hljs-comment">//完成盖房子，返回产品(普通房子)</span><br>      <span class="hljs-type">House</span> <span class="hljs-variable">house</span> <span class="hljs-operator">=</span> houseDirector.constructHouse();<br>      <br>      <span class="hljs-comment">//System.out.println(&quot;输出流程&quot;);</span><br>      <br>      System.out.println(<span class="hljs-string">&quot;--------------------------&quot;</span>);<br>      <span class="hljs-comment">//盖高楼</span><br>      <span class="hljs-type">HighBuilding</span> <span class="hljs-variable">highBuilding</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HighBuilding</span>();<br>      <span class="hljs-comment">//重置建造者</span><br>      houseDirector.setHouseBuilder(highBuilding);<br>      <span class="hljs-comment">//完成盖房子，返回产品(高楼)</span><br>      houseDirector.constructHouse();<br><br>         &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<blockquote>
<p>执行程序，输出结果：</p>
</blockquote>
<p>普通房子打地基5米<br />
普通房子砌墙10cm</p>
<p>普通房子屋顶</p>
<p>高楼的打地基100米<br />
高楼的砌墙20cm<br />
高楼的透明屋顶</p>
<h2 id="建造者模式在-jdk-的应用和源码分析"><a class="markdownIt-Anchor" href="#建造者模式在-jdk-的应用和源码分析"></a> 建造者模式在 JDK 的应用和源码分析</h2>
<ol>
<li>
<p>java.lang.StringBuilder 中的建造者模式</p>
</li>
<li>
<p>代码说明+Debug 源码</p>
</li>
</ol>
<ol>
<li>
<p>Appendable 接口定义了多个 append 方法(抽象方法), 即 Appendable 为抽象建造者, 定义了抽象方法</p>
<p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221224214505679.png" srcset="/img/loading.gif" lazyload alt="image-20221224214505679" /></p>
</li>
<li>
<p>AbstractStringBuilder 实现了 Appendable 接口方法，这里的 AbstractStringBuilder</p>
<p>已经是建造者，只是不能实例化</p>
<p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221224220521554.png" srcset="/img/loading.gif" lazyload alt="image-20221224220521554" /></p>
</li>
<li>
<p>StringBuilder 即充当了指挥者角色，同时充当了具体的建造者，建造方法的实现是由 AbstractStringBuilder 完成, 而 StringBuilder 继承了 AbstractStringBuilder</p>
<p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221224220732126.png" srcset="/img/loading.gif" lazyload alt="image-20221224220732126" /></p>
</li>
</ol>
<h2 id="建造者模式的注意事项和细节"><a class="markdownIt-Anchor" href="#建造者模式的注意事项和细节"></a> 建造者模式的注意事项和细节</h2>
<ol>
<li>
<p>客户端(使用程序)不必知道产品内部组成的细节，将产品本身与产品的创建过程解耦，使得相同的创建过程可以创建不同的产品对象</p>
</li>
<li>
<p>每一个具体建造者都相对独立，而与其他的具体建造者无关，因此可以很方便地替换具体建造者或增加新的具体建造者， 用户使用不同的具体建造者即可得到不同的产品对象</p>
</li>
<li>
<p>可以更加精细地控制产品的创建过程 。将复杂产品的创建步骤分解在不同的方法中，使得创建过程更加清晰，也更方便使用程序来控制创建过程</p>
</li>
<li>
<p>增加新的具体建造者无须修改原有类库的代码，指挥者类针对抽象建造者类编程，系统扩展方便，符合“开闭原则”</p>
</li>
<li>
<p>建造者模式所创建的产品一般具有较多的共同点，其组成部分相似，如果产品之间的差异性很大，则不适合使用建造者模式，因此其使用范围受到一定的限制。</p>
</li>
<li>
<p>如果产品的内部变化复杂，可能会导致需要定义很多具体建造者类来实现这种变化，导致系统变得很庞大，因此在这种情况下，要考虑是否选择建造者模式.</p>
</li>
<li>
<p>抽象工厂模式 VS 建造者模式</p>
<p>抽象工厂模式实现对产品家族的创建，一个产品家族是这样的一系列产品：具有不同分类维度的产品组合，采用抽象工厂模式不需要关心构建过程，只关心什么产品由什么工厂生产即可。而建造者模式则是要求按照指定的蓝图建造产品，它的主要目的是通过组装零配件而产生一个新产品</p>
</li>
</ol>
<h1 id="适配器模式"><a class="markdownIt-Anchor" href="#适配器模式"></a> 🌕适配器模式</h1>
<p>适配器模式（Adapter Pattern）是作为两个不兼容的接口之间的桥梁。这种类型的设计模式属于结构型模式，它结合了两个独立接口的功能。</p>
<p>这种模式涉及到一个单一的类，该类负责加入独立的或不兼容的接口功能。举个真实的例子，读卡器是作为内存卡和笔记本之间的适配器。您将内存卡插入读卡器，再将读卡器插入笔记本，这样就可以通过笔记本来读取内存卡。</p>
<p>我们通过下面的实例来演示适配器模式的使用。其中，音频播放器设备只能播放 mp3 文件，通过使用一个更高级的音频播放器来播放 vlc 和 mp4 文件。</p>
<h2 id="介绍-5"><a class="markdownIt-Anchor" href="#介绍-5"></a> 介绍</h2>
<p><strong>意图：</strong> 将一个类的接口转换成客户希望的另外一个接口。适配器模式使得原本由于接口不兼容而不能一起工作的那些类可以一起工作。</p>
<p><strong>主要解决：</strong> 主要解决在软件系统中，常常要将一些&quot;现存的对象&quot;放到新的环境中，而新环境要求的接口是现对象不能满足的。</p>
<p><strong>何时使用：</strong></p>
<p>1、系统需要使用现有的类，而此类的接口不符合系统的需要。</p>
<p>2、想要建立一个可以重复使用的类，用于与一些彼此之间没有太大关联的一些类，包括一些可能在将来引进的类一起工作，这些源类不一定有一致的接口。</p>
<p>3、通过接口转换，将一个类插入另一个类系中。（比如老虎和飞禽，现在多了一个飞虎，在不增加实体的需求下，增加一个适配器，在里面包容一个虎对象，实现飞的接口。）</p>
<p><strong>如何解决：</strong> 继承或依赖（推荐）。</p>
<p><strong>关键代码：</strong> 适配器继承或依赖已有的对象，实现想要的目标接口。</p>
<p><strong>应用实例：</strong></p>
<p>1、美国电器 110V，中国 220V，就要有一个适配器将 110V 转化为 220V。</p>
<p>2、JAVA JDK 1.1 提供了Enumeration 接口，而在 1.2 中提供了 Iterator 接口，想要使用 1.2 的 JDK，则要将以前系统的 Enumeration接口转化为 Iterator 接口，这时就需要适配器模式。</p>
<p>3、在 LINUX 上运行 WINDOWS 程序。</p>
<p>4、JAVA 中的 jdbc。</p>
<p><strong>优点：</strong></p>
<p>1、可以让任何两个没有关联的类一起运行。</p>
<p>2、提高了类的复用。</p>
<p>3、增加了类的透明度。</p>
<p>4、灵活性好。</p>
<p><strong>缺点：</strong></p>
<p>1、过多地使用适配器，会让系统非常零乱，不易整体进行把握。比如，明明看到调用的是 A 接口，其实内部被适配成了 B接口的实现，一个系统如果太多出现这种情况，无异于一场灾难。因此如果不是很有必要，可以不使用适配器，而是直接对系统进行重构。</p>
<p>2.由于 JAVA至多继承一个类，所以至多只能适配一个适配者类，而且目标类必须是抽象类。</p>
<p><strong>使用场景：</strong> 有动机地修改一个正常运行的系统的接口，这时应该考虑使用适配器模式。</p>
<p><strong>注意事项：</strong> 适配器不是在详细设计时添加的，而是解决正在服役的项目的问题。</p>
<p><strong>用户收到反馈结果，感觉只是和目标接口交互</strong></p>
<p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221225155334445.png" srcset="/img/loading.gif" lazyload alt="image-20221225155334445" /></p>
<h2 id="类适配器模式"><a class="markdownIt-Anchor" href="#类适配器模式"></a> 类适配器模式</h2>
<h3 id="类适配器模式介绍"><a class="markdownIt-Anchor" href="#类适配器模式介绍"></a> 类适配器模式介绍</h3>
<p>基本介绍：Adapter 类，通过继承 src 类，实现 dst 类接口，完成 src-&gt;dst 的适配。</p>
<h3 id="类适配器模式应用实例"><a class="markdownIt-Anchor" href="#类适配器模式应用实例"></a> 类适配器模式应用实例</h3>
<p>应用实例说明</p>
<p>以生活中充电器的例子来讲解适配器，充电器本身相当于 Adapter，220V 交流电相当于 src (即被适配者)，我们的目 dst(即 目标)是 5V 直流电</p>
<p>思路分析(类图)</p>
<p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221225161720849.png" srcset="/img/loading.gif" lazyload alt="image-20221225161720849" /></p>
<p><code>IVoltage5V</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.adapter.objectadapter;<br><br><br><span class="hljs-comment">//适配接口</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">IVoltage5V</span> &#123;<br>   <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">output5V</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>Voltage220V</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.adapter.objectadapter;<br><br><span class="hljs-comment">//被适配的类</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Voltage220V</span> &#123;<br>   <span class="hljs-comment">//输出220V的电压，不变</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">output220V</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-type">int</span> <span class="hljs-variable">src</span> <span class="hljs-operator">=</span> <span class="hljs-number">220</span>;<br>      System.out.println(<span class="hljs-string">&quot;电压=&quot;</span> + src + <span class="hljs-string">&quot;伏&quot;</span>);<br>      <span class="hljs-keyword">return</span> src;<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>VoltageAdapter</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.adapter.classadapter;<br><br><span class="hljs-comment">//适配器类</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VoltageAdapter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Voltage220V</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IVoltage5V</span> &#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">output5V</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-comment">//获取到220V电压</span><br>      <span class="hljs-type">int</span> <span class="hljs-variable">srcV</span> <span class="hljs-operator">=</span> output220V();<br>      <span class="hljs-type">int</span> <span class="hljs-variable">dstV</span> <span class="hljs-operator">=</span> srcV / <span class="hljs-number">44</span> ; <span class="hljs-comment">//转成 5v</span><br>      <span class="hljs-keyword">return</span> dstV;<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>Phone</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.adapter.objectadapter;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Phone</span> &#123;<br><br>   <span class="hljs-comment">//充电</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">charging</span><span class="hljs-params">(IVoltage5V iVoltage5V)</span> &#123;<br>      <span class="hljs-keyword">if</span>(iVoltage5V.output5V() == <span class="hljs-number">5</span>) &#123;<br>         System.out.println(<span class="hljs-string">&quot;电压为5V, 可以充电~~&quot;</span>);<br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (iVoltage5V.output5V() &gt; <span class="hljs-number">5</span>) &#123;<br>         System.out.println(<span class="hljs-string">&quot;电压大于5V, 不能充电~~&quot;</span>);<br>      &#125;<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>Client</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.adapter.classadapter;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br><br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>		<span class="hljs-comment">// TODO Auto-generated method stub</span><br>		System.out.println(<span class="hljs-string">&quot;  类适配器模式 &quot;</span>);<br>		<span class="hljs-type">Phone</span> <span class="hljs-variable">phone</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Phone</span>();<br>		phone.charging(<span class="hljs-keyword">new</span> <span class="hljs-title class_">VoltageAdapter</span>());<br>	&#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure>
<blockquote>
<p>执行程序，输出结果：</p>
</blockquote>
<p>类适配器模式<br />
电压=220伏<br />
电压为5V, 可以充电~~</p>
<h3 id="类适配器模式注意事项和细节"><a class="markdownIt-Anchor" href="#类适配器模式注意事项和细节"></a> 类适配器模式注意事项和细节</h3>
<ol>
<li>
<p>Java 是单继承机制，所以类适配器需要继承 src 类这一点算是一个缺点, 因为这要求 dst 必须是接口，有一定局限性;</p>
</li>
<li>
<p>src 类的方法在 Adapter 中都会暴露出来，也增加了使用的成本。</p>
</li>
<li>
<p>由于其继承了 src 类，所以它可以根据需求重写 src 类的方法，使得 Adapter 的灵活性增强了。</p>
</li>
</ol>
<h2 id="对象适配器模式"><a class="markdownIt-Anchor" href="#对象适配器模式"></a> 对象适配器模式</h2>
<h3 id="对象适配器模式介绍"><a class="markdownIt-Anchor" href="#对象适配器模式介绍"></a> 对象适配器模式介绍</h3>
<ol>
<li>
<p>基本思路和类的适配器模式相同，只是将 Adapter 类作修改，不是继承 src 类，而是持有 src 类的实例，以解决兼容性的问题。 即：持有 src 类，实现 dst 类接口，完成 src-&gt;dst 的适配</p>
</li>
<li>
<p>根据“<strong>合成复用原则</strong>”，在系统中尽量使用<strong>关联关系（聚合）来替代继承</strong>关系。</p>
</li>
<li>
<p>对象适配器模式是适配器模式常用的一种</p>
</li>
</ol>
<h3 id="对象适配器模式应用实例"><a class="markdownIt-Anchor" href="#对象适配器模式应用实例"></a> 对象适配器模式应用实例</h3>
<ol>
<li>应用实例说明</li>
</ol>
<p>以生活中充电器的例子来讲解适配器，充电器本身相当于 Adapter，220V 交流电相当于 src (即被适配者)，我们的目 dst(即目标)是 5V 直流电，使用对象适配器模式完成。</p>
<ol start="2">
<li>思路分析(类图)：只需修改适配器即可, 如下</li>
</ol>
<p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221225161754203.png" srcset="/img/loading.gif" lazyload alt="image-20221225161754203" /></p>
<p><code>VoltageAdapter</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.adapter.classadapter;<br><br><span class="hljs-comment">//适配器类</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VoltageAdapter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Voltage220V</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IVoltage5V</span> &#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">output5V</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-comment">//获取到220V电压</span><br>      <span class="hljs-type">int</span> <span class="hljs-variable">srcV</span> <span class="hljs-operator">=</span> output220V();<br>      <span class="hljs-type">int</span> <span class="hljs-variable">dstV</span> <span class="hljs-operator">=</span> srcV / <span class="hljs-number">44</span> ; <span class="hljs-comment">//转成 5v</span><br>      <span class="hljs-keyword">return</span> dstV;<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>Client</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.adapter.objectadapter;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br><br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>		<span class="hljs-comment">// TODO Auto-generated method stub</span><br>		System.out.println(<span class="hljs-string">&quot; 对象适配器模式 &quot;</span>);<br>		<span class="hljs-type">Phone</span> <span class="hljs-variable">phone</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Phone</span>();<br>		phone.charging(<span class="hljs-keyword">new</span> <span class="hljs-title class_">VoltageAdapter</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Voltage220V</span>()));<br>	&#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure>
<blockquote>
<p>执行程序，输出结果：</p>
</blockquote>
<p>对象适配器模式<br />
电压=220伏<br />
使用对象适配器，进行适配~~<br />
适配完成，输出的电压为=5<br />
电压为5V, 可以充电~~</p>
<h3 id="对象适配器模式注意事项和细节"><a class="markdownIt-Anchor" href="#对象适配器模式注意事项和细节"></a> 对象适配器模式注意事项和细节</h3>
<ol>
<li>对象适配器和类适配器其实算是同一种思想，只不过实现方式不同。</li>
</ol>
<p>根据合成复用原则，使用组合替代继承， 所以它解决了类适配器必须继承 src 的局限性问题，也不再要求 dst必须是接口。</p>
<ol start="2">
<li>使用成本更低，更灵活</li>
</ol>
<h2 id="接口适配器模式"><a class="markdownIt-Anchor" href="#接口适配器模式"></a> 接口适配器模式</h2>
<h3 id="接口适配器模式介绍"><a class="markdownIt-Anchor" href="#接口适配器模式介绍"></a> 接口适配器模式介绍</h3>
<ol>
<li>
<p>一些书籍称为：适配器模式(Default Adapter Pattern)或<strong>缺省适配器模式</strong>。</p>
</li>
<li>
<p>核心思路：当<strong>不需要全部实现接口ᨀ 供的方法</strong>时，可先<strong>设计一个抽象类</strong>实现<strong>接口</strong>，并为该接口中每个方法 供一个<strong>默认实现（空方法）</strong>，那么该<strong>抽象类的子类可有选择地覆盖父类的某些方法</strong>来实现需求</p>
</li>
<li>
<p>适用于一个接口不想使用其所有的方法的情况。</p>
</li>
</ol>
<h3 id="接口适配器模式应用实例"><a class="markdownIt-Anchor" href="#接口适配器模式应用实例"></a> 接口适配器模式应用实例</h3>
<p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221225163021962.png" srcset="/img/loading.gif" lazyload alt="image-20221225163021962" /></p>
<p><code>Interface4</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.adapter.interfaceadapter;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Interface4</span> &#123;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">m1</span><span class="hljs-params">()</span>;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">m2</span><span class="hljs-params">()</span>;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">m3</span><span class="hljs-params">()</span>;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">m4</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>AbsAdapter</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.adapter.interfaceadapter;<br><br><span class="hljs-comment">//在AbsAdapter 我们将 Interface4 的方法进行默认实现</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AbsAdapter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Interface4</span> &#123;<br><br>   <span class="hljs-comment">//默认实现</span><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">m1</span><span class="hljs-params">()</span> &#123;<br><br>   &#125;<br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">m2</span><span class="hljs-params">()</span> &#123;<br><br>   &#125;<br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">m3</span><span class="hljs-params">()</span> &#123;<br><br>   &#125;<br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">m4</span><span class="hljs-params">()</span> &#123;<br><br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>Client</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.adapter.interfaceadapter;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>		<br>		<span class="hljs-type">AbsAdapter</span> <span class="hljs-variable">absAdapter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AbsAdapter</span>() &#123;<br>			<span class="hljs-comment">//只需要去覆盖我们 需要使用 接口方法</span><br>			<span class="hljs-meta">@Override</span><br>			<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">m1</span><span class="hljs-params">()</span> &#123;<br>				<span class="hljs-comment">// TODO Auto-generated method stub</span><br>				System.out.println(<span class="hljs-string">&quot;使用了m1的方法&quot;</span>);<br>			&#125;<br>		&#125;;<br><br>		System.out.println(<span class="hljs-string">&quot;要使用的方法输出：&quot;</span>);<br>		absAdapter.m1();<br>		System.out.println(<span class="hljs-string">&quot;不要使用的方法输出：&quot;</span>);<br>		absAdapter.m2();<br>		System.out.println(<span class="hljs-string">&quot;使用结束&quot;</span>);<br>	&#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>
<blockquote>
<p>执行程序，输出结果：</p>
</blockquote>
<p>要使用的方法输出：<br />
使用了m1的方法<br />
不要使用的方法输出：<br />
使用结束</p>
<h2 id="适配器模式在-springmvc-框架应用的源码剖析"><a class="markdownIt-Anchor" href="#适配器模式在-springmvc-框架应用的源码剖析"></a> 适配器模式在 SpringMVC 框架应用的源码剖析</h2>
<ol>
<li>
<p>SpringMvc 中的 <strong>HandlerAdapter,</strong> 就使用了适配器模式</p>
</li>
<li>
<p>SpringMVC 处理请求的流程回顾</p>
</li>
<li>
<p>使用 HandlerAdapter 的原因分析:</p>
</li>
</ol>
<p>可以看到处理器的类型不同，有多重实现方式，那么调用方式就不是确定的，如果需要直接调用 Controller 方法，需要调用的时候就得不断是使用 if else 来进行判断是哪一种子类然后执行。那么如果后面要扩展 Controller，就得修改原来的代码，这样违背了 OCP 原则。</p>
<ol start="4">
<li>
<p>代码分析+Debug 源码</p>
</li>
<li>
<p>动手写 SpringMVC 通过适配器设计模式获取到对应的 Controller 的源码</p>
</li>
</ol>
<p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221225172743411.png" srcset="/img/loading.gif" lazyload alt="image-20221225172743411" /></p>
<p><code>各类Controller</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.adapter.springmvc;<br><br><span class="hljs-comment">//多种Controller实现  </span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Controller</span> &#123;<br><br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">HttpController</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Controller</span> &#123;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doHttpHandler</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;http...&quot;</span>);<br>   &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleController</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Controller</span> &#123;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doSimplerHandler</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;simple...&quot;</span>);<br>   &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">AnnotationController</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Controller</span> &#123;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doAnnotationHandler</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;annotation...&quot;</span>);<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>各类适配器</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.adapter.springmvc;<br><br><span class="hljs-comment">///定义一个Adapter接口 </span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">HandlerAdapter</span> &#123;<br>   <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">supports</span><span class="hljs-params">(Object handler)</span>;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handle</span><span class="hljs-params">(Object handler)</span>;<br>&#125;<br><br><span class="hljs-comment">// 多种适配器类</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleHandlerAdapter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerAdapter</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handle</span><span class="hljs-params">(Object handler)</span> &#123;<br>      ((SimpleController) handler).doSimplerHandler();<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">supports</span><span class="hljs-params">(Object handler)</span> &#123;<br>      <span class="hljs-keyword">return</span> (handler <span class="hljs-keyword">instanceof</span> SimpleController);<br>   &#125;<br><br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">HttpHandlerAdapter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerAdapter</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handle</span><span class="hljs-params">(Object handler)</span> &#123;<br>      ((HttpController) handler).doHttpHandler();<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">supports</span><span class="hljs-params">(Object handler)</span> &#123;<br>      <span class="hljs-keyword">return</span> (handler <span class="hljs-keyword">instanceof</span> HttpController);<br>   &#125;<br><br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">AnnotationHandlerAdapter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerAdapter</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handle</span><span class="hljs-params">(Object handler)</span> &#123;<br>      ((AnnotationController) handler).doAnnotationHandler();<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">supports</span><span class="hljs-params">(Object handler)</span> &#123;<br><br>      <span class="hljs-keyword">return</span> (handler <span class="hljs-keyword">instanceof</span> AnnotationController);<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>DispatchServlet</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.adapter.springmvc;<br><br><span class="hljs-keyword">import</span> java.util.ArrayList;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DispatchServlet</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> List&lt;HandlerAdapter&gt; handlerAdapters = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;HandlerAdapter&gt;();<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">DispatchServlet</span><span class="hljs-params">()</span> &#123;<br>      handlerAdapters.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">AnnotationHandlerAdapter</span>());<br>      handlerAdapters.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpHandlerAdapter</span>());<br>      handlerAdapters.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleHandlerAdapter</span>());<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doDispatch</span><span class="hljs-params">()</span> &#123;<br><br>      <span class="hljs-comment">// 此处模拟SpringMVC从request取handler的对象，</span><br>      <span class="hljs-comment">// 适配器可以获取到希望的Controller</span><br>       <span class="hljs-type">HttpController</span> <span class="hljs-variable">controller</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpController</span>();<br>      <span class="hljs-comment">// AnnotationController controller = new AnnotationController();</span><br>      <span class="hljs-comment">//SimpleController controller = new SimpleController();</span><br>      <span class="hljs-comment">// 得到对应适配器</span><br>      <span class="hljs-type">HandlerAdapter</span> <span class="hljs-variable">adapter</span> <span class="hljs-operator">=</span> getHandler(controller);<br>      <span class="hljs-comment">// 通过适配器执行对应的controller对应方法</span><br>      adapter.handle(controller);<br><br>   &#125;<br><br>   <span class="hljs-keyword">public</span> HandlerAdapter <span class="hljs-title function_">getHandler</span><span class="hljs-params">(Controller controller)</span> &#123;<br>      <span class="hljs-comment">//遍历：根据得到的controller(handler), 返回对应适配器</span><br>      <span class="hljs-keyword">for</span> (HandlerAdapter adapter : <span class="hljs-built_in">this</span>.handlerAdapters) &#123;<br>         <span class="hljs-keyword">if</span> (adapter.supports(controller)) &#123;<br>            <span class="hljs-keyword">return</span> adapter;<br>         &#125;<br>      &#125;<br>      <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-keyword">new</span> <span class="hljs-title class_">DispatchServlet</span>().doDispatch(); <span class="hljs-comment">// http...</span><br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="适配器模式的注意事项和细节"><a class="markdownIt-Anchor" href="#适配器模式的注意事项和细节"></a> 适配器模式的注意事项和细节</h2>
<ol>
<li>
<p>三种命名方式，是根据 src 是以怎样的形式给到 Adapter（在 Adapter 里的形式）来命名的。</p>
</li>
<li></li>
</ol>
<ol>
<li>类适配器：以类给到，在 Adapter 里，就是将 src 当做类，继承</li>
<li>对象适配器：以对象给到，在 Adapter 里，将 src 作为一个对象，持有</li>
<li>接口适配器：以接口给到，在 Adapter 里，将 src 作为一个接口，实现</li>
</ol>
<ol start="3">
<li>
<p>Adapter 模式最大的作用还是将原本不兼容的接口融合在一起工作。</p>
</li>
<li>
<p>实际开发中，实现起来不拘泥于我们讲解的三种经典形式</p>
</li>
</ol>
<h1 id="桥接模式"><a class="markdownIt-Anchor" href="#桥接模式"></a> 🌗桥接模式</h1>
<p>桥接（Bridge）是用于把抽象化与实现化解耦，使得二者可以独立变化。这种类型的设计模式属于结构型模式，它通过提供抽象化和实现化之间的桥接结构，来实现二者的解耦。</p>
<p>这种模式涉及到一个作为桥接的接口，使得实体类的功能独立于接口实现类。这两种类型的类可被结构化改变而互不影响。</p>
<hr />
<h2 id="介绍-6"><a class="markdownIt-Anchor" href="#介绍-6"></a> 介绍</h2>
<p><strong>意图：</strong> 将抽象部分与实现部分分离，使它们都可以独立的变化。</p>
<p><strong>主要解决：</strong> 在有多种可能会变化的情况下，用继承会造成类爆炸问题，扩展起来不灵活。</p>
<p><strong>何时使用：</strong> 实现系统可能有多个角度分类，每一种角度都可能变化。</p>
<p><strong>如何解决：</strong> 把这种多角度分类分离出来，让它们独立变化，减少它们之间耦合。</p>
<p><strong>关键代码：</strong> 抽象类依赖实现类。</p>
<p><strong>应用实例：</strong><br />
1、猪八戒从天蓬元帅转世投胎到猪，转世投胎的机制将尘世划分为两个等级，即：灵魂和肉体，前者相当于抽象化，后者相当于实现化。生灵通过功能的委派，调用肉体对象的功能，使得生灵可以动态地选择。<br />
2、墙上的开关，可以看到的开关是抽象的，不用管里面具体怎么实现的。</p>
<p><strong>优点：</strong> 1、抽象和实现的分离。 2、优秀的扩展能力。 3、实现细节对客户透明。</p>
<p><strong>缺点：</strong> 桥接模式的引入会增加系统的理解与设计难度，由于聚合关联关系建立在抽象层，要求开发者针对抽象进行设计与编程。</p>
<p><strong>使用场景：</strong><br />
1、如果一个系统需要在构件的抽象化角色和具体化角色之间增加更多的灵活性，避免在两个层次之间建立静态的继承联系，通过桥接模式可以使它们在抽象层建立一个关联关系。<br />
2、对于那些不希望使用继承或因为多层次继承导致系统类的个数急剧增加的系统，桥接模式尤为适用。 3、一个类存在两个独立变化的维度，且这两个维度都需要进行扩展。</p>
<p><strong>注意事项：</strong> 对于两个独立变化的维度，使用桥接模式再适合不过了。</p>
<p><strong>原理类图：</strong><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230102143047364.png" srcset="/img/loading.gif" lazyload alt="image-20230102143047364" /></p>
<h2 id="实现-4"><a class="markdownIt-Anchor" href="#实现-4"></a> 实现</h2>
<p>手机操作问题</p>
<p>现在对不同手机类型的不同品牌实现操作编程(比如:开机、关机、上网，打电话等)，如图:</p>
<p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230102144821435.png" srcset="/img/loading.gif" lazyload alt="image-20230102144821435" /></p>
<p>使用桥接模式对应的类图</p>
<p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230102145034564.png" srcset="/img/loading.gif" lazyload alt="image-20230102145034564" /></p>
<p><code>Brand</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.bridge;<br><br><span class="hljs-comment">//接口</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Brand</span> &#123;<br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">open</span><span class="hljs-params">()</span>;<br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">close</span><span class="hljs-params">()</span>;<br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">call</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>XiaoMi</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.bridge;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">XiaoMi</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Brand</span> &#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">open</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot; 小米手机开机 &quot;</span>);<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">close</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot; 小米手机关机 &quot;</span>);<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">call</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot; 小米手机打电话 &quot;</span>);<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>Vivo</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.bridge;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Vivo</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Brand</span> &#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">open</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot; Vivo手机开机 &quot;</span>);<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">close</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot; Vivo手机关机 &quot;</span>);<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">call</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot; Vivo手机打电话 &quot;</span>);<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>Phone</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.bridge;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Phone</span> &#123;<br>   <br>   <span class="hljs-comment">//组合品牌</span><br>   <span class="hljs-keyword">private</span> Brand brand;<br><br>   <span class="hljs-comment">//构造器</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">Phone</span><span class="hljs-params">(Brand brand)</span> &#123;<br>      <span class="hljs-built_in">super</span>();<br>      <span class="hljs-built_in">this</span>.brand = brand;<br>   &#125;<br>   <br>   <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">open</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-built_in">this</span>.brand.open();<br>   &#125;<br>   <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">close</span><span class="hljs-params">()</span> &#123;<br>      brand.close();<br>   &#125;<br>   <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">call</span><span class="hljs-params">()</span> &#123;<br>      brand.call();<br>   &#125;<br>   <br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>FoldedPhone</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.bridge;<br><br><br><span class="hljs-comment">//折叠式手机类，继承 抽象类 Phone</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FoldedPhone</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Phone</span> &#123;<br><br>   <span class="hljs-comment">//构造器</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">FoldedPhone</span><span class="hljs-params">(Brand brand)</span> &#123;<br>      <span class="hljs-built_in">super</span>(brand);<br>   &#125;<br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">open</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-built_in">super</span>.open();<br>      System.out.println(<span class="hljs-string">&quot; 折叠样式手机 &quot;</span>);<br>   &#125;<br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">close</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-built_in">super</span>.close();<br>      System.out.println(<span class="hljs-string">&quot; 折叠样式手机 &quot;</span>);<br>   &#125;<br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">call</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-built_in">super</span>.call();<br>      System.out.println(<span class="hljs-string">&quot; 折叠样式手机 &quot;</span>);<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>UpRightPhone</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.bridge;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UpRightPhone</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Phone</span> &#123;<br>   <br>      <span class="hljs-comment">//构造器</span><br>      <span class="hljs-keyword">public</span> <span class="hljs-title function_">UpRightPhone</span><span class="hljs-params">(Brand brand)</span> &#123;<br>         <span class="hljs-built_in">super</span>(brand);<br>      &#125;<br>      <br>      <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">open</span><span class="hljs-params">()</span> &#123;<br>         <span class="hljs-built_in">super</span>.open();<br>         System.out.println(<span class="hljs-string">&quot; 直立样式手机 &quot;</span>);<br>      &#125;<br>      <br>      <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">close</span><span class="hljs-params">()</span> &#123;<br>         <span class="hljs-built_in">super</span>.close();<br>         System.out.println(<span class="hljs-string">&quot; 直立样式手机 &quot;</span>);<br>      &#125;<br>      <br>      <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">call</span><span class="hljs-params">()</span> &#123;<br>         <span class="hljs-built_in">super</span>.call();<br>         System.out.println(<span class="hljs-string">&quot; 直立样式手机 &quot;</span>);<br>      &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>Client</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.bridge;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <br>      <span class="hljs-comment">//获取折叠式手机 (样式 + 品牌 )</span><br>      <br>      <span class="hljs-type">Phone</span> <span class="hljs-variable">phone1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FoldedPhone</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">XiaoMi</span>());<br>      <br>      phone1.open();<br>      phone1.call();<br>      phone1.close();<br>      <br>      System.out.println(<span class="hljs-string">&quot;----------------------&quot;</span>);<br>      <br>      <span class="hljs-type">Phone</span> <span class="hljs-variable">phone2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FoldedPhone</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Vivo</span>());<br>      <br>      phone2.open();<br>      phone2.call();<br>      phone2.close();<br>      <br>      System.out.println(<span class="hljs-string">&quot;--------------&quot;</span>);<br><br>      <span class="hljs-type">Phone</span> <span class="hljs-variable">phone3</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UpRightPhone</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">XiaoMi</span>());<br>      <br>      phone3.open();<br>      phone3.call();<br>      phone3.close();<br>      <br>      System.out.println(<span class="hljs-string">&quot;--------------&quot;</span>);<br><br>      <span class="hljs-type">Phone</span> <span class="hljs-variable">phone4</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UpRightPhone</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Vivo</span>());<br>      <br>      phone4.open();<br>      phone4.call();<br>      phone4.close();<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<blockquote>
<p>执行程序，输出结果：</p>
</blockquote>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">小米手机开机 <br><span class="hljs-code"> 折叠样式手机 </span><br><span class="hljs-code"> 小米手机打电话 </span><br><span class="hljs-code"> 折叠样式手机 </span><br><span class="hljs-code"> 小米手机关机 </span><br><span class="hljs-code"> 折叠样式手机 </span><br><br>++++++++++++++++++++++<br><br> Vivo手机开机 <br> 折叠样式手机 <br> Vivo手机打电话 <br> 折叠样式手机 <br> Vivo手机关机 <br> 折叠样式手机 <br><br>++++++++++++++<br><br><span class="hljs-code"> 小米手机开机 </span><br><span class="hljs-code"> 直立样式手机 </span><br><span class="hljs-code"> 小米手机打电话 </span><br><span class="hljs-code"> 直立样式手机 </span><br><span class="hljs-code"> 小米手机关机 </span><br><span class="hljs-code"> 直立样式手机 </span><br><br>++++++++++++++<br><br> Vivo手机开机 <br> 直立样式手机 <br> Vivo手机打电话 <br> 直立样式手机 <br> Vivo手机关机 <br> 直立样式手机 <br></code></pre></td></tr></table></figure>
<p>增加手机样式类</p>
<p><code>SildePhone</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.bridge;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 新添旋转样式手机</span><br><span class="hljs-comment"> * [io.xtwoy.bridge]</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> : [席子不会敲代码]</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> : [V1.0]</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@date</span> : [2023/1/2 15:06]</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SildePhone</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Phone</span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SildePhone</span><span class="hljs-params">(Brand brand)</span> &#123;<br>        <span class="hljs-built_in">super</span>(brand);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">open</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">super</span>.open();<br>        System.out.println(<span class="hljs-string">&quot; 旋转样式手机 &quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">close</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">super</span>.close();<br>        System.out.println(<span class="hljs-string">&quot; 旋转样式手机 &quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">call</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">super</span>.call();<br>        System.out.println(<span class="hljs-string">&quot; 旋转样式手机 &quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>增加手机品牌</p>
<p><code>iPhone</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.bridge;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * [io.xtwoy.bridge]</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> : [席子不会敲代码]</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> : [V1.0]</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@date</span> : [2023/1/2 14:56]</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">iPhone</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Brand</span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">open</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot; 苹果开机&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">close</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot; 苹果关机&quot;</span>);<br><br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">call</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot; 苹果打电话&quot;</span>);<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>Client</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.bridge;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><br>        <span class="hljs-comment">//获取折叠式手机 (样式 + 品牌 )</span><br><br>        <span class="hljs-type">Phone</span> <span class="hljs-variable">phone1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FoldedPhone</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">XiaoMi</span>());<br><br>        phone1.open();<br>        phone1.call();<br>        phone1.close();<br><br>        System.out.println(<span class="hljs-string">&quot;++++++++++++++++++++++&quot;</span>);<br><br>        <span class="hljs-type">Phone</span> <span class="hljs-variable">phone2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FoldedPhone</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Vivo</span>());<br><br>        phone2.open();<br>        phone2.call();<br>        phone2.close();<br><br>        System.out.println(<span class="hljs-string">&quot;++++++++++++++&quot;</span>);<br><br>        <span class="hljs-type">Phone</span> <span class="hljs-variable">phone3</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UpRightPhone</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">XiaoMi</span>());<br><br>        phone3.open();<br>        phone3.call();<br>        phone3.close();<br><br>        System.out.println(<span class="hljs-string">&quot;++++++++++++++&quot;</span>);<br><br>        <span class="hljs-type">Phone</span> <span class="hljs-variable">phone4</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UpRightPhone</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Vivo</span>());<br><br>        phone4.open();<br>        phone4.call();<br>        phone4.close();<br><br>        System.out.println(<span class="hljs-string">&quot;++++++++++++++&quot;</span>);<br><br>        <span class="hljs-type">Phone</span> <span class="hljs-variable">phone5</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FoldedPhone</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">iPhone</span>());<br><br>        phone5.open();<br>        phone5.call();<br>        phone5.close();<br><br><br>        System.out.println(<span class="hljs-string">&quot;++++++++++++++&quot;</span>);<br><br>        <span class="hljs-type">Phone</span> <span class="hljs-variable">phone6</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UpRightPhone</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">iPhone</span>());<br><br>        phone6.open();<br>        phone6.call();<br>        phone6.close();<br><br><br>        System.out.println(<span class="hljs-string">&quot;++++++++++++++&quot;</span>);<br><br>        <span class="hljs-type">SildePhone</span> <span class="hljs-variable">phone7</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SildePhone</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">XiaoMi</span>());<br><br>        phone7.open();<br>        phone7.call();<br>        phone7.close();<br><br>        System.out.println(<span class="hljs-string">&quot;++++++++++++++&quot;</span>);<br>    &#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure>
<blockquote>
<p>执行程序，输出结果：</p>
</blockquote>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-code"> 小米手机开机 </span><br><span class="hljs-code"> 折叠样式手机 </span><br><span class="hljs-code"> 小米手机打电话 </span><br><span class="hljs-code"> 折叠样式手机 </span><br><span class="hljs-code"> 小米手机关机 </span><br><span class="hljs-section"> 折叠样式手机 </span><br><span class="hljs-section">++++++++++++++++++++++</span><br><span class="hljs-code"> Vivo手机开机 </span><br><span class="hljs-code"> 折叠样式手机 </span><br><span class="hljs-code"> Vivo手机打电话 </span><br><span class="hljs-code"> 折叠样式手机 </span><br><span class="hljs-code"> Vivo手机关机 </span><br><span class="hljs-section"> 折叠样式手机 </span><br><span class="hljs-section">++++++++++++++</span><br><span class="hljs-code"> 小米手机开机 </span><br><span class="hljs-code"> 直立样式手机 </span><br><span class="hljs-code"> 小米手机打电话 </span><br><span class="hljs-code"> 直立样式手机 </span><br><span class="hljs-code"> 小米手机关机 </span><br><span class="hljs-section"> 直立样式手机 </span><br><span class="hljs-section">++++++++++++++</span><br><span class="hljs-code"> Vivo手机开机 </span><br><span class="hljs-code"> 直立样式手机 </span><br><span class="hljs-code"> Vivo手机打电话 </span><br><span class="hljs-code"> 直立样式手机 </span><br><span class="hljs-code"> Vivo手机关机 </span><br><span class="hljs-section"> 直立样式手机 </span><br><span class="hljs-section">++++++++++++++</span><br><span class="hljs-code"> 苹果开机</span><br><span class="hljs-code"> 折叠样式手机 </span><br><span class="hljs-code"> 苹果打电话</span><br><span class="hljs-code"> 折叠样式手机 </span><br><span class="hljs-code"> 苹果关机</span><br><span class="hljs-section"> 折叠样式手机 </span><br><span class="hljs-section">++++++++++++++</span><br><span class="hljs-code"> 苹果开机</span><br><span class="hljs-code"> 直立样式手机 </span><br><span class="hljs-code"> 苹果打电话</span><br><span class="hljs-code"> 直立样式手机 </span><br><span class="hljs-code"> 苹果关机</span><br><span class="hljs-section"> 直立样式手机 </span><br><span class="hljs-section">++++++++++++++</span><br><span class="hljs-code"> 小米手机开机 </span><br><span class="hljs-code"> 旋转样式手机 </span><br><span class="hljs-code"> 小米手机打电话 </span><br><span class="hljs-code"> 旋转样式手机 </span><br><span class="hljs-code"> 小米手机关机 </span><br><span class="hljs-section"> 旋转样式手机 </span><br><span class="hljs-section">++++++++++++++</span><br></code></pre></td></tr></table></figure>
<p>新的类图</p>
<p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230102151322485.png" srcset="/img/loading.gif" lazyload alt="image-20230102151322485" /></p>
<h3 id="桥接模式的注意事项和细节"><a class="markdownIt-Anchor" href="#桥接模式的注意事项和细节"></a> 桥接模式的注意事项和细节</h3>
<ol>
<li>
<p>实现了抽象和实现部分的分离，从而极大的提供了系统的灵活性，让抽象部分和实现部分独立开来，这有助于系统进行分层设计，从而产生更好的结构化系统。</p>
</li>
<li>
<p>对于系统的高层部分，只需要知道抽象部分和实现部分的接口就可以了，其它的部分由具体业务来完成。</p>
</li>
<li>
<p><strong>桥接模式替代多层继承方案</strong>，可以减少<strong>子类的个数</strong>，降低系统的管理和维护成本</p>
</li>
<li>
<p>桥接模式的引入增加了系统的理解和设计难度，由于聚合关联关系建立在抽象层，要求开发者针对抽象进行设计和编程</p>
</li>
<li>
<p>桥接模式要求<strong>正确识别出系统中两个独立变化的维度(抽象、和实现)</strong>，因此其使用范围有一定的局限性，即需要有这样的应用场景。</p>
</li>
<li>
<p>桥接模式其它应用场景对于那些不希望使用继承或因为多层次继承导致系统类的个数急剧增加的系统，桥接模式尤为适用</p>
</li>
</ol>
<h1 id="装饰器模式"><a class="markdownIt-Anchor" href="#装饰器模式"></a> 🌕装饰器模式</h1>
<p>装饰器模式（DecoratorPattern）允许向一个现有的对象添加新的功能，同时又不改变其结构。这种类型的设计模式属于结构型模式，它是作为现有的类的一个包装。</p>
<p>这种模式创建了一个装饰类，用来包装原有的类，并在保持类方法签名完整性的前提下，提供了额外的功能。</p>
<h2 id="介绍-7"><a class="markdownIt-Anchor" href="#介绍-7"></a> 介绍</h2>
<p><strong>意图：</strong> 动态地给一个对象添加一些额外的职责。就增加功能来说，装饰器模式相比生成子类更为灵活。</p>
<p><strong>主要解决：</strong> 一般的，我们为了扩展一个类经常使用继承方式实现，由于继承为类引入静态特征，并且随着扩展功能的增多，子类会很膨胀。</p>
<p><strong>何时使用：</strong> 在不想增加很多子类的情况下扩展类。</p>
<p><strong>如何解决：</strong> 将具体功能职责划分，同时继承装饰者模式。</p>
<p><strong>关键代码：</strong> 1、Component 类充当抽象角色，不应该具体实现。 2、修饰类引用和继承 Component 类，具体扩展类重写父类方法。</p>
<p><strong>应用实例：</strong> 1、孙悟空有 72 变，当他变成&quot;庙宇&quot;后，他的根本还是一只猴子，但是他又有了庙宇的功能。<br />
2、不论一幅画有没有画框都可以挂在墙上，但是通常都是有画框的，并且实际上是画框被挂在墙上。在挂在墙上之前，画可以被蒙上玻璃，装到框子里；这时画、玻璃和画框形成了一个物体。</p>
<p><strong>优点：</strong> 装饰类和被装饰类可以独立发展，不会相互耦合，装饰模式是继承的一个替代模式，装饰模式可以动态扩展一个实现类的功能。</p>
<p><strong>缺点：</strong> 多层装饰比较复杂。</p>
<p><strong>使用场景：</strong> 1、扩展一个类的功能。 2、动态增加功能，动态撤销。</p>
<p><strong>注意事项：</strong> 可代替继承。</p>
<p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230102172346775.png" srcset="/img/loading.gif" lazyload alt="image-20230102172346775" /></p>
<p>初看上图感觉装饰器模式有点像俄罗斯套娃，⽽装饰器的核⼼就是再不改原有类的基础上给类新增功能。<strong>不改变原有类</strong>，可能有的⼩伙伴会想到继承、AOP切⾯，当然这些⽅式都可以实现，但是使⽤装饰器模式会是另外⼀种思路更为灵活，可以避免继承导致的⼦类过多，也可以避免AOP带来的复杂性。</p>
<h2 id="实现-5"><a class="markdownIt-Anchor" href="#实现-5"></a> 实现</h2>
<p>星巴克咖啡订单项目（咖啡馆）：</p>
<ol>
<li>
<p>咖啡种类/单品咖啡：Espresso(意大利浓咖啡)、ShortBlack、LongBlack(美式咖啡)、Decaf(无因咖啡)。</p>
</li>
<li>
<p>调料：Milk、Soy(豆浆)、Chocolate。</p>
</li>
<li>
<p>要求在扩展新的咖啡种类时，具有良好的扩展性、改动方便、维护方便。</p>
</li>
<li>
<p>使用 OO 的来计算不同种类咖啡的费用: 客户可以点单品咖啡，也可以单品咖啡+调料组合。</p>
</li>
</ol>
<p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230102173756821.png" srcset="/img/loading.gif" lazyload alt="image-20230102173756821" /></p>
<p>一部分代码</p>
<p><code>Drink</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.decorator;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Drink</span> &#123;<br><br>    <span class="hljs-keyword">public</span> String des; <span class="hljs-comment">// 描述</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">float</span> <span class="hljs-variable">price</span> <span class="hljs-operator">=</span> <span class="hljs-number">0.0f</span>;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getDes</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> des;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setDes</span><span class="hljs-params">(String des)</span> &#123;<br>        <span class="hljs-built_in">this</span>.des = des;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">float</span> <span class="hljs-title function_">getPrice</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> price;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setPrice</span><span class="hljs-params">(<span class="hljs-type">float</span> price)</span> &#123;<br>        <span class="hljs-built_in">this</span>.price = price;<br>    &#125;<br><br>    <span class="hljs-comment">//计算费用的抽象方法</span><br>    <span class="hljs-comment">//子类来实现</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-type">float</span> <span class="hljs-title function_">cost</span><span class="hljs-params">()</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>Coffee</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.decorator;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Coffee</span>  <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Drink</span> &#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-type">float</span> <span class="hljs-title function_">cost</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.getPrice();<br>   &#125;<br><br>   <br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>LongBlack</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.decorator;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LongBlack</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Coffee</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">LongBlack</span><span class="hljs-params">()</span> &#123;<br>      setDes(<span class="hljs-string">&quot; longblack &quot;</span>);<br>      setPrice(<span class="hljs-number">5.0f</span>);<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>DeCaf</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.decorator;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DeCaf</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Coffee</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">DeCaf</span><span class="hljs-params">()</span> &#123;<br>      setDes(<span class="hljs-string">&quot; 无因咖啡 &quot;</span>);<br>      setPrice(<span class="hljs-number">1.0f</span>);<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>Decorator</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.decorator;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Decorator</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Drink</span> &#123;<br>    <span class="hljs-keyword">private</span> Drink obj;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Decorator</span><span class="hljs-params">(Drink obj)</span> &#123; <span class="hljs-comment">//组合</span><br>        <span class="hljs-comment">// TODO Auto-generated constructor stub</span><br>        <span class="hljs-built_in">this</span>.obj = obj;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">float</span> <span class="hljs-title function_">cost</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// TODO Auto-generated method stub</span><br>        <span class="hljs-comment">// getPrice 自己价格</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.getPrice() + obj.cost();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getDes</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// TODO Auto-generated method stub</span><br>        <span class="hljs-comment">// obj.getDes() 输出被装饰者的信息</span><br>        <span class="hljs-keyword">return</span> des + <span class="hljs-string">&quot; &quot;</span> + getPrice() + <span class="hljs-string">&quot; &amp;&amp; &quot;</span> + obj.getDes();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>Milk</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.decorator;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Milk</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Decorator</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">Milk</span><span class="hljs-params">(Drink obj)</span> &#123;<br>      <span class="hljs-built_in">super</span>(obj);<br>      <span class="hljs-comment">// TODO Auto-generated constructor stub</span><br>      setDes(<span class="hljs-string">&quot; 牛奶 &quot;</span>);<br>      setPrice(<span class="hljs-number">2.0f</span>); <br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>Chocolate</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.decorator;<br><br><span class="hljs-comment">//具体的Decorator， 这里就是调味品</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Chocolate</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Decorator</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">Chocolate</span><span class="hljs-params">(Drink obj)</span> &#123;<br>      <span class="hljs-built_in">super</span>(obj);<br>      setDes(<span class="hljs-string">&quot; 巧克力 &quot;</span>);<br>      setPrice(<span class="hljs-number">3.0f</span>); <span class="hljs-comment">// 调味品 的价格</span><br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>CoffeeBar</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.decorator;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CoffeeBar</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-comment">// 装饰者模式下的订单：2份巧克力+一份牛奶的LongBlack</span><br><br>      <span class="hljs-comment">// 1. 点一份 LongBlack</span><br>      <span class="hljs-type">Drink</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LongBlack</span>();<br>      System.out.println(<span class="hljs-string">&quot;费用1=&quot;</span> + order.cost());<br>      System.out.println(<span class="hljs-string">&quot;描述=&quot;</span> + order.getDes());<br><br>      <span class="hljs-comment">// 2. order 加入一份牛奶</span><br>      order = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Milk</span>(order);<br><br>      System.out.println(<span class="hljs-string">&quot;order 加入一份牛奶 费用 =&quot;</span> + order.cost());<br>      System.out.println(<span class="hljs-string">&quot;order 加入一份牛奶 描述 = &quot;</span> + order.getDes());<br><br>      <span class="hljs-comment">// 3. order 加入一份巧克力</span><br><br>      order = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Chocolate</span>(order);<br><br>      System.out.println(<span class="hljs-string">&quot;order 加入一份牛奶 加入一份巧克力  费用 =&quot;</span> + order.cost());<br>      System.out.println(<span class="hljs-string">&quot;order 加入一份牛奶 加入一份巧克力 描述 = &quot;</span> + order.getDes());<br><br>      <span class="hljs-comment">// 3. order 加入一份巧克力</span><br><br>      order = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Chocolate</span>(order);<br><br>      System.out.println(<span class="hljs-string">&quot;order 加入一份牛奶 加入2份巧克力   费用 =&quot;</span> + order.cost());<br>      System.out.println(<span class="hljs-string">&quot;order 加入一份牛奶 加入2份巧克力 描述 = &quot;</span> + order.getDes());<br>   <br>      System.out.println(<span class="hljs-string">&quot;===========================&quot;</span>);<br>      <br>      <span class="hljs-type">Drink</span> <span class="hljs-variable">order2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DeCaf</span>();<br>      <br>      System.out.println(<span class="hljs-string">&quot;order2 无因咖啡  费用 =&quot;</span> + order2.cost());<br>      System.out.println(<span class="hljs-string">&quot;order2 无因咖啡 描述 = &quot;</span> + order2.getDes());<br>      <br>      order2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Milk</span>(order2);<br>      <br>      System.out.println(<span class="hljs-string">&quot;order2 无因咖啡 加入一份牛奶  费用 =&quot;</span> + order2.cost());<br>      System.out.println(<span class="hljs-string">&quot;order2 无因咖啡 加入一份牛奶 描述 = &quot;</span> + order2.getDes());<br><br>   <br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<blockquote>
<p>执行程序，输出结果：</p>
</blockquote>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">费用<span class="hljs-number">1</span>=<span class="hljs-number">5.0</span><br>描述= longblack <br><span class="hljs-keyword">order</span> <span class="hljs-title">加入一份牛奶 费用 =7</span>.<span class="hljs-number">0</span><br><span class="hljs-keyword">order</span> <span class="hljs-title">加入一份牛奶 描述 =  牛奶  2</span>.<span class="hljs-number">0</span> &amp;&amp;  longblack <br><span class="hljs-keyword">order</span> <span class="hljs-title">加入一份牛奶 加入一份巧克力  费用 =10</span>.<span class="hljs-number">0</span><br><span class="hljs-keyword">order</span> <span class="hljs-title">加入一份牛奶 加入一份巧克力 描述 =  巧克力  3</span>.<span class="hljs-number">0</span> &amp;&amp;  牛奶  <span class="hljs-number">2.0</span> &amp;&amp;  longblack <br><span class="hljs-keyword">order</span> <span class="hljs-title">加入一份牛奶 加入2</span>份巧克力   费用 =<span class="hljs-number">13.0</span><br><span class="hljs-keyword">order</span> <span class="hljs-title">加入一份牛奶 加入2</span>份巧克力 描述 =  巧克力  <span class="hljs-number">3.0</span> &amp;&amp;  巧克力  <span class="hljs-number">3.0</span> &amp;&amp;  牛奶  <span class="hljs-number">2.0</span> &amp;&amp;  longblack <br>===========================<br>order2 无因咖啡  费用 =<span class="hljs-number">1.0</span><br>order2 无因咖啡 描述 =  无因咖啡 <br>order2 无因咖啡 加入一份牛奶  费用 =<span class="hljs-number">3.0</span><br>order2 无因咖啡 加入一份牛奶 描述 =  牛奶  <span class="hljs-number">2.0</span> &amp;&amp;  无因咖啡 <br></code></pre></td></tr></table></figure>
<h1 id="组合模式"><a class="markdownIt-Anchor" href="#组合模式"></a> 组合模式</h1>
<p>组合模式（CompositePattern），又叫部分整体模式，是用于把一组相似的对象当作一个单一的对象。组合模式依据树形结构来组合对象，用来表示部分以及整体层次。这种类型的设计模式属于结构型模式，它创建了对象组的树形结构。</p>
<p>这种模式创建了一个包含自己对象组的类。该类提供了修改相同对象组的方式。</p>
<h2 id="介绍-8"><a class="markdownIt-Anchor" href="#介绍-8"></a> 介绍</h2>
<p><strong>意图：</strong> 将对象组合成树形结构以表示&quot;部分-整体&quot;的层次结构。组合模式使得用户对单个对象和组合对象的使用具有一致性，即：组合能让客户以一致的方式处理个别对象以及组合对象。</p>
<p><strong>主要解决：</strong><br />
它在我们树型结构的问题中，模糊了简单元素和复杂元素的概念，客户程序可以像处理简单元素一样来处理复杂元素，从而使得客户程序与复杂元素的内部结构解耦。</p>
<p><strong>何时使用：</strong> 1、您想表示对象的部分-整体层次结构（树形结构）。 2、您希望用户忽略组合对象与单个对象的不同，用户将统一地使用组合结构中的所有对象。</p>
<p><strong>如何解决：</strong> 树枝和叶子实现统一接口，树枝内部组合该接口。</p>
<p><strong>关键代码：</strong> 树枝内部组合该接口，并且含有内部属性 List，里面放 Component。</p>
<p><strong>应用实例：</strong> 1、算术表达式包括操作数、操作符和另一个操作数，其中，另一个操作数也可以是操作数、操作符和另一个操作数。 2、在 JAVA AWT 和 SWING 中，对于 Button 和 Checkbox 是树叶，Container 是树枝。</p>
<p><strong>优点：</strong> 1、高层模块调用简单。 2、节点自由增加。</p>
<p><strong>缺点：</strong> 在使用组合模式时，其叶子和树枝的声明都是实现类，而不是接口，违反了依赖倒置原则。</p>
<p><strong>使用场景：</strong> 部分、整体场景，如树形菜单，文件、文件夹的管理。</p>
<p><strong>注意事项：</strong> 定义时为具体类。</p>
<p><strong>组合模式原理类图：</strong></p>
<p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230102185734930.png" srcset="/img/loading.gif" lazyload alt="image-20230102185734930" /></p>
<p>对原理结构图的说明-即(组合模式的角色及职责)</p>
<ol>
<li>
<p><strong>Component</strong> :这是组合中对象声明接口，在适当情况下，实现所有类共有的接口默认行为,用于访问和管理Component 子部件, Component 可以是抽象类或者接口</p>
</li>
<li>
<p><strong>Leaf :</strong> 在组合中表示叶子节点，叶子节点没有子节点</p>
</li>
<li>
<p><strong>Composite</strong> :非叶子节点， 用于存储子部件， 在 Component 接口中实现 子部件的相关操作，比如增加(add),删除。</p>
</li>
</ol>
<h2 id="实现-6"><a class="markdownIt-Anchor" href="#实现-6"></a> 实现</h2>
<ol>
<li>
<p><strong>编写程序</strong>展示一个学校院系结构：需求是这样，要在一个页面中展示出学校的院系组成，一个学校有多个学院，一个学院有多个系。</p>
</li>
<li>
<p>思路分析和图解(类图)</p>
</li>
</ol>
<p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230102190822334.png" srcset="/img/loading.gif" lazyload alt="image-20230102190822334" /></p>
<p><code>OrganizationComponent</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.composite;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrganizationComponent</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 名字</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 说明</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> String des;<br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">(OrganizationComponent organizationComponent)</span> &#123;<br>        <span class="hljs-comment">//默认实现</span><br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnsupportedOperationException</span>();<br>    &#125;<br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">remove</span><span class="hljs-params">(OrganizationComponent organizationComponent)</span> &#123;<br>        <span class="hljs-comment">//默认实现</span><br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnsupportedOperationException</span>();<br>    &#125;<br><br>    <span class="hljs-comment">//构造器</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">OrganizationComponent</span><span class="hljs-params">(String name, String des)</span> &#123;<br>        <span class="hljs-built_in">super</span>();<br>        <span class="hljs-built_in">this</span>.name = name;<br>        <span class="hljs-built_in">this</span>.des = des;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getDes</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> des;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setDes</span><span class="hljs-params">(String des)</span> &#123;<br>        <span class="hljs-built_in">this</span>.des = des;<br>    &#125;<br><br>    <span class="hljs-comment">//方法print, 做成抽象的, 子类都需要实现</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">print</span><span class="hljs-params">()</span>;<br><br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>Department</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.composite;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Department</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">OrganizationComponent</span> &#123;<br><br>   <span class="hljs-comment">//没有集合</span><br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">Department</span><span class="hljs-params">(String name, String des)</span> &#123;<br>      <span class="hljs-built_in">super</span>(name, des);<br>      <span class="hljs-comment">// TODO Auto-generated constructor stub</span><br>   &#125;<br><br>   <br>   <span class="hljs-comment">//add , remove 就不用写了，因为他是叶子节点</span><br>   <br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.getName();<br>   &#125;<br>   <br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getDes</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.getDes();<br>   &#125;<br>   <br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">print</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(getName());<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>College</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.composite;<br><br><span class="hljs-keyword">import</span> java.util.ArrayList;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">College</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">OrganizationComponent</span> &#123;<br><br>   <span class="hljs-comment">//List 中 存放的Department</span><br>   List&lt;OrganizationComponent&gt; organizationComponents = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;OrganizationComponent&gt;();<br><br>   <span class="hljs-comment">// 构造器</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">College</span><span class="hljs-params">(String name, String des)</span> &#123;<br>      <span class="hljs-built_in">super</span>(name, des);<br>      <span class="hljs-comment">// TODO Auto-generated constructor stub</span><br>   &#125;<br><br>   <span class="hljs-comment">// 重写add</span><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">(OrganizationComponent organizationComponent)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-comment">//  将来实际业务中，Colleage 的 add 和  University add 不一定完全一样</span><br>      organizationComponents.add(organizationComponent);<br>   &#125;<br><br>   <span class="hljs-comment">// 重写remove</span><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">remove</span><span class="hljs-params">(OrganizationComponent organizationComponent)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      organizationComponents.remove(organizationComponent);<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.getName();<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getDes</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.getDes();<br>   &#125;<br><br>   <span class="hljs-comment">// print方法，就是输出University 包含的学院</span><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">print</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot;--------------&quot;</span> + getName() + <span class="hljs-string">&quot;--------------&quot;</span>);<br>      <span class="hljs-comment">//遍历 organizationComponents </span><br>      <span class="hljs-keyword">for</span> (OrganizationComponent organizationComponent : organizationComponents) &#123;<br>         organizationComponent.print();<br>      &#125;<br>   &#125;<br><br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>University</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.composite;<br><br><span class="hljs-keyword">import</span> java.util.ArrayList;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-comment">//University 就是 Composite , 可以管理College</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">University</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">OrganizationComponent</span> &#123;<br><br>   List&lt;OrganizationComponent&gt; organizationComponents = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;OrganizationComponent&gt;();<br><br>   <span class="hljs-comment">// 构造器</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">University</span><span class="hljs-params">(String name, String des)</span> &#123;<br>      <span class="hljs-built_in">super</span>(name, des);<br>      <span class="hljs-comment">// TODO Auto-generated constructor stub</span><br>   &#125;<br><br>   <span class="hljs-comment">// 重写add</span><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">(OrganizationComponent organizationComponent)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      organizationComponents.add(organizationComponent);<br>   &#125;<br><br>   <span class="hljs-comment">// 重写remove</span><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">remove</span><span class="hljs-params">(OrganizationComponent organizationComponent)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      organizationComponents.remove(organizationComponent);<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.getName();<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getDes</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.getDes();<br>   &#125;<br><br>   <span class="hljs-comment">// print方法，就是输出University 包含的学院</span><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">print</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot;--------------&quot;</span> + getName() + <span class="hljs-string">&quot;--------------&quot;</span>);<br>      <span class="hljs-comment">//遍历 organizationComponents </span><br>      <span class="hljs-keyword">for</span> (OrganizationComponent organizationComponent : organizationComponents) &#123;<br>         organizationComponent.print();<br>      &#125;<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>Client</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.composite;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <br>      <span class="hljs-comment">//从大到小创建对象 学校</span><br>      <span class="hljs-type">OrganizationComponent</span> <span class="hljs-variable">university</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">University</span>(<span class="hljs-string">&quot;清华大学&quot;</span>, <span class="hljs-string">&quot; 中国顶级大学 &quot;</span>);<br>      <br>      <span class="hljs-comment">//创建 学院</span><br>      <span class="hljs-type">OrganizationComponent</span> <span class="hljs-variable">computerCollege</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">College</span>(<span class="hljs-string">&quot;计算机学院&quot;</span>, <span class="hljs-string">&quot; 计算机学院 &quot;</span>);<br>      <span class="hljs-type">OrganizationComponent</span> <span class="hljs-variable">infoEngineercollege</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">College</span>(<span class="hljs-string">&quot;信息工程学院&quot;</span>, <span class="hljs-string">&quot; 信息工程学院 &quot;</span>);<br>      <br>      <br>      <span class="hljs-comment">//创建各个学院下面的系(专业)</span><br>      computerCollege.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Department</span>(<span class="hljs-string">&quot;软件工程&quot;</span>, <span class="hljs-string">&quot; 软件工程不错 &quot;</span>));<br>      computerCollege.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Department</span>(<span class="hljs-string">&quot;网络工程&quot;</span>, <span class="hljs-string">&quot; 网络工程不错 &quot;</span>));<br>      computerCollege.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Department</span>(<span class="hljs-string">&quot;计算机科学与技术&quot;</span>, <span class="hljs-string">&quot; 计算机科学与技术是老牌的专业 &quot;</span>));<br>      <br>      <span class="hljs-comment">//</span><br>      infoEngineercollege.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Department</span>(<span class="hljs-string">&quot;通信工程&quot;</span>, <span class="hljs-string">&quot; 通信工程不好学 &quot;</span>));<br>      infoEngineercollege.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Department</span>(<span class="hljs-string">&quot;信息工程&quot;</span>, <span class="hljs-string">&quot; 信息工程好学 &quot;</span>));<br>      <br>      <span class="hljs-comment">//将学院加入到 学校</span><br>      university.add(computerCollege);<br>      university.add(infoEngineercollege);<br><br>      university.print();<br>      System.out.println(<span class="hljs-string">&quot;~~~~~~~~~~~~~~~~~~~~&quot;</span>);<br>      infoEngineercollege.print();<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<blockquote>
<p>执行程序，输出结果：</p>
</blockquote>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">----------------------清华大学----------------------<br>--------------计算机学院--------------<br>软件工程<br>网络工程<br>计算机科学与技术<br>--------------信息工程学院--------------<br>通信工程<br><span class="hljs-section">信息工程</span><br><span class="hljs-section">~~~~~~~~~~~~~~~~~~~~</span><br>--------------信息工程学院--------------<br>通信工程<br>信息工程<br></code></pre></td></tr></table></figure>
<h2 id="组合模式的注意事项和细节"><a class="markdownIt-Anchor" href="#组合模式的注意事项和细节"></a> 组合模式的注意事项和细节</h2>
<ol>
<li>
<p>简化客户端操作。客户端只需要面对一致的对象而不用考虑整体部分或者节点叶子的问题。</p>
</li>
<li>
<p>具有较强的扩展性。当我们要更改组合对象时，我们只需要调整内部的层次关系，客户端不用做出任何改动.</p>
</li>
<li>
<p>方便创建出复杂的层次结构。客户端不用理会组合里面的组成细节，容易添加节点或者叶子从而创建出复杂的树形结构</p>
</li>
<li>
<p>需<strong>要遍历组织机构，或者处理的对象具有树形结构时</strong>, 非常<strong>适合使用组合模式</strong>.</p>
</li>
<li>
<p>要求较高的抽象性，如果<strong>节点和叶子有很多差异性的话</strong>，比如很多方法和属性都不一样**，不适合使用组合模**式</p>
</li>
</ol>
<h1 id="外观模式"><a class="markdownIt-Anchor" href="#外观模式"></a> 外观模式</h1>
<p>外观模式（FacadePattern）隐藏系统的复杂性，并向客户端提供了一个客户端可以访问系统的接口。这种类型的设计模式属于结构型模式，它向现有的系统添加一个接口，来隐藏系统的复杂性。</p>
<p>也叫门面模式。</p>
<h2 id="介绍-9"><a class="markdownIt-Anchor" href="#介绍-9"></a> 介绍</h2>
<p><strong>意图：</strong> 为子系统中的一组接口提供一个一致的界面，外观模式定义了一个高层接口，这个接口使得这一子系统更加容易使用。</p>
<p><strong>主要解决：</strong> 降低访问复杂系统的内部子系统时的复杂度，简化客户端之间的接口。</p>
<p><strong>何时使用：</strong> 1、客户端不需要知道系统内部的复杂联系，整个系统只需提供一个&quot;接待员&quot;即可。 2、定义系统的入口。</p>
<p><strong>如何解决：</strong> 客户端不与系统耦合，外观类与系统耦合。</p>
<p><strong>关键代码：</strong> 在客户端和复杂系统之间再加一层，这一层将调用顺序、依赖关系等处理好。</p>
<p><strong>应用实例：</strong> 1、去医院看病，可能要去挂号、门诊、划价、取药，让患者或患者家属觉得很复杂，如果有提供接待人员，只让接待人员来处理，就很方便。<br />
2、JAVA 的三层开发模式。</p>
<p><strong>优点：</strong> 1、减少系统相互依赖。 2、提高灵活性。 3、提高了安全性。</p>
<p><strong>缺点：</strong> 不符合开闭原则，如果要改东西很麻烦，继承重写都不合适。</p>
<p><strong>使用场景：</strong> 1、为复杂的模块或子系统提供外界访问的模块。 2、子系统相对独立。 3、预防低水平人员带来的风险。</p>
<p><strong>注意事项：</strong> 在层次化结构中，可以使用外观模式定义系统中每一层的入口。</p>
<p><strong>外观模式原理类图:</strong></p>
<p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230102193340583.png" srcset="/img/loading.gif" lazyload alt="image-20230102193340583" /></p>
<p>对类图说明(分类外观模式的角色)</p>
<ol>
<li>
<p>外观类(Facade): 为调用端ᨀ 供统一的调用接口, 外观类知道哪些子系统负责处理请求,从而将调用端的请求代理给适当子系统对象</p>
</li>
<li>
<p>调用者(Client): 外观接口的调用者</p>
</li>
<li>
<p>子系统的集合：指模块或者子系统，处理 Facade 对象指派的任务，他是功能的实际<strong>供者</strong></p>
</li>
</ol>
<h2 id="实现-7"><a class="markdownIt-Anchor" href="#实现-7"></a> 实现</h2>
<p>组建一个家庭影院：</p>
<p>DVD播放器、投影仪、自动屏幕、环绕立体声、爆米花机,要求完成使用家庭影院的功能，其过程为：</p>
<p>直接用遥控器：统筹各设备开关</p>
<p>开爆米花机</p>
<p>放下屏幕</p>
<p>开投影仪</p>
<p>开音响</p>
<p>开DVD，选dvd</p>
<p>去拿爆米花</p>
<p>调暗灯光</p>
<p>播放</p>
<p>观影结束后，关闭各种设备</p>
<p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230102193600188.png" srcset="/img/loading.gif" lazyload alt="image-20230102193600188" /></p>
<p><code>HomeTheaterFacade</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.facade;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HomeTheaterFacade</span> &#123;<br>   <br>   <span class="hljs-comment">//定义各个子系统对象</span><br>   <span class="hljs-keyword">private</span> TheaterLight theaterLight;<br>   <span class="hljs-keyword">private</span> Popcorn popcorn;<br>   <span class="hljs-keyword">private</span> Stereo stereo;<br>   <span class="hljs-keyword">private</span> Projector projector;<br>   <span class="hljs-keyword">private</span> Screen screen;<br>   <span class="hljs-keyword">private</span> DVDPlayer dVDPlayer;<br>   <br>   <br>   <span class="hljs-comment">//构造器</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">HomeTheaterFacade</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-built_in">super</span>();<br>      <span class="hljs-built_in">this</span>.theaterLight = TheaterLight.getInstance();<br>      <span class="hljs-built_in">this</span>.popcorn = Popcorn.getInstance();<br>      <span class="hljs-built_in">this</span>.stereo = Stereo.getInstance();<br>      <span class="hljs-built_in">this</span>.projector = Projector.getInstance();<br>      <span class="hljs-built_in">this</span>.screen = Screen.getInstance();<br>      <span class="hljs-built_in">this</span>.dVDPlayer = DVDPlayer.getInstanc();<br>   &#125;<br><br>   <span class="hljs-comment">//操作分成 4 步</span><br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">ready</span><span class="hljs-params">()</span> &#123;<br>      popcorn.on();<br>      popcorn.pop();<br>      screen.down();<br>      projector.on();<br>      stereo.on();<br>      dVDPlayer.on();<br>      theaterLight.dim();<br>   &#125;<br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">play</span><span class="hljs-params">()</span> &#123;<br>      dVDPlayer.play();<br>   &#125;<br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">pause</span><span class="hljs-params">()</span> &#123;<br>      dVDPlayer.pause();<br>   &#125;<br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">end</span><span class="hljs-params">()</span> &#123;<br>      popcorn.off();<br>      theaterLight.bright();<br>      screen.up();<br>      projector.off();<br>      stereo.off();<br>      dVDPlayer.off();<br>   &#125;   <br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>DVDPlayer</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.facade;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DVDPlayer</span> &#123;<br>   <br>   <span class="hljs-comment">//使用单例模式, 使用饿汉式</span><br>   <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">DVDPlayer</span> <span class="hljs-variable">instance</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DVDPlayer</span>();<br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> DVDPlayer <span class="hljs-title function_">getInstanc</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> instance;<br>   &#125;<br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">on</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot; dvd on &quot;</span>);<br>   &#125;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">off</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot; dvd off &quot;</span>);<br>   &#125;<br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">play</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot; dvd is playing &quot;</span>);<br>   &#125;<br>   <br>   <span class="hljs-comment">//....</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">pause</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot; dvd pause ..&quot;</span>);<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>Popcorn</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.facade;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Popcorn</span> &#123;<br>   <br>   <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">Popcorn</span> <span class="hljs-variable">instance</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Popcorn</span>();<br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Popcorn <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> instance;<br>   &#125;<br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">on</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot; popcorn on &quot;</span>);<br>   &#125;<br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">off</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot; popcorn ff &quot;</span>);<br>   &#125;<br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">pop</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot; popcorn is poping  &quot;</span>);<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>Projector</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.facade;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Projector</span> &#123;<br><br>   <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">Projector</span> <span class="hljs-variable">instance</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Projector</span>();<br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Projector <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> instance;<br>   &#125;<br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">on</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot; Projector on &quot;</span>);<br>   &#125;<br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">off</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot; Projector ff &quot;</span>);<br>   &#125;<br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">focus</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot; Projector is Projector  &quot;</span>);<br>   &#125;<br>   <br>   <span class="hljs-comment">//...</span><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>Screen</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.facade;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Screen</span> &#123;<br><br>   <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">Screen</span> <span class="hljs-variable">instance</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Screen</span>();<br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Screen <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> instance;<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">up</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot; Screen up &quot;</span>);<br>   &#125;<br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">down</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot; Screen down &quot;</span>);<br>   &#125;<br>   <br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>TheaterLight</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.facade;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TheaterLight</span> &#123;<br><br>   <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">TheaterLight</span> <span class="hljs-variable">instance</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TheaterLight</span>();<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> TheaterLight <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> instance;<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">on</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot; TheaterLight on &quot;</span>);<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">off</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot; TheaterLight off &quot;</span>);<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">dim</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot; TheaterLight dim.. &quot;</span>);<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">bright</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot; TheaterLight bright.. &quot;</span>);<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>Client</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.facade;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br><br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>		<span class="hljs-comment">// TODO Auto-generated method stub</span><br>		<span class="hljs-comment">//这里直接调用。。 很麻烦</span><br>		<span class="hljs-type">HomeTheaterFacade</span> <span class="hljs-variable">homeTheaterFacade</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HomeTheaterFacade</span>();<br>		homeTheaterFacade.ready();<br>		System.out.println(<span class="hljs-string">&quot;~~~~~~~~~~~~~&quot;</span>);<br>		homeTheaterFacade.play();<br>		System.out.println(<span class="hljs-string">&quot;~~~~~~~~~~~~~&quot;</span>);<br>		homeTheaterFacade.end();<br>	&#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure>
<blockquote>
<p>执行程序，输出结果：</p>
</blockquote>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-code"> popcorn on </span><br><span class="hljs-code"> popcorn is poping  </span><br><span class="hljs-code"> Screen down </span><br><span class="hljs-code"> Projector on </span><br><span class="hljs-code"> Stereo on </span><br><span class="hljs-code"> dvd on </span><br><span class="hljs-section"> TheaterLight dim.. </span><br><span class="hljs-section">~~~~~~~~~~~~~</span><br><span class="hljs-section"> dvd is playing </span><br><span class="hljs-section">~~~~~~~~~~~~~</span><br><span class="hljs-code"> popcorn ff </span><br><span class="hljs-code"> TheaterLight bright.. </span><br><span class="hljs-code"> Screen up </span><br><span class="hljs-code"> Projector ff </span><br><span class="hljs-code"> Screen off </span><br><span class="hljs-code"> dvd off </span><br></code></pre></td></tr></table></figure>
<h2 id="外观模式的注意事项和细节"><a class="markdownIt-Anchor" href="#外观模式的注意事项和细节"></a> 外观模式的注意事项和细节</h2>
<ol>
<li>外观模式对外屏蔽了子系统的细节，因此外观模式降低了客户端对子系统使用的复杂性</li>
<li>外观模式对客户端与子系统的耦合关系 - 解耦，让子系统内部的模块更易维护和扩展</li>
<li>通过合理的使用外观模式，可以帮我们更好的划分访问的层次</li>
<li>当系统需要进行分层设计时，可以考虑使用 Facade 模式</li>
<li>在维护一个遗留的大型系统时，可能这个系统已经变得非常难以维护和扩展，此时可以考虑为新系统开发一个Facade 类，来提供遗留系统的比较清晰简单的接口，让新系统与 Facade 类交互，提高复用性。</li>
<li>不能过多的或者不合理的使用外观模式，使用外观模式好，还是直接调用模块好。要以让系统有层次，利于维护为目的。</li>
</ol>
<h1 id="享元模式"><a class="markdownIt-Anchor" href="#享元模式"></a> 享元模式</h1>
<p>享元模式（FlyweightPattern）也叫 蝇量模式主要用于减少创建对象的数量，以减少内存占用和提高性能。这种类型的设计模式属于结构型模式，它提供了减少对象数量从而改善应用所需的对象结构的方式。</p>
<p>享元模式尝试重用现有的同类对象，如果未找到匹配的对象，则创建新对象。我们将通过创建 5 个对象来画出 20 个分布于不同位置的圆来演示这种模式。由于只有 5种可用的颜色，所以 color 属性被用来检查现有的 <em>Circle</em> 对象。</p>
<h2 id="介绍-10"><a class="markdownIt-Anchor" href="#介绍-10"></a> 介绍</h2>
<p><strong>意图：</strong> 运用共享技术有效地支持大量细粒度的对象。</p>
<p><strong>主要解决：</strong> 在有大量对象时，有可能会造成内存溢出，我们把其中共同的部分抽象出来，如果有相同的业务请求，直接返回在内存中已有的对象，避免重新创建。</p>
<p><strong>何时使用：</strong> 1、系统中有大量对象。 2、这些对象消耗大量内存。 3、这些对象的状态大部分可以外部化。4、这些对象可以按照内蕴状态分为很多组，当把外蕴对象从对象中剔除出来时，每一组对象都可以用一个对象来代替。5、系统不依赖于这些对象身份，这些对象是不可分辨的。</p>
<p><strong>如何解决：</strong> 用唯一标识码判断，如果在内存中有，则返回这个唯一标识码所标识的对象。</p>
<p><strong>关键代码：</strong> 用 HashMap 存储这些对象。</p>
<p><strong>应用实例：</strong> 1、JAVA 中的 String，如果有则返回，如果没有则创建一个字符串保存在字符串缓存池里面。 2、数据库的数据池。</p>
<p><strong>优点：</strong> 大大减少对象的创建，降低系统的内存，使效率提高。</p>
<p><strong>缺点：</strong> 提高了系统的复杂度，需要分离出外部状态和内部状态，而且外部状态具有固有化的性质，不应该随着内部状态的变化而变化，否则会造成系统的混乱。</p>
<p><strong>使用场景：</strong> 1、系统有大量相似对象。 2、需要缓冲池的场景。</p>
<p><strong>注意事项：</strong> 1、注意划分外部状态和内部状态，否则可能会引起线程安全问题。 2、这些类必须有一个工厂对象加以控制。</p>
<p><strong>享元模式的原理类图：</strong></p>
<p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230103100919853.png" srcset="/img/loading.gif" lazyload alt="image-20230103100919853" /></p>
<p>对原理图的说明-即(模式的角色及职责)</p>
<ol>
<li>
<p>FlyWeight 是抽象的享元角色, 他是产品的抽象类, 同时定义出对象的外部状态和内部状态(后面介绍) 的接口或实现</p>
</li>
<li>
<p>ConcreteFlyWeight 是具体的享元角色，是具体的产品类，实现抽象角色定义相关业务</p>
</li>
<li>
<p>UnSharedConcreteFlyWeight 是不可共享的角色，一般不会出现在享元工厂。</p>
</li>
<li>
<p>FlyWeightFactory 享元工厂类，用于构建一个池容器(集合)， 同时提供从池中获取对象方法</p>
</li>
</ol>
<h2 id="实现-8"><a class="markdownIt-Anchor" href="#实现-8"></a> 实现</h2>
<p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230103110105715.png" srcset="/img/loading.gif" lazyload alt="image-20230103110105715" /></p>
<p><code>WebSite</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.flyweight;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebSite</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">use</span><span class="hljs-params">(User user)</span>;<span class="hljs-comment">//抽象方法</span><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * //共享方法</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span></span><br><span class="hljs-comment">     * <span class="hljs-doctag">@author</span> 席子</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">showMe</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;欢迎使用xtwoy系统&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>ConcreteWebSite</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.flyweight;<br><br><span class="hljs-comment">//具体网站</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConcreteWebSite</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">WebSite</span> &#123;<br><br>   <span class="hljs-comment">//共享的部分，内部状态</span><br>   <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> <span class="hljs-variable">type</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&quot;</span>; <span class="hljs-comment">//网站发布的形式(类型)</span><br><br>   <br>   <span class="hljs-comment">//构造器</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">ConcreteWebSite</span><span class="hljs-params">(String type)</span> &#123;<br>      <br>      <span class="hljs-built_in">this</span>.type = type;<br>   &#125;<br><br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">use</span><span class="hljs-params">(User user)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      showMe();<br>      System.out.println(<span class="hljs-string">&quot;网站的发布形式为:&quot;</span> + type + <span class="hljs-string">&quot; 在使用中 .. 使用者是&quot;</span> + user.getName());<br>   &#125;<br>   <br>   <br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>WebSiteFactory</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.flyweight;<br><br><span class="hljs-keyword">import</span> java.util.HashMap;<br><br><span class="hljs-comment">// 网站工厂类，根据需要返回压一个网站</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebSiteFactory</span> &#123;<br><br>   <br>   <span class="hljs-comment">//集合， 充当池的作用</span><br>   <span class="hljs-keyword">private</span> HashMap&lt;String, ConcreteWebSite&gt; pool = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>   <br>   <span class="hljs-comment">//根据网站的类型，返回一个网站, 如果没有就创建一个网站，并放入到池中,并返回</span><br>   <span class="hljs-keyword">public</span> WebSite <span class="hljs-title function_">getWebSiteCategory</span><span class="hljs-params">(String type)</span> &#123;<br>      <span class="hljs-keyword">if</span>(!pool.containsKey(type)) &#123;<br>         <span class="hljs-comment">//就创建一个网站，并放入到池中</span><br>         pool.put(type, <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcreteWebSite</span>(type));<br>      &#125;<br>      <br>      <span class="hljs-keyword">return</span> (WebSite)pool.get(type);<br>   &#125;<br>   <br>   <span class="hljs-comment">//获取网站分类的总数 (池中有多少个网站类型)</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getWebSiteCount</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> pool.size();<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>User</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.flyweight;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;<br>   <br>   <span class="hljs-keyword">private</span> String name;<br><br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">User</span><span class="hljs-params">(String name)</span> &#123;<br>      <span class="hljs-built_in">super</span>();<br>      <span class="hljs-built_in">this</span>.name = name;<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> name;<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> &#123;<br>      <span class="hljs-built_in">this</span>.name = name;<br>   &#125;<br>   <br>   <br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>Client</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.flyweight;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br><br>      <span class="hljs-comment">// 创建一个工厂类</span><br>      <span class="hljs-type">WebSiteFactory</span> <span class="hljs-variable">factory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebSiteFactory</span>();<br><br>      <span class="hljs-comment">// 客户要一个以新闻形式发布的网站</span><br>      <span class="hljs-type">WebSite</span> <span class="hljs-variable">webSite1</span> <span class="hljs-operator">=</span> factory.getWebSiteCategory(<span class="hljs-string">&quot;新闻&quot;</span>);<br><br>      <br>      webSite1.use(<span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">&quot;tom&quot;</span>));<br><br>      <span class="hljs-comment">// 客户要一个以博客形式发布的网站</span><br>      <span class="hljs-type">WebSite</span> <span class="hljs-variable">webSite2</span> <span class="hljs-operator">=</span> factory.getWebSiteCategory(<span class="hljs-string">&quot;博客&quot;</span>);<br><br>      webSite2.use(<span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">&quot;jack&quot;</span>));<br><br>      <span class="hljs-comment">// 客户要一个以博客形式发布的网站</span><br>      <span class="hljs-type">WebSite</span> <span class="hljs-variable">webSite3</span> <span class="hljs-operator">=</span> factory.getWebSiteCategory(<span class="hljs-string">&quot;博客&quot;</span>);<br><br>      webSite3.use(<span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">&quot;smith&quot;</span>));<br><br>      <span class="hljs-comment">// 客户要一个以博客形式发布的网站</span><br>      <span class="hljs-type">WebSite</span> <span class="hljs-variable">webSite4</span> <span class="hljs-operator">=</span> factory.getWebSiteCategory(<span class="hljs-string">&quot;博客&quot;</span>);<br><br>      webSite4.use(<span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">&quot;king&quot;</span>));<br>      <br>      System.out.println(<span class="hljs-string">&quot;网站的分类共=&quot;</span> + factory.getWebSiteCount());<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<blockquote>
<p>执行程序，输出结果：</p>
</blockquote>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">欢迎使用xtwoy系统<br>网站的发布形式为:新闻 在使用中 <span class="hljs-string">..</span> 使用者是tom<br>欢迎使用xtwoy系统<br>网站的发布形式为:博客 在使用中 <span class="hljs-string">..</span> 使用者是jack<br>欢迎使用xtwoy系统<br>网站的发布形式为:博客 在使用中 <span class="hljs-string">..</span> 使用者是smith<br>欢迎使用xtwoy系统<br>网站的发布形式为:博客 在使用中 <span class="hljs-string">..</span> 使用者是king<br>网站的分类共=2<br></code></pre></td></tr></table></figure>
<h2 id="享元模式在-jdk-interger-的应用源码分析"><a class="markdownIt-Anchor" href="#享元模式在-jdk-interger-的应用源码分析"></a> 享元模式在 JDK-Interger 的应用源码分析</h2>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.jdk;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FlyWeight</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-comment">//如果 Integer.valueOf(x) x 在  -128 --- 127 直接，就是使用享元模式返回,如果不在</span><br>      <span class="hljs-comment">//范围类，则仍然 new </span><br>      <br>      <span class="hljs-comment">//小结:</span><br>      <span class="hljs-comment">//1. 在valueOf 方法中，先判断值是否在 IntegerCache 中，如果不在，就创建新的Integer(new), 否则，就直接从 缓存池返回</span><br>      <span class="hljs-comment">//2. valueOf 方法，就使用到享元模式</span><br>      <span class="hljs-comment">//3. 如果使用valueOf 方法得到一个Integer 实例，范围在 -128 - 127 ，执行速度比 new 快</span><br>      <br>      <br>      <span class="hljs-type">Integer</span> <span class="hljs-variable">x</span> <span class="hljs-operator">=</span> Integer.valueOf(<span class="hljs-number">127</span>); <span class="hljs-comment">// 得到 x实例，类型 Integer</span><br>      <span class="hljs-type">Integer</span> <span class="hljs-variable">y</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Integer</span>(<span class="hljs-number">127</span>); <span class="hljs-comment">// 得到 y 实例，类型 Integer</span><br>      <span class="hljs-type">Integer</span> <span class="hljs-variable">z</span> <span class="hljs-operator">=</span> Integer.valueOf(<span class="hljs-number">127</span>);<span class="hljs-comment">//..</span><br>      <span class="hljs-type">Integer</span> <span class="hljs-variable">w</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Integer</span>(<span class="hljs-number">127</span>);<br>      <br>      <br>      System.out.println(x.equals(y)); <span class="hljs-comment">// 大小，true</span><br>      System.out.println(x == y ); <span class="hljs-comment">//  false</span><br>      System.out.println(x == z ); <span class="hljs-comment">// true</span><br>      System.out.println(w == x ); <span class="hljs-comment">// false</span><br>      System.out.println(w == y ); <span class="hljs-comment">// false</span><br>      <br>      <br>      <span class="hljs-type">Integer</span> <span class="hljs-variable">x1</span> <span class="hljs-operator">=</span> Integer.valueOf(<span class="hljs-number">200</span>);<br>      <span class="hljs-type">Integer</span> <span class="hljs-variable">x2</span> <span class="hljs-operator">=</span> Integer.valueOf(<span class="hljs-number">200</span>);<br>      System.out.println(<span class="hljs-string">&quot;x1==x2&quot;</span> + (x1 == x2)); <span class="hljs-comment">// false</span><br><br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230103111534525.png" srcset="/img/loading.gif" lazyload alt="image-20230103111534525" /></p>
<p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230103111520047.png" srcset="/img/loading.gif" lazyload alt="image-20230103111516626" /></p>
<h2 id="享元模式的注意事项和细节"><a class="markdownIt-Anchor" href="#享元模式的注意事项和细节"></a> 享元模式的注意事项和细节</h2>
<ol>
<li>
<p>在享元模式这样理解，“享”就表示共享，“元”表示对象</p>
</li>
<li>
<p>系统中有大量对象，这些对象消耗大量内存，并且对象的状态大部分可以外部化时，我们就可以考虑选用享元模式</p>
</li>
<li>
<p>用唯一标识码判断，如果在内存中有，则返回这个唯一标识码所标识的对象，用 HashMap/HashTable 存储</p>
</li>
<li>
<p>享元模式大大减少了对象的创建，降低了程序内存的占用，提高效率</p>
</li>
<li>
<p>享元模式提高了<strong>系统的复杂度</strong>。需要分离出<strong>内部状态和外部状态</strong>，而外部状态具有固化特性，不应该随着内部状态的改变而改变，这是我们使用享元模式需要注意的地方.</p>
</li>
<li>
<p>使用享元模式时，注意划分内部状态和外部状态，并且需要有一个工厂类加以控制。</p>
</li>
<li>
<p>享元模式经典的应用场景是需要缓冲池的场景，比如 String 常量池、数据库连接池</p>
</li>
</ol>
<h1 id="代理模式"><a class="markdownIt-Anchor" href="#代理模式"></a> 🌗代理模式</h1>
<p>在代理模式（Proxy Pattern）中，一个类代表另一个类的功能。这种类型的设计模式属于结构型模式。</p>
<p>在代理模式中，我们创建具有现有对象的对象，以便向外界提供功能接口。</p>
<h2 id="介绍-11"><a class="markdownIt-Anchor" href="#介绍-11"></a> 介绍</h2>
<p><strong>意图：</strong> 为其他对象提供一种代理以控制对这个对象的访问。</p>
<p><strong>主要解决：</strong><br />
在直接访问对象时带来的问题，比如说：要访问的对象在远程的机器上。在面向对象系统中，有些对象由于某些原因（比如对象创建开销很大，或者某些操作需要安全控制，或者需要进程外的访问），直接访问会给使用者或者系统结构带来很多麻烦，我们可以在访问此对象时加上一个对此对象的访问层。</p>
<p><strong>何时使用：</strong> 想在访问一个类时做一些控制。</p>
<p><strong>如何解决：</strong> 增加中间层。</p>
<p><strong>关键代码：</strong> 实现与被代理类组合。</p>
<p><strong>应用实例：</strong> 1、Windows 里面的快捷方式。2、猪八戒去找高翠兰结果是孙悟空变的，可以这样理解：把高翠兰的外貌抽象出来，高翠兰本人和孙悟空都实现了这个接口，猪八戒访问高翠兰的时候看不出来这个是孙悟空，所以说孙悟空是高翠兰代理类。3、买火车票不一定在火车站买，也可以去代售点。 4、一张支票或银行存单是账户中资金的代理。支票在市场交易中用来代替现金，并提供对签发人账号上资金的控制。5、spring aop。</p>
<p><strong>优点：</strong> 1、职责清晰。 2、高扩展性。 3、智能化。</p>
<p><strong>缺点：</strong> 1、由于在客户端和真实主题之间增加了代理对象，因此有些类型的代理模式可能会造成请求的处理速度变慢。2、实现代理模式需要额外的工作，有些代理模式的实现非常复杂。</p>
<p><strong>使用场景：</strong> 按职责来划分，通常有以下使用场景： 1、远程代理。 2、虚拟代理。 3、Copy-on-Write 代理。 4、保护（Protector Access）代理。 5、Cache代理。 6、防火墙（Firewall）代理。 7、同步化（Synchronization）代理。8、智能引用（Smart Reference）代理。</p>
<p><strong>注意事项：</strong> 1、和适配器模式的区别：适配器模式主要改变所考虑对象的接口，而代理模式不能改变所代理类的接口。2、和装饰器模式的区别：装饰器模式为了增强功能，而代理模式是为了加以控制。</p>
<h2 id="实现-9"><a class="markdownIt-Anchor" href="#实现-9"></a> 实现</h2>
<h3 id="静态代理"><a class="markdownIt-Anchor" href="#静态代理"></a> 静态代理</h3>
<blockquote>
<p>静态代码模式的基本介绍</p>
</blockquote>
<p>静态代理在使用时,需要定义接口或者父类,被代理对象(即目标对象)与代理对象一起实现相同的接口或者是继承相同父类</p>
<p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230103144345369.png" srcset="/img/loading.gif" lazyload alt="image-20230103144345369" /></p>
<p><code>ITeacherDao.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.proxy.staticproxy;<br><br><br><span class="hljs-comment">//接口</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ITeacherDao</span> &#123;<br>   <br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">teach</span><span class="hljs-params">()</span>; <span class="hljs-comment">// 授课的方法</span><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>TeacherDao.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.proxy.staticproxy;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TeacherDao</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ITeacherDao</span> &#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">teach</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot; 老师授课中  。。。。。&quot;</span>);<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>TeacherDaoProxy.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.proxy.staticproxy;<br><br><span class="hljs-comment">//代理对象,静态代理</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TeacherDaoProxy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ITeacherDao</span>&#123;<br>   <br>   <span class="hljs-keyword">private</span> ITeacherDao target; <span class="hljs-comment">// 目标对象，通过接口来聚合</span><br>   <br>   <br>   <span class="hljs-comment">//构造器</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">TeacherDaoProxy</span><span class="hljs-params">(ITeacherDao target)</span> &#123;<br>      <span class="hljs-built_in">this</span>.target = target;<br>   &#125;<br><br><br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">teach</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot;开始代理  完成某些操作。。。。。 &quot;</span>);<span class="hljs-comment">//方法</span><br>      target.teach();<br>      System.out.println(<span class="hljs-string">&quot;提交。。。。。&quot;</span>);<span class="hljs-comment">//方法</span><br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>Client.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.proxy.staticproxy;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-comment">//创建目标对象(被代理对象)</span><br>      <span class="hljs-type">TeacherDao</span> <span class="hljs-variable">teacherDao</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TeacherDao</span>();<br>      <br>      <span class="hljs-comment">//创建代理对象, 同时将被代理对象传递给代理对象</span><br>      <span class="hljs-type">TeacherDaoProxy</span> <span class="hljs-variable">teacherDaoProxy</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TeacherDaoProxy</span>(teacherDao);<br>      <br>      <span class="hljs-comment">//通过代理对象，调用到被代理对象的方法</span><br>      <span class="hljs-comment">//即：执行的是代理对象的方法，代理对象再去调用目标对象的方法 </span><br>      teacherDaoProxy.teach();<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<blockquote>
<p>执行程序，输出结果：</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs">开始代理  完成某些操作。。。。。 <br> 老师授课中  。。。。。<br>提交。。。。。<br><br></code></pre></td></tr></table></figure>
<blockquote>
<p>静态代理优缺点</p>
</blockquote>
<ol>
<li>
<p>优点：在不修改目标对象的功能前提下, 能通过代理对象对目标功能扩展</p>
</li>
<li>
<p>缺点：因为代理对象需要与目标对象实现一样的接口,所以会有很多代理类</p>
</li>
<li>
<p>一旦接口增加方法,目标对象与代理对象都要维护</p>
</li>
</ol>
<h3 id="动态代理"><a class="markdownIt-Anchor" href="#动态代理"></a> 动态代理</h3>
<blockquote>
<p>动态代理模式的基本介绍</p>
</blockquote>
<ol>
<li>代理对象,不需要实现接口，但是目标对象要实现接口，否则不能用动态代理</li>
<li>代理对象的生成，是利用 JDK 的 API，动态的在内存中构建代理对象</li>
<li>动态代理也叫做：JDK 代理、接口代理</li>
</ol>
<p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230103144507077.png" srcset="/img/loading.gif" lazyload alt="image-20230103144507077" /></p>
<p><code>Client.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.proxy.dynamic;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-comment">//创建目标对象</span><br>      <span class="hljs-type">ITeacherDao</span> <span class="hljs-variable">target</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TeacherDao</span>();<br>      <br>      <span class="hljs-comment">//给目标对象，创建代理对象, 可以转成 ITeacherDao</span><br>      <span class="hljs-type">ITeacherDao</span> <span class="hljs-variable">proxyInstance</span> <span class="hljs-operator">=</span> (ITeacherDao)<span class="hljs-keyword">new</span> <span class="hljs-title class_">ProxyFactory</span>(target).getProxyInstance();<br>   <br>      <span class="hljs-comment">// proxyInstance=class com.sun.proxy.$Proxy0 内存中动态生成了代理对象</span><br>      System.out.println(<span class="hljs-string">&quot;proxyInstance=&quot;</span> + proxyInstance.getClass());<br>      <br>      <span class="hljs-comment">//通过代理对象，调用目标对象的方法</span><br>      proxyInstance.teach();<br>      <br>      proxyInstance.sayHello(<span class="hljs-string">&quot; tom &quot;</span>);<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>ITeacherDao.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.proxy.dynamic;<br><br><span class="hljs-comment">//接口</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ITeacherDao</span> &#123;<br><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">teach</span><span class="hljs-params">()</span>; <span class="hljs-comment">// 授课方法</span><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">sayHello</span><span class="hljs-params">(String name)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>ProxyFactory.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.proxy.dynamic;<br><br><span class="hljs-keyword">import</span> java.lang.reflect.InvocationHandler;<br><span class="hljs-keyword">import</span> java.lang.reflect.Method;<br><span class="hljs-keyword">import</span> java.lang.reflect.Proxy;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProxyFactory</span> &#123;<br><br>   <span class="hljs-comment">//维护一个目标对象 , Object</span><br>   <span class="hljs-keyword">private</span> Object target;<br><br>   <span class="hljs-comment">//构造器 ， 对target 进行初始化</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">ProxyFactory</span><span class="hljs-params">(Object target)</span> &#123;<br>      <br>      <span class="hljs-built_in">this</span>.target = target;<br>   &#125; <br>   <br>   <span class="hljs-comment">//给目标对象 生成一个代理对象</span><br>   <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">getProxyInstance</span><span class="hljs-params">()</span> &#123;<br>      <br>      <span class="hljs-comment">//说明</span><br>      <span class="hljs-comment">/*</span><br><span class="hljs-comment">       *  public static Object newProxyInstance(ClassLoader loader,</span><br><span class="hljs-comment">                                          Class&lt;?&gt;[] interfaces,</span><br><span class="hljs-comment">                                          InvocationHandler h)</span><br><span class="hljs-comment">                                          </span><br><span class="hljs-comment">            //1. ClassLoader loader ： 指定当前目标对象使用的类加载器, 获取加载器的方法固定</span><br><span class="hljs-comment">            //2. Class&lt;?&gt;[] interfaces: 目标对象实现的接口类型，使用泛型方法确认类型</span><br><span class="hljs-comment">            //3. InvocationHandler h : 事情处理，执行目标对象的方法时，会触发事情处理器方法, 会把当前执行的目标对象方法作为参数传入</span><br><span class="hljs-comment">       */</span><br>      <span class="hljs-keyword">return</span> Proxy.newProxyInstance(target.getClass().getClassLoader(), <br>            target.getClass().getInterfaces(), <br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvocationHandler</span>() &#123;<br>               <br>               <span class="hljs-meta">@Override</span><br>               <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">invoke</span><span class="hljs-params">(Object proxy, Method method, Object[] args)</span> <span class="hljs-keyword">throws</span> Throwable &#123;<br>                  <span class="hljs-comment">// TODO Auto-generated method stub</span><br>                  System.out.println(<span class="hljs-string">&quot;JDK代理开始~~&quot;</span>);<br>                  <span class="hljs-comment">//反射机制调用目标对象的方法</span><br>                  <span class="hljs-type">Object</span> <span class="hljs-variable">returnVal</span> <span class="hljs-operator">=</span> method.invoke(target, args);<br>                  System.out.println(<span class="hljs-string">&quot;JDK代理提交&quot;</span>);<br>                  <span class="hljs-keyword">return</span> returnVal;<br>               &#125;<br>            &#125;); <br>   &#125;<br>   <br>   <br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>TeacherDao.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.proxy.dynamic;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TeacherDao</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ITeacherDao</span> &#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">teach</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot; 老师授课中.... &quot;</span>);<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sayHello</span><span class="hljs-params">(String name)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot;hello &quot;</span> + name);<br>   &#125;<br>   <br>&#125;<br></code></pre></td></tr></table></figure>
<blockquote>
<p>执行程序，输出结果：</p>
</blockquote>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">proxyInstance=class com.sun.proxy.$Proxy0<br><span class="hljs-keyword">JDK代理开始~~</span><br><span class="hljs-keyword"></span> 老师授课中.... <br><span class="hljs-keyword">JDK代理提交</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">JDK代理开始~~</span><br><span class="hljs-keyword"></span>hello  tom <br><span class="hljs-keyword">JDK代理提交</span><br></code></pre></td></tr></table></figure>
<h3 id="cglib-代理"><a class="markdownIt-Anchor" href="#cglib-代理"></a> Cglib 代理</h3>
<blockquote>
<p>Cglib 代理模式的基本介绍</p>
</blockquote>
<ol>
<li>
<p>静态代理和 JDK 代理模式都要求目标对象是实现一个接口,但是有时候目标对象只是一个<strong>单独的对象</strong>,并没<strong>有实****现任何的接口</strong>,这个时候可使用目标对象子类来实现代理-这就是 <strong>Cglib 代理</strong></p>
</li>
<li>
<p>Cglib代理也叫作**子类代理,**它是在内存中构建一个子类对象从而实现对目标对象功能扩展, 有些书也将Cglib代理归属到动态代理。</p>
</li>
<li>
<p>Cglib 是一个强大的高性能的代码生成包,它可以在运行期扩展 java 类与实现 java 接口.它广泛的被许多 AOP 的框架使用,例如 Spring AOP，实现方法拦截</p>
</li>
<li>
<p>在 AOP 编程中如何选择代理模式：</p>
<ul>
<li>
<p>目标对象需要实现接口，用 JDK 代理</p>
</li>
<li>
<p>目标对象不需要实现接口，用 Cglib 代理</p>
</li>
</ul>
</li>
<li>
<p>Cglib 包的底层是通过使用字节码处理框架 ASM 来转换字节码并生成新的类</p>
</li>
</ol>
<p><code>Client.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.proxy.cglib;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-comment">//创建目标对象</span><br>      <span class="hljs-type">TeacherDao</span> <span class="hljs-variable">target</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TeacherDao</span>();<br>      <span class="hljs-comment">//获取到代理对象，并且将目标对象传递给代理对象</span><br>      <span class="hljs-type">TeacherDao</span> <span class="hljs-variable">proxyInstance</span> <span class="hljs-operator">=</span> (TeacherDao)<span class="hljs-keyword">new</span> <span class="hljs-title class_">ProxyFactory</span>(target).getProxyInstance();<br><br>      <span class="hljs-comment">//执行代理对象的方法，触发intecept 方法，从而实现 对目标对象的调用</span><br>      <span class="hljs-type">String</span> <span class="hljs-variable">res</span> <span class="hljs-operator">=</span> proxyInstance.teach();<br>      System.out.println(<span class="hljs-string">&quot;res=&quot;</span> + res);<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>ProxyFactory.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.proxy.cglib;<br><br><br><br><br><span class="hljs-keyword">import</span> net.sf.cglib.proxy.Enhancer;<br><span class="hljs-keyword">import</span> net.sf.cglib.proxy.MethodInterceptor;<br><span class="hljs-keyword">import</span> net.sf.cglib.proxy.MethodProxy;<br><br><span class="hljs-keyword">import</span> java.lang.reflect.Method;<br><br><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProxyFactory</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MethodInterceptor</span> &#123;<br><br>   <span class="hljs-comment">//维护一个目标对象</span><br>   <span class="hljs-keyword">private</span> Object target;<br>   <br>   <span class="hljs-comment">//构造器，传入一个被代理的对象</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">ProxyFactory</span><span class="hljs-params">(Object target)</span> &#123;<br>      <span class="hljs-built_in">this</span>.target = target;<br>   &#125;<br><br>   <span class="hljs-comment">//返回一个代理对象:  是 target 对象的代理对象</span><br>   <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">getProxyInstance</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">//1. 创建一个工具类</span><br>      <span class="hljs-type">Enhancer</span> <span class="hljs-variable">enhancer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Enhancer</span>();<br>      <span class="hljs-comment">//2. 设置父类</span><br>      enhancer.setSuperclass(target.getClass());<br>      <span class="hljs-comment">//3. 设置回调函数</span><br>      enhancer.setCallback(<span class="hljs-built_in">this</span>);<br>      <span class="hljs-comment">//4. 创建子类对象，即代理对象</span><br>      <span class="hljs-keyword">return</span> enhancer.create();<br>      <br>   &#125;<br>   <br><br>   <span class="hljs-comment">//重写  intercept 方法，会调用目标对象的方法</span><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">intercept</span><span class="hljs-params">(Object arg0, Method method, Object[] args, MethodProxy arg3)</span> <span class="hljs-keyword">throws</span> Throwable &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot;Cglib代理模式 ~~ 开始&quot;</span>);<br>      <span class="hljs-type">Object</span> <span class="hljs-variable">returnVal</span> <span class="hljs-operator">=</span> method.invoke(target, args);<br>      System.out.println(<span class="hljs-string">&quot;Cglib代理模式 ~~ 提交&quot;</span>);<br>      <span class="hljs-keyword">return</span> returnVal;<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>TeacherDao.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.proxy.cglib;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TeacherDao</span> &#123;<br><br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">teach</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot; 老师授课中  ， 我是cglib代理，不需要实现接口 &quot;</span>);<br>      <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;hello&quot;</span>;<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<blockquote>
<p>执行程序，输出结果：</p>
</blockquote>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs routeros">Cglib代理模式 ~~ 开始<br> 老师授课中  ， 我是cglib代理，不需要实现接口 <br>Cglib代理模式 ~~ 提交<br><span class="hljs-attribute">res</span>=hello<br></code></pre></td></tr></table></figure>
<h1 id="模板模式"><a class="markdownIt-Anchor" href="#模板模式"></a> 🌗模板模式</h1>
<p>在模板模式（TemplatePattern）中，一个抽象类公开定义了执行它的方法的方式/模板。它的子类可以按需要重写方法实现，但调用将以抽象类中定义的方式进行。这种类型的设计模式属于行为型模式。</p>
<h2 id="介绍-12"><a class="markdownIt-Anchor" href="#介绍-12"></a> 介绍</h2>
<p><strong>意图：</strong> 定义一个操作中的算法的骨架，而将一些步骤延迟到子类中。模板方法使得子类可以不改变一个算法的结构即可重定义该算法的某些特定步骤。</p>
<p><strong>主要解决：</strong> 一些方法通用，却在每一个子类都重新写了这一方法。</p>
<p><strong>何时使用：</strong> 有一些通用的方法。</p>
<p><strong>如何解决：</strong> 将这些通用算法抽象出来。</p>
<p><strong>关键代码：</strong> 在抽象类实现，其他步骤在子类实现。</p>
<p><strong>应用实例：</strong> 1、在造房子的时候，地基、走线、水管都一样，只有在建筑的后期才有加壁橱加栅栏等差异。 2、西游记里面菩萨定好的 81难，这就是一个顶层的逻辑骨架。 3、spring 中对 Hibernate 的支持，将一些已经定好的方法封装起来，比如开启事务、获取 Session、关闭Session 等，程序员不重复写那些已经规范好的代码，直接丢一个实体就可以保存。</p>
<p><strong>优点：</strong> 1、封装不变部分，扩展可变部分。 2、提取公共代码，便于维护。 3、行为由父类控制，子类实现。</p>
<p><strong>缺点：</strong> 每一个不同的实现都需要一个子类来实现，导致类的个数增加，使得系统更加庞大。</p>
<p><strong>使用场景：</strong> 1、有多个子类共有的方法，且逻辑相同。 2、重要的、复杂的方法，可以考虑作为模板方法。</p>
<p><strong>注意事项：</strong> 为防止恶意操作，一般模板方法都加上 final 关键词。</p>
<p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230103150422044.png" srcset="/img/loading.gif" lazyload alt="image-20230103150422044" /></p>
<p>对原理类图的说明-即(模板方法模式的角色及职责)</p>
<ol>
<li>
<p>AbstractClass 抽象类， 类中实现了模板方法(template)，定义了算法的骨架，具体子类需要去实现 其它的抽象方法 operationr2,3,4</p>
</li>
<li>
<p>ConcreteClass 实现抽象方法 operationr2,3,4, 以完成算法中特点子类的步骤</p>
</li>
</ol>
<h2 id="实现-10"><a class="markdownIt-Anchor" href="#实现-10"></a> 实现</h2>
<ol>
<li>应用实例要求</li>
</ol>
<ul>
<li>编写制作豆浆的程序，说明如下:</li>
<li>制作豆浆的流程 选材—&gt;添加配料—&gt;浸泡—&gt;放到豆浆机打碎</li>
<li>通过添加不同的配料，可以制作出不同口味的豆浆</li>
<li>选材、浸泡和放到豆浆机打碎这几个步骤对于制作每种口味的豆浆都是一样的(红豆、花生豆浆。。。)</li>
</ul>
<ol start="2">
<li>思路分析和图解(类图)</li>
</ol>
<h3 id="模板方法模式一"><a class="markdownIt-Anchor" href="#模板方法模式一"></a> 模板方法模式一</h3>
<p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230103151032471.png" srcset="/img/loading.gif" lazyload alt="image-20230103151032471" /></p>
<p><code>Client.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.template;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-comment">//制作红豆豆浆</span><br>      <br>      System.out.println(<span class="hljs-string">&quot;----制作红豆豆浆----&quot;</span>);<br>      <span class="hljs-type">SoyaMilk</span> <span class="hljs-variable">redBeanSoyaMilk</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RedBeanSoyaMilk</span>();<br>      redBeanSoyaMilk.make();<br>      <br>      System.out.println(<span class="hljs-string">&quot;----制作花生豆浆----&quot;</span>);<br>      <span class="hljs-type">SoyaMilk</span> <span class="hljs-variable">peanutSoyaMilk</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PeanutSoyaMilk</span>();<br>      peanutSoyaMilk.make();<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>PeanutSoyaMilk.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.template;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PeanutSoyaMilk</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">SoyaMilk</span> &#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">addCondiments</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot; 加入上好的花生 &quot;</span>);<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>RedBeanSoyaMilk.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.template;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedBeanSoyaMilk</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">SoyaMilk</span> &#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">addCondiments</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot; 加入上好的红豆 &quot;</span>);<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>SoyaMilk.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.template;<br><br><span class="hljs-comment">//抽象类，表示豆浆</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SoyaMilk</span> &#123;<br><br>   <span class="hljs-comment">//模板方法, make , 模板方法可以做成final , 不让子类去覆盖.</span><br>   <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">make</span><span class="hljs-params">()</span> &#123;<br>      <br>      select(); <br>      addCondiments();<br>      soak();<br>      beat();<br>      <br>   &#125;<br>   <br>   <span class="hljs-comment">//选材料</span><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">select</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;第一步：选择好的新鲜黄豆  &quot;</span>);<br>   &#125;<br>   <br>   <span class="hljs-comment">//添加不同的配料， 抽象方法, 子类具体实现</span><br>   <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addCondiments</span><span class="hljs-params">()</span>;<br>   <br>   <span class="hljs-comment">//浸泡</span><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">soak</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;第三步， 黄豆和配料开始浸泡， 需要3小时 &quot;</span>);<br>   &#125;<br>    <br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">beat</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;第四步：黄豆和配料放到豆浆机去打碎  &quot;</span>);<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<blockquote>
<p>执行程序，输出结果：</p>
</blockquote>
<figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs brainfuck"><span class="hljs-literal">----</span><span class="hljs-comment">制作红豆豆浆</span><span class="hljs-literal">----</span><br><span class="hljs-comment">第一步：选择好的新鲜黄豆</span>  <br> <span class="hljs-comment">加入上好的红豆</span> <br><span class="hljs-comment">第三步， 黄豆和配料开始浸泡， 需要3小时</span> <br><span class="hljs-comment">第四步：黄豆和配料放到豆浆机去打碎</span>  <br><span class="hljs-literal">----</span><span class="hljs-comment">制作花生豆浆</span><span class="hljs-literal">----</span><br><span class="hljs-comment">第一步：选择好的新鲜黄豆</span>  <br> <span class="hljs-comment">加入上好的花生</span> <br><span class="hljs-comment">第三步， 黄豆和配料开始浸泡， 需要3小时</span> <br><span class="hljs-comment">第四步：黄豆和配料放到豆浆机去打碎</span> <br></code></pre></td></tr></table></figure>
<h3 id="模板方法模式的钩子方法"><a class="markdownIt-Anchor" href="#模板方法模式的钩子方法"></a> 模板方法模式的钩子方法</h3>
<ol>
<li>
<p>在模板方法模式的<strong>父类</strong>中，我们可以<strong>定义一个方法</strong>，它<strong>默认不做任何事</strong>，子类可以视情况要不要覆盖它，该方法称为“钩子”。</p>
</li>
<li>
<p>还是用上面做豆浆的例子来讲解，比如，我们还希望<strong>制作纯豆浆</strong>，<strong>不添加任何的配料</strong>，请使用钩子方法对前面的模板方法进行改造</p>
</li>
</ol>
<p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230103151439028.png" srcset="/img/loading.gif" lazyload alt="image-20230103151439028" /></p>
<p><code>Client.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.template.improve;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-comment">//制作红豆豆浆</span><br>      <br>      System.out.println(<span class="hljs-string">&quot;----制作红豆豆浆----&quot;</span>);<br>      <span class="hljs-type">SoyaMilk</span> <span class="hljs-variable">redBeanSoyaMilk</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RedBeanSoyaMilk</span>();<br>      redBeanSoyaMilk.make();<br>      <br>      System.out.println(<span class="hljs-string">&quot;----制作花生豆浆----&quot;</span>);<br>      <span class="hljs-type">SoyaMilk</span> <span class="hljs-variable">peanutSoyaMilk</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PeanutSoyaMilk</span>();<br>      peanutSoyaMilk.make();<br>      <br>      System.out.println(<span class="hljs-string">&quot;----制作纯豆浆----&quot;</span>);<br>      <span class="hljs-type">SoyaMilk</span> <span class="hljs-variable">pureSoyaMilk</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PureSoyaMilk</span>();<br>      pureSoyaMilk.make();<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>PeanutSoyaMilk.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.template.improve;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PeanutSoyaMilk</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">SoyaMilk</span> &#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">addCondiments</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot; 加入上好的花生 &quot;</span>);<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>PureSoyaMilk.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.template.improve;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PureSoyaMilk</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">SoyaMilk</span>&#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">addCondiments</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-comment">//空实现</span><br>   &#125;<br>   <br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-type">boolean</span> <span class="hljs-title function_">customerWantCondiments</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>   &#125;<br> <br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>RedBeanSoyaMilk.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.template.improve;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedBeanSoyaMilk</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">SoyaMilk</span> &#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">addCondiments</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot; 加入上好的红豆 &quot;</span>);<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>SoyaMilk.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.template.improve;<br><br><span class="hljs-comment">//抽象类，表示豆浆</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SoyaMilk</span> &#123;<br><br>   <span class="hljs-comment">//模板方法, make , 模板方法可以做成final , 不让子类去覆盖.</span><br>   <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">make</span><span class="hljs-params">()</span> &#123;<br>      <br>      select(); <br>      <span class="hljs-keyword">if</span>(customerWantCondiments()) &#123;<br>         addCondiments();<br>      &#125;<br>      soak();<br>      beat();<br>      <br>   &#125;<br>   <br>   <span class="hljs-comment">//选材料</span><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">select</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;第一步：选择好的新鲜黄豆  &quot;</span>);<br>   &#125;<br>   <br>   <span class="hljs-comment">//添加不同的配料， 抽象方法, 子类具体实现</span><br>   <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addCondiments</span><span class="hljs-params">()</span>;<br>   <br>   <span class="hljs-comment">//浸泡</span><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">soak</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;第三步， 黄豆和配料开始浸泡， 需要3小时 &quot;</span>);<br>   &#125;<br>    <br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">beat</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;第四步：黄豆和配料放到豆浆机去打碎  &quot;</span>);<br>   &#125;<br>   <br>   <span class="hljs-comment">//钩子方法，决定是否需要添加配料</span><br>   <span class="hljs-type">boolean</span> <span class="hljs-title function_">customerWantCondiments</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<blockquote>
<p>执行程序，输出结果：</p>
</blockquote>
<figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs brainfuck"><span class="hljs-literal">----</span><span class="hljs-comment">制作红豆豆浆</span><span class="hljs-literal">----</span><br><span class="hljs-comment">第一步：选择好的新鲜黄豆</span>  <br> <span class="hljs-comment">加入上好的红豆</span> <br><span class="hljs-comment">第三步， 黄豆和配料开始浸泡， 需要3小时</span> <br><span class="hljs-comment">第四步：黄豆和配料放到豆浆机去打碎</span>  <br><span class="hljs-literal">----</span><span class="hljs-comment">制作花生豆浆</span><span class="hljs-literal">----</span><br><span class="hljs-comment">第一步：选择好的新鲜黄豆</span>  <br> <span class="hljs-comment">加入上好的花生</span> <br><span class="hljs-comment">第三步， 黄豆和配料开始浸泡， 需要3小时</span> <br><span class="hljs-comment">第四步：黄豆和配料放到豆浆机去打碎</span>  <br><span class="hljs-literal">----</span><span class="hljs-comment">制作纯豆浆</span><span class="hljs-literal">----</span><br><span class="hljs-comment">第一步：选择好的新鲜黄豆</span>  <br><span class="hljs-comment">第三步， 黄豆和配料开始浸泡， 需要3小时</span> <br><span class="hljs-comment">第四步：黄豆和配料放到豆浆机去打碎</span> <br></code></pre></td></tr></table></figure>
<h2 id="模板方法模式的注意事项和细节"><a class="markdownIt-Anchor" href="#模板方法模式的注意事项和细节"></a> 模板方法模式的注意事项和细节</h2>
<ol>
<li>
<p>基本思想是：算法只存在于一个地方，也就是在父类中，容易修改。需要修改算法时，只要修改父类的模板方法或者已经实现的某些步骤，子类就会继承这些修改</p>
</li>
<li>
<p>实现了最大化代码复用。父类的模板方法和已实现的某些步骤会被子类继承而直接使用。</p>
</li>
<li>
<p>既统一了算法，也提供了很大的灵活性。父类的模板方法确保了算法的结构保持不变，同时由子类提供部分步骤的实现。</p>
</li>
<li>
<p>该模式的不足之处：每一个不同的实现都需要一个子类实现，导致类的个数增加，使得系统更加庞大</p>
</li>
<li>
<p>一般模板方法都加上 final 关键字， 防止子类重写模板方法.</p>
</li>
<li>
<p>模板方法模式使用场景：当要完成在某个过程，该过程要执行一系列步骤 ，这一系列的步骤基本相同，但其个别步骤在实现时 可能不同，通常考虑用模板方法模式来处理</p>
</li>
</ol>
<h1 id="命令模式"><a class="markdownIt-Anchor" href="#命令模式"></a> 命令模式</h1>
<p>命令模式（CommandPattern）是一种数据驱动的设计模式，它属于行为型模式。请求以命令的形式包裹在对象中，并传给调用对象。调用对象寻找可以处理该命令的合适的对象，并把该命令传给相应的对象，该对象执行命令。</p>
<h2 id="介绍-13"><a class="markdownIt-Anchor" href="#介绍-13"></a> 介绍</h2>
<p><strong>意图：</strong> 将一个请求封装成一个对象，从而使您可以用不同的请求对客户进行参数化。</p>
<p><strong>主要解决：</strong><br />
在软件系统中，行为请求者与行为实现者通常是一种紧耦合的关系，但某些场合，比如需要对行为进行记录、撤销或重做、事务等处理时，这种无法抵御变化的紧耦合的设计就不太合适。</p>
<p><strong>何时使用：</strong><br />
在某些场合，比如要对行为进行&quot;记录、撤销/重做、事务&quot;等处理，这种无法抵御变化的紧耦合是不合适的。在这种情况下，如何将&quot;行为请求者&quot;与&quot;行为实现者&quot;解耦？将一组行为抽象为对象，可以实现二者之间的松耦合。</p>
<p><strong>如何解决：</strong> 通过调用者调用接受者执行命令，顺序：调用者→命令→接受者。</p>
<p><strong>关键代码：</strong> 定义三个角色：1、received 真正的命令执行对象 2、Command 3、invoker 使用命令对象的入口</p>
<p><strong>应用实例：</strong> struts 1 中的 action 核心控制器 ActionServlet 只有一个，相当于<br />
Invoker，而模型层的类会随着不同的应用有不同的模型类，相当于具体的 Command。</p>
<p><strong>优点：</strong> 1、降低了系统耦合度。 2、新的命令可以很容易添加到系统中去。</p>
<p><strong>缺点：</strong> 使用命令模式可能会导致某些系统有过多的具体命令类。</p>
<p><strong>使用场景：</strong> 认为是命令的地方都可以使用命令模式，比如： 1、GUI 中每一个按钮都是一条命令。 2、模拟 CMD。</p>
<p><strong>注意事项：</strong> 系统需要支持命令的撤销(Undo)操作和恢复(Redo)操作，也可以考虑使用命令模式，见命令模式的扩展。</p>
<p>命令模式结构示意图:</p>
<p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/commanduml.jpg" srcset="/img/loading.gif" lazyload alt="" /></p>
<p>对原理类图的说明-即(命名模式的角色及职责)</p>
<ol>
<li>
<p>Invoker 是调用者角色</p>
</li>
<li>
<p>Command: 是命令角色，需要执行的所有命令都在这里，可以是接口或抽象类</p>
</li>
<li>
<p>Receiver: 接受者角色，知道如何实施和执行一个请求相关的操作</p>
</li>
<li>
<p>ConcreteCommand: 将一个接受者对象与一个动作绑定，调用接受者相应的操作，实现 execute</p>
</li>
</ol>
<h2 id="实现-11"><a class="markdownIt-Anchor" href="#实现-11"></a> 实现</h2>
<p>智能生活项目需求</p>
<p>看一个具体的需求</p>
<ol>
<li>
<p>我们买了一套智能家电，有照明灯、风扇、冰箱、洗衣机，我们只要在手机上安装 app 就可以控制对这些家电工作。</p>
</li>
<li>
<p>这些智能家电来自不同的厂家，我们不想针对每一种家电都安装一个 App，分别控制，我们希望只要一个 app就可以控制全部智能家电。</p>
</li>
<li>
<p>要实现一个 app 控制所有智能家电的需要，则每个智能家电厂家都要提供一个统一的接口给 app 调用，这时 就可以考虑使用命令模式。</p>
</li>
<li>
<p>命令模式可将“动作的请求者”从“动作的执行者”对象中解耦出来.</p>
</li>
<li>
<p>在我们的例子中，动作的请求者是手机 app，动作的执行者是每个厂商的一个家电产品</p>
</li>
</ol>
<p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230103163835693.png" srcset="/img/loading.gif" lazyload alt="image-20230103163835693" /></p>
<p><code>Client.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.command;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <br>      <span class="hljs-comment">//使用命令设计模式，完成通过遥控器，对电灯的操作</span><br>      <br>      <span class="hljs-comment">//创建电灯的对象(接受者)</span><br>      <span class="hljs-type">LightReceiver</span> <span class="hljs-variable">lightReceiver</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LightReceiver</span>();<br>      <br>      <span class="hljs-comment">//创建电灯相关的开关命令</span><br>      <span class="hljs-type">LightOnCommand</span> <span class="hljs-variable">lightOnCommand</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LightOnCommand</span>(lightReceiver);<br>      <span class="hljs-type">LightOffCommand</span> <span class="hljs-variable">lightOffCommand</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LightOffCommand</span>(lightReceiver);<br>      <br>      <span class="hljs-comment">//需要一个遥控器</span><br>      <span class="hljs-type">RemoteController</span> <span class="hljs-variable">remoteController</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RemoteController</span>();<br>      <br>      <span class="hljs-comment">//给我们的遥控器设置命令, 比如 no = 0 是电灯的开和关的操作</span><br>      remoteController.setCommand(<span class="hljs-number">0</span>, lightOnCommand, lightOffCommand);<br>      <br>      System.out.println(<span class="hljs-string">&quot;--------按下灯的开按钮-----------&quot;</span>);<br>      remoteController.onButtonWasPushed(<span class="hljs-number">0</span>);<br>      System.out.println(<span class="hljs-string">&quot;--------按下灯的关按钮-----------&quot;</span>);<br>      remoteController.offButtonWasPushed(<span class="hljs-number">0</span>);<br>      System.out.println(<span class="hljs-string">&quot;--------按下撤销按钮-----------&quot;</span>);<br>      remoteController.undoButtonWasPushed();<br>      <br>      <br>      System.out.println(<span class="hljs-string">&quot;=========使用遥控器操作电视机==========&quot;</span>);<br>      <br>      <span class="hljs-type">TVReceiver</span> <span class="hljs-variable">tvReceiver</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TVReceiver</span>();<br>      <br>      <span class="hljs-type">TVOffCommand</span> <span class="hljs-variable">tvOffCommand</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TVOffCommand</span>(tvReceiver);<br>      <span class="hljs-type">TVOnCommand</span> <span class="hljs-variable">tvOnCommand</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TVOnCommand</span>(tvReceiver);<br>      <br>      <span class="hljs-comment">//给我们的遥控器设置命令, 比如 no = 1 是电视机的开和关的操作</span><br>      remoteController.setCommand(<span class="hljs-number">1</span>, tvOnCommand, tvOffCommand);<br>      <br>      System.out.println(<span class="hljs-string">&quot;--------按下电视机的开按钮-----------&quot;</span>);<br>      remoteController.onButtonWasPushed(<span class="hljs-number">1</span>);<br>      System.out.println(<span class="hljs-string">&quot;--------按下电视机的关按钮-----------&quot;</span>);<br>      remoteController.offButtonWasPushed(<span class="hljs-number">1</span>);<br>      System.out.println(<span class="hljs-string">&quot;--------按下撤销按钮-----------&quot;</span>);<br>      remoteController.undoButtonWasPushed();<br><br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>Command.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.command;<br><br><br><span class="hljs-comment">//创建命令接口</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Command</span> &#123;<br><br>   <span class="hljs-comment">//执行动作(操作)</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">()</span>;<br>   <span class="hljs-comment">//撤销动作(操作)</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">undo</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>LightOffCommand.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.command;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LightOffCommand</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Command</span> &#123;<br><br>   <span class="hljs-comment">// 聚合LightReceiver</span><br><br>   LightReceiver light;<br><br>   <span class="hljs-comment">// 构造器</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">LightOffCommand</span><span class="hljs-params">(LightReceiver light)</span> &#123;<br>         <span class="hljs-built_in">super</span>();<br>         <span class="hljs-built_in">this</span>.light = light;<br>      &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-comment">// 调用接收者的方法</span><br>      light.off();<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">undo</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-comment">// 调用接收者的方法</span><br>      light.on();<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>LightOnCommand.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.command;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LightOnCommand</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Command</span> &#123;<br><br>   <span class="hljs-comment">//聚合LightReceiver</span><br>   <br>   LightReceiver light;<br>   <br>   <span class="hljs-comment">//构造器</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">LightOnCommand</span><span class="hljs-params">(LightReceiver light)</span> &#123;<br>      <span class="hljs-built_in">super</span>();<br>      <span class="hljs-built_in">this</span>.light = light;<br>   &#125;<br>   <br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-comment">//调用接收者的方法</span><br>      light.on();<br>   &#125;<br><br>   <br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">undo</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-comment">//调用接收者的方法</span><br>      light.off();<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>LightReceiver.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.command;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LightReceiver</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">on</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot; 电灯打开了.. &quot;</span>);<br>   &#125;<br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">off</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot; 电灯关闭了.. &quot;</span>);<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>NoCommand.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.command;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 没有任何命令，即空执行: 用于初始化每个按钮, 当调用空命令时，对象什么都不做</span><br><span class="hljs-comment"> * 其实，这样是一种设计模式, 可以省掉对空判断</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Administrator</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NoCommand</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Command</span> &#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">undo</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>RemoteController.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.command;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RemoteController</span> &#123;<br><br>   <span class="hljs-comment">// 开 按钮的命令数组</span><br>   Command[] onCommands;<br>   Command[] offCommands;<br><br>   <span class="hljs-comment">// 执行撤销的命令</span><br>   Command undoCommand;<br><br>   <span class="hljs-comment">// 构造器，完成对按钮初始化</span><br><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">RemoteController</span><span class="hljs-params">()</span> &#123;<br><br>      onCommands = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Command</span>[<span class="hljs-number">5</span>];<br>      offCommands = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Command</span>[<span class="hljs-number">5</span>];<br><br>      <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) &#123;<br>         onCommands[i] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NoCommand</span>();<br>         offCommands[i] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NoCommand</span>();<br>      &#125;<br>   &#125;<br><br>   <span class="hljs-comment">// 给我们的按钮设置你需要的命令</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setCommand</span><span class="hljs-params">(<span class="hljs-type">int</span> no, Command onCommand, Command offCommand)</span> &#123;<br>      onCommands[no] = onCommand;<br>      offCommands[no] = offCommand;<br>   &#125;<br><br>   <span class="hljs-comment">// 按下开按钮</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onButtonWasPushed</span><span class="hljs-params">(<span class="hljs-type">int</span> no)</span> &#123; <span class="hljs-comment">// no 0</span><br>      <span class="hljs-comment">// 找到你按下的开的按钮， 并调用对应方法</span><br>      onCommands[no].execute();<br>      <span class="hljs-comment">// 记录这次的操作，用于撤销</span><br>      undoCommand = onCommands[no];<br><br>   &#125;<br><br>   <span class="hljs-comment">// 按下开按钮</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">offButtonWasPushed</span><span class="hljs-params">(<span class="hljs-type">int</span> no)</span> &#123; <span class="hljs-comment">// no 0</span><br>      <span class="hljs-comment">// 找到你按下的关的按钮， 并调用对应方法</span><br>      offCommands[no].execute();<br>      <span class="hljs-comment">// 记录这次的操作，用于撤销</span><br>      undoCommand = offCommands[no];<br><br>   &#125;<br>   <br>   <span class="hljs-comment">// 按下撤销按钮</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">undoButtonWasPushed</span><span class="hljs-params">()</span> &#123;<br>      undoCommand.undo();<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>TVOffCommand.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.command;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TVOffCommand</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Command</span> &#123;<br><br>   <span class="hljs-comment">// 聚合TVReceiver</span><br><br>   TVReceiver tv;<br><br>   <span class="hljs-comment">// 构造器</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">TVOffCommand</span><span class="hljs-params">(TVReceiver tv)</span> &#123;<br>      <span class="hljs-built_in">super</span>();<br>      <span class="hljs-built_in">this</span>.tv = tv;<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-comment">// 调用接收者的方法</span><br>      tv.off();<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">undo</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-comment">// 调用接收者的方法</span><br>      tv.on();<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>TVOnCommand.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.command;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TVOnCommand</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Command</span> &#123;<br><br>   <span class="hljs-comment">// 聚合TVReceiver</span><br><br>   TVReceiver tv;<br><br>   <span class="hljs-comment">// 构造器</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">TVOnCommand</span><span class="hljs-params">(TVReceiver tv)</span> &#123;<br>      <span class="hljs-built_in">super</span>();<br>      <span class="hljs-built_in">this</span>.tv = tv;<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-comment">// 调用接收者的方法</span><br>      tv.on();<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">undo</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-comment">// 调用接收者的方法</span><br>      tv.off();<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>TVReceiver.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.command;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TVReceiver</span> &#123;<br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">on</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot; 电视机打开了.. &quot;</span>);<br>   &#125;<br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">off</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot; 电视机关闭了.. &quot;</span>);<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<blockquote>
<p>执行程序，输出结果：</p>
</blockquote>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs abnf">--------按下灯的开按钮-----------<br> 电灯打开了.. <br>--------按下灯的关按钮-----------<br> 电灯关闭了.. <br>--------按下撤销按钮-----------<br> 电灯打开了.. <br><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span>使用遥控器操作电视机<span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><br>--------按下电视机的开按钮-----------<br> 电视机打开了.. <br>--------按下电视机的关按钮-----------<br> 电视机关闭了.. <br>--------按下撤销按钮-----------<br> 电视机打开了..<br></code></pre></td></tr></table></figure>
<h2 id="命令模式的注意事项和细节"><a class="markdownIt-Anchor" href="#命令模式的注意事项和细节"></a> 命令模式的注意事项和细节</h2>
<ol>
<li>
<p>将发起请求的对象与执行请求的对象解耦。发起请求的对象是调用者，调用者只要调用命令对象的 execute()方法就可以让接收者工作，而不必知道具体的接收者对象是谁、是如何实现的，命令对象会负责让接收者执行请求的动作，也就是说：”请求发起者”和“请求执行者”之间的解耦是通过命令对象实现的，命令对象起到了纽带桥梁的作用。</p>
</li>
<li>
<p>容易设计一个命令队列。只要把命令对象放到列队，就可以多线程的执行命令</p>
</li>
<li>
<p>容易实现对请求的撤销和重做</p>
</li>
<li>
<p><strong>命令模式不足</strong>：可能导致某些系统有过多的具体命令类，增加了系统的复杂度，这点在在使用的时候要注意</p>
</li>
<li>
<p><strong>空命令也是一种设计模式</strong>，它为我们<strong>省去了判空的操作</strong>。在上面的实例中，如果没有用空命令，我们每按下一个按键都要判空，这给我们编码带来一定的麻烦。</p>
</li>
<li>
<p>命令模式经典的应用场景：界面的一个按钮都是一条命令、模拟 CMD（DOS 命令）订单的撤销/恢复、触发-反馈机制</p>
</li>
</ol>
<h1 id="访问者模式"><a class="markdownIt-Anchor" href="#访问者模式"></a> 访问者模式</h1>
<p>在访问者模式（Visitor Pattern）中，我们使用了一个访问者类，它改变了元素类的执行算法。通过这种方式，元素的执行算法可以随着访问者改变而改变。这种类型的设计模式属于行为型模式。根据模式，元素对象已接受访问者对象，这样访问者对象就可以处理元素对象上的操作。</p>
<h2 id="介绍-14"><a class="markdownIt-Anchor" href="#介绍-14"></a> 介绍</h2>
<p><strong>意图：</strong> 主要将数据结构与数据操作分离。</p>
<p><strong>主要解决：</strong> 稳定的数据结构和易变的操作耦合问题。</p>
<p><strong>何时使用：</strong> 需要对一个对象结构中的对象进行很多不同的并且不相关的操作，而需要避免让这些操作&quot;污染&quot;这些对象的类，使用访问者模式将这些封装到类中。</p>
<p><strong>如何解决：</strong> 在被访问的类里面加一个对外提供接待访问者的接口。</p>
<p><strong>关键代码：</strong> 在数据基础类里面有一个方法接受访问者，将自身引用传入访问者。</p>
<p><strong>应用实例：</strong> 您在朋友家做客，您是访问者，朋友接受您的访问，您通过朋友的描述，然后对朋友的描述做出一个判断，这就是访问者模式。</p>
<p><strong>优点：</strong> 1、符合单一职责原则。 2、优秀的扩展性。 3、灵活性。</p>
<p><strong>缺点：</strong> 1、具体元素对访问者公布细节，违反了迪米特原则。 2、具体元素变更比较困难。 3、违反了依赖倒置原则，依赖了具体类，没有依赖抽象。</p>
<p><strong>使用场景：</strong> 1、对象结构中对象对应的类很少改变，但经常需要在此对象结构上定义新的操作。<br />
2、需要对一个对象结构中的对象进行很多不同的并且不相关的操作，而需要避免让这些操作&quot;污染&quot;这些对象的类，也不希望在增加新操作时修改这些类。</p>
<p><strong>注意事项：</strong> 访问者可以对功能进行统一，可以做报表、UI、拦截器与过滤器。</p>
<p><strong>访问者模式的原理类图:</strong><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230103191915903.png" srcset="/img/loading.gif" lazyload alt="image-20230103191915903" /></p>
<p>对原理类图的说明-即(访问者模式的角色及职责)</p>
<ol>
<li>
<p>Visitor 是抽象访问者，为该对象结构中的 ConcreteElement 的每一个类声明一个 visit 操作</p>
</li>
<li>
<p>ConcreteVisitor ：是一个具体的访问值 实现每个有 Visitor 声明的操作，是每个操作实现的部分.</p>
</li>
<li>
<p>ObjectStructure 能枚举它的元素， 可以提供一个高层的接口，用来允许访问者访问元素</p>
</li>
<li>
<p>Element 定义一个 accept 方法，接收一个访问者对象</p>
</li>
<li>
<p>ConcreteElement 为具体元素，实现了 accept 方法</p>
</li>
</ol>
<h2 id="实现-12"><a class="markdownIt-Anchor" href="#实现-12"></a> 实现</h2>
<p>完成测评系统需求</p>
<ol>
<li>将观众分为男人和女人，对歌手进行测评，当看完某个歌手表演后，得到他们对该歌手不同的评价(评价 有不同的种类，比如 成功、失败 等)</li>
</ol>
<p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230103191809297.png" srcset="/img/loading.gif" lazyload alt="image-20230103191809297" /></p>
<p><code>Action.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.visitor;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Action</span> &#123;<br>   <br>   <span class="hljs-comment">//得到男性 的测评</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">getManResult</span><span class="hljs-params">(Man man)</span>;<br>   <br>   <span class="hljs-comment">//得到女的 测评</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">getWomanResult</span><span class="hljs-params">(Woman woman)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>Client.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.visitor;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-comment">//创建ObjectStructure</span><br>      <span class="hljs-type">ObjectStructure</span> <span class="hljs-variable">objectStructure</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectStructure</span>();<br>      <br>      objectStructure.attach(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Man</span>());<br>      objectStructure.attach(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Woman</span>());<br>      <br>      <br>      <span class="hljs-comment">//成功</span><br>      <span class="hljs-type">Success</span> <span class="hljs-variable">success</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Success</span>();<br>      objectStructure.display(success);<br>      <br>      System.out.println(<span class="hljs-string">&quot;~~~~~~~~~~~~~~~~~~~~~~~~~~&quot;</span>);<br>      <span class="hljs-type">Fail</span> <span class="hljs-variable">fail</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Fail</span>();<br>      objectStructure.display(fail);<br>      <br>      System.out.println(<span class="hljs-string">&quot;~~~~~~~~~~~给的是待定的测评~~~~~~~~~~~&quot;</span>);<br>      <br>      <span class="hljs-type">Wait</span> <span class="hljs-variable">wait</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Wait</span>();<br>      objectStructure.display(wait);<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>Fail.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.visitor;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Fail</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Action</span> &#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">getManResult</span><span class="hljs-params">(Man man)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot; 男人给的评价该歌手失败 !&quot;</span>);<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">getWomanResult</span><span class="hljs-params">(Woman woman)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot; 女人给的评价该歌手失败 !&quot;</span>);<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>Man.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.visitor;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Man</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Person</span> &#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">accept</span><span class="hljs-params">(Action action)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      action.getManResult(<span class="hljs-built_in">this</span>);<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>ObjectStructure.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.visitor;<br><br><span class="hljs-keyword">import</span> java.util.LinkedList;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-comment">//数据结构，管理很多人（Man , Woman）</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ObjectStructure</span> &#123;<br><br>   <span class="hljs-comment">//维护了一个集合</span><br>   <span class="hljs-keyword">private</span> List&lt;Person&gt; persons = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedList</span>&lt;&gt;();<br>   <br>   <span class="hljs-comment">//增加到list</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">attach</span><span class="hljs-params">(Person p)</span> &#123;<br>      persons.add(p);<br>   &#125;<br>   <span class="hljs-comment">//移除</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">detach</span><span class="hljs-params">(Person p)</span> &#123;<br>      persons.remove(p);<br>   &#125;<br>   <br>   <span class="hljs-comment">//显示测评情况</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">display</span><span class="hljs-params">(Action action)</span> &#123;<br>      <span class="hljs-keyword">for</span>(Person p: persons) &#123;<br>         p.accept(action);<br>      &#125;<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>Person.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.visitor;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> &#123;<br>   <br>   <span class="hljs-comment">//提供一个方法，让访问者可以访问</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">accept</span><span class="hljs-params">(Action action)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>Success.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.visitor;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Success</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Action</span> &#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">getManResult</span><span class="hljs-params">(Man man)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot; 男人给的评价该歌手很成功 !&quot;</span>);<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">getWomanResult</span><span class="hljs-params">(Woman woman)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot; 女人给的评价该歌手很成功 !&quot;</span>);<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>Wait.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.visitor;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Wait</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Action</span> &#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">getManResult</span><span class="hljs-params">(Man man)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot; 男人给的评价是该歌手待定 ..&quot;</span>);<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">getWomanResult</span><span class="hljs-params">(Woman woman)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot; 女人给的评价是该歌手待定 ..&quot;</span>);<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>Woman.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.visitor;<br><br><span class="hljs-comment">//说明</span><br><span class="hljs-comment">//1. 这里我们使用到了双分派, 即首先在客户端程序中，将具体状态作为参数传递Woman中(第一次分派)</span><br><span class="hljs-comment">//2. 然后Woman 类调用作为参数的 &quot;具体方法&quot; 中方法getWomanResult, 同时将自己(this)作为参数</span><br><span class="hljs-comment">//   传入，完成第二次的分派</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Woman</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Person</span>&#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">accept</span><span class="hljs-params">(Action action)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      action.getWomanResult(<span class="hljs-built_in">this</span>);<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<blockquote>
<p>执行程序，输出结果：</p>
</blockquote>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-code"> 男人给的评价该歌手很成功 !</span><br><span class="hljs-section"> 女人给的评价该歌手很成功 !</span><br><span class="hljs-section">~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="hljs-code"> 男人给的评价该歌手失败 !</span><br><span class="hljs-code"> 女人给的评价该歌手失败 !</span><br>~~~~~~~~~~~给的是待定的测评~~~~~~~~~~~<br><span class="hljs-code"> 男人给的评价是该歌手待定 ..</span><br><span class="hljs-code"> 女人给的评价是该歌手待定 ..</span><br></code></pre></td></tr></table></figure>
<blockquote>
<p>应用案例的小结-双分派</p>
</blockquote>
<ol>
<li>
<p>上面提到了双分派，所谓双分派是指不管类怎么变化，我们都能找到期望的方法运行。双分派意味着得到执行的操作取决于请求的种类和两个接收者的类型</p>
</li>
<li>
<p>以上述实例为例，<strong>假设我们要添加一个 Wait 的状态类，考察 Man 类和 Woman 类的反应</strong>，由于使用了双分派，只需增加一个 Action 子类即可在客户端调用即可，<strong>不需要改动任何其他类的代码</strong>。</p>
</li>
</ol>
<h2 id="访问者模式的注意事项和细节"><a class="markdownIt-Anchor" href="#访问者模式的注意事项和细节"></a> 访问者模式的注意事项和细节</h2>
<ol>
<li>
<p>优点</p>
<ul>
<li>
<p>访问者模式符合单一职责原则、让程序具有优秀的扩展性、灵活性非常高</p>
</li>
<li>
<p>访问者模式可以对功能进行统一，可以做报表、UI、拦截器与过滤器，适用于数据结构相对稳定的系统</p>
</li>
</ul>
</li>
<li>
<p>缺点</p>
</li>
</ol>
<ul>
<li>
<p>具体元素对访问者公布细节，也就是说访问者关注了其他类的内部细节，这是迪米特法则所不建议的, 这样造成了具体元素变更比较困难</p>
</li>
<li>
<p>违背了依赖倒转原则。访问者依赖的是具体元素，而不是抽象元素</p>
</li>
<li>
<p>因此，<strong>如果一个系统有比较稳定的数据结构</strong>，又有经常变化的功能需求，那么<strong>访问者模式就是比较合适</strong>的</p>
</li>
</ul>
<h1 id="迭代器模式"><a class="markdownIt-Anchor" href="#迭代器模式"></a> 🌗迭代器模式</h1>
<p>迭代器模式（Iterator Pattern）是 Java 和 .Net 编程环境中非常常用的设计模式。这种模式用于顺序访问集合对象的元素，不需要知道集合对象的底层表示。</p>
<p>迭代器模式属于行为型模式。</p>
<h2 id="介绍-15"><a class="markdownIt-Anchor" href="#介绍-15"></a> 介绍</h2>
<p><strong>意图：</strong> 提供一种方法顺序访问一个聚合对象中各个元素, 而又无须暴露该对象的内部表示。</p>
<p><strong>主要解决：</strong> 不同的方式来遍历整个整合对象。</p>
<p><strong>何时使用：</strong> 遍历一个聚合对象。</p>
<p><strong>如何解决：</strong> 把在元素之间游走的责任交给迭代器，而不是聚合对象。</p>
<p><strong>关键代码：</strong> 定义接口：hasNext, next。</p>
<p><strong>应用实例：</strong> JAVA 中的 iterator。</p>
<p><strong>优点：</strong> 1、它支持以不同的方式遍历一个聚合对象。 2、迭代器简化了聚合类。 3、在同一个聚合上可以有多个遍历。<br />
4、在迭代器模式中，增加新的聚合类和迭代器类都很方便，无须修改原有代码。</p>
<p><strong>缺点：</strong> 由于迭代器模式将存储数据和遍历数据的职责分离，增加新的聚合类需要对应增加新的迭代器类，类的个数成对增加，这在一定程度上增加了系统的复杂性。</p>
<p><strong>使用场景：</strong> 1、访问一个聚合对象的内容而无须暴露它的内部表示。 2、需要为聚合对象提供多种遍历方式。 3、为遍历不同的聚合结构提供一个统一的接口。</p>
<p><strong>注意事项：</strong><br />
迭代器模式就是分离了集合对象的遍历行为，抽象出一个迭代器类来负责，这样既可以做到不暴露集合的内部结构，又可让外部代码透明地访问集合内部的数据。</p>
<h2 id="实现-13"><a class="markdownIt-Anchor" href="#实现-13"></a> 实现</h2>
<p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230103201406957.png" srcset="/img/loading.gif" lazyload alt="image-20230103201406957" /></p>
<p><code>Client.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.iterator;<br><br><span class="hljs-keyword">import</span> java.util.ArrayList;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * 相当于一个大学</span><br><span class="hljs-comment">         *</span><br><span class="hljs-comment">         */</span><br>        List&lt;College&gt; collegeList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;College&gt;();<br><br>        <span class="hljs-comment">//创建学院</span><br>        <span class="hljs-type">ComputerCollege</span> <span class="hljs-variable">computerCollege</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ComputerCollege</span>();<br>        <span class="hljs-type">InfoCollege</span> <span class="hljs-variable">infoCollege</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InfoCollege</span>();<br><br>        collegeList.add(computerCollege);<br>        collegeList.add(infoCollege);<br><br>        <span class="hljs-type">OutPutImpl</span> <span class="hljs-variable">outPutImpl</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OutPutImpl</span>(collegeList);<br>        outPutImpl.printCollege();<br><br>    &#125;<br><br><br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>College.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.iterator;<br><br><span class="hljs-keyword">import</span> java.util.Iterator;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">College</span> &#123;<br>   <br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span>;<br>   <br>   <span class="hljs-comment">//增加系的方法</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addDepartment</span><span class="hljs-params">(String name, String desc)</span>;<br>   <br>   <span class="hljs-comment">//返回一个迭代器,遍历</span><br>   <span class="hljs-keyword">public</span> Iterator  <span class="hljs-title function_">createIterator</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>ComputerCollege.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.iterator;<br><br><span class="hljs-keyword">import</span> java.util.Iterator;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ComputerCollege</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">College</span> &#123;<br><br>   Department[] departments;<br>   <span class="hljs-type">int</span> <span class="hljs-variable">numOfDepartment</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span> ;<span class="hljs-comment">// 保存当前数组的对象个数</span><br>   <br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">ComputerCollege</span><span class="hljs-params">()</span> &#123;<br>      departments = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Department</span>[<span class="hljs-number">5</span>];<br>      addDepartment(<span class="hljs-string">&quot;Java专业&quot;</span>, <span class="hljs-string">&quot; Java专业 &quot;</span>);<br>      addDepartment(<span class="hljs-string">&quot;PHP专业&quot;</span>, <span class="hljs-string">&quot; PHP专业 &quot;</span>);<br>      addDepartment(<span class="hljs-string">&quot;大数据专业&quot;</span>, <span class="hljs-string">&quot; 大数据专业 &quot;</span>);<br>      <br>   &#125;<br>   <br>   <br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;计算机学院&quot;</span>;<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addDepartment</span><span class="hljs-params">(String name, String desc)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-type">Department</span> <span class="hljs-variable">department</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Department</span>(name, desc);<br>      departments[numOfDepartment] = department;<br>      numOfDepartment += <span class="hljs-number">1</span>;<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> Iterator <span class="hljs-title function_">createIterator</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ComputerCollegeIterator</span>(departments);<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>ComputerCollegeIterator.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.iterator;<br><br><span class="hljs-keyword">import</span> java.util.Iterator;<br><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ComputerCollegeIterator</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Iterator</span> &#123;<br><br>   <span class="hljs-comment">//这里我们需要Department 是以怎样的方式存放=&gt;数组</span><br>   Department[] departments;<br>   <span class="hljs-type">int</span> <span class="hljs-variable">position</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; <span class="hljs-comment">//遍历的位置</span><br>   <br>   <br>   <br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">ComputerCollegeIterator</span><span class="hljs-params">(Department[] departments)</span> &#123;<br>      <span class="hljs-built_in">this</span>.departments = departments;<br>   &#125;<br><br>   <span class="hljs-comment">//判断是否还有下一个元素</span><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">hasNext</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-keyword">if</span>(position &gt;= departments.length || departments[position] == <span class="hljs-literal">null</span>) &#123;<br>         <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>      &#125;<span class="hljs-keyword">else</span> &#123;<br>      <br>         <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>      &#125;<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">next</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-type">Department</span> <span class="hljs-variable">department</span> <span class="hljs-operator">=</span> departments[position];<br>      position += <span class="hljs-number">1</span>;<br>      <span class="hljs-keyword">return</span> department;<br>   &#125;<br>   <br>   <span class="hljs-comment">//删除的方法，默认空实现</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">remove</span><span class="hljs-params">()</span> &#123;<br>      <br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>Department.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.iterator;<br><br><span class="hljs-comment">//系</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Department</span> &#123;<br><br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> String desc;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Department</span><span class="hljs-params">(String name, String desc)</span> &#123;<br>        <span class="hljs-built_in">super</span>();<br>        <span class="hljs-built_in">this</span>.name = name;<br>        <span class="hljs-built_in">this</span>.desc = desc;<br><br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getDesc</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> desc;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setDesc</span><span class="hljs-params">(String desc)</span> &#123;<br>        <span class="hljs-built_in">this</span>.desc = desc;<br>    &#125;<br><br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>InfoColleageIterator.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.iterator;<br><br><span class="hljs-keyword">import</span> java.util.Iterator;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InfoColleageIterator</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Iterator</span> &#123;<br><br><br>    List&lt;Department&gt; departmentList; <span class="hljs-comment">// 信息工程学院是以List方式存放系</span><br>    <span class="hljs-type">int</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> -<span class="hljs-number">1</span>;<span class="hljs-comment">//索引</span><br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">InfoColleageIterator</span><span class="hljs-params">(List&lt;Department&gt; departmentList)</span> &#123;<br>        <span class="hljs-built_in">this</span>.departmentList = departmentList;<br>    &#125;<br><br>    <span class="hljs-comment">//判断list中还有没有下一个元素</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">hasNext</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// TODO Auto-generated method stub</span><br>        <span class="hljs-keyword">if</span> (index &gt;= departmentList.size() - <span class="hljs-number">1</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            index += <span class="hljs-number">1</span>;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">next</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// TODO Auto-generated method stub</span><br>        <span class="hljs-keyword">return</span> departmentList.get(index);<br>    &#125;<br><br>    <span class="hljs-comment">//空实现remove</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">remove</span><span class="hljs-params">()</span> &#123;<br><br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>InfoCollege.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.iterator;<br><br><span class="hljs-keyword">import</span> java.util.ArrayList;<br><span class="hljs-keyword">import</span> java.util.Iterator;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InfoCollege</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">College</span> &#123;<br><br>   List&lt;Department&gt; departmentList;<br>   <br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">InfoCollege</span><span class="hljs-params">()</span> &#123;<br>      departmentList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;Department&gt;();<br>      addDepartment(<span class="hljs-string">&quot;信息安全专业&quot;</span>, <span class="hljs-string">&quot; 信息安全专业 &quot;</span>);<br>      addDepartment(<span class="hljs-string">&quot;网络安全专业&quot;</span>, <span class="hljs-string">&quot; 网络安全专业 &quot;</span>);<br>      addDepartment(<span class="hljs-string">&quot;服务器安全专业&quot;</span>, <span class="hljs-string">&quot; 服务器安全专业 &quot;</span>);<br>   &#125;<br>   <br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;信息工程学院&quot;</span>;<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addDepartment</span><span class="hljs-params">(String name, String desc)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-type">Department</span> <span class="hljs-variable">department</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Department</span>(name, desc);<br>      departmentList.add(department);<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> Iterator <span class="hljs-title function_">createIterator</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InfoColleageIterator</span>(departmentList);<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>OutPutImpl.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.iterator;<br><br><span class="hljs-keyword">import</span> java.util.Iterator;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OutPutImpl</span> &#123;<br>   <br>   <span class="hljs-comment">//学院集合</span><br>   List&lt;College&gt; collegeList;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">OutPutImpl</span><span class="hljs-params">(List&lt;College&gt; collegeList)</span> &#123;<br>      <br>      <span class="hljs-built_in">this</span>.collegeList = collegeList;<br>   &#125;<br>   <span class="hljs-comment">//遍历所有学院,然后调用printDepartment 输出各个学院的系</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">printCollege</span><span class="hljs-params">()</span> &#123;<br>      <br>      <span class="hljs-comment">//从collegeList 取出所有学院, Java 中的 List 已经实现Iterator</span><br>      Iterator&lt;College&gt; iterator = collegeList.iterator();<br>      <br>      <span class="hljs-keyword">while</span>(iterator.hasNext()) &#123;<br>         <span class="hljs-comment">//取出一个学院</span><br>         <span class="hljs-type">College</span> <span class="hljs-variable">college</span> <span class="hljs-operator">=</span> iterator.next();<br>         System.out.println(<span class="hljs-string">&quot;=== &quot;</span>+college.getName() +<span class="hljs-string">&quot;=====&quot;</span> );<br>         printDepartment(college.createIterator()); <span class="hljs-comment">//得到对应迭代器</span><br>      &#125;<br>   &#125;<br>   <br>   <br>   <span class="hljs-comment">//输出 学院输出 系</span><br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">printDepartment</span><span class="hljs-params">(Iterator iterator)</span> &#123;<br>      <span class="hljs-keyword">while</span>(iterator.hasNext()) &#123;<br>         <span class="hljs-type">Department</span> <span class="hljs-variable">d</span> <span class="hljs-operator">=</span> (Department)iterator.next();<br>         System.out.println(d.getName());<br>      &#125;<br>   &#125;<br>   <br>&#125;<br></code></pre></td></tr></table></figure>
<blockquote>
<p>执行程序，输出结果：</p>
</blockquote>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-section">=== 计算机学院=====</span><br>Java专业<br>PHP专业<br>大数据专业<br><span class="hljs-section">=== 信息工程学院=====</span><br>信息安全专业<br>网络安全专业<br>服务器安全专业<br></code></pre></td></tr></table></figure>
<h2 id="迭代器模式的注意事项和细节"><a class="markdownIt-Anchor" href="#迭代器模式的注意事项和细节"></a> 迭代器模式的注意事项和细节</h2>
<ol>
<li>优点</li>
</ol>
<ul>
<li>
<p>提供一个统一的方法遍历对象，客户不用再考虑聚合的类型，使用一种方法就可以遍历对象了。</p>
</li>
<li>
<p>隐藏了聚合的内部结构，客户端要遍历聚合的时候只能取到迭代器，而不会知道聚合的具体组成。</p>
</li>
<li>
<p>提供了一种<strong>设计思想</strong>，就是一个类应该只有一个引起变化的原因（叫做单一责任原则）。在聚合类中，我们把迭代器分开，就是要把<strong>管理对象集合</strong>和<strong>遍历对象集合</strong>的责任分开，这样一来集合改变的话，只影响到聚合对象。而如果遍历方式改变的话，只影响到了迭代器。</p>
</li>
<li>
<p>当要展示一组相似对象，或者遍历一组相同对象时使用, 适合使用迭代器模式</p>
</li>
</ul>
<ol start="2">
<li>缺点
<ul>
<li>每个聚合对象都要一个迭代器，会生成多个迭代器不好管理类</li>
</ul>
</li>
</ol>
<h1 id="观察者模式"><a class="markdownIt-Anchor" href="#观察者模式"></a> 🌕观察者模式</h1>
<p>当对象间存在一对多关系时，则使用观察者模式（Observer Pattern）。比如，当一个对象被修改时，则会自动通知依赖它的对象。观察者模式属于行为型模式。</p>
<h2 id="介绍-16"><a class="markdownIt-Anchor" href="#介绍-16"></a> 介绍</h2>
<p><strong>意图：</strong> 定义对象间的一种一对多的依赖关系，当一个对象的状态发生改变时，所有依赖于它的对象都得到通知并被自动更新。</p>
<p><strong>主要解决：</strong> 一个对象状态改变给其他对象通知的问题，而且要考虑到易用和低耦合，保证高度的协作。</p>
<p><strong>何时使用：</strong> 一个对象（目标对象）的状态发生改变，所有的依赖对象（观察者对象）都将得到通知，进行广播通知。</p>
<p><strong>如何解决：</strong> 使用面向对象技术，可以将这种依赖关系弱化。</p>
<p><strong>关键代码：</strong> 在抽象类里有一个 ArrayList 存放观察者们。</p>
<p><strong>应用实例：</strong> 1、拍卖的时候，拍卖师观察最高标价，然后通知给其他竞价者竞价。<br />
2、西游记里面悟空请求菩萨降服红孩儿，菩萨洒了一地水招来一个老乌龟，这个乌龟就是观察者，他观察菩萨洒水这个动作。</p>
<p><strong>优点：</strong> 1、观察者和被观察者是抽象耦合的。 2、建立一套触发机制。</p>
<p><strong>缺点：</strong> 1、如果一个被观察者对象有很多的直接和间接的观察者的话，将所有的观察者都通知到会花费很多时间。2、如果在观察者和观察目标之间有循环依赖的话，观察目标会触发它们之间进行循环调用，可能导致系统崩溃。3、观察者模式没有相应的机制让观察者知道所观察的目标对象是怎么发生变化的，而仅仅只是知道观察目标发生了变化。</p>
<p><strong>使用场景：</strong></p>
<ul>
<li>一个抽象模型有两个方面，其中一个方面依赖于另一个方面。将这些方面封装在独立的对象中使它们可以各自独立地改变和复用。</li>
<li>一个对象的改变将导致其他一个或多个对象也发生改变，而不知道具体有多少对象将发生改变，可以降低对象之间的耦合度。</li>
<li>一个对象必须通知其他对象，而并不知道这些对象是谁。</li>
<li>需要在系统中创建一个触发链，A对象的行为将影响B对象，B对象的行为将影响C对象……，可以使用观察者模式创建一种链式触发机制。</li>
</ul>
<p><strong>注意事项：</strong> 1、JAVA 中已经有了对观察者模式的支持类。 2、避免循环引用。 3、如果顺序执行，某一观察者错误会导致系统卡壳，一般采用异步方式。</p>
<h2 id="实现-14"><a class="markdownIt-Anchor" href="#实现-14"></a> 实现</h2>
<h3 id="天气预报设计方案-1-普通方案"><a class="markdownIt-Anchor" href="#天气预报设计方案-1-普通方案"></a> 天气预报设计方案 1-普通方案</h3>
<p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230104142333771.png" srcset="/img/loading.gif" lazyload alt="image-20230104142333771" /></p>
<p><code>Client.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.observer;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">//创建接入方 currentConditions</span><br>      <span class="hljs-type">CurrentConditions</span> <span class="hljs-variable">currentConditions</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CurrentConditions</span>();<br>      <span class="hljs-comment">//创建 WeatherData 并将 接入方 currentConditions 传递到 WeatherData中</span><br>      <span class="hljs-type">WeatherData</span> <span class="hljs-variable">weatherData</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeatherData</span>(currentConditions);<br>      <br>      <span class="hljs-comment">//更新天气情况</span><br>      weatherData.setData(<span class="hljs-number">30</span>, <span class="hljs-number">150</span>, <span class="hljs-number">40</span>);<br>      <br>      <span class="hljs-comment">//天气情况变化</span><br>      System.out.println(<span class="hljs-string">&quot;============天气情况变化=============&quot;</span>);<br>      weatherData.setData(<span class="hljs-number">40</span>, <span class="hljs-number">160</span>, <span class="hljs-number">20</span>);<br>      <br><br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>CurrentConditions.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.observer;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 显示当前天气情况（可以理解成是气象站自己的网站）</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Administrator</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CurrentConditions</span> &#123;<br>    <span class="hljs-comment">// 温度，气压，湿度</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">float</span> temperature;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">float</span> pressure;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">float</span> humidity;<br><br>    <span class="hljs-comment">//更新 天气情况，是由 WeatherData 来调用，我使用推送模式</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">(<span class="hljs-type">float</span> temperature, <span class="hljs-type">float</span> pressure, <span class="hljs-type">float</span> humidity)</span> &#123;<br>        <span class="hljs-built_in">this</span>.temperature = temperature;<br>        <span class="hljs-built_in">this</span>.pressure = pressure;<br>        <span class="hljs-built_in">this</span>.humidity = humidity;<br>        display();<br>    &#125;<br><br>    <span class="hljs-comment">//显示</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">display</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;***Today mTemperature: &quot;</span> + temperature + <span class="hljs-string">&quot;***&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;***Today mPressure: &quot;</span> + pressure + <span class="hljs-string">&quot;***&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;***Today mHumidity: &quot;</span> + humidity + <span class="hljs-string">&quot;***&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>WeatherData.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.observer;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 类是核心</span><br><span class="hljs-comment"> * 1. 包含最新的天气情况信息 </span><br><span class="hljs-comment"> * 2. 含有 CurrentConditions 对象</span><br><span class="hljs-comment"> * 3. 当数据有更新时，就主动的调用   CurrentConditions对象update方法(含 display), 这样他们（接入方）就看到最新的信息</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Administrator</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WeatherData</span> &#123;<br>   <span class="hljs-keyword">private</span> <span class="hljs-type">float</span> temperatrue;<br>   <span class="hljs-keyword">private</span> <span class="hljs-type">float</span> pressure;<br>   <span class="hljs-keyword">private</span> <span class="hljs-type">float</span> humidity;<br>   <span class="hljs-keyword">private</span> CurrentConditions currentConditions;<br>   <span class="hljs-comment">//加入新的第三方</span><br><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">WeatherData</span><span class="hljs-params">(CurrentConditions currentConditions)</span> &#123;<br>      <span class="hljs-built_in">this</span>.currentConditions = currentConditions;<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-type">float</span> <span class="hljs-title function_">getTemperature</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> temperatrue;<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-type">float</span> <span class="hljs-title function_">getPressure</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> pressure;<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-type">float</span> <span class="hljs-title function_">getHumidity</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> humidity;<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">dataChange</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">//调用 接入方的 update</span><br>      currentConditions.update(getTemperature(), getPressure(), getHumidity());<br>   &#125;<br><br>   <span class="hljs-comment">//当数据有更新时，就调用 setData</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setData</span><span class="hljs-params">(<span class="hljs-type">float</span> temperature, <span class="hljs-type">float</span> pressure, <span class="hljs-type">float</span> humidity)</span> &#123;<br>      <span class="hljs-built_in">this</span>.temperatrue = temperature;<br>      <span class="hljs-built_in">this</span>.pressure = pressure;<br>      <span class="hljs-built_in">this</span>.humidity = humidity;<br>      <span class="hljs-comment">//调用dataChange， 将最新的信息 推送给 接入方 currentConditions</span><br>      dataChange();<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<blockquote>
<p>执行程序，输出结果：</p>
</blockquote>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-strong">**<span class="hljs-emphasis">*Today mTemperature: 30.0*</span>**</span><br><span class="hljs-strong">**<span class="hljs-emphasis">*Today mPressure: 150.0*</span>**</span><br><span class="hljs-strong">**<span class="hljs-emphasis">*Today mHumidity: 40.0*</span>**</span><br>============天气情况变化=============<br><span class="hljs-strong">**<span class="hljs-emphasis">*Today mTemperature: 40.0*</span>**</span><br><span class="hljs-strong">**<span class="hljs-emphasis">*Today mPressure: 160.0*</span>**</span><br><span class="hljs-strong">**<span class="hljs-emphasis">*Today mHumidity: 20.0*</span>**</span><br></code></pre></td></tr></table></figure>
<h3 id="观察者模式解决天气预报需求"><a class="markdownIt-Anchor" href="#观察者模式解决天气预报需求"></a> 观察者模式解决天气预报需求</h3>
<p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230104143905498.png" srcset="/img/loading.gif" lazyload alt="image-20230104143905498" /></p>
<p><code>BaiduSite.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.observer.improve;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BaiduSite</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Observer</span> &#123;<br><br>   <span class="hljs-comment">// 温度，气压，湿度</span><br>   <span class="hljs-keyword">private</span> <span class="hljs-type">float</span> temperature;<br>   <span class="hljs-keyword">private</span> <span class="hljs-type">float</span> pressure;<br>   <span class="hljs-keyword">private</span> <span class="hljs-type">float</span> humidity;<br><br>   <span class="hljs-comment">// 更新 天气情况，是由 WeatherData 来调用，我使用推送模式</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">(<span class="hljs-type">float</span> temperature, <span class="hljs-type">float</span> pressure, <span class="hljs-type">float</span> humidity)</span> &#123;<br>      <span class="hljs-built_in">this</span>.temperature = temperature;<br>      <span class="hljs-built_in">this</span>.pressure = pressure;<br>      <span class="hljs-built_in">this</span>.humidity = humidity;<br>      display();<br>   &#125;<br><br>   <span class="hljs-comment">// 显示</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">display</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;===百度网站====&quot;</span>);<br>      System.out.println(<span class="hljs-string">&quot;***百度网站 气温 : &quot;</span> + temperature + <span class="hljs-string">&quot;***&quot;</span>);<br>      System.out.println(<span class="hljs-string">&quot;***百度网站 气压: &quot;</span> + pressure + <span class="hljs-string">&quot;***&quot;</span>);<br>      System.out.println(<span class="hljs-string">&quot;***百度网站 湿度: &quot;</span> + humidity + <span class="hljs-string">&quot;***&quot;</span>);<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>Client.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.observer.improve;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-comment">//创建一个WeatherData</span><br>      <span class="hljs-type">WeatherData</span> <span class="hljs-variable">weatherData</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeatherData</span>();<br>      <br>      <span class="hljs-comment">//创建观察者</span><br>      <span class="hljs-type">CurrentConditions</span> <span class="hljs-variable">currentConditions</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CurrentConditions</span>();<br>      <span class="hljs-type">BaiduSite</span> <span class="hljs-variable">baiduSite</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BaiduSite</span>();<br>      <br>      <span class="hljs-comment">//注册到weatherData</span><br>      weatherData.registerObserver(currentConditions);<br>      weatherData.registerObserver(baiduSite);<br>      <br>      <span class="hljs-comment">//测试</span><br>      System.out.println(<span class="hljs-string">&quot;通知各个注册的观察者, 看看信息&quot;</span>);<br>      weatherData.setData(<span class="hljs-number">10f</span>, <span class="hljs-number">100f</span>, <span class="hljs-number">30.3f</span>);<br>      <br>      <br>      weatherData.removeObserver(currentConditions);<br>      <span class="hljs-comment">//测试</span><br>      System.out.println();<br>      System.out.println(<span class="hljs-string">&quot;通知各个注册的观察者, 看看信息&quot;</span>);<br>      weatherData.setData(<span class="hljs-number">10f</span>, <span class="hljs-number">100f</span>, <span class="hljs-number">30.3f</span>);<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>CurrentConditions.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.observer.improve;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CurrentConditions</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Observer</span> &#123;<br><br>   <span class="hljs-comment">// 温度，气压，湿度</span><br>   <span class="hljs-keyword">private</span> <span class="hljs-type">float</span> temperature;<br>   <span class="hljs-keyword">private</span> <span class="hljs-type">float</span> pressure;<br>   <span class="hljs-keyword">private</span> <span class="hljs-type">float</span> humidity;<br><br>   <span class="hljs-comment">// 更新 天气情况，是由 WeatherData 来调用，我使用推送模式</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">(<span class="hljs-type">float</span> temperature, <span class="hljs-type">float</span> pressure, <span class="hljs-type">float</span> humidity)</span> &#123;<br>      <span class="hljs-built_in">this</span>.temperature = temperature;<br>      <span class="hljs-built_in">this</span>.pressure = pressure;<br>      <span class="hljs-built_in">this</span>.humidity = humidity;<br>      display();<br>   &#125;<br><br>   <span class="hljs-comment">// 显示</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">display</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;***Today mTemperature: &quot;</span> + temperature + <span class="hljs-string">&quot;***&quot;</span>);<br>      System.out.println(<span class="hljs-string">&quot;***Today mPressure: &quot;</span> + pressure + <span class="hljs-string">&quot;***&quot;</span>);<br>      System.out.println(<span class="hljs-string">&quot;***Today mHumidity: &quot;</span> + humidity + <span class="hljs-string">&quot;***&quot;</span>);<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>Observer.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.observer.improve;<br><br><span class="hljs-comment">//观察者接口，有观察者来实现</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Observer</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">(<span class="hljs-type">float</span> temperature, <span class="hljs-type">float</span> pressure, <span class="hljs-type">float</span> humidity)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>Subject.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.observer.improve;<br><br><span class="hljs-comment">//接口, 让WeatherData 来实现 </span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Subject</span> &#123;<br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">registerObserver</span><span class="hljs-params">(Observer o)</span>;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">removeObserver</span><span class="hljs-params">(Observer o)</span>;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">notifyObservers</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>WeatherData.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.observer.improve;<br><br><span class="hljs-keyword">import</span> java.util.ArrayList;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 类是核心</span><br><span class="hljs-comment"> * 1. 包含最新的天气情况信息 </span><br><span class="hljs-comment"> * 2. 含有 观察者集合，使用ArrayList管理</span><br><span class="hljs-comment"> * 3. 当数据有更新时，就主动的调用   ArrayList, 通知所有的（接入方）就看到最新的信息</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Administrator</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WeatherData</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Subject</span> &#123;<br>   <span class="hljs-keyword">private</span> <span class="hljs-type">float</span> temperatrue;<br>   <span class="hljs-keyword">private</span> <span class="hljs-type">float</span> pressure;<br>   <span class="hljs-keyword">private</span> <span class="hljs-type">float</span> humidity;<br>   <span class="hljs-comment">//观察者集合</span><br>   <span class="hljs-keyword">private</span> ArrayList&lt;Observer&gt; observers;<br>   <br>   <span class="hljs-comment">//加入新的第三方</span><br><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">WeatherData</span><span class="hljs-params">()</span> &#123;<br>      observers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;Observer&gt;();<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-type">float</span> <span class="hljs-title function_">getTemperature</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> temperatrue;<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-type">float</span> <span class="hljs-title function_">getPressure</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> pressure;<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-type">float</span> <span class="hljs-title function_">getHumidity</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> humidity;<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">dataChange</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">//调用 接入方的 update</span><br>      <br>      notifyObservers();<br>   &#125;<br><br>   <span class="hljs-comment">//当数据有更新时，就调用 setData</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setData</span><span class="hljs-params">(<span class="hljs-type">float</span> temperature, <span class="hljs-type">float</span> pressure, <span class="hljs-type">float</span> humidity)</span> &#123;<br>      <span class="hljs-built_in">this</span>.temperatrue = temperature;<br>      <span class="hljs-built_in">this</span>.pressure = pressure;<br>      <span class="hljs-built_in">this</span>.humidity = humidity;<br>      <span class="hljs-comment">//调用dataChange， 将最新的信息 推送给 接入方 currentConditions</span><br>      dataChange();<br>   &#125;<br><br>   <span class="hljs-comment">//注册一个观察者</span><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">registerObserver</span><span class="hljs-params">(Observer o)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      observers.add(o);<br>   &#125;<br><br>   <span class="hljs-comment">//移除一个观察者</span><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">removeObserver</span><span class="hljs-params">(Observer o)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-keyword">if</span>(observers.contains(o)) &#123;<br>         observers.remove(o);<br>      &#125;<br>   &#125;<br><br>   <span class="hljs-comment">//遍历所有的观察者，并通知</span><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">notifyObservers</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; observers.size(); i++) &#123;<br>         observers.get(i).update(<span class="hljs-built_in">this</span>.temperatrue, <span class="hljs-built_in">this</span>.pressure, <span class="hljs-built_in">this</span>.humidity);<br>      &#125;<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<blockquote>
<p>执行程序，输出结果：</p>
</blockquote>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs markdown">通知各个注册的观察者, 看看信息<br><span class="hljs-strong">**<span class="hljs-emphasis">*Today mTemperature: 10.0*</span>**</span><br><span class="hljs-strong">**<span class="hljs-emphasis">*Today mPressure: 100.0*</span>**</span><br><span class="hljs-strong">**<span class="hljs-emphasis">*Today mHumidity: 30.3*</span>**</span><br>===百度网站====<br><span class="hljs-strong">**<span class="hljs-emphasis">*百度网站 气温 : 10.0*</span>**</span><br><span class="hljs-strong">**<span class="hljs-emphasis">*百度网站 气压: 100.0*</span>**</span><br><span class="hljs-strong">**<span class="hljs-emphasis">*百度网站 湿度: 30.3*</span>**</span><br><br>通知各个注册的观察者, 看看信息<br>===百度网站====<br><span class="hljs-strong">**<span class="hljs-emphasis">*百度网站 气温 : 10.0*</span>**</span><br><span class="hljs-strong">**<span class="hljs-emphasis">*百度网站 气压: 100.0*</span>**</span><br><span class="hljs-strong">**<span class="hljs-emphasis">*百度网站 湿度: 30.3*</span>**</span><br></code></pre></td></tr></table></figure>
<h1 id="中介者模式"><a class="markdownIt-Anchor" href="#中介者模式"></a> 中介者模式</h1>
<p>中介者模式（Mediator Pattern）是用来降低多个对象和类之间的通信复杂性。这种模式提供了一个中介类，该类通常处理不同类之间的通信，并支持松耦合，使代码易于维护。中介者模式属于行为型模式。</p>
<h2 id="介绍-17"><a class="markdownIt-Anchor" href="#介绍-17"></a> 介绍</h2>
<p><strong>意图：</strong> 用一个中介对象来封装一系列的对象交互，中介者使各对象不需要显式地相互引用，从而使其耦合松散，而且可以独立地改变它们之间的交互。</p>
<p><strong>主要解决：</strong><br />
对象与对象之间存在大量的关联关系，这样势必会导致系统的结构变得很复杂，同时若一个对象发生改变，我们也需要跟踪与之相关联的对象，同时做出相应的处理。</p>
<p><strong>何时使用：</strong> 多个类相互耦合，形成了网状结构。</p>
<p><strong>如何解决：</strong> 将上述网状结构分离为星型结构。</p>
<p><strong>关键代码：</strong> 对象 Colleague 之间的通信封装到一个类中单独处理。</p>
<p><strong>应用实例：</strong> 1、中国加入 WTO 之前是各个国家相互贸易，结构复杂，现在是各个国家通过 WTO 来互相贸易。 2、机场调度系统。 3、MVC 框架，其中C（控制器）就是 M（模型）和 V（视图）的中介者。</p>
<p><strong>优点：</strong> 1、降低了类的复杂度，将一对多转化成了一对一。 2、各个类之间的解耦。 3、符合迪米特原则。</p>
<p><strong>缺点：</strong> 中介者会庞大，变得复杂难以维护。</p>
<p><strong>使用场景：</strong> 1、系统中对象之间存在比较复杂的引用关系，导致它们之间的依赖关系结构混乱而且难以复用该对象。2、想通过一个中间类来封装多个类中的行为，而又不想生成太多的子类。</p>
<p><strong>注意事项：</strong> 不应当在职责混乱的时候使用。</p>
<p><strong>中介者模式的原理类图:</strong></p>
<p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230104145432933.png" srcset="/img/loading.gif" lazyload alt="image-20230104145432933" /></p>
<p>对原理类图的说明-即(中介者模式的角色及职责)</p>
<ol>
<li>
<p>Mediator 就是抽象中介者,定义了同事对象到中介者对象的接口</p>
</li>
<li>
<p>Colleague 是抽象同事类</p>
</li>
<li>
<p>ConcreteMediator 具体的中介者对象, 实现抽象方法, 他需要知道所有的具体的同事类,即以一个集合来管理HashMap,并接受某个同事对象消息，完成相应的任务</p>
</li>
<li>
<p>ConcreteColleague 具体的同事类，会有很多, 每个同事只知道自己的行为，而不了解其他同事类的行为(方法)，但是他们都依赖中介者对象</p>
</li>
</ol>
<h2 id="实现-15"><a class="markdownIt-Anchor" href="#实现-15"></a> 实现</h2>
<p>智能家庭项目：</p>
<ol>
<li>
<p>智能家庭包括各种设备，闹钟、咖啡机、电视机、窗帘 等</p>
</li>
<li>
<p>主人要看电视时，各个设备可以协同工作，自动完成看电视的准备工作，比如流程为：闹铃响起-&gt;咖啡机开始做咖啡-&gt;窗帘自动落下-&gt;电视机开始播放</p>
</li>
</ol>
<p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230104145924536.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<p><code>Alarm.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.mediator.smarthouse;<br><br><span class="hljs-comment">//具体的同事类</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Alarm</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Colleague</span> &#123;<br><br>   <span class="hljs-comment">//构造器</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">Alarm</span><span class="hljs-params">(Mediator mediator, String name)</span> &#123;<br>      <span class="hljs-built_in">super</span>(mediator, name);<br>      <span class="hljs-comment">// TODO Auto-generated constructor stub</span><br>      <span class="hljs-comment">//在创建Alarm 同事对象时，将自己放入到ConcreteMediator 对象中[集合]</span><br>      mediator.Register(name, <span class="hljs-built_in">this</span>);<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">SendAlarm</span><span class="hljs-params">(<span class="hljs-type">int</span> stateChange)</span> &#123;<br>      SendMessage(stateChange);<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">SendMessage</span><span class="hljs-params">(<span class="hljs-type">int</span> stateChange)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-comment">//调用的中介者对象的getMessage</span><br>      <span class="hljs-built_in">this</span>.GetMediator().GetMessage(stateChange, <span class="hljs-built_in">this</span>.name);<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>ClientTest.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.mediator.smarthouse;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ClientTest</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">//创建一个中介者对象</span><br>      <span class="hljs-type">Mediator</span> <span class="hljs-variable">mediator</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcreteMediator</span>();<br>      <br>      <span class="hljs-comment">//创建Alarm 并且加入到  ConcreteMediator 对象的HashMap</span><br>      <span class="hljs-type">Alarm</span> <span class="hljs-variable">alarm</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Alarm</span>(mediator, <span class="hljs-string">&quot;alarm&quot;</span>);<br>      <br>      <span class="hljs-comment">//创建了CoffeeMachine 对象，并  且加入到  ConcreteMediator 对象的HashMap</span><br>      <span class="hljs-type">CoffeeMachine</span> <span class="hljs-variable">coffeeMachine</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CoffeeMachine</span>(mediator,<br>            <span class="hljs-string">&quot;coffeeMachine&quot;</span>);<br>      <br>      <span class="hljs-comment">//创建 Curtains , 并  且加入到  ConcreteMediator 对象的HashMap</span><br>      <span class="hljs-type">Curtains</span> <span class="hljs-variable">curtains</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Curtains</span>(mediator, <span class="hljs-string">&quot;curtains&quot;</span>);<br>      <span class="hljs-type">TV</span> <span class="hljs-variable">tV</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TV</span>(mediator, <span class="hljs-string">&quot;TV&quot;</span>);<br>      <br>      <span class="hljs-comment">//让闹钟发出消息</span><br>      alarm.SendAlarm(<span class="hljs-number">0</span>);<br>      coffeeMachine.FinishCoffee();<br>      alarm.SendAlarm(<span class="hljs-number">1</span>);<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>CoffeeMachine.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.mediator.smarthouse;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CoffeeMachine</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Colleague</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">CoffeeMachine</span><span class="hljs-params">(Mediator mediator, String name)</span> &#123;<br>      <span class="hljs-built_in">super</span>(mediator, name);<br>      <span class="hljs-comment">// TODO Auto-generated constructor stub</span><br>      mediator.Register(name, <span class="hljs-built_in">this</span>);<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">SendMessage</span><span class="hljs-params">(<span class="hljs-type">int</span> stateChange)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-built_in">this</span>.GetMediator().GetMessage(stateChange, <span class="hljs-built_in">this</span>.name);<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">StartCoffee</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;It&#x27;s time to startcoffee!&quot;</span>);<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">FinishCoffee</span><span class="hljs-params">()</span> &#123;<br><br>      System.out.println(<span class="hljs-string">&quot;After 5 minutes!&quot;</span>);<br>      System.out.println(<span class="hljs-string">&quot;Coffee is ok!&quot;</span>);<br>      SendMessage(<span class="hljs-number">0</span>);<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>Colleague.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.mediator.smarthouse;<br><br><span class="hljs-comment">//同事抽象类</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Colleague</span> &#123;<br>   <span class="hljs-keyword">private</span> Mediator mediator;<br>   <span class="hljs-keyword">public</span> String name;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">Colleague</span><span class="hljs-params">(Mediator mediator, String name)</span> &#123;<br><br>      <span class="hljs-built_in">this</span>.mediator = mediator;<br>      <span class="hljs-built_in">this</span>.name = name;<br><br>   &#125;<br><br>   <span class="hljs-keyword">public</span> Mediator <span class="hljs-title function_">GetMediator</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.mediator;<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">SendMessage</span><span class="hljs-params">(<span class="hljs-type">int</span> stateChange)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>ConcreteMediator.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.mediator.smarthouse;<br><br><span class="hljs-keyword">import</span> java.util.HashMap;<br><br><span class="hljs-comment">//具体的中介者类</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConcreteMediator</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Mediator</span> &#123;<br>   <span class="hljs-comment">//集合，放入所有的同事对象</span><br>   <span class="hljs-keyword">private</span> HashMap&lt;String, Colleague&gt; colleagueMap;<br>   <span class="hljs-keyword">private</span> HashMap&lt;String, String&gt; interMap;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">ConcreteMediator</span><span class="hljs-params">()</span> &#123;<br>      colleagueMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;String, Colleague&gt;();<br>      interMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;String, String&gt;();<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">Register</span><span class="hljs-params">(String colleagueName, Colleague colleague)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      colleagueMap.put(colleagueName, colleague);<br><br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br><br>      <span class="hljs-keyword">if</span> (colleague <span class="hljs-keyword">instanceof</span> Alarm) &#123;<br>         interMap.put(<span class="hljs-string">&quot;Alarm&quot;</span>, colleagueName);<br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (colleague <span class="hljs-keyword">instanceof</span> CoffeeMachine) &#123;<br>         interMap.put(<span class="hljs-string">&quot;CoffeeMachine&quot;</span>, colleagueName);<br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (colleague <span class="hljs-keyword">instanceof</span> TV) &#123;<br>         interMap.put(<span class="hljs-string">&quot;TV&quot;</span>, colleagueName);<br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (colleague <span class="hljs-keyword">instanceof</span> Curtains) &#123;<br>         interMap.put(<span class="hljs-string">&quot;Curtains&quot;</span>, colleagueName);<br>      &#125;<br><br>   &#125;<br><br>   <span class="hljs-comment">//具体中介者的核心方法</span><br>   <span class="hljs-comment">//1. 根据得到消息，完成对应任务</span><br>   <span class="hljs-comment">//2. 中介者在这个方法，协调各个具体的同事对象，完成任务</span><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">GetMessage</span><span class="hljs-params">(<span class="hljs-type">int</span> stateChange, String colleagueName)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br><br>      <span class="hljs-comment">//处理闹钟发出的消息</span><br>      <span class="hljs-keyword">if</span> (colleagueMap.get(colleagueName) <span class="hljs-keyword">instanceof</span> Alarm) &#123;<br>         <span class="hljs-keyword">if</span> (stateChange == <span class="hljs-number">0</span>) &#123;<br>            ((CoffeeMachine) (colleagueMap.get(interMap<br>                  .get(<span class="hljs-string">&quot;CoffeeMachine&quot;</span>)))).StartCoffee();<br>            ((TV) (colleagueMap.get(interMap.get(<span class="hljs-string">&quot;TV&quot;</span>)))).StartTv();<br>         &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (stateChange == <span class="hljs-number">1</span>) &#123;<br>            ((TV) (colleagueMap.get(interMap.get(<span class="hljs-string">&quot;TV&quot;</span>)))).StopTv();<br>         &#125;<br><br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (colleagueMap.get(colleagueName) <span class="hljs-keyword">instanceof</span> CoffeeMachine) &#123;<br>         ((Curtains) (colleagueMap.get(interMap.get(<span class="hljs-string">&quot;Curtains&quot;</span>))))<br>               .UpCurtains();<br><br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (colleagueMap.get(colleagueName) <span class="hljs-keyword">instanceof</span> TV) &#123;<span class="hljs-comment">//如果TV发现消息</span><br><br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (colleagueMap.get(colleagueName) <span class="hljs-keyword">instanceof</span> Curtains) &#123;<br>         <span class="hljs-comment">//如果是以窗帘发出的消息，这里处理...</span><br>      &#125;<br><br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">SendMessage</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br><br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>Curtains.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.mediator.smarthouse;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Curtains</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Colleague</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">Curtains</span><span class="hljs-params">(Mediator mediator, String name)</span> &#123;<br>      <span class="hljs-built_in">super</span>(mediator, name);<br>      <span class="hljs-comment">// TODO Auto-generated constructor stub</span><br>      mediator.Register(name, <span class="hljs-built_in">this</span>);<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">SendMessage</span><span class="hljs-params">(<span class="hljs-type">int</span> stateChange)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-built_in">this</span>.GetMediator().GetMessage(stateChange, <span class="hljs-built_in">this</span>.name);<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">UpCurtains</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;I am holding Up Curtains!&quot;</span>);<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>Mediator.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.mediator.smarthouse;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Mediator</span> &#123;<br>   <span class="hljs-comment">//将给中介者对象，加入到集合中</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">Register</span><span class="hljs-params">(String colleagueName, Colleague colleague)</span>;<br><br>   <span class="hljs-comment">//接收消息, 具体的同事对象发出</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">GetMessage</span><span class="hljs-params">(<span class="hljs-type">int</span> stateChange, String colleagueName)</span>;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">SendMessage</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>TV.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.mediator.smarthouse;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TV</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Colleague</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">TV</span><span class="hljs-params">(Mediator mediator, String name)</span> &#123;<br>      <span class="hljs-built_in">super</span>(mediator, name);<br>      <span class="hljs-comment">// TODO Auto-generated constructor stub</span><br>      mediator.Register(name, <span class="hljs-built_in">this</span>);<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">SendMessage</span><span class="hljs-params">(<span class="hljs-type">int</span> stateChange)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-built_in">this</span>.GetMediator().GetMessage(stateChange, <span class="hljs-built_in">this</span>.name);<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">StartTv</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot;It&#x27;s time to StartTv!&quot;</span>);<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">StopTv</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot;StopTv!&quot;</span>);<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<blockquote>
<p>执行程序，输出结果：</p>
</blockquote>
<figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs vhdl">It<span class="hljs-symbol">&#x27;s</span> <span class="hljs-built_in">time</span> <span class="hljs-keyword">to</span> startcoffee!<br>It<span class="hljs-symbol">&#x27;s</span> <span class="hljs-built_in">time</span> <span class="hljs-keyword">to</span> StartTv!<br><span class="hljs-keyword">After</span> <span class="hljs-number">5</span> minutes!<br>Coffee <span class="hljs-keyword">is</span> ok!<br>I am holding Up Curtains!<br>StopTv!<br></code></pre></td></tr></table></figure>
<h2 id="中介者模式的注意事项和细节"><a class="markdownIt-Anchor" href="#中介者模式的注意事项和细节"></a> 中介者模式的注意事项和细节</h2>
<ol>
<li>
<p>多个类相互耦合，会形成网状结构, 使用中介者模式将网状结构分离为星型结构，进行解耦</p>
</li>
<li>
<p>减少类间依赖，降低了耦合，符合迪米特原则</p>
</li>
<li>
<p><mark>中介者</mark><strong>承担了较多的责任，一旦中介者出现了问题，整个系统就会受到影响</strong></p>
</li>
<li>
<p>如果设计不当，中介者对象本身变得过于复杂，这点在实际使用时，要特别注意</p>
</li>
</ol>
<h1 id="备忘录模式"><a class="markdownIt-Anchor" href="#备忘录模式"></a> 备忘录模式</h1>
<p>备忘录模式（Memento Pattern）保存一个对象的某个状态，以便在适当的时候恢复对象。备忘录模式属于行为型模式。</p>
<h2 id="介绍-18"><a class="markdownIt-Anchor" href="#介绍-18"></a> 介绍</h2>
<p><strong>意图：</strong> 在不破坏封装性的前提下，捕获一个对象的内部状态，并在该对象之外保存这个状态。</p>
<p><strong>主要解决：</strong> 所谓备忘录模式就是在不破坏封装的前提下，捕获一个对象的内部状态，并在该对象之外保存这个状态，这样可以在以后将对象恢复到原先保存的状态。</p>
<p><strong>何时使用：</strong><br />
很多时候我们总是需要记录一个对象的内部状态，这样做的目的就是为了允许用户取消不确定或者错误的操作，能够恢复到他原先的状态，使得他有&quot;后悔药&quot;可吃。</p>
<p><strong>如何解决：</strong> 通过一个备忘录类专门存储对象状态。</p>
<p><strong>关键代码：</strong> 客户不与备忘录类耦合，与备忘录管理类耦合。</p>
<p><strong>应用实例：</strong> 1、后悔药。 2、打游戏时的存档。 3、Windows 里的 ctrl + z。 4、IE 中的后退。 5、数据库的事务管理。</p>
<p><strong>优点：</strong> 1、给用户提供了一种可以恢复状态的机制，可以使用户能够比较方便地回到某个历史的状态。2、实现了信息的封装，使得用户不需要关心状态的保存细节。</p>
<p><strong>缺点：</strong> 消耗资源。如果类的成员变量过多，势必会占用比较大的资源，而且每一次保存都会消耗一定的内存。</p>
<p><strong>使用场景：</strong> 1、需要保存/恢复数据的相关状态场景。 2、提供一个可回滚的操作。</p>
<p><strong>注意事项：</strong> 1、为了符合迪米特原则，还要增加一个管理备忘录的类。 2、为了节约内存，可使用原型模式+备忘录模式。</p>
<p><strong>备忘录模式的原理类图:</strong></p>
<p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230104162405505.png" srcset="/img/loading.gif" lazyload alt="image-20230104162405505" /></p>
<p>对原理类图的说明-即(备忘录模式的角色及职责)</p>
<ol>
<li>
<p>originator : 对象(需要保存状态的对象)</p>
</li>
<li>
<p>Memento ： 备忘录对象,负责保存好记录，即 Originator 内部状态</p>
</li>
<li>
<p>Caretaker: 守护者对象,负责保存多个备忘录对象， 使用集合管理，提高效率</p>
</li>
<li>
<p>说明：如果希望保存多个 originator 对象的不同时间的状态，也可以，只需要要 HashMap &lt;String, 集合&gt;</p>
</li>
</ol>
<h2 id="实现-16"><a class="markdownIt-Anchor" href="#实现-16"></a> 实现</h2>
<h3 id="简单实现"><a class="markdownIt-Anchor" href="#简单实现"></a> 简单实现</h3>
<p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230104163106314.png" srcset="/img/loading.gif" lazyload alt="image-20230104163106314" /></p>
<p><code>Caretaker.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.memento.theory;<br><br><span class="hljs-keyword">import</span> java.util.ArrayList;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Caretaker</span> &#123;<br>   <br>   <span class="hljs-comment">//在List 集合中会有很多的备忘录对象</span><br>   <span class="hljs-keyword">private</span> List&lt;Memento&gt; mementoList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;Memento&gt;();<br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">(Memento memento)</span> &#123;<br>      mementoList.add(memento);<br>   &#125;<br>   <br>   <span class="hljs-comment">//获取到第index个Originator 的 备忘录对象(即保存状态)</span><br>   <span class="hljs-keyword">public</span> Memento <span class="hljs-title function_">get</span><span class="hljs-params">(<span class="hljs-type">int</span> index)</span> &#123;<br>      <span class="hljs-keyword">return</span> mementoList.get(index);<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>Client.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.memento.theory;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <br>      <span class="hljs-type">Originator</span> <span class="hljs-variable">originator</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Originator</span>();<br>      <span class="hljs-type">Caretaker</span> <span class="hljs-variable">caretaker</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Caretaker</span>();<br>      <br>      originator.setState(<span class="hljs-string">&quot; 状态#1 攻击力 100 &quot;</span>);<br>      <br>      <span class="hljs-comment">//保存了当前的状态</span><br>      caretaker.add(originator.saveStateMemento());<br>      <br>      originator.setState(<span class="hljs-string">&quot; 状态#2 攻击力 80 &quot;</span>);<br>      <br>      caretaker.add(originator.saveStateMemento());<br>      <br>      originator.setState(<span class="hljs-string">&quot; 状态#3 攻击力 50 &quot;</span>);<br>      caretaker.add(originator.saveStateMemento());<br>      <br>      <br>      <br>      System.out.println(<span class="hljs-string">&quot;当前的状态是 =&quot;</span> + originator.getState());<br>      <br>      <span class="hljs-comment">//希望得到状态 1, 将 originator 恢复到状态1</span><br>      <br>      originator.getStateFromMemento(caretaker.get(<span class="hljs-number">0</span>));<br>      System.out.println(<span class="hljs-string">&quot;恢复到状态1 , 当前的状态是&quot;</span>);<br>      System.out.println(<span class="hljs-string">&quot;当前的状态是 =&quot;</span> + originator.getState());<br><br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>Memento.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.memento.theory;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Memento</span> &#123;<br>   <span class="hljs-keyword">private</span> String state;<br><br>   <span class="hljs-comment">//构造器</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">Memento</span><span class="hljs-params">(String state)</span> &#123;<br>      <span class="hljs-built_in">super</span>();<br>      <span class="hljs-built_in">this</span>.state = state;<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getState</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> state;<br>   &#125;<br>   <br>   <br>   <br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>Originator.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.memento.theory;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Originator</span> &#123;<br><br>    <span class="hljs-keyword">private</span> String state;<span class="hljs-comment">//状态信息</span><br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getState</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> state;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setState</span><span class="hljs-params">(String state)</span> &#123;<br>        <span class="hljs-built_in">this</span>.state = state;<br>    &#125;<br><br>    <span class="hljs-comment">//编写一个方法，可以保存一个状态对象 Memento</span><br>    <span class="hljs-comment">//因此编写一个方法，返回 Memento</span><br>    <span class="hljs-keyword">public</span> Memento <span class="hljs-title function_">saveStateMemento</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Memento</span>(state);<br>    &#125;<br><br>    <span class="hljs-comment">//通过备忘录对象，恢复状态</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">getStateFromMemento</span><span class="hljs-params">(Memento memento)</span> &#123;<br>        state = memento.getState();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<blockquote>
<p>执行程序，输出结果：</p>
</blockquote>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs 1c">当前的状态是 = 状态<span class="hljs-meta">#3 攻击力 50 </span><br>恢复到状态<span class="hljs-number">1</span> , 当前的状态是<br>当前的状态是 = 状态<span class="hljs-meta">#1 攻击力 100 </span><br></code></pre></td></tr></table></figure>
<h3 id="游戏角色恢复状态"><a class="markdownIt-Anchor" href="#游戏角色恢复状态"></a> 游戏角色恢复状态</h3>
<p>游戏角色有攻击力和防御力，在大战 Boss 前保存自身的状态(攻击力和防御力)，当大战 Boss 后攻击力和防御力下降，从备忘录对象恢复到大战前的状态</p>
<p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230104163634868.png" srcset="/img/loading.gif" lazyload alt="image-20230104163634868" /></p>
<p><code>Caretaker.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.memento.game;<br><br><span class="hljs-comment">//守护者对象, 保存游戏角色的状态</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Caretaker</span> &#123;<br><br>   <span class="hljs-comment">//如果只保存一次状态</span><br>   <span class="hljs-keyword">private</span> Memento  memento;<br>   <span class="hljs-comment">//对GameRole 保存多次状态</span><br>   <span class="hljs-comment">//private ArrayList&lt;Memento&gt; mementos;</span><br>   <span class="hljs-comment">//对多个游戏角色保存多个状态</span><br>   <span class="hljs-comment">//private HashMap&lt;String, ArrayList&lt;Memento&gt;&gt; rolesMementos;</span><br><br>   <span class="hljs-keyword">public</span> Memento <span class="hljs-title function_">getMemento</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> memento;<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setMemento</span><span class="hljs-params">(Memento memento)</span> &#123;<br>      <span class="hljs-built_in">this</span>.memento = memento;<br>   &#125;<br>   <br>   <br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>Client.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.memento.game;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-comment">//创建游戏角色</span><br>      <span class="hljs-type">GameRole</span> <span class="hljs-variable">gameRole</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GameRole</span>();<br>      gameRole.setVit(<span class="hljs-number">100</span>);<br>      gameRole.setDef(<span class="hljs-number">100</span>);<br>      <br>      System.out.println(<span class="hljs-string">&quot;和boss大战前的状态&quot;</span>);<br>      gameRole.display();<br>      <br>      <span class="hljs-comment">//把当前状态保存caretaker</span><br>      <span class="hljs-type">Caretaker</span> <span class="hljs-variable">caretaker</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Caretaker</span>();<br>      caretaker.setMemento(gameRole.createMemento());<br>      <br>      System.out.println(<span class="hljs-string">&quot;和boss大战~~~&quot;</span>);<br>      gameRole.setDef(<span class="hljs-number">30</span>);<br>      gameRole.setVit(<span class="hljs-number">30</span>);<br>      <br>      gameRole.display();<br>      <br>      System.out.println(<span class="hljs-string">&quot;大战后，使用备忘录对象恢复到站前&quot;</span>);<br>      <br>      gameRole.recoverGameRoleFromMemento(caretaker.getMemento());<br>      System.out.println(<span class="hljs-string">&quot;恢复后的状态&quot;</span>);<br>      gameRole.display();<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>GameRole.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.memento.game;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GameRole</span> &#123;<br><br>   <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> vit;<br>   <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> def;<br>   <br>   <span class="hljs-comment">//创建Memento ,即根据当前的状态得到Memento</span><br>   <span class="hljs-keyword">public</span> Memento <span class="hljs-title function_">createMemento</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Memento</span>(vit, def);<br>   &#125;<br>   <br>   <span class="hljs-comment">//从备忘录对象，恢复GameRole的状态</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">recoverGameRoleFromMemento</span><span class="hljs-params">(Memento memento)</span> &#123;<br>      <span class="hljs-built_in">this</span>.vit = memento.getVit();<br>      <span class="hljs-built_in">this</span>.def = memento.getDef();<br>   &#125;<br>   <br>   <span class="hljs-comment">//显示当前游戏角色的状态</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">display</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;游戏角色当前的攻击力：&quot;</span> + <span class="hljs-built_in">this</span>.vit + <span class="hljs-string">&quot; 防御力: &quot;</span> + <span class="hljs-built_in">this</span>.def);<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getVit</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> vit;<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setVit</span><span class="hljs-params">(<span class="hljs-type">int</span> vit)</span> &#123;<br>      <span class="hljs-built_in">this</span>.vit = vit;<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getDef</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> def;<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setDef</span><span class="hljs-params">(<span class="hljs-type">int</span> def)</span> &#123;<br>      <span class="hljs-built_in">this</span>.def = def;<br>   &#125;<br>   <br>   <br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>Memento.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.memento.game;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Memento</span> &#123;<br><br>   <span class="hljs-comment">//攻击力</span><br>   <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> vit;<br>   <span class="hljs-comment">//防御力</span><br>   <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> def;<br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">Memento</span><span class="hljs-params">(<span class="hljs-type">int</span> vit, <span class="hljs-type">int</span> def)</span> &#123;<br>      <span class="hljs-built_in">super</span>();<br>      <span class="hljs-built_in">this</span>.vit = vit;<br>      <span class="hljs-built_in">this</span>.def = def;<br>   &#125;<br>   <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getVit</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> vit;<br>   &#125;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setVit</span><span class="hljs-params">(<span class="hljs-type">int</span> vit)</span> &#123;<br>      <span class="hljs-built_in">this</span>.vit = vit;<br>   &#125;<br>   <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getDef</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> def;<br>   &#125;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setDef</span><span class="hljs-params">(<span class="hljs-type">int</span> def)</span> &#123;<br>      <span class="hljs-built_in">this</span>.def = def;<br>   &#125;<br>   <br>   <br>   <br>   <br>&#125;<br></code></pre></td></tr></table></figure>
<blockquote>
<p>执行程序，输出结果：</p>
</blockquote>
<figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">和boss大战前的状态</span><br><span class="hljs-attribute">游戏角色当前的攻击力：100 防御力</span><span class="hljs-punctuation">:</span> <span class="hljs-string">100</span><br><span class="hljs-attribute">和boss大战~~~</span><br><span class="hljs-attribute">游戏角色当前的攻击力：30 防御力</span><span class="hljs-punctuation">:</span> <span class="hljs-string">30</span><br><span class="hljs-attribute">大战后，使用备忘录对象恢复到站前</span><br><span class="hljs-attribute">恢复后的状态</span><br><span class="hljs-attribute">游戏角色当前的攻击力：100 防御力</span><span class="hljs-punctuation">:</span> <span class="hljs-string">100</span><br></code></pre></td></tr></table></figure>
<h2 id="备忘录模式的注意事项和细节"><a class="markdownIt-Anchor" href="#备忘录模式的注意事项和细节"></a> 备忘录模式的注意事项和细节</h2>
<ol>
<li>
<p>给用户提供了一种可以恢复状态的机制，可以使用户能够比较方便地回到某个历史的状态</p>
</li>
<li>
<p>实现了信息的封装，使得用户不需要关心状态的保存细节</p>
</li>
<li>
<p>如果类的成员变量过多，势必会占用比较大的资源，而且每一次保存都会消耗一定的内存, 这个需要注意</p>
</li>
<li>
<p>适用的应用场景：</p>
<ul>
<li>1、后悔药。</li>
<li>2、打游戏时的存档。</li>
<li>3、Windows 里的 ctri + z。</li>
<li>4、IE 中的后退。</li>
<li>5、数据库的事务管理</li>
</ul>
</li>
</ol>
<h1 id="解释器模式"><a class="markdownIt-Anchor" href="#解释器模式"></a> 解释器模式</h1>
<p>解释器模式（Interpreter Pattern）提供了评估语言的语法或表达式的方式，它属于行为型模式。这种模式实现了一个表达式接口，该接口解释一个特定的上下文。这种模式被用在 SQL<br />
解析、符号处理引擎等。</p>
<h2 id="介绍-19"><a class="markdownIt-Anchor" href="#介绍-19"></a> 介绍</h2>
<p><strong>意图：</strong> 给定一个语言，定义它的文法表示，并定义一个解释器，这个解释器使用该标识来解释语言中的句子。</p>
<p><strong>主要解决：</strong> 对于一些固定文法构建一个解释句子的解释器。</p>
<p><strong>何时使用：</strong><br />
如果一种特定类型的问题发生的频率足够高，那么可能就值得将该问题的各个实例表述为一个简单语言中的句子。这样就可以构建一个解释器，该解释器通过解释这些句子来解决该问题。</p>
<p><strong>如何解决：</strong> 构建语法树，定义终结符与非终结符。</p>
<p><strong>关键代码：</strong> 构建环境类，包含解释器之外的一些全局信息，一般是 HashMap。</p>
<p><strong>应用实例：</strong> 编译器、运算表达式计算。</p>
<p><strong>优点：</strong> 1、可扩展性比较好，灵活。 2、增加了新的解释表达式的方式。 3、易于实现简单文法。</p>
<p><strong>缺点：</strong> 1、可利用场景比较少。 2、对于复杂的文法比较难维护。 3、解释器模式会引起类膨胀。 4、解释器模式采用递归调用方法。</p>
<p><strong>使用场景：</strong> 1、可以将一个需要解释执行的语言中的句子表示为一个抽象语法树。 2、一些重复出现的问题可以用一种简单的语言来进行表达。<br />
3、一个简单语法需要解释的场景。</p>
<p><strong>注意事项：</strong> 可利用场景比较少，JAVA 中如果碰到可以用 expression4J 代替。</p>
<p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230104170305404.png" srcset="/img/loading.gif" lazyload alt="image-20230104170305404" /></p>
<p>对原理类图的说明-即(解释器模式的角色及职责)</p>
<ol>
<li>
<p>Context: 是环境角色,含有解释器之外的全局信息.</p>
</li>
<li>
<p>AbstractExpression: 抽象表达式， 声明一个抽象的解释操作,这个方法为抽象语法树中所有的节点所共享</p>
</li>
<li>
<p>TerminalExpression: 为终结符表达式, 实现与文法中的终结符相关的解释操作</p>
</li>
<li>
<p>NonTermialExpression: 为非终结符表达式，为文法中的非终结符实现解释操作.</p>
</li>
<li>
<p>说明： 输入 Context he TerminalExpression 信息通过 Client 输入即可</p>
</li>
</ol>
<h2 id="实现-17"><a class="markdownIt-Anchor" href="#实现-17"></a> 实现</h2>
<p>应用实例要求</p>
<p>通过解释器模式来实现四则运算，</p>
<p>如计算 a+b-c 的值</p>
<p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230104185525137.png" srcset="/img/loading.gif" lazyload alt="image-20230104185525137" /></p>
<p><code>AddExpression.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.interpreter;<br><br><span class="hljs-keyword">import</span> java.util.HashMap;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 加法解释器</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Administrator</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AddExpression</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">SymbolExpression</span>  &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">AddExpression</span><span class="hljs-params">(Expression left, Expression right)</span> &#123;<br>      <span class="hljs-built_in">super</span>(left, right);<br>   &#125;<br><br>   <span class="hljs-comment">//处理相加</span><br>   <span class="hljs-comment">//var 仍然是 &#123;a=10,b=20&#125;..</span><br>   <span class="hljs-comment">//一会我们debug 源码,就ok</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">interpreter</span><span class="hljs-params">(HashMap&lt;String, Integer&gt; <span class="hljs-keyword">var</span>)</span> &#123;<br>      <span class="hljs-comment">//super.left.interpreter(var) ： 返回 left 表达式对应的值 a = 10</span><br>      <span class="hljs-comment">//super.right.interpreter(var): 返回right 表达式对应值 b = 20</span><br>      <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.left.interpreter(<span class="hljs-keyword">var</span>) + <span class="hljs-built_in">super</span>.right.interpreter(<span class="hljs-keyword">var</span>);<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>Calculator.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.interpreter;<br><br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.Stack;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Calculator</span> &#123;<br><br>   <span class="hljs-comment">// 定义表达式</span><br>   <span class="hljs-keyword">private</span> Expression expression;<br><br>   <span class="hljs-comment">// 构造函数传参，并解析</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">Calculator</span><span class="hljs-params">(String expStr)</span> &#123; <span class="hljs-comment">// expStr = a+b</span><br>      <span class="hljs-comment">// 安排运算先后顺序</span><br>      Stack&lt;Expression&gt; stack = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Stack</span>&lt;&gt;();<br>      <span class="hljs-comment">// 表达式拆分成字符数组 </span><br>      <span class="hljs-type">char</span>[] charArray = expStr.toCharArray();<span class="hljs-comment">// [a, +, b]</span><br><br>      <span class="hljs-type">Expression</span> <span class="hljs-variable">left</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>      <span class="hljs-type">Expression</span> <span class="hljs-variable">right</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>      <span class="hljs-comment">//遍历我们的字符数组， 即遍历  [a, +, b]</span><br>      <span class="hljs-comment">//针对不同的情况，做处理</span><br>      <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; charArray.length; i++) &#123;<br>         <span class="hljs-keyword">switch</span> (charArray[i]) &#123;<br>         <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;+&#x27;</span>: <span class="hljs-comment">//</span><br>            left = stack.pop();<span class="hljs-comment">// 从stack取出left =&gt; &quot;a&quot;</span><br>            right = <span class="hljs-keyword">new</span> <span class="hljs-title class_">VarExpression</span>(String.valueOf(charArray[++i]));<span class="hljs-comment">// 取出右表达式 &quot;b&quot;</span><br>            stack.push(<span class="hljs-keyword">new</span> <span class="hljs-title class_">AddExpression</span>(left, right));<span class="hljs-comment">// 然后根据得到left 和 right 构建 AddExpresson加入stack</span><br>            <span class="hljs-keyword">break</span>;<br>         <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;-&#x27;</span>: <span class="hljs-comment">// </span><br>            left = stack.pop();<br>            right = <span class="hljs-keyword">new</span> <span class="hljs-title class_">VarExpression</span>(String.valueOf(charArray[++i]));<br>            stack.push(<span class="hljs-keyword">new</span> <span class="hljs-title class_">SubExpression</span>(left, right));<br>            <span class="hljs-keyword">break</span>;<br>         <span class="hljs-keyword">default</span>: <br>            <span class="hljs-comment">//如果是一个 Var 就创建要给 VarExpression 对象，并push到 stack</span><br>            stack.push(<span class="hljs-keyword">new</span> <span class="hljs-title class_">VarExpression</span>(String.valueOf(charArray[i])));<br>            <span class="hljs-keyword">break</span>;<br>         &#125;<br>      &#125;<br>      <span class="hljs-comment">//当遍历完整个 charArray 数组后，stack 就得到最后Expression</span><br>      <span class="hljs-built_in">this</span>.expression = stack.pop();<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">run</span><span class="hljs-params">(HashMap&lt;String, Integer&gt; <span class="hljs-keyword">var</span>)</span> &#123;<br>      <span class="hljs-comment">//最后将表达式a+b和 var = &#123;a=10,b=20&#125;</span><br>      <span class="hljs-comment">//然后传递给expression的interpreter进行解释执行</span><br>      <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.expression.interpreter(<span class="hljs-keyword">var</span>);<br>   &#125;<br>&#125;```<br>`Client.java`<br>​```java<br><span class="hljs-keyword">package</span> io.xtwoy.interpreter;<br><br><span class="hljs-keyword">import</span> java.io.BufferedReader;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.io.InputStreamReader;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-type">String</span> <span class="hljs-variable">expStr</span> <span class="hljs-operator">=</span> getExpStr(); <span class="hljs-comment">// a+b</span><br>      HashMap&lt;String, Integer&gt; <span class="hljs-keyword">var</span> = getValue(expStr);<span class="hljs-comment">// var &#123;a=10, b=20&#125;</span><br>      <span class="hljs-type">Calculator</span> <span class="hljs-variable">calculator</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Calculator</span>(expStr);<br>      System.out.println(<span class="hljs-string">&quot;运算结果：&quot;</span> + expStr + <span class="hljs-string">&quot;=&quot;</span> + calculator.run(<span class="hljs-keyword">var</span>));<br>   &#125;<br><br>   <span class="hljs-comment">// 获得表达式</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getExpStr</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>      System.out.print(<span class="hljs-string">&quot;请输入表达式：&quot;</span>);<br>      <span class="hljs-keyword">return</span> (<span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedReader</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InputStreamReader</span>(System.in))).readLine();<br>   &#125;<br><br>   <span class="hljs-comment">// 获得值映射</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> HashMap&lt;String, Integer&gt; <span class="hljs-title function_">getValue</span><span class="hljs-params">(String expStr)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>      HashMap&lt;String, Integer&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br><br>      <span class="hljs-keyword">for</span> (<span class="hljs-type">char</span> ch : expStr.toCharArray()) &#123;<br>         <span class="hljs-keyword">if</span> (ch != <span class="hljs-string">&#x27;+&#x27;</span> &amp;&amp; ch != <span class="hljs-string">&#x27;-&#x27;</span>) &#123;<br>            <span class="hljs-keyword">if</span> (!map.containsKey(String.valueOf(ch))) &#123;<br>               System.out.print(<span class="hljs-string">&quot;请输入&quot;</span> + String.valueOf(ch) + <span class="hljs-string">&quot;的值：&quot;</span>);<br>               <span class="hljs-type">String</span> <span class="hljs-variable">in</span> <span class="hljs-operator">=</span> (<span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedReader</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InputStreamReader</span>(System.in))).readLine();<br>               map.put(String.valueOf(ch), Integer.valueOf(in));<br>            &#125;<br>         &#125;<br>      &#125;<br><br>      <span class="hljs-keyword">return</span> map;<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>Expression.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.interpreter;<br><br><span class="hljs-keyword">import</span> java.util.HashMap;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 抽象类表达式，通过HashMap 键值对, 可以获取到变量的值</span><br><span class="hljs-comment"> * </span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Administrator</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Expression</span> &#123;<br>   <span class="hljs-comment">// a + b - c</span><br>   <span class="hljs-comment">// 解释公式和数值, key 就是公式(表达式) 参数[a,b,c], value就是就是具体值</span><br>   <span class="hljs-comment">// HashMap &#123;a=10, b=20&#125;</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-type">int</span> <span class="hljs-title function_">interpreter</span><span class="hljs-params">(HashMap&lt;String, Integer&gt; <span class="hljs-keyword">var</span>)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>SubExpression.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.interpreter;<br><br><span class="hljs-keyword">import</span> java.util.HashMap;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SubExpression</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">SymbolExpression</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">SubExpression</span><span class="hljs-params">(Expression left, Expression right)</span> &#123;<br>      <span class="hljs-built_in">super</span>(left, right);<br>   &#125;<br><br>   <span class="hljs-comment">//求出left 和 right 表达式相减后的结果</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">interpreter</span><span class="hljs-params">(HashMap&lt;String, Integer&gt; <span class="hljs-keyword">var</span>)</span> &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.left.interpreter(<span class="hljs-keyword">var</span>) - <span class="hljs-built_in">super</span>.right.interpreter(<span class="hljs-keyword">var</span>);<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>SymbolExpression.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.interpreter;<br><br><span class="hljs-keyword">import</span> java.util.HashMap;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 抽象运算符号解析器 这里，每个运算符号，都只和自己左右两个数字有关系，</span><br><span class="hljs-comment"> * 但左右两个数字有可能也是一个解析的结果，无论何种类型，都是Expression类的实现类</span><br><span class="hljs-comment"> * </span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Administrator</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SymbolExpression</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Expression</span> &#123;<br><br>   <span class="hljs-keyword">protected</span> Expression left;<br>   <span class="hljs-keyword">protected</span> Expression right;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">SymbolExpression</span><span class="hljs-params">(Expression left, Expression right)</span> &#123;<br>      <span class="hljs-built_in">this</span>.left = left;<br>      <span class="hljs-built_in">this</span>.right = right;<br>   &#125;<br><br>   <span class="hljs-comment">//因为 SymbolExpression 是让其子类来实现，因此 interpreter 是一个默认实现</span><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">interpreter</span><span class="hljs-params">(HashMap&lt;String, Integer&gt; <span class="hljs-keyword">var</span>)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>VarExpression.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.interpreter;<br><br><span class="hljs-keyword">import</span> java.util.HashMap;<br><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 变量的解释器</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Administrator</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VarExpression</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Expression</span> &#123;<br><br>   <span class="hljs-keyword">private</span> String key; <span class="hljs-comment">// key=a,key=b,key=c</span><br><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">VarExpression</span><span class="hljs-params">(String key)</span> &#123;<br>      <span class="hljs-built_in">this</span>.key = key;<br>   &#125;<br><br>   <span class="hljs-comment">// var 就是&#123;a=10, b=20&#125;</span><br>   <span class="hljs-comment">// interpreter 根据 变量名称，返回对应值</span><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">interpreter</span><span class="hljs-params">(HashMap&lt;String, Integer&gt; <span class="hljs-keyword">var</span>)</span> &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-keyword">var</span>.get(<span class="hljs-built_in">this</span>.key);<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<blockquote>
<p>执行程序，输出结果：</p>
</blockquote>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">请输入表达式：<span class="hljs-keyword">a</span>+b-c<br>请输入<span class="hljs-keyword">a</span>的值：<span class="hljs-number">10</span><br>请输入b的值：<span class="hljs-number">1</span><br>请输入c的值：<span class="hljs-number">5</span><br>运算结果：<span class="hljs-keyword">a</span>+b-c=<span class="hljs-number">6</span><br></code></pre></td></tr></table></figure>
<h2 id="解释器模式的注意事项和细节"><a class="markdownIt-Anchor" href="#解释器模式的注意事项和细节"></a> 解释器模式的注意事项和细节</h2>
<ol>
<li>
<p>当有一个语言需要解释执行，可将该语言中的句子表示为一个抽象语法树，就可以考虑使用解释器模式，让程序具有良好的扩展性</p>
</li>
<li>
<p>应用场景：编译器、运算表达式计算、正则表达式、机器人等</p>
</li>
<li>
<p>使用解释器可能带来的问题：解释器模式会引起类膨胀、解释器模式采用递归调用方法，将会导致调试非常复杂、效率可能降低</p>
</li>
</ol>
<h1 id="状态模式"><a class="markdownIt-Anchor" href="#状态模式"></a> 状态模式</h1>
<p>在状态模式（State Pattern）中，类的行为是基于它的状态改变的。这种类型的设计模式属于行为型模式。</p>
<h2 id="介绍-20"><a class="markdownIt-Anchor" href="#介绍-20"></a> 介绍</h2>
<p><strong>意图：</strong> 允许对象在内部状态发生改变时改变它的行为，对象看起来好像修改了它的类。</p>
<p><strong>主要解决：</strong> 对象的行为依赖于它的状态（属性），并且可以根据它的状态改变而改变它的相关行为。</p>
<p><strong>何时使用：</strong> 代码中包含大量与对象状态有关的条件语句。</p>
<p><strong>如何解决：</strong> 将各种具体的状态类抽象出来。</p>
<p><strong>关键代码：</strong><br />
通常命令模式的接口中只有一个方法。而状态模式的接口中有一个或者多个方法。而且，状态模式的实现类的方法，一般返回值，或者是改变实例变量的值。也就是说，状态模式一般和对象的状态有关。实现类的方法有不同的功能，覆盖接口中的方法。状态模式和命令模式一样，也可以用于消除<br />
if…else 等条件选择语句。</p>
<p><strong>应用实例：</strong> 1、打篮球的时候运动员可以有正常状态、不正常状态和超常状态。<br />
2、曾侯乙编钟中，‘钟是抽象接口’,'钟A’等是具体状态，'曾侯乙编钟’是具体环境（Context）。</p>
<p><strong>优点：</strong> 1、封装了转换规则。 2、枚举可能的状态，在枚举状态之前需要确定状态种类。<br />
3、将所有与某个状态有关的行为放到一个类中，并且可以方便地增加新的状态，只需要改变对象状态即可改变对象的行为。<br />
4、允许状态转换逻辑与状态对象合成一体，而不是某一个巨大的条件语句块。 5、可以让多个环境对象共享一个状态对象，从而减少系统中对象的个数。</p>
<p><strong>缺点：</strong> 1、状态模式的使用必然会增加系统类和对象的个数。 2、状态模式的结构与实现都较为复杂，如果使用不当将导致程序结构和代码的混乱。<br />
3、状态模式对&quot;开闭原则&quot;的支持并不太好，对于可以切换状态的状态模式，增加新的状态类需要修改那些负责状态转换的源代码，否则无法切换到新增状态，而且修改某个状态类的行为也需修改对应类的源代码。</p>
<p><strong>使用场景：</strong> 1、行为随状态改变而改变的场景。 2、条件、分支语句的代替者。</p>
<p><strong>注意事项：</strong> 在行为受状态约束的时候使用状态模式，而且状态不超过 5 个。</p>
<p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230105110507630.png" srcset="/img/loading.gif" lazyload alt="image-20230105110507630" /></p>
<p>对原理类图的说明-即(状态模式的角色及职责)</p>
<ol>
<li>
<p>Context 类为环境角色, 用于维护 State 实例,这个实例定义当前状态</p>
</li>
<li>
<p>State 是抽象状态角色,定义一个接口封装与 Context 的一个特点接口相关行为</p>
</li>
<li>
<p>ConcreteState 具体的状态角色，每个子类实现一个与 Context 的一个状态相关行为</p>
</li>
</ol>
<h2 id="实现-18"><a class="markdownIt-Anchor" href="#实现-18"></a> 实现</h2>
<h3 id="状态模式解决-app-抽奖问"><a class="markdownIt-Anchor" href="#状态模式解决-app-抽奖问"></a> 状态模式解决 APP 抽奖问</h3>
<ol>
<li>应用实例要求</li>
</ol>
<p>​	1) 假如每参加一次这个活动要扣除用户 50 积分，中奖概率是 10%</p>
<p>​	2) 奖品数量固定，抽完就不能抽奖</p>
<p>​	3) 活动有四个状态: 可以抽奖、不能抽奖、发放奖品和奖品领完</p>
<p>​	4) 活动的四个状态转换关系图(右图)</p>
<p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230105110700473.png" srcset="/img/loading.gif" lazyload alt="image-20230105110700473" /></p>
<p>完成 APP 抽奖活动项目，使用状态模式.</p>
<ol start="2">
<li>思路分析和图解(类图)</li>
</ol>
<p>-定义出一个接口叫状态接口，每个状态都实现它。</p>
<p>-接口有扣除积分方法、抽奖方法、发放奖品方法</p>
<p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230105140413812.png" srcset="/img/loading.gif" lazyload alt="image-20230105140413812" /></p>
<p><code>CanRaffleState.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.state;<br><br><span class="hljs-keyword">import</span> java.util.Random;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 可以抽奖的状态</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Administrator</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CanRaffleState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">State</span> &#123;<br><br>    RaffleActivity activity;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">CanRaffleState</span><span class="hljs-params">(RaffleActivity activity)</span> &#123;<br>        <span class="hljs-built_in">this</span>.activity = activity;<br>    &#125;<br><br>    <span class="hljs-comment">//已经扣除了积分，不能再扣</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deductMoney</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;已经扣取过了积分&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">//可以抽奖, 抽完奖后，根据实际情况，改成新的状态</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">raffle</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;正在抽奖，请稍等！&quot;</span>);<br>        <span class="hljs-type">Random</span> <span class="hljs-variable">r</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Random</span>();<br>        <span class="hljs-type">int</span> <span class="hljs-variable">num</span> <span class="hljs-operator">=</span> r.nextInt(<span class="hljs-number">10</span>);<br>        <span class="hljs-comment">// 10%中奖机会</span><br>        <span class="hljs-keyword">if</span>(num == <span class="hljs-number">0</span>)&#123;<br>            <span class="hljs-comment">// 改变活动状态为发放奖品 context</span><br>            activity.setState(activity.getDispenseState());<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            System.out.println(<span class="hljs-string">&quot;很遗憾没有抽中奖品！&quot;</span>);<br>            <span class="hljs-comment">// 改变状态为不能抽奖</span><br>            activity.setState(activity.getNoRafflleState());<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// 不能发放奖品</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">dispensePrize</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;没中奖，不能发放奖品&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>Client.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.state;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 状态模式测试类</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Administrator</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-comment">// 创建活动对象，奖品有1个奖品</span><br>        <span class="hljs-type">RaffleActivity</span> <span class="hljs-variable">activity</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RaffleActivity</span>(<span class="hljs-number">1</span>);<br><br>        <span class="hljs-comment">// 我们连续抽30次奖</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">30</span>; i++) &#123;<br>            System.out.println(<span class="hljs-string">&quot;--------第&quot;</span> + (i + <span class="hljs-number">1</span>) + <span class="hljs-string">&quot;次抽奖----------&quot;</span>);<br>            <span class="hljs-comment">// 参加抽奖，第一步点击扣除积分</span><br>            activity.debuctMoney();<br><br>            <span class="hljs-comment">// 第二步抽奖</span><br>            activity.raffle();<br>        &#125;<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>DispenseOutState.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.state;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 奖品发放完毕状态</span><br><span class="hljs-comment"> * 说明，当我们activity 改变成 DispenseOutState， 抽奖活动结束</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Administrator</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DispenseOutState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">State</span> &#123;<br><br>   <span class="hljs-comment">// 初始化时传入活动引用</span><br>    RaffleActivity activity;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">DispenseOutState</span><span class="hljs-params">(RaffleActivity activity)</span> &#123;<br>        <span class="hljs-built_in">this</span>.activity = activity;<br>    &#125;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deductMoney</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;奖品发送完了，请下次再参加&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">raffle</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;奖品发送完了，请下次再参加&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">dispensePrize</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;奖品发送完了，请下次再参加&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>DispenseState.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.state;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 发放奖品的状态</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Administrator</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DispenseState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">State</span> &#123;<br><br>    <span class="hljs-comment">// 初始化时传入活动引用，发放奖品后改变其状态</span><br>    RaffleActivity activity;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">DispenseState</span><span class="hljs-params">(RaffleActivity activity)</span> &#123;<br>        <span class="hljs-built_in">this</span>.activity = activity;<br>    &#125;<br>    <br>    <span class="hljs-comment">//</span><br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deductMoney</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;不能扣除积分&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">raffle</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;不能抽奖&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br><br>    <span class="hljs-comment">//发放奖品</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">dispensePrize</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span>(activity.getCount() &gt; <span class="hljs-number">0</span>)&#123;<br>            System.out.println(<span class="hljs-string">&quot;恭喜中奖了&quot;</span>);<br>            <span class="hljs-comment">// 改变状态为不能抽奖</span><br>            activity.setState(activity.getNoRafflleState());<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            System.out.println(<span class="hljs-string">&quot;很遗憾，奖品发送完了&quot;</span>);<br>            <span class="hljs-comment">// 改变状态为奖品发送完毕, 后面我们就不可以抽奖</span><br>            activity.setState(activity.getDispensOutState());<br>            <span class="hljs-comment">//System.out.println(&quot;抽奖活动结束&quot;);</span><br>            <span class="hljs-comment">//System.exit(0);</span><br>        &#125;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>NoRaffleState.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.state;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 不能抽奖状态</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Administrator</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NoRaffleState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">State</span> &#123;<br><br>    <span class="hljs-comment">// 初始化时传入活动引用，扣除积分后改变其状态</span><br>    RaffleActivity activity;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">NoRaffleState</span><span class="hljs-params">(RaffleActivity activity)</span> &#123;<br>        <span class="hljs-built_in">this</span>.activity = activity;<br>    &#125;<br><br>    <span class="hljs-comment">// 当前状态可以扣积分 , 扣除后，将状态设置成可以抽奖状态</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deductMoney</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;扣除50积分成功，您可以抽奖了&quot;</span>);<br>        activity.setState(activity.getCanRaffleState());<br>    &#125;<br><br>    <span class="hljs-comment">// 当前状态不能抽奖</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">raffle</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;扣了积分才能抽奖喔！&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// 当前状态不能发奖品</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">dispensePrize</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;不能发放奖品&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>RaffleActivity.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.state;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 抽奖活动 //</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Administrator</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RaffleActivity</span> &#123;<br><br>    <span class="hljs-comment">// state 表示活动当前的状态，是变化</span><br>    <span class="hljs-type">State</span> <span class="hljs-variable">state</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>    <span class="hljs-comment">// 奖品数量</span><br>    <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><br>    <span class="hljs-comment">// 四个属性，表示四种状态</span><br>    <span class="hljs-type">State</span> <span class="hljs-variable">noRafflleState</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NoRaffleState</span>(<span class="hljs-built_in">this</span>);<br>    <span class="hljs-type">State</span> <span class="hljs-variable">canRaffleState</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CanRaffleState</span>(<span class="hljs-built_in">this</span>);<br><br>    <span class="hljs-type">State</span> <span class="hljs-variable">dispenseState</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DispenseState</span>(<span class="hljs-built_in">this</span>);<br>    <span class="hljs-type">State</span> <span class="hljs-variable">dispensOutState</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DispenseOutState</span>(<span class="hljs-built_in">this</span>);<br><br>    <span class="hljs-comment">//构造器</span><br>    <span class="hljs-comment">//1. 初始化当前的状态为 noRafflleState（即不能抽奖的状态）</span><br>    <span class="hljs-comment">//2. 初始化奖品的数量 </span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">RaffleActivity</span><span class="hljs-params">(<span class="hljs-type">int</span> count)</span> &#123;<br>        <span class="hljs-built_in">this</span>.state = getNoRafflleState();<br>        <span class="hljs-built_in">this</span>.count = count;<br>    &#125;<br><br>    <span class="hljs-comment">//扣分, 调用当前状态的 deductMoney</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">debuctMoney</span><span class="hljs-params">()</span> &#123;<br>        state.deductMoney();<br>    &#125;<br><br>    <span class="hljs-comment">//抽奖 </span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">raffle</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// 如果当前的状态是抽奖成功</span><br>        <span class="hljs-keyword">if</span> (state.raffle()) &#123;<br>            <span class="hljs-comment">//领取奖品</span><br>            state.dispensePrize();<br>        &#125;<br><br>    &#125;<br><br>    <span class="hljs-keyword">public</span> State <span class="hljs-title function_">getState</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> state;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setState</span><span class="hljs-params">(State state)</span> &#123;<br>        <span class="hljs-built_in">this</span>.state = state;<br>    &#125;<br><br>    <span class="hljs-comment">//这里请大家注意，每领取一次奖品，count--</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getCount</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">curCount</span> <span class="hljs-operator">=</span> count;<br>        count--;<br>        <span class="hljs-keyword">return</span> curCount;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setCount</span><span class="hljs-params">(<span class="hljs-type">int</span> count)</span> &#123;<br>        <span class="hljs-built_in">this</span>.count = count;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> State <span class="hljs-title function_">getNoRafflleState</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> noRafflleState;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setNoRafflleState</span><span class="hljs-params">(State noRafflleState)</span> &#123;<br>        <span class="hljs-built_in">this</span>.noRafflleState = noRafflleState;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> State <span class="hljs-title function_">getCanRaffleState</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> canRaffleState;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setCanRaffleState</span><span class="hljs-params">(State canRaffleState)</span> &#123;<br>        <span class="hljs-built_in">this</span>.canRaffleState = canRaffleState;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> State <span class="hljs-title function_">getDispenseState</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> dispenseState;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setDispenseState</span><span class="hljs-params">(State dispenseState)</span> &#123;<br>        <span class="hljs-built_in">this</span>.dispenseState = dispenseState;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> State <span class="hljs-title function_">getDispensOutState</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> dispensOutState;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setDispensOutState</span><span class="hljs-params">(State dispensOutState)</span> &#123;<br>        <span class="hljs-built_in">this</span>.dispensOutState = dispensOutState;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>State.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.state;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 状态抽象类</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Administrator</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">State</span> &#123;<br><br>   <br>   <span class="hljs-comment">// 扣除积分 - 50</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deductMoney</span><span class="hljs-params">()</span>;<br><br>    <span class="hljs-comment">// 是否抽中奖品</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">raffle</span><span class="hljs-params">()</span>;<br><br>    <span class="hljs-comment">// 发放奖品</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span>  <span class="hljs-keyword">void</span> <span class="hljs-title function_">dispensePrize</span><span class="hljs-params">()</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<blockquote>
<p>执行程序，输出结果：</p>
</blockquote>
<figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs brainfuck"><span class="hljs-literal">--------</span><span class="hljs-comment">第1次抽奖</span><span class="hljs-literal">----------</span><br><span class="hljs-comment">扣除50积分成功，您可以抽奖了</span><br><span class="hljs-comment">正在抽奖，请稍等！</span><br><span class="hljs-comment">恭喜中奖了</span><br><span class="hljs-literal">--------</span><span class="hljs-comment">第2次抽奖</span><span class="hljs-literal">----------</span><br><span class="hljs-comment">扣除50积分成功，您可以抽奖了</span><br><span class="hljs-comment">正在抽奖，请稍等！</span><br><span class="hljs-comment">很遗憾，奖品发送完了</span><br><span class="hljs-literal">--------</span><span class="hljs-comment">第3次抽奖</span><span class="hljs-literal">----------</span><br><span class="hljs-comment">奖品发送完了，请下次再参加</span><br><span class="hljs-comment">奖品发送完了，请下次再参加</span><br><span class="hljs-literal">--------</span><span class="hljs-comment">第4次抽奖</span><span class="hljs-literal">----------</span><br><span class="hljs-comment">奖品发送完了，请下次再参加</span><br><span class="hljs-comment">奖品发送完了，请下次再参加</span><br><span class="hljs-literal">--------</span><span class="hljs-comment">第5次抽奖</span><span class="hljs-literal">----------</span><br><span class="hljs-comment">奖品发送完了，请下次再参加</span><br><span class="hljs-comment">奖品发送完了，请下次再参加</span><br></code></pre></td></tr></table></figure>
<h3 id="状态模式在实际项目-借贷平台-源码剖析"><a class="markdownIt-Anchor" href="#状态模式在实际项目-借贷平台-源码剖析"></a> 状态模式在实际项目-借贷平台 源码剖析</h3>
<ol>
<li>借贷平台的订单，有审核-发布-抢单 等等 步骤，随着操作的不同，会改变订单的状态, 项目中的这个模块实现就会使用到状态模式</li>
</ol>
<p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230105154135954.png" srcset="/img/loading.gif" lazyload alt="image-20230105154135954" /></p>
<p><code>AbstractState.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.state.money;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AbstractState</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">State</span> &#123;<br><br>   <span class="hljs-keyword">protected</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">RuntimeException</span> <span class="hljs-variable">EXCEPTION</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;操作流程不允许&quot;</span>);<br><br>   <span class="hljs-comment">//抽象类，默认实现了 State 接口的所有方法</span><br>   <span class="hljs-comment">//该类的所有方法，其子类(具体的状态类)，可以有选择的进行重写</span><br>   <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">checkEvent</span><span class="hljs-params">(Context context)</span> &#123;<br>        <span class="hljs-keyword">throw</span> EXCEPTION;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">checkFailEvent</span><span class="hljs-params">(Context context)</span> &#123;<br>        <span class="hljs-keyword">throw</span> EXCEPTION;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">makePriceEvent</span><span class="hljs-params">(Context context)</span> &#123;<br>        <span class="hljs-keyword">throw</span> EXCEPTION;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">acceptOrderEvent</span><span class="hljs-params">(Context context)</span> &#123;<br>        <span class="hljs-keyword">throw</span> EXCEPTION;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">notPeopleAcceptEvent</span><span class="hljs-params">(Context context)</span> &#123;<br>        <span class="hljs-keyword">throw</span> EXCEPTION;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">payOrderEvent</span><span class="hljs-params">(Context context)</span> &#123;<br>        <span class="hljs-keyword">throw</span> EXCEPTION;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">orderFailureEvent</span><span class="hljs-params">(Context context)</span> &#123;<br>        <span class="hljs-keyword">throw</span> EXCEPTION;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">feedBackEvent</span><span class="hljs-params">(Context context)</span> &#123;<br>        <span class="hljs-keyword">throw</span> EXCEPTION;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>AllState.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.state.money;<br><br><span class="hljs-comment">//各种具体状态类</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">FeedBackState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractState</span> &#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getCurrentState</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> StateEnum.FEED_BACKED.getValue();<br>   &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">GenerateState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractState</span> &#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">checkEvent</span><span class="hljs-params">(Context context)</span> &#123;<br>      context.setState(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ReviewState</span>());<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">checkFailEvent</span><span class="hljs-params">(Context context)</span> &#123;<br>      context.setState(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FeedBackState</span>());<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getCurrentState</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> StateEnum.GENERATE.getValue();<br>   &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">NotPayState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractState</span> &#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">payOrderEvent</span><span class="hljs-params">(Context context)</span> &#123;<br>      context.setState(<span class="hljs-keyword">new</span> <span class="hljs-title class_">PaidState</span>());<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">feedBackEvent</span><span class="hljs-params">(Context context)</span> &#123;<br>      context.setState(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FeedBackState</span>());<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getCurrentState</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> StateEnum.NOT_PAY.getValue();<br>   &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">PaidState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractState</span> &#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">feedBackEvent</span><span class="hljs-params">(Context context)</span> &#123;<br>      context.setState(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FeedBackState</span>());<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getCurrentState</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> StateEnum.PAID.getValue();<br>   &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">PublishState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractState</span> &#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">acceptOrderEvent</span><span class="hljs-params">(Context context)</span> &#123;<br>      <span class="hljs-comment">//把当前状态设置为  NotPayState。。。</span><br>      <span class="hljs-comment">//至于应该变成哪个状态，有流程图来决定</span><br>      context.setState(<span class="hljs-keyword">new</span> <span class="hljs-title class_">NotPayState</span>());<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">notPeopleAcceptEvent</span><span class="hljs-params">(Context context)</span> &#123;<br>      context.setState(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FeedBackState</span>());<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getCurrentState</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> StateEnum.PUBLISHED.getValue();<br>   &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ReviewState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractState</span> &#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">makePriceEvent</span><span class="hljs-params">(Context context)</span> &#123;<br>      context.setState(<span class="hljs-keyword">new</span> <span class="hljs-title class_">PublishState</span>());<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getCurrentState</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> StateEnum.REVIEWED.getValue();<br>   &#125;<br><br>&#125;```<br>`ClientTest.java`<br>​```java<br><span class="hljs-keyword">package</span> io.xtwoy.state.money;<br><br><span class="hljs-comment">/**测试类*/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ClientTest</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-comment">//创建context 对象</span><br>      <span class="hljs-type">Context</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Context</span>();<br>        <span class="hljs-comment">//将当前状态设置为 PublishState</span><br>      context.setState(<span class="hljs-keyword">new</span> <span class="hljs-title class_">PublishState</span>());<br>        System.out.println(context.getCurrentState());<br>        <br><span class="hljs-comment">//        //publish --&gt; not pay</span><br>        context.acceptOrderEvent(context);<br><span class="hljs-comment">//        //not pay --&gt; paid</span><br>        context.payOrderEvent(context);<br><span class="hljs-comment">//        // 失败, 检测失败时，会抛出异常</span><br><span class="hljs-comment">//        try &#123;</span><br><span class="hljs-comment">//         context.checkFailEvent(context);</span><br><span class="hljs-comment">//         System.out.println(&quot;流程正常..&quot;);</span><br><span class="hljs-comment">//    &#125; catch (Exception e) &#123;</span><br><span class="hljs-comment">//       // <span class="hljs-doctag">TODO:</span> handle exception</span><br><span class="hljs-comment">//       System.out.println(e.getMessage());</span><br><span class="hljs-comment">//    &#125;</span><br>        <br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>Context.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.state.money;<br><br><span class="hljs-comment">//环境上下文</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Context</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractState</span>&#123;<br>   <span class="hljs-comment">//当前的状态 state, 根据我们的业务流程处理，不停的变化</span><br>   <span class="hljs-keyword">private</span> State state;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">checkEvent</span><span class="hljs-params">(Context context)</span> &#123;<br>        state.checkEvent(<span class="hljs-built_in">this</span>);<br>        getCurrentState();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">checkFailEvent</span><span class="hljs-params">(Context context)</span> &#123;<br>        state.checkFailEvent(<span class="hljs-built_in">this</span>);<br>        getCurrentState();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">makePriceEvent</span><span class="hljs-params">(Context context)</span> &#123;<br>        state.makePriceEvent(<span class="hljs-built_in">this</span>);<br>        getCurrentState();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">acceptOrderEvent</span><span class="hljs-params">(Context context)</span> &#123;<br>        state.acceptOrderEvent(<span class="hljs-built_in">this</span>);<br>        getCurrentState();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">notPeopleAcceptEvent</span><span class="hljs-params">(Context context)</span> &#123;<br>        state.notPeopleAcceptEvent(<span class="hljs-built_in">this</span>);<br>        getCurrentState();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">payOrderEvent</span><span class="hljs-params">(Context context)</span> &#123;<br>        state.payOrderEvent(<span class="hljs-built_in">this</span>);<br>        getCurrentState();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">orderFailureEvent</span><span class="hljs-params">(Context context)</span> &#123;<br>        state.orderFailureEvent(<span class="hljs-built_in">this</span>);<br>        getCurrentState();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">feedBackEvent</span><span class="hljs-params">(Context context)</span> &#123;<br>        state.feedBackEvent(<span class="hljs-built_in">this</span>);<br>        getCurrentState();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> State <span class="hljs-title function_">getState</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> state;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setState</span><span class="hljs-params">(State state)</span> &#123;<br>        <span class="hljs-built_in">this</span>.state = state;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getCurrentState</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;当前状态 : &quot;</span> + state.getCurrentState());<br>        <span class="hljs-keyword">return</span> state.getCurrentState();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>State.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.state.money;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 状态接口</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Administrator</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">State</span> &#123;<br><br>   <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 电审</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">checkEvent</span><span class="hljs-params">(Context context)</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 电审失败</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">checkFailEvent</span><span class="hljs-params">(Context context)</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 定价发布</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">makePriceEvent</span><span class="hljs-params">(Context context)</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 接单</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">acceptOrderEvent</span><span class="hljs-params">(Context context)</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 无人接单失效</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">notPeopleAcceptEvent</span><span class="hljs-params">(Context context)</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 付款</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">payOrderEvent</span><span class="hljs-params">(Context context)</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 接单有人支付失效</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">orderFailureEvent</span><span class="hljs-params">(Context context)</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 反馈</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">feedBackEvent</span><span class="hljs-params">(Context context)</span>;<br><br><br>    String <span class="hljs-title function_">getCurrentState</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>StateEnum.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.state.money;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 状态枚举类</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Administrator</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">StateEnum</span> &#123;<br><br>    <span class="hljs-comment">//订单生成</span><br>    GENERATE(<span class="hljs-number">1</span>, <span class="hljs-string">&quot;GENERATE&quot;</span>),<br><br>    <span class="hljs-comment">//已审核</span><br>    REVIEWED(<span class="hljs-number">2</span>, <span class="hljs-string">&quot;REVIEWED&quot;</span>),<br><br>    <span class="hljs-comment">//已发布</span><br>    PUBLISHED(<span class="hljs-number">3</span>, <span class="hljs-string">&quot;PUBLISHED&quot;</span>),<br><br>    <span class="hljs-comment">//待付款</span><br>    NOT_PAY(<span class="hljs-number">4</span>, <span class="hljs-string">&quot;NOT_PAY&quot;</span>),<br><br>    <span class="hljs-comment">//已付款</span><br>    PAID(<span class="hljs-number">5</span>, <span class="hljs-string">&quot;PAID&quot;</span>),<br><br>    <span class="hljs-comment">//已完结</span><br>    FEED_BACKED(<span class="hljs-number">6</span>, <span class="hljs-string">&quot;FEED_BACKED&quot;</span>);<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> key;<br>    <span class="hljs-keyword">private</span> String value;<br><br>    StateEnum(<span class="hljs-type">int</span> key, String value) &#123;<br>        <span class="hljs-built_in">this</span>.key = key;<br>        <span class="hljs-built_in">this</span>.value = value;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getKey</span><span class="hljs-params">()</span> &#123;<span class="hljs-keyword">return</span> key;&#125;<br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getValue</span><span class="hljs-params">()</span> &#123;<span class="hljs-keyword">return</span> value;&#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<blockquote>
<p>执行程序，输出结果：</p>
</blockquote>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs ada">当前状态 : <span class="hljs-type">PUBLISHED</span><br>PUBLISHED<br>当前状态 : <span class="hljs-type">NOT_PAY</span><br>当前状态 : <span class="hljs-type">PAID</span><br></code></pre></td></tr></table></figure>
<h2 id="状态模式的注意事项和细节"><a class="markdownIt-Anchor" href="#状态模式的注意事项和细节"></a> 状态模式的注意事项和细节</h2>
<ol>
<li>
<p>代码有很强的<strong>可读性</strong>。状态模式将每个状态的行为封装到对应的一个类中</p>
</li>
<li>
<p><strong>方便维护</strong>。将容易产生问题的 if-else 语句删除了，如果把每个状态的行为都放到一个类中，每次调用方法时都要判断当前是什么状态，不但会产出很多 if-else 语句，而且容易出错</p>
</li>
<li>
<p>符合“开闭原则”。容易增删状态</p>
</li>
<li>
<p>会产生很多类。每个状态都要一个对应的类，当状态过多时会产生很多类，加大维护难度</p>
</li>
<li>
<p>应用场景：当一个事件或者对象有很多种状态，状态之间会相互转换，对不同的状态要求有不同的行为的时候，可以考虑使用状态模式</p>
</li>
</ol>
<h1 id="策略模式"><a class="markdownIt-Anchor" href="#策略模式"></a> 🌕策略模式</h1>
<p>在策略模式（Strategy Pattern）中，一个类的行为或其算法可以在运行时更改。这种类型的设计模式属于行为型模式。</p>
<h2 id="介绍-21"><a class="markdownIt-Anchor" href="#介绍-21"></a> 介绍</h2>
<p><strong>意图：</strong> 定义一系列的算法,把它们一个个封装起来, 并且使它们可相互替换。</p>
<p><strong>主要解决：</strong> 在有多种算法相似的情况下，使用 if…else 所带来的复杂和难以维护。</p>
<p><strong>何时使用：</strong> 一个系统有许多许多类，而区分它们的只是他们直接的行为。</p>
<p><strong>如何解决：</strong> 将这些算法封装成一个一个的类，任意地替换。</p>
<p><strong>关键代码：</strong> 实现同一个接口。</p>
<p><strong>应用实例：</strong> 1、诸葛亮的锦囊妙计，每一个锦囊就是一个策略。 2、旅行的出游方式，选择骑自行车、坐汽车，每一种旅行方式都是一个策略。 3、JAVA AWT 中的 LayoutManager。</p>
<p><strong>优点：</strong> 1、算法可以自由切换。 2、避免使用多重条件判断。 3、扩展性良好。</p>
<p><strong>缺点：</strong> 1、策略类会增多。 2、所有策略类都需要对外暴露。</p>
<p><strong>使用场景：</strong> 1、如果在一个系统里面有许多类，它们之间的区别仅在于它们的行为，那么使用策略模式可以动态地让一个对象在许多行为中选择一种行为。<br />
2、一个系统需要动态地在几种算法中选择一种。 3、如果一个对象有很多的行为，如果不用恰当的模式，这些行为就只好使用多重的条件选择语句来实现。</p>
<p><strong>注意事项：</strong> 如果一个系统的策略多于四个，就需要考虑使用混合模式，解决策略类膨胀的问题。</p>
<p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230105165911040.png" srcset="/img/loading.gif" lazyload alt="image-20230105165911040" /></p>
<p>从上图可以看到，客户 context 有成员变量 strategy 或者其他的策略接口,至于需要使用到哪个策略，我们可以在构造器中指定</p>
<h2 id="实现-19"><a class="markdownIt-Anchor" href="#实现-19"></a> 实现</h2>
<ol>
<li>应用实例要求</li>
</ol>
<p>​	1) 有各种鸭子(比如 野鸭、北京鸭、水鸭等， 鸭子有各种行为，比如 叫、飞行等)</p>
<p>​	2) 显示鸭子的信息</p>
<p>编写程序完成前面的鸭子项目，要求使用策略模式</p>
<ol start="2">
<li>思路分析(类图)</li>
</ol>
<p>策略模式：分别封装行为接口，实现算法族，超类里放行为接口对象，在子类里具体设定行为对象。原则就是：分离变化部分，封装接口，基于接口编程各种功能。此模式让行为的变化独立于算法的使用者</p>
<p>传统模式类图：</p>
<p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230105170757994.png" srcset="/img/loading.gif" lazyload alt="image-20230105170757994" /></p>
<p><code>Client.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.strategy;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br><br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>		<span class="hljs-comment">// TODO Auto-generated method stub</span><br>		<span class="hljs-comment">//测试</span><br>		<span class="hljs-keyword">new</span> <span class="hljs-title class_">PekingDuck</span>().fly();<br>		<span class="hljs-keyword">new</span> <span class="hljs-title class_">WildDuck</span>().fly();<br>		<span class="hljs-keyword">new</span> <span class="hljs-title class_">ToyDuck</span>().fly();<br>		<span class="hljs-comment">//ToyDuck没有飞行能力</span><br>	&#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure>
<p><code>Duck.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.strategy;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Duck</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">Duck</span><span class="hljs-params">()</span> &#123;<br>   <br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">display</span><span class="hljs-params">()</span>;<span class="hljs-comment">//显示鸭子信息</span><br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">quack</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;鸭子嘎嘎叫~~&quot;</span>);<br>   &#125;<br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">swim</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;鸭子会游泳~~&quot;</span>);<br>   &#125;<br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">fly</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;鸭子会飞翔~~~&quot;</span>);<br>   &#125;<br>   <br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>PekingDuck.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.strategy;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PekingDuck</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Duck</span> &#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">display</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot;~~北京鸭~~~&quot;</span>);<br>   &#125;<br>   <br>   <span class="hljs-comment">//因为北京鸭不能飞翔，因此需要重写fly</span><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">fly</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot;北京鸭不能飞翔&quot;</span>);<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>ToyDuck.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.strategy;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ToyDuck</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Duck</span>&#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">display</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot;玩具鸭&quot;</span>);<br>   &#125;<br><br>   <span class="hljs-comment">//需要重写父类的所有方法</span><br>   <br>   <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">quack</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;玩具鸭不能叫~~&quot;</span>);<br>   &#125;<br>   <br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">swim</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;玩具鸭不会游泳~~&quot;</span>);<br>   &#125;<br>   <br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">fly</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;玩具鸭不会飞翔~~~&quot;</span>);<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>WildDuck.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.strategy;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WildDuck</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Duck</span> &#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">display</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot; 这是野鸭 &quot;</span>);<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<blockquote>
<p>执行程序，输出结果：</p>
</blockquote>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs markdown">北京鸭不能飞翔<br>鸭子会飞翔<span class="hljs-code">~~~</span><br><span class="hljs-code">玩具鸭不会飞翔~~~</span><br></code></pre></td></tr></table></figure>
<p>策略模式类图：</p>
<p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230105165733894.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<p><code>BadFlyBehavior.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.strategy.improve;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BadFlyBehavior</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">FlyBehavior</span> &#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">fly</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot; 飞翔技术一般 &quot;</span>);<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>Client.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.strategy.improve;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-type">WildDuck</span> <span class="hljs-variable">wildDuck</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">WildDuck</span>();<br>      wildDuck.fly();<span class="hljs-comment">//</span><br>      <br>      <span class="hljs-type">ToyDuck</span> <span class="hljs-variable">toyDuck</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ToyDuck</span>();<br>      toyDuck.fly();<br>      <br>      <span class="hljs-type">PekingDuck</span> <span class="hljs-variable">pekingDuck</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PekingDuck</span>();<br>      pekingDuck.fly();<br>      <br>      <span class="hljs-comment">//动态改变某个对象的行为, 北京鸭 不能飞</span><br>      pekingDuck.setFlyBehavior(<span class="hljs-keyword">new</span> <span class="hljs-title class_">NoFlyBehavior</span>());<br>      System.out.println(<span class="hljs-string">&quot;北京鸭的实际飞翔能力&quot;</span>);<br>      pekingDuck.fly();<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>Duck.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.strategy.improve;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Duck</span> &#123;<br><br>    <span class="hljs-comment">//属性, 策略接口</span><br>    FlyBehavior flyBehavior;<br>    <span class="hljs-comment">//其它属性&lt;-&gt;策略接口</span><br>    QuackBehavior quackBehavior;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Duck</span><span class="hljs-params">()</span> &#123;<br><br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">display</span><span class="hljs-params">()</span>;<span class="hljs-comment">//显示鸭子信息</span><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">quack</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;鸭子嘎嘎叫~~&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">swim</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;鸭子会游泳~~&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">fly</span><span class="hljs-params">()</span> &#123;<br><br>      display();<br>        <span class="hljs-comment">//改进</span><br>        <span class="hljs-keyword">if</span> (flyBehavior != <span class="hljs-literal">null</span>) &#123;<br>            flyBehavior.fly();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setFlyBehavior</span><span class="hljs-params">(FlyBehavior flyBehavior)</span> &#123;<br>        <span class="hljs-built_in">this</span>.flyBehavior = flyBehavior;<br>    &#125;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setQuackBehavior</span><span class="hljs-params">(QuackBehavior quackBehavior)</span> &#123;<br>        <span class="hljs-built_in">this</span>.quackBehavior = quackBehavior;<br>    &#125;<br><br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>FlyBehavior.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.strategy.improve;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">FlyBehavior</span> &#123;<br>   <br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">fly</span><span class="hljs-params">()</span>; <span class="hljs-comment">// 子类具体实现</span><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>GoodFlyBehavior.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.strategy.improve;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GoodFlyBehavior</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">FlyBehavior</span> &#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">fly</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot; 飞翔技术高超 ~~~&quot;</span>);<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>NoFlyBehavior.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.strategy.improve;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NoFlyBehavior</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">FlyBehavior</span>&#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">fly</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot; 不会飞翔  &quot;</span>);<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>PekingDuck.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.strategy.improve;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PekingDuck</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Duck</span> &#123;<br><br>   <br>   <span class="hljs-comment">//假如北京鸭可以飞翔，但是飞翔技术一般</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">PekingDuck</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated constructor stub</span><br>      flyBehavior = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BadFlyBehavior</span>();<br>      <br>   &#125;<br>   <br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">display</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.print(<span class="hljs-string">&quot;北京鸭=&gt;&quot;</span>);<br>   &#125;<br>   <br>   <br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>QuackBehavior.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.strategy.improve;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">QuackBehavior</span> &#123;<br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">quack</span><span class="hljs-params">()</span>;<span class="hljs-comment">//子类实现</span><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>ToyDuck.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.strategy.improve;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ToyDuck</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Duck</span>&#123;<br><br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">ToyDuck</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated constructor stub</span><br>      flyBehavior = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NoFlyBehavior</span>();<br>   &#125;<br>   <br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">display</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot;玩具鸭=&gt;&quot;</span>);<br>   &#125;<br><br>   <span class="hljs-comment">//需要重写父类的所有方法</span><br>   <br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">quack</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;玩具鸭不能叫~~&quot;</span>);<br>   &#125;<br>   <br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">swim</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;玩具鸭不会游泳~~&quot;</span>);<br>   &#125;<br>   <br>   <br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>WildDuck.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.strategy.improve;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WildDuck</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Duck</span> &#123;<br><br>   <br>   <span class="hljs-comment">//构造器，传入FlyBehavor 的对象</span><br>   <span class="hljs-keyword">public</span>  <span class="hljs-title function_">WildDuck</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated constructor stub</span><br>      flyBehavior = <span class="hljs-keyword">new</span> <span class="hljs-title class_">GoodFlyBehavior</span>();<br>   &#125;<br>   <br>   <br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">display</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot; 野鸭=&gt; &quot;</span>);<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<blockquote>
<p>执行程序，输出结果：</p>
</blockquote>
<figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs coq"> 野鸭=&gt; <br> 飞翔技术高超 ~~~<br>玩具鸭=&gt;<br> 不会飞翔  <br>北京鸭=&gt; 飞翔技术一般 <br>北京鸭的实际飞翔能力<br>北京鸭=&gt; 不会飞翔 <br></code></pre></td></tr></table></figure>
<h2 id="策略模式的注意事项和细节"><a class="markdownIt-Anchor" href="#策略模式的注意事项和细节"></a> 策略模式的注意事项和细节</h2>
<ol>
<li>
<p>策略模式的关键是：分析项目中变化部分与不变部分</p>
</li>
<li>
<p>策略模式的核心思想是：多用组合/聚合 少用继承；用行为类组合，而不是行为的继承。更有弹性</p>
</li>
<li>
<p>体现了“对修改关闭，对扩展开放”原则，客户端增加行为不用修改原有代码，只要添加一种策略（或者行为）即可，避免了使用多重转移语句（if…else if…else）</p>
</li>
<li>
<p>提供了可以替换继承关系的办法： 策略模式将算法封装在独立的 Strategy 类中使得你可以独立于其 Context 改变它，使它易于切换、易于理解、易于扩展</p>
</li>
<li>
<p><strong>需要注意的是</strong>：每添加一个策略就要增加一个类，当策略过多是会导致类数目庞</p>
</li>
</ol>
<h1 id="责任链模式"><a class="markdownIt-Anchor" href="#责任链模式"></a> 🌗责任链模式</h1>
<p>顾名思义，责任链模式（Chain of Responsibility Pattern）为请求创建了一个接收者对象的链。这种模式给予请求的类型，对请求的发送者和接收者进行解耦。这种类型的设计模式属于行为型模式。</p>
<p>在这种模式中，通常每个接收者都包含对另一个接收者的引用。如果一个对象不能处理该请求，那么它会把相同的请求传给下一个接收者，依此类推。</p>
<h2 id="介绍-22"><a class="markdownIt-Anchor" href="#介绍-22"></a> 介绍</h2>
<p><strong>意图：</strong> 避免请求发送者与接收者耦合在一起，让多个对象都有可能接收请求，将这些对象连接成一条链，并且沿着这条链传递请求，直到有对象处理它为止。</p>
<p><strong>主要解决：</strong><br />
职责链上的处理者负责处理请求，客户只需要将请求发送到职责链上即可，无须关心请求的处理细节和请求的传递，所以职责链将请求的发送者和请求的处理者解耦了。</p>
<p><strong>何时使用：</strong> 在处理消息的时候以过滤很多道。</p>
<p><strong>如何解决：</strong> 拦截的类都实现统一接口。</p>
<p><strong>关键代码：</strong> Handler 里面聚合它自己，在 HandlerRequest 里判断是否合适，如果没达到条件则向下传递，向谁传递之前 set 进去。</p>
<p><strong>应用实例：</strong> 1、红楼梦中的&quot;击鼓传花&quot;。 2、JS 中的事件冒泡。 3、JAVA WEB 中 Apache Tomcat 对 Encoding 的处理，Struts2 的拦截器，jsp servlet 的 Filter。</p>
<p><strong>优点：</strong> 1、降低耦合度。它将请求的发送者和接收者解耦。 2、简化了对象。使得对象不需要知道链的结构。3、增强给对象指派职责的灵活性。通过改变链内的成员或者调动它们的次序，允许动态地新增或者删除责任。 4、增加新的请求处理类很方便。</p>
<p><strong>缺点：</strong> 1、不能保证请求一定被接收。 2、系统性能将受到一定影响，而且在进行代码调试时不太方便，可能会造成循环调用。<br />
3、可能不容易观察运行时的特征，有碍于除错。</p>
<p><strong>使用场景：</strong> 1、有多个对象可以处理同一个请求，具体哪个对象处理该请求由运行时刻自动确定。<br />
2、在不明确指定接收者的情况下，向多个对象中的一个提交一个请求。 3、可动态指定一组对象处理请求。</p>
<p><strong>注意事项：</strong> 在 JAVA WEB 中遇到很多应用。</p>
<p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230105183130277.png" srcset="/img/loading.gif" lazyload alt="image-20230105183130277" /></p>
<p>对原理类图的说明-即(职责链模式的角色及职责)</p>
<ol>
<li>
<p>Handler : 抽象的处理者, 定义了一个处理请求的接口, 同时含义另外 Handler</p>
</li>
<li>
<p>ConcreteHandlerA , B 是具体的处理者, 处理它自己负责的请求， 可以访问它的后继者(即下一个处理者), 如果可以处理当前请求，则处理，否则就将该请求交个 后继者去处理，从而形成一个职责链</p>
</li>
<li>
<p>Request ， 含义很多属性，表示一个请求</p>
</li>
</ol>
<h2 id="实现-20"><a class="markdownIt-Anchor" href="#实现-20"></a> 实现</h2>
<ol>
<li>应用实例要求</li>
</ol>
<p>编写程序完成学校 OA 系统的采购审批项目：需求</p>
<p>采购员采购教学器材</p>
<p>如果金额 小于等于 5000, 由教学主任审批</p>
<p>如果金额 小于等于 10000, 由院长审批</p>
<p>如果金额 小于等于 30000, 由副校长审批</p>
<p>如果金额 超过 30000 以上，有校长审批</p>
<ol start="2">
<li>思路分析和图解(类图)</li>
</ol>
<p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230105184409277.png" srcset="/img/loading.gif" lazyload alt="image-20230105184409277" /></p>
<p><code>Approver.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.responsibilitychain;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Approver</span> &#123;<br><br>    Approver approver;  <span class="hljs-comment">//下一个处理者</span><br>    String name; <span class="hljs-comment">// 名字</span><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Approver</span><span class="hljs-params">(String name)</span> &#123;<br>        <span class="hljs-comment">// TODO Auto-generated constructor stub</span><br>        <span class="hljs-built_in">this</span>.name = name;<br>    &#125;<br><br>    <span class="hljs-comment">//下一个处理者</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setApprover</span><span class="hljs-params">(Approver approver)</span> &#123;<br>        <span class="hljs-built_in">this</span>.approver = approver;<br>    &#125;<br><br>    <span class="hljs-comment">//处理审批请求的方法，得到一个请求, 处理是子类完成，因此该方法做成抽象</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processRequest</span><span class="hljs-params">(PurchaseRequest purchaseRequest)</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>Client.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.responsibilitychain;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-comment">//创建一个请求</span><br>      <span class="hljs-type">PurchaseRequest</span> <span class="hljs-variable">purchaseRequest</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PurchaseRequest</span>(<span class="hljs-number">1</span>, <span class="hljs-number">31000</span>, <span class="hljs-number">1</span>);<br>      <br>      <span class="hljs-comment">//创建相关的审批人</span><br>      <span class="hljs-type">DepartmentApprover</span> <span class="hljs-variable">departmentApprover</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DepartmentApprover</span>(<span class="hljs-string">&quot;张主任&quot;</span>);<br>      <span class="hljs-type">CollegeApprover</span> <span class="hljs-variable">collegeApprover</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CollegeApprover</span>(<span class="hljs-string">&quot;李院长&quot;</span>);<br>      <span class="hljs-type">ViceSchoolMasterApprover</span> <span class="hljs-variable">viceSchoolMasterApprover</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ViceSchoolMasterApprover</span>(<span class="hljs-string">&quot;王副校&quot;</span>);<br>      <span class="hljs-type">SchoolMasterApprover</span> <span class="hljs-variable">schoolMasterApprover</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SchoolMasterApprover</span>(<span class="hljs-string">&quot;佟校长&quot;</span>);<br>   <br>   <br>      <span class="hljs-comment">//需要将各个审批级别的下一个设置好 (处理人构成环形: )</span><br>      departmentApprover.setApprover(collegeApprover);<br>      collegeApprover.setApprover(viceSchoolMasterApprover);<br>      viceSchoolMasterApprover.setApprover(schoolMasterApprover);<br>      schoolMasterApprover.setApprover(departmentApprover);<br>      <br><br>      departmentApprover.processRequest(purchaseRequest);<br>      viceSchoolMasterApprover.processRequest(purchaseRequest);<br><br>      <span class="hljs-comment">//创建一个请求</span><br>      <span class="hljs-type">PurchaseRequest</span> <span class="hljs-variable">purchaseRequest1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PurchaseRequest</span>(<span class="hljs-number">2</span>, <span class="hljs-number">10000</span>, <span class="hljs-number">2</span>);<br><br><br>      departmentApprover.processRequest(purchaseRequest1);<br>      viceSchoolMasterApprover.processRequest(purchaseRequest1);<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>CollegeApprover.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.responsibilitychain;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 院长</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CollegeApprover</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Approver</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">CollegeApprover</span><span class="hljs-params">(String name)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated constructor stub</span><br>      <span class="hljs-built_in">super</span>(name);<br>   &#125;<br>   <br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processRequest</span><span class="hljs-params">(PurchaseRequest purchaseRequest)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-keyword">if</span>(purchaseRequest.getPrice() &gt; <span class="hljs-number">5000</span> &amp;&amp; purchaseRequest.getPrice() &lt;= <span class="hljs-number">10000</span>) &#123;<br>         System.out.println(<span class="hljs-string">&quot; 请求编号 id= &quot;</span> + purchaseRequest.getId() + <span class="hljs-string">&quot; 被 &quot;</span> + <span class="hljs-built_in">this</span>.name + <span class="hljs-string">&quot; 处理&quot;</span>);<br>      &#125;<span class="hljs-keyword">else</span> &#123;<br>         approver.processRequest(purchaseRequest);<br>      &#125;<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>DepartmentApprover.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.responsibilitychain;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 主任</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DepartmentApprover</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Approver</span> &#123;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">DepartmentApprover</span><span class="hljs-params">(String name)</span> &#123;<br>        <span class="hljs-comment">// TODO Auto-generated constructor stub</span><br>        <span class="hljs-built_in">super</span>(name);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processRequest</span><span class="hljs-params">(PurchaseRequest purchaseRequest)</span> &#123;<br>        <span class="hljs-comment">// TODO Auto-generated method stub</span><br>        <span class="hljs-keyword">if</span> (purchaseRequest.getPrice() &lt;= <span class="hljs-number">5000</span>) &#123;<br>            System.out.println(<span class="hljs-string">&quot; 请求编号 id= &quot;</span> + purchaseRequest.getId() + <span class="hljs-string">&quot; 被 &quot;</span> + <span class="hljs-built_in">this</span>.name + <span class="hljs-string">&quot; 处理&quot;</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            approver.processRequest(purchaseRequest);<br>        &#125;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>PurchaseRequest.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.responsibilitychain;<br><br><br><span class="hljs-comment">//请求类</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PurchaseRequest</span> &#123;<br><br>   <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">type</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; <span class="hljs-comment">//请求类型</span><br>   <span class="hljs-keyword">private</span> <span class="hljs-type">float</span> <span class="hljs-variable">price</span> <span class="hljs-operator">=</span> <span class="hljs-number">0.0f</span>; <span class="hljs-comment">//请求金额</span><br>   <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>   <span class="hljs-comment">//构造器</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">PurchaseRequest</span><span class="hljs-params">(<span class="hljs-type">int</span> type, <span class="hljs-type">float</span> price, <span class="hljs-type">int</span> id)</span> &#123;<br>      <span class="hljs-built_in">this</span>.type = type;<br>      <span class="hljs-built_in">this</span>.price = price;<br>      <span class="hljs-built_in">this</span>.id = id;<br>   &#125;<br>   <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getType</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> type;<br>   &#125;<br>   <span class="hljs-keyword">public</span> <span class="hljs-type">float</span> <span class="hljs-title function_">getPrice</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> price;<br>   &#125;<br>   <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> id;<br>   &#125;<br>   <br>   <br>   <br>   <br>   <br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>SchoolMasterApprover.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.responsibilitychain;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 校长</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SchoolMasterApprover</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Approver</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">SchoolMasterApprover</span><span class="hljs-params">(String name)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated constructor stub</span><br>      <span class="hljs-built_in">super</span>(name);<br>   &#125;<br>   <br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processRequest</span><span class="hljs-params">(PurchaseRequest purchaseRequest)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-keyword">if</span>(purchaseRequest.getPrice() &gt; <span class="hljs-number">30000</span>) &#123;<br>         System.out.println(<span class="hljs-string">&quot; 请求编号 id= &quot;</span> + purchaseRequest.getId() + <span class="hljs-string">&quot; 被 &quot;</span> + <span class="hljs-built_in">this</span>.name + <span class="hljs-string">&quot; 处理&quot;</span>);<br>      &#125;<span class="hljs-keyword">else</span> &#123;<br>         approver.processRequest(purchaseRequest);<br>      &#125;<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>ViceSchoolMasterApprover.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.responsibilitychain;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 副校</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ViceSchoolMasterApprover</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Approver</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">ViceSchoolMasterApprover</span><span class="hljs-params">(String name)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated constructor stub</span><br>      <span class="hljs-built_in">super</span>(name);<br>   &#125;<br>   <br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processRequest</span><span class="hljs-params">(PurchaseRequest purchaseRequest)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-keyword">if</span>(purchaseRequest.getPrice() &gt; <span class="hljs-number">10000</span> &amp;&amp; purchaseRequest.getPrice() &lt;= <span class="hljs-number">30000</span>) &#123;<br>         System.out.println(<span class="hljs-string">&quot; 请求编号 id= &quot;</span> + purchaseRequest.getId() + <span class="hljs-string">&quot; 被 &quot;</span> + <span class="hljs-built_in">this</span>.name + <span class="hljs-string">&quot; 处理&quot;</span>);<br>      &#125;<span class="hljs-keyword">else</span> &#123;<br>         approver.processRequest(purchaseRequest);<br>      &#125;<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<blockquote>
<p>执行程序，输出结果：</p>
</blockquote>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs abnf">请求编号 id<span class="hljs-operator">=</span> <span class="hljs-number">1</span> 被 佟校长 处理<br>请求编号 id<span class="hljs-operator">=</span> <span class="hljs-number">1</span> 被 佟校长 处理<br>请求编号 id<span class="hljs-operator">=</span> <span class="hljs-number">2</span> 被 李院长 处理<br>请求编号 id<span class="hljs-operator">=</span> <span class="hljs-number">2</span> 被 李院长 处理<br></code></pre></td></tr></table></figure>
<h2 id="职责链模式的注意事项和细节"><a class="markdownIt-Anchor" href="#职责链模式的注意事项和细节"></a> 职责链模式的注意事项和细节</h2>
<ol>
<li>
<p>将请求和处理分开，实现解耦，提高系统的灵活性</p>
</li>
<li>
<p>简化了对象，使对象不需要知道链的结构</p>
</li>
<li>
<p>性能会受到影响，特别是在<strong>链比较长的时候</strong>，因此需控制链中最大节点数量，一般通过在 Handler 中设置一个最大节点数量，在 setNext()方法中判断是否已经超过阀值，超过则不允许该链建立，避免出现超长链无意识地破坏系统性能</p>
</li>
<li>
<p>参考笔记：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.runoob.com/design-pattern/design-pattern-tutorial.html">菜鸟教程设计模式</a></li>
<li><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1G4411c7N4?p=148&amp;vd_source=a432f7b466d0eab98b92ac7132f5ca5c">尚硅谷Java设计模式（图解+框架源码剖析）笔记资料</a></li>
</ul>
</li>
<li>
<p>学习视频</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1G4411c7N4?p=148&amp;vd_source=a432f7b466d0eab98b92ac7132f5ca5c">尚硅谷Java设计模式（图解+框架源码剖析</a></li>
</ul>
</li>
</ol>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" class="category-chain-item">设计模式</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">#设计模式</a>
      
        <a href="/tags/%E8%BF%9B%E9%98%B6/">#进阶</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>设计模式</div>
      <div>http://xtwoy.github.io/设计模式/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>Author</div>
          <div>XtwoY</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>Posted on</div>
          <div>January 5, 2023</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>Licensed under</div>
          <div>
            
              
              
                <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - Attribution">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/RabbitMQ/" title="RabbitMQ">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">RabbitMQ</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/" title="函数式编程-Stream流">
                        <span class="hidden-mobile">函数式编程-Stream流</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar category-bar" style="margin-left: -1rem">
    





<div class="category-list">
  
  
    
    
    
    <div class="category row nomargin-x">
      <a class="category-item 
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="设计模式"
        id="heading-301a19970448f8e4f27ddae7a7d415fe" role="tab" data-toggle="collapse" href="#collapse-301a19970448f8e4f27ddae7a7d415fe"
        aria-expanded="true"
      >
        设计模式
        <span class="list-group-count">(1)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse show" id="collapse-301a19970448f8e4f27ddae7a7d415fe"
           role="tabpanel" aria-labelledby="heading-301a19970448f8e4f27ddae7a7d415fe">
        
        
          
  <div class="category-post-list">
    
    
      
      
        <a href="/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" title="设计模式"
           class="list-group-item list-group-item-action
           active">
          <span class="category-post">设计模式</span>
        </a>
      
    
  </div>

        
      </div>
    </div>
  
</div>


  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">Keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        总访问量 
        <span id="busuanzi_value_site_pv"></span>
         次
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        总访客数 
        <span id="busuanzi_value_site_uv"></span>
         人
      </span>
    
    
  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script defer src="/js/leancloud.js" ></script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




  
<script src="/js/Click_on_special_effects.js"></script>
<script src="/js/Click_on_special_effects1.js"></script>



<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">Blog works best with JavaScript enabled</div>
  </noscript>
</body>
</html>
